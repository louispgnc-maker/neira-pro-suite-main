import { AppLayout } from "@/components/layout/AppLayout";
import { Button } from "@/components/ui/button";
import { Eye, Search, MoreHorizontal, Trash2, Plus, ArrowRight, Upload } from "lucide-react";
import { useLocation, useNavigate } from "react-router-dom";
import { useAuth } from "@/contexts/AuthContext";
import { useEffect, useState } from "react";
import { supabase } from "@/lib/supabaseClient";
import { NOTAIRE_CONTRACT_CATEGORIES } from "@/components/dashboard/ContractSelectorNotaire";
import { AVOCAT_CONTRACT_CATEGORIES } from "@/components/dashboard/ContractSelectorAvocat";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
} from "@/components/ui/dropdown-menu";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { Checkbox } from "@/components/ui/checkbox";
import { toast } from "sonner";
import { ShareToCollaborativeDialog } from "@/components/cabinet/ShareToCollaborativeDialog";

type ContratRow = {
  id: string;
  name: string;
  category: string;
  type: string;
  created_at: string;
  updated_at: string;
};

// Catégories filtrage dynamiques selon le rôle
const categoriesNotaire = [
  "Tous",
  "Immobilier",
  "Famille & Patrimoine",
  "Succession",
  "Procurations & Actes divers"
];

const categoriesAvocat = [
  "Tous",
  "Droit des affaires / Commercial",
  "Droit du travail",
  "Droit immobilier",
  "Droit civil / Vie privée",
  "Propriété intellectuelle & Numérique",
];

// Composant réutilisable pour upload multiple de fichiers
interface FileWithMetadata extends File {
  _autoLoaded?: boolean;
  _clientName?: string;
}

interface MultiFileUploadProps {
  label: string;
  files: File[];
  onFilesChange: (files: File[]) => void;
  required?: boolean;
  accept?: string;
  role?: 'notaire' | 'avocat';
}

function ClientSelector({ clients, selectedClientId, value, onClientChange, label = "Sélectionner votre client", placeholder }: { clients: Array<{id: string, nom: string, prenom: string}>; selectedClientId?: string; value?: string; onClientChange: (clientId: string) => void; label?: string; placeholder?: string }) {
  const clientId = selectedClientId || value || '';
  
  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between">
        <Label htmlFor="client-select">
          {label}
        </Label>
        {clientId && (
          <button
            type="button"
            onClick={() => onClientChange('')}
            className="text-xs text-blue-600 hover:text-blue-800 underline font-medium"
          >
            Saisie manuelle
          </button>
        )}
      </div>
      <Select value={clientId} onValueChange={onClientChange}>
        <SelectTrigger id="client-select">
          <SelectValue placeholder={placeholder || "Choisir un client"} />
        </SelectTrigger>
        <SelectContent>
          {clients.map((client) => (
            <SelectItem key={client.id} value={client.id}>
              {client.prenom} {client.nom}
            </SelectItem>
          ))}
        </SelectContent>
      </Select>
    </div>
  );
}

// Composant SubmitButton standardisé
interface SubmitButtonProps {
  onClick: () => void;
  label: string;
  role: 'notaire' | 'avocat';
  disabled?: boolean;
}

function SubmitButton({ onClick, label, role, disabled = false }: SubmitButtonProps) {
  const bgColor = role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700' : 'bg-blue-600 hover:bg-blue-700';
  
  return (
    <Button
      onClick={onClick}
      disabled={disabled}
      className={`w-full py-6 text-lg font-semibold ${bgColor} text-white`}
    >
      <ArrowRight className="mr-2 h-5 w-5" />
      {label}
    </Button>
  );
}

function MultiFileUpload({ label, files, onFilesChange, required = false, accept, role = 'notaire' }: MultiFileUploadProps) {
  const inputId = `upload-${label.replace(/\s+/g, '-').toLowerCase()}`;
  
  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files) {
      const newFiles = Array.from(e.target.files);
      onFilesChange([...files, ...newFiles]);
    }
  };
  
  const removeFile = (index: number) => {
    onFilesChange(files.filter((_, i) => i !== index));
  };
  
  return (
    <div className="space-y-2">
      <Label>
        {label} {required && <span className="text-red-500">*</span>}
      </Label>
      <button
        type="button"
        onClick={() => document.getElementById(inputId)?.click()}
        className={`w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 bg-white transition-colors ${role === 'notaire' ? 'hover:bg-orange-50' : 'hover:bg-blue-50'}`}
        style={{
          borderColor: files.length > 0 ? "#22c55e" : (role === 'notaire' ? "#fb923c" : "#3b82f6")
        }}
      >
        {files.length > 0 ? (
          <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
          </svg>
        ) : (
          <svg className={`w-5 h-5 ${role === 'notaire' ? 'text-orange-500' : 'text-blue-500'}`} fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
          </svg>
        )}
        <span className={files.length > 0 ? "text-green-700 font-medium" : (role === 'notaire' ? "text-orange-700" : "text-gray-700")}>
          {files.length > 0 ? `${files.length} fichier(s) chargé(s) - Cliquer pour en ajouter` : "Aucune pièce chargée - Cliquer pour ajouter"}
        </span>
      </button>
      <Input
        id={inputId}
        type="file"
        className="hidden"
        multiple
        accept={accept}
        onChange={handleFileSelect}
      />
      {files.length > 0 && (
        <div className="mt-2 space-y-1">
          {files.map((file, index) => {
            const fileWithMeta = file as FileWithMetadata;
            const isAutoLoaded = fileWithMeta._autoLoaded === true;
            
            return (
              <div key={index} className="space-y-1">
                <div className="flex items-center justify-between p-2 bg-gray-50 rounded border text-sm">
                  <div className="flex items-center gap-2 flex-1 min-w-0">
                    <svg className="w-4 h-4 text-gray-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                      <path fillRule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clipRule="evenodd" />
                    </svg>
                    <span className="truncate" title={file.name}>{file.name}</span>
                    <span className="text-gray-400 text-xs flex-shrink-0">
                      ({(file.size / 1024).toFixed(0)} KB)
                    </span>
                  </div>
                  <button
                    type="button"
                    onClick={() => removeFile(index)}
                    className="ml-2 p-1 text-red-600 hover:bg-red-50 rounded flex-shrink-0"
                    title="Supprimer"
                  >
                    <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                      <path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" />
                    </svg>
                  </button>
                </div>
                {isAutoLoaded && (
                  <div className="flex items-center gap-1 px-2 py-1 text-xs text-gray-700 bg-blue-50 rounded">
                    <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                      <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                    </svg>
                    <span>Pièce du client {fileWithMeta._clientName || ''} chargée automatiquement</span>
                  </div>
                )}
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}

// Composant SingleFileUpload pour un seul document avec bouton intégré (plusieurs fichiers possibles)
interface SingleFileUploadProps {
  label: string;
  files: File[];
  onFilesChange: (files: File[]) => void;
  required?: boolean;
  accept?: string;
  role?: 'notaire' | 'avocat';
}

function SingleFileUpload({ label, files, onFilesChange, required = false, accept, role = 'notaire' }: SingleFileUploadProps) {
  const inputId = `upload-single-${label.replace(/\s+/g, '-').toLowerCase()}`;
  
  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files) {
      const newFiles = Array.from(e.target.files);
      onFilesChange([...files, ...newFiles]);
    }
  };
  
  const removeFile = (index: number) => {
    onFilesChange(files.filter((_, i) => i !== index));
  };
  
  // Code couleur : avocat = bleu, notaire = orange
  const borderColor = role === 'avocat' ? 'border-blue-300' : 'border-orange-300';
  const hoverBg = role === 'avocat' ? 'hover:bg-blue-100' : 'hover:bg-orange-50';
  const hoverBorder = role === 'avocat' ? 'hover:border-blue-500' : 'hover:border-orange-400';
  const iconColor = role === 'avocat' ? 'text-gray-700' : 'text-orange-600';
  const textColor = role === 'avocat' ? 'text-gray-700' : 'text-orange-700';
  
  return (
    <div className="space-y-2">
      <Label className="text-sm">
        {label} {required && <span className="text-red-500">*</span>}
      </Label>
      
      <input
        type="file"
        accept={accept}
        multiple
        className="hidden"
        id={inputId}
        onChange={handleFileSelect}
      />
      
      <button
        type="button"
        className={`w-full p-3 border-2 border-dashed ${borderColor} rounded-lg text-sm flex items-center justify-center gap-2 bg-white ${hoverBg} ${hoverBorder} transition-colors`}
        onClick={() => document.getElementById(inputId)?.click()}
      >
        <svg className={`w-4 h-4 ${iconColor} flex-shrink-0`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <span className={`text-sm flex-1 ${textColor}`}>
          {files.length > 0 ? `${files.length} fichier(s) chargé(s) - Cliquer pour en ajouter` : "Aucune pièce chargée - Cliquer pour ajouter"}
        </span>
      </button>
      
      {files.length > 0 && (
        <div className="mt-2 space-y-1">
          {files.map((file, idx) => (
            <div key={idx} className="flex items-center justify-between text-xs bg-muted p-2 rounded">
              <span className="truncate flex-1">{file.name}</span>
              <button
                type="button"
                onClick={() => removeFile(idx)}
                className="ml-2 text-red-500 hover:text-red-700 px-2"
              >
                ✕
              </button>
            </div>
          ))}
        </div>
      )}
    </div>
  );
}

export default function Contrats() {
  const { user } = useAuth();
  const location = useLocation();
  const [loading, setLoading] = useState(true);
  const [contrats, setContrats] = useState<ContratRow[]>([]);
  const [search, setSearch] = useState("");
  const [categoryFilter, setCategoryFilter] = useState("Tous");
  const [debounced, setDebounced] = useState("");

  // Dialog questionnaire pour compromis de vente
  const [showQuestionDialog, setShowQuestionDialog] = useState(false);
  const [pendingContractType, setPendingContractType] = useState<string>("");
  const [pendingCategory, setPendingCategory] = useState<string>("");
  const [selectedClientId, setSelectedClientId] = useState<string>("");
  const [genericDescription, setGenericDescription] = useState<string>("");
  const [clients, setClients] = useState<Array<{id: string, nom: string, prenom: string, adresse: string, telephone?: string, email?: string, date_naissance?: string, lieu_naissance?: string, nationalite?: string, profession?: string, situation_matrimoniale?: string, situation_familiale?: string | {regime_matrimonial?: string, nombre_enfants?: string, personne_a_charge?: any}, etat_civil?: string, type_identite?: string, numero_identite?: string, date_expiration_identite?: string, id_doc_path?: string}>>([]);
  
  // États séparés pour chaque partie des contrats
  const [prestationPrestataireClientId, setPrestationPrestataireClientId] = useState<string>("");
  const [prestationClientClientId, setPrestationClientClientId] = useState<string>("");
  const [venteB2BFournisseurClientId, setVenteB2BFournisseurClientId] = useState<string>("");
  const [venteB2BDistributeurClientId, setVenteB2BDistributeurClientId] = useState<string>("");
  const [cgvVendeurClientId, setCgvVendeurClientId] = useState<string>("");

  // States pour les fichiers uploadés
  const [compromisClientIdentiteUrl, setCompromisClientIdentiteUrl] = useState<string | null>(null); // URL du document du client
  const [compromisAutrePartieFiles, setCompromisAutrePartieFiles] = useState<File[]>([]); // Fichiers de l'autre partie
  const [compromisDiagnosticsFiles, setCompromisDiagnosticsFiles] = useState<File[]>([]);
  const [acteClientIdentiteUrl, setActeClientIdentiteUrl] = useState<string | null>(null); // URL du document du client acte
  const [bailClientIdentiteUrl, setBailClientIdentiteUrl] = useState<string | null>(null); // URL du document du client bail
  const [bailCommercialBailleurClientIdentiteUrl, setBailCommercialBailleurClientIdentiteUrl] = useState<string | null>(null); // URL du document du bailleur bail commercial
  const [bailCommercialPreneurClientIdentiteUrl, setBailCommercialPreneurClientIdentiteUrl] = useState<string | null>(null); // URL du document du preneur bail commercial
  const [acteAutrePartieFiles, setActeAutrePartieFiles] = useState<File[]>([]); // Fichiers de l'autre partie acte
  const [acteVendeurFiles, setActeVendeurFiles] = useState<File[]>([]); // Fichiers supplémentaires vendeur
  const [acteAcheteurFiles, setActeAcheteurFiles] = useState<File[]>([]); // Fichiers supplémentaires acheteur
  const [acteDiagnosticsFiles, setActeDiagnosticsFiles] = useState<File[]>([]);
  const [locataireDocsFiles, setLocataireDocsFiles] = useState<File[]>([]);
  const [bailleurIdFiles, setBailleurIdFiles] = useState<File[]>([]); // Pièce d'identité bailleur
  const [locataireIdFiles, setLocataireIdFiles] = useState<File[]>([]); // Documents locataire
  const [inventaireMobilierFiles, setInventaireMobilierFiles] = useState<File[]>([]); // Inventaire mobilier PDF/images
  const [bailCommercialBailleurFiles, setBailCommercialBailleurFiles] = useState<File[]>([]); // Kbis/ID bailleur commercial
  const [bailCommercialLocataireFiles, setBailCommercialLocataireFiles] = useState<File[]>([]); // Kbis/ID locataire commercial
  
  // States pour cession de parts sociales
  const [cessionStatutsFiles, setCessionStatutsFiles] = useState<File[]>([]); // Statuts société
  const [cessionKbisFiles, setCessionKbisFiles] = useState<File[]>([]); // Kbis
  const [cessionComptesFiles, setCessionComptesFiles] = useState<File[]>([]); // Comptes annuels
  const [cessionRegistreFiles, setCessionRegistreFiles] = useState<File[]>([]); // Registre associés
  const [cessionPacteFiles, setCessionPacteFiles] = useState<File[]>([]); // Pacte d'associés
  const [cessionCedantIdFiles, setCessionCedantIdFiles] = useState<File[]>([]); // ID cédant
  const [cessionCedantMariageFiles, setCessionCedantMariageFiles] = useState<File[]>([]); // Contrat mariage cédant
  const [cessionExpertiseFiles, setCessionExpertiseFiles] = useState<File[]>([]); // Expertise parts
  const [cessionCCAFiles, setCessionCCAFiles] = useState<File[]>([]); // Justificatif CCA
  const [cessionCessionnaireIdFiles, setCessionCessionnaireIdFiles] = useState<File[]>([]); // ID cessionnaire
  const [cessionCessionnaireDomicileFiles, setCessionCessionnaireDomicileFiles] = useState<File[]>([]); // Justif domicile
  const [cessionCessionnaireKbisFiles, setCessionCessionnaireKbisFiles] = useState<File[]>([]); // Kbis cessionnaire
  const [cessionOrigineFondsFiles, setCessionOrigineFondsFiles] = useState<File[]>([]); // Origine fonds
  const [cessionPVAgrementFiles, setCessionPVAgrementFiles] = useState<File[]>([]); // PV agrément
  
  // States pour Contrat de prestation de services (avocats)
  const [prestationData, setPrestationData] = useState({
    // 1. Identification Prestataire
    prestataireDenomination: "",
    prestataireFormeJuridique: "",
    prestataireRCS: "",
    prestataireSiegeSocial: "",
    prestataireRepresentant: "",
    prestataireFonctionSignataire: "",
    prestataireEmail: "",
    prestataireTelephone: "",
    prestataireAssuranceRC: "", // oui/non
    prestataireNumeroAssurance: "",
    
    // 2. Identification Client
    clientDenomination: "",
    clientFormeJuridique: "",
    clientAdresse: "",
    clientRCS: "",
    clientRepresentant: "",
    clientFonction: "",
    clientContactOperationnel: "",
    clientEmail: "",
    clientTelephone: "",
    
    // 3. Objet du contrat
    naturePrestation: "",
    descriptionDetaillee: "",
    perimetreIntervention: "",
    inclusionsPrestations: "",
    exclusionsPrestations: "",
    resultatsAttendus: "",
    typeObligation: "", // moyens / resultat
    competencesTechniques: "",
    referentTechniquePrestataire: "",
    referentTechniqueClient: "",
    
    // 4. Durée
    typeDuree: "", // determinee / ponctuelle / indeterminee
    dateDebut: "",
    dateFin: "",
    reconductionTacite: "", // oui / non
    dureeMinimale: "",
    
    // 5. Modalités de réalisation
    lieuExecution: "", // teletravail / locaux_client / locaux_prestataire / mixte
    conditionsIntervention: "",
    horairesImpose: "", // oui / non
    detailsHoraires: "",
    materielMisADisposition: "",
    obligationsClient: "",
    delaisRealisation: "",
    planning: "",
    criteresAcceptation: "",
    
    // 6. Prix et conditions financières
    modeFacturation: "", // forfait / horaire / journalier / livrable / abonnement / performance
    montantHT: "",
    tva: "",
    modalitesVariation: "",
    fraisAnnexes: "",
    modalitesPaiement: "", // comptant / 30j / 45j / 60j
    acompte: "",
    echeancier: "",
    facturationElectronique: "", // oui / non
    penalitesRetard: "",
    indemniteLegale: "",
    suspensionImpaye: "", // oui / non
    
    // 6. Propriété intellectuelle
    droitsCreationsPrestataire: "", // licence / cession / reserves
    limitationDroits: "",
    droitsCreationsClient: "",
    proprietaireCode: "", // prestataire / client
    droitsReproduction: "",
    garantiesContrefacon: "",
    
    // 7. Confidentialité
    definitionInfosConfidentielles: "",
    dureeConfidentialite: "5", // 5 ans par défaut
    exceptionsConfidentialite: "",
    sanctionsViolation: "",
    
    // 8. RGPD
    prestataireSousTraitant: "", // oui / non
    clientResponsableTraitement: "", // oui / non
    natureDonnees: "",
    finalitesTraitement: "",
    mesuresSecurite: "",
    dureeConservation: "",
    clauseDataBreach: "",
    dpaRequis: "", // oui / non
    
    // 9. Sous-traitance
    sousTraitanceAutorisee: "", // oui / non / avec_validation
    validationPrealable: "", // oui / non
    responsabilitePrestataire: "",
    
    // 10. Responsabilité
    plafondResponsabilite: "",
    exclusionsDommages: "",
    forceMajeure: "",
    responsabiliteNonConformite: "",
    montantCouverture: "",
    
    // 11. Résiliation
    resiliationPreavis: "",
    resiliationImmediate: "", // faute / non_paiement / non_respect
    effetsResiliation: "",
    
    // 12. Réversibilité
    restitutionDonnees: "",
    restitutionDocuments: "",
    continuationTransition: "",
    assistanceMigration: "",
    coutReversibilite: "",
    
    // 13. Litiges
    loiApplicable: "France",
    tribunalCompetent: "",
    mediationArbitrage: "", // oui / non
    clauseAmiable: "", // oui / non
    
    // 14. Clauses complémentaires essentielles
    dateEffetContrat: "", // Date d'entrée en vigueur
    independanceParties: "", // oui / non
    absenceSubordination: "", // oui / non
    liberteOrganisation: "", // oui / non
    exclusivite: "", // oui / non / non
    precisionExclusivite: "",
    nonDebauchage: "", // oui / non
    dureeNonDebauchage: "",
    penaliteNonDebauchage: "",
    modificationAvenant: "", // oui (par défaut)
    clauseTolerance: "", // oui (par défaut)
    clauseNullitePartielle: "", // oui (par défaut)
  });
  
  // États individuels pour Prestation de services
  const [prestationPrestataireKbisFiles, setPrestationPrestataireKbisFiles] = useState<File[]>([]);
  const [prestationPrestataireAssuranceFiles, setPrestationPrestataireAssuranceFiles] = useState<File[]>([]);
  const [prestationPrestataireAutresFiles, setPrestationPrestataireAutresFiles] = useState<File[]>([]);
  const [prestationClientKbisFiles, setPrestationClientKbisFiles] = useState<File[]>([]);
  const [prestationClientAutresFiles, setPrestationClientAutresFiles] = useState<File[]>([]);
  const [prestationCahierChargesFiles, setPrestationCahierChargesFiles] = useState<File[]>([]);
  const [prestationCGVFiles, setPrestationCGVFiles] = useState<File[]>([]);
  const [prestationRGPDFiles, setPrestationRGPDFiles] = useState<File[]>([]);
  const [prestationAutresAnnexesFiles, setPrestationAutresAnnexesFiles] = useState<File[]>([]);
  
  // States pour Contrat de vente B2B
  const [venteB2BData, setVenteB2BData] = useState({
    // 1. Identification Fournisseur/Vendeur
    fournisseurDenomination: "",
    fournisseurFormeJuridique: "",
    fournisseurCapital: "",
    fournisseurRCS: "",
    fournisseurSiegeSocial: "",
    fournisseurRepresentant: "",
    fournisseurEmail: "",
    fournisseurTelephone: "",
    fournisseurAssurancePro: "", // oui/non
    fournisseurNumeroAssurance: "",
    
    // Acheteur/Distributeur
    acheteurDenomination: "",
    acheteurFormeJuridique: "",
    acheteurRCS: "",
    acheteurAdresse: "",
    acheteurRepresentant: "",
    acheteurEmail: "",
    acheteurTelephone: "",
    acheteurZoneGeographique: "",
    acheteurStatutCommercial: "", // revendeur/agent/importateur/grossiste
    
    // 2. Objet du contrat
    natureProduits: "",
    categoriesProduits: "",
    perimetreDistribution: "", // vente_simple/distribution_generale/exclusive/selective/franchise
    obligationsMinimalesDistributeur: "",
    canauxVenteAutorises: "", // boutique/en_ligne/marketplace/export
    
    // 3A. Tarifs
    prixUnitaire: "",
    grilleTarifaire: "",
    remises: "",
    revisionsPrix: "",
    conditionsPreferentielles: "",
    
    // 3B. Commandes
    modalitesPassationCommande: "",
    minimumsCommande: "",
    delaisCommande: "",
    confirmationCommande: "", // automatique/manuelle
    conditionsAnnulation: "",
    
    // 3C. Livraison
    incoterms: "", // EXW/DDP/FCA/FOB
    transporteur: "",
    transfertRisques: "",
    delaisLivraison: "",
    penalitesRetardLivraison: "",
    modalitesReception: "",
    
    // 3D. Paiement
    modePaiement: "", // virement/prelevement/LCR
    delaisPaiement: "", // comptant/30j/60j
    acomptePaiement: "",
    penalitesRetardPaiement: "",
    indemniteLegaleRecouvrement: "",
    suspensionLivraisonImpaye: "", // oui/non
    
    // 4. Obligations fournisseur
    obligationConformite: true,
    respectNormesCertifications: true,
    garantieDisponibilite: true,
    assuranceQualite: true,
    remplacementDefectueux: true,
    formationDistributeur: "", // oui/non
    assistanceTechnique: "", // oui/non
    obligationInformation: true,
    
    // 5. Obligations acheteur/distributeur
    commercialisationImageMarque: true,
    respectPrixRecommandes: "", // oui/non
    promotionActive: true,
    stockMinimum: "",
    reportingMarche: true,
    respectNormesLocales: true,
    serviceClientRetours: true,
    formationPersonnel: "", // oui/non
    
    // 6. Exclusivité
    exclusiviteTerritoriale: "", // oui/non
    exclusivitePays: "",
    exclusiviteRegion: "",
    dureeExclusivite: "",
    volumeMinimalExclusivite: "",
    exclusiviteProduit: "", // oui/non
    objectifsVenteExclusivite: "",
    sanctionsEchecExclusivite: "",
    
    // 7. Distribution sélective
    distributionSelective: "", // oui/non
    criteresAgrement: "",
    exigencesPresentationProduits: "",
    qualiteMinimalePointVente: "",
    conditionsFormationPersonnel: "",
    interdictionReventeHorsReseau: "", // oui/non
    
    // 8. Propriété intellectuelle
    droitUtilisationMarque: "", // oui/non
    conditionsUtilisationLogos: "",
    interdictionModificationProduits: "", // oui/non
    proprietaireDocumentsMarketing: "", // fournisseur/acheteur
    interdictionDepotMarque: "", // oui/non
    clauseContreContrefacon: "",
    
    // 9. Garanties
    garantieLegaleConformite: true,
    garantieLegaleVicesCaches: true,
    garantieCommercialeDuree: "",
    garantieCommercialeEtendue: "",
    garantieCommercialeExclusions: "",
    conditionsRetour: "",
    procedureSAV: "",
    
    // 10. Responsabilité
    limitationResponsabiliteFournisseur: "",
    exclusionDommagesIndirects: "", // oui/non
    plafondIndemnitaire: "",
    casForceMajeure: "",
    responsabiliteDistributeurClients: "",
    
    // 11. Non-concurrence & Confidentialité
    interdictionProduitsConcurrents: "", // oui/non
    dureeNonConcurrence: "",
    sanctionsNonConcurrence: "",
    confidentialiteDuree: "",
    natureInformationsConfidentielles: "",
    
    // 12. Durée & Résiliation
    dureeContrat: "", // determinee/indeterminee
    dateEntreeVigueur: "", // Date d'entrée en vigueur
    dateDebutContrat: "",
    dateFinContrat: "",
    reconductionTacite: "", // oui/non
    preavisResiliation: "",
    resiliationImmediateMotifs: "",
    fautesGravesDefautPaiement: true,
    fautesGravesAtteintemarque: true,
    fautesGravesNonRespectExclusivite: true,
    fautesGravesViolationPI: true,
    effetsResiliation: "",
    indemniteFinContrat: "", // oui/non/exclusion
    montantIndemniteFinContrat: "",
    
    // Nouvelle section: Clauses spécifiques B2B
    reservePropriete: "", // oui/non
    reserveProprietePrecisions: "",
    nonSollicitationSalaries: "", // oui/non
    dureeNonSollicitation: "",
    penaliteNonSollicitation: "",
    cessionContratAutorisee: "", // oui/non
    cessionContratAccordPrealable: "", // oui/non
    clausesSurvieConfidentialite: true,
    clausesSurviePI: true,
    clausesSurvieResponsabilite: true,
    clausesSurvieNonConcurrence: true,
    
    // 13. Compliance
    loiApplicable: "France",
    tribunalCompetent: "",
    clauseMediation: "", // oui/non
    clauseAntiCorruption: "", // oui/non
    clauseRGPD: "", // oui/non
    clauseConformiteExportImport: "",
  });
  
  // États individuels pour Vente B2B
  const [venteB2BFournisseurKbisFiles, setVenteB2BFournisseurKbisFiles] = useState<File[]>([]);
  const [venteB2BFournisseurAssuranceFiles, setVenteB2BFournisseurAssuranceFiles] = useState<File[]>([]);
  const [venteB2BFournisseurFichesFiles, setVenteB2BFournisseurFichesFiles] = useState<File[]>([]);
  const [venteB2BDistributeurKbisFiles, setVenteB2BDistributeurKbisFiles] = useState<File[]>([]);
  const [venteB2BDistributeurAssuranceFiles, setVenteB2BDistributeurAssuranceFiles] = useState<File[]>([]);
  const [venteB2BCGVFiles, setVenteB2BCGVFiles] = useState<File[]>([]);
  const [venteB2BGrillesTarifairesFiles, setVenteB2BGrillesTarifairesFiles] = useState<File[]>([]);
  const [venteB2BAutresAnnexesFiles, setVenteB2BAutresAnnexesFiles] = useState<File[]>([]);
  
  // States pour Conditions Générales de Vente (CGV)
  const [cgvData, setCgvData] = useState({
    // 1. Identification du vendeur
    vendeurDenomination: "",
    vendeurFormeJuridique: "",
    vendeurCapitalSocial: "",
    vendeurAdresseSiege: "",
    vendeurSIREN: "",
    vendeurRCS: "",
    vendeurTVAIntracommunautaire: "",
    vendeurEmail: "",
    vendeurTelephone: "",
    vendeurResponsableLegal: "",
    vendeurProfessionReglementee: "", // oui/non
    vendeurPrecisionProfession: "",
    vendeurAssurancePro: "", // oui/non
    vendeurNumeroAssurance: "",
    
    // 2. Champ d'application
    typesProduitsServices: "",
    typesClients: [] as string[], // B2C, B2B, mixte
    canalVente: [] as string[], // e-commerce, physique, marketplace, contrat cadre
    canalAutrePrecision: "",
    
    // 3. Définitions (texte libre pour chaque)
    definitionProduit: "",
    definitionService: "",
    definitionClient: "",
    definitionCommande: "",
    definitionCompteUtilisateur: "",
    definitionLivraison: "",
    definitionAbonnement: "",
    definitionPrix: "",
    definitionForceMajeure: "",
    definitionContrat: "",
    
    // 4. Caractéristiques produits/services
    descriptionProduits: "",
    visuelsDisponibles: "", // oui/non
    specificationstechniques: "",
    disponibilites: "", // stock / sur devis / sur mesure
    restrictionsUsage: "",
    conditionsPrealables: "",
    
    // 5. Processus de commande
    creationCompteObligatoire: "", // oui/non
    etapesCommande: "",
    validationDoubleClick: true, // obligatoire e-commerce
    confirmationEmail: true,
    annulationAvantExpedition: "", // oui/non
    commandesSurDevis: "", // oui/non
    
    // 6. Prix
    prixAffichesTTC: "", // TTC/HT
    tvaApplicable: "",
    variationPrix: "",
    fraisSupplementaires: "",
    remisesReductions: "",
    devisDureeValidite: "",
    devisRevision: "",
    
    // 7. Conditions de paiement
    modesPaiement: [] as string[], // carte, virement, sepa, paypal, plusieurs fois
    paiementImmediatDiffere: "", // immediat/differe
    acompteArrhes: "", // acompte/arrhes/engagement
    montantAcompte: "",
    securisationPaiement: "",
    fraisPaiement: "",
    facturesElectroniques: "", // oui/non
    paiementB2BEcheance: "", // 30j/45j/60j
    penalitesRetardTaux: "",
    indemniteRecouvrementB2B: "40", // 40€ par défaut
    
    // 8. Livraison
    zonesLivrees: "",
    modeLivraison: "",
    delaisLivraison: "",
    fraisLivraison: "",
    transfertRisquesB2C: "reception", // réception par défaut
    transfertRisquesB2B: "transporteur", // remise transporteur par défaut
    retardsLivraison: "",
    casForceMajeureLivraison: "",
    
    // 9. Exécution du service (si prestation)
    calendrierService: "",
    etapesRealisation: "",
    obligationMoyensResultat: "", // moyens/resultat
    validationLivrables: "",
    reportAnnulationService: "",
    
    // 10. Droit de rétractation (B2C uniquement)
    droitRetractation14jours: true, // obligatoire B2C
    exceptionsRetractation: [] as string[], // sur mesure, numériques, services exécutés, etc.
    procedureRetractation: "",
    formulaireRetractation: true, // obligatoire
    remboursementDelais: "",
    remboursementMethode: "",
    
    // 11. Retours & Remboursements
    conditionsRetour: "",
    fraisRetour: "",
    etatProduits: "",
    delaisRetour: "",
    produitsNonConformes: "",
    sav: "",
    
    // 12. Garanties légales (obligatoire B2C)
    garantieLegaleConformite: true, // 2 ans
    garantieVicesCaches: true, // 2 ans après découverte
    garantieCommerciale: "", // oui/non
    garantieCommercialeDuree: "",
    garantieCommercialeConditions: "",
    
    // 13. Transfert de propriété & risques
    transfertPropriete: "paiement-complet", // paiement-complet/livraison
    reservePropriete: "", // oui/non
    transfertRisques: "",
    
    // 14. Responsabilité
    limitationResponsabilite: "",
    exclusionDommagesIndirects: "", // oui/non
    plafondIndemnisation: "",
    casForceMajeureResponsabilite: "",
    responsabiliteDefautInfo: "",
    
    // 15. Propriété intellectuelle
    marquesLogos: "",
    interdictionReproduction: true,
    licenceClient: "",
    contenusNumeriquesProteges: "",
    clauseContreContrefacon: "",
    
    // 16. Données personnelles / RGPD
    natureDonneesCollectees: "",
    finalites: "",
    responsableTraitement: "",
    dureeConservation: "",
    droitsPersonnes: "",
    transfertHorsUE: "", // oui/non
    traitementsLiesPaiement: "",
    cookiePolicy: "",
    
    // 17. Service client & Médiation
    contactServiceClient: "",
    procedureReclamation: "",
    serviceMediation: "", // obligatoire B2C
    coordonneesMediateur: "",
    
    // 18. Résiliation services / Abonnements
    dureeAbonnement: "",
    reconductionTacite: "", // oui/non + Loi Chatel
    procedureResiliation: "",
    preavisResiliation: "",
    restitutionDonnees: "",
    suppressionCompte: "",
    
    // 19. Loi applicable & Tribunal
    loiApplicable: "France",
    tribunalCompetent: "",
    clauseMediation: "", // oui/non
    clauseArbitrage: "", // oui/non si B2B
    
    // 20. Annexes
    formulaireRetractationAnnexe: true,
    politiqueConfidentialite: true,
    politiqueCookies: "", // oui/non
    grilleTarifaire: "", // oui/non
    descriptifTechnique: "", // oui/non
    procedureSAV: "", // oui/non
    noticeUtilisation: "", // oui/non
  });
  
  const [cgvVendeurFiles, setCgvVendeurFiles] = useState<File[]>([]); // Kbis, mentions légales, RC Pro
  const [cgvProduitsFiles, setCgvProduitsFiles] = useState<File[]>([]); // Certificats produits, fiches techniques
  
  // States pour CGV Annexes (7 annexes individuelles)
  const [cgvFormulaireRetractationFiles, setCgvFormulaireRetractationFiles] = useState<File[]>([]);
  const [cgvPolitiqueConfidentialiteFiles, setCgvPolitiqueConfidentialiteFiles] = useState<File[]>([]);
  const [cgvGrilleTarifaireFiles, setCgvGrilleTarifaireFiles] = useState<File[]>([]);
  const [cgvFichesTechniquesFiles, setCgvFichesTechniquesFiles] = useState<File[]>([]);
  const [cgvProcedureSAVFiles, setCgvProcedureSAVFiles] = useState<File[]>([]);
  const [cgvNoticesUtilisationFiles, setCgvNoticesUtilisationFiles] = useState<File[]>([]);
  const [cgvAutresFiles, setCgvAutresFiles] = useState<File[]>([]);
  
  // States pour CGU (Conditions Générales d'Utilisation)
  const [cguVendeurClientId, setCguVendeurClientId] = useState<string>("");
  const [cguData, setCguData] = useState({
    // 1. Identification éditeur
    editeurNom: "",
    editeurDenomination: "",
    editeurFormeJuridique: "",
    editeurCapitalSocial: "",
    editeurSiegeSocial: "",
    editeurSIREN: "",
    editeurRCS: "",
    editeurTVA: "",
    editeurDirecteurPublication: "",
    editeurEmail: "",
    editeurTelephone: "",
    hebergeurNom: "",
    hebergeurCoordonnees: "",
    secteurReglemente: "", // oui/non
    secteurReglementeAutorite: "",
    
    // 2. Objet des CGU
    serviceFourni: "",
    typePlateforme: [] as string[], // SaaS, App mobile, Marketplace, Réseau social, Service info, Plateforme échange
    limitesService: "",
    exclusionsExplicites: "",
    
    // 3. Définitions
    defUtilisateur: "",
    defCompteUtilisateur: "",
    defService: "",
    defContenu: "",
    defContenuUtilisateur: "",
    defDonneesPersonnelles: "",
    defPlateforme: "",
    defEspaceClient: "",
    defModeration: "",
    defForceMajeure: "",
    defAcceptationCGU: "",
    
    // 4. Accès au site / Compte utilisateur
    champsCreeCompteNom: false,
    champsCreeComptePrenom: false,
    champsCreeCompteEmail: false,
    champsCreeCompteTelephone: false,
    champsCreeCompteMotDePasse: false,
    champsCreeCompteEntreprise: false,
    verificationEmail: "", // oui/non
    verificationTelephone: "", // oui/non
    ageMinimum: "16", // 16 ou 18
    interdictionsAcces: "",
    exactitudeDonnees: "",
    confidentialiteMotDePasse: "",
    doubleAuthentification: "", // oui/non
    responsabiliteVolCompte: "",
    
    // 5. Fonctionnement du service
    fonctionnalitesDisponibles: "",
    limitationsService: "",
    prerequisTechniques: "",
    misesAJour: "",
    interruptionsService: "",
    evolutionsSansPreavis: "",
    
    // 6. Règles d'utilisation / Comportements interdits
    interdictionUsurpationIdentite: true,
    interdictionViolationLois: true,
    interdictionSpamPhishing: true,
    interdictionExploitationCommerciale: true,
    interdictionAccesNonAutorise: true,
    interdictionContournementProtections: true,
    contenuIllicite: true,
    contenuViolentHaineux: true,
    contenuPornographique: true,
    contenuDiffamatoire: true,
    violationDroitsAuteur: true,
    publiciteDissimulee: true,
    venteProduitsInterdits: true,
    reverseEngineering: true,
    scrapingIntensif: true,
    surutilisationService: true,
    automatisationNonAutorisee: true,
    autresInterdictions: "",
    
    // 7. Contenus utilisateurs (UGC)
    definitionContenuUGC: "",
    droitsConcedes: "",
    licenceUtilisation: "",
    droitsReproduction: "",
    dureeLicence: "",
    responsabiliteContenu: "",
    pouvoirSuppression: "",
    procedureSignalement: "",
    suspensionCompte: "",
    dsaSignalement: "",
    dsaTransparence: "",
    
    // 8. Propriété intellectuelle
    titulariteDroits: "",
    marquesLogosDesign: "",
    logicielsUtilises: "",
    interdictionReproductionPI: true,
    protectionCodePI: true,
    droitsClientContenu: "",
    
    // 9. Données personnelles / RGPD
    donneesIdentite: false,
    donneesContacts: false,
    donneesIdentifiants: false,
    donneesCookiesTracking: false,
    donneesNavigation: false,
    donneesUsage: false,
    finaliteFonctionnement: false,
    finaliteSecurite: false,
    finaliteStatistiques: false,
    finalitePublicite: false,
    finalitePreventionFraude: false,
    baseLegaleConsentement: false,
    baseLegaleContrat: false,
    baseLegaleInteretLegitime: false,
    dureeConservationRGPD: "",
    droitAcces: true,
    droitRectification: true,
    droitSuppression: true,
    droitOpposition: true,
    droitPortabilite: true,
    droitLimitation: true,
    sousTraitants: "",
    transfertHorsUERGPD: "", // oui/non
    transfertHorsUEPays: "",
    dpo: "",
    
    // 10. Cookies et traceurs
    cookiesNecessaires: true,
    cookiesStatistiques: false,
    cookiesPublicitaires: false,
    consentementCookies: true,
    conservationChoixCookies: "",
    lienPolitiqueCookies: "",
    
    // 11. Responsabilité
    engagementDisponibilite: "",
    engagementSecurite: "",
    engagementMaintenance: "",
    engagementRespectLois: "",
    exclusionUtilisationIncorrecte: true,
    exclusionPanneInternet: true,
    exclusionDommagesIndirects: true,
    exclusionPerteDonnees: true,
    exclusionIntrusionExterne: true,
    forceMajeureResponsabilite: "",
    
    // 12. Suspension / Suppression du compte
    suspensionNonRespectCGU: true,
    suspensionComportementsIllicites: true,
    suspensionUtilisationAbusive: true,
    suppressionDemandeUtilisateur: true,
    suppressionDecesUtilisateur: true,
    dureeSuspension: "",
    procedureRecours: "",
    
    // 13. Modification des CGU
    notificationModification: "", // oui/non
    dateEntreeVigueur: "",
    acceptationTaciteExpresse: "", // tacite/expresse
    archivageVersions: "", // oui/non
    
    // 14. Résiliation du service
    resiliationParUtilisateur: "",
    resiliationParPlateforme: "",
    effetsClotureCompte: "",
    effetsSuppressionDonnees: "",
    effetsRestitutionAcces: "",
    
    // 15. Litiges / Droit applicable
    droitApplicable: "France",
    tribunalCompetent: "",
    procedureAmiable: "", // oui/non
    clauseMediationLitiges: "", // oui/non
    
    // 15bis. Clause de hiérarchie des documents
    hierarchieDocuments: "",
    
    // 15ter. Clause de nullité partielle
    clauseNullitePartielle: "",
    
    // 15quater. Clause de preuve électronique
    clausePreuveElectronique: "",
    
    // 16. Annexes techniques
    annexePolitiqueConfidentialite: false,
    annexePolitiqueCookies: false,
    annexeCharteUtilisation: false,
    annexeDocumentationAPI: false,
    annexeReglesModeration: false,
    
    // 17. Pièces justificatives
    piecesMentionsLegales: false,
    piecesPolitiqueConfidentialite: false,
    piecesPolitiqueCookies: false,
    piecesConditionsCommerciales: false,
  });
  
  // États individuels pour chaque annexe/pièce CGU
  const [cguPolitiqueConfidentialiteFiles, setCguPolitiqueConfidentialiteFiles] = useState<File[]>([]);
  const [cguPolitiqueCookiesFiles, setCguPolitiqueCookiesFiles] = useState<File[]>([]);
  const [cguCharteUtilisationFiles, setCguCharteUtilisationFiles] = useState<File[]>([]);
  const [cguDocumentationAPIFiles, setCguDocumentationAPIFiles] = useState<File[]>([]);
  const [cguReglesModerationFiles, setCguReglesModerationFiles] = useState<File[]>([]);
  const [cguMentionsLegalesFiles, setCguMentionsLegalesFiles] = useState<File[]>([]);
  const [cguPolitiqueConfidentialite2Files, setCguPolitiqueConfidentialite2Files] = useState<File[]>([]);
  const [cguPolitiqueCookies2Files, setCguPolitiqueCookies2Files] = useState<File[]>([]);
  const [cguConditionsCommercialesFiles, setCguConditionsCommercialesFiles] = useState<File[]>([]);
  
  // States pour Contrat d'agence commerciale
  const [agenceClientId, setAgenceClientId] = useState<string>("");
  const [agenceData, setAgenceData] = useState({
    // 1. Identification mandant
    mandantDenomination: "",
    mandantFormeJuridique: "",
    mandantCapital: "",
    mandantRCS: "",
    mandantSIREN: "",
    mandantSiege: "",
    mandantRepresentant: "",
    mandantActivite: "",
    mandantEmail: "",
    mandantTelephone: "",
    
    // 1. Identification agent
    agentNomPrenom: "",
    agentDenomination: "",
    agentStatutJuridique: "",
    agentAdresse: "",
    agentRCS: "",
    agentSIREN: "",
    agentRSAC: "",
    agentRCPro: "", // oui/non
    agentNumeroRCPro: "",
    agentEmail: "",
    agentTelephone: "",
    agentEtranger: false,
    agentSousAgents: "", // oui/non
    
    // 2. Objet
    produits: "",
    marchesCibles: "",
    secteursGeographiques: "",
    clienteleVisee: "",
    cgvApplicables: "",
    
    // 3. Nature juridique
    rappelIntermediaireIndependant: true,
    rappelPasRisqueVente: true,
    rappelPasEncaissementSaufClause: true,
    rappelArticlesCodeCommerce: true,
    
    // 4. Mandat et pouvoirs
    pouvoirProspection: false,
    pouvoirPresentation: false,
    pouvoirNegociation: false,
    pouvoirConclusion: false,
    pouvoirSalons: false,
    pouvoirReporting: false,
    interdictionModifTarifs: true,
    interdictionRemises: true,
    interdictionClausesNonApprouvees: true,
    interdictionEncaissement: true,
    mandatExclusif: "", // exclusif/non exclusif
    possibiliteSousAgents: "", // oui/non
    
    // 5. Exclusivité
    exclusiviteZone: "",
    exclusiviteSecteur: "",
    exclusiviteGamme: "",
    exclusiviteMandantInterdictionConcurrent: "", // oui/non
    exclusiviteMandantInterdictionProduitsConcurrents: "", // oui/non
    objectifsMinimaux: "",
    
    // 6. Obligations agent
    obligationProspecter: "",
    obligationPromouvoir: "",
    obligationPolitiqueCommerciale: "",
    obligationInformer: "",
    obligationReportingFrequence: "",
    obligationConfidentialite: "",
    obligationNonConflit: "",
    obligationNonConcurrence: "",
    
    // 7. Obligations mandant
    obligationCatalogues: "",
    obligationInformerModifs: "",
    obligationSupportTechnique: "",
    obligationRespecterExclusivite: "",
    obligationPayerCommissions: "",
    obligationInformerOperations: "",
    
    // 8. Commissionnement
    commissionType: "", // pourcentage/fixe/degressif/progressif
    commissionPourcentage: "",
    commissionMontantFixe: "",
    commissionGammes: "",
    commissionVentesAgent: false,
    commissionVentesMandant: false,
    commissionRenouvellements: false,
    commissionAugmentations: false,
    commissionMomentDue: "", // conclusion/paiement/expedition
    commissionPeriodicite: "", // mensuelle/trimestrielle
    commissionDroitInformation: "",
    
    // 9. Non-concurrence
    nonConcurrenceAvant: "",
    nonConcurrenceApresDuree: "",
    nonConcurrenceApresZone: "",
    nonConcurrenceApresSecteur: "",
    nonConcurrenceCompensation: "",
    
    // 10. Responsabilité
    responsabiliteAgent: "",
    responsabiliteMandant: "",
    exclusionsResponsabilite: "",
    
    // 11. Confidentialité
    confidentialitePendant: "",
    confidentialiteApres: "",
    confidentialiteDonneesSensibles: "",
    
    // 12. Propriété intellectuelle
    piInterdictionMarques: true,
    piLicenceLimitee: "",
    piRestitutionMateriel: "",
    
    // 13. RGPD
    rgpdStatutAgent: "", // responsable/sous-traitant
    rgpdDonneesTraitees: "",
    rgpdFinalites: "",
    rgpdDurees: "",
    rgpdMesuresSecurite: "",
    rgpdDPO: "",
    
    // 14. Durée et résiliation
    dureeDeterminee: "", // oui/non
    dureeIndeterminee: "", // oui/non
    dureeReconduction: "", // oui/non
    resiliationPreavis1an: "1 mois",
    resiliationPreavis2ans: "2 mois",
    resiliationPreavis3ans: "3 mois et plus",
    resiliationImmediateFauteGrave: true,
    resiliationImmediateNonRespect: true,
    resiliationImmediateCessation: true,
    resiliationImmediateLiquidation: true,
    
    // 15. Indemnité légale
    indemniteMontant: "2 années de commissions",
    indemniteSaufFauteGrave: true,
    indemnitePaiementDelai: "",
    
    // 16. Annexes
    annexeTarifs: false,
    annexeCatalogue: false,
    annexePolitiqueCommerciale: false,
    annexeFichesTechniques: false,
    annexeReporting: false,
    annexeHistoriqueCommissions: false,
    annexeFormulaireRSAC: false,
    
    // 17. Pièces justificatives
    piecesMandantKbis: false,
    piecesMandantPolitique: false,
    piecesMandantCatalogue: false,
    piecesMandantTarifs: false,
    piecesAgentKbisRSAC: false,
    piecesAgentRCPro: false,
    piecesAgentIdentite: false,
  });
  
  // États individuels pour chaque pièce justificative - agence commerciale
  const [agenceMandantKbisFiles, setAgenceMandantKbisFiles] = useState<File[]>([]);
  const [agenceMandantPolitiqueFiles, setAgenceMandantPolitiqueFiles] = useState<File[]>([]);
  const [agenceMandantCatalogueFiles, setAgenceMandantCatalogueFiles] = useState<File[]>([]);
  const [agenceMandantTarifsFiles, setAgenceMandantTarifsFiles] = useState<File[]>([]);
  const [agenceAgentRSACFiles, setAgenceAgentRSACFiles] = useState<File[]>([]);
  const [agenceAgentRCProFiles, setAgenceAgentRCProFiles] = useState<File[]>([]);
  const [agenceAgentIdentiteFiles, setAgenceAgentIdentiteFiles] = useState<File[]>([]);
  const [agenceAnnexesFiles, setAgenceAnnexesFiles] = useState<File[]>([]);
  
  // States pour Contrat de franchise
  const [franchiseClientId, setFranchiseClientId] = useState<string>("");
  const [franchiseData, setFranchiseData] = useState({
    // 1. Franchiseur
    franchiseurDenomination: "",
    franchiseurFormeJuridique: "",
    franchiseurCapital: "",
    franchiseurRCS: "",
    franchiseurSIREN: "",
    franchiseurSiege: "",
    franchiseurRepresentant: "",
    franchiseurDescriptionReseau: "",
    franchiseurDateCreationMarque: "",
    franchiseurNombreFranchises: "",
    franchiseurAssurancePro: "",
    franchiseurEmail: "",
    franchiseurTelephone: "",
    
    // 1. Franchisé
    franchiseNom: "",
    franchiseFormeJuridique: "",
    franchiseAdresse: "",
    franchiseRCS: "",
    franchiseSIREN: "",
    franchiseActivitePrevue: "",
    franchiseRepresentant: "",
    franchiseSituationFinanciere: "",
    franchiseEmail: "",
    franchiseTelephone: "",
    
    // 2. DIP (Document d'Information Précontractuelle)
    dipRemis: "non", // oui/non
    dipDateRemise: "",
    dipDelai20jours: "oui",
    
    // 3. Objet du contrat
    conceptFranchise: "",
    typeActivite: "",
    savoirFaireSpecifique: "",
    droitMarque: "oui",
    droitEnseigne: "oui",
    droitConcept: "oui",
    droitLogiciels: "",
    droitMethodes: "",
    
    // 4. Droits accordés
    licenceMarque: "oui",
    licenceEnseigne: "oui",
    licenceSignes: "oui",
    manuelOperatoire: "oui",
    territoireExclusivite: "", // exclusif/non-exclusif
    zoneProtegee: "",
    approvisionnementObligatoire: "", // oui/non
    listeFournisseursAgrees: "",
    
    // 5. Obligations franchiseur
    formationInitialeDuree: "",
    formationInitialeContenu: "",
    formationContinue: "oui",
    assistanceOuverture: "oui",
    supportMarketing: "oui",
    accompagnementCommercial: "oui",
    campagnesNationales: "oui",
    campagnesLocales: "",
    protectionTerritoriale: "",
    
    // 6. Obligations franchisé
    respectConcept: "oui",
    respectManuel: "oui",
    respectNormes: "oui",
    achatProduits: "",
    utilisationMarque: "oui",
    participationFormations: "oui",
    participationReunions: "oui",
    comptabiliteSeparee: "oui",
    reportingRegulier: "oui",
    respectTerritoire: "oui",
    paiementRedevances: "oui",
    
    // 7. Redevances
    redevanceEntreeMontant: "",
    redevanceEntreePaiement: "", // une_fois/echelonne
    redevancePeriodique: "", // pourcentage/fixe/mixte
    redevancePourcentageCA: "",
    redevanceFixeMensuelle: "",
    redevanceMinimale: "",
    redevanceMarketing: "",
    redevanceMarketingType: "", // pourcentage/fixe
    paiementPeriodicite: "",
    
    // 8. Conditions financières annexes
    fondsRoulement: "",
    investissementsInitiaux: "",
    fraisAmenagement: "",
    stockInitial: "",
    coutLogiciel: "",
    
    // 9. Local commercial
    adresseLocal: "",
    statutLocal: "", // bail/propriete
    approbationFranchiseur: "oui",
    normesAgencement: "",
    travauxChargeFranchise: "",
    controleConformite: "oui",
    
    // 10. Marketing
    charteGraphique: "oui",
    supportsObligatoires: "oui",
    participationCampagnesLocales: "",
    interdictionSupportsNonValides: "oui",
    gestionReseauxSociaux: "",
    
    // 11. Savoir-faire
    existenceManuel: "oui",
    confidentialiteManuel: "oui",
    miseAJourManuel: "oui",
    retourManuelRupture: "oui",
    
    // 12. Propriété intellectuelle
    marquePropriete: "franchiseur",
    licenceLimitee: "oui",
    interdictionMarqueSimilaire: "oui",
    interdictionReproduction: "oui",
    restitutionPI: "oui",
    
    // 13. Confidentialité
    secretSavoirFaire: "oui",
    secretManuel: "oui",
    secretMethodes: "oui",
    confidentialiteApresContrat: "5 ans",
    
    // 14. Non-concurrence
    nonConcurrencePendant: "oui",
    nonConcurrenceApres: "oui",
    nonConcurrenceDuree: "1 an",
    nonConcurrenceZone: "",
    nonConcurrenceSecteur: "",
    
    // 15. Responsabilité
    responsabiliteFranchise: "oui",
    responsabiliteFranchiseurLimitee: "oui",
    exclusionsDommages: "oui",
    assuranceRCObligatoire: "oui",
    
    // 16. Durée
    dureeContrat: "",
    datePriseEffet: "",
    conditionsRenouvellement: "",
    
    // 17. Résiliation
    resiliationNonPaiement: "oui",
    resiliationDegradationImage: "oui",
    resiliationManquementGrave: "oui",
    resiliationNonRespectManuel: "oui",
    resiliationCondamnation: "oui",
    resiliationConflitInterets: "oui",
    resiliationPreavis: "",
    arrêtMarque: "immediat",
    restitutionManuel: "immediat",
    restitutionMateriel: "immediat",
    fermeturePointVente: "oui",
    
    // 18. Vente/Cession
    droitAgrementFranchiseur: "oui",
    conditionsReprise: "",
    formationRepreneur: "oui",
    redevanceCession: "",
    
    // 19. Droit applicable
    loiApplicable: "francaise",
    droitApplicable: "francais",
    droitApplicableAutre: "",
    droitModeResolution: "",
    droitJuridiction: "",
    droitAutres: "",
    tribunalCompetent: "",
    clauseMediation: "oui",
    clauseArbitrage: "",
    
    // 20-21. Divers
    observationsFinales: "",
  });
  
  // États individuels pour fichiers Franchise
  const [franchiseurKbisFiles, setFranchiseurKbisFiles] = useState<File[]>([]);
  const [franchiseurDocumentsFinanciersFiles, setFranchiseurDocumentsFinanciersFiles] = useState<File[]>([]);
  const [franchiseurDepotMarqueFiles, setFranchiseurDepotMarqueFiles] = useState<File[]>([]);
  const [franchiseDIPFiles, setFranchiseDIPFiles] = useState<File[]>([]);
  const [franchiseKbisFiles, setFranchiseKbisFiles] = useState<File[]>([]);
  const [franchiseIdentiteFiles, setFranchiseIdentiteFiles] = useState<File[]>([]);
  const [franchiseBusinessPlanFiles, setFranchiseBusinessPlanFiles] = useState<File[]>([]);
  const [franchiseCapaciteFinanciereFiles, setFranchiseCapaciteFinanciereFiles] = useState<File[]>([]);
  const [franchiseRCProFiles, setFranchiseRCProFiles] = useState<File[]>([]);
  const [franchiseManuelOperatoireFiles, setFranchiseManuelOperatoireFiles] = useState<File[]>([]);
  const [franchiseCharteGraphiqueFiles, setFranchiseCharteGraphiqueFiles] = useState<File[]>([]);
  const [franchisePlansAgencementFiles, setFranchisePlansAgencementFiles] = useState<File[]>([]);
  const [franchiseTarifsFiles, setFranchiseTarifsFiles] = useState<File[]>([]);
  const [franchiseAttestationFormationFiles, setFranchiseAttestationFormationFiles] = useState<File[]>([]);
  
  // States pour attestation de propriété immobilière
  const [attestationActeDecesFiles, setAttestationActeDecesFiles] = useState<File[]>([]);
  const [attestationIdentiteHeritiers, setAttestationIdentiteHeritiers] = useState<File[]>([]);
  const [attestationTitrePropriete, setAttestationTitrePropriete] = useState<File[]>([]);
  const [attestationLivretFamille, setAttestationLivretFamille] = useState<File[]>([]);
  const [attestationTestament, setAttestationTestament] = useState<File[]>([]);
  const [attestationContratMariage, setAttestationContratMariage] = useState<File[]>([]);
  const [attestationCopropriete, setAttestationCopropriete] = useState<File[]>([]);
  const [attestationBaux, setAttestationBaux] = useState<File[]>([]);
  const [attestationHypotheque, setAttestationHypotheque] = useState<File[]>([]);
  const [attestationJustifDomicile, setAttestationJustifDomicile] = useState<File[]>([]);
  const [bailCommercialDiagnosticsFiles, setBailCommercialDiagnosticsFiles] = useState<File[]>([]); // Diagnostics bail commercial
  const [bailCommercialCautionFiles, setBailCommercialCautionFiles] = useState<File[]>([]); // Acte de caution
  
  // ========== États pour pièces justificatives Bail Commercial / Professionnel ==========
  
  // Pièces justificatives Locataire (Preneur)
  const [bailCommercialLocataireKbisFiles, setBailCommercialLocataireKbisFiles] = useState<File[]>([]); // Kbis locataire
  const [bailCommercialLocataireStatutsFiles, setBailCommercialLocataireStatutsFiles] = useState<File[]>([]); // Statuts société locataire
  const [bailCommercialLocataireAssuranceRCFiles, setBailCommercialLocataireAssuranceRCFiles] = useState<File[]>([]); // Assurance RC locataire
  const [bailCommercialLocataireBilansFiles, setBailCommercialLocataireBilansFiles] = useState<File[]>([]); // Derniers bilans locataire
  
  // Pièces justificatives Bailleur
  const [bailCommercialBailleurTitreProprietFiles, setBailCommercialBailleurTitreProprietFiles] = useState<File[]>([]); // Titre de propriété bailleur
  const [bailCommercialBailleurKbisFiles, setBailCommercialBailleurKbisFiles] = useState<File[]>([]); // Kbis bailleur (si société)
  const [bailCommercialBailleurJustifIdentiteFiles, setBailCommercialBailleurJustifIdentiteFiles] = useState<File[]>([]); // Justificatif identité bailleur
  
  // Diagnostics obligatoires - Loi Pinel
  const [bailCommercialDiagnosticDPEFiles, setBailCommercialDiagnosticDPEFiles] = useState<File[]>([]); // DPE
  const [bailCommercialDiagnosticAmianteFiles, setBailCommercialDiagnosticAmianteFiles] = useState<File[]>([]); // Amiante
  const [bailCommercialDiagnosticERPFiles, setBailCommercialDiagnosticERPFiles] = useState<File[]>([]); // État des risques ERP
  const [bailCommercialDiagnosticElectriciteFiles, setBailCommercialDiagnosticElectriciteFiles] = useState<File[]>([]); // Diagnostic électricité
  const [bailCommercialDiagnosticGazFiles, setBailCommercialDiagnosticGazFiles] = useState<File[]>([]); // Diagnostic gaz
  const [bailCommercialDiagnosticLegionelleFiles, setBailCommercialDiagnosticLegionelleFiles] = useState<File[]>([]); // Légionelle (si ERP)
  const [bailCommercialDiagnosticAccessibiliteFiles, setBailCommercialDiagnosticAccessibiliteFiles] = useState<File[]>([]); // Accessibilité handicapés
  const [bailCommercialDiagnosticIncendieFiles, setBailCommercialDiagnosticIncendieFiles] = useState<File[]>([]); // Sécurité incendie
  const [bailCommercialDossierAmianteFiles, setBailCommercialDossierAmianteFiles] = useState<File[]>([]); // Dossier amiante parties privatives
  
  // Annexes obligatoires - Loi Pinel
  const [bailCommercialInventaireChargesFiles, setBailCommercialInventaireChargesFiles] = useState<File[]>([]); // Inventaire charges, impôts, taxes
  const [bailCommercialEtatTravauxPrevisionnels3AnsFiles, setBailCommercialEtatTravauxPrevisionnels3AnsFiles] = useState<File[]>([]); // État prévisionnel travaux 3 ans
  const [bailCommercialEtatTravauxPrevisionnels6AnsFiles, setBailCommercialEtatTravauxPrevisionnels6AnsFiles] = useState<File[]>([]); // État prévisionnel travaux 6 ans
  const [bailCommercialReleveCharges3AnsFiles, setBailCommercialReleveCharges3AnsFiles] = useState<File[]>([]); // Relevé charges 3 dernières années
  const [bailCommercialEtatTravauxRealises3AnsFiles, setBailCommercialEtatTravauxRealises3AnsFiles] = useState<File[]>([]); // État travaux réalisés 3 dernières années
  
  // States pour Quitus / Reconnaissance de dette
  const [quitusCreancierIdentiteFiles, setQuitusCreancierIdentiteFiles] = useState<File[]>([]);
  const [quitusDebiteurIdentiteFiles, setQuitusDebiteurIdentiteFiles] = useState<File[]>([]);
  const [quitusPreuveDetteFiles, setQuitusPreuveDetteFiles] = useState<File[]>([]);
  const [quitusPreuveTransfertFiles, setQuitusPreuveTransfertFiles] = useState<File[]>([]);
  const [quitusEcheancierFiles, setQuitusEcheancierFiles] = useState<File[]>([]);
  const [quitusCautionIdentiteFiles, setQuitusCautionIdentiteFiles] = useState<File[]>([]);
  const [quitusPreuvesPaiementsFiles, setQuitusPreuvesPaiementsFiles] = useState<File[]>([]);
  const [quitusAncienneDetteFiles, setQuitusAncienneDetteFiles] = useState<File[]>([]);
  const [quitusJustifDomicileCreancierFiles, setQuitusJustifDomicileCreancierFiles] = useState<File[]>([]);
  const [quitusJustifDomicileDebiteurFiles, setQuitusJustifDomicileDebiteurFiles] = useState<File[]>([]);
  const [procurationMandantIdentiteUrl, setProcurationMandantIdentiteUrl] = useState<string | null>(null); // URL du document du mandant procuration
  const [procurationMandataireIdentiteFile, setProcurationMandataireIdentiteFile] = useState<File | null>(null); // Fichier pièce d'identité mandataire
  const [mandatProtectionMandantIdentiteUrl, setMandatProtectionMandantIdentiteUrl] = useState<string | null>(null); // URL pièce d'identité mandant
  const [mandatProtectionMandataireIdentiteFile, setMandatProtectionMandataireIdentiteFile] = useState<File | null>(null); // Fichier pièce d'identité mandataire
  const [bailCommercialEtatLieuxFiles, setBailCommercialEtatLieuxFiles] = useState<File[]>([]); // État des lieux
  const [bailCommercialCautionIdFiles, setBailCommercialCautionIdFiles] = useState<File[]>([]); // Pièce d'identité caution
  const [bailCommercialAssuranceFiles, setBailCommercialAssuranceFiles] = useState<File[]>([]); // Attestation d'assurance
  const [bailProfessionnelOrdreFiles, setBailProfessionnelOrdreFiles] = useState<File[]>([]); // Attestation inscription ordre professionnel
  const [garantDocsFiles, setGarantDocsFiles] = useState<File[]>([]);
  const [bailDiagnosticsFiles, setBailDiagnosticsFiles] = useState<File[]>([]);
  
  // États pour le Contrat de Partenariat / Coopération
  const [partenariatClientId1, setPartenariatClientId1] = useState<string>("");
  const [partenariatClientId2, setPartenariatClientId2] = useState<string>("");
  const [partenariatData, setPartenariatData] = useState({
    // Partie 1
    partie1Nom: "",
    partie1FormeJuridique: "",
    partie1Capital: "",
    partie1Siege: "",
    partie1RCS: "",
    partie1RepresentantNom: "",
    partie1RepresentantFonction: "",
    partie1Coordonnees: "",
    partie1Secteur: "",
    partie1SiteWeb: "",
    partie1Assurance: "",
    
    // Partie 2
    partie2Nom: "",
    partie2FormeJuridique: "",
    partie2Capital: "",
    partie2Siege: "",
    partie2RCS: "",
    partie2RepresentantNom: "",
    partie2RepresentantFonction: "",
    partie2Coordonnees: "",
    partie2Secteur: "",
    partie2SiteWeb: "",
    partie2Assurance: "",
    
    // Objet du partenariat
    objetNature: [] as string[],
    objetFinalites: "",
    objetResultatsAttendus: "",
    objetLivrables: "",
    objetLimites: "",
    objetExclusions: "",
    
    // Rôles partie 1
    partie1Responsabilites: "",
    partie1Missions: "",
    partie1Taches: "",
    partie1RessourcesMises: "",
    partie1EngagementsOperationnels: "",
    partie1Delais: "",
    partie1Referent: "",
    
    // Rôles partie 2
    partie2Responsabilites: "",
    partie2Missions: "",
    partie2Taches: "",
    partie2RessourcesMises: "",
    partie2EngagementsOperationnels: "",
    partie2Delais: "",
    partie2Referent: "",
    
    // Gouvernance
    gouvernanceComitePilotage: "non",
    gouvernanceComposition: "",
    gouvernanceFrequence: "",
    gouvernanceDecisionsCommunes: "",
    gouvernanceProcessusDecisionnel: "",
    gouvernanceDroitVeto: "",
    gouvernanceRapports: "",
    gouvernanceKPI: "",
    gouvernanceRevues: "",
    
    // Contributions financières
    financeInvestissementPartie1: "",
    financeInvestissementPartie2: "",
    financeBudgetCommun: "",
    financeRepartitionCouts: "",
    financeFacturation: "",
    financeModalitesPaiement: "",
    financeFinancementExterne: "",
    financeRepartitionBenefices: "",
    financeAbsenceFlux: "non",
    
    // Partage ressources
    ressourcesPersonnel: "",
    ressourcesMateriel: "",
    ressourcesLicences: "",
    ressourcesBaseDonnees: "",
    ressourcesEspaceTravail: "",
    ressourcesConditionsUtilisation: "",
    ressourcesRestrictions: "",
    
    // Durée
    dureeDeterminee: "oui",
    dureeDebut: "",
    dureeFin: "",
    dureeReconduction: "non",
    dureeEvaluationIntermediaire: "",
    
    // Confidentialité
    confidentialiteDefinition: "",
    confidentialiteDuree: "5",
    confidentialiteExceptions: "",
    confidentialiteMesuresSecurite: "",
    confidentialiteConsequences: "",
    
    // Propriété intellectuelle
    piAnterieure: "",
    piAnterieureRegime: "",
    piCreeRegime: "",
    piCreeProprietaire: "",
    piCreeExploitation: "",
    piCreeProtection: "",
    piDocumentsTitularite: "",
    piDocumentsRestrictions: "",
    
    // RGPD
    rgpdApplicable: "non",
    rgpdRoleParties: "",
    rgpdBaseLegale: "",
    rgpdResponsable: "",
    rgpdSousTraitant: "",
    rgpdFinalites: "",
    rgpdConservation: "",
    rgpdSortDonneesFin: "",
    rgpdMesuresSecurite: "",
    rgpdTransfertHorsUE: "non",
    rgpdDPA: "non",
    
    // Communication
    communicationUsageLogos: "",
    communicationCommuniques: "",
    communicationReseauxSociaux: "",
    communicationConfidentialiteChiffres: "",
    communicationProcessusValidation: "",
    
    // Exclusivité
    exclusiviteApplicable: "non",
    exclusiviteZone: "",
    exclusiviteSecteur: "",
    exclusiviteDuree: "",
    exclusiviteEngagementsMin: "",
    
    // Responsabilité
    responsabiliteContractuelle: "",
    responsabiliteRetard: "",
    responsabiliteDommagesIndirects: "exclus",
    responsabiliteExclusionPertesIndirectes: true,
    responsabilitePlafond: "",
    responsabiliteAssuranceObligatoire: "non",
    responsabiliteAssuranceSpecifique: "",
    
    // Modifications
    modificationsAmendementsAutorise: "oui",
    modificationsProcedure: "",
    modificationsSignature: "oui",
    
    // Résiliation
    resiliationPreavisDuree: "60",
    resiliationPreavisCondition: "",
    resiliationImmediateCauses: "",
    resiliationEffetsRestitution: "",
    resiliationEffetsMateriel: "",
    resiliationEffetsDroitsUsage: "",
    resiliationEffetsRapport: "",
    resiliationEffetsDestruction: "",
    
    // Litiges
    litigesLoiApplicable: "francaise",
    litigesLoiAutre: "",
    litigesTribunal: "",
    litigesMediation: "oui",
    litigesArbitrage: "non",
    
    // Clauses générales
    clauseIndependanceParties: true,
    clauseNonCreationSociete: true,
    clauseForceMajeureDefinition: "",
    clauseForceMajeureSuspension: "",
    clauseForceMajeureResiliation: "",
    clauseCessionInterdite: true,
    clauseCessionConditions: "",
    clauseNullitePartielle: true,
    clauseIntegraliteAccord: true,
    
    // Annexes / Observations
    annexesDescriptions: "",
    observationsFinales: "",
  });
  
  // États individuels pour fichiers Partenariat
  const [partenariat1KbisFiles, setPartenariat1KbisFiles] = useState<File[]>([]);
  const [partenariat1IdentiteFiles, setPartenariat1IdentiteFiles] = useState<File[]>([]);
  const [partenariat1StatutsFiles, setPartenariat1StatutsFiles] = useState<File[]>([]);
  const [partenariat1PouvoirFiles, setPartenariat1PouvoirFiles] = useState<File[]>([]);
  const [partenariat1AssuranceFiles, setPartenariat1AssuranceFiles] = useState<File[]>([]);
  const [partenariat2KbisFiles, setPartenariat2KbisFiles] = useState<File[]>([]);
  const [partenariat2IdentiteFiles, setPartenariat2IdentiteFiles] = useState<File[]>([]);
  const [partenariat2StatutsFiles, setPartenariat2StatutsFiles] = useState<File[]>([]);
  const [partenariat2PouvoirFiles, setPartenariat2PouvoirFiles] = useState<File[]>([]);
  const [partenariat2AssuranceFiles, setPartenariat2AssuranceFiles] = useState<File[]>([]);
  const [partenariatCahierChargesFiles, setPartenariatCahierChargesFiles] = useState<File[]>([]);
  const [partenariatPlanningFiles, setPartenariatPlanningFiles] = useState<File[]>([]);
  const [partenariatBudgetFiles, setPartenariatBudgetFiles] = useState<File[]>([]);
  const [partenariatCharteGraphiqueFiles, setPartenariatCharteGraphiqueFiles] = useState<File[]>([]);
  const [partenariatProtocoleRGPDFiles, setPartenariatProtocoleRGPDFiles] = useState<File[]>([]);
  const [partenariatDescriptionTechniqueFiles, setPartenariatDescriptionTechniqueFiles] = useState<File[]>([]);
  const [partenariatPlanMarketingFiles, setPartenariatPlanMarketingFiles] = useState<File[]>([]);
  const [partenariatContratLicenceFiles, setPartenariatContratLicenceFiles] = useState<File[]>([]);
  const [partenariatConditionsFinancieresFiles, setPartenariatConditionsFinancieresFiles] = useState<File[]>([]);
  const [partenariatProtocoleReversibiliteFiles, setPartenariatProtocoleReversibiliteFiles] = useState<File[]>([]);
  
  // States pour contrat de sous-traitance
  const [sousTraitanceClientId1, setSousTraitanceClientId1] = useState<string>("");
  const [sousTraitanceClientId2, setSousTraitanceClientId2] = useState<string>("");
  const [sousTraitanceData, setSousTraitanceData] = useState({
    // Donneur d'ordre
    donneurNom: "",
    donneurFormeJuridique: "",
    donneurCapital: "",
    donneurRCS: "",
    donneurSiege: "",
    donneurRepresentant: "",
    donneurActivite: "",
    donneurAssurance: "",
    
    // Sous-traitant
    sousTraitantNom: "",
    sousTraitantStatut: "",
    sousTraitantRCS: "",
    sousTraitantSiege: "",
    sousTraitantRepresentant: "",
    sousTraitantActivite: "",
    sousTraitantAssurance: "",
    sousTraitantCertification: "",
    
    // Objet
    missionNature: "",
    missionPerimetre: "",
    missionInclusions: "",
    missionExclusions: "",
    missionLivrables: "",
    missionRessources: "",
    
    // Obligations sous-traitant
    obligationExecution: true,
    obligationDelais: true,
    obligationNormes: true,
    obligationMoyens: true,
    obligationConseil: "non",
    obligationCollaboration: true,
    obligationType: "moyens", // moyens ou résultat
    continuitéService: "non",
    continuitéRemplacement: "",
    continuitéPCA: "",
    sousTraitanceCascadeInterdite: true,
    conflitsInteretsInterdits: true,
    concurrenceInterdite: "non",
    
    // Obligations donneur d'ordre
    donneurFournitInfos: true,
    donneurAcces: "",
    donneurValidation: true,
    donneurPaiement: true,
    donneurCollaboration: true,
    
    // SLA
    slaApplicable: "non",
    slaTempsReponse: "",
    slaDisponibilite: "",
    slaTauxErreur: "",
    slaDelais: "",
    slaCriteres: "",
    slaPenalites: "",
    
    // Prix
    prixType: "fixe", // fixe, horaire, forfait
    prixMontant: "",
    prixTauxHoraire: "",
    prixFacturation: "mensuelle", // mensuelle, mission, étapes
    prixRevision: "non",
    prixRevisionIndexation: "",
    prixFraisAnnexes: "",
    prixRemboursements: "",
    prixDelaisPaiement: "30",
    prixPenalitesRetard: "applicable",
    prixPrimePerformance: "non",
    prixPrimeConditions: "",
    prixRetenueGarantie: "non",
    prixRetenuePercentage: "",
    prixAcomptes: "non",
    prixAcomptesDetails: "",
    
    // Délais
    delaiDebut: "",
    delaiFin: "",
    delaiType: "déterminé", // déterminé ou continu
    delaiPlanning: "",
    delaiJalons: "",
    delaiReportConditions: "",
    
    // Confidentialité
    confidentialiteDefinition: "",
    confidentialiteDuree: "5",
    confidentialiteInterdictionUtilisation: true,
    confidentialiteObligationsSecurite: "",
    confidentialiteRetourDonnees: "destruction",
    
    // Propriété intellectuelle
    piCreation: "non",
    piInterdictionUtilisation: true,
    piTitularite: "donneur", // donneur, licence, copropriété
    piCessionDuree: "",
    piCessionTerritoire: "",
    piCessionExploitation: "",
    piDroitMoral: "",
    
    // RGPD
    rgpdApplicable: "non",
    rgpdContratIntegre: "non",
    rgpdCategories: "",
    rgpdFinalites: "",
    rgpdDuree: "",
    rgpdSecurite: "",
    rgpdNotification: true,
    rgpdLocalisation: "",
    rgpdSousTraitantsUlterieurs: "interdits",
    rgpdCoresponsables: "non",
    rgpdAccordRepartition: "",
    
    // Sécurité et conformité
    securiteSystemes: "",
    securiteAcces: "",
    securiteCyber: "",
    securiteChiffrement: "non",
    conformiteLegale: "",
    
    // Vérification et audits
    auditAutorise: "oui",
    auditFrequence: "",
    auditDocumentation: true,
    auditCorrections: true,
    
    // Responsabilité
    responsabiliteFaute: "",
    responsabilitePlafond: "",
    responsabiliteExclusionIndirects: true,
    responsabiliteAssuranceObligatoire: "oui",
    responsabiliteForceMajeure: "",
    
    // Résiliation
    resiliationPreavis: "60",
    resiliationSansMotif: "non",
    resiliationImmediateFaute: true,
    resiliationImmediateRetard: true,
    resiliationImmediateRGPD: true,
    resiliationImmediateQualite: true,
    resiliationImmediateImpayes: true,
    resiliationEffetRestitution: true,
    resiliationEffetLivrables: true,
    resiliationEffetPaiement: true,
    resiliationEffetAcces: true,
    
    // Non-sollicitation personnel
    nonSollicitationApplicable: "oui",
    nonSollicitationDuree: "24",
    nonSollicitationPenalite: "",
    
    // Non-concurrence
    nonConcurrenceApplicable: "non",
    nonConcurrenceZone: "",
    nonConcurrenceDuree: "",
    nonConcurrenceSecteur: "",
    
    // Sous-traitance en cascade
    cascadeAutorisee: "validation", // autorisée, interdite, validation
    cascadeResponsabilite: "",
    cascadeResponsabilitePleineEntiere: true,
    cascadeSousTraitantsMemesObligations: true,
    
    // Clauses générales essentielles
    clauseIndependanceParties: true,
    clauseAbsenceSubordination: "",
    clauseLiberteOrganisation: "",
    clauseAucunPouvoirRepresentation: "",
    clauseNonCreationSociete: true,
    clauseNonGIE: true,
    clauseNonMandatImplicite: true,
    clauseCessionInterdite: true,
    clauseCessionConditions: "",
    clauseContinuiteService: "",
    clauseReversibiliteTransfert: "",
    clauseReversibiliteAssistance: "non",
    
    // Propriété intellectuelle renforcée
    piLivrablesProtectables: "oui",
    piCessionLivrables: "cession", // cession ou licence
    piEtendueGeographique: "monde",
    piEtendueDuree: "illimité",
    piEtendueSupports: "tous",
    piDroitsAdaptation: true,
    piDroitsModification: true,
    
    // RGPD renforcé
    rgpdQualification: "", // responsable ou sous-traitant
    rgpdInstructionsDocumentees: "",
    rgpdSortDonneesFinContrat: "",
    
    // Responsabilité renforcée
    responsabiliteExclusionPerteCA: true,
    responsabiliteExclusionPerteChance: true,
    
    // Notifications
    notificationAdresse: "",
    notificationEmail: "",
    notificationRecommande: "oui",
    
    // Litiges
    loiApplicable: "française",
    tribunalCompetent: "",
    mediationClause: "non",
    arbitrage: "non",
    
    // Annexes
    annexesDescriptions: "",
  });
  
  // File states pour sous-traitance
  const [sousTraitanceDonneurKbisFiles, setSousTraitanceDonneurKbisFiles] = useState<File[]>([]);
  const [sousTraitanceDonneurConditionsTechniquesFiles, setSousTraitanceDonneurConditionsTechniquesFiles] = useState<File[]>([]);
  const [sousTraitanceSousTraitantKbisFiles, setSousTraitanceSousTraitantKbisFiles] = useState<File[]>([]);
  const [sousTraitanceSousTraitantRCProFiles, setSousTraitanceSousTraitantRCProFiles] = useState<File[]>([]);
  const [sousTraitanceSousTraitantURSSAFFiles, setSousTraitanceSousTraitantURSSAFFiles] = useState<File[]>([]);
  const [sousTraitanceSousTraitantCertificationsFiles, setSousTraitanceSousTraitantCertificationsFiles] = useState<File[]>([]);
  const [sousTraitanceCahierChargesFiles, setSousTraitanceCahierChargesFiles] = useState<File[]>([]);
  const [sousTraitancePlanningFiles, setSousTraitancePlanningFiles] = useState<File[]>([]);
  const [sousTraitanceSLAFiles, setSousTraitanceSLAFiles] = useState<File[]>([]);
  const [sousTraitanceBudgetFiles, setSousTraitanceBudgetFiles] = useState<File[]>([]);
  const [sousTraitanceDPAFiles, setSousTraitanceDPAFiles] = useState<File[]>([]);
  const [sousTraitanceDocTechniqueFiles, setSousTraitanceDocTechniqueFiles] = useState<File[]>([]);
  const [sousTraitanceCharteSecuriteFiles, setSousTraitanceCharteSecuriteFiles] = useState<File[]>([]);
  
  // States pour NDA (Accord de confidentialité)
  const [ndaClientId1, setNdaClientId1] = useState<string>("none");
  const [ndaClientId2, setNdaClientId2] = useState<string>("none");
  const [ndaData, setNdaData] = useState({
    // Type de NDA
    typeNda: "bilateral", // bilateral ou unilateral
    partieEmettrice: "", // si unilatéral
    
    // Partie 1
    partie1Nom: "",
    partie1FormeJuridique: "",
    partie1Capital: "",
    partie1RCS: "",
    partie1Siege: "",
    partie1Representant: "",
    partie1Email: "",
    partie1Telephone: "",
    partie1Pays: "France",
    
    // Partie 2
    partie2Nom: "",
    partie2FormeJuridique: "",
    partie2Capital: "",
    partie2RCS: "",
    partie2Siege: "",
    partie2Representant: "",
    partie2Email: "",
    partie2Telephone: "",
    partie2Pays: "France",
    
    // Objet du NDA
    projetConcerne: "",
    butEchanges: "",
    limitesNda: "",
    dureeProjet: "",
    typeProjet: "", // développement technologique, négociations commerciales, etc.
    
    // Définition information confidentielle
    documentsEcrits: true,
    informationsOrales: true,
    echangesElectroniques: true,
    maquettesPrototypes: true,
    donneesCommerciales: true,
    donneesFinancieres: true,
    donneesRH: false,
    secretsIndustriels: true,
    plansAffaires: true,
    codeSource: false,
    basesDonnees: false,
    infoNonMarqueeConfidentielle: true,
    
    // Exclusions
    informationsPubliques: true,
    informationsConnues: true,
    informationsTiers: true,
    informationsDeveloppees: true,
    informationsPubliquesApres: true,
    
    // Obligations principales
    utilisationProjetUniquement: true,
    nonDivulgationTiers: true,
    protectionDocuments: true,
    restitutionDestruction: true,
    limitationCopies: true,
    interdictionReverseEngineering: true,
    interdictionExtractionDonnees: true,
    
    // Obligations sécurité
    stockageSecurise: true,
    controleAcces: true,
    needToKnow: true,
    cryptageRecommande: false,
    
    // Sous-traitance
    sousTraitantsAutorises: "non", // oui, non, validation
    obligationNdaSousTraitants: true,
    
    // Durée
    dureeContrat: "", // ex: 12 mois
    dureeConfidentialite: "", // ex: 5 ans
    confidentialiteIllimitee: false,
    
    // Propriété intellectuelle
    proprieteDivulgateur: true,
    aucuneLicenceImplicite: true,
    interdictionCopie: true,
    proprieteDeveloppementsUlterieurs: "divulgateur", // divulgateur, recepteur, copropriete
    retourDocuments: true,
    
    // RGPD
    rgpdApplicable: "non",
    rgpdBaseLegale: "",
    rgpdDureeConservation: "",
    rgpdObligations: "",
    rgpdTransfertHorsUE: "interdit",
    rgpdNotificationFuite: true,
    rgpdDPA: false,
    
    // Responsabilité
    obligationPrudence: true,
    responsabiliteDivulgation: true,
    exclusionDommagesIndirects: false,
    penalitesViolation: "",
    plafondResponsabilite: "",
    exceptionDemandeLegale: true,
    
    // Restitution/Destruction
    retourDocumentsFin: true,
    destructionCopies: true,
    certificationDestruction: true,
    suppressionDonneesElectroniques: true,
    desactivationAcces: true,
    
    // Interdictions complémentaires
    interdictionProspection: false,
    interdictionContourner: false,
    interdictionContactClients: false,
    interdictionConcurrence: false,
    
    // Débauchage
    interdictionDebauchage: false,
    dureeInterdictionDebauchage: "12",
    penaliteDebauchage: "",
    
    // Litiges
    droitApplicable: "français",
    tribunalCompetent: "",
    mediationPrealable: "non",
    arbitrage: "non",
    
    // Variations spéciales
    contexteSpecial: "", // M&A, technique, RH, industriel, international
    langueContrat: "français",
    
    // Annexes
    annexesDescriptions: "",
  });
  
  // File states pour NDA
  const [ndaPartie1KbisFiles, setNdaPartie1KbisFiles] = useState<File[]>([]);
  const [ndaPartie1IdentiteFiles, setNdaPartie1IdentiteFiles] = useState<File[]>([]);
  const [ndaPartie1PouvoirFiles, setNdaPartie1PouvoirFiles] = useState<File[]>([]);
  const [ndaPartie1OrganigrammeFiles, setNdaPartie1OrganigrammeFiles] = useState<File[]>([]);
  const [ndaPartie2KbisFiles, setNdaPartie2KbisFiles] = useState<File[]>([]);
  const [ndaPartie2IdentiteFiles, setNdaPartie2IdentiteFiles] = useState<File[]>([]);
  const [ndaPartie2PouvoirFiles, setNdaPartie2PouvoirFiles] = useState<File[]>([]);
  const [ndaPartie2OrganigrammeFiles, setNdaPartie2OrganigrammeFiles] = useState<File[]>([]);
  const [ndaListeInfosDivulgueesFiles, setNdaListeInfosDivulgueesFiles] = useState<File[]>([]);
  const [ndaSchemasTechniquesFiles, setNdaSchemasTechniquesFiles] = useState<File[]>([]);
  const [ndaCahierChargesFiles, setNdaCahierChargesFiles] = useState<File[]>([]);
  const [ndaDocumentRGPDFiles, setNdaDocumentRGPDFiles] = useState<File[]>([]);
  const [ndaCharteSecuriteFiles, setNdaCharteSecuriteFiles] = useState<File[]>([]);
  
  // States pour Cession de marque / PI
  const [cessionPiClientIdCedant, setCessionPiClientIdCedant] = useState<string>("none");
  const [cessionPiClientIdCessionnaire, setCessionPiClientIdCessionnaire] = useState<string>("none");
  const [cessionPiData, setCessionPiData] = useState({
    // Type de cession
    typeCession: "marque", // marque, brevet, dessin_modele, droit_auteur, logiciel, nom_domaine, savoir_faire, base_donnees, autre
    
    // CÉDANT (propriétaire actuel)
    cedantNom: "",
    cedantFormeJuridique: "",
    cedantCapital: "",
    cedantRCS: "",
    cedantSiege: "",
    cedantRepresentant: "",
    cedantEmail: "",
    cedantTelephone: "",
    cedantPays: "France",
    
    // CESSIONNAIRE (acquéreur)
    cessionnaireNom: "",
    cessionnaireFormeJuridique: "",
    cessionnaireCapital: "",
    cessionnaireRCS: "",
    cessionnaireSiege: "",
    cessionnaireRepresentant: "",
    cessionnaireEmail: "",
    cessionnaireTelephone: "",
    cessionnairePays: "France",
    
    // IDENTIFICATION DU DROIT CÉDÉ
    // Pour MARQUE
    marqueNom: "",
    marqueNumeroDepot: "",
    marqueDateDepot: "",
    marqueClasses: "",
    marqueOrganismeEnregistrement: "INPI",
    marqueRenouvellementEcheance: "",
    marqueEtendue: "nationale", // nationale, europeenne, internationale
    marquePays: "",
    
    // Pour BREVET
    brevetTitre: "",
    brevetNumero: "",
    brevetDateDepot: "",
    brevetDateDelivrance: "",
    brevetOrganisme: "INPI",
    brevetDureeProtection: "",
    brevetRevendications: "",
    brevetEtendue: "nationale",
    
    // Pour DESSIN/MODÈLE
    dessinsModeleDescription: "",
    dessinsModeleNumero: "",
    dessinsModeleDateDepot: "",
    dessinsModeleOrganisme: "INPI",
    dessinsModeleDureeProtection: "",
    
    // Pour DROIT D'AUTEUR
    auteurOeuvreDescription: "",
    auteurOeuvreNature: "", // littéraire, artistique, logiciel, etc.
    auteurDateCreation: "",
    auteurPreuvesAnteriorite: "",
    auteurDroitsMoraux: "non_cedes", // non_cedes, cedes_limite, cedes_complet
    
    // Pour LOGICIEL
    logicielNom: "",
    logicielVersion: "",
    logicielLanguages: "",
    logicielCodeSource: "inclus", // inclus, exclu
    logicielDocumentation: "incluse",
    logicielDroitsMoraux: "conserves",
    
    // Pour NOM DE DOMAINE
    nomDomaine: "",
    nomDomaineExtension: "",
    nomDomaineRegistrar: "",
    nomDomaineDateExpiration: "",
    
    // Pour SAVOIR-FAIRE
    savoirFaireDescription: "",
    savoirFaireNature: "", // technique, commercial, industriel
    savoirFaireConfidentiel: true,
    savoirFaireDocumente: true,
    
    // Pour BASE DE DONNÉES
    baseDonneesNom: "",
    baseDonneesContenu: "",
    baseDonneesStructure: "",
    baseDonneesRGPD: "non_applicable",
    
    // NATURE DE LA CESSION
    natureCession: "totale", // totale, partielle
    cessionExclusive: true,
    territoireCession: "mondial", // mondial, france, UE, liste_pays
    territoirePaysListe: "",
    secteurActiviteLimite: "non", // non, oui
    secteurActiviteDescription: "",
    droitsCedes: {
      exploitation: true,
      reproduction: true,
      representation: true,
      adaptation: true,
      traduction: true,
      distribution: true,
      modification: true,
      sousLicence: false,
      cessionTiers: false,
    },
    
    // EFFET DE LA CESSION (optionnel)
    dateEffetCession: "signature", // signature, enregistrement, date_specifique
    dateEffetCessionSpecifique: "",
    
    // PRIX ET MODALITÉS DE PAIEMENT
    prixCession: "",
    prixDevise: "EUR",
    modalitePaiement: "comptant", // comptant, echelonne, royalties, mixte
    echelonnementDescription: "",
    royaltiesTaux: "",
    royaltiesBase: "",
    royaltiesDuree: "",
    royaltiesMinimum: "",
    royaltiesComptabilite: false,
    paiementDateLimite: "",
    paiementModalites: "", // virement, chèque, séquestre
    
    // GARANTIES DU CÉDANT
    garantieTitulaire: true,
    garantieLibreCharges: true,
    garantieNonContrefacon: true,
    garantieValidite: true,
    garantieExploitabilite: true,
    garantieAucunLitige: true,
    garantieConnaissanceAnterioritesConnues: true,
    garantieEviction: true, // garantie contre revendication d'un tiers
    garantieDuree: "permanente", // permanente, limitee
    garantieDureeLimitee: "",
    
    // OBLIGATIONS POST-CESSION
    obligationTransfertDocuments: true,
    obligationFormationCessionnaire: "non",
    obligationFormationDuree: "",
    obligationAssistanceTechnique: "non",
    obligationAssistanceDuree: "",
    obligationNonConcurrence: "non",
    obligationNonConcurrenceDuree: "",
    obligationNonConcurrenceTerritoire: "",
    obligationNonConcurrenceSecteur: "",
    obligationConfidentialite: true,
    obligationConfidentialiteDuree: "",
    
    // FORMALITÉS D'ENREGISTREMENT
    enregistrementNecessaire: true,
    enregistrementOrganisme: "", // INPI, EUIPO, OMPI, etc.
    enregistrementFrais: "cessionnaire", // cedant, cessionnaire, partages
    enregistrementDelai: "",
    
    // PROPRIÉTÉ INTELLECTUELLE ANTÉRIEURE
    piAnterieureLicencesExistantes: "non",
    piAnterieureDescription: "",
    piAnterieureEffetsSurCession: "",
    
    // RESPONSABILITÉ ET GARANTIES
    responsabilitePlafond: "",
    responsabiliteExclusionDommagesIndirects: false,
    responsabiliteAssuranceObligatoire: "non",
    
    // CONDITIONS SUSPENSIVES
    conditionsSuspensives: "non",
    conditionsSuspensivesDescription: "",
    conditionsSuspensivesDateLimite: "",
    
    // DURÉE ET RÉSILIATION
    dureeProtection: "", // durée restante du droit
    resiliationPossible: "non",
    resiliationMotifs: "",
    resiliationPreavis: "",
    resiliationConsequences: "",
    
    // LITIGES
    droitApplicable: "français",
    tribunalCompetent: "",
    mediationPrealable: "non",
    arbitrage: "non",
    
    // ANNEXES
    annexesDescriptions: "",
  });
  
  // File states pour Cession PI
  const [cessionPiCedantKbisFiles, setCessionPiCedantKbisFiles] = useState<File[]>([]);
  const [cessionPiCedantIdentiteFiles, setCessionPiCedantIdentiteFiles] = useState<File[]>([]);
  const [cessionPiCedantPouvoirFiles, setCessionPiCedantPouvoirFiles] = useState<File[]>([]);
  const [cessionPiCessionnaireKbisFiles, setCessionPiCessionnaireKbisFiles] = useState<File[]>([]);
  const [cessionPiCessionnaireIdentiteFiles, setCessionPiCessionnaireIdentiteFiles] = useState<File[]>([]);
  const [cessionPiCessionnairePouvoirFiles, setCessionPiCessionnairePouvoirFiles] = useState<File[]>([]);
  const [cessionPiCertificatEnregistrementFiles, setCessionPiCertificatEnregistrementFiles] = useState<File[]>([]);
  const [cessionPiPreuvesAnterioriteFiles, setCessionPiPreuvesAnterioriteFiles] = useState<File[]>([]);
  const [cessionPiDocumentsTechniquesFiles, setCessionPiDocumentsTechniquesFiles] = useState<File[]>([]);
  const [cessionPiCodeSourceFiles, setCessionPiCodeSourceFiles] = useState<File[]>([]);
  const [cessionPiDocumentationFiles, setCessionPiDocumentationFiles] = useState<File[]>([]);
  const [cessionPiLicencesExistantesFiles, setCessionPiLicencesExistantesFiles] = useState<File[]>([]);
  const [cessionPiRapportValuationFiles, setCessionPiRapportValuationFiles] = useState<File[]>([]);
  const [cessionPiAnnexesFiles, setCessionPiAnnexesFiles] = useState<File[]>([]);
  
  // States pour Contrat de travail (CDD/CDI)
  const [contratTravailClientIdEmployeur, setContratTravailClientIdEmployeur] = useState<string>("none");
  const [contratTravailClientIdSalarie, setContratTravailClientIdSalarie] = useState<string>("none");
  const [contratTravailData, setContratTravailData] = useState({
    // TYPE DE CONTRAT
    typeContrat: "CDI", // CDI, CDD
    
    // EMPLOYEUR
    employeurRaisonSociale: "",
    employeurFormeJuridique: "",
    employeurSiret: "",
    employeurCodeNAF: "",
    employeurSiege: "",
    employeurEtablissement: "", // si différent du siège
    employeurRepresentant: "",
    employeurFonction: "",
    employeurTelephone: "",
    employeurEmail: "",
    employeurNumeroUrssaf: "",
    employeurConventionCollective: "",
    employeurIdccNumero: "",
    
    // SALARIÉ
    salarieNom: "",
    salariePrenom: "",
    salarieDateNaissance: "",
    salarieLieuNaissance: "",
    salarieNationalite: "",
    salarieNumeroSecuSociale: "",
    salarieAdresse: "",
    salarieVille: "",
    salarieCodePostal: "",
    salarieTelephone: "",
    salarieEmail: "",
    salarieSituationFamiliale: "",
    salarieNombreEnfants: "",
    
    // POSTE ET FONCTIONS
    posteIntitule: "",
    posteClassification: "", // selon convention collective
    posteCoefficient: "",
    posteCategorie: "employé", // employé, agent_maitrise, cadre
    postePosition: "",
    posteFonctions: "", // description détaillée
    posteLieuTravail: "",
    posteLieuTravailMobilite: "non", // oui, non
    posteMobiliteDescription: "",
    
    // DURÉE DU CONTRAT
    // Pour CDI
    cdiDateEmbauche: "",
    cdiPeriodeEssai: "oui", // oui, non
    cdiPeriodeEssaiDuree: "2", // en mois
    cdiPeriodeEssaiRenouvellement: "non",
    cdiPeriodeEssaiRenouvellementDuree: "",
    
    // Pour CDD
    cddMotifRecours: "", // remplacement, accroissement_activite, travaux_saisonniers, usage, attente_cdi, autre
    cddMotifPrecisions: "",
    cddMotifAbsence: "", // pour motif remplacement
    cddTypeTerme: "precis", // precis, imprecis
    cddDateDebut: "",
    cddDateFin: "",
    cddDuree: "", // si terme imprécis
    cddDureeMax: "", // durée max si terme imprécis
    cddRenouvellement: "non",
    cddRenouvellementNombre: "",
    cddRenouvellementDureeMax: "",
    cddRenouvellementModalites: "",
    cddPeriodeEssai: "non",
    cddPeriodeEssaiDuree: "",
    cddIndemniteFinContrat: "10%", // 10%, exoneration
    cddIndemniteExonerationMotif: "", // saisonnier, usage, refus_cdi, contrat_aide, jeune_vacances
    cddDelaiCarence: "non", // oui, non
    cddDelaiCarencePrecisions: "",
    
    // TEMPS DE TRAVAIL
    tempsTravailType: "temps_plein", // temps_plein, temps_partiel
    tempsTravailDureeHebdo: "35", // heures
    tempsTravailRepartition: "", // lundi-vendredi 9h-17h, etc.
    tempsTravailHorairesVariables: "non",
    tempsTravailHorairesDescription: "",
    tempsTravailTeletravail: "non",
    tempsTravailTeletravailJours: "",
    tempsTravailHeuresSup: "possible", // possible, interdit, obligatoire
    tempsTravailHeuresSupMajorations: "",
    
    // RÉMUNÉRATION
    remunerationBruteMensuelle: "",
    remunerationBruteAnnuelle: "",
    remunerationMinimumConventionnel: "",
    remunerationPrimes: "non",
    remunerationPrimesDescription: "",
    remunerationVariables: "non",
    remunerationVariablesDescription: "",
    remunerationAvantagesNature: "non",
    remunerationAvantagesDescription: "", // véhicule, logement, etc.
    remunerationTicketsRestaurant: "non",
    remunerationTicketsRestaurantMontant: "",
    remunerationMutuelle: "oui",
    remunerationMutuelleDescription: "",
    remunerationPrevoyance: "oui",
    remunerationPrevoyanceDescription: "",
    remunerationRetraiteComplementaire: "oui",
    remunerationModalitePaiement: "virement", // virement, chèque
    remunerationDatePaiement: "", // ex: dernier jour du mois
    
    // CONGÉS
    congesPayes: "oui",
    congesPayesDuree: "30", // jours ouvrables / an (5 semaines)
    congesPayesAcquisition: "1er juin au 31 mai",
    congesRTT: "non",
    congesRTTNombre: "",
    congesAnciennete: "non",
    congesAncienneteDescription: "",
    congesSpeciaux: "", // mariage, décès, déménagement
    
    // CLAUSE DE CONFIDENTIALITÉ
    clauseConfidentialite: "oui",
    clauseConfidentialiteDuree: "pendant et après le contrat",
    clauseConfidentialiteDescription: "",
    
    // CLAUSE DE NON-CONCURRENCE
    clauseNonConcurrence: "non",
    clauseNonConcurrenceDuree: "", // mois après fin contrat
    clauseNonConcurrenceTerritoire: "",
    clauseNonConcurrenceActivites: "",
    clauseNonConcurrenceContrepartieFinanciere: "",
    clauseNonConcurrenceContrepartieMontant: "",
    
    // CLAUSE D'EXCLUSIVITÉ
    clauseExclusivite: "oui",
    clauseExclusiviteExceptions: "",
    
    // PROPRIÉTÉ INTELLECTUELLE
    proprietéIntellectuelle: "employeur", // employeur, salarie, partage
    proprietéIntellectuelleDescription: "",
    
    // FORMATION
    formationObligatoire: "non",
    formationDescription: "",
    formationDuree: "",
    formationClauseDedit: "non",
    formationClauseDuree: "", // engagement de rester X mois
    formationClauseMontant: "",
    
    // PROTECTION SOCIALE
    protectionRegimeGeneral: "oui",
    protectionCaisseRetraite: "",
    protectionOrganismePrevoyance: "",
    protectionMutuelle: "",
    
    // RUPTURE DU CONTRAT
    // CDI
    rupturePreaviscdi: "", // selon ancienneté et convention
    ruptureIndemnites: "selon convention collective",
    ruptureModalites: "",
    
    // CDD
    ruptureAnticipeePossible: "non", // faute grave, accord mutuel, force majeure
    ruptureAnticipeeConditions: "",
    ruptureIndemniteFinContrat: "oui", // 10% de la rémunération brute totale
    ruptureIndemnitePrecaire: "oui",
    
    // DIVERS
    diversAutresClausesDescription: "",
    diversMentionsLegales: "Convention collective applicable, visite médicale d'embauche, règlement intérieur",
    
    // DOCUMENTS ET ANNEXES
    annexesFichesPoste: "",
    annexesReglement: "",
    annexesAutres: "",
  });
  
  // File states pour Contrat de travail
  const [contratTravailEmployeurKbisFiles, setContratTravailEmployeurKbisFiles] = useState<File[]>([]);
  const [contratTravailEmployeurIdccFiles, setContratTravailEmployeurIdccFiles] = useState<File[]>([]);
  const [contratTravailSalarieIdentiteFiles, setContratTravailSalarieIdentiteFiles] = useState<File[]>([]);
  const [contratTravailSalarieSecuFiles, setContratTravailSalarieSecuFiles] = useState<File[]>([]);
  const [contratTravailSalarieVitaleFiles, setContratTravailSalarieVitaleFiles] = useState<File[]>([]);
  const [contratTravailSalarieRIBFiles, setContratTravailSalarieRIBFiles] = useState<File[]>([]);
  const [contratTravailSalarieDiplomesFiles, setContratTravailSalarieDiplomesFiles] = useState<File[]>([]);
  const [contratTravailSalarieCVFiles, setContratTravailSalarieCVFiles] = useState<File[]>([]);
  const [contratTravailFichePosteFiles, setContratTravailFichePosteFiles] = useState<File[]>([]);
  const [contratTravailReglementInterieurFiles, setContratTravailReglementInterieurFiles] = useState<File[]>([]);
  const [contratTravailAnnexesFiles, setContratTravailAnnexesFiles] = useState<File[]>([]);
  
  // States pour Convention de stage
  const [conventionStageClientIdStagiaire, setConventionStageClientIdStagiaire] = useState<string>("none");
  const [conventionStageClientIdEntreprise, setConventionStageClientIdEntreprise] = useState<string>("none");
  const [conventionStageData, setConventionStageData] = useState({
    // 1️⃣ IDENTIFICATION DES PARTIES
    // A. Établissement d'enseignement
    etablissementNom: "",
    etablissementAdresse: "",
    etablissementCodePostal: "",
    etablissementVille: "",
    etablissementRepresentant: "",
    etablissementCachet: "",
    etablissementSiret: "",
    etablissementDepartement: "", // UFR / Pôle
    etablissementResponsablePedagogique: "",
    etablissementResponsableFonction: "",
    etablissementResponsableEmail: "",
    etablissementResponsableTelephone: "",
    
    // B. Stagiaire
    stagiaireNom: "",
    stagiairePrenom: "",
    stagiaireDateNaissance: "",
    stagiaireLieuNaissance: "",
    stagiaireAdresse: "",
    stagiaireCodePostal: "",
    stagiaireVille: "",
    stagiaireEmail: "",
    stagiaireTelephone: "",
    stagiaireNationalite: "",
    stagiaireNumeroEtudiant: "",
    stagiaireFiliere: "", // diplôme préparé
    stagiaireNiveauEtudes: "", // L1, L2, L3, M1, M2, Doctorat
    stagiaireAnneeUniversitaire: "", // ex: 2024-2025
    stagiaireAssuranceRC: "", // nom assurance + numéro police
    stagiaireAssuranceRCNumero: "",
    stagiaireAssuranceScolaire: "", // optionnelle
    stagiaireAssuranceScolaireNumero: "",
    
    // C. Organisme d'accueil (entreprise)
    entrepriseDenomination: "",
    entrepriseFormeJuridique: "",
    entrepriseSiege: "",
    entrepriseSiegeCodePostal: "",
    entrepriseSiegeVille: "",
    entrepriseLieuStage: "", // si différent
    entrepriseLieuStageCodePostal: "",
    entrepriseLieuStageVille: "",
    entrepriseSiren: "",
    entrepriseRCS: "",
    entrepriseRepresentant: "",
    entrepriseRepresentantFonction: "",
    entrepriseServiceAccueil: "",
    entrepriseTuteurNom: "",
    entrepriseTuteurFonction: "",
    entrepriseTuteurEmail: "",
    entrepriseTuteurTelephone: "",
    entrepriseTaille: "", // effectif
    entrepriseConventionCollective: "",
    
    // 2️⃣ OBJET DU STAGE
    stageType: "obligatoire", // obligatoire, optionnel, insertion_professionnelle, etranger
    stageFinalites: "", // finalités pédagogiques
    stageObjectifsCompetences: "", // objectifs d'acquisition
    stageMissionsDetaillees: "", // IMPORTANT: description détaillée
    stageInteretPedagogique: "",
    stagePositionService: "", // position du stagiaire dans le service
    
    // 3️⃣ DURÉE DU STAGE
    stageDateDebut: "",
    stageDateFin: "",
    stageNombreSemaines: "",
    stageNombreHeuresTotal: "",
    stageProlongationPossible: "non",
    stageInterruptions: "", // vacances, examens
    stageVolumeHebdomadaire: "35", // heures/semaine
    stageTempsPartiel: "non",
    
    // 4️⃣ HORAIRES & ORGANISATION
    stageHorairesJournaliers: "", // ex: 9h-17h
    stageHorairesHebdomadaires: "", // ex: lundi-vendredi
    stagePauses: "", // ex: 1h déjeuner
    stageRythmeParticulier: "", // ex: soirée
    stageTeletravail: "non",
    stageDeplacementsPro: "non",
    stageDeplacementsPriseEnCharge: "",
    
    // 5️⃣ GRATIFICATION / INDEMNISATION
    stageGratification: "oui", // oui si >= 44 jours (308h)
    stageGratificationMontantHoraire: "4.35", // minimum légal 2024
    stageGratificationModalite: "mensuelle", // mensuelle, fin_stage, prorata
    stageTicketsRestaurant: "non",
    stagePriseEnChargeTransport: "50%", // minimum légal
    stageIndemnitesDeplacement: "non",
    stageAvantagesNature: "",
    
    // 6️⃣ ENCADREMENT PÉDAGOGIQUE
    // Tuteur pédagogique (école)
    tuteurPedagogiqueNom: "",
    tuteurPedagogiqueFonction: "",
    tuteurPedagogiqueEmail: "",
    tuteurPedagogiqueTelephone: "",
    tuteurPedagogiqueModalitesSuivi: "",
    
    // Tuteur professionnel (entreprise) - déjà dans section C
    tuteurProfessionnelMissions: "", // accueil, supervision, évaluation
    
    // 7️⃣ ASSURANCES
    // A. Assurance du stagiaire (déjà dans section B)
    stagiaireAssuranceMaladie: "", // France ou étranger
    stagiaireAccidentTravail: "etablissement", // etablissement, entreprise
    
    // B. Assurance organisme d'accueil
    entrepriseAssuranceRCPro: "",
    entrepriseAssuranceRCProNumero: "",
    entrepriseAssuranceCouvertureRisques: "",
    
    // C. Assurance à l'étranger
    stageAssuranceRapatriement: "",
    stageAssuranceSanteInternationale: "",
    
    // 8️⃣ AVANTAGES, RÈGLES & MOYENS
    stageAccesLocaux: "oui",
    stageAccesOutils: "oui",
    stageAccesMateriel: "oui",
    stageReglementInterieurRemis: "oui",
    stageCharteInformatique: "oui",
    stageCharteCybersecurite: "oui",
    stageCharteHarcelement: "oui",
    stageCharteConfidentialite: "oui",
    stageEquipementsSecurite: "",
    
    // 9️⃣ CONFIDENTIALITÉ & PROPRIÉTÉ INTELLECTUELLE
    stageObligationNonDivulgation: "oui",
    stageConfidentialiteDuree: "5", // années après fin stage
    stageRestrictionsDocuments: "oui",
    stageProprietéIntellectuelle: "entreprise", // entreprise, stagiaire, partage
    stageExploitationPersonnelle: "interdite",
    
    // 🔟 DROITS DU STAGIAIRE
    stageDroitRespectTemps: "oui",
    stageDroitPause: "oui",
    stageDroitGratification: "oui",
    stageDroitValidationPedagogique: "oui",
    stageDroitEnvironnementSain: "oui",
    stageDroitRetrait: "oui",
    
    // 1️⃣1️⃣ OBLIGATIONS DU STAGIAIRE
    stageObligationReglement: "oui",
    stageObligationHoraires: "oui",
    stageObligationDiscretion: "oui",
    stageObligationSecurite: "oui",
    stageObligationCompteRendu: "oui",
    stageObligationParticipation: "oui",
    
    // 1️⃣2️⃣ CONGÉS & ABSENCES
    stageAbsencesAutorisees: "", // examens, obligations académiques
    stageAbsencesExceptionnelles: "", // famille, maladie
    stageJustificatifsRequis: "oui",
    stageImpactGratification: "prorata",
    stagePossibiliteRecuperation: "oui",
    
    // 1️⃣3️⃣ ACCIDENT DU TRAVAIL
    stageAccidentDeclaration: "etablissement", // etablissement, entreprise
    stageAccidentInformations: "",
    stageAccidentResponsabiliteEntreprise: "",
    stageAccidentResponsabiliteTuteur: "",
    
    // 1️⃣4️⃣ RUPTURE ANTICIPÉE
    stageRuptureStagiaire: "possible",
    stageRuptureEntreprise: "possible",
    stageRuptureEtablissement: "possible",
    stageRuptureMotifs: "", // faute grave, inaptitude, santé, non-respect missions, cessation activité
    stageRuptureProcedure: "entretien tripartite + notification écrite",
    stageRuptureFormalites: "",
    
    // 1️⃣5️⃣ ÉVALUATION, RAPPORT & CERTIFICAT
    stageEvaluationModalites: "",
    stageEvaluationCompetences: "",
    stageEvaluationGrille: "",
    stageRapportObligatoire: "oui",
    stageSuiviEtablissement: "",
    stageAttestationRemise: "oui", // OBLIGATOIRE
    
    // 1️⃣6️⃣ DROIT APPLICABLE & JURIDICTION
    stageDroitApplicable: "français",
    stageTribunalCompetent: "",
    stageMediation: "non",
    
    // 1️⃣7️⃣ ANNEXES
    stageAnnexesFicheMissions: "",
    stageAnnexesCharteInfo: "",
    stageAnnexesReglement: "",
    stageAnnexesPlanning: "",
    stageAnnexesGrilleEvaluation: "",
    stageAnnexesEngagementConfidentialite: "",
  });
  
  // File states pour Convention de stage
  const [conventionStageStagiaireCarteEtudianteFiles, setConventionStageStagiaireCarteEtudianteFiles] = useState<File[]>([]);
  const [conventionStageStagiaireAssuranceRCFiles, setConventionStageStagiaireAssuranceRCFiles] = useState<File[]>([]);
  const [conventionStageStagiaireRIBFiles, setConventionStageStagiaireRIBFiles] = useState<File[]>([]);
  const [conventionStageEtablissementAffiliationSecu, setConventionStageEtablissementAffiliationSecu] = useState<File[]>([]);
  const [conventionStageEtablissementJustificatifPedago, setConventionStageEtablissementJustificatifPedago] = useState<File[]>([]);
  const [conventionStageEntrepriseKbisFiles, setConventionStageEntrepriseKbisFiles] = useState<File[]>([]);
  const [conventionStageEntrepriseAssuranceRCProFiles, setConventionStageEntrepriseAssuranceRCProFiles] = useState<File[]>([]);
  const [conventionStageFicheMissionsFiles, setConventionStageFicheMissionsFiles] = useState<File[]>([]);
  const [conventionStageCharteInformatiqueFiles, setConventionStageCharteInformatiqueFiles] = useState<File[]>([]);
  const [conventionStageReglementInterieurFiles, setConventionStageReglementInterieurFiles] = useState<File[]>([]);
  const [conventionStagePlanningFiles, setConventionStagePlanningFiles] = useState<File[]>([]);
  const [conventionStageGrilleEvaluationFiles, setConventionStageGrilleEvaluationFiles] = useState<File[]>([]);
  const [conventionStageEngagementConfidentialiteFiles, setConventionStageEngagementConfidentialiteFiles] = useState<File[]>([]);
  const [conventionStageAnnexesFiles, setConventionStageAnnexesFiles] = useState<File[]>([]);
  
  // States pour Rupture conventionnelle
  const [ruptureConventionnelleClientIdEmployeur, setRuptureConventionnelleClientIdEmployeur] = useState('');
  const [ruptureConventionnelleClientIdSalarie, setRuptureConventionnelleClientIdSalarie] = useState('');
  const [ruptureConventionnelleData, setRuptureConventionnelleData] = useState({
    // 1️⃣ IDENTIFICATION - Employeur
    employeurDenomination: '',
    employeurFormeJuridique: '',
    employeurAdresseSiege: '',
    employeurAdresseTravail: '',
    employeurSiret: '',
    employeurCodeAPE: '',
    employeurRepresentantNom: '',
    employeurRepresentantFonction: '',
    employeurConventionCollective: '',
    employeurEffectif: '',
    // 1️⃣ IDENTIFICATION - Salarié
    salariNom: '',
    salariPrenom: '',
    salariAdresse: '',
    salariDateNaissance: '',
    salariNumSecu: '',
    salariPoste: '',
    salariCategorie: '',
    salariDateEntree: '',
    salariTypeContrat: 'CDI',
    salariTempsPartiel: 'non',
    // 2️⃣ VÉRIFICATIONS LÉGALES
    verificationCDI: 'oui',
    verificationAccidentTravail: 'non',
    verificationArretMaladie: 'non',
    verificationConflitGrave: 'non',
    verificationAlerte: '',
    // 3️⃣ DATE DE L'ENTRETIEN
    entretienDate: '',
    entretienLieu: '',
    entretienPersonnesPresentes: '',
    entretienAssistanceSalarie: 'non',
    entretienAssistanceSalarieNom: '',
    entretienAssistanceEmployeur: 'non',
    entretienAssistanceEmployeurNom: '',
    // 4️⃣ TYPE DE RUPTURE
    typeRupture: 'simple',
    // 5️⃣ INDEMNITÉ
    indemniteCalculAuto: 'oui',
    indemniteSalaireRef3Mois: '',
    indemniteSalaireRef12Mois: '',
    indemniteAnciennete: '',
    indemniteLegaleCalculee: '',
    indemniteSupraLegale: 'non',
    indemniteMontantPropose: '',
    indemniteCotisationsSociales: 'non',
    indemniteModalitesPaiement: '',
    // 6️⃣ DATES
    dateSignature: '',
    dateRuptureEffective: '',
    // 7️⃣ CALENDRIER (calculé automatiquement)
    dateFinRetractation: '',
    dateEnvoiDREETS: '',
    dateFinHomologation: '',
    // 8️⃣ DROITS DU SALARIÉ
    droitChomage: 'oui',
    droitSoldeToutCompte: 'oui',
    droitCongesPayes: 'oui',
    droitCertificatTravail: 'oui',
    droitAttestationPoleEmploi: 'oui',
    droitRecuSolde: 'oui',
    droitBulletinsPaie: 'oui',
    // 9️⃣ CONFIDENTIALITÉ
    confidentialiteMotifs: 'oui',
    confidentialiteFinanciere: 'oui',
    confidentialiteReciprocité: 'oui',
    // 🔟 CLAUSES OPTIONNELLES
    clauseNonConcurrence: 'non',
    clauseNonConcurrenceMaintenue: '',
    clauseNonConcurrenceIndemnite: '',
    clauseConfidentialiteRenforcee: 'non',
    clauseConfidentialiteDuree: '',
    clauseNonDenigrement: 'non',
    // 1️⃣1️⃣ CAS PARTICULIERS
    casParticulierEnceinte: 'non',
    casParticulierProtege: 'non',
    casParticulierProtegeType: '',
    casParticulierInaptitude: 'non',
    casParticulierEtranger: 'non',
    casParticulierAlerte: '',
    // 1️⃣2️⃣ FORMALISATION
    consentementLibre: 'oui',
    absencePression: 'oui',
    modalitesRetractation: '',
    signatureElectronique: 'non',
    // 1️⃣3️⃣ DREETS
    dreetsCoordonnees: '',
    dreetsTransmissionElectronique: 'oui',
    // 1️⃣4️⃣ DOCUMENTS ANNEXES
    documentsNotes: '',
  });

  // File states pour Rupture conventionnelle
  const [ruptureConvEmployeurKbisFiles, setRuptureConvEmployeurKbisFiles] = useState<File[]>([]);
  const [ruptureConvEmployeurJustifRepresentantFiles, setRuptureConvEmployeurJustifRepresentantFiles] = useState<File[]>([]);
  const [ruptureConvSalariePieceIdentiteFiles, setRuptureConvSalariePieceIdentiteFiles] = useState<File[]>([]);
  const [ruptureConvSalarieRIBFiles, setRuptureConvSalarieRIBFiles] = useState<File[]>([]);
  const [ruptureConvFichePosteFiles, setRuptureConvFichePosteFiles] = useState<File[]>([]);
  const [ruptureConvContratTravailFiles, setRuptureConvContratTravailFiles] = useState<File[]>([]);
  const [ruptureConvBulletinsSalaireFiles, setRuptureConvBulletinsSalaireFiles] = useState<File[]>([]);
  const [ruptureConvCalculIndemniteFiles, setRuptureConvCalculIndemniteFiles] = useState<File[]>([]);
  const [ruptureConvAnnexesFiles, setRuptureConvAnnexesFiles] = useState<File[]>([]);
  
  // States pour convention d'indivision
  const [indivisairesIdentiteUrls, setIndivisairesIdentiteUrls] = useState<Record<number, string | null>>({}); // URLs des documents identité indivisaires clients
  const [indivisairesIdentiteFiles, setIndivisairesIdentiteFiles] = useState<Record<number, File[]>>({}); // Fichiers identité indivisaires non-clients
  const [indivisairesDomicileFiles, setIndivisairesDomicileFiles] = useState<Record<number, File[]>>({}); // Justificatifs domicile
  const [indivisairesContratMariageFiles, setIndivisairesContratMariageFiles] = useState<Record<number, File[]>>({}); // Contrats de mariage
  const [indivisairesLivretFamilleFiles, setIndivisairesLivretFamilleFiles] = useState<Record<number, File[]>>({}); // Livrets de famille
  const [indivisionTitreProprietFiles, setIndivisionTitreProprietFiles] = useState<File[]>([]); // Titre de propriété
  const [indivisionEvaluationFiles, setIndivisionEvaluationFiles] = useState<File[]>([]); // Évaluation/estimation
  const [indivisionCadastreFiles, setIndivisionCadastreFiles] = useState<File[]>([]); // Relevé cadastral
  const [indivisionDiagnosticsFiles, setIndivisionDiagnosticsFiles] = useState<File[]>([]); // Diagnostics
  const [indivisionBailFiles, setIndivisionBailFiles] = useState<File[]>([]); // Bail si bien loué
  const [indivisionProcurationFiles, setIndivisionProcurationFiles] = useState<File[]>([]); // Procurations
  const [indivisionMandatGerantFiles, setIndivisionMandatGerantFiles] = useState<File[]>([]); // Mandat du gérant
  const [indivisionAssuranceFiles, setIndivisionAssuranceFiles] = useState<File[]>([]); // Attestation d'assurance
  
  // States pour mainlevée d'hypothèque
  const [mainleveeCreancierMandatFiles, setMainleveeCreancierMandatFiles] = useState<File[]>([]); // Mandat représentant
  const [mainleveeCreancierKbisFiles, setMainleveeCreancierKbisFiles] = useState<File[]>([]); // KBIS
  const [mainleveeCreancierDelegationFiles, setMainleveeCreancierDelegationFiles] = useState<File[]>([]); // Délégation de pouvoir
  const [mainleveeCreancierIdentiteFiles, setMainleveeCreancierIdentiteFiles] = useState<File[]>([]); // Identité représentant
  const [mainleveeDebiteursIdentiteFiles, setMainleveeDebiteursIdentiteFiles] = useState<Record<number, File[]>>({}); // Identités débiteurs
  const [mainleveeDebiteursJustifDomicileFiles, setMainleveeDebiteursJustifDomicileFiles] = useState<Record<number, File[]>>({}); // Justif domicile
  const [mainleveeActeConstitutifFiles, setMainleveeActeConstitutifFiles] = useState<File[]>([]); // Acte constitutif
  const [mainleveeInscriptionHypothequeFiles, setMainleveeInscriptionHypothequeFiles] = useState<File[]>([]); // Inscription hypothécaire
  const [mainleveeAttestationRemboursementFiles, setMainleveeAttestationRemboursementFiles] = useState<File[]>([]); // Attestation remboursement
  
  // States pour contrat de mariage
  const [contratMariageEpoux1IdentiteFiles, setContratMariageEpoux1IdentiteFiles] = useState<File[]>([]); // Identité époux 1
  const [contratMariageEpoux2IdentiteFiles, setContratMariageEpoux2IdentiteFiles] = useState<File[]>([]); // Identité époux 2
  const [contratMariageEpoux1ActeNaissanceFiles, setContratMariageEpoux1ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance époux 1
  const [contratMariageEpoux2ActeNaissanceFiles, setContratMariageEpoux2ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance époux 2
  const [contratMariageEpoux1DomicileFiles, setContratMariageEpoux1DomicileFiles] = useState<File[]>([]); // Justif domicile époux 1
  const [contratMariageEpoux2DomicileFiles, setContratMariageEpoux2DomicileFiles] = useState<File[]>([]); // Justif domicile époux 2
  const [contratMariageContratInitialFiles, setContratMariageContratInitialFiles] = useState<File[]>([]); // Contrat mariage initial (si changement)
  const [contratMariageJustificatifMariageFiles, setContratMariageJustificatifMariageFiles] = useState<File[]>([]); // Justificatif mariage
  const [contratMariageAccordEnfantsFiles, setContratMariageAccordEnfantsFiles] = useState<File[]>([]); // Accord enfants majeurs
  const [contratMariageTitresProprieteFiles, setContratMariageTitresProprieteFiles] = useState<File[]>([]); // Titres propriété
  const [contratMariageEstimationBiensFiles, setContratMariageEstimationBiensFiles] = useState<File[]>([]); // Estimation biens
  const [contratMariageActeDecesFiles, setContratMariageActeDecesFiles] = useState<File[]>([]); // Acte décès (si veuf)
  const [contratMariageConsentementEnfantsFiles, setContratMariageConsentementEnfantsFiles] = useState<File[]>([]); // Consentement enfants majeurs
  const [contratMariageCertificatBansFiles, setContratMariageCertificatBansFiles] = useState<File[]>([]); // Certificat publication bans
  const [contratMariageDecisionJugeFiles, setContratMariageDecisionJugeFiles] = useState<File[]>([]); // Décision/autorisation judiciaire
  
  // State pour PACS - Pièces justificatives
  const [pacsPartenaire1IdentiteFiles, setPacsPartenaire1IdentiteFiles] = useState<File[]>([]); // Identité partenaire 1
  const [pacsPartenaire2IdentiteFiles, setPacsPartenaire2IdentiteFiles] = useState<File[]>([]); // Identité partenaire 2
  const [pacsPartenaire1ActeNaissanceFiles, setPacsPartenaire1ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance partenaire 1
  const [pacsPartenaire2ActeNaissanceFiles, setPacsPartenaire2ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance partenaire 2
  const [pacsPartenaire1DomicileFiles, setPacsPartenaire1DomicileFiles] = useState<File[]>([]); // Justif domicile partenaire 1
  const [pacsPartenaire2DomicileFiles, setPacsPartenaire2DomicileFiles] = useState<File[]>([]); // Justif domicile partenaire 2
  const [pacsPartenaire1DivorceFiles, setPacsPartenaire1DivorceFiles] = useState<File[]>([]); // Jugement divorce partenaire 1
  const [pacsPartenaire2DivorceFiles, setPacsPartenaire2DivorceFiles] = useState<File[]>([]); // Jugement divorce partenaire 2
  const [pacsPartenaire1DecesFiles, setPacsPartenaire1DecesFiles] = useState<File[]>([]); // Acte décès conjoint précédent partenaire 1
  const [pacsPartenaire2DecesFiles, setPacsPartenaire2DecesFiles] = useState<File[]>([]); // Acte décès conjoint précédent partenaire 2
  const [pacsPartenaire1CertificatCoutumeFiles, setPacsPartenaire1CertificatCoutumeFiles] = useState<File[]>([]); // Certificat coutume étranger partenaire 1
  const [pacsPartenaire2CertificatCoutumeFiles, setPacsPartenaire2CertificatCoutumeFiles] = useState<File[]>([]); // Certificat coutume étranger partenaire 2
  const [pacsPartenaire1CertificatNonPacsFiles, setPacsPartenaire1CertificatNonPacsFiles] = useState<File[]>([]); // Certificat non-PACS étranger partenaire 1
  const [pacsPartenaire2CertificatNonPacsFiles, setPacsPartenaire2CertificatNonPacsFiles] = useState<File[]>([]); // Certificat non-PACS étranger partenaire 2
  const [pacsPartenaire1TraductionsFiles, setPacsPartenaire1TraductionsFiles] = useState<File[]>([]); // Traductions certifiées partenaire 1
  const [pacsPartenaire2TraductionsFiles, setPacsPartenaire2TraductionsFiles] = useState<File[]>([]); // Traductions certifiées partenaire 2
  
  // State pour Donation entre époux - Pièces justificatives
  const [donationEpoux1IdentiteFiles, setDonationEpoux1IdentiteFiles] = useState<File[]>([]); // Identité époux 1
  const [donationEpoux2IdentiteFiles, setDonationEpoux2IdentiteFiles] = useState<File[]>([]); // Identité époux 2
  const [donationEpoux1LivretFamilleFiles, setDonationEpoux1LivretFamilleFiles] = useState<File[]>([]); // Livret famille (époux 1 peut uploader)
  const [donationEpoux2LivretFamilleFiles, setDonationEpoux2LivretFamilleFiles] = useState<File[]>([]); // Livret famille (époux 2 peut uploader)
  const [donationEpoux1ActeMariageFiles, setDonationEpoux1ActeMariageFiles] = useState<File[]>([]); // Acte mariage
  const [donationEpoux2ActeMariageFiles, setDonationEpoux2ActeMariageFiles] = useState<File[]>([]); // Acte mariage (doublon pour symétrie)
  const [donationEpoux1ContratMariageFiles, setDonationEpoux1ContratMariageFiles] = useState<File[]>([]); // Contrat mariage si existant
  const [donationEpoux2ContratMariageFiles, setDonationEpoux2ContratMariageFiles] = useState<File[]>([]); // Contrat mariage
  const [donationEpoux1DomicileFiles, setDonationEpoux1DomicileFiles] = useState<File[]>([]); // Justificatif domicile époux 1
  const [donationEpoux2DomicileFiles, setDonationEpoux2DomicileFiles] = useState<File[]>([]); // Justificatif domicile époux 2
  const [donationTitresProprieteBiensFiles, setDonationTitresProprieteBiensFiles] = useState<File[]>([]); // Titres propriété biens immobiliers
  const [donationEstimationBiensFiles, setDonationEstimationBiensFiles] = useState<File[]>([]); // Estimations / évaluations
  const [donationHypothequesFiles, setDonationHypothequesFiles] = useState<File[]>([]); // Hypothèques
  const [donationSituationLocativeFiles, setDonationSituationLocativeFiles] = useState<File[]>([]); // Situation locative
  const [donationRIBFiles, setDonationRIBFiles] = useState<File[]>([]); // RIB pour donation financière
  const [donationCarteGriseFiles, setDonationCarteGriseFiles] = useState<File[]>([]); // Carte grise véhicule
  const [donationAutresDocumentsFiles, setDonationAutresDocumentsFiles] = useState<File[]>([]); // Autres documents
  
  // State pour Donation Simple (8 file types)
  const [donationSimpleDonateurIdentiteFiles, setDonationSimpleDonateurIdentiteFiles] = useState<File[]>([]);
  const [donationSimpleDonateurLivretFamilleFiles, setDonationSimpleDonateurLivretFamilleFiles] = useState<File[]>([]);
  const [donationSimpleDonateurDomicileFiles, setDonationSimpleDonateurDomicileFiles] = useState<File[]>([]);
  const [donationSimpleDonatairePieceIdentiteFiles, setDonationSimpleDonatairePieceIdentiteFiles] = useState<File[]>([]);
  const [donationSimpleDonataireDomicileFiles, setDonationSimpleDonataireDomicileFiles] = useState<File[]>([]);
  const [donationSimpleTitreProprieteFiles, setDonationSimpleTitreProprieteFiles] = useState<File[]>([]);
  const [donationSimpleEvaluationBienFiles, setDonationSimpleEvaluationBienFiles] = useState<File[]>([]);
  const [donationSimpleAutresDocumentsFiles, setDonationSimpleAutresDocumentsFiles] = useState<File[]>([]);

  // State pour Donation Simple
  const [donationSimpleData, setDonationSimpleData] = useState({
    // 1. Type de donation
    typeDonation: "", // biens_meubles / biens_immobiliers / sommes_argent / nue_propriete / usufruit / parts_sociales / manuelle / mixte
    donationAvecCharges: false,
    descriptionCharges: "",
    donationAvecReserveUsufruit: false,
    donationAvecDroitRetour: false,
    donationEffetImmediat: true,
    donationPresenteIrrevocable: true,
    
    // 2. Identité donateur
    donateur: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      situationFamiliale: "", // celibataire / marie / divorce / veuf / pacse
      regimeMatrimonial: "", // communaute / separation / participation_acquets
      situationFiscale: "",
    },
    
    // 3. Identité donataire
    donataire: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      lienDonateur: "", // enfant / parent / frere_soeur / neveu_niece / cousin / ami / conjoint_pacse / autre
      lienDonateurAutrePrecision: "", // Si lienDonateur === "autre"
    },
    
    // 4. Enfants / héritiers du donateur
    nombreEnfants: "",
    enfants: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
    }],
    donationHorsPartSuccessorale: false,
    donationAvancementPart: false,
    
    // 5. Description des biens
    // A. Bien immobilier
    bienImmobilier: {
      adresseComplete: "",
      natureBien: "", // maison / appartement / terrain / dependances
      designationCadastrale: "",
      sectionCadastrale: "",
      numeroCadastral: "",
      contenance: "",
      descriptionDetaille: "",
      situationLocative: "", // libre / loue
      valeurVenale: "",
      existenceHypotheques: false,
      montantHypotheques: "",
      repartitionUsufruit: "",
      repartitionNuePropriete: "",
    },
    
    // B. Bien mobilier corporel
    bienMobilier: {
      descriptionPrecise: "",
      numeroSerie: "",
      valeurEstimee: "",
      factureExistante: false,
    },
    
    // C. Somme d'argent
    sommesArgent: {
      montantExact: "",
      provenanceFonds: "",
      modalite: "", // virement / cheque / especes
      dateTransfert: "",
    },
    
    // D. Parts sociales / actions
    partsSociales: {
      typeSociete: "",
      nombreParts: "",
      valeurUnitaire: "",
      pourcentageCapital: "",
      agrementObligatoire: false,
      clausesSpecifiques: "",
    },
    
    // E. Nue-propriété / Usufruit
    nueProprieteUsufruit: {
      valeurNuePropriete: "",
      valeurUsufruit: "",
      duree: "", // temporaire / viager
      repartitionCharges: "",
      usufruitSimultaneConjoint: false,
    },
    
    // 6. Clauses optionnelles
    clausesOptionnelles: {
      // A. Réserve d'usufruit
      reserveUsufruit: false,
      etendueUsufruit: "",
      droitUsageHabitation: false,
      
      // B. Droit de retour conventionnel
      droitRetour: false,
      etendueRetour: "", // totalite / part_recue
      
      // C. Charge imposée
      chargeImposee: false,
      descriptionCharge: "",
      montantNatureCharge: "",
      conditionsExecution: "",
      
      // D. Affectation particulière
      usageProfessionnel: false,
      exclusionCommunaute: false,
      
      // E. Donation rapportable
      donationRapportable: "", // avancement_hoirie / hors_part
      
      // F. Clause d'inaliénabilité
      clauseInalienabilite: false,
      dureeInalienabilite: "",
      motifLegitime: "",
      autorisationRequise: false,
    },
    
    // 7. Mentions légales
    mentionsLegales: {
      caracterePresentIrrevocable: true,
      acceptationExpresse: false,
      consentementEclaire: false,
      mentionReserveHereditaire: true,
      modalitesTransfertPropriete: true,
      rappelArticlesCodeCivil: true,
      obligationsFiscales: true,
    },
    
    // 8. Acceptation du donataire
    acceptationDonataire: {
      dansActe: true, // true = dans l'acte, false = acte séparé
      dateAcceptation: "",
      lieuAcceptation: "",
    },
    
    // 9. Modalités de remise du bien
    modalitesRemise: {
      modeRemise: "", // immediate / differee / don_manuel_deja_realise / symbolique
      lieuRemise: "",
      dateRemise: "",
      personneResponsable: "",
      documentRemis: "", // carte_grise / certificat / facture / cle / autre
    },
  });

  // State pour Acte de Notoriété - Fichiers
  const [acteNotorieteDefuntActeDeces, setActeNotorieteDefuntActeDeces] = useState<File[]>([]);
  const [acteNotorieteDefuntActeNaissance, setActeNotorieteDefuntActeNaissance] = useState<File[]>([]);
  const [acteNotorieteDefuntLivretFamille, setActeNotorieteDefuntLivretFamille] = useState<File[]>([]);
  const [acteNotorieteDefuntActeMariage, setActeNotorieteDefuntActeMariage] = useState<File[]>([]);
  const [acteNotorieteDefuntContratMariage, setActeNotorieteDefuntContratMariage] = useState<File[]>([]);
  const [acteNotorieteDefuntJugementDivorce, setActeNotorieteDefuntJugementDivorce] = useState<File[]>([]);
  const [acteNotorieteDefuntTestament, setActeNotorieteDefuntTestament] = useState<File[]>([]);
  const [acteNotorieteDefuntDonations, setActeNotorieteDefuntDonations] = useState<File[]>([]);
  const [acteNotorieteDefuntJustifDomicile, setActeNotorieteDefuntJustifDomicile] = useState<File[]>([]);
  const [acteNotorieteDefuntPieceIdentite, setActeNotorieteDefuntPieceIdentite] = useState<File[]>([]);
  
  // Fichiers héritiers (dynamiques par héritier)
  const [acteNotorieteHeritiersIdentite, setActeNotorieteHeritiersIdentite] = useState<Record<number, File[]>>({});
  const [acteNotorieteHeritiersActeNaissance, setActeNotorieteHeritiersActeNaissance] = useState<Record<number, File[]>>({});
  const [acteNotorieteHeritiersJustifDomicile, setActeNotorieteHeritiersJustifDomicile] = useState<Record<number, File[]>>({});
  const [acteNotorieteHeritiersJugementTutelle, setActeNotorieteHeritiersJugementTutelle] = useState<Record<number, File[]>>({});
  const [acteNotorieteHeritiersActeDecesPredeced, setActeNotorieteHeritiersActeDecesPredeced] = useState<Record<number, File[]>>({});
  const [acteNotorieteHeritierFiles, setActeNotorieteHeritierFiles] = useState<Record<number, File[]>>({});
  
  // Fichiers témoins (dynamiques par témoin)
  const [acteNotorieteTemoinsIdentite, setActeNotorieteTemoinsIdentite] = useState<Record<number, File[]>>({});
  const [acteNotorieteTemoinsAttestation, setActeNotorieteTemoinsAttestation] = useState<Record<number, File[]>>({});
  const [acteNotorieteTemoinFiles, setActeNotorieteTemoinFiles] = useState<Record<number, File[]>>({});
  
  // Fichiers conjoint survivant
  const [acteNotorieteConjointDonationEntreEpoux, setActeNotorieteConjointDonationEntreEpoux] = useState<File[]>([]);
  const [acteNotorieteConjointContratMariage, setActeNotorieteConjointContratMariage] = useState<File[]>([]);
  const [acteNotorieteConjointJustificatifs, setActeNotorieteConjointJustificatifs] = useState<File[]>([]);
  
  // Fichiers preuves filiation / possession d'état
  const [acteNotorietePreuvePhotos, setActeNotorietePreuvePhotos] = useState<File[]>([]);
  const [acteNotorietePreuveCertificats, setActeNotorietePreuveCertificats] = useState<File[]>([]);
  const [acteNotorietePreuveDocumentsScolaires, setActeNotorietePreuveDocumentsScolaires] = useState<File[]>([]);
  const [acteNotorietePreuveCorrespondances, setActeNotorietePreuveCorrespondances] = useState<File[]>([]);
  const [acteNotorietePreuveAutres, setActeNotorietePreuveAutres] = useState<File[]>([]);
  
  // Fichiers héritiers collectifs
  const [acteNotorieteHeritiersActesNaissance, setActeNotorieteHeritiersActesNaissance] = useState<File[]>([]);
  const [acteNotorieteHeritiersPiecesIdentite, setActeNotorieteHeritiersPiecesIdentite] = useState<File[]>([]);
  const [acteNotorieteHeritiersJustifsDomicile, setActeNotorieteHeritiersJustifsDomicile] = useState<File[]>([]);
  const [acteNotorieteHeritiersLivretsFamille, setActeNotorieteHeritiersLivretsFamille] = useState<File[]>([]);
  const [acteNotorieteHeritiersActesNotoriete, setActeNotorieteHeritiersActesNotoriete] = useState<File[]>([]);
  const [acteNotorieteHeritiersCertificatsHeredite, setActeNotorieteHeritiersCertificatsHeredite] = useState<File[]>([]);
  const [acteNotorieteHeritiersTutelleCuratelle, setActeNotorieteHeritiersTutelleCuratelle] = useState<File[]>([]);
  
  // Fichiers témoins collectifs
  const [acteNotorieteTemoinsPiecesIdentite, setActeNotorieteTemoinsPiecesIdentite] = useState<File[]>([]);
  const [acteNotorieteTemoinsJustifsDomicile, setActeNotorieteTemoinsJustifsDomicile] = useState<File[]>([]);
  
  // Autres documents
  const [acteNotorieteAutresAttestations, setActeNotorieteAutresAttestations] = useState<File[]>([]);
  const [acteNotorieteAutresCertificatsMedicaux, setActeNotorieteAutresCertificatsMedicaux] = useState<File[]>([]);
  const [acteNotorieteAutresCorrespondances, setActeNotorieteAutresCorrespondances] = useState<File[]>([]);
  const [acteNotorieteAutresDocuments, setActeNotorieteAutresDocuments] = useState<File[]>([]);

  // State pour Acte de Notoriété - Data
  const [acteNotorieteData, setActeNotorieteData] = useState({
    // 1. Type d'acte de notoriété
    typeActe: "", // succession / filiation / reconstitution_fait / qualite_hereditaire
    
    // 2. Informations sur le défunt (si succession)
    defunt: {
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseAuDeces: "",
      dateDeces: "",
      lieuDeces: "",
      situationMatrimoniale: "", // celibataire / marie / divorce / veuf / pacse
      regimeMatrimonial: "", // communaute / separation / participation_acquets / autre
      regimeMatrimonialAutre: "",
      dateMariage: "",
      lieuMariage: "",
      pacsExistant: false,
      datePacs: "",
      lieuPacs: "",
      testamentsConnus: false,
      donationsEntreEpoux: false,
      donationsAnterieures: false,
      listeDonations: "",
    },
    
    // 3. Héritiers (array)
    heritiers: [{
      id: 1,
      clientId: "",
      // A. Informations civiles
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      
      // B. Lien de parenté
      lienParente: "", // conjoint / enfant / parent / frere_soeur / autre
      lienAutrePrecision: "",
      
      // C. Représentation (si prédécédé)
      estPredeced: false,
      enfantsPredeced: [{
        id: 1,
        nom: "",
        prenom: "",
        dateNaissance: "",
        ordreRepresentation: "",
      }],
      
      // D. Capacité juridique
      estMineur: false,
      estMajeurProtege: false,
      typeProtection: "", // tutelle / curatelle / habilitation_familiale
      tuteurNom: "",
      tuteurPrenom: "",
      tuteurAdresse: "",
      
      // E. Option successorale
      optionSuccessorale: "", // acceptation_pure / acceptation_concurrence_actif / renonciation
    }],
    
    // 4. Conjoint survivant (si applicable)
    conjointSurvivant: {
      existe: false,
      donationEntreEpouxExiste: false,
      electionOptionnelle: "", // usufruit / quart_pleine_propriete
      droitLogementTemporaire: false,
      droitLogementViager: false,
      contratMariageExiste: false,
      clausesParticulieres: false,
      descriptionClausesParticulieres: "", // preciput / clause_attribution / autre
    },
    
    // 5. Témoins (pour actes hors succession classique)
    temoins: [{
      id: 1,
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      profession: "",
      lienFamille: "", // ami_famille / voisin / collegue / autre (ne doit pas être héritier)
      declarationEcrite: "",
    }],
    
    // 6. Preuves (pour filiation / possession d'état)
    preuvesFiliation: {
      typesPreuves: [], // photos / certificats / documents_scolaires / correspondances / autres
      descriptionPreuves: "",
    },
    
    // 7. Contenu de l'acte
    contenuActe: {
      // A. Déclarations des héritiers
      reconnaissanceQualiteHeritiers: true,
      declarationAbsenceAutresHeritiers: true,
      declarationTestament: "", // aucun / existe / inconnu
      declarationDonations: "", // aucune / existent / inconnu
      absenceLitigeQualiteHereditaire: true,
      
      // B. Ordre successoral
      conjointSurvivantOrdre: false,
      heritiers1erOrdre: false, // descendants
      heritiers2eOrdre: false, // parents + freres/soeurs
      heritiers3eOrdre: false, // ascendants autres
      heritiers4eOrdre: false, // collatéraux éloignés
      
      // C. Parts héréditaires (calculées automatiquement)
      partsHereditaires: [{
        heritierId: 1,
        partPleinePropriete: "",
        partUsufruit: "",
        partNuePropriete: "",
      }],
      
      // D. Mentions légales
      referenceCodeCivil: true,
      responsabiliteDeclarants: true,
      revocationPossibleFraude: true,
      mentionLecture: true,
    },
    
    // 8. Formalités
    formalites: {
      enregistrementFCDDV: false, // Fichier Central des Dispositions de Dernières Volontés
      receptionPieces: false,
      authentificationElectronique: false,
      transmissionHeritiers: false,
      transmissionBanques: false,
    },
  });

  // State pour Partage Successoral - Fichiers
  const [partageDefuntActeDeces, setPartageDefuntActeDeces] = useState<File[]>([]);
  const [partageDefuntLivretFamille, setPartageDefuntLivretFamille] = useState<File[]>([]);
  const [partageDefuntContratMariage, setPartageDefuntContratMariage] = useState<File[]>([]);
  const [partageDefuntTestaments, setPartageDefuntTestaments] = useState<File[]>([]);
  const [partageDefuntDonationsEntreEpoux, setPartageDefuntDonationsEntreEpoux] = useState<File[]>([]);
  const [partageDefuntDonationsAnterieures, setPartageDefuntDonationsAnterieures] = useState<File[]>([]);
  const [partageDefuntTitresPropriete, setPartageDefuntTitresPropriete] = useState<File[]>([]);
  const [partageDefuntRelevesBancaires, setPartageDefuntRelevesBancaires] = useState<File[]>([]);
  const [partageDefuntBilansEntreprises, setPartageDefuntBilansEntreprises] = useState<File[]>([]);
  const [partageDefuntInventaireMobilier, setPartageDefuntInventaireMobilier] = useState<File[]>([]);
  
  // Fichiers héritiers (dynamiques par héritier)
  const [partageHeritierFiles, setPartageHeritierFiles] = useState<Record<number, File[]>>({});
  
  // Fichiers biens immobiliers (dynamiques par bien)
  const [partageBienImmobilierFiles, setPartageBienImmobilierFiles] = useState<Record<number, File[]>>({});
  
  // Fichiers autres
  const [partageAutresDiagnostics, setPartageAutresDiagnostics] = useState<File[]>([]);
  const [partageAutresEvaluations, setPartageAutresEvaluations] = useState<File[]>([]);
  const [partageAutresStatutsSocietes, setPartageAutresStatutsSocietes] = useState<File[]>([]);
  const [partageAutresDocuments, setPartageAutresDocuments] = useState<File[]>([]);

  // State pour Partage Successoral - Data
  const [partageSuccessoralData, setPartageSuccessoralData] = useState({
    // 1. Informations sur la succession
    succession: {
      defunt: {
        nom: "",
        prenom: "",
        nomNaissance: "",
        dateNaissance: "",
        lieuNaissance: "",
        dateDeces: "",
        lieuDeces: "",
        nationalite: "",
        profession: "",
        adresseAuDeces: "",
        situationMatrimoniale: "",
        regimeMatrimonial: "",
        testamentsExistants: false,
        donationsEntreEpoux: false,
        donationsAnterieures: false,
      },
      notaire: {
        nom: "",
        etude: "",
        adresse: "",
        telephone: "",
        email: "",
      },
    },
    
    // 2. Héritiers / Légataires
    heritiers: [{
      id: 1,
      clientId: "",
      // Informations d'état civil
      nom: "",
      prenom: "",
      nomNaissance: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      telephone: "",
      email: "",
      lienDefunt: "",
      
      // Situation juridique
      heritierReservataire: false,
      legataireUniversel: false,
      legataireATitreUniversel: false,
      legataireParticulier: false,
      heritierParRepresentation: false,
      representeQui: "",
      acceptationRenonciation: "", // accepte / renonce / benefice_inventaire
      majeurMineur: "majeur",
      sousTutelleCuratelle: false,
      typeProtection: "",
      tuteurNom: "",
      
      // Quote-part
      quotePart: "",
    }],
    
    // 3. Inventaire de l'actif successoral
    actif: {
      // A. Biens immobiliers
      biensImmobiliers: [{
        id: 1,
        adresse: "",
        description: "",
        designationCadastrale: "",
        valeurVenale: "",
        origineBien: "", // propre / commun / indivis
        quotePartDefunt: "",
        etatLocatif: "",
        loyer: "",
        hypotheques: "",
        copropriete: false,
        lots: "",
        chargesCopro: "",
      }],
      
      // B. Biens meubles
      biensMeubles: {
        mobilierForfait5Pct: true,
        mobilierValeurReelle: "",
        vehicules: "",
        bijoux: "",
        oeuvresArt: "",
        collections: "",
        materielProfessionnel: "",
      },
      
      // C. Comptes bancaires
      comptesBancaires: [{
        id: 1,
        banque: "",
        typeCompte: "",
        numeroCompte: "",
        soldeAuDeces: "",
        interetsCourus: "",
      }],
      
      // D. Assurance-vie
      assurancesVie: [{
        id: 1,
        compagnie: "",
        numeroContrat: "",
        beneficiaires: "",
        capitalVerse: "",
        primesAvant70Ans: "",
        primesApres70Ans: "",
      }],
      
      // E. Parts sociales
      partsSociales: [{
        id: 1,
        nature: "", // SARL / SAS / SCI / EI / exploitation_agricole
        nomEntite: "",
        nombreParts: "",
        valeurEstimee: "",
        droitsAttaches: "",
        pacteDutreil: false,
      }],
      
      // F. Biens à l'étranger
      biensEtranger: [{
        id: 1,
        pays: "",
        adresse: "",
        valeur: "",
        regimeFiscal: "",
      }],
      
      // G. Usufruit / Nue-propriété
      usufruitNuePropriete: [{
        id: 1,
        bienConcerne: "",
        valeurUsufruit: "",
        valeurNuePropriete: "",
        baremeFiscal: "",
      }],
    },
    
    // 4. Passif successoral
    passif: {
      dettes: [{
        id: 1,
        type: "", // credit / fiscale / facture / personnelle / professionnelle
        description: "",
        montant: "",
      }],
      fraisFuneraires: "",
      fraisDerniereMaladie: "",
      impots: {
        ir: "",
        ifi: "",
        taxeFonciere: "",
        taxeHabitation: "",
      },
    },
    
    // 5. Type de partage et création des lots
    partage: {
      typePartage: "", // total / partiel / attribution_preferentielle / amiable / judiciaire
      
      lots: [{
        id: 1,
        nomLot: "",
        biensListe: "",
        valeurTotale: "",
        attributionHeritier: "",
        quotePartTheorique: "",
        ecart: "",
        soulte: "",
        modalitesPaiementSoulte: "",
      }],
      
      attributionsPreferentielles: [{
        id: 1,
        typeBien: "", // logement_familial / vehicule / entreprise / fonds_commerce / parts_societe
        description: "",
        beneficiaire: "",
        conditions: "", // indivision / pleine_propriete
      }],
      
      donationsARapporter: [{
        id: 1,
        date: "",
        montant: "",
        beneficiaire: "",
        rapportable: true,
        evaluationAuJourPartage: "",
        impactLots: "",
      }],
      
      soultes: [{
        id: 1,
        montant: "",
        quiVerse: "",
        quiRecoit: "",
        modalitesPaiement: "",
        interets: "",
        garantie: "",
      }],
    },
    
    // 6. Déclarations et clauses
    declarations: {
      reconnaissanceLots: true,
      absenceReticenceFraude: true,
      volonteLibre: true,
      acceptationSoultes: true,
      acceptationIndivisionResiduelle: false,
      
      clauseGarantieEviction: false,
      clausePurgeHypotheques: false,
      clauseRenonciationComplementPart: false,
      clauseRepartitionFrais: false,
      clauseRenonciationReduction: false,
      
      indivisionResiduelle: false,
      dureeIndivision: "",
      gestionIndivision: "",
      quotePartIndivision: "",
      pouvoirsIndivision: "",
    },
    
    // 7. Formalités
    formalites: {
      enregistrementFiscal: false,
      publicationSPF: false,
      mutationCadastrale: false,
      paiementDroitsPartage: false,
      radiationHypotheque: false,
      miseAJourBanques: false,
      miseAJourAssurances: false,
    },
  });

  // State pour Avenants au contrat de travail (fichiers)
  const [avenantContratInitialFiles, setAvenantContratInitialFiles] = useState<File[]>([]);
  const [avenantPrecedentsFiles, setAvenantPrecedentsFiles] = useState<File[]>([]);
  const [avenantJustificatifsFiles, setAvenantJustificatifsFiles] = useState<File[]>([]);
  const [avenantAutresDocumentsFiles, setAvenantAutresDocumentsFiles] = useState<File[]>([]);

  // State pour Avenants au contrat de travail (Client IDs)
  const [avenantContratTravailClientIdEmployeur, setAvenantContratTravailClientIdEmployeur] = useState<string>("");
  const [avenantContratTravailClientIdSalarie, setAvenantContratTravailClientIdSalarie] = useState<string>("");

  // State pour Avenants au contrat de travail
  const [avenantContratTravailData, setAvenantContratTravailData] = useState({
    // 1. Identité de l'employeur
    employeur: {
      raisonSociale: "",
      formeJuridique: "",
      siret: "",
      codeAPE: "",
      adresseSiege: "",
      representantLegal: "",
      qualiteRepresentant: "",
    },
    
    // 2. Identité du salarié
    salarie: {
      nom: "",
      prenom: "",
      dateNaissance: "",
      numeroSecu: "",
      adresse: "",
    },
    
    // 3. Référence du contrat initial
    contratInitial: {
      dateContrat: "",
      typeContrat: "", // CDI / CDD / CTT / Alternance
      posteInitial: "",
    },
    
    // 4. Modifications
    modifications: {
      remuneration: {
        actif: false,
        ancienSalaire: "",
        nouveauSalaire: "",
        elementsModifies: "",
        dateEffet: "",
      },
      tempsTravail: {
        actif: false,
        ancienneDuree: "",
        nouvelleDuree: "",
        repartitionHoraire: "",
        dateEffet: "",
      },
      fonctions: {
        actif: false,
        ancienPoste: "",
        nouveauPoste: "",
        nouvellesMissions: "",
        dateEffet: "",
      },
      lieuTravail: {
        actif: false,
        ancienLieu: "",
        nouveauLieu: "",
        clauseMobilite: "",
        dateEffet: "",
      },
      classification: {
        actif: false,
        ancienCoefficient: "",
        nouveauCoefficient: "",
        dateEffet: "",
      },
      autre: {
        actif: false,
        description: "",
        dateEffet: "",
      },
    },
    
    // 5. Clauses maintenues
    clausesMaintenues: "",
    
    // 6. Date d'effet et signature
    dateEffetAvenant: "",
    effectImmediat: false,
    dateEffetDifferee: "",
    
    // 7. Consentement du salarié
    consentementExpres: false,
    
    // 8. Signature
    dateLieuSignature: "",
    villeSignature: "",
    
    // 9. Mention indivisible
    mentionIndivisible: true,
  });

  // State pour Accord de confidentialité employé (fichiers)
  const [accordConfidEmployeurKbisFiles, setAccordConfidEmployeurKbisFiles] = useState<File[]>([]);
  const [accordConfidCharteInformatiqueFiles, setAccordConfidCharteInformatiqueFiles] = useState<File[]>([]);
  const [accordConfidPolitiqueInterneFiles, setAccordConfidPolitiqueInterneFiles] = useState<File[]>([]);
  const [accordConfidEmployeIdentiteFiles, setAccordConfidEmployeIdentiteFiles] = useState<File[]>([]);

  // State pour Accord de confidentialité employé (Client IDs)
  const [accordConfidClientIdEmployeur, setAccordConfidClientIdEmployeur] = useState<string>("");
  const [accordConfidClientIdEmploye, setAccordConfidClientIdEmploye] = useState<string>("");

  // State pour Accord de confidentialité employé
  const [accordConfidentialiteData, setAccordConfidentialiteData] = useState({
    // 1. Employeur
    employeur: {
      denominationSociale: "",
      formeJuridique: "",
      adresse: "",
      siret: "",
      representantLegal: "",
      fonctionRepresentant: "",
      conventionCollective: "",
    },
    
    // 2. Employé
    employe: {
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      posteOccupe: "",
      serviceAffectation: "",
      dateEntree: "",
      typeContrat: "",
    },
    
    // 3. Contexte
    contexte: {
      accesInfosSensibles: false,
      secretProfessionnel: false,
      donneesClients: false,
      savoirFaire: false,
      projetsDeveloppement: false,
      strategieCommerciale: false,
    },
    
    // 4. Définition informations confidentielles
    definitionsInfosConfidentielles: {
      donneesClients: false,
      donneesFournisseurs: false,
      infosFinancieres: false,
      savoirFaireTechnique: false,
      projetsRD: false,
      codeSource: false,
      documentsInternes: false,
      methodesTravail: false,
      strategiesCommerciales: false,
      tarifsNegocies: false,
      contrats: false,
      donneesRH: false,
      organigrammes: false,
      rapportsActivite: false,
      brevetsPropriete: false,
      etudesMarche: false,
    },
    
    // 5. Exclusions
    exclusions: {
      domainePublic: false,
      connuesAvant: false,
      divulgueesParTiers: false,
      obligationLegale: false,
    },
    
    // 6. Obligations salarié pendant contrat
    obligationsPendant: {
      secretAbsolu: false,
      divulgationNecessaireUniquement: false,
      mesuresSecurite: false,
      copieInterdite: false,
      supportPersonnelInterdit: false,
      mailProUniquement: false,
      reseauxSociauxInterdits: false,
      alerteViolation: false,
    },
    
    // 7. Obligations salarié après contrat
    obligationsApres: {
      dureeConfidentialite: "",
      maintienConfidentialite: false,
      restitutionDocuments: false,
      destructionCopies: false,
      interdictionUsage: false,
    },
    
    // 8. Interdictions spécifiques
    interdictions: {
      divulgationConcurrents: false,
      usagePersonnel: false,
      publication: false,
      reproductionNonAutorisee: false,
    },
    
    // 9. Obligations employeur
    obligationsEmployeur: {
      identificationDocuments: false,
      formationSecurite: false,
      accesLimite: false,
    },
    
    // 10. Sécurité informatique
    securiteInformatique: {
      charteInformatique: false,
      motDePasseFort: false,
      cleUSBInterdite: false,
      cloudPersonnelInterdit: false,
      chiffrementObligatoire: false,
      antivirusMajours: false,
      teletravailVPN: false,
      teletravailAccesChiffre: false,
      teletravailMaterielSecurise: false,
    },
    
    // 11. RGPD
    rgpd: {
      formationRGPD: false,
      mentionDPO: "",
    },
    
    // 12. Restitution documents
    restitution: {
      documentsPapier: false,
      fichiersNumeriques: false,
      ordinateur: false,
      telephone: false,
      clesUSB: false,
      disquesDurs: false,
      badges: false,
      cles: false,
      manuels: false,
      toutesLesCopies: false,
    },
    
    // 13. Responsabilité et sanctions
    responsabilite: {
      responsabiliteCivile: true,
      responsabilitePenale: true,
      avertissement: true,
      sanctionDisciplinaire: true,
      licenciementFauteGrave: true,
      clausePenalite: false,
      montantPenalite: "",
    },
    
    // 14. Compatibilité autres clauses
    compatibilite: {
      clauseConfidentialiteExistante: false,
      clauseNonConcurrence: false,
      clauseExclusivite: false,
      clauseDeditFormation: false,
      clauseObjectifs: false,
      accordTeletravail: false,
    },
    
    // 15. Droit applicable
    droitApplicable: {
      loiFrancaise: true,
      tribunalCompetent: "",
      clauseMediation: false,
    },
    
    // 16. Annexes
    annexes: {
      charteInformatique: false,
      politiqueConfidentialite: false,
      politiqueCybersecurite: false,
      fichePoste: false,
      reglementInterieur: false,
      charteTeletravail: false,
      engagementRGPD: false,
    },
    
    // 17. Signature
    dateLieuSignature: "",
    villeSignature: "",
  });

  // State pour Politique RGPD interne (fichiers)
  const [politiqueRGPDPreuveDesignationDPOFiles, setPolitiqueRGPDPreuveDesignationDPOFiles] = useState<File[]>([]);
  const [politiqueRGPDContratsSousTraitanceFiles, setPolitiqueRGPDContratsSousTraitanceFiles] = useState<File[]>([]);
  const [politiqueRGPDAttestationsSecuriteFiles, setPolitiqueRGPDAttestationsSecuriteFiles] = useState<File[]>([]);
  const [politiqueRGPDDocumentationsInternesFiles, setPolitiqueRGPDDocumentationsInternesFiles] = useState<File[]>([]);

  // State pour Politique RGPD interne (Client ID)
  const [politiqueRGPDClientId, setPolitiqueRGPDClientId] = useState<string>("");

  // State pour Politique RGPD interne
  const [politiqueRGPDData, setPolitiqueRGPDData] = useState({
    // 1. Identification de l'organisation
    organisation: {
      denominationSociale: "",
      adresseSiege: "",
      siret: "",
      secteurActivite: "",
      tailleEffectifs: "",
      representantLegal: "",
      contactGeneralRGPD: "",
    },
    
    // 2. DPO
    dpo: {
      nom: "",
      fonction: "",
      emailDedie: "",
      telephone: "",
      designationCNIL: false,
    },
    
    // 3. Objet de la politique RGPD
    objet: {
      objectifsConformite: "",
      applicationInterne: true,
      champApplicationSalaries: true,
      champApplicationAdministrateurs: true,
      champApplicationPrestataires: true,
      champApplicationStagiaires: true,
      champApplicationSousTraitants: true,
    },
    
    // 4. Principes fondamentaux
    principes: {
      liceite: true,
      transparence: true,
      minimisation: true,
      exactitude: true,
      limitationFinalites: true,
      limitationConservation: true,
      integriteConfidentialite: true,
      responsabilite: true,
    },
    
    // 5. Types de données traitées
    typesDonnees: {
      // A. Données clients
      clientsIdentite: false,
      clientsCoordonnees: false,
      clientsDocumentsContractuels: false,
      clientsVerificationIdentite: false,
      clientsSuiviDemandes: false,
      
      // B. Données employés
      employesIdentite: false,
      employesDossierRH: false,
      employesPaie: false,
      employesEvaluations: false,
      employesAbsences: false,
      employesFormations: false,
      
      // C. Données prospects
      prospectsInfosCommerciales: false,
      prospectsHistoriqueProspection: false,
      
      // D. Données partenaires/fournisseurs
      partenairesFournisseursInfosContractuelles: false,
      partenairesFournisseursPaiements: false,
      partenairesFournisseursContactsInternes: false,
      
      // E. Données techniques
      techniquesIP: false,
      techniquesLogs: false,
      techniquesCookies: false,
      techniquesOutilsInternes: false,
    },
    
    // 6. Finalités des traitements
    finalites: {
      gestionRH: false,
      gestionPaies: false,
      suiviClient: false,
      gestionSiteWeb: false,
      facturation: false,
      contrats: false,
      marketingProspection: false,
      securiteInformatique: false,
      gestionAccesInternes: false,
      autresFinalites: "",
    },
    
    // 7. Bases légales
    basesLegales: {
      executionContrat: false,
      consentement: false,
      obligationLegale: false,
      interetLegitime: false,
      missionInteretPublic: false,
    },
    
    // 8. Durées de conservation
    dureesConservation: {
      // Clients
      clientsDonneesContractuelles: "5 ans",
      clientsFactures: "10 ans",
      clientsDossiers: "durée relation + 5 ans",
      
      // Employés
      employesDossierRH: "5 ans",
      employesPaie: "5 ans",
      employesCandidaturesNonRetenues: "2 ans",
      
      // Prospects
      prospects: "3 ans après dernier contact",
      
      // Logs techniques
      logsTechniques: "1 an",
      
      // Vidéosurveillance
      videosurveillance: "30 jours",
      
      autresDurees: "",
    },
    
    // 9. Catégories de destinataires
    destinataires: {
      salariesHabilites: false,
      departementRH: false,
      serviceClient: false,
      sousTraitants: false,
      hebergeurs: false,
      prestatairiesTechniques: false,
      autoritesPubliques: false,
      autresDestinataires: "",
    },
    
    // 10. Sous-traitants (liste dynamique)
    sousTraitants: [] as Array<{
      nom: string;
      adresse: string;
      typesDonneesManipulees: string;
      finalite: string;
      paysLocalisation: string;
      contratCDPASigne: boolean;
      mesuresSecurite: string;
    }>,
    
    // 11. Transferts hors UE
    transfertsHorsUE: {
      presenceTransferts: false,
      paysConcernes: "",
      clausesContractuellesTypes: false,
      niveauAdequation: "",
      garantiesSupplementaires: "",
    },
    
    // 12. Mesures techniques et organisationnelles
    mesures: {
      // Techniques
      techniqueChiffrement: false,
      techniqueSecurisationServeurs: false,
      techniqueMotsDePasseComplexes: false,
      techniqueDoubleAuthentification: false,
      techniqueSauvegardes: false,
      techniqueGestionAcces: false,
      techniqueVPNPareFeu: false,
      techniqueJournalisationActions: false,
      
      // Organisationnelles
      orgaFormationEmployes: false,
      orgaPolitiqueAccesParRole: false,
      orgaControleSousTraitants: false,
      orgaConfidentialiteRenforcee: false,
      orgaProcessusFuite: false,
    },
    
    // 13. Droits des personnes
    droitsPersonnes: {
      droitAcces: true,
      droitRectification: true,
      droitEffacement: true,
      droitLimitation: true,
      droitOpposition: true,
      droitPortabilite: true,
      droitRetraitConsentement: true,
      droitDirectivesPostMortem: true,
      emailContact: "",
      delaiLegal: "1 mois",
      processusInterne: "",
    },
    
    // 14. Procédure violation de données
    procedureViolation: {
      etapesInternes: "",
      notificationCNIL: "< 72h",
      informationPersonnesConcernees: true,
      documentationInterne: true,
      analyseRisque: true,
      actionsCorrectives: "",
    },
    
    // 15. Politique cookies
    politiqueCookies: {
      cookiesTechniques: false,
      cookiesStatistiques: false,
      cookiesMesureAudience: false,
      cookiesMarketing: false,
      dureesConservationCookies: "",
      bandeauConsentement: true,
      gestionRefus: true,
    },
    
    // 16. Mentions internes
    mentionsInternes: {
      obligationConfidentialite: true,
      charteInformatique: true,
      interdictionOutilsNonAutorises: true,
      bonnesPratiquesCybersecurite: true,
      gestionBYOD: false,
      proceduresSortieEmploye: true,
    },
    
    // 17. Annexes
    annexes: {
      registreTraitements: false,
      listeSousTraitants: false,
      politiqueCookiesAnnexe: false,
      charteInformatiqueAnnexe: false,
      modeleGestionDroitsRGPD: false,
      procedureViolationDonnees: false,
      ficheSensibilisationEmployes: false,
      procedureConservationSuppression: false,
    },
    
    // 18. Date et lieu
    dateElaboration: "",
    villeElaboration: "",
  });

  // State pour Testament (fichiers)
  const [testamentIdentiteTestateur, setTestamentIdentiteTestateur] = useState<File[]>([]);
  const [testamentLivretFamille, setTestamentLivretFamille] = useState<File[]>([]);
  const [testamentCapaciteJuridique, setTestamentCapaciteJuridique] = useState<File[]>([]);
  const [testamentIdentiteTemoins, setTestamentIdentiteTemoins] = useState<File[]>([]);
  const [testamentDomicileTemoins, setTestamentDomicileTemoins] = useState<File[]>([]);
  const [testamentAttestationsTemoins, setTestamentAttestationsTemoins] = useState<File[]>([]);
  const [testamentCasiersTemoins, setTestamentCasiersTemoins] = useState<File[]>([]);
  const [testamentTitresPropriete, setTestamentTitresPropriete] = useState<File[]>([]);
  const [testamentRelevesBancaires, setTestamentRelevesBancaires] = useState<File[]>([]);
  const [testamentContratMariage, setTestamentContratMariage] = useState<File[]>([]);
  const [testamentAutresJustificatifs, setTestamentAutresJustificatifs] = useState<File[]>([]);
  const [testamentTestamentMystique, setTestamentTestamentMystique] = useState<File[]>([]); // Le testament cacheté lui-même

  // State pour Testament
  const [testamentData, setTestamentData] = useState({
    // 1. Informations générales
    typeTestament: "", // authentique / mystique
    caractereTestament: "", // initial / revocation / modification_codicille
    dateSouhaiteeRedaction: "",
    langueTestateur: "", // Langue comprise par le testateur (remplace langueComprise)
    autreLangue: "", // Précision si langue = "autre"
    interpreteNecessaire: false,
    interpreteNom: "",
    interpretePrenom: "",
    interpreteQualification: "",
    interpreteLangueTraduite: "",
    interpreteAttestationFidelite: "",
    interpreteSignature: "",
    
    // 2. Identité testateur
    clientId: "",
    testateurNom: "",
    testateurPrenom: "",
    testateurNomNaissance: "",
    testateurDateNaissance: "",
    testateurLieuNaissance: "",
    testateurNationalite: "",
    testateurProfession: "",
    testateurSituationFamiliale: "",
    testateurAdresse: "",
    testateurTelephone: "",
    testateurEmail: "",
    testateurPieceType: "",
    testateurPieceNumero: "",
    testateurPieceAutorite: "",
    testateurPieceExpiration: "",
    capaciteJuridiqueConfirmee: false,
    sousTutelleCuratelle: false,
    
    // 3. Héritiers réservataires
    heritiersReservataires: {
      enfants: [] as Array<{nom: string; prenom: string; dateNaissance: string}>,
      descendants: [] as Array<{nom: string; prenom: string; lien: string}>,
      nomPrenomPere: "",
      nomPrenomMere: "",
      pereVivant: "",
      mereVivante: "",
    },
    
    // 4. Légataires
    legataires: [] as Array<{nom: string; prenom: string; lien: string; adresse: string}>,
    
    // 5. Dispositions testamentaires
    dispositions: {
      legsUniversel: false,
      detailsLegsUniversel: "",
      legsTitreUniversel: false,
      detailsLegsTitreUniversel: "",
      legsParticuliers: false,
      listeLegsParticuliers: [] as Array<{description: string; beneficiaire: string}>,
      chargesConditions: false,
      detailsChargesConditions: "",
      demembrement: false,
      detailsDemembrement: "",
      droitRetour: false,
      detailsDroitRetour: "",
      exheredation: false,
      detailsExheredation: "",
      executeurTestamentaire: false,
      nomExecuteur: "",
      adresseExecuteur: "",
    },
    
    // 6. Situation patrimoniale
    patrimoine: {
      immobiliers: [] as Array<{adresse: string; type: string; valeur: string}>,
      avoirsFinanciers: [] as Array<{type: string; etablissement: string; montant: string}>,
      biensMeubles: [] as Array<{description: string; valeur: string}>,
      partsSociales: [] as Array<{societe: string; nombre: string; valeur: string}>,
    },
    
    // 7. Régime matrimonial
    regimeMatrimonial: {
      nature: "",
      contratMariage: "",
      notaireContrat: "",
      biensPropres: "",
      biensCommuns: "",
      preciput: false,
      detailsPreciput: "",
    },
    
    // Testament antérieur
    testamentAnterieur: false, // true / false
    testamentAnterieurDate: "",
    testamentAnterieurType: "", // authentique / mystique / olographe
    testamentAnterieurNotaire: "",
    
    // 8. Testament authentique spécifique
    testamentAuthentique: {
      // Nouveau: Caractère du testament
      caractere: "", // initial / modificatif / revocatoire
      dateSouhaitee: "",
      
      // Modalités de réception
      modaliteReception: "", // "1notaire_2temoins" ou "2notaires"
      lieuReception: "",
      dateReception: "",
      
      // Notaire(s)
      notaireNom: "",
      notaireOffice: "",
      notaireAdresse: "",
      presenceSecondNotaire: false,
      secondNotaireNom: "",
      secondNotaireOffice: "",
      secondNotaireAdresse: "",
      
      // Témoins (qualification complète)
      temoins: [] as Array<{
        nom: string;
        prenom: string;
        dateNaissance: string;
        lieuNaissance: string;
        nationalite: string;
        profession: string;
        adresse: string;
        lienAvecTestateur: string;
        nonHeritier: boolean;
        nonLegataire: boolean;
        nonConjoint: boolean;
        nonParentJusque4eDegre: boolean;
        capaciteJuridique: boolean;
        comprendLangue: boolean;
        agitLibrement: boolean;
        signature: boolean;
      }>,
      
      // Formalités légales
      formaliteDicte: false,
      formaliteRelu: false,
      formaliteSigne: false,
      formaliteRegistre: false,
      declarationApprobation: false,
      impossibiliteSigner: false,
      motifImpossibilite: "",
      
      // Inscription FCDDV
      inscriptionFCDDV: false,
      dateInscriptionFCDDV: "",
      notaireDepositaire: "",
    },
    
    // 9. Testament mystique spécifique
    testamentMystique: {
      // Rédaction du testament
      redactionPar: "", // "testateur" ou "tiers"
      nomRedacteur: "", // Si rédigé par un tiers
      typeEcriture: "", // "manuscrit" ou "dactylographie"
      langueTestament: "",
      nombrePages: "",
      
      // Présentation sous pli fermé
      cachete: false,
      descriptionScelle: "",
      lieuPresentation: "",
      datePresentation: "",
      
      // Notaire
      notaireNom: "",
      notaireOffice: "",
      notaireAdresse: "",
      
      // Témoins (2 obligatoires)
      temoins: [] as Array<{
        nom: string;
        prenom: string;
        dateNaissance: string;
        lieuNaissance: string;
        nationalite: string;
        profession: string;
        adresse: string;
        lienAvecTestateur: string;
        nonHeritier: boolean;
        nonLegataire: boolean;
        nonConjoint: boolean;
        nonParentJusque4eDegre: boolean;
        capaciteJuridique: boolean;
        comprendLangue: boolean;
        agitLibrement: boolean;
        signature: boolean;
      }>,
      
      // Acte de suscription
      suscription: "", // Déclaration que le pli contient le testament
      declarationContenuTestament: false,
      dateSuscription: "",
      lieuSuscription: "",
      presenceSimultanee: false, // Présence simultanée testateur/notaire/témoins
      
      // Déclarations obligatoires art. 976 C. civ.
      testateurSaitLireEcrire: false, // OBLIGATOIRE - art. 976
      testateurReconnaitTestament: false, // OBLIGATOIRE - reconnaissance personnelle
      pliNonOuvert: false, // OBLIGATOIRE - le pli n'a pas été ouvert par le notaire
      
      // Signatures
      signatureTestateur: false,
      signatureNotaire: false,
      impossibiliteSignerTestateur: false,
      motifImpossibiliteSignature: "",
      
      // Conditions légales témoins (sécurisation)
      temoinsMajeurs: false,
      temoinsNonHeritiersLegataires: false,
      temoinsSaventLireEcrire: false,
      
      // Inscription FCDDV
      inscriptionFCDDV: false,
      dateInscriptionFCDDV: "",
      notaireDepositaire: "",
    },
    
    // 10. Mentions légales
    mentionsLegales: {
      rappelReserveHereditaire: false,
      rappelQuotiteDisponible: false,
      testamentRevocable: false,
      casIndignite: false,
      verificationCapaciteLegataires: false,
      droitsReduction: false,
      regimeFiscalSuccessions: false,
    },
    
    // 11. Documents obligatoires
    documentsAuthentique: {
      pieceIdentiteTestateur: "",
      livretFamilleTestateur: "",
      certificatCapaciteTestateur: "",
      piecesIdentiteTemoins: "",
      justificatifsDomicileTemoins: "",
      attestationsCapaciteTemoins: "",
      casiersJudiciairesTemoins: "",
      titresPropriete: "",
      relevesBancaires: "",
      contratMariage: "",
      autresJustificatifs: "",
    },
  });
  
  // State pour Changement de Régime Matrimonial (fichiers)
  const [changementRegimeEpouxIdentite1, setChangementRegimeEpouxIdentite1] = useState<File[]>([]);
  const [changementRegimeEpouxIdentite2, setChangementRegimeEpouxIdentite2] = useState<File[]>([]);
  const [changementRegimeLivretFamille, setChangementRegimeLivretFamille] = useState<File[]>([]);
  const [changementRegimeActeMariage, setChangementRegimeActeMariage] = useState<File[]>([]);
  const [changementRegimeContratMariageInitial, setChangementRegimeContratMariageInitial] = useState<File[]>([]);
  const [changementRegimeJustifDomicile1, setChangementRegimeJustifDomicile1] = useState<File[]>([]);
  const [changementRegimeJustifDomicile2, setChangementRegimeJustifDomicile2] = useState<File[]>([]);
  const [changementRegimeEnfantsAccords, setChangementRegimeEnfantsAccords] = useState<File[]>([]);
  const [changementRegimeTitresPropriete, setChangementRegimeTitresPropriete] = useState<File[]>([]);
  const [changementRegimeRelevesComptes, setChangementRegimeRelevesComptes] = useState<File[]>([]);
  const [changementRegimeStatutsSocietes, setChangementRegimeStatutsSocietes] = useState<File[]>([]);
  const [changementRegimeActesPrets, setChangementRegimeActesPrets] = useState<File[]>([]);
  const [changementRegimeEstimationsBiens, setChangementRegimeEstimationsBiens] = useState<File[]>([]);
  const [changementRegimeJugementTutelle, setChangementRegimeJugementTutelle] = useState<File[]>([]);

  // State pour Changement de Régime Matrimonial
  const [changementRegimeData, setChangementRegimeData] = useState({
    // 1. Informations générales
    typeModification: "", // separation_biens / communaute_reduite / communaute_universelle / participation_acquets / modification_actuel / ajout_clauses / adoption_contrat
    regimeActuel: "", // communaute_legale / communaute_universelle / separation_biens / participation_acquets / autre
    regimeActuelAutre: "",
    dateMariage: "",
    lieuMariage: "",
    contratMariageInitial: false,
    nouveauRegimeSouhaite: "", // communaute_reduite / separation_biens / communaute_universelle / participation_acquets
    dateEffetSouhaitee: "",
    motifChangement: "", // protection_conjoint / activite_professionnelle / anticipation_successorale / simplification_patrimoniale / autre
    motifChangementAutre: "",
    
    // 1bis. Présence d'enfants
    presenceEnfants: {
      enfantsCommuns: false,
      enfantsAutreUnion: false,
      enfantsMineurs: false,
      enfantsMajeursInformes: false,
      nombreEnfantsCommuns: "",
      nombreEnfantsAutreUnion: "",
    },
    
    // 1ter. Opposition possible des tiers
    oppositionTiers: {
      creanciersConnus: false,
      risqueOpposition: false,
      detailsCreanciers: "",
      natureRisque: "",
    },
    
    // 1quater. Liquidation du régime
    liquidationRegime: {
      necessaire: "", // oui / non
      justificationAbsence: "",
      repartitionBiens: "", // 50-50 / autre
      autreRepartition: "",
      recompensesCreances: false,
      detailsRecompenses: "",
    },
    
    // 1quinquies. Homologation judiciaire
    homologation: {
      requise: false,
      motif: "", // enfants_mineurs / opposition_tiers / protection_epoux / autre
      autreMotif: "",
      tribunalCompetent: "",
    },
    
    // 1sexies. Clauses spécifiques
    clausesSpecifiques: {
      attributionIntegrale: false,
      detailsAttribution: "",
      preciput: false,
      detailsPreciput: "",
      exclusionBiens: false,
      biensExclus: "",
      amenagements: false,
      detailsAmenagements: "",
    },
    
    // 2. Époux 1
    epoux1: {
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      adresse: "",
      profession: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      validiteIdentite: "",
      sousTutelleCuratelle: false,
      changementAnterieur: false,
    },
    
    // 3. Époux 2
    epoux2: {
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      adresse: "",
      profession: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      validiteIdentite: "",
      sousTutelleCuratelle: false,
      changementAnterieur: false,
    },
    
    // 4. Enfants et héritiers
    enfantsCommuns: [] as Array<{
      nom: string;
      prenom: string;
      dateNaissance: string;
      majeur: boolean;
      consentement: string; // accord / opposition / pas_reponse
    }>,
    enfantsPrecedenteUnion: [] as Array<{
      nom: string;
      prenom: string;
      dateNaissance: string;
      majeur: boolean;
      parent: string; // epoux1 / epoux2
      consentement: string;
    }>,
    parentsVivants: {
      pereEpoux1: false,
      mereEpoux1: false,
      pereEpoux2: false,
      mereEpoux2: false,
    },
    
    // 5. Consentements et notifications
    consentements: {
      enfantsMajeursInformes: false,
      creancierAccord: false,
      creancierNom: "",
      creancierNatureDette: "",
      autorisationJuge: false,
      dateAutorisationJuge: "",
      motifAutorisationJuge: "",
    },
    
    // 6. Patrimoine actuel
    patrimoine: {
      // Biens propres époux 1
      biensPropreEpoux1: [] as Array<{
        description: string;
        valeur: string;
        origine: string;
        dettes: string;
      }>,
      // Biens propres époux 2
      biensPropreEpoux2: [] as Array<{
        description: string;
        valeur: string;
        origine: string;
        dettes: string;
      }>,
      // Biens communs
      biensCommuns: [] as Array<{
        description: string;
        valeur: string;
        hypotheques: string;
        affectationPro: boolean;
      }>,
      // Biens indivis
      biensIndivis: [] as Array<{
        description: string;
        quotePart: string;
        provenance: string;
      }>,
      // Entreprises
      entreprises: [] as Array<{
        nom: string;
        forme: string;
        valeur: string;
        droitsTransmis: string;
      }>,
      // Comptes financiers
      comptes: [] as Array<{
        banque: string;
        type: string;
        titulaire: string;
        solde: string;
      }>,
    },
    
    // 7. Nouveau régime choisi
    nouveauRegime: {
      type: "", // communaute_universelle / communaute_reduite / separation_biens / participation_acquets
      
      // Communauté universelle
      communauteUniverselle: {
        biensPresents: true,
        biensFuturs: true,
        clauseAttributionIntegrale: false,
        clausePreciput: false,
        detailsPreciput: "",
        exclusionBiens: [] as Array<{description: string; motif: string}>,
      },
      
      // Communauté réduite aux acquêts
      communauteReduite: {
        biensPropreDefinition: "",
        biensCommunsDefinition: "",
        repartitionDettes: "",
        clauseReprise: false,
        detailsClauseReprise: "",
        clausesFiscales: "",
      },
      
      // Séparation de biens
      separationBiens: {
        attributionBiensPropres: "",
        repartitionBiensCommuns: "",
        gestionCommuneBien: false,
        detailsGestionCommune: "",
        contributionCharges: "",
      },
      
      // Participation aux acquêts
      participationAcquets: {
        masseDepart: "",
        masseFin: "",
        modalitesCalcul: "",
      },
      
      // Clauses facultatives (tous régimes)
      clausesFacultatives: {
        preciput: false,
        detailsPreciput: "",
        administrationSeparee: false,
        detailsAdministrationSeparee: "",
        inalienabilite: false,
        motifInalienabilite: "",
        donationEntreEpoux: false,
        detailsDonation: "",
        protectionConjointSurvivant: false,
        detailsProtection: "",
        attributionPreferentielle: false,
        detailsAttributionPreferentielle: "",
        gestionSepareePro: false,
        detailsGestionPro: "",
      },
    },
    
    // 8. Liquidation régime précédent
    liquidation: {
      necessaire: false, // true si on quitte communautaire
      actifCommunaute: [] as Array<{
        description: string;
        valeur: string;
        repartition: string;
      }>,
      passifCommunaute: [] as Array<{
        description: string;
        montant: string;
        repartition: string;
      }>,
      acceptationLiquidation: false,
      cleRepartition: "50-50", // 50-50 / autre
      autreRepartition: "",
    },
    
    // 9. Mentions légales
    mentionsLegales: {
      rappelArticlesCodeCivil: false,
      rappelLiberteContractuelle: false,
      interetFamille: false,
      declarationLibreConsent: false,
      detailsAttestations: "",
      publicationBODACCInformee: false,
      depotGreffe: false,
      effetChangement: "", // 3_mois / immediat
    },
    
    // 10. Publicité et formalités
    formalites: {
      depotGreffe: false,
      coordonneesTribunal: "",
      dateDepot: "",
      publicationBODACCFaite: false,
      datePublicationBODACC: "",
      notificationCreanciers: false,
      delaisNotification: "",
      preuvesReception: "",
    },
  });

  // State pour Déclaration de Succession (fichiers)
  const [successionActeDeces, setSuccessionActeDeces] = useState<File[]>([]);
  const [successionLivretFamille, setSuccessionLivretFamille] = useState<File[]>([]);
  const [successionContratMariage, setSuccessionContratMariage] = useState<File[]>([]);
  const [successionTestament, setSuccessionTestament] = useState<File[]>([]);
  const [successionDonationsAnterieures, setSuccessionDonationsAnterieures] = useState<File[]>([]);
  const [successionTitresPropriete, setSuccessionTitresPropriete] = useState<File[]>([]);
  const [successionAvisImposition, setSuccessionAvisImposition] = useState<File[]>([]);
  const [successionRelevesBancaires, setSuccessionRelevesBancaires] = useState<File[]>([]);
  const [successionAssuranceVie, setSuccessionAssuranceVie] = useState<File[]>([]);
  const [successionStatutsSocietes, setSuccessionStatutsSocietes] = useState<File[]>([]);
  const [successionJustifsDettes, setSuccessionJustifsDettes] = useState<File[]>([]);
  const [successionFactureFuneraires, setSuccessionFactureFuneraires] = useState<File[]>([]);

  // State pour Déclaration de Succession
  const [successionData, setSuccessionData] = useState({
    // 1. Informations générales
    dateDeces: "",
    lieuDeces: "",
    communeDernierDomicile: "",
    numeroActeDeces: "",
    declarationDans6Mois: true,
    decesEtranger: false,
    
    // 2. Identité du défunt
    defunt: {
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresse: "",
      situationMatrimoniale: "", // celibataire / marie / divorce / veuf / pacse
      regimeMatrimonial: "", // communaute_legale / separation_biens / participation_acquets / communaute_universelle
      contratMariageExiste: false,
      testamentExiste: false,
      typeTestament: "", // olographe / authentique / mystique
      donationsAnterieuresExistent: false,
      mandatProtectionFuture: false,
      pacteSuccessoral: false,
    },
    
    // Note: Les anciennes sections 3-6 (héritiers, patrimoine, passif, donations) ont été remplacées par les sections 7-19 plus détaillées
    
    // 7. Informations sur les héritiers
    heritiers: {
      conjointSurvivant: false,
      conjointIdentite: { nom: "", prenom: "", dateNaissance: "", adresse: "", telephone: "", email: "", degreParente: "conjoint" },
      enfantsExistent: false,
      nombreEnfants: "",
      enfants: [] as Array<{ id: number; nom: string; prenom: string; dateNaissance: string; adresse: string; telephone: string; email: string; degreParente: string }>,
      autresHeritiersExistent: false,
      autresHeritiers: [] as Array<{ id: number; nom: string; prenom: string; lien: string; dateNaissance: string; adresse: string; telephone: string; email: string; degreParente: string }>,
      heritierMineurOuProtege: false,
      renonciation: false,
      acceptationConcurrenceActifNet: false,
    },
    
    // 8. État civil "preuve" du défunt
    etatCivilPreuves: {
      copieActeNaissance: false,
      acteMariageDivorce: false,
      contratMariageReferences: "",
      testamentReferences: "",
      rechercheFCDDV: false,
    },
    
    // 9. Régime matrimonial (liquidation)
    regimeMatrimonialLiquidation: {
      regimeExact: "",
      dateMariage: "",
      dateEffetRegime: "",
      clausesParticulieres: false,
      preciput: false,
      attributionIntegrale: false,
      avantagesMatrimoniaux: false,
      detailsClausesParticulieres: "",
      precedenteLiquidation: false,
      changementRegime: false,
    },
    
    // 10. Donations et libéralités antérieures
    donationsLiberalites: {
      donationsFaitesParDefunt: [] as Array<{ id: number; beneficiaire: string; date: string; nature: string; valeur: string }>,
      presentsUsageSignificatifs: false,
      donationsRecuesDuConjoint: false,
    },
    
    // 11. Patrimoine immobilier détaillé
    patrimoineImmobilierDetail: [] as Array<{
      id: number;
      adresseComplete: string;
      nature: string;
      quotePart: string;
      modeAcquisition: string;
      dateAcquisition: string;
      valeurEstimee: string;
      referencesCadastrales: string;
      creditRestantDu: string;
    }>,
    
    // 12. Comptes bancaires et placements
    comptesBancairesDetail: {
      banquesConnues: "",
      compteCourant: false,
      livret: false,
      pel: false,
      comptesTitres: false,
      pea: false,
      listeComptes: [] as Array<{ id: number; banque: string; typeCompte: string; solde: string; iban: string }>,
      coffreFort: false,
      coffreBanque: "",
      coffreContenu: "",
    },
    
    // 13. Assurance-vie / capital décès
    assuranceVieDetail: {
      contratsExistent: false,
      contrats: [] as Array<{ id: number; assureur: string; numeroContrat: string; dateSouscription: string; beneficiaires: string }>,
      contratsObseques: false,
      capitalDecesEmployeur: false,
    },
    
    // 14. Entreprises / parts sociales
    entreprisesDetail: {
      societesDetenues: false,
      societes: [] as Array<{ id: number; denomination: string; forme: string; siren: string; pourcentageDetention: string; valorisation: string }>,
    },
    
    // 15. Véhicules et biens mobiliers de valeur
    vehiculesMobiliers: {
      vehicules: [] as Array<{ id: number; immatriculation: string; valeurEstimee: string }>,
      bijoux: false,
      oeuvresArt: false,
      collections: false,
      estimationBijoux: "",
      forfait5Pourcent: false,
      inventaireCommissairePriseur: false,
    },
    
    // 16. Passif (dettes) et charges déductibles
    passifDetail: {
      emprunts: [] as Array<{ id: number; organisme: string; capitalRestantDu: string }>,
      dettesPersonnelles: false,
      detailsDettes: "",
      impotsRestantDus: false,
      detailsImpots: "",
      fraisFuneraires: "",
      fraisMedicaux: false,
      facturesAttente: "",
    },
    
    // 17. Fiscalité / résidence / délais
    fiscaliteResidence: {
      residenceFiscale: "France",
      autrePays: "",
      decesEtrangerPays: "",
      existenceIFI: false,
      detailsIFI: "",
      sipCoordonnees: "",
    },
    
    // 18. Mandats / représentation
    mandatsRepresentation: {
      heritierReferentNom: "",
      heritierReferentRole: "",
      procurationsExistent: false,
      executeurTestamentaire: false,
      executeurIdentite: "",
    },
    
    // 19. Points juridiques sensibles
    pointsJuridiquesSensibles: {
      successionInternationale: false,
      indivisionConflictuelle: false,
      heritierIntrouvable: false,
      acceptationBeneficeInventaire: false,
    },
  });

  // State pour l'acte de vente
  const [acteVenteData, setActeVenteData] = useState({
    // Sélection du client et son rôle
    clientId: "",
    clientRole: "", // "vendeur" ou "acheteur"
    
    // Informations détaillées sur le bien
    adresseBien: "",
    typeBien: "",
    naturePropriete: "",
    referencesCadastrales: "",
    sectionCadastrale: "",
    numeroCadastral: "",
    contenanceCadastrale: "",
    surfaceHabitable: "",
    surfaceTerrain: "",
    nombrePieces: "",
    equipements: [] as string[],
    // Bien - Année et annexes
    anneeConstruction: "",
    bienGarage: "",
    bienParking: "",
    bienCave: "",
    bienGrenier: "",
    bienJardin: "",
    autresDependances: "",
    // Bien - Équipements inclus
    cuisineEquipee: "",
    electromenagersInclus: "",
    electromenagersListe: "",
    mobilierLaisse: "",
    autresEquipements: "",
    // Copropriété
    bienCopropriete: "",
    numerosLots: "",
    tantièmes: "",
    reglementCopro: "",
    chargesAnnuelles: "",
    // État juridique
    servitudesExistantes: "",
    hypotheques: "",
    destinationBien: "",
    bienLibreOuOccupe: "",
    informationsBail: "",
    // Si occupé par locataire
    locataireNom: "",
    dateBail: "",
    dureeBail: "",
    montantLoyer: "",
    depotGarantieLocataire: "",
    // Si vendeur occupant
    dateLiberation: "",
    
    // Vendeur (soit client sélectionné avec auto-fill, soit manuel)
    vendeurNom: "",
    vendeurPrenom: "",
    vendeurAdresse: "",
    vendeurDateNaissance: "",
    vendeurLieuNaissance: "",
    vendeurNationalite: "",
    vendeurProfession: "",
    vendeurStatutMatrimonial: "",
    vendeurRegimeMatrimonial: "",
    vendeurPrecisionRegime: "",
    vendeurPieceIdentite: "",
    vendeurNumeroIdentite: "",
    // Vendeur - Type de partie
    vendeurTypePartie: "personne_physique",
    vendeurDenominationSociale: "",
    vendeurFormeJuridique: "",
    vendeurSiren: "",
    vendeurSiegeSocial: "",
    vendeurRepresentantNom: "",
    vendeurRepresentantQualite: "",
    // Vendeur - Représentation
    vendeurRepresente: "",
    vendeurMandataireNom: "",
    vendeurMandatairePrenom: "",
    vendeurTypePouvoir: "",
    
    // Acheteur (soit client sélectionné avec auto-fill, soit manuel)
    acheteurNom: "",
    acheteurPrenom: "",
    acheteurAdresse: "",
    acheteurDateNaissance: "",
    acheteurLieuNaissance: "",
    acheteurNationalite: "",
    acheteurProfession: "",
    acheteurStatutMatrimonial: "",
    acheteurRegimeMatrimonial: "",
    acheteurPrecisionRegime: "",
    acheteurModeAcquisition: "",
    acheteurQuotePart: "",
    // Acheteur - Type de partie
    acheteurTypePartie: "personne_physique",
    acheteurDenominationSociale: "",
    acheteurFormeJuridique: "",
    acheteurSiren: "",
    acheteurSiegeSocial: "",
    acheteurRepresentantNom: "",
    acheteurRepresentantQualite: "",
    // Acheteur - Représentation
    acheteurRepresente: "",
    acheteurMandataireNom: "",
    acheteurMandatairePrenom: "",
    acheteurTypePouvoir: "",
    
    // Conditions financières
    prixVente: "",
    origineFonds: "",
    depotGarantie: "",
    fraisNotaire: "",
    repartitionProrata: "",
    modalitesPaiement: "",
    
    // Prêt immobilier
    pretImmobilier: "",
    montantPret: "",
    banquePreteur: "",
    tauxPret: "",
    dureePret: "",
    typePret: "",
    dateAccordPret: "",
    conditionsPret: "",
    tauxMaximal: "",
    conditionSuspensivePret: "",
    
    // Documents et diagnostics
    diagnosticsFournis: "",
    dateDPE: "",
    classeEnergetique: "",
    presenceAmiante: "",
    presencePlomb: "",
    presenceTermites: "",
    assainissementConforme: "",
    
    // Origine de propriété
    origineProprieteDateAcquisition: "",
    origineReferenceActe: "",
    travauxDerniers10ans: "",
    conformiteUrbanisme: "",
    assuranceDommageOuvrage: "",
    taxesFoncieres: "",
    sinistreRecent: "",
    
    // Urbanisme
    zonePLU: "",
    droitPreemption: "",
    declarationsUrbanisme: "",
    documentsUrbanisme: "",
    dateEnvoiDIA: "",
    reponseMairieDIA: "",
    
    // Délais et signature
    dateSignatureActe: "",
    lieuSignature: "",
    remiseCles: "",
    remiseClesAnticipee: "",
    dateRemiseAnticipee: "",
    indemnitéOccupation: "",
    montantIndemnite: "",
    procuration: "",
    identiteMandataire: "",
    
    // Annexes
    titrePropriete: "",
    diagnostics: "",
    planBien: "",
    reglementCopropriete: "",
    etatDate: "",
    attestationAssurance: "",
    releveSyndic: "",
    
    // Informations complémentaires
    travauxPrevusCopro: "",
    proceduresEnCours: "",
    differendsVoisins: "",
    particularitesBien: "",
  });

  // State pour le bail d'habitation
  const [bailHabitationData, setBailHabitationData] = useState({
    // Rôle du client
    clientRole: "", // "bailleur" ou "locataire"
    clientId: "",
    
    // Sélection du bailleur (client)
    bailleurClientId: "",
    bailleurNom: "",
    bailleurPrenom: "",
    bailleurAdresse: "",
    bailleurDateNaissance: "",
    bailleurLieuNaissance: "",
    bailleurNationalite: "",
    bailleurProfession: "",
    bailleurStatutMatrimonial: "",
    bailleurPieceIdentite: "",
    bailleurNumeroIdentite: "",
    
    // Locataire(s) - saisie manuelle ou client
    locataireClientId: "",
    locataireNom: "",
    locatairePrenom: "",
    locataireAdresse: "",
    locataireDateNaissance: "",
    locataireLieuNaissance: "",
    locataireNationalite: "",
    locataireProfession: "",
    locataireStatutMatrimonial: "",
    locatairePieceIdentite: "",
    locataireNumeroIdentite: "",
    nombreOccupants: "",
    
    // Situation financière du locataire
    locataireRevenusMensuelsNets: "",
    locataireTypeContrat: "",
    locataireEmployeur: "",
    locataireEmployeurAdresse: "",
    locataireAncienneteEmployeur: "",
    
    // Colocation
    colocation: "",
    solidariteColocataires: "",
    nombreColocataires: "",
    colocatairesNoms: "",
    
    // Garant
    aGarant: "",
    garantNom: "",
    garantPrenom: "",
    garantAdresse: "",
    garantDateNaissance: "",
    garantLieuNaissance: "",
    garantStatutMatrimonial: "",
    garantProfession: "",
    garantPieceIdentite: "",
    garantNumeroIdentite: "",
    typeCaution: "",
    
    // Logement
    adresseLogement: "",
    typeLogement: "",
    etageNumeroLot: "",
    surfaceHabitable: "",
    surfaceAnnexes: "",
    anneeConstruction: "",
    etatUsage: "",
    dependances: [] as string[], // cave, parking, grenier, jardin
    placeParking: "",
    numeroPlaceParking: "",
    entretienJardin: "",
    logementCopropriete: "",
    reglementCoproFourni: "",
    
    // Si meublé
    typeBail: "", // "vide" ou "meuble"
    contratMeuble: "",
    mobilierListeComplete: [] as string[],
    inventaireFourni: "",
    inventaireMobilierTexte: "",
    etatMobilierEntree: "",
    entretienMobilier: "", // "locataire" ou "bailleur"
    
    // Liste légale mobilier minimal (décret 2015-981)
    mobilierLiterie: false,
    mobilierOccultation: false,
    mobilierPlaquesCuisson: false,
    mobilierFourMicroondes: false,
    mobilierRefrigo: false,
    mobilierCongelateur: false,
    mobilierVaisselle: false,
    mobilierUstensiles: false,
    mobilierTable: false,
    mobilierSieges: false,
    mobilierEtageres: false,
    mobilierLampes: false,
    mobilierMaterielEntretien: false,
    
    // Type et durée bail meublé
    typeDureeMeuble: "", // "1an" "9mois" "mobilite"
    motifBailMobilite: "", // si bail mobilité
    
    // Nature du bailleur
    natureBailleur: "", // "physique" ou "morale"
    
    // Usage
    residencePrincipale: "", // Oui/Non - obligatoire pour bail vide
    destinationBien: "",
    souslocationAutorisee: "",
    colocationPossible: "",
    animauxAutorises: "",
    precisionAnimaux: "",
    
    // Conditions financières
    loyerMensuel: "",
    chargesMensuelles: "",
    typeCharges: "", // "provision" ou "forfait"
    typologieCharges: "",
    depotGarantie: "",
    premierLoyerDate: "",
    modePaiement: "",
    ibanBailleur: "",
    periodiciteRegularisationCharges: "",
    revisionLoyerPrevue: "", // Oui/Non
    indiceIRL: "",
    trimestreReference: "",
    
    // Dates
    typeBailDuree: "", // "3ans" "6ans" "1an" "9mois"
    dateDebutBail: "",
    dureeBail: "",
    
    // Diagnostics obligatoires
    diagnosticsFournis: "", // Oui/Non
    diagnosticDPE: "",
    diagnosticElectricite: "",
    diagnosticGaz: "",
    diagnosticERP: "",
    diagnosticPlomb: "",
    diagnosticAmiante: "",
    
    // État logement
    etatLieuxFourni: "",
    inventaireMobilierFourni: "",
    travauxRecents: "",
    travauxDerniers6Mois: "",
    descriptionTravaux: "",
    
    // Obligations techniques
    typeChauffage: "",
    compteursIndividuels: "",
    releveCompteurs: "",
    
    // Assurance
    attestationAssurance: "",
    
    // Particularités juridiques
    servitudes: "",
    logementZoneERP: "",
    usageProfessionnel: "",
    
    // Informations complémentaires
    informationsComplementaires: "",
    
    // Remise des clés
    nombreJeuxCles: "",
    typesCles: [] as string[], // portes, boites_aux_lettres, garage, badges
    codesFournis: "", // WIFI, interphone, digicode...
  });

  // State pour le bail commercial
  const [bailCommercialData, setBailCommercialData] = useState({
    // Type de bail
    typeBail: "commercial", // "commercial" ou "professionnel"
    
    // Rôle du client
    clientRole: "", // "bailleur" ou "preneur"
    clientId: "",
    
    // ========== 1️⃣ IDENTIFICATION DES PARTIES ==========
    
    // Bailleur personne physique
    bailleurClientId: "",
    statutBailleur: "", // "physique" ou "morale"
    bailleurNom: "",
    bailleurPrenom: "",
    bailleurAdresse: "",
    bailleurDateNaissance: "",
    bailleurLieuNaissance: "",
    bailleurNationalite: "",
    bailleurSituationFamiliale: "", // célibataire, marié, divorcé, veuf
    bailleurRegimeMatrimonial: "", // si marié: communauté, séparation, etc.
    bailleurProfession: "",
    
    // Bailleur personne morale
    bailleurDenomination: "",
    bailleurFormeJuridique: "",
    bailleurSiren: "",
    bailleurRCS: "", // Registre du Commerce et des Sociétés
    bailleurSiret: "",
    bailleurSiegeSocial: "",
    bailleurCapitalSocial: "",
    bailleurRepresentant: "",
    bailleurRepresentantPrenom: "",
    bailleurRepresentantFonction: "",
    bailleurRepresentantEstLegal: "", // "oui" ou "non"
    bailleurMandataireNom: "",
    bailleurMandatairePrenom: "",
    bailleurMandataireTypePouvoir: "",
    
    // Preneur (locataire) personne physique
    locataireClientId: "",
    statutLocataire: "", // "physique" ou "morale"
    locataireNom: "",
    locatairePrenom: "",
    locataireAdresse: "",
    locataireDateNaissance: "",
    locataireLieuNaissance: "",
    locataireNationalite: "",
    locataireSituationFamiliale: "", // célibataire, marié, divorcé, veuf
    locataireRegimeMatrimonial: "", // si marié: communauté, séparation, etc.
    locataireProfession: "",
    locataireTelephone: "",
    locataireEmail: "",
    locataireExerceEnNomPropre: "", // "oui" ou "non"
    locataireActivite: "",
    locataireCodeAPE: "", // Code APE de l'activité
    locataireSirenPersonnel: "",
    locataireEntrepriseEnCreation: "", // "oui" ou "non"
    locataireKbisExtraction: "", // Si extraction Kbis fournie
    
    // Preneur personne morale
    locataireImmatriculation: "",
    locataireDenomination: "",
    locataireFormeJuridique: "",
    locataireSiege: "",
    locataireSiren: "",
    locataireRCS: "", // RCS
    locataireSiret: "",
    locataireObjetSocial: "",
    locataireCapital: "",
    locataireRepresentant: "",
    locataireRepresentantPrenom: "",
    locataireRepresentantFonction: "",
    locataireMandataireNom: "",
    locataireMandatairePrenom: "",
    locataireMandataireTypePouvoir: "",
    
    // Caution (si prévue)
    cautionPrevue: "", // oui / non
    cautionIdentite: "", // Nom complet de la caution
    cautionNom: "",
    cautionPrenom: "",
    cautionAdresse: "",
    cautionDateNaissance: "",
    cautionLieuNaissance: "",
    cautionNationalite: "",
    cautionProfession: "",
    cautionEmail: "",
    cautionTelephone: "",
    cautionTypeCaution: "", // simple / solidaire
    cautionDureeEngagement: "", // Durée de l'engagement caution
    cautionMontantMaximal: "", // Montant maximal garanti
    
    // ========== 2️⃣ DESCRIPTION DU LOCAL LOUÉ ==========
    
    // Local commercial
    adresseLocal: "",
    localisation: "", // Rez-de-chaussée, étage, sous-sol
    natureLocal: "", // boutique, bureaux, restaurant, etc.
    surfaceTotale: "",
    surfaceUtile: "", // Surface utile
    surfaceCommerciale: "", // Surface commerciale
    descriptionPrecise: "", // Description détaillée du local
    mesurageEffectue: "", // oui / non
    destinationActuelle: "",
    droitBailAnterieur: "", // oui / non - Existence d'un droit au bail antérieur
    
    // Parties privatives
    partiesPrivatives: [] as string[], // reserve, cuisine, wc, sous_sol, mezzanine, rangements
    partiesPrivativesAutres: "", // Description autres parties privatives
    
    // Parties communes
    partiesCommunes: [] as string[], // acces, couloir, toilettes, ascenseur
    partiesCommunesDescription: "",
    
    // Équipements inclus
    equipements: [] as string[], // chauffage, climatisation, electricite, ventilation, alarme, fibre, etc.
    equipementChauffage: "",
    equipementClimatisation: "",
    equipementElectricite: "",
    equipementVentilation: "",
    equipementAlarme: "",
    equipementReseauFibre: "",
    equipementMezzanine: "",
    equipementRangements: "",
    equipementsAutres: "",
    
    // Accessibilité
    accessibiliteNormesERP: "", // oui / non - Normes ERP
    accessibiliteNormesPMR: "", // oui / non - Normes PMR (Personnes à Mobilité Réduite)
    accessibiliteDescription: "",
    
    lotsCopropriete: "",
    etageNumero: "",
    longueurVitrine: "",
    accesLivraison: "",
    etatGeneral: "",
    
    // ========== 3️⃣ DESTINATION DU BAIL (activité autorisée) ==========
    
    // Activité (1. Destination des lieux)
    activitePrincipale: "",
    activitesComplementaires: "", // Activités complémentaires
    activiteExclusive: "", // oui / non - Activité exclusive
    activitesAnnexes: "",
    destinationBail: "",
    destinationContractuelle: "", // Description précise des activités autorisées (commercial uniquement)
    exclusivitesEventuelles: "", // Exclusivités accordées (commercial uniquement)
    interdictionsUsage: "", // Activités interdites (commercial uniquement)
    
    // Possibilité de changement d'activité
    despecialisationPossible: "", // oui / non
    despecialisationType: "", // simple / pleniere
    despecialisationConditions: "", // Conditions du changement d'activité
    
    clauseExclusivite: "",
    clauseNonConcurrence: "",
    
    // Bail professionnel spécifique
    typeProfession: "", // libérale_reglementee / libérale_non_reglementee
    numeroOrdreProfessionnel: "",
    assuranceRCPro: "", // oui / non
    assuranceLocaux: "", // oui / non
    clauseResiliationTriennale: "", // oui / non
    preavisResiliation: "", // 6 mois standard
    
    // ========== 4️⃣ DURÉE DU BAIL (3-6-9) ==========
    
    // Durée
    dureeBail: "", // "3-6-9" "derogatoire" "saisonnier"
    dureeAnnees: "9", // Nombre d'années (9 par défaut pour commercial 3-6-9)
    datePriseEffet: "", // Date d'effet = remise des clés ou date contractuelle
    dateRemiseCles: "",
    dureeTotale: "",
    
    // Résiliation triennale
    resiliationTriennalePossible: "", // oui / non
    clauseRenonciationPeriodeTriennale: "", // oui / non - Pour activités spécifiques (bureaux, stockage)
    
    // Renouvellement
    renouvellementType: "", // tacite / sur_demande
    renouvellementAuto: "",
    revisionLoyerRenouvellement: "", // oui / non
    
    // ========== 5️⃣ LOYER ==========
    
    // A. Loyer initial
    loyerAnnuelHT: "",
    loyerMensuelHT: "",
    modalitePaiement: "", // mensuel / trimestriel
    modaliteRevision: "", // annuelle / triennale
    
    // Clause d'échelle mobile (indexation automatique)
    clauseEchelleMobile: "", // oui / non - Indexation automatique
    typeIndexation: "", // ILC, ILAT, ICC (ancien)
    indiceApplicable: "", // ILC / ILAT / ICC
    baseCalculIndice: "", // Trimestre de référence
    indiceIRL: "", // Pour bail professionnel
    trimestreReference: "",
    
    // B. Dépôt de garantie
    depotGarantie: "",
    montantDepotGarantie: "",
    nombreMoisDepot: "", // Nombre de mois de loyer HT (souvent 1 à 3 mois)
    restitutionDepot: "", // Conditions de restitution
    
    // C. Pas-de-porte
    pasDePortePrevu: "", // oui / non
    pasDePorteNature: "", // supplement_loyer / indemnite_entree
    pasDePorteNatureDescription: "", // Supplément de loyer (récurrent) ou Indemnité d'entrée (non récupérable)
    pasDePorte: "", // oui / non
    pasDePorteIndemnite: "", // Indemnité d'entrée (non récupérable)
    montantPasDePorte: "",
    
    // Modalités de paiement
    modePaiementLoyer: "", // virement, prelevement, cheque
    ibanBailleur: "",
    premierLoyerDate: "",
    
    // ========== 6️⃣ CHARGES, TAXES & TRAVAUX (LOI PINEL) ==========
    
    chargesMensuelles: "",
    typeCharges: "", // provisions, forfait
    modeReglementCharges: "", // Forfait ou Provision avec régularisation
    periodiciteRegularisationCharges: "", // annuelle, trimestrielle
    
    // Charges imputables au locataire (Loi Pinel)
    chargesLocataire: [] as string[], // entretien_courant, charges_utilisation, eau, electricite, gaz, nettoyage_parties_communes, ordures_menageres
    chargesLocataireAutres: "",
    
    // Charges interdites pour le locataire (DOIVENT être exclues - Loi Pinel)
    chargesBailleur: [] as string[], // gros_travaux_606, remise_conformite_structurelle, impots_fonciers, honoraires_gestion_administration, travaux_vetuste
    chargesImputeesBailleur: "", // Description charges exclus locataire
    chargesSupporteesBailleur: "", // Description des charges du bailleur
    chargesSupporteesPreneur: "", // Description des charges du preneur
    
    // Taxes
    taxeFonciereSupporteePar: "", // bailleur ou locataire - Si clause expresse possible
    taxeSurBureauxIDF: "", // oui / non - Taxe sur bureaux (Ile-de-France)
    taxesLocalesExploitation: "",
    taxesRecuperables: "", // Description des taxes récupérables
    
    // Obligations bailleur (Loi Pinel)
    listeChargesTravaux: "", // oui / non - Liste des charges + travaux + impôts (document obligatoire à annexer)
    
    // Travaux & réparations
    travauxBailleur: "", // Gros œuvre, Structure, Toiture, Vétusté, Murs porteurs
    travauxChargeBailleur: "", // Travaux à la charge du bailleur
    travauxLocataire: "", // Aménagement intérieur, Décoration, Mise aux normes activité
    travauxChargePreneur: "", // Travaux à la charge du preneur
    
    // Travaux soumis à autorisation du bailleur
    travauxAutorisationBailleur: [] as string[], // transformation, percement_murs, installation_hottes, equipements_erp
    travauxAutorisationBailleurAutres: "",
    
    etatLocalRemise: "",
    compteursIndividuels: "",
    
    // ========== 7️⃣ ÉTAT DES LIEUX (OBLIGATOIRE) ==========
    
    etatLieuxJoint: "",
    etatLieuxRealise: "", // oui / non
    etatLieuxEntree: "", // oui / non
    etatLieuxSortie: "", // oui / non
    etatLieuxPhotosAnnexees: "", // oui / non
    etatLieuxRelevesCompteurs: "", // oui / non
    etatEquipements: "",
    
    // ========== 8️⃣ TRAVAUX ==========
    // (Déjà dans section 6 ci-dessus)
    
    // ========== 9️⃣ DÉPÔT DE GARANTIE & SÛRETÉS ==========
    // (Déjà dans section 5 ci-dessus pour dépôt de garantie)
    
    // Caution bancaire / caution personnelle
    cautionPersonnelle: "",
    cautionPersonnelleOuiNon: "", // Oui / Non
    cautionBancaire: "", // oui / non
    montantGaranti: "",
    garantieBancaire: "",
    dureeGarantie: "",
    
    // Garanties additionnelles
    garantiesAdditionnelles: "", // nantissement_fonds_commerce, etc.
    nantissementFondsCommerce: "", // oui / non
    
    // ========== 🔟 RÉVISION ET INDEXATION DU LOYER ==========
    // (Déjà dans section 5 ci-dessus)
    
    // Révision triennale (loi)
    revisionTriennale: "", // oui / non - Calcul basé sur indice ILAT ou ILC
    revisionTriennaleEncadrement: "", // Encadrement légal
    
    // Déplafonnement du loyer (cas spécifiques)
    deplafonnementPossible: "", // oui / non
    deplafonnementCas: [] as string[], // transformation_locaux, changement_destination, modification_environnement
    
    // ========== 1️⃣1️⃣ CESSION & SOUS-LOCATION ==========
    
    // Cession
    cessionInterdite: "", // oui / non
    cessionAutoriseeAccordBailleur: "", // oui / non
    cessionAutoriseeMemeProfession: "", // oui / non
    cessionAvecFondsCommerce: "", // oui / non - Cession du bail avec cession du fonds de commerce (libre)
    cessionBailAutorisee: "", // Oui / Non
    cessionConditions: "", // Conditions (agrément du bailleur...)
    
    // Documents requis cession
    cessionDocumentsRequis: [] as string[], // kbis_nouveau_locataire, projet_cession, conditions_financieres
    
    // Sous-location
    souslocationAutorisee: "", // oui / non - En principe interdite sauf accord écrit du bailleur
    souslocationConditions: "", // Conditions si autorisée
    
    // ========== 1️⃣2️⃣ ASSURANCES ==========
    
    // Assurance Locataire
    assuranceLocataireRC: "", // oui / non
    assuranceMultirisque: "", // oui / non
    assuranceMultirisqueSouscrite: "", // Oui / Non
    assurancePertesExploitation: "", // oui / non
    nomAssureur: "",
    numeropolice: "",
    
    // Assurance Bailleur
    assuranceBailleurPNO: "", // oui / non - Assurance propriétaire non exploitant (PNO)
    assuranceBailleurImmeuble: "", // oui / non
    
    // ========== 1️⃣3️⃣ OBLIGATIONS DU BAILLEUR ==========
    
    obligationDelivrerLocal: "", // oui / non - Délivrer un local en bon état
    obligationGarantieJouissance: "", // oui / non - Garantir jouissance paisible
    obligationGrosTravaux: "", // oui / non - Réaliser gros travaux
    obligationDiagnostics: "", // oui / non - Effectuer diagnostics (annexes obligatoires)
    
    // ========== 1️⃣4️⃣ OBLIGATIONS DU LOCATAIRE ==========
    
    obligationPayerLoyer: "", // oui / non - Payer loyer et charges
    obligationEntretenir: "", // oui / non - Entretenir le local
    obligationRespecterActivite: "", // oui / non - Respecter activité autorisée
    obligationNePasTransformer: "", // oui / non - Ne pas transformer sans accord
    obligationAssurer: "", // oui / non - Assurer le local
    obligationAccesUrgent: "", // oui / non - Permettre accès pour travaux urgents
    
    // ========== 1️⃣5️⃣ DIAGNOSTICS OBLIGATOIRES ==========
    
    diagnosticDPE: "", // oui / non
    diagnosticAmiante: "", // oui / non
    diagnosticAmianteDTA: "",
    diagnosticEtatRisquesERP: "", // oui / non
    diagnosticERP: "",
    diagnosticElectricite: "", // oui / non
    diagnosticGaz: "", // oui / non
    diagnosticLegionelle: "", // oui / non - Si ERP
    diagnosticAccessibiliteHandicapes: "", // oui / non - ERP
    accessibiliteHandicapes: "",
    diagnosticSecuriteIncendie: "", // oui / non
    dossierAmiantePartiesPrivatives: "", // oui / non
    
    // ========== 1️⃣6️⃣ CLAUSES OPTIONNELLES ESSENTIELLES ==========
    
    clauseResolutoire: "", // oui / non - Impayés, non-assurance...
    clauseResolutoireConditions: "", // Conditions de la clause résolutoire
    clauseNonConcurrenceLocalisation: "", // Localisation / Secteur
    clauseDestinationEvolutive: "", // oui / non
    clauseSolidariteCoPreneur: "", // oui / non
    clauseIndexationSecurisee: "", // oui / non - Anti-variable prohibée
    clauseDespecialisation: "", // oui / non
    clauseFacadeEnseigne: "", // oui / non
    clauseInterdictionNuisances: "", // oui / non - Bruit, odeur...
    clauseInterdictionNuisancesDescription: "",
    clauseAssurances: "",
    
    // ========== 1️⃣7️⃣ ANNEXES OBLIGATOIRES (LOI PINEL) ==========
    
    annexeDPE: "", // oui / non
    annexeEtatRisquesERP: "", // oui / non
    annexeEtatAmiante: "", // oui / non
    annexeInventaireChargesImpotsTaxes: "", // oui / non
    annexeEtatPrevisionnelTravaux3ans: "", // oui / non
    annexeEtatPrevisionnelTravaux6ans: "", // oui / non
    annexeReleveCharges3DernieresAnnees: "", // oui / non
    annexeEtatTravauxRealises3DernieresAnnees: "", // oui / non
    annexeEtatLieuxObligatoire: "", // oui / non
    annexeAttestationAssurance: "", // oui / non
    
    // ========== 1️⃣8️⃣ PIÈCES JUSTIFICATIVES ==========
    // Géré par les états de fichiers ci-dessous
    
    // Remise des clés
    nombreJeuxCles: "",
    typesCles: [] as string[], // portes, boites_aux_lettres, garage, badges
    codesAcces: "", // WIFI, interphone, digicode...
    
    // Infos complémentaires
    particularitesLocal: "",
    conditionsSpecifiques: "",
    restrictionsUsage: "",
    horairesOuverture: "",
    
    // ========== 1️⃣ RENOUVELLEMENT & FIN DU BAIL ==========
    droitRenouvellement: "", // oui / non
    modaliteConge: "", // Forme du congé (RAR, huissier...)
    delaiConge: "", // Délai (6 mois, 18 mois...)
    acteHuissierObligatoire: "", // oui / non
    indemniteEviction: "", // oui / non / exclusion / amenagement
    indemniteEvictionMontant: "",
    indemniteEvictionConditions: "",
    renonciationPreneur: "", // oui / non
    renonciationPreneurEncadrement: "", // Description encadrement
    
    // ========== 2️⃣ PLAFONNEMENT / DÉPLAFONNEMENT ==========
    plafonnementLoyer: "", // oui / non
    plafonnementPrincipe: "", // Description du principe
    deplafonnementAutorise: "", // oui / non
    deplafonnementModificationDestination: "", // oui / non
    deplafonnementFacteursLocaux: "", // oui / non
    deplafonnementFacteursLocauxDescription: "",
    deplafonnementClauseAcceptation: "", // oui / non
    deplafonnementConditions: "",
    
    // ========== 3️⃣ INDEXATION : SÉCURITÉ JURIDIQUE ==========
    indexationClauseReciprocite: "", // oui / non (hausse ET baisse)
    indexationClauseSauvegarde: "", // oui / non (si indice supprimé)
    indexationDateAnniversaire: "", // Date exacte anniversaire
    indexationIndiceSubstitution: "", // Indice de substitution si supprimé
    
    // ========== 4️⃣ GROS TRAVAUX & ARTICLE 606 ==========
    travauxArticle606Reference: "", // oui / non
    travauxGrossesReparationsExclusion: "", // oui / non
    travauxGrossesReparationsTransfert: "", // oui / non (si transfert au preneur)
    travauxGrossesReparationsEncadrement: "",
    
    // ========== 5️⃣ ANNEXES LÉGALES OBLIGATOIRES ==========
    annexeDPEFourni: "", // oui / non
    annexeEtatRisquesFourni: "", // oui / non (ERP / ERNMT)
    annexeDiagnosticAmianteFourni: "", // oui / non
    annexeInventaireChargesFourni: "", // oui / non (obligatoire L145-40-2)
    annexeEtatRecapitulatifTriennal: "", // oui / non (L145-40-2)
    
    // ========== 6️⃣ CLAUSE RÉSOLUTOIRE ==========
    clauseResolutoireActive: "", // oui / non
    clauseResolutoireImpayeLoyers: "", // oui / non
    clauseResolutoireDefautAssurance: "", // oui / non
    clauseResolutoireNonRespectDestination: "", // oui / non
    clauseResolutoireProcedure: "", // Description procédure (commandement, délai)
    clauseResolutoireCommandement: "", // oui / non
    clauseResolutoireDelai: "", // Délai avant résolution
    clauseResolutoireAutresCas: "",
    
    // ========== 7️⃣ RÉSILIATION ANTICIPÉE ==========
    resiliationTriennalePreneur: "", // oui / non
    resiliationTriennalePreneurConditions: "",
    resiliationRenonciationPreneur: "", // oui / non
    resiliationRenonciationEncadrement: "",
    resiliationConditionsSpecifiques: "", // Travaux, destruction...
    resiliationTravaux: "", // oui / non
    resiliationDestruction: "", // oui / non
    
    // ========== 8️⃣ TRAVAUX DU PRENEUR ==========
    travauxPreneurAutorisationPrealable: "", // oui / non
    travauxPreneurConformiteUrbanisme: "", // oui / non
    travauxPreneurRemiseEtat: "", // oui / non (remise en état ou conservation)
    travauxPreneurProprieteMeliorations: "", // bailleur / preneur / partage
    travauxPreneurIndemnisationMeliorations: "", // oui / non
    
    // ========== 9️⃣ CLAUSES SENSIBLES (PROTECTION BAILLEUR) ==========
    clauseSolidariteCession: "", // oui / non
    clausePenale: "", // oui / non
    clausePenaleMontant: "",
    clauseInteretsRetard: "", // oui / non
    clauseInteretsRetardTaux: "",
    clauseElectionDomicile: "",
    clauseAttributionCompetence: "", // Tribunal compétent
  });
  
  // ========== Note: bailCommercialData et bailHabitationData ci-dessus sont utilisés ==========
  // ========== comme base commune mais chaque profession aura ses propres états indépendants ==========
  
  // États de fichiers séparés pour Notaires
  const [notaireBailCommercialBailleurFiles, setNotaireBailCommercialBailleurFiles] = useState<File[]>([]);
  const [notaireBailCommercialLocataireFiles, setNotaireBailCommercialLocataireFiles] = useState<File[]>([]);
  const [notaireBailCommercialDiagnosticsFiles, setNotaireBailCommercialDiagnosticsFiles] = useState<File[]>([]);
  const [notaireBailCommercialCautionFiles, setNotaireBailCommercialCautionFiles] = useState<File[]>([]);
  const [notaireBailCommercialEtatLieuxFiles, setNotaireBailCommercialEtatLieuxFiles] = useState<File[]>([]);
  const [notaireBailCommercialCautionIdFiles, setNotaireBailCommercialCautionIdFiles] = useState<File[]>([]);
  const [notaireBailCommercialAssuranceFiles, setNotaireBailCommercialAssuranceFiles] = useState<File[]>([]);
  const [notaireBailHabitationBailleurIdFiles, setNotaireBailHabitationBailleurIdFiles] = useState<File[]>([]);
  const [notaireBailHabitationLocataireIdFiles, setNotaireBailHabitationLocataireIdFiles] = useState<File[]>([]);
  const [notaireBailHabitationDiagnosticsFiles, setNotaireBailHabitationDiagnosticsFiles] = useState<File[]>([]);
  const [notaireBailHabitationInventaireFiles, setNotaireBailHabitationInventaireFiles] = useState<File[]>([]);
  
  // États de fichiers séparés pour Avocats
  const [avocatBailCommercialBailleurFiles, setAvocatBailCommercialBailleurFiles] = useState<File[]>([]);
  const [avocatBailCommercialLocataireFiles, setAvocatBailCommercialLocataireFiles] = useState<File[]>([]);
  const [avocatBailCommercialDiagnosticsFiles, setAvocatBailCommercialDiagnosticsFiles] = useState<File[]>([]);
  const [avocatBailCommercialCautionFiles, setAvocatBailCommercialCautionFiles] = useState<File[]>([]);
  const [avocatBailCommercialEtatLieuxFiles, setAvocatBailCommercialEtatLieuxFiles] = useState<File[]>([]);
  const [avocatBailCommercialCautionIdFiles, setAvocatBailCommercialCautionIdFiles] = useState<File[]>([]);
  const [avocatBailCommercialAssuranceFiles, setAvocatBailCommercialAssuranceFiles] = useState<File[]>([]);
  const [avocatBailHabitationBailleurIdFiles, setAvocatBailHabitationBailleurIdFiles] = useState<File[]>([]);
  const [avocatBailHabitationLocataireIdFiles, setAvocatBailHabitationLocataireIdFiles] = useState<File[]>([]);
  const [avocatBailHabitationDiagnosticsFiles, setAvocatBailHabitationDiagnosticsFiles] = useState<File[]>([]);
  const [avocatBailHabitationInventaireFiles, setAvocatBailHabitationInventaireFiles] = useState<File[]>([]);
  
  // ========== ÉTAT DES LIEUX ==========
  const [etatLieuxData, setEtatLieuxData] = useState({
    // RÔLE DU CLIENT
    clientRole: "", // "bailleur" ou "locataire" ou ""
    
    // 1️⃣ IDENTIFICATION DU DOCUMENT
    typeEtatLieux: "",
    adresseLogement: "",
    dateEtatLieux: "",
    heureEtatLieux: "",
    realisePar: "",
    bailleurPresent: "",
    locatairePresent: "",
    temoinsRepresentants: "",
    
    // 2️⃣ IDENTITÉ DES PARTIES
    bailleurClientId: "",
    bailleurNom: "",
    bailleurPrenom: "",
    bailleurAdresse: "",
    bailleurEmail: "",
    bailleurTelephone: "",
    locataireClientId: "",
    locataireNom: "",
    locatairePrenom: "",
    locataireAdresse: "",
    locataireEmail: "",
    locataireTelephone: "",
    agencePresente: "",
    agenceRaisonSociale: "",
    agenceCarteProf: "",
    agenceAdresse: "",
    agenceMandataireNom: "",
    agenceMandataireFonction: "",
    
    // 3️⃣ DESCRIPTION GÉNÉRALE DU LOGEMENT
    typeLogement: "",
    nombrePieces: "",
    surfaceLogement: "",
    etage: "",
    ascenseur: "",
    meuble: "",
    typeChauffage: "",
    eauChaude: "",
    typeVentilation: "",
    annexes: "",
    observationsGenerales: "",
    
    // 4️⃣ RELEVÉS DE COMPTEURS
    compteurEauFroide: "",
    compteurEauChaude: "",
    compteurElectricite: "",
    compteurGaz: "",
    compteurChauffage: "",
    
    // 5️⃣ CLÉS REMISES
    cles: [{type: '', quantite: '1', numero: ''}],
    
    // 6️⃣ INVENTAIRE PIÈCE PAR PIÈCE
    pieces: [{
      nomPiece: '', surface: '',
      solRevetement: '', solEtat: '', solObservations: '',
      mursRevetement: '', mursEtat: '', mursObservations: '',
      plafondsRevetement: '', plafondsEtat: '', plafondsObservations: '',
      fenetresNombre: '', fenetresVitrage: '', fenetresEtat: '', fenetresVolets: '', fenetresObservations: '',
      portesNombre: '', portesEtat: '', portesObservations: '',
      eclairagePointsLumineux: '', eclairageInterrupteurs: '', eclairagePrises: '', eclairageEtat: '',
      chauffageType: '', chauffageNombre: '', chauffageEtat: '',
      cuisinePlaque: '', cuisineHotte: '', cuisineFour: '', cuisineFrigo: '', cuisineLaveVaisselle: '',
      cuisineEvier: '', cuisineMeubles: '', cuisineObservations: '',
      sdbBaignoire: '', sdbDouche: '', sdbLavabo: '', sdbMiroir: '', sdbMeubles: '', sdbEtat: '', sdbObservations: '',
      wcType: '', wcEtat: '', wcLaveMains: '', wcObservations: '',
      rangementsPlacards: '', rangementsEtat: '',
      observationsGenerales: ''
    }],
    
    // 7️⃣ INVENTAIRE MOBILIER
    meubles: [{categorie: '', description: '', quantite: '1', etat: ''}],
    
    // 8️⃣ ANOMALIES ET DÉGRADATIONS
    anomalies: [{localisation: '', type: '', gravite: '', description: ''}],
    
    // 9️⃣ OBSERVATIONS DES PARTIES
    observationsBailleur: "",
    observationsLocataire: "",
    reserves: "",
    
    // 🔟 PHOTOS ET ANNEXES
    nombrePhotos: "",
    nombreAnnexes: "",
    
    // 1️⃣1️⃣ COMPARATIF ENTRÉE/SORTIE
    degradations: [{element: '', etatEntree: '', etatSortie: '', responsabilite: '', coutEstime: ''}],
    
    // 1️⃣2️⃣ RÉCAPITULATIF FINANCIER
    depotGarantieVerse: "",
    totalReparations: "",
    montantRestitue: "",
    montantRetenu: "",
    modalitesRestitution: "",
    
    // 1️⃣3️⃣ SIGNATURES
    signatureBailleur: "",
    signatureLocataire: "",
    signatureAgence: "",
    nombreExemplaires: "2",
    observationsSignatures: "",
    
    // 1️⃣5️⃣ DÉLAI DE CONTESTATION
    delaiObservationsComplementaires: "10",
    delaiChauffageCollectif: "1",
    mentionDelaiContestationActivee: "oui",
    precisionDelaiContestationSupplementaire: "",
    
    // 1️⃣6️⃣ COMPARAISON ENTRÉE/SORTIE DÉTAILLÉE
    referenceEdlEntree: "",
    dateEdlEntree: "",
    comparatifAutomatiqueActif: "non",
    syntheseEcarts: "",
    
    // 1️⃣7️⃣ USURE NORMALE VS DÉGRADATION
    qualifications: [{element: '', qualification: '', justification: '', photos: ''}],
    
    // 1️⃣8️⃣ GRILLE DE VÉTUSTÉ
    grilleVetuste: "aucune",
    grilleVetusteReference: "",
    equipements: [{nom: '', dateMiseEnService: '', dureVieTheorique: '', coefficientVetuste: ''}],
    
    // 1️⃣9️⃣ RACCORDEMENT AU DÉPÔT DE GARANTIE
    degradationsRetenuesSurDG: "non",
    estimationProvisoire: "",
    devisJoints: "non",
    montantEstimeDegradations: "",
    detailRetenueDG: "",
    
    // 2️⃣0️⃣ HORODATAGE & INTÉGRITÉ
    horodatageAutomatique: "oui",
    hashIntegrite: "",
    certificatIntegrite: "",
    signatureElectronique: "non",
    methodeSignature: "",
    timestampCreation: ""
  });
  
  // États fichiers pour état des lieux
  const [etatLieuxPhotosLogement, setEtatLieuxPhotosLogement] = useState<File[]>([]);
  const [etatLieuxPhotosCompteurs, setEtatLieuxPhotosCompteurs] = useState<File[]>([]);
  const [etatLieuxPlanLogement, setEtatLieuxPlanLogement] = useState<File[]>([]);
  const [etatLieuxDiagnostics, setEtatLieuxDiagnostics] = useState<File[]>([]);
  const [etatLieuxContratLocation, setEtatLieuxContratLocation] = useState<File[]>([]);
  const [etatLieuxEntreeReference, setEtatLieuxEntreeReference] = useState<File[]>([]);
  const [etatLieuxDevisReparation, setEtatLieuxDevisReparation] = useState<File[]>([]);
  const [etatLieuxAutresDocuments, setEtatLieuxAutresDocuments] = useState<File[]>([]);
  const [etatLieuxInventaireFiles, setEtatLieuxInventaireFiles] = useState<File[]>([]);
  const [etatLieuxVetusteFiles, setEtatLieuxVetusteFiles] = useState<File[]>([]);
  
  // État pour Mise en demeure
  const [miseEnDemeureData, setMiseEnDemeureData] = useState({
    // 1️⃣ IDENTIFICATION DU DESTINATAIRE (LOCATAIRE OU DÉFAILLANT)
    destinataireClientId: "",
    destinataireNom: "",
    destinatairePrenom: "",
    destinataireAdresse: "",
    destinataireEmail: "",
    destinataireTelephone: "",
    destinataireStatut: "", // "locataire" / "commercant_societe" / "garant"
    // Si société
    destinataireDenomination: "",
    destinataireFormeJuridique: "",
    destinataireSiren: "",
    destinataireRcs: "",
    destinataireRepresentantNom: "",
    destinataireRepresentantPrenom: "",
    
    // 2️⃣ IDENTIFICATION DE L'ÉMETTEUR (BAILLEUR / PROPRIÉTAIRE)
    emetteurClientId: "",
    emetteurNom: "",
    emetteurPrenom: "",
    emetteurDenomination: "",
    emetteurAdresse: "",
    emetteurEmail: "",
    emetteurTelephone: "",
    emetteurRepresentantNom: "",
    emetteurRepresentantPrenom: "",
    emetteurMandataire: "", // "oui" / "non"
    mandataireNom: "",
    mandataireType: "", // "agence" / "administrateur"
    mandataireAdresse: "",
    
    // 3️⃣ RAPPEL DU CONTRAT
    typeBail: "", // "vide" / "meuble" / "commercial"
    dateSignature: "",
    adresseBien: "",
    referenceContrat: "",
    dureeBail: "",
    montantLoyer: "",
    montantCharges: "",
    modalitesPaiement: "",
    clauseResolutoire: "", // "oui" / "non"
    garantieCaution: "", // "oui" / "non"
    
    // 4️⃣ TYPE DE MANQUEMENT
    manquements: [] as string[], // Array de manquements sélectionnés
    
    // A. Impayés de loyers
    impayesLoyers: [{
      mois: '',
      montantLoyer: '',
      montantCharges: '',
      montantTotal: '',
      retardsCumules: '',
      penalites: ''
    }],
    
    // B. Charges impayées
    chargesImpayees: "",
    montantChargesDetails: "",
    regularisationAnnuelleNonReglee: "",
    
    // C. Travaux non réalisés
    travauxDescription: "",
    reparationsNonEffectuees: "",
    degradationsConstatees: "",
    travauxUrgentsNecessaires: "",
    
    // D. Troubles du voisinage
    troublesTypes: [] as string[], // "bruits" / "odeurs" / "degradations_communes" / "animaux"
    troublesDescription: "",
    
    // E. Absence d'assurance
    absenceAssurance: "",
    dateResiliationAssurance: "",
    
    // F. Sous-location interdite
    sousLocationDescription: "",
    sousLocationAirbnb: "",
    
    // G. Occupation irrégulière
    occupationIrreguliereDescription: "",
    activiteNonAutorisee: "",
    transformationLogement: "",
    stockageDangereux: "",
    
    // H. Non-paiement dépôt de garantie
    depotGarantieImpaye: "",
    
    // 5️⃣ RAPPEL LÉGAL (généré automatiquement selon type de bail)
    // Géré automatiquement dans le template
    
    // 6️⃣ MONTANT TOTAL RÉCLAMÉ
    arriereLoy: "",
    arriereCharges: "",
    provisionsDues: "",
    interetsRetard: "",
    tauxInterets: "",
    fraisAnnexes: "",
    totalDu: "",
    
    // 7️⃣ DÉLAI IMPARTI
    delaiType: "", // "8_jours" / "30_jours" / "contractuel" / "libre"
    delaiJours: "",
    delaiContractuel: "",
    
    // 8️⃣ CONSÉQUENCES EN CAS D'INACTION
    consequences: [] as string[], // Array de conséquences
    
    // 9️⃣ FORME D'ENVOI
    formeEnvoi: "", // "lrar" / "huissier" / "electronique" / "double_garant"
    envoiGarant: "", // "oui" / "non"
    
    // 🔟 PIÈCES ANNEXÉES (fichiers)
    // Géré par des états séparés pour les fichiers
    
    // 1️⃣1️⃣ COORDONNÉES POUR RÈGLEMENT
    iban: "",
    adresseReglement: "",
    modalitesAcceptees: "",
    echelancierAutorise: "", // "oui" / "non"
    conditionsEchelancier: "",
    
    // 1️⃣2️⃣ CLAUSE DE TOLÉRANCE
    clauseToleranceActive: "oui",
    clauseToleranceTexte: "La présente mise en demeure ne vaut pas renonciation aux droits du bailleur. Toute tolérance est ponctuelle et ne crée aucun droit pour l'avenir.",
    
    // 1️⃣3️⃣ SIGNATURES
    signatureBailleur: "",
    signatureElectronique: "", // "oui" / "non"
    tamponProfessionnel: ""
  });
  
  // États fichiers pour mise en demeure
  const [medCopieBail, setMedCopieBail] = useState<File[]>([]);
  const [medHistoriqueLoyers, setMedHistoriqueLoyers] = useState<File[]>([]);
  const [medReleves, setMedReleves] = useState<File[]>([]);
  const [medNotificationsPrecedentes, setMedNotificationsPrecedentes] = useState<File[]>([]);
  const [medAttestationAssurance, setMedAttestationAssurance] = useState<File[]>([]);
  const [medPhotos, setMedPhotos] = useState<File[]>([]);
  const [medRapportHuissier, setMedRapportHuissier] = useState<File[]>([]);
  const [medTableauCalcul, setMedTableauCalcul] = useState<File[]>([]);
  
  // État pour Pacte de concubinage
  const [pacteConcubinageData, setPacteConcubinageData] = useState({
    // 1️⃣ IDENTIFICATION DES PARTIES
    // Concubin 1
    concubin1ClientId: "",
    concubin1Nom: "",
    concubin1Prenom: "",
    concubin1DateNaissance: "",
    concubin1LieuNaissance: "",
    concubin1Nationalite: "",
    concubin1Adresse: "",
    concubin1Profession: "",
    concubin1SituationFamiliale: "",
    // Concubin 2
    concubin2ClientId: "",
    concubin2Nom: "",
    concubin2Prenom: "",
    concubin2DateNaissance: "",
    concubin2LieuNaissance: "",
    concubin2Nationalite: "",
    concubin2Adresse: "",
    concubin2Profession: "",
    concubin2SituationFamiliale: "",
    // Enfants
    enfantsCommuns: "",
    nombreEnfantsCommuns: "",
    enfantsPrecedenteUnion: "",
    gardeEnfants: "",
    
    // 2️⃣ OBJET DU PACTE
    definitionConcubinage: "Union de fait, stable et continue entre deux personnes vivant en couple.",
    aspectsCouvert: [],
    
    // 3️⃣ ADRESSE RÉSIDENCE COMMUNE
    adresseResidenceCommune: "",
    natureLogement: "",
    titulaireBail: "",
    detailsLogement: "",
    
    // 4️⃣ RÉPARTITION DES CHARGES
    modeRepartitionCharges: "",
    partConcubin1Charges: "",
    partConcubin2Charges: "",
    detailsRepartitionPersonnalisee: "",
    chargesConcernees: [],
    compteCommun: "",
    detailsCompteCommun: "",
    
    // 5️⃣ PROPRIÉTÉ DES BIENS
    principeBiens: "",
    biensAvantVieCommune: "",
    biensPendantVieCommune: "",
    inventaireBiens: "",
    vehicules: "",
    
    // 6️⃣ GESTION DÉPENSES IMPORTANTES
    seuilDepenseImportante: "",
    modaliteAccordDepense: "",
    typesDepensesImportantes: "",
    
    // 7️⃣ OBLIGATIONS RESPECTIVES
    obligationsRespectives: [],
    autresEngagements: "",
    
    // 8️⃣ PRÉVOYANCE DONATIONS
    testament: "",
    detailsTestament: "",
    donation: "",
    detailsDonation: "",
    assuranceVie: "",
    detailsAssuranceVie: "",
    autresPrevoyance: "",
    
    // 9️⃣ GESTION DES DETTES
    dettesCommunes: "",
    dettesPersonnelles: "",
    nonSolidariteDettes: "",
    precisionsSolidarite: "",
    
    // 🔟 SÉPARATION RUPTURE
    modalitesRupture: "",
    dureePreavissRupture: "",
    repartitionBiensRupture: "",
    sortLogement: "",
    remboursements: "",
    autresModalitesSeparation: "",
    
    // 1️⃣1️⃣ ENFANTS
    inclureEnfants: "",
    contributionEnfants: "",
    gardeEnfantsSeparation: "",
    pensionAlimentaire: "",
    autresDispositionsEnfants: "",
    
    // 1️⃣2️⃣ CONFIDENTIALITÉ
    confidentialite: "",
    reglementAmiable: "",
    modalitesMediation: "",
    
    // 1️⃣3️⃣ LOI APPLICABLE
    loiApplicable: "Droit français",
    tribunalCompetent: "",
    
    // 1️⃣5️⃣ SIGNATURES
    modeSignature: "",
    lieuSignature: "",
    dateSignature: "",
  });
  
  // États fichiers pour pacte de concubinage
  const [pacteInventaireMeubles, setPacteInventaireMeubles] = useState<File[]>([]);
  const [pacteJustificatifsAcquisitions, setPacteJustificatifsAcquisitions] = useState<File[]>([]);
  const [pacteTableauRepartition, setPacteTableauRepartition] = useState<File[]>([]);
  const [pacteAttestationVieCommune, setPacteAttestationVieCommune] = useState<File[]>([]);

  // ========== CONVENTION PARENTALE ==========
  const [conventionParentaleData, setConventionParentaleData] = useState({
    // 1️⃣ Identification Parent 1
    parent1ClientId: "",
    parent1Nom: "",
    parent1Prenom: "",
    parent1DateNaissance: "",
    parent1LieuNaissance: "",
    parent1Nationalite: "",
    parent1Adresse: "",
    parent1Profession: "",
    parent1Telephone: "",
    parent1Email: "",
    
    // Identification Parent 2
    parent2ClientId: "",
    parent2Nom: "",
    parent2Prenom: "",
    parent2DateNaissance: "",
    parent2LieuNaissance: "",
    parent2Nationalite: "",
    parent2Adresse: "",
    parent2Profession: "",
    parent2Telephone: "",
    parent2Email: "",
    
    // Informations complémentaires
    parentsSepares: "", // oui / non
    divorceEnCours: "", // oui / non
    adresseFutureApresSepar: "",
    
    // 2️⃣ Enfants (array)
    enfants: [],
    
    // 3️⃣ Autorité parentale
    typeAutoriteParentale: "conjointe", // conjointe / exclusive
    parentAutoriteExclusive: "", // parent1 / parent2
    engagementInteretSuperieur: "oui",
    
    // 4️⃣ Résidence habituelle
    typeResidence: "", // parent1 / parent2 / alternee / alterneeAmenagee
    adresseResidence: "",
    // Résidence alternée
    modaliteAlternance: "", // 1semaine / 2-2-3 / impaires-paires / personnalise
    planningDetaille: "",
    modalitesTransition: "",
    
    // 5️⃣ Droit de visite et hébergement
    typeDVH: "", // classique / elargi / progressif / personnalise
    // DVH classique
    weekendsClassiques: "", // 1er-3eme / alternes
    heureDebut: "",
    heureFin: "",
    lieuEchange: "",
    // DVH progressif
    visiteEnPresence: "", // oui / non
    dureeLimitee: "",
    progressionMois: "",
    // DVH personnalisé
    planningPersonnalise: "",
    
    // 6️⃣ Vacances scolaires
    vacancesNoel: "",
    vacancesHiver: "",
    vacancesPrintemps: "",
    vacancesEteJuillet: "",
    vacancesEteAout: "",
    pontsEtFeries: "",
    modalitesAlternanceVacances: "", // alternance / quinzaine / choix
    
    // 7️⃣ Pension alimentaire
    montantPension: "",
    baremeCafUtilise: "", // oui / non
    revenusParent1: "",
    revenusParent2: "",
    fraisEnfant: "",
    jourPaiement: "",
    modePaiement: "virement", // virement / direct
    indexationAnnuelle: "", // oui / non
    fraisMedicaux: "",
    fraisScolaires: "",
    fraisPeriscolaires: "",
    fraisExceptionnels: "",
    repartitionFrais: "50/50",
    
    // 8️⃣ Frais extraordinaires
    definitionFraisExtraordinaires: "",
    repartitionFraisExtra: "50/50",
    accordPrealable: "", // oui / non
    delaiPaiement: "",
    justificatifsNecessaires: "", // oui / non
    
    // 9️⃣ Santé et éducation
    suiviMedical: "",
    decisionsMedicalesImportantes: "",
    doubleInformation: "oui",
    coordonneesPediatre: "",
    etablissementScolaire: "",
    activitesExtraScolaires: "",
    orientationScolaire: "",
    financementActivites: "",
    
    // �� Communication entre parents
    modeCommunication: "", // email / sms / application
    applicationUtilisee: "",
    delaisReponse: "",
    obligationInformation: [],
    
    // 1️⃣1️⃣ Transports et déplacements
    responsableTransportAller: "",
    responsableTransportRetour: "",
    lieuEchangeTransport: "",
    repartitionCoutsTransport: "",
    toleranceRetards: "",
    autorisationVoyageHorsFrance: "", // oui / non
    dureeMaximaleVoyage: "",
    
    // 1️⃣2️⃣ Objets personnels
    affairesChequeParent: "",
    gestionVetements: "",
    carnetSante: "",
    cartableFournitures: "",
    ordinateurScolaire: "",
    
    // 1️⃣3️⃣ Relations famille élargie
    droitGrandsParents: "oui",
    respectLiensFamiliaux: "oui",
    
    // 1️⃣4️⃣ Respect mutuel
    engagementNonDenigrement: "oui",
    engagementNonImplication: "oui",
    
    // 1️⃣5️⃣ Modification convention
    modificationAccordEcrit: "oui",
    obligationRenegociation: "oui",
    recoursMediation: "", // oui / non
    
    // 1️⃣6️⃣ Homologation
    souhaitHomologation: "", // oui / non
    tribunalCompetent: "",
    
    // 1️⃣7️⃣ Date et lieu de signature
    lieuSignature: "",
    dateSignature: "",
  });
  
  // États fichiers pour convention parentale
  const [conventionPiecesIdentite, setConventionPiecesIdentite] = useState<File[]>([]);
  const [conventionLivretFamille, setConventionLivretFamille] = useState<File[]>([]);
  const [conventionCertificatsScolarite, setConventionCertificatsScolarite] = useState<File[]>([]);
  const [conventionCalendrierVacances, setConventionCalendrierVacances] = useState<File[]>([]);
  const [conventionJustificatifsRevenus, setConventionJustificatifsRevenus] = useState<File[]>([]);
  const [conventionAttestationsMedicales, setConventionAttestationsMedicales] = useState<File[]>([]);

  // ========== RECONNAISSANCE DE DETTES ==========
  const [reconnaissanceDetteData, setReconnaissanceDetteData] = useState({
    // 1️⃣ Identification du débiteur
    debiteurTypePersonne: "physique", // physique / morale
    // Personne physique
    debiteurClientId: "",
    debiteurNom: "",
    debiteurPrenom: "",
    debiteurDateNaissance: "",
    debiteurLieuNaissance: "",
    debiteurAdresse: "",
    debiteurNationalite: "",
    debiteurProfession: "",
    debiteurEmail: "",
    debiteurTelephone: "",
    // Personne morale
    debiteurDenomination: "",
    debiteurFormeJuridique: "",
    debiteurSiren: "",
    debiteurRcs: "",
    debiteurSiegeSocial: "",
    debiteurRepresentant: "",
    
    // 2️⃣ Identification du créancier
    creancierTypePersonne: "physique", // physique / morale
    // Personne physique
    creancierClientId: "",
    creancierNom: "",
    creancierPrenom: "",
    creancierDateNaissance: "",
    creancierLieuNaissance: "",
    creancierAdresse: "",
    creancierNationalite: "",
    creancierProfession: "",
    creancierEmail: "",
    creancierTelephone: "",
    // Personne morale
    creancierDenomination: "",
    creancierFormeJuridique: "",
    creancierRcs: "",
    creancierRepresentant: "",
    
    // 3️⃣ Montant exact de la dette
    montantChiffres: "",
    montantLettres: "",
    devise: "EUR",
    
    // 4️⃣ Origine de la dette
    origineDette: "", // pret / avance / solde_associes / solde_prestation / achat / familiale / remboursement_depenses
    descriptionOrigine: "",
    
    // 5️⃣ Date de remise des fonds
    dateRemiseFonds: "",
    moyenRemise: "", // virement / cheque / especes / main_propre
    
    // 6️⃣ Modalités de remboursement
    typeRemboursement: "", // une_fois / echelonne
    dateLimiteRemboursement: "",
    // Remboursement échelonné
    nombreEcheances: "",
    montantEcheance: "",
    calendrierEcheances: "",
    // Remboursement anticipé
    remboursementAnticipeAutorise: "", // oui / non
    fraisIndemnite: "",
    
    // 7️⃣ Intérêts
    tauxInteret: "0",
    typeTaux: "", // fixe / legal / contractuel
    pointDepartInterets: "", // remise_fonds / echeance / retard
    capitalisationInterets: "", // oui / non
    
    // 8️⃣ Garanties
    typesGaranties: [], // caution / nantissement / hypotheque / retenue_salaire
    // Caution
    cautionIdentite: "",
    cautionType: "", // simple / solidaire
    cautionDuree: "",
    cautionMontantMax: "",
    // Nantissement
    nantissementTypeBien: "",
    nantissementValeur: "",
    nantissementLieu: "",
    
    // 9️⃣ Conséquences non-paiement
    exigibiliteImmediate: "oui",
    interetsRetard: "",
    clausePenale: "",
    actionsLegales: [],
    
    // �� Reconnaissance expresse (auto-générée)
    reconnaissanceExpresse: "oui",
    
    // 1️⃣1️⃣ Renonciation contestation
    renonciationContestation: "", // oui / non
    
    // 1️⃣2️⃣ Clause domiciliation
    accepteDomiciliation: "oui",
    
    // 1️⃣3️⃣ Loi applicable & juridiction
    loiApplicable: "Droit français",
    tribunalCompetent: "",
    
    // 1️⃣4️⃣ Date et lieu de signature
    lieuSignature: "",
    dateSignature: "",
  });
  
  // États fichiers pour reconnaissance de dettes
  const [reconnaissanceCopiesIdentites, setReconnaissanceCopiesIdentites] = useState<File[]>([]);
  const [reconnaissancePreuvePaiement, setReconnaissancePreuvePaiement] = useState<File[]>([]);
  const [reconnaissanceCalendrier, setReconnaissanceCalendrier] = useState<File[]>([]);
  const [reconnaissanceGaranties, setReconnaissanceGaranties] = useState<File[]>([]);
  const [reconnaissanceReleveBancaire, setReconnaissanceReleveBancaire] = useState<File[]>([]);
  const [reconnaissancePreuveRemise, setReconnaissancePreuveRemise] = useState<File[]>([]);
  
  // ========== MANDAT DE PROTECTION FUTURE SOUS SEING PRIVÉ ==========
  const [mandatProtectionSousSeingData, setMandatProtectionSousSeingData] = useState({
    // 1️⃣ Identification du mandant
    mandantClientId: "",
    mandantNom: "",
    mandantPrenom: "",
    mandantDateNaissance: "",
    mandantLieuNaissance: "",
    mandantNationalite: "",
    mandantAdresse: "",
    mandantProfession: "",
    mandantSituationFamiliale: "",
    mandantCapaciteJuridique: "Pleine capacité",
    mandantTypeIdentite: "",
    mandantNumeroIdentite: "",
    
    // 2️⃣ Identification du mandataire
    mandataireClientId: "",
    mandataireNom: "",
    mandatairePrenom: "",
    mandataireDateNaissance: "",
    mandataireLieuNaissance: "",
    mandataireNationalite: "",
    mandataireAdresse: "",
    mandataireLienMandant: "", // famille / ami / autre
    mandataireProfession: "",
    mandataireTelephone: "",
    mandataireEmail: "",
    mandataireAcceptationExpresse: "", // oui / non
    // Mandataire substitut
    mandataireSubstitutNom: "",
    mandataireSubstitutPrenom: "",
    mandataireSubstitutAdresse: "",
    mandataireSubstitutTelephone: "",
    
    // 3️⃣ Type de mandat
    typeMandat: "", // personne / patrimoine / global
    
    // 4️⃣ Entrée en vigueur
    entreeVigueurCondition: "Survenance d'une altération des facultés",
    certificationMedicaleRequise: "oui",
    medecinsHabilites: "",
    dateEffet: "Date mentionnée sur certificat médical",
    
    // 5️⃣ Pouvoirs du mandataire - Actes d'administration
    pouvoirPaiementFactures: "non",
    pouvoirGestionCompteCourant: "non",
    pouvoirSouscriptionContrats: "non",
    pouvoirGestionAidesSociales: "non",
    pouvoirGestionLoyers: "non",
    pouvoirRenouvellementContrats: "non",
    pouvoirPlacementFinancier: "non",
    pouvoirDeclarationFiscale: "non",
    pouvoirGestionAssurances: "non",
    pouvoirGestionAdministrative: "non",
    
    // Actes interdits (automatiquement exclus)
    mentionActesInterdits: "oui", // toujours oui
    
    // 6️⃣ Pouvoirs personnels
    pouvoirRdvMedicaux: "non",
    pouvoirAccesDossiersMedicaux: "non",
    pouvoirChoixEtablissementMedical: "non",
    pouvoirChoixLogement: "non",
    pouvoirOrganisationQuotidien: "non",
    pouvoirRelationsAdministrations: "non",
    pouvoirAidesRsaApa: "non",
    pouvoirCaisseRetraite: "non",
    
    // 7️⃣ Obligations du mandataire
    obligationInteretExclusif: "oui",
    obligationLoyauteDiligence: "oui",
    obligationCompteGestion: "oui",
    obligationRendreCompte: "oui",
    obligationControleJudiciaire: "oui",
    
    // 8️⃣ Rémunération
    mandatGratuit: "", // oui / non
    indemniteAnnuelle: "",
    fraisRemboursables: "", // oui / non
    modalitesPreuveDepenses: "",
    
    // 9️⃣ Durée du mandat
    dureeMandat: "Jusqu'à amélioration ou décès",
    suspensionSiTutelle: "oui",
    caduciteAutomatique: "oui",
    
    // �� Contrôle du mandat
    personneConfianceDesignee: "", // oui / non
    personneConfianceNom: "",
    controleAmiableFamille: "", // oui / non
    possibiliteSaisineJuge: "oui",
    presentationComptesAnnuelle: "oui",
    
    // 1️⃣1️⃣ Révocation
    revocationParMandant: "oui",
    revocationParJuge: "oui",
    demissionMandataire: "oui",
    obligationInformer: "oui",
    
    // 1️⃣2️⃣ Règles spéciales (optionnelles)
    directivesAnticipees: "",
    clauseHebergementInstitution: "", // oui / non
    clauseGestionAnimaux: "",
    clauseBiensPersonnels: "",
    
    // 1️⃣4️⃣ Signatures
    lieuSignature: "",
    dateSignature: "",
    
    // 1️⃣5️⃣ Mention manuscrite (auto-générée)
    mentionManuscrite: "",
  });
  
  // États fichiers pour mandat protection
  const [mandatCarteIdentiteMandant, setMandatCarteIdentiteMandant] = useState<File[]>([]);
  const [mandatCarteIdentiteMandataire, setMandatCarteIdentiteMandataire] = useState<File[]>([]);
  const [mandatJustificatifDomicile, setMandatJustificatifDomicile] = useState<File[]>([]);
  const [mandatCertificatMedical, setMandatCertificatMedical] = useState<File[]>([]);
  const [mandatListeComptesBancaires, setMandatListeComptesBancaires] = useState<File[]>([]);
  const [mandatInventaireBiens, setMandatInventaireBiens] = useState<File[]>([]);
  const [mandatCoordonneesProches, setMandatCoordonneesProches] = useState<File[]>([]);

  const [questionnaireData, setQuestionnaireData] = useState({
    // Type de contrat
    typeContrat: "", // "compromis" ou "promesse_unilaterale"
    
    // Informations sur le bien
    adresseBien: "",
    typeBien: "",
    surfaceHabitable: "",
    nombrePieces: "",
    naturePropriete: "", // Pleine propriété / Usufruit / Nue-propriété / Indivision
    bienCopropriete: "", // Oui / Non
    numeroLot: "",
    tantièmes: "",
    occupationBien: "", // Libre / Occupé par le vendeur / Occupé par un locataire / Bail en cours
    servitudesConnues: "", // Oui / Non
    descriptionServitudes: "",
    bienLibre: "", // Oui / Non
    
    // Client et son rôle
    clientId: "",
    clientRole: "", // "acheteur" ou "vendeur"
    
    // Statut matrimonial client
    statutMatrimonialClient: "", // Célibataire / Marié / Pacsé / Divorcé / Veuf
    regimeMatrimonialClient: "", // Communauté légale / Séparation de biens / Autre
    precisionRegimeClient: "",
    
    // Informations autre partie (saisie manuelle)
    nomAutrePartie: "",
    prenomAutrePartie: "",
    adresseAutrePartie: "",
    
    // Statut matrimonial autre partie
    statutMatrimonialAutrePartie: "",
    regimeMatrimonialAutrePartie: "",
    precisionRegimeAutrePartie: "",
    
    // Conditions financières
    prixVente: "",
    depotGarantie: "",
    modalitesPaiement: "",
    
    // Conditions suspensives - Prêt immobilier
    conditionPret: "", // Oui / Non
    montantPret: "",
    dureePret: "",
    tauxInteretMax: "",
    delaiAccordPret: "",
    
    // Conditions suspensives - Autres
    conditionDiagnostics: "",
    autresConditions: "",
    
    // Droit de préemption
    droitPreemptionUrbain: "", // Oui / Non / Inconnu
    locatairePreemption: "", // Oui / Non
    
    // Délais
    dateSignatureActeDefinitif: "",
    delaiReflexion: "",
    
    // Promesse unilatérale spécifique
    dureeOption: "",
    dateLimiteOption: "",
    indemniteImmobilisation: "",
    
    // Informations complémentaires
    chargesCopropriete: "",
    travauxAPrevenir: "",
    autresInformations: "",
  });

  // State pour convention d'indivision
  const [indivisionData, setIndivisionData] = useState({
    // Informations générales
    typeBien: "immobilier", // immobilier / mobilier / autre
    origine: "", // succession / achat_commun / investissement / donation / autre
    objet: "", // Texte libre
    
    // Indivisaires (tableau)
    indivisaires: [{
      id: 1,
      isClient: false, // true si c'est un de nos clients
      clientId: "",
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      situationFamiliale: "", // celibataire / marie / pacse / divorce / veuf
      regimeMatrimonial: "", // communaute / separation / participation / autre
      typeIdentite: "",
      numeroIdentite: "",
      email: "",
      telephone: "",
      quotePart: "", // % de propriété
      origineQuotePart: "", // heritage / achat / donation...
      origineQuotePartAutre: "", // Si origine = autre
    }],
    
    // Description du bien
    description: {
      typeBien: "immobilier",
      immobilier: {
        adresse: "",
        nature: "", // maison / appartement / terrain / immeuble / local_commercial / autre
        description: "",
        surface: "",
        cadastre: "",
        etatLocatif: "", // libre / loue / occupe
        loyer: "",
        valeurVenale: "",
      },
      mobilier: {
        description: "",
        valeurEstimee: "",
        numerosIdentification: "",
      }
    },
    
    // Durée de la convention
    duree: {
      type: "indeterminee", // indeterminee / determinee
      annees: "", // Si déterminée (max 5 ans)
      conditionsRenouvellement: "",
      conditionsSortie: "",
    },
    
    // Gestion
    gestion: {
      gerant: "",
      pouvoirs: {
        gestion_courante: false,
        travaux: false,
        representation: false,
        signature_actes: false,
      },
      decisions: "", // unanimite / majorite_2_3 / majorite_simple
      charges: "",
      compteBancaire: "",
      repartitionDepensesExceptionnelles: "", // Nouvelle section
      repartitionRevenus: "", // Nouvelle section
    },
    
    // Utilisation du bien
    utilisation: {
      utilisationParIndivisaires: "non",
      conditionsUtilisation: "",
      indemniteOccupation: "non", // Nouvelle section: oui/non/conditions
      indemniteOccupationMontant: "", // Si oui ou conditions
      indemniteOccupationConditions: "", // Si conditions
      indemniteMontant: "",
      indemniteFrequence: "",
      locationAutorisee: "non",
      mandataireLocation: "",
      repartitionLoyers: "",
    },
    
    // Travaux
    travaux: {
      typesAutorises: "",
      decisionRequise: "",
      repartitionCouts: "",
      travauxUrgents: "",
      documentation: "",
    },
    
    // Sortie d'indivisaire
    sortie: {
      venteLibre: "libre", // libre / droit_preemption
      evaluationPart: "", // gerant / accord_indivisaires / expert / juge
      delaiRachat: "",
      modalitesPaiement: "",
    },
    
    // Vente du bien
    vente: {
      conditionsMiseEnVente: "",
      decisionRequise: "", // unanimite / majorite_2_3 / majorite_simple
      mandataire: "",
      repartitionPrix: "",
      gestionPlusValues: "",
    },
    
    // Comptabilité
    comptabilite: {
      registreDepenses: "non",
      archivageFactures: "",
      remboursementAvances: "",
      rapportAnnuel: "non",
    },
    
    // Litiges
    litiges: {
      modesResolution: {
        mediation: false,
        arbitrage: false,
        tribunal: false,
      },
      solidariteDettes: "non",
    },
    
    // Assurance (nouvelle section)
    assurance: {
      assuranceObligatoire: "oui",
      nomAssureur: "",
      numeroPolice: "",
      repartitionPrime: "",
      dateEcheance: "",
    },
  });

  // State pour la mainlevée d'hypothèque
  const [mainleveeData, setMainleveeData] = useState({
    // 1. Informations générales
    typeMainlevee: "totale", // totale / partielle / renonciation / substitution
    precisionPartielle: "",
    natureInscription: "hypotheque_conventionnelle", // hypotheque_conventionnelle / hypotheque_legale / hypotheque_judiciaire / privilege_ppd
    numeroInscription: "",
    dateInscription: "",
    volumeNumero: "",
    referencePartenaire: "",

    // 2. Créancier
    creancierType: "banque", // banque / personne_physique
    creancierBanque: {
      denominationSociale: "",
      formeJuridique: "",
      capitalSocial: "",
      adresseSiege: "",
      rcs: "",
      siren: "",
      representantNom: "",
      representantPrenom: "",
      representantFonction: "",
      pouvoirsType: "", // mandat / delegation / pv
    },
    creancierPersonne: {
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      statutMatrimonial: "",
      typeIdentite: "",
      numeroIdentite: "",
    },

    // 3. Débiteurs (tableau)
    debiteurs: [{
      id: 1,
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      situationFamiliale: "",
      regimeMatrimonial: "",
      typeIdentite: "",
      numeroIdentite: "",
      qualite: "emprunteur", // emprunteur / cofinanceur / caution_hypothecaire
    }],

    // 4. Acte constitutif
    acteOrigine: {
      dateSignature: "",
      natureActe: "acte_notarie", // acte_notarie / acte_sous_seing_prive
      notaireAuteur: "",
      datePublication: "",
      numeroPublication: "",
    },
    conditionsPret: {
      montantInitial: "",
      tauxInteret: "",
      dureePret: "",
      numeroContrat: "",
      etablissementPreteur: "",
      numeroDossier: "",
    },

    // 5. Bien hypothéqué (tableau pour gérer plusieurs biens)
    biens: [{
      id: 1,
      adresse: "",
      descriptionBien: "",
      typeBien: "", // maison / appartement / terrain / locaux / dependances
      modeDetention: "", // propriete_exclusive / indivision / communaute_acquets / separation_biens / autre
      quotepartsIndivision: "", // Si indivision
      autreRegime: "", // Si autre
      cadastreSection: "",
      cadastreParcelle: "",
      cadastreContenance: "",
      estCopropriete: "non",
      numeroLot: "",
      quotePart: "",
    }],

    // 6. Déclaration du créancier
    declaration: {
      creancePayee: true,
      aucuneDette: true,
      consentMainlevee: true,
      renonciation: true,
      demandeRadiation: true,
    },

    // 7. Mandat/Procuration
    mandataire: {
      existe: "non",
      nom: "",
      prenom: "",
      fonction: "",
      pouvoirSigner: false,
      pouvoirDeposer: false,
    },

    // 8. Consentement débiteur
    consentementDebiteur: {
      requis: "non",
      accordRadiation: false,
      declarationsComplementaires: "",
    },

    // 10. Frais
    frais: {
      fraisRadiation: "",
      honoraires: "",
      timbresFiscaux: "",
    },
  });

  // State pour contrat de mariage (régimes matrimoniaux)
  const [contratMariageData, setContratMariageData] = useState({
    // 1. Informations générales
    typeRegime: "", // separation_biens / communaute_acquets / communaute_acquets_amenagee / communaute_universelle / participation_acquets / autre
    autreRegimePrecision: "",
    typeContrat: "prenuptial", // prenuptial / changement_regime
    
    // Lieu et date du mariage (prénuptial)
    dateMariagePrevue: "",
    lieuMariage: {
      mairie: "",
      commune: "",
      departement: "",
      pays: "France",
    },
    
    // Si changement de régime
    dateMariage: "",
    regimeActuel: "", // separation_biens / communaute_legale / participation_acquets / communaute_universelle / regime_etranger / autre
    regimeActuelAutre: "",
    motifChangement: "",
    accordEnfantsMajeurs: "",
    accordCreancier: "",
    
    // Consentement enfants majeurs (si changement)
    consentementEnfantsMajeursRequis: "non",
    
    // Liquidation du régime actuel (si changement depuis régime communautaire)
    liquidationRegimeActuel: "non", // oui / non
    biensCommuns: [{
      id: 1,
      description: "",
      valeurEstimee: "",
      dettesAttachees: "",
      affectationPrevue: "", // epoux1 / epoux2 / vente / indivision
      repartitionEnvisagee: "", // conservé pour compatibilité
    }],
    passifCommun: [{
      id: 1,
      description: "",
      montant: "",
      modeRepartition: "", // epoux1 / epoux2 / 50_50
    }],
    soulte: {
      soulteDue: "non",
      montantSoulte: "",
      epouxDebiteur: "",
      modalitesPaiement: "", // comptant / echelonne
      dateLimitePaiement: "",
    },
    actifsFinanciers: [{
      id: 1,
      natureCompte: "",
      etablissement: "",
      solde: "",
      modePartage: "", // epoux1 / epoux2 / personnalise
      partagePersonnalise: "",
    }],
    observationsLiquidation: "",
    
    // Choix de la loi applicable (cas internationaux)
    choixLoiApplicable: "loi_francaise", // loi_francaise / loi_residence / loi_nationalite / autre
    choixLoiApplicableAutre: "",
    
    // Consentement juge (si enfants mineurs et changement)
    accordJugeRequis: "non",
    
    // 2. Époux (tableau de 2 personnes)
    epoux: [
      {
        id: 1,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        adresse: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationFamiliale: "", // celibataire / divorce / veuf
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        lieuEmissionIdentite: "",
        domicileActuel: "",
        domicileApresMariage: "",
        // Si mariage antérieur hors France
        mariageAnterieurtHorsFrance: "non",
        datePremierMariage: "",
        lieuPremierMariage: "",
        regimeMatrimonialInitial: "",
        acteEtatCivilEtranger: "",
      },
      {
        id: 2,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        adresse: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationFamiliale: "",
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        lieuEmissionIdentite: "",
        domicileActuel: "",
        domicileApresMariage: "",
        mariageAnterieurtHorsFrance: "non",
        datePremierMariage: "",
        lieuPremierMariage: "",
        regimeMatrimonialInitial: "",
        acteEtatCivilEtranger: "",
      },
    ],
    
    // 3. Informations sur les enfants
    nombreEnfants: "",
    enfantsMajeurs: [{
      id: 1,
      nom: "",
      prenom: "",
      adresse: "",
      accordInformation: "", // oui / non
    }],
    enfantsMineurs: "",
    informationJugeNecessaire: "",
    
    // 4. Patrimoine actuel des époux
    patrimoineEpoux1: {
      biensPropres: "",
      biensAcquisPendantMariage: "",
      valeurEstimee: "",
      dettesPersonnelles: "",
      dettesCommunes: "",
      masseDepart: "",
      masseFin: "",
    },
    patrimoineEpoux2: {
      biensPropres: "",
      biensAcquisPendantMariage: "",
      valeurEstimee: "",
      dettesPersonnelles: "",
      dettesCommunes: "",
      masseDepart: "",
      masseFin: "",
    },
    
    // 5. Clauses personnalisables selon le régime
    
    // A. Séparation de biens
    clausesSeparation: {
      administrationExclusive: false,
      comptesSepares: false,
      contributionCharges: "", // proportionnelle / 50_50 / autre
      contributionChargesAutre: "",
      miseEnCommunBien: "",
      abandonCreance: "",
    },
    
    // B. Communauté réduite aux acquêts aménagée
    clausesCommunauteAmenagee: {
      definitionBiensCommunsPropres: "",
      amenagementBiensProfessionnels: "",
      contributionCharges: "",
      repartitionDettes: "",
      typeAdministration: "", // symetriques / unique
      pouvoirUniqueDetails: "",
    },
    
    // C. Communauté universelle
    clausesCommunauteUniverselle: {
      tousLiensCommunsPresentsEtFuturs: true,
      attributionIntegraleSurvivant: "", // oui / non
      clausesPreciput: "",
      exclusionCertainsBiens: "",
    },
    
    // D. Participation aux acquêts
    clausesParticipation: {
      definitionPatrimoinesOriginels: "",
      definitionPatrimoineFinal: "",
      calculCreanceParticipation: "",
      renonciationCreance: "",
      biensPropresParNature: "",
    },
    
    // E. Clauses optionnelles avancées
    clausesAvancees: {
      clauseRemploi: "",
      clausePreciput: "",
      attributionPreferentielle: "",
      gestionSepareeBiensProfessionnels: "",
      protectionConjointSurvivant: "",
      donationEntreEpoux: "",
      solidariteDetteSpecifiques: "",
    },
    
    // 6. Déclarations obligatoires
    declarations: {
      identite: true,
      capaciteJuridique: true,
      situationMatrimoniale: true,
      absenceOpposition: true,
      choixLibreEclaire: true,
      connaissanceEffetsJuridiques: true,
    },
  });

  // State pour PACS
  const [pacsData, setPacsData] = useState({
    // 1. Informations générales sur le PACS
    objetPacs: "initial", // initial / modification / dissolution
    regimePacs: "separation", // separation / indivision / personnalise
    regimePersonnalise: {
      definitionBiensCommuns: "",
      biensPropres: "",
      clausesSpecifiques: "",
    },
    datePriseEffetSouhaitee: "",
    
    // Si modification de PACS
    pacsInitialDate: "",
    pacsInitialMairie: "",
    pacsInitialNumero: "",
    clausesModifiees: "",
    
    // 2. Partenaires (tableau de 2 personnes)
    partenaires: [
      {
        id: 1,
        isClient: false,
        clientId: "",
        // A. Informations civiles obligatoires
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseActuelle: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        telephone: "",
        email: "",
        // B. Informations pour contrôle juridique
        situationFamiliale: "", // celibataire / divorce / veuf
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        autoriteDelivrante: "",
        // C. Pour partenaire étranger
        estEtranger: false,
        attestationNonPacsPaysOrigine: false,
        certificatCoutumeRequis: false,
        traductionRequise: false,
      },
      {
        id: 2,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseActuelle: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        telephone: "",
        email: "",
        situationFamiliale: "",
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        autoriteDelivrante: "",
        estEtranger: false,
        attestationNonPacsPaysOrigine: false,
        certificatCoutumeRequis: false,
        traductionRequise: false,
      }
    ],
    
    // 3. Adresse commune (obligatoire)
    adresseCommune: "",
    dateDebutResidenceCommune: "",
    
    // 4. Clauses du PACS
    // A. Clauses obligatoires
    contributionCharges: "proportionnelle", // proportionnelle / 50_50 / autre
    contributionChargesAutre: "",
    
    // B. Clauses facultatives
    clausesFacultatives: {
      gestionBiensPersonnels: "",
      gestionBienCommun: "",
      usageBienIndivis: "",
      repartitionDepensesSpecifiques: "",
      clauseOccupationLogementSeparation: "",
      clauseRepriseBienDeces: "",
      clauseAbandonCreance: "",
      modalitesCompteBancaireCommun: "",
      clausesFinancieresPersonnalisees: "",
      clausesSolidariteDettes: "",
    },
    
    // 6. Déclarations sur l'honneur (obligatoires)
    declarations: {
      residenceCommune: false,
      absenceLienParente: false,
      absenceMariageEtPacs: false,
    },
    
    // 7. Cas particuliers
    // A. Enfant en commun
    enfantEnCommun: "non",
    enfants: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
      autoriteParentale: "",
    }],
    
    // B. Régimes patrimoniaux étrangers
    droitApplicable: "francais",
    droitApplicableAutre: "",
    
    // C. Biens déjà acquis ensemble
    biensPreexistants: "non",
    biensListe: [{
      id: 1,
      description: "",
      quotePart1: "",
      quotePart2: "",
      indivision: "",
    }],
  });

  // State pour Donation entre époux
  const [donationEntreEpouxData, setDonationEntreEpouxData] = useState({
    // 1. Informations générales sur la donation
    typeDonation: "au_dernier_vivant", // au_dernier_vivant / biens_presents / mixte
    objetDonation: [], // protection_conjoint / transmission_bien / partage_inegal / renforcement_droits
    datePrevueSignature: "",
    
    // 2. Identité complète des époux
    epoux: [
      {
        id: 1,
        isClient: false,
        clientId: "",
        // Informations civiles
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseComplete: "",
        telephone: "",
        email: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationMatrimoniale: "marie",
        // Régime matrimonial
        regimeMatrimonial: "", // communaute_legale / communaute_universelle / separation_biens / participation_acquets / autre
        regimeMatrimonialAutre: "",
        dateMariage: "",
        lieuMariage: "",
        existenceContratMariage: "non", // oui / non
        // Pièce d'identité
        typeIdentite: "",
        numeroIdentite: "",
        autoriteDelivrance: "",
        dateExpiration: "",
      },
      {
        id: 2,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseComplete: "",
        telephone: "",
        email: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationMatrimoniale: "marie",
        regimeMatrimonial: "",
        regimeMatrimonialAutre: "",
        dateMariage: "",
        lieuMariage: "",
        existenceContratMariage: "non",
        typeIdentite: "",
        numeroIdentite: "",
        autoriteDelivrance: "",
        dateExpiration: "",
      }
    ],
    
    // 3. Enfants et héritiers potentiels
    enfantsCommuns: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
    }],
    enfantsNonCommuns: [{
      id: 1,
      epoux: "1", // 1 ou 2
      nom: "",
      prenom: "",
      dateNaissance: "",
    }],
    parentsVivants: {
      epoux1: "non", // oui / non
      epoux2: "non",
    },
    autresHeritiers: "",
    
    // 4. Patrimoine des époux
    biensPropresEpoux1: [{
      id: 1,
      type: "", // immobilier / meuble / financier / autre
      description: "",
      valeur: "",
      origine: "", // heritage / donation / achat
    }],
    biensPropresEpoux2: [{
      id: 1,
      type: "",
      description: "",
      valeur: "",
      origine: "",
    }],
    biensCommuns: [{
      id: 1,
      description: "",
      valeur: "",
      partEpoux1: "",
      partEpoux2: "",
    }],
    droitsParticuliers: {
      nueProprieteBiens: "",
      usufruitBiens: "",
      biensIndivis: "",
      biensHypotheques: "",
    },
    
    // 5. Clauses de donation - Donation au dernier vivant
    donationDernierVivant: {
      // Options successorales
      optionsSuccessorales: [], // pleine_propriete_quotite / usufruit_universel / quart_pleine_3quarts_usufruit / choix_multiple / attribution_biens_specifiques
      biensSpecifiques: "",
      // Clause d'attribution préférentielle
      attributionPreferentielle: {
        active: false,
        logementFamilial: false,
        mobilier: false,
        bienProfessionnel: false,
        vehicule: false,
        autresBiens: "",
      },
      // Clause de préciput
      clausePreciput: {
        active: false,
        descriptionBien: "",
        effet: "", // hors_part / valorise_part
      },
      // Clause de cantonnement
      clauseCantonnement: false,
      // Clause d'exclusion
      clauseExclusion: {
        active: false,
        biensExclus: "",
        casParticuliers: "",
      },
    },
    
    // 5B. Clauses - Donation de biens présents
    donationBiensPresents: {
      biensDonnes: [{
        id: 1,
        nature: "", // immobilier / financier / meuble / entreprise / autre
        description: "",
        valeur: "",
        regimePropriete: "", // propre / commun / indivis
      }],
      irrevocabilite: "oui", // oui / non
      clauseRetourPredeces: "non", // oui / non
      reserveUsufruit: {
        active: false,
        conditions: "",
      },
    },
    
    // 6. Clauses communes
    clausesCommunes: {
      administrationGestion: "",
      conditionSuspensiveResolutoire: "",
      acceptationBeneficiaire: false,
      renonciationDroitsSuccessorauxStandards: false,
      clauseNonRevocation: false,
      // Révocabilité de la donation
      revocabilite: "revocable", // revocable / irrevocable
      motifsRevocation: [], // survenance_enfants / ingratitude / non_execution / revocation_libre
      // Mandataire éventuel
      signatureMandataire: "non", // oui / non
      mandataireEpoux1: {
        nom: "",
        prenom: "",
        typeProcuration: "", // sous_seing_prive / acte_notarie
      },
      mandataireEpoux2: {
        nom: "",
        prenom: "",
        typeProcuration: "",
      },
      // Information successorale obligatoire
      informationEffetsSuccessoraux: false,
    },
    
    // 7. Mentions légales (pré-remplies mais éditables)
    mentionsLegales: {
      articlesCodeCivil: true,
      effetsDonation: true,
      quotiteDisponible: true,
      limitesReserveHereditaire: true,
      declarationCapaciteJuridique: true,
      consentementEclaire: true,
      lectureActe: true,
      signaturesElectroniques: true,
    },
  });

  // State pour Mandat de protection future
  const [mandatProtectionData, setMandatProtectionData] = useState({
    // 1. Type de mandat
    typeMandat: [], // mandat_soi_meme, mandat_autrui, sous_seing_prive, acte_authentique, mandat_mixte
    mandatAutrui: {
      lienJuridique: "",
      justificationLegale: "",
    },
    
    // 2. Identité complète du mandant
    mandant: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      situationMatrimoniale: "", // celibataire, marie, divorce, veuf, pacse
      regimeMatrimonial: "",
      conjointNom: "",
      conjointPrenom: "",
      capaciteJuridique: "majeur_capable", // majeur_capable, sauvegarde_justice, curatelle, tutelle
      typeIdentite: "",
      numeroIdentite: "",
      dateEmissionIdentite: "",
      dateExpirationIdentite: "",
    },
    
    // 3. Identité complète du mandataire principal
    mandatairePrincipal: {
      nom: "",
      prenom: "",
      dateNaissance: "",
      lieuNaissance: "",
      adresseComplete: "",
      profession: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      dateExpirationIdentite: "",
      lienMandant: "", // conjoint, enfant, parent, ami, tiers_professionnel
      absenceIncapaciteLegale: false,
      absenceDecheanceAutorite: false,
      absenceInterdictionGestion: false,
      absenceMesureProtection: false,
      acceptationEcrite: false,
    },
    
    // 4. Mandataire substitut (optionnel)
    mandataireSubstitut: {
      existe: false,
      nom: "",
      prenom: "",
      dateNaissance: "",
      lieuNaissance: "",
      adresseComplete: "",
      profession: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      lienMandant: "",
      conditionsEntree: "",
      etenduePouvoirs: "",
    },
    
    // 5A. Pouvoirs sur la personne
    pouvoirsPersonne: {
      representationActesCourants: false,
      choixEtablissement: false,
      demarchesSociales: false,
      organisationSoins: false,
      gestionMedecins: false,
      gestionQuotidien: false,
      precisionsAutres: "",
    },
    
    // 5B. Pouvoirs sur le patrimoine - Actes d'administration
    pouvoirsAdministration: {
      gestionComptes: false,
      encaissementRevenus: false,
      paiementDepenses: false,
      renouvellementBail: false,
      souscriptionAssurances: false,
      entretienBiens: false,
    },
    
    // 5B. Pouvoirs sur le patrimoine - Actes de disposition
    pouvoirsDisposition: {
      venteImmobilier: false,
      achatImmobilier: false,
      donationMobilier: false,
      gestionTitres: false,
      resiliationBail: false,
      reglementDettes: false,
      acceptationSuccession: false,
      renonciationSuccession: false,
      donations: false,
      modificationsSuccessorales: false,
      actesGratuits: false,
      modificationContratMariage: false,
    },
    
    // 6. Liste des biens du mandant
    biensPatrimoine: {
      biensImmobiliers: "",
      comptesBancaires: "",
      assurancesVie: "",
      livretsEpargne: "",
      biensMobiliers: "",
      partsSociales: "",
      revenusReguliers: "",
      dettesExistantes: "",
    },
    
    // 7. Limites du mandat
    limites: {
      interdictionVenteCertainsBiens: false,
      biensConcernes: "",
      interdictionDeplacement: false,
      interdictionModificationContrats: false,
      montantMaximum: "",
      obligationComptesReguliers: false,
      periodiciteComptes: "", // mensuel, trimestriel, annuel
    },
    
    // 8. Contrôle du mandataire
    controle: {
      obligationCompteGestion: false,
      controlePersonne: false,
      controleIdentite: "",
      controlePouvoirs: "",
      controleNotaire: false,
      controleExpertComptable: false,
      compteRenduAnnuel: false,
      periodicite: "",
    },
    
    // 9. Conditions de mise en œuvre
    miseEnOeuvre: {
      certificatMedical: true,
      medecinListe: "",
      dateConstat: "",
      depotGreffe: false,
      notificationMandataire: false,
    },
    
    // 10. Fin du mandat
    finMandat: {
      finRetourFacultes: true,
      revocationMandant: true,
      destitutionJuge: true,
      decesMandant: true,
      remplacementSubstitut: false,
    },
    
    // 11. Déclarations obligatoires
    declarations: {
      volonteLibre: false,
      consentementSansPression: false,
      explicationComprise: false,
      acceptationActesDisposition: false,
      acceptationMandataire: false,
      droitRevocation: false,
    },
    
    // 12. Forme du mandat
    forme: {
      typeActe: "", // notarie / sous_seing_prive
      nomNotaire: "",
      villeOffice: "",
      dateSignature: "",
      datePriseEffet: "",
      lieuSignature: "",
      referenceLegale: "Articles 477 à 494 du Code civil",
    },
    
    // 13. Juridiction et conservation
    juridictionConservation: {
      tribunalCompetent: "",
      villeJuridiction: "",
      lieuConservation: "", // notaire / mandant / tiers
      precisionsConservation: "",
    },
    
    // 14. Frais et rémunération
    remuneration: {
      typeRemuneration: "", // gratuit / remunere
      modalitesRemuneration: "",
      remboursementFrais: false,
      precisionsRemboursement: "",
    },
    
    // 15. Clauses spéciales
    clausesSpeciales: {
      prioriteFamiliale: false,
      obligationInformationFamille: false,
      precisionsInformationFamille: "",
      ordreSubstitution: "",
      conditionsRemplacement: "",
      etenduePouvoirs: "",
      responsabiliteCivile: false,
      obligationInteretExclusif: true, // ⚠️ OBLIGATOIRE par la loi
      donationsAutorisees: "", // autorise / interdit / limite / presentsUsage
      beneficiairesAutorises: "",
    },
  });

  // State pour Attestation de propriété immobilière
  const [attestationData, setAttestationData] = useState({
    // 1. Informations sur le défunt
    defunt: {
      nom: "",
      prenom: "",
      nomNaissance: "",
      sexe: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseDecesComplete: "",
      dateDeces: "",
      lieuDeces: "",
      domicileFiscalCommune: "", // Nouveau : obligatoire pour SPF
      domicileFiscalPays: "", // Nouveau : obligatoire pour SPF
      situationMatrimoniale: "",
      regimeMatrimonial: "",
      regimeMatrimonialAutre: "", // Nouveau : si "autre" sélectionné
      dateContratMariage: "", // Nouveau : obligatoire si contrat
      notaireContratMariage: "", // Nouveau : obligatoire si contrat
      existenceContratMariage: false,
      existencePacs: false,
      existenceTestament: false,
      existenceDonationsEntreEpoux: false,
      existenceDonationsAnterieures: false,
    },
    
    // 2. Succession - Héritiers (array)
    heritiers: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
      lieuNaissance: "",
      lienParente: "",
      adresseComplete: "",
      email: "",
      telephone: "",
      nationalite: "",
      profession: "",
      typeAcceptation: "", // pure_simple / concurrence / renonciation
      statutAge: "", // majeur / mineur
      protectionJuridique: "", // aucune / tutelle / curatelle
      clientId: "", // Nouveau : lien vers clients existants
    }],
    
    // Conjoint survivant
    conjointSurvivant: {
      existe: false,
      nom: "",
      prenom: "",
      regimeMatrimonial: "",
      droitsConjoint: "", // usufruit / quart / testament / donation
    },
    
    // 3. Biens immobiliers (array)
    biens: [{
      id: 1,
      // A. Identité du bien
      adresseComplete: "",
      codePostal: "",
      commune: "",
      cadastreSection: "",
      cadastreNumero: "",
      cadastreContenance: "",
      
      // B. Description
      typeBien: "", // maison / appartement / terrain / commercial / garage
      surfaceHabitable: "",
      nombrePieces: "",
      dependances: "",
      annexes: "",
      equipements: "",
      situationLocative: "", // libre / occupe
      montantLoyer: "",
      
      // C. Origine de propriété
      dateAcquisition: "",
      natureAcquisition: "", // achat / donation / partage / succession
      repartitionDroits: "", // pleine / usufruit / indivision
      quotePart: "",
      notaireAcquisition: "", // Nouveau : obligatoire pour SPF
      datePublicationSPF: "", // Nouveau : obligatoire pour SPF
      volumeSPF: "", // Nouveau : obligatoire pour SPF
      numeroSPF: "", // Nouveau : obligatoire pour SPF
      
      // D. Servitudes
      servitudesActives: "",
      servitudesPassives: "",
      
      // E. Hypothèques
      pretEnCours: false,
      hypothequeInscrite: false,
      typeHypotheque: "",
      montantResiduel: "",
      necessitMainlevee: false,
      
      // F. Copropriété
      estCopropriete: false,
      numeroLot: "",
      quotepartCommunes: "",
      chargesAnnuelles: "",
      
      // G. Legs particuliers
      existenceLegsParticuliers: false, // Nouveau : obligatoire
      precisionLegs: "", // Nouveau : si legs existe
    }],
    
    // 4. Situation familiale
    regimeMatrimonial: "",
    droitsConjointSurvivant: "",
    
    // 5. Répartition des droits (calculé)
    repartitionDroits: {
      conjoint: "",
      heritiers: "",
    },
    
    // 6. Destination du bien
    destinationBien: "", // indivision / usage_conjoint / attribution / vente / location / aucune
    
    // 7. Déclarations
    loiSuccessoraleApplicable: "",
    confirmationAbsenceAutresHeritiers: false,
    indivisionSuccessorale: false, // Nouveau : mention obligatoire
    declarationFiscaleHonneur: false, // Nouveau : déclaration fiscale obligatoire
    
    // 8. Signatures
    dateSignature: "", // Nouveau : date de signature
    lieuSignature: "", // Nouveau : lieu de signature
    notaireInstrumentaire: "", // Nouveau : notaire signataire
    
    // 8. Évaluation
    valeurVenale: "",
    methodeEstimation: "", // expertise / avis / references
    valeurDeclareeFiscale: "",
    
    // 9. Formalités publiaires
    bureauSPF: "",
    fichesPreparees: false,
  });

  // State pour Quitus / Reconnaissance de dette
  const [quitusDetteData, setQuitusDetteData] = useState({
    // 1. Type d'acte
    typeActe: "", // reconnaissance_dette / reconnaissance_dette_modalites / quitus / quitus_partiel / remise_dette / solde_tout_compte / attestation_reglement
    
    // 2. Identité complète du créancier
    creancier: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      situationMatrimoniale: "",
      rib: "",
    },
    
    // 3. Identité complète du débiteur
    debiteur: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      situationMatrimoniale: "",
      rib: "",
    },
    
    // 4. Objet de la dette
    objetDette: {
      natureDette: "", // pret_argent / avance_fonds / aide_exceptionnelle / remboursement_depenses / participation_projet / dette_commerciale / dette_familiale
      dateNaissanceDette: "",
      circonstancesDette: "",
      preuveEcriteExiste: false,
      temoinsEventuels: "",
    },
    
    // 5. Montant de la dette
    montant: {
      montantTotal: "",
      devise: "EUR",
      sommeDejaRemboursee: "",
      sommeRestantDue: "",
      montantReconnuDebiteur: "",
      modalitePret: "", // transfert_bancaire / cheque / especes / virement
      dateExigibiliteSolde: "",
    },
    
    // 6. Conditions de remboursement
    remboursement: {
      modalite: "", // une_fois / plusieurs_echeances / libre / premiere_demande / conditionnel
      conditionRemboursement: "", // vente_bien / obtention_credit / autre
      
      // Échéancier (array)
      echeances: [{
        id: 1,
        date: "",
        montant: "",
        moyenPaiement: "",
        consequencesRetard: "",
      }],
      
      // Intérêts
      avecInterets: false,
      tauxInteret: "",
      tauxUsuraire: "",
      capitalisationInterets: false,
      
      // Clause pénale
      clausePenale: false,
      montantPenalite: "",
      pourcentagePenalite: "",
      delaiGrace: "",
    },
    
    // 7. Sûretés et garanties
    suretes: {
      cautionPersonnelle: false,
      cautionIdentite: "",
      cautionMontant: "",
      cautionDuree: "",
      
      garantieSalaire: false,
      
      gageMobilier: false,
      gageDescription: "",
      
      nantissementTitres: false,
      nantissementDetails: "",
      
      hypotheque: false,
      hypothequeDetails: "",
      
      depotGarantie: false,
      depotMontant: "",
      
      acteAuthentique: false,
      notaireNom: "",
    },
    
    // 8. Remise de dette (si applicable)
    remiseDette: {
      remiseTotale: false,
      remisePartielle: false,
      montantRemise: "",
      conditionsRemise: "",
      effetsRetroactifs: false,
      renonciationPoursuites: false,
      preuvesPaiementsPartiels: "",
    },
    
    // 9. Quitus (si dette réglée)
    quitus: {
      typeQuitus: "", // total / partiel / comptable
      
      // Paiements reçus (array)
      paiementsRecus: [{
        id: 1,
        date: "",
        montant: "",
        modePaiement: "",
        referenceBancaire: "",
      }],
      
      // Déclarations du créancier
      sommesRecuesTotalement: false,
      renonciationReclamations: false,
      detteEteinte: false,
      annulationGaranties: false,
      restitutionDocuments: false,
    },
    
    // 10. Clauses légales
    clausesLegales: {
      consentementLibre: false,
      reconnaissanceMontant: false,
      engagementRemboursement: false,
      mentionManuscrite: "",
      clauseSolidarite: false,
      clauseDivisibilite: false,
      extinctionDette: false,
      liberationDefinitive: false,
      renonciationRecours: false,
      identificationDette: "",
      clauseNonNovation: false,
      droitApplicable: "france",
      tribunalCompetent: "",
      pluraliteDebiteurs: false,
      solidarite: false,
    },
    
    // 11. Signatures et formalités
    signatures: {
      dateSignature: "",
      lieuSignature: "",
      dateExtinctionEffective: "",
      signatureNotaire: false,
      nomNotaire: "",
      villeNotaire: "",
    },
  });

  // State pour Cession de parts sociales
  const [cessionPartsData, setCessionPartsData] = useState({
    // 1. Type de société
    typeSociete: "", // sarl / sci / sas / snc / autre_personne
    
    // 2. Informations sur la société
    societe: {
      denominationSociale: "",
      sigle: "",
      formeJuridique: "",
      capitalSocial: "",
      siegeSocial: "",
      siren: "",
      rcs: "",
      greffeCompetent: "",
      activiteSociete: "",
      dateCreation: "",
      objetSocial: "",
      pacteAssocies: false,
      expertComptable: false,
      
      // Gérant/Président
      gerantNom: "",
      gerantPrenom: "",
      gerantAdresse: "",
      gerantPouvoirs: "",
    },
    
    // 3. Identité complète du cédant (vendeur)
    cedant: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      adresseComplete: "",
      email: "",
      telephone: "",
      dateNaissance: "",
      nationalite: "",
      profession: "",
      situationMatrimoniale: "",
      regimeMatrimonial: "",
      typeIdentite: "",
      numeroIdentite: "",
      qualiteSociete: "", // associe / gerant_president / associe_fondateur
    },
    
    // 4. Identité complète du cessionnaire (acheteur)
    cessionnaire: {
      typePersonne: "physique", // physique / morale
      
      // Personne physique
      clientId: "",
      nom: "",
      prenom: "",
      adresseComplete: "",
      email: "",
      telephone: "",
      dateNaissance: "",
      nationalite: "",
      profession: "",
      situationMatrimoniale: "",
      typeIdentite: "",
      numeroIdentite: "",
      capaciteJuridique: "majeur",
      
      // Personne morale
      denominationMorale: "",
      representantLegal: "",
    },
    
    // 5. Objet de la cession
    objetCession: {
      // A. Nature exacte des titres
      natureTitres: "", // parts_sociales / actions
      
      // B. Type de droits cédés
      typeDroits: "", // parts_sociales / actions / droits_indivis / compte_courant / cession_reprise_dette
      
      // C. Nombre de parts
      nombreParts: "",
      pourcentageCapital: "",
      
      // D. Valeur nominale
      valeurNominale: "",
      
      // E. Prix de cession
      prixTotal: "",
      prixUnitaire: "",
      modeCalcul: "", // valeur_marche / valeur_comptable / clause_statutaire
      
      // F. Modalités de paiement
      modalitePaiement: "", // comptant / echelonne / differe / conditionnel
      ribCedant: "",
      
      // G. Date d'effet de la cession
      dateEffetCession: "", // date_signature / date_differee
      dateEffetDifferee: "",
      
      // H. Conditions suspensives
      agrement: false,
      approbationConjoint: false,
      financementBancaire: false,
      leveeNantissement: false,
      
      // I. Clause de non-garantie de passif
      sansGarantiePassif: false,
    },
    
    // 6. Agrément (SARL & SCI)
    agrement: {
      procedureAgrement: "",
      organeCompetent: "", // assemblee_generale / gerant_president / autre
      dateDecisionAgrement: "",
      modeVoteMajorite: "",
      convocationAssocies: false,
      voteEffectue: false,
      majoriteRequise: "",
      notificationStatut: "", // acceptation / refus
      delaiLegalRespecte: false,
    },
    
    // 7. Compte courant d'associé
    compteCourant: {
      cessionCCA: false,
      maintienCCA: false,
      remboursementImmediat: false,
      remboursementEchelonne: false,
      compensationPrix: false,
      garantieSolde: false,
      montantSoldeCCA: "",
      detteVersTiers: false,
      natureDetteTiers: "",
      montantDetteTiers: "",
      creancierTiers: "",
      acceptationCreancier: false,
    },
    
    // 8. Garanties données par le cédant
    garanties: {
      // Garanties classiques
      garantieEviction: false,
      garantiePropriete: false,
      garantiePassif: "", // generale / limitee / aucune
      garantieActifNet: false,
      absenceNantissement: false,
      absenceLitiges: false,
      
      // Garanties renforcées
      plafondGarantie: "",
      dureeGarantie: "",
      exclusions: "",
      procedureMiseEnJeu: "",
    },
    
    // 9. Droit du conjoint
    conjoint: {
      identiteConjoint: "",
      acceptationCession: false,
      renonciationCession: false,
      signatureObligatoire: false,
      regimeMatrimonialPrecise: "",
    },
    
    // 10. Droits d'enregistrement (fiscal)
    droitsEnregistrement: {
      tauxApplicable: "", // 3_pourcent / 0_1_pourcent
      chargeDroits: "", // cessionnaire / cedant / autre
    },
    
    // 11. Clause de non-concurrence
    nonConcurrence: {
      clauseNonConcurrence: false,
      dureeNonConcurrence: "",
      zoneGeographique: "",
      activiteInterdite: "",
    },
    
    // 12. Notification à la société
    notificationSociete: {
      modeNotification: "", // signification_huissier / acceptation_acte
    },
    
    // 13. Déclarations légales obligatoires
    declarationsLegales: {
      consentementLibre: false,
      origineLiciteFonds: false,
      absenceFraude: false,
      acceptationPrix: false,
      transfertProprieteDateSignature: false,
      mentionStatutsMisAJour: false,
      mentionImpositionFiscale: false,
      renonciationDroitPreemption: false,
    },
    
    // 14. Mise à jour statuts et formalités
    formalites: {
      modificationCapital: false,
      miseAJourRegistreMouvements: false,
      miseAJourRegistreAssocies: false,
      depotGreffe: false,
      publicationLegale: false,
      informationBanques: false,
    },
    
    // 15. Signatures
    signatures: {
      dateSignature: "",
      lieuSignature: "",
      signatureNotaire: false,
      nomNotaire: "",
      villeNotaire: "",
    },
  });

  // State pour Procuration authentique
  const [procurationData, setProcurationData] = useState({
    // 1. Type de procuration
    typeProcuration: "",
    actesVises: "", // Si spéciale/immobilière/bancaire/fiscale
    
    // 2. Identité complète du mandant
    mandant: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      situationMatrimoniale: "",
      regimeMatrimonial: "",
      conjointNom: "",
      conjointPrenom: "",
      capaciteJuridique: "majeur_capable",
      typeMesureProtection: "", // tutelle/curatelle/sauvegarde
      autorisationJointe: false,
      typeIdentite: "",
      numeroIdentite: "",
      dateEmissionIdentite: "",
      autoriteEmettrice: "",
    },
    
    // 3. Identité complète du mandataire
    mandataire: {
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      lienMandant: "",
      typeIdentite: "",
      numeroIdentite: "",
      dateEmissionIdentite: "",
      autoriteEmettrice: "",
    },
    
    // 4. Objet précis de la procuration
    objet: {
      descriptionPrecise: "",
      listeActesAutorises: "",
      faculteSignerActes: false,
      faculteRecevoirSommes: false,
      // Si procuration immobilière
      immobilierVente: false,
      immobilierAchat: false,
      immobilierHypotheque: false,
      immobilierMainlevee: false,
      immobilierSignatureAvantContrats: false,
      immobilierAcceptationConditions: false,
      immobilierPercevoirPrix: false,
      faculteSubstituer: false,
    },
    
    // 5. Étendue des pouvoirs et limites
    etendue: {
      typeEtendue: "tres_large", // tres_large / limitee
      precisionsLimitees: "",
      actesExclus: "",
      subdelegation: "interdite", // autorisee / interdite
    },
    
    // 6. Durée - Révocation
    duree: {
      type: "indeterminee", // indeterminee / determinee
      dateFin: "",
      revocable: true,
    },
    
    // 7. Acceptation du mandataire
    acceptation: {
      type: "expresse", // expresse / tacite
      acceptationJourActe: true,
    },
    
    // 8. Déclarations essentielles du mandant
    declarations: {
      agitLibrement: false,
      pleineCapacite: false,
      comprendPortee: false,
      consentLibre: false,
      pouvoirIrrevocable: false,
    },
    
    // 9. Langue - Compréhension
    langue: {
      langueComprise: "Français",
      interpreteNecessaire: false,
      interpreteIdentite: "",
    },
    
    // 10. Comparution - Signature
    comparution: {
      typeComparution: "presence", // presence / distance
      lectureFaite: false,
      consentementRecueilli: false,
      typeSignature: "presentiel", // presentiel / distance
    },
    
    // 11. Mentions notariales
    mentionsNotariales: {
      nomNotaire: "",
      villeOffice: "",
      dateReception: "",
      lieuReception: "",
      acteRecuMinute: false,
    },
    
    // 12. Conservation - Copies
    conservation: {
      minuteConservee: false,
      copiesSimples: false,
      copiesCertifiees: false,
      copiesExecutoires: false,
    },
  });

  const navigate = useNavigate();

  // debounce
  useEffect(() => {
    const t = setTimeout(() => setDebounced(search.trim()), 300);
    return () => clearTimeout(t);
  }, [search]);

  // Détecte le rôle depuis l'URL
  let role: 'avocat' | 'notaire' = 'avocat';
  if (location.pathname.includes('/notaires')) role = 'notaire';
  if (location.pathname.includes('/avocats')) role = 'avocat';

  // ========== POINTEURS VERS LES BONS ÉTATS SELON LE RÔLE ==========
  // Cela permet d'avoir des formulaires complètement indépendants entre notaires et avocats
  // Sans avoir à dupliquer tout le code du formulaire
  
  // Pour le bail commercial : utiliser les états séparés par rôle
  // Les états notaireBail* et avocatBail* sont déclarés plus haut avec les états de fichiers séparés
  // Ici on crée juste des références vers le bon état selon le rôle
  
  // Utilisation directe de bailCommercialData et bailHabitationData
  // (ils restent séparés car chaque rôle a sa propre session)
  // Les états de fichiers séparés (notaire* et avocat*) sont déjà définis plus haut
  
  const mainButtonColor = role === 'notaire'
    ? 'bg-orange-600 hover:bg-orange-700 text-white'
    : 'bg-blue-600 hover:bg-blue-700 text-white';

  // Role-based menu/select styling
  const menuContentClass = role === 'notaire' ? 'bg-orange-50 border-orange-200' : 'bg-blue-50 border-gray-200';
  const menuItemClass = role === 'notaire' ? 'focus:bg-orange-600 focus:text-white hover:bg-orange-600 hover:text-white' : 'focus:bg-blue-600 focus:text-white hover:bg-blue-600 hover:text-white';
  const selectContentClass = role === 'notaire' ? 'bg-orange-50 border-orange-200' : 'bg-blue-50 border-gray-200';
  const selectItemClass = role === 'notaire' ? 'cursor-pointer hover:bg-orange-600 hover:text-white' : 'cursor-pointer hover:bg-blue-600 hover:text-white';

  // Charger les clients
  useEffect(() => {
    let isMounted = true;
    async function loadClients() {
      if (!user) return;
      const { data, error } = await supabase
        .from('clients')
        .select('id, nom, prenom, adresse, telephone, email, date_naissance, lieu_naissance, nationalite, profession, situation_matrimoniale, situation_familiale, etat_civil, type_identite, numero_identite, date_expiration_identite, id_doc_path')
        .eq('owner_id', user.id)
        .eq('role', role)
        .order('nom', { ascending: true });
      
      if (error) {
        console.error('Erreur chargement clients:', error);
      } else if (isMounted && data) {
        setClients(data);
      }
    }
    loadClients();
    return () => { isMounted = false; };
  }, [user, role]);

  // Pré-remplir les informations du client sélectionné (Compromis de vente)
  useEffect(() => {
    if (questionnaireData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === questionnaireData.clientId) as any;
      if (selectedClient) {
        console.log('📋 Client sélectionné:', selectedClient.nom, selectedClient.prenom);
        console.log('📄 id_doc_path:', selectedClient.id_doc_path);
        
        // Extraire la situation familiale de l'objet JSON
        let situationFamiliale = "";
        if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
          situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
        } else if (typeof selectedClient.situation_familiale === 'string') {
          situationFamiliale = selectedClient.situation_familiale;
        }
        
        setQuestionnaireData(prev => ({
          ...prev,
          statutMatrimonialClient: situationFamiliale || selectedClient.situation_matrimoniale || "",
        }));

        // Charger le document d'identité du client si disponible
        if (selectedClient.id_doc_path) {
          console.log('✅ Chargement du document depuis id_doc_path:', selectedClient.id_doc_path);
          // Générer l'URL signée pour accéder au document
          supabase.storage
            .from('documents')
            .createSignedUrl(selectedClient.id_doc_path, 3600)
            .then(({ data, error }) => {
              if (error) {
                console.error('❌ Erreur chargement document:', error);
                setCompromisClientIdentiteUrl(null);
              } else if (data?.signedUrl) {
                console.log('✅ Document chargé avec succès');
                setCompromisClientIdentiteUrl(data.signedUrl);
              }
            });
        } else {
          // Chercher dans client_documents si pas de id_doc_path
          console.log('🔍 Recherche dans client_documents pour client:', selectedClient.id);
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5) // Prendre les 5 plus récents
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents:', docsError);
                setCompromisClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) trouvé(s) pour ce client`);
                // Chercher d'abord piece_identite, sinon prendre le premier
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document:', error);
                      setCompromisClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document client_documents chargé avec succès');
                      setCompromisClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document trouvé dans client_documents');
                setCompromisClientIdentiteUrl(null);
              }
            });
        }
      }
    } else {
      setCompromisClientIdentiteUrl(null);
    }
  }, [questionnaireData.clientId, clients]);

  // Charger la pièce d'identité du mandant (Mandat de Protection Future)
  useEffect(() => {
    if (mandatProtectionData.mandant.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === mandatProtectionData.mandant.clientId) as any;
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement pièce identité mandant depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document mandant:', error);
              setMandatProtectionMandantIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document mandant chargé avec succès');
              setMandatProtectionMandantIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour mandant:', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .eq('document_type', 'piece_identite')
            .order('uploaded_at', { ascending: false })
            .limit(1)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents mandant:', docsError);
                setMandatProtectionMandantIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log('📄 Document trouvé dans client_documents:', docs[0].file_name);
                supabase.storage
                  .from('documents')
                  .createSignedUrl(docs[0].file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document mandant:', error);
                      setMandatProtectionMandantIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document mandant client_documents chargé avec succès');
                      setMandatProtectionMandantIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                setMandatProtectionMandantIdentiteUrl(null);
              }
            });
        } else {
          setMandatProtectionMandantIdentiteUrl(null);
        }
      }
    } else {
      setMandatProtectionMandantIdentiteUrl(null);
    }
  }, [mandatProtectionData.mandant.clientId, clients]);

  // Auto-fill depuis le client sélectionné selon son rôle (Acte de vente)
  useEffect(() => {
    if (acteVenteData.clientId && acteVenteData.clientRole && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === acteVenteData.clientId) as any;
      if (selectedClient) {
        // Extraire la situation familiale de l'objet JSON
        let situationFamiliale = "";
        if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
          situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
        } else if (typeof selectedClient.situation_familiale === 'string') {
          situationFamiliale = selectedClient.situation_familiale;
        }
        
        const statutMatrimonial = situationFamiliale || selectedClient.situation_matrimoniale || "";

        if (acteVenteData.clientRole === "vendeur") {
          setActeVenteData(prev => ({
            ...prev,
            // Remplir les infos du vendeur avec le client
            vendeurNom: selectedClient.nom || "",
            vendeurPrenom: selectedClient.prenom || "",
            vendeurAdresse: selectedClient.adresse || "",
            vendeurDateNaissance: selectedClient.date_naissance || "",
            vendeurLieuNaissance: selectedClient.lieu_naissance || "",
            vendeurNationalite: selectedClient.nationalite || "",
            vendeurProfession: selectedClient.profession || "",
            vendeurStatutMatrimonial: statutMatrimonial,
            vendeurPieceIdentite: selectedClient.type_identite || "",
            vendeurNumeroIdentite: selectedClient.numero_identite || "",
            // Vider les champs de l'acheteur
            acheteurNom: "",
            acheteurPrenom: "",
            acheteurAdresse: "",
            acheteurDateNaissance: "",
            acheteurLieuNaissance: "",
            acheteurNationalite: "",
            acheteurProfession: "",
            acheteurStatutMatrimonial: "",
          }));
        } else if (acteVenteData.clientRole === "acheteur") {
          setActeVenteData(prev => ({
            ...prev,
            // Remplir les infos de l'acheteur avec le client
            acheteurNom: selectedClient.nom || "",
            acheteurPrenom: selectedClient.prenom || "",
            acheteurAdresse: selectedClient.adresse || "",
            acheteurDateNaissance: selectedClient.date_naissance || "",
            acheteurLieuNaissance: selectedClient.lieu_naissance || "",
            acheteurNationalite: selectedClient.nationalite || "",
            acheteurProfession: selectedClient.profession || "",
            acheteurStatutMatrimonial: statutMatrimonial,
            // Vider les champs du vendeur
            vendeurNom: "",
            vendeurPrenom: "",
            vendeurAdresse: "",
            vendeurDateNaissance: "",
            vendeurLieuNaissance: "",
            vendeurNationalite: "",
            vendeurProfession: "",
            vendeurStatutMatrimonial: "",
            vendeurPieceIdentite: "",
            vendeurNumeroIdentite: "",
          }));
        }
      }
    }
  }, [acteVenteData.clientId, acteVenteData.clientRole, clients]);

  // Charger automatiquement le document d'identité du client pour l'acte de vente
  useEffect(() => {
    if (acteVenteData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === acteVenteData.clientId) as any;
      console.log('📋 Client acte sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path acte:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document acte depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document acte:', error);
              setActeClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document acte chargé avec succès');
              setActeClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour client (acte):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5) // Prendre les 5 plus récents
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents (acte):', docsError);
                setActeClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) acte trouvé(s) pour ce client`);
                // Chercher d'abord piece_identite, sinon prendre le premier
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document acte sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document acte:', error);
                      setActeClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document acte client_documents chargé avec succès');
                      setActeClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document trouvé dans client_documents (acte)');
                setActeClientIdentiteUrl(null);
              }
            });
        } else {
          setActeClientIdentiteUrl(null);
        }
      }
    } else {
      setActeClientIdentiteUrl(null);
    }
  }, [acteVenteData.clientId, clients]);

  // Charger la pièce d'identité du client (Bail d'habitation)
  // Auto-load carte d'identité bailleur bail commercial
  useEffect(() => {
    if (bailCommercialData.clientRole === "bailleur" && bailCommercialData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailCommercialData.clientId) as any;
      console.log('📋 Client bailleur bail commercial sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path bail commercial:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document bail commercial depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document bail commercial:', error);
              setBailCommercialBailleurClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document bail commercial chargé avec succès');
              setBailCommercialBailleurClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour client (bail commercial):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents (bail commercial):', docsError);
                setBailCommercialBailleurClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) bail commercial trouvé(s) pour ce client`);
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document bail commercial sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document bail commercial:', error);
                      setBailCommercialBailleurClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document bail commercial client_documents chargé avec succès');
                      setBailCommercialBailleurClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document bail commercial trouvé dans client_documents');
                setBailCommercialBailleurClientIdentiteUrl(null);
              }
            });
        } else {
          setBailCommercialBailleurClientIdentiteUrl(null);
        }
      }
    } else {
      setBailCommercialBailleurClientIdentiteUrl(null);
    }
  }, [bailCommercialData.clientId, bailCommercialData.clientRole, clients]);

  // Auto-load carte d'identité preneur bail commercial
  useEffect(() => {
    if (bailCommercialData.clientRole === "preneur" && bailCommercialData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailCommercialData.clientId) as any;
      console.log('📋 Client preneur bail commercial sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path bail commercial preneur:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document preneur bail commercial depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document preneur bail commercial:', error);
              setBailCommercialPreneurClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document preneur bail commercial chargé avec succès');
              setBailCommercialPreneurClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour preneur (bail commercial):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents preneur (bail commercial):', docsError);
                setBailCommercialPreneurClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) preneur bail commercial trouvé(s) pour ce client`);
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document preneur bail commercial sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document preneur bail commercial:', error);
                      setBailCommercialPreneurClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document preneur bail commercial client_documents chargé avec succès');
                      setBailCommercialPreneurClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document preneur bail commercial trouvé dans client_documents');
                setBailCommercialPreneurClientIdentiteUrl(null);
              }
            });
        } else {
          setBailCommercialPreneurClientIdentiteUrl(null);
        }
      }
    } else {
      setBailCommercialPreneurClientIdentiteUrl(null);
    }
  }, [bailCommercialData.clientId, bailCommercialData.clientRole, clients]);

  useEffect(() => {
    if (bailHabitationData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailHabitationData.clientId) as any;
      console.log('📋 Client bail sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path bail:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document bail depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document bail:', error);
              setBailClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document bail chargé avec succès');
              setBailClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour client (bail):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents (bail):', docsError);
                setBailClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) bail trouvé(s) pour ce client`);
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document bail sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document bail:', error);
                      setBailClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document bail client_documents chargé avec succès');
                      setBailClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document trouvé dans client_documents (bail)');
                setBailClientIdentiteUrl(null);
              }
            });
        } else {
          setBailClientIdentiteUrl(null);
        }
      }
    } else {
      setBailClientIdentiteUrl(null);
    }
  }, [bailHabitationData.clientId, clients]);

  // Charger automatiquement les pièces d'identité des héritiers depuis les clients
  useEffect(() => {
    const loadHeritiersIdentite = async () => {
      const allFiles: FileWithMetadata[] = [];
      
      for (const heritier of attestationData.heritiers) {
        if (heritier.clientId && clients.length > 0) {
          const selectedClient = clients.find(c => c.id === heritier.clientId) as any;
          const clientName = `${selectedClient?.prenom || ''} ${selectedClient?.nom || ''}`.trim();
          
          if (selectedClient?.id_doc_path) {
            console.log('✅ Chargement pièce identité héritier depuis id_doc_path:', selectedClient.id_doc_path);
            try {
              const { data, error } = await supabase.storage
                .from('documents')
                .download(selectedClient.id_doc_path);
              
              if (data && !error) {
                const fileName = selectedClient.id_doc_path.split('/').pop() || `identite_${heritier.nom}_${heritier.prenom}.pdf`;
                const file = new File([data], fileName, { type: data.type }) as FileWithMetadata;
                file._autoLoaded = true;
                file._clientName = clientName;
                allFiles.push(file);
                console.log('✅ Document héritier chargé:', fileName);
              }
            } catch (error) {
              console.error('❌ Erreur chargement identité héritier:', error);
            }
          } else if (selectedClient?.id) {
            // Chercher dans client_documents
            console.log('🔍 Recherche dans client_documents pour héritier:', selectedClient.id);
            try {
              const { data: docs, error: docsError } = await supabase
                .from('client_documents')
                .select('file_path, file_name, document_type')
                .eq('client_id', selectedClient.id)
                .eq('document_type', 'piece_identite')
                .order('uploaded_at', { ascending: false })
                .limit(1);
              
              if (docs && docs.length > 0 && !docsError) {
                const { data, error } = await supabase.storage
                  .from('documents')
                  .download(docs[0].file_path);
                
                if (data && !error) {
                  const file = new File([data], docs[0].file_name, { type: data.type }) as FileWithMetadata;
                  file._autoLoaded = true;
                  file._clientName = clientName;
                  allFiles.push(file);
                  console.log('✅ Document héritier chargé depuis client_documents:', docs[0].file_name);
                }
              }
            } catch (error) {
              console.error('❌ Erreur recherche client_documents héritier:', error);
            }
          }
        }
      }
      
      if (allFiles.length > 0) {
        setAttestationIdentiteHeritiers(allFiles);
        console.log(`📦 ${allFiles.length} document(s) héritier(s) chargé(s)`);
      }
    };
    
    if (attestationData.heritiers.some(h => h.clientId)) {
      loadHeritiersIdentite();
    }
  }, [attestationData.heritiers, clients]);

  // Auto-fill depuis le client sélectionné comme bailleur (Bail d'habitation)
  useEffect(() => {
    if (bailHabitationData.bailleurClientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailHabitationData.bailleurClientId) as any;
      if (selectedClient) {
        // Extraire la situation familiale de l'objet JSON
        let situationFamiliale = "";
        if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
          situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
        } else if (typeof selectedClient.situation_familiale === 'string') {
          situationFamiliale = selectedClient.situation_familiale;
        }

        setBailHabitationData(prev => ({
          ...prev,
          bailleurNom: selectedClient.nom || "",
          bailleurPrenom: selectedClient.prenom || "",
          bailleurAdresse: selectedClient.adresse || "",
          bailleurDateNaissance: selectedClient.date_naissance || "",
          bailleurLieuNaissance: selectedClient.lieu_naissance || "",
          bailleurNationalite: selectedClient.nationalite || "",
          bailleurProfession: selectedClient.profession || "",
          bailleurStatutMatrimonial: situationFamiliale || selectedClient.situation_matrimoniale || "",
          bailleurPieceIdentite: selectedClient.type_identite || "",
          bailleurNumeroIdentite: selectedClient.numero_identite || "",
        }));
      }
    }
  }, [bailHabitationData.bailleurClientId, clients]);

  // Détecter les paramètres URL pour ouvrir le questionnaire automatiquement
  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const shouldCreate = params.get('create') === 'true';
    const type = params.get('type');
    const category = params.get('category');
    
    if (shouldCreate && type && category) {
      console.log('📋 Ouverture du formulaire depuis URL:', type, category);
      setPendingContractType(type);
      setPendingCategory(category);
      
      // Ouvrir le dialogue après avoir défini les états
      requestAnimationFrame(() => {
        setShowQuestionDialog(true);
      });
      
      // Nettoyer l'URL après un délai pour laisser le dialogue se monter
      const timer = setTimeout(() => {
        window.history.replaceState({}, '', location.pathname);
      }, 500);
      
      return () => clearTimeout(timer);
    }
  }, [location.search]);

  useEffect(() => {
    let isMounted = true;
    async function load() {
      if (!user) {
        setContrats([]);
        setLoading(false);
        return;
      }
      setLoading(true);
      let query = supabase
        .from('contrats')
        .select('id,name,category,type,created_at,updated_at')
        .eq('owner_id', user.id)
        .eq('role', role)
        .order('created_at', { ascending: false });
      if (debounced) {
        query = query.or(`name.ilike.%${debounced}%,type.ilike.%${debounced}%`);
      }
      if (categoryFilter && categoryFilter !== 'Tous') {
        query = query.eq('category', categoryFilter);
      }
      const { data, error } = await query;
      if (error) {
        console.error('Erreur chargement contrats:', error);
        if (isMounted) setContrats([]);
      } else if (isMounted) {
        setContrats(data as ContratRow[]);
      }
      if (isMounted) setLoading(false);
    }
    load();
    return () => { isMounted = false; };
  }, [user, role, debounced, categoryFilter]);

  const createContract = async (contractType: string, categoryKey: string) => {
    if (!user) {
      toast.error("Connexion requise");
      return;
    }
    
    // Ouvrir le formulaire pour TOUS les types de contrats
    console.log('📋 Création contrat:', contractType, categoryKey);
    setPendingContractType(contractType);
    setPendingCategory(categoryKey);
    setShowQuestionDialog(true);
  };

  // Handler pour l'état des lieux
  const handleEtatLieuxSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires
    if (!etatLieuxData.typeEtatLieux || !etatLieuxData.adresseLogement || !etatLieuxData.dateEtatLieux ||
        !etatLieuxData.bailleurNom || !etatLieuxData.locataireNom) {
      toast.error("Champs obligatoires manquants", { 
        description: "Type, adresse, date, nom bailleur et locataire requis" 
      });
      return;
    }

    try {
      const description = `État des lieux ${etatLieuxData.typeEtatLieux === "entree" ? "d'entrée" : "de sortie"} - ${etatLieuxData.adresseLogement}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: etatLieuxData
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers
      for (const file of etatLieuxPhotosLogement) {
        const filePath = `${user.id}/${data.id}/photos_logement/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxPhotosCompteurs) {
        const filePath = `${user.id}/${data.id}/photos_compteurs/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxPlanLogement) {
        const filePath = `${user.id}/${data.id}/plan/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxDiagnostics) {
        const filePath = `${user.id}/${data.id}/diagnostics/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxContratLocation) {
        const filePath = `${user.id}/${data.id}/contrat_location/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxEntreeReference) {
        const filePath = `${user.id}/${data.id}/edl_entree_reference/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxDevisReparation) {
        const filePath = `${user.id}/${data.id}/devis_reparation/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of etatLieuxAutresDocuments) {
        const filePath = `${user.id}/${data.id}/autres_documents/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      toast.success("État des lieux créé");
      setShowQuestionDialog(false);
      setPendingContractType("");
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création état des lieux:', err);
      toast.error('Erreur lors de la création');
    }
  };

  // Handler pour le formulaire Mise en demeure
  const handleMiseEnDemeureSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires
    if (!miseEnDemeureData.destinataireNom || !miseEnDemeureData.destinataireAdresse ||
        !miseEnDemeureData.emetteurNom || !miseEnDemeureData.emetteurAdresse ||
        !miseEnDemeureData.typeBail || !miseEnDemeureData.adresseBien ||
        miseEnDemeureData.manquements.length === 0 || !miseEnDemeureData.totalDu ||
        !miseEnDemeureData.delaiType || !miseEnDemeureData.formeEnvoi) {
      toast.error("Champs obligatoires manquants", { 
        description: "Vérifiez destinataire, émetteur, type de bail, manquements, montant, délai et mode d'envoi" 
      });
      return;
    }

    try {
      const description = `Mise en demeure - ${miseEnDemeureData.destinataireNom} - ${miseEnDemeureData.adresseBien}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: miseEnDemeureData
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers
      for (const file of medCopieBail) {
        const filePath = `${user.id}/${data.id}/copie_bail/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medHistoriqueLoyers) {
        const filePath = `${user.id}/${data.id}/historique_loyers/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medReleves) {
        const filePath = `${user.id}/${data.id}/releves/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medNotificationsPrecedentes) {
        const filePath = `${user.id}/${data.id}/notifications_precedentes/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medAttestationAssurance) {
        const filePath = `${user.id}/${data.id}/attestation_assurance/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medPhotos) {
        const filePath = `${user.id}/${data.id}/photos/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medRapportHuissier) {
        const filePath = `${user.id}/${data.id}/rapport_huissier/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of medTableauCalcul) {
        const filePath = `${user.id}/${data.id}/tableau_calcul/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      toast.success("Mise en demeure créée");
      setShowQuestionDialog(false);
      setPendingContractType("");
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création mise en demeure:', err);
      toast.error('Erreur lors de la création');
    }
  };

  // Handler pour Pacte de concubinage
  const handlePacteConcubinageSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires
    if (!pacteConcubinageData.concubin1Nom || !pacteConcubinageData.concubin1Prenom ||
        !pacteConcubinageData.concubin2Nom || !pacteConcubinageData.concubin2Prenom ||
        !pacteConcubinageData.adresseResidenceCommune || !pacteConcubinageData.natureLogement ||
        !pacteConcubinageData.modeRepartitionCharges || !pacteConcubinageData.principeBiens ||
        !pacteConcubinageData.loiApplicable || !pacteConcubinageData.tribunalCompetent ||
        !pacteConcubinageData.modeSignature) {
      toast.error("Champs obligatoires manquants", { 
        description: "Vérifiez identités concubins, résidence, répartition charges, propriété biens, loi applicable et signatures" 
      });
      return;
    }

    try {
      const description = `Pacte de concubinage - ${pacteConcubinageData.concubin1Nom} ${pacteConcubinageData.concubin1Prenom} & ${pacteConcubinageData.concubin2Nom} ${pacteConcubinageData.concubin2Prenom}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: pacteConcubinageData,
          client_id: pacteConcubinageData.concubin1ClientId || undefined
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers annexes
      for (const file of pacteInventaireMeubles) {
        const filePath = `${user.id}/${data.id}/inventaire_meubles/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of pacteJustificatifsAcquisitions) {
        const filePath = `${user.id}/${data.id}/justificatifs_acquisitions/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of pacteTableauRepartition) {
        const filePath = `${user.id}/${data.id}/tableau_repartition/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of pacteAttestationVieCommune) {
        const filePath = `${user.id}/${data.id}/attestation_vie_commune/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      toast.success("Pacte de concubinage créé");
      setShowQuestionDialog(false);
      setPendingContractType("");
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création pacte de concubinage:', err);
      toast.error('Erreur lors de la création');
    }
  };

  // ========== HANDLER CONVENTION PARENTALE ==========
  const handleConventionParentaleSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires
    if (!conventionParentaleData.parent1Nom || !conventionParentaleData.parent1Prenom ||
        !conventionParentaleData.parent2Nom || !conventionParentaleData.parent2Prenom ||
        !conventionParentaleData.typeAutoriteParentale || !conventionParentaleData.typeResidence) {
      toast.error("Champs obligatoires manquants", { 
        description: "Vérifiez identités parents, autorité parentale et résidence habituelle" 
      });
      return;
    }

    try {
      const description = `Convention parentale - ${conventionParentaleData.parent1Nom} ${conventionParentaleData.parent1Prenom} & ${conventionParentaleData.parent2Nom} ${conventionParentaleData.parent2Prenom}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: conventionParentaleData,
          client_id: conventionParentaleData.parent1ClientId || undefined
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers annexes
      for (const file of conventionPiecesIdentite) {
        const filePath = `${user.id}/${data.id}/pieces_identite/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of conventionLivretFamille) {
        const filePath = `${user.id}/${data.id}/livret_famille/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of conventionCertificatsScolarite) {
        const filePath = `${user.id}/${data.id}/certificats_scolarite/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of conventionCalendrierVacances) {
        const filePath = `${user.id}/${data.id}/calendrier_vacances/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of conventionJustificatifsRevenus) {
        const filePath = `${user.id}/${data.id}/justificatifs_revenus/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of conventionAttestationsMedicales) {
        const filePath = `${user.id}/${data.id}/attestations_medicales/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      toast.success("Convention parentale créée");
      setShowQuestionDialog(false);
      setPendingContractType("");
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création convention parentale:', err);
      toast.error('Erreur lors de la création');
    }
  };

  // ========== HANDLER RECONNAISSANCE DE DETTES ==========
  const handleReconnaissanceDetteSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires
    if (!reconnaissanceDetteData.debiteurNom || !reconnaissanceDetteData.creancierNom ||
        !reconnaissanceDetteData.montantChiffres || !reconnaissanceDetteData.montantLettres ||
        !reconnaissanceDetteData.origineDette || !reconnaissanceDetteData.dateRemiseFonds) {
      toast.error("Champs obligatoires manquants", { 
        description: "Vérifiez débiteur, créancier, montant, origine et date de remise des fonds" 
      });
      return;
    }

    try {
      const description = `Reconnaissance de dettes - ${reconnaissanceDetteData.debiteurNom} doit ${reconnaissanceDetteData.montantChiffres}€ à ${reconnaissanceDetteData.creancierNom}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: reconnaissanceDetteData,
          client_id: reconnaissanceDetteData.debiteurClientId || reconnaissanceDetteData.creancierClientId || undefined
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers annexes
      for (const file of reconnaissanceCopiesIdentites) {
        const filePath = `${user.id}/${data.id}/copies_identites/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of reconnaissancePreuvePaiement) {
        const filePath = `${user.id}/${data.id}/preuve_paiement/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of reconnaissanceCalendrier) {
        const filePath = `${user.id}/${data.id}/calendrier/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of reconnaissanceGaranties) {
        const filePath = `${user.id}/${data.id}/garanties/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of reconnaissanceReleveBancaire) {
        const filePath = `${user.id}/${data.id}/releve_bancaire/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of reconnaissancePreuveRemise) {
        const filePath = `${user.id}/${data.id}/preuve_remise/${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      toast.success("Reconnaissance de dettes créée");
      setShowQuestionDialog(false);
      setPendingContractType("");
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création reconnaissance de dettes:', err);
      toast.error('Erreur lors de la création');
    }
  };

  // ========== HANDLER MANDAT DE PROTECTION FUTURE SOUS SEING PRIVÉ ==========
  const handleMandatProtectionSousSeingSubmit = async () => {
    if (!user) return;
    
    try {
      // Validation des champs obligatoires
      if (!mandatProtectionSousSeingData.mandantNom || !mandatProtectionSousSeingData.mandantPrenom ||
          !mandatProtectionSousSeingData.mandataireNom || !mandatProtectionSousSeingData.mandatairePrenom ||
          !mandatProtectionSousSeingData.typeMandat || !mandatProtectionSousSeingData.mandataireAcceptationExpresse) {
        toast.error("Veuillez remplir tous les champs obligatoires (identités mandant/mandataire, type de mandat, acceptation).");
        return;
      }

      // Générer la mention manuscrite automatiquement
      const mentionAuto = `Je soussigné(e) ${mandatProtectionSousSeingData.mandantNom} ${mandatProtectionSousSeingData.mandantPrenom}, établis le présent mandat de protection future et donne pouvoir à ${mandatProtectionSousSeingData.mandataireNom} ${mandatProtectionSousSeingData.mandatairePrenom} d'agir pour moi dans les conditions prévues ci-dessus.`;
      
      // Upload des fichiers
      let carteIdentiteMandantUrls: string[] = [];
      let carteIdentiteMandataireUrls: string[] = [];
      let justificatifDomicileUrls: string[] = [];
      let certificatMedicalUrls: string[] = [];
      let listeComptesBancairesUrls: string[] = [];
      let inventaireBiensUrls: string[] = [];
      let coordonneesProchesUrls: string[] = [];

      // Upload fichiers Carte identité mandant
      for (const file of mandatCarteIdentiteMandant) {
        const filePath = `${user.id}/mandat_protection/carte_identite_mandant/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          carteIdentiteMandantUrls.push(publicUrl);
        }
      }

      // Upload fichiers Carte identité mandataire
      for (const file of mandatCarteIdentiteMandataire) {
        const filePath = `${user.id}/mandat_protection/carte_identite_mandataire/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          carteIdentiteMandataireUrls.push(publicUrl);
        }
      }

      // Upload fichiers Justificatif domicile
      for (const file of mandatJustificatifDomicile) {
        const filePath = `${user.id}/mandat_protection/justificatif_domicile/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          justificatifDomicileUrls.push(publicUrl);
        }
      }

      // Upload fichiers Certificat médical
      for (const file of mandatCertificatMedical) {
        const filePath = `${user.id}/mandat_protection/certificat_medical/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          certificatMedicalUrls.push(publicUrl);
        }
      }

      // Upload fichiers Liste comptes bancaires
      for (const file of mandatListeComptesBancaires) {
        const filePath = `${user.id}/mandat_protection/liste_comptes_bancaires/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          listeComptesBancairesUrls.push(publicUrl);
        }
      }

      // Upload fichiers Inventaire biens
      for (const file of mandatInventaireBiens) {
        const filePath = `${user.id}/mandat_protection/inventaire_biens/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          inventaireBiensUrls.push(publicUrl);
        }
      }

      // Upload fichiers Coordonnées proches
      for (const file of mandatCoordonneesProches) {
        const filePath = `${user.id}/mandat_protection/coordonnees_proches/${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (!uploadError) {
          const { data: { publicUrl } } = supabase.storage.from('contrats').getPublicUrl(filePath);
          coordonneesProchesUrls.push(publicUrl);
        }
      }

      // Créer le contrat avec toutes les données
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          type: 'Mandat de protection future sous seing privé',
          name: `Mandat de protection future - ${mandatProtectionSousSeingData.mandantNom} ${mandatProtectionSousSeingData.mandantPrenom}`,
          description: `Mandat de protection future ${mandatProtectionSousSeingData.typeMandat === 'global' ? 'global (personne + patrimoine)' : mandatProtectionSousSeingData.typeMandat === 'personne' ? 'pour la protection de la personne' : 'pour la protection du patrimoine'} - Mandant: ${mandatProtectionSousSeingData.mandantNom} ${mandatProtectionSousSeingData.mandantPrenom} / Mandataire: ${mandatProtectionSousSeingData.mandataireNom} ${mandatProtectionSousSeingData.mandatairePrenom}`,
          user_id: user.id,
          status: 'draft',
          contenu_json: {
            ...mandatProtectionSousSeingData,
            mentionManuscrite: mentionAuto,
            carteIdentiteMandantUrls,
            carteIdentiteMandataireUrls,
            justificatifDomicileUrls,
            certificatMedicalUrls,
            listeComptesBancairesUrls,
            inventaireBiensUrls,
            coordonneesProchesUrls,
          }
        })
        .select()
        .single();

      if (error) throw error;

      toast.success("Mandat de protection future créé avec succès");

      setShowQuestionDialog(false);
      setPendingContractType("");
      refreshContrats();
      
      // Réinitialiser le formulaire
      setMandatProtectionSousSeingData({
        mandantClientId: "", mandantNom: "", mandantPrenom: "", mandantDateNaissance: "", mandantLieuNaissance: "",
        mandantNationalite: "", mandantAdresse: "", mandantProfession: "", mandantSituationFamiliale: "",
        mandantCapaciteJuridique: "Pleine capacité", mandantTypeIdentite: "", mandantNumeroIdentite: "",
        mandataireClientId: "", mandataireNom: "", mandatairePrenom: "", mandataireDateNaissance: "",
        mandataireLieuNaissance: "", mandataireNationalite: "", mandataireAdresse: "", mandataireLienMandant: "",
        mandataireProfession: "", mandataireTelephone: "", mandataireEmail: "", mandataireAcceptationExpresse: "",
        mandataireSubstitutNom: "", mandataireSubstitutPrenom: "", mandataireSubstitutAdresse: "", mandataireSubstitutTelephone: "",
        typeMandat: "", entreeVigueurCondition: "Survenance d'une altération des facultés", certificationMedicaleRequise: "oui",
        medecinsHabilites: "", dateEffet: "Date mentionnée sur certificat médical",
        pouvoirPaiementFactures: "non", pouvoirGestionCompteCourant: "non", pouvoirSouscriptionContrats: "non",
        pouvoirGestionAidesSociales: "non", pouvoirGestionLoyers: "non", pouvoirRenouvellementContrats: "non",
        pouvoirPlacementFinancier: "non", pouvoirDeclarationFiscale: "non", pouvoirGestionAssurances: "non",
        pouvoirGestionAdministrative: "non", mentionActesInterdits: "oui",
        pouvoirRdvMedicaux: "non", pouvoirAccesDossiersMedicaux: "non", pouvoirChoixEtablissementMedical: "non",
        pouvoirChoixLogement: "non", pouvoirOrganisationQuotidien: "non", pouvoirRelationsAdministrations: "non",
        pouvoirAidesRsaApa: "non", pouvoirCaisseRetraite: "non",
        obligationInteretExclusif: "oui", obligationLoyauteDiligence: "oui", obligationCompteGestion: "oui",
        obligationRendreCompte: "oui", obligationControleJudiciaire: "oui",
        mandatGratuit: "", indemniteAnnuelle: "", fraisRemboursables: "", modalitesPreuveDepenses: "",
        dureeMandat: "Jusqu'à amélioration ou décès", suspensionSiTutelle: "oui", caduciteAutomatique: "oui",
        personneConfianceDesignee: "", personneConfianceNom: "", controleAmiableFamille: "", possibiliteSaisineJuge: "oui",
        presentationComptesAnnuelle: "oui", revocationParMandant: "oui", revocationParJuge: "oui",
        demissionMandataire: "oui", obligationInformer: "oui",
        directivesAnticipees: "", clauseHebergementInstitution: "", clauseGestionAnimaux: "", clauseBiensPersonnels: "",
        lieuSignature: "", dateSignature: "", mentionManuscrite: "",
      });
      
      setMandatCarteIdentiteMandant([]);
      setMandatCarteIdentiteMandataire([]);
      setMandatJustificatifDomicile([]);
      setMandatCertificatMedical([]);
      setMandatListeComptesBancaires([]);
      setMandatInventaireBiens([]);
      setMandatCoordonneesProches([]);
      
    } catch (error: any) {
      console.error('Erreur:', error);
      toast.error(error.message || "Erreur lors de la création du mandat");
    }
  };

  // Fonction pour créer un contrat générique (sans formulaire spécifique)
  const handleGenericContractSubmit = async () => {
    if (!user) return;
    
    try {
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: genericDescription || undefined,
          client_id: selectedClientId || undefined,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success('Contrat créé', { description: pendingContractType });
      setShowQuestionDialog(false);
      setSelectedClientId("");
      setGenericDescription("");
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le formulaire CGU
  const handleCGUSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires LCEN
    if (!cguData.editeurNom || !cguData.editeurDenomination || !cguData.editeurSiege || 
        !cguData.editeurDirecteurPublication || !cguData.hebergeurNom || !cguData.hebergeurAdresse) {
      toast.error("Champs LCEN obligatoires manquants", { 
        description: "Nom, dénomination, siège, directeur publication et hébergeur requis" 
      });
      return;
    }

    try {
      const description = `CGU — ${cguData.editeurDenomination} — Service: ${cguData.serviceFourni || 'Non précisé'}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: cguData
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers annexes CGU
      for (const file of cguPolitiqueConfidentialiteFiles) {
        const filePath = `${user.id}/${data.id}/annexes/politique_confidentialite_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload politique confidentialité:', uploadError);
      }
      for (const file of cguPolitiqueCookiesFiles) {
        const filePath = `${user.id}/${data.id}/annexes/politique_cookies_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload politique cookies:', uploadError);
      }
      for (const file of cguCharteUtilisationFiles) {
        const filePath = `${user.id}/${data.id}/annexes/charte_utilisation_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload charte:', uploadError);
      }
      for (const file of cguDocumentationAPIFiles) {
        const filePath = `${user.id}/${data.id}/annexes/documentation_api_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload doc API:', uploadError);
      }
      for (const file of cguReglesModerationFiles) {
        const filePath = `${user.id}/${data.id}/annexes/regles_moderation_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload règles modération:', uploadError);
      }

      // Upload des pièces justificatives CGU
      for (const file of cguMentionsLegalesFiles) {
        const filePath = `${user.id}/${data.id}/pieces/mentions_legales_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload mentions légales:', uploadError);
      }
      for (const file of cguPolitiqueConfidentialite2Files) {
        const filePath = `${user.id}/${data.id}/pieces/politique_confidentialite_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload politique confid pièce:', uploadError);
      }
      for (const file of cguPolitiqueCookies2Files) {
        const filePath = `${user.id}/${data.id}/pieces/politique_cookies_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload politique cookies pièce:', uploadError);
      }
      for (const file of cguConditionsCommercialesFiles) {
        const filePath = `${user.id}/${data.id}/pieces/conditions_commerciales_${file.name}`;
        const { error: uploadError } = await supabase.storage.from('contrats').upload(filePath, file);
        if (uploadError) console.error('Erreur upload conditions commerciales:', uploadError);
      }

      toast.success("CGU créées", { description: "Conditions Générales d'Utilisation enregistrées" });
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création CGU:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le formulaire de contrat d'agence commerciale
  const handleAgenceCommercialeSubmit = async () => {
    if (!user) return;

    // Validation des champs obligatoires
    if (!agenceData.mandantDenomination || !agenceData.mandantSIREN) {
      toast.error("Identification mandant incomplète", { 
        description: "Dénomination et SIREN du mandant sont requis" 
      });
      return;
    }
    
    if (!agenceData.agentRSAC) {
      toast.error("RSAC obligatoire", { 
        description: "L'agent commercial doit être inscrit au RSAC (obligation légale)" 
      });
      return;
    }
    
    if (!agenceData.produits || !agenceData.secteursGeographiques) {
      toast.error("Objet du contrat incomplet", { 
        description: "Produits et zones géographiques sont requis" 
      });
      return;
    }
    
    if (!agenceData.commissionType) {
      toast.error("Commissionnement requis", { 
        description: "Vous devez définir le type de commissionnement" 
      });
      return;
    }
    
    // Validation conditionnelle du commissionnement
    if (agenceData.commissionType === 'pourcentage' && !agenceData.commissionPourcentage) {
      toast.error("Pourcentage manquant", { 
        description: "Veuillez indiquer le pourcentage de commission" 
      });
      return;
    }
    
    if (agenceData.commissionType === 'fixe' && !agenceData.commissionMontantFixe) {
      toast.error("Montant fixe manquant", { 
        description: "Veuillez indiquer le montant fixe de commission" 
      });
      return;
    }

    try {
      const description = `Contrat d'agence commerciale — ${agenceData.mandantDenomination} / Agent: ${agenceData.agentNomPrenom || agenceData.agentDenomination}`;
      
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: agenceData
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers individuels mandant
      for (const file of agenceMandantKbisFiles) {
        const filePath = `${user.id}/${contrat.id}/mandant/kbis_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload Kbis mandant:', uploadError);
      }
      for (const file of agenceMandantPolitiqueFiles) {
        const filePath = `${user.id}/${contrat.id}/mandant/politique_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload politique mandant:', uploadError);
      }
      for (const file of agenceMandantCatalogueFiles) {
        const filePath = `${user.id}/${contrat.id}/mandant/catalogue_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload catalogue mandant:', uploadError);
      }
      for (const file of agenceMandantTarifsFiles) {
        const filePath = `${user.id}/${contrat.id}/mandant/tarifs_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload tarifs mandant:', uploadError);
      }

      // Upload des fichiers individuels agent
      for (const file of agenceAgentRSACFiles) {
        const filePath = `${user.id}/${contrat.id}/agent/rsac_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload RSAC agent:', uploadError);
      }
      for (const file of agenceAgentRCProFiles) {
        const filePath = `${user.id}/${contrat.id}/agent/rcpro_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload RC Pro agent:', uploadError);
      }
      for (const file of agenceAgentIdentiteFiles) {
        const filePath = `${user.id}/${contrat.id}/agent/identite_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        if (uploadError) console.error('Erreur upload identité agent:', uploadError);
      }

      // Upload des annexes (plusieurs fichiers possibles)
      if (agenceAnnexesFiles.length > 0) {
        for (const file of agenceAnnexesFiles) {
          const filePath = `${user.id}/${contrat.id}/annexes/${file.name}`;
          const { error: uploadError } = await supabase.storage
            .from('contrats')
            .upload(filePath, file);
          if (uploadError) console.error('Erreur upload annexe:', uploadError);
        }
      }

      toast.success("Contrat d'agence commerciale créé", { 
        description: "Toutes les sections et pièces ont été enregistrées" 
      });
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création agence commerciale:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le contrat de franchise
  const handleCreateFranchiseContract = async () => {
    if (!user) return;

    try {
      const description = `Contrat de franchise - Franchiseur: ${franchiseData.franchiseurDenomination} / Franchisé: ${franchiseData.franchiseNom}`;

      // 1. Créer l'enregistrement du contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: description,
          client_id: franchiseClientId || null,
          contenu_json: franchiseData
        })
        .select()
        .single();

      if (error) throw error;

      // 2. Upload fichiers franchiseur
      for (const file of franchiseurKbisFiles) {
        const filePath = `${user.id}/${contrat.id}/franchiseur/kbis_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseurDocumentsFinanciersFiles) {
        const filePath = `${user.id}/${contrat.id}/franchiseur/financiers_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseurDepotMarqueFiles) {
        const filePath = `${user.id}/${contrat.id}/franchiseur/marque_inpi_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      // 3. Upload fichiers franchisé
      for (const file of franchiseIdentiteFiles) {
        const filePath = `${user.id}/${contrat.id}/franchise/identite_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseKbisFiles) {
        const filePath = `${user.id}/${contrat.id}/franchise/kbis_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseBusinessPlanFiles) {
        const filePath = `${user.id}/${contrat.id}/franchise/business_plan_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseCapaciteFinanciereFiles) {
        const filePath = `${user.id}/${contrat.id}/franchise/capacite_financiere_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseRCProFiles) {
        const filePath = `${user.id}/${contrat.id}/franchise/rc_pro_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      // 4. Upload annexes
      for (const file of franchiseDIPFiles) {
        const filePath = `${user.id}/${contrat.id}/annexes/dip_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseManuelOperatoireFiles) {
        const filePath = `${user.id}/${contrat.id}/annexes/manuel_operatoire_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseCharteGraphiqueFiles) {
        const filePath = `${user.id}/${contrat.id}/annexes/charte_graphique_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchisePlansAgencementFiles) {
        const filePath = `${user.id}/${contrat.id}/annexes/plans_agencement_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseTarifsFiles) {
        const filePath = `${user.id}/${contrat.id}/annexes/tarifs_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }
      for (const file of franchiseAttestationFormationFiles) {
        const filePath = `${user.id}/${contrat.id}/annexes/attestation_formation_${file.name}`;
        await supabase.storage.from('contrats').upload(filePath, file);
      }

      toast.success("Contrat de franchise créé", { 
        description: "Tous les documents et annexes ont été enregistrés" 
      });
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat franchise:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le contrat de partenariat / coopération
  const handleCreatePartenariatContract = async () => {
    if (!user) return;
    
    try {
      const description = `Contrat de partenariat - ${partenariatData.partie1Nom} / ${partenariatData.partie2Nom}`;
      
      // 1. Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          client_id: partenariatClientId1 || null,
          description,
          contenu_json: partenariatData
        })
        .select()
        .single();
      
      if (error) throw error;
      if (!contrat) throw new Error("Contrat non créé");
      
      // 2. Upload documents partie 1
      for (const file of partenariat1KbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/kbis_${file.name}`, file);
      }
      for (const file of partenariat1IdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/identite_${file.name}`, file);
      }
      for (const file of partenariat1StatutsFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/statuts_${file.name}`, file);
      }
      for (const file of partenariat1PouvoirFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/pouvoir_${file.name}`, file);
      }
      for (const file of partenariat1AssuranceFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/assurance_${file.name}`, file);
      }
      
      // 3. Upload documents partie 2
      for (const file of partenariat2KbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/kbis_${file.name}`, file);
      }
      for (const file of partenariat2IdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/identite_${file.name}`, file);
      }
      for (const file of partenariat2StatutsFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/statuts_${file.name}`, file);
      }
      for (const file of partenariat2PouvoirFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/pouvoir_${file.name}`, file);
      }
      for (const file of partenariat2AssuranceFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/assurance_${file.name}`, file);
      }
      
      // 4. Upload annexes
      for (const file of partenariatCahierChargesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/cahier_charges_${file.name}`, file);
      }
      for (const file of partenariatPlanningFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/planning_${file.name}`, file);
      }
      for (const file of partenariatBudgetFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/budget_${file.name}`, file);
      }
      for (const file of partenariatCharteGraphiqueFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/charte_graphique_${file.name}`, file);
      }
      for (const file of partenariatProtocoleRGPDFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/protocole_rgpd_${file.name}`, file);
      }
      for (const file of partenariatDescriptionTechniqueFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/description_technique_${file.name}`, file);
      }
      for (const file of partenariatPlanMarketingFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/plan_marketing_${file.name}`, file);
      }
      for (const file of partenariatContratLicenceFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/contrat_licence_${file.name}`, file);
      }
      for (const file of partenariatConditionsFinancieresFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/conditions_financieres_${file.name}`, file);
      }
      for (const file of partenariatProtocoleReversibiliteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/protocole_reversibilite_${file.name}`, file);
      }
      
      toast.success("Contrat de partenariat créé", { 
        description: "Tous les documents et annexes ont été enregistrés" 
      });
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat partenariat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le contrat de sous-traitance
  const handleCreateSousTraitanceContract = async () => {
    if (!user) return;
    if (!sousTraitanceData.donneurNom || !sousTraitanceData.sousTraitantNom || !sousTraitanceData.missionNature) {
      toast.error("Champs obligatoires manquants", { 
        description: "Veuillez remplir au minimum les identifications et la nature de la mission" 
      });
      return;
    }
    
    try {
      // Créer le contrat dans la base
      const { data: contrat, error: createError } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Contrat de sous-traitance - Donneur d'ordre: ${sousTraitanceData.donneurOrdreDenomination} / Sous-traitant: ${sousTraitanceData.sousTraitantDenomination}`,
          donnees_formulaire: sousTraitanceData,
        })
        .select()
        .single();
      
      if (createError || !contrat) {
        throw createError || new Error("Erreur lors de la création du contrat");
      }
      
      // Upload fichiers donneur d'ordre
      for (const file of sousTraitanceDonneurKbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/donneur_ordre/kbis_${file.name}`, file);
      }
      for (const file of sousTraitanceDonneurConditionsTechniquesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/donneur_ordre/conditions_techniques_${file.name}`, file);
      }
      
      // Upload fichiers sous-traitant
      for (const file of sousTraitanceSousTraitantKbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/sous_traitant/kbis_${file.name}`, file);
      }
      for (const file of sousTraitanceSousTraitantRCProFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/sous_traitant/rc_pro_${file.name}`, file);
      }
      for (const file of sousTraitanceSousTraitantURSSAFFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/sous_traitant/urssaf_${file.name}`, file);
      }
      for (const file of sousTraitanceSousTraitantCertificationsFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/sous_traitant/certifications_${file.name}`, file);
      }
      
      // Upload annexes
      for (const file of sousTraitanceCahierChargesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/cahier_charges_${file.name}`, file);
      }
      for (const file of sousTraitancePlanningFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/planning_${file.name}`, file);
      }
      for (const file of sousTraitanceSLAFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/sla_${file.name}`, file);
      }
      for (const file of sousTraitanceBudgetFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/budget_${file.name}`, file);
      }
      for (const file of sousTraitanceDPAFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/dpa_${file.name}`, file);
      }
      for (const file of sousTraitanceDocTechniqueFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/doc_technique_${file.name}`, file);
      }
      for (const file of sousTraitanceCharteSecuriteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/charte_securite_${file.name}`, file);
      }
      
      toast.success("Contrat de sous-traitance créé", { 
        description: "Tous les documents et annexes ont été enregistrés" 
      });
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat sous-traitance:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour créer le NDA
  const handleCreateNdaContract = async () => {
    if (!user) return;
    
    // Validation
    if (!ndaData.partie1Nom || !ndaData.partie2Nom || !ndaData.projetConcerne) {
      toast.error("Champs obligatoires manquants", { description: "Nom des parties et projet concerné requis" });
      return;
    }
    
    try {
      // 1. Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `NDA - ${ndaData.partie1Denomination} ⇄ ${ndaData.partie2Denomination}`,
          client_id_1: ndaClientId1 && ndaClientId1 !== "none" ? ndaClientId1 : null,
          client_id_2: ndaClientId2 && ndaClientId2 !== "none" ? ndaClientId2 : null,
          donnees_formulaire: ndaData,
        })
        .select()
        .single();
      
      if (error) throw error;
      if (!contrat) throw new Error("Contrat non créé");
      
      // 2. Upload documents partie 1
      for (const file of ndaPartie1KbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/kbis_${file.name}`, file);
      }
      for (const file of ndaPartie1IdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/identite_${file.name}`, file);
      }
      for (const file of ndaPartie1PouvoirFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/pouvoir_${file.name}`, file);
      }
      for (const file of ndaPartie1OrganigrammeFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie1/organigramme_${file.name}`, file);
      }
      
      // 3. Upload documents partie 2
      for (const file of ndaPartie2KbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/kbis_${file.name}`, file);
      }
      for (const file of ndaPartie2IdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/identite_${file.name}`, file);
      }
      for (const file of ndaPartie2PouvoirFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/pouvoir_${file.name}`, file);
      }
      for (const file of ndaPartie2OrganigrammeFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/partie2/organigramme_${file.name}`, file);
      }
      
      // 4. Upload annexes
      for (const file of ndaListeInfosDivulgueesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/liste_infos_${file.name}`, file);
      }
      for (const file of ndaSchemasTechniquesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/schemas_${file.name}`, file);
      }
      for (const file of ndaCahierChargesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/cahier_charges_${file.name}`, file);
      }
      for (const file of ndaDocumentRGPDFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/rgpd_${file.name}`, file);
      }
      for (const file of ndaCharteSecuriteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/charte_securite_${file.name}`, file);
      }
      
      toast.success("Accord de confidentialité créé avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création NDA:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Cession de marque / PI
  const handleCreateCessionPiContract = async () => {
    if (!user) return;
    
    // Validation
    if (!cessionPiData.cedantNom || !cessionPiData.cessionnaireNom) {
      toast.error("Champs obligatoires manquants", { description: "Nom du cédant et du cessionnaire requis" });
      return;
    }
    
    // Validation selon type de cession
    if (cessionPiData.typeCession === "marque" && !cessionPiData.marqueNom) {
      toast.error("Nom de la marque requis");
      return;
    }
    if (cessionPiData.typeCession === "brevet" && !cessionPiData.brevetTitre) {
      toast.error("Titre du brevet requis");
      return;
    }
    
    if (!cessionPiData.prixCession) {
      toast.error("Prix de cession requis");
      return;
    }
    
    try {
      // 1. Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Cession PI - Cédant: ${cessionPiData.cedantNom} → Cessionnaire: ${cessionPiData.cessionnaireNom}`,
          client_id_1: cessionPiClientIdCedant && cessionPiClientIdCedant !== "none" ? cessionPiClientIdCedant : null,
          client_id_2: cessionPiClientIdCessionnaire && cessionPiClientIdCessionnaire !== "none" ? cessionPiClientIdCessionnaire : null,
          donnees_formulaire: cessionPiData,
        })
        .select()
        .single();
      
      if (error) throw error;
      if (!contrat) throw new Error("Contrat non créé");
      
      // 2. Upload documents cédant
      for (const file of cessionPiCedantKbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/cedant/kbis_${file.name}`, file);
      }
      for (const file of cessionPiCedantIdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/cedant/identite_${file.name}`, file);
      }
      for (const file of cessionPiCedantPouvoirFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/cedant/pouvoir_${file.name}`, file);
      }
      
      // 3. Upload documents cessionnaire
      for (const file of cessionPiCessionnaireKbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/cessionnaire/kbis_${file.name}`, file);
      }
      for (const file of cessionPiCessionnaireIdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/cessionnaire/identite_${file.name}`, file);
      }
      for (const file of cessionPiCessionnairePouvoirFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/cessionnaire/pouvoir_${file.name}`, file);
      }
      
      // 4. Upload documents du droit cédé
      for (const file of cessionPiCertificatEnregistrementFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/droit_cede/certificat_${file.name}`, file);
      }
      for (const file of cessionPiPreuvesAnterioriteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/droit_cede/preuves_${file.name}`, file);
      }
      for (const file of cessionPiDocumentsTechniquesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/droit_cede/techniques_${file.name}`, file);
      }
      for (const file of cessionPiCodeSourceFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/droit_cede/code_source_${file.name}`, file);
      }
      for (const file of cessionPiDocumentationFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/droit_cede/documentation_${file.name}`, file);
      }
      
      // 5. Upload autres documents
      for (const file of cessionPiLicencesExistantesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/licences_${file.name}`, file);
      }
      for (const file of cessionPiRapportValuationFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/valuation_${file.name}`, file);
      }
      for (const file of cessionPiAnnexesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes_${file.name}`, file);
      }
      
      toast.success("Contrat de cession créé avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création cession PI:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Contrat de travail (CDD/CDI)
  const handleCreateContratTravailContract = async () => {
    if (!user) return;
    
    // Validation
    if (!contratTravailData.employeurRaisonSociale || !contratTravailData.salarieNom || !contratTravailData.salariePrenom) {
      toast.error("Champs obligatoires manquants", { description: "Employeur et identité du salarié requis" });
      return;
    }
    
    if (contratTravailData.typeContrat === "CDI" && !contratTravailData.cdiDateEmbauche) {
      toast.error("Date d'embauche requise pour un CDI");
      return;
    }
    
    if (contratTravailData.typeContrat === "CDD") {
      if (!contratTravailData.cddDateDebut || !contratTravailData.cddMotifRecours) {
        toast.error("Date de début et motif légal de recours requis pour un CDD");
        return;
      }
      
      // Validation motif remplacement
      if (contratTravailData.cddMotifRecours === "remplacement" && (!contratTravailData.cddMotifPrecisions || !contratTravailData.cddMotifAbsence)) {
        toast.error("Nom du salarié remplacé et motif d'absence requis");
        return;
      }
      
      // Validation terme précis
      if (contratTravailData.cddTypeTerme === "precis" && !contratTravailData.cddDateFin) {
        toast.error("Date de fin requise pour un CDD à terme précis");
        return;
      }
      
      // Validation terme imprécis
      if (contratTravailData.cddTypeTerme === "imprecis" && !contratTravailData.cddDuree) {
        toast.error("Durée minimale requise pour un CDD à terme imprécis");
        return;
      }
      
      // Validation renouvellement
      if (contratTravailData.cddRenouvellement === "oui" && (!contratTravailData.cddRenouvellementNombre || !contratTravailData.cddRenouvellementDureeMax)) {
        toast.error("Préciser le nombre de renouvellements et la durée maximale");
        return;
      }
      
      // Validation indemnité fin de contrat
      if (!contratTravailData.cddIndemniteFinContrat) {
        toast.error("Préciser si indemnité de fin de contrat applicable");
        return;
      }
      
      if (contratTravailData.cddIndemniteFinContrat === "exoneration" && !contratTravailData.cddIndemniteExonerationMotif) {
        toast.error("Préciser le motif d'exonération de l'indemnité de fin de contrat");
        return;
      }
    }
    
    if (!contratTravailData.posteIntitule || !contratTravailData.remunerationBruteMensuelle) {
      toast.error("Intitulé du poste et rémunération requis");
      return;
    }
    
    try {
      // 1. Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Contrat de travail ${contratTravailData.typeContrat} - ${contratTravailData.employeurDenomination} / ${contratTravailData.salariNom} ${contratTravailData.salariPrenom}`,
          client_id_1: contratTravailClientIdEmployeur && contratTravailClientIdEmployeur !== "none" ? contratTravailClientIdEmployeur : null,
          client_id_2: contratTravailClientIdSalarie && contratTravailClientIdSalarie !== "none" ? contratTravailClientIdSalarie : null,
          donnees_formulaire: contratTravailData,
        })
        .select()
        .single();
      
      if (error) throw error;
      if (!contrat) throw new Error("Contrat non créé");
      
      // 2. Upload documents employeur
      for (const file of contratTravailEmployeurKbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/employeur/kbis_${file.name}`, file);
      }
      for (const file of contratTravailEmployeurIdccFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/employeur/idcc_${file.name}`, file);
      }
      
      // 3. Upload documents salarié
      for (const file of contratTravailSalarieIdentiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/salarie/identite_${file.name}`, file);
      }
      for (const file of contratTravailSalarieSecuFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/salarie/secu_${file.name}`, file);
      }
      for (const file of contratTravailSalarieVitaleFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/salarie/vitale_${file.name}`, file);
      }
      for (const file of contratTravailSalarieRIBFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/salarie/rib_${file.name}`, file);
      }
      for (const file of contratTravailSalarieDiplomesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/salarie/diplomes_${file.name}`, file);
      }
      for (const file of contratTravailSalarieCVFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/salarie/cv_${file.name}`, file);
      }
      
      // 4. Upload documents du contrat
      for (const file of contratTravailFichePosteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/fiche_poste_${file.name}`, file);
      }
      for (const file of contratTravailReglementInterieurFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/reglement_${file.name}`, file);
      }
      for (const file of contratTravailAnnexesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes_${file.name}`, file);
      }
      
      toast.success(`Contrat de travail ${contratTravailData.typeContrat} créé avec succès`);
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat travail:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Convention de stage
  const handleCreateConventionStageContract = async () => {
    if (!user) return;
    
    // Validation
    if (!conventionStageData.etablissementNom || !conventionStageData.stagiaireNom || !conventionStageData.entrepriseDenomination) {
      toast.error("Champs obligatoires manquants", { description: "Établissement, stagiaire et entreprise requis" });
      return;
    }
    
    if (!conventionStageData.stageDateDebut || !conventionStageData.stageDateFin) {
      toast.error("Dates de début et fin de stage requises");
      return;
    }
    
    if (!conventionStageData.stageMissionsDetaillees) {
      toast.error("Description détaillée des missions obligatoire", { description: "Important pour éviter la requalification en contrat de travail" });
      return;
    }
    
    if (!conventionStageData.stagiaireAssuranceRC) {
      toast.error("Attestation d'assurance responsabilité civile du stagiaire obligatoire");
      return;
    }
    
    if (!conventionStageData.entrepriseTuteurNom) {
      toast.error("Tuteur de stage obligatoire");
      return;
    }
    
    // Vérifier gratification si >= 44 jours
    const heuresTotal = parseInt(conventionStageData.stageNombreHeuresTotal || "0");
    if (heuresTotal >= 308 && conventionStageData.stageGratification === "non") {
      toast.error("Gratification obligatoire pour un stage de 44 jours ou plus (308h)");
      return;
    }
    
    try {
      // 1. Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Convention de stage - ${conventionStageData.stagiaireNom} ${conventionStageData.stagiairePrenom} chez ${conventionStageData.entrepriseDenomination}`,
          client_id_1: conventionStageClientIdStagiaire && conventionStageClientIdStagiaire !== "none" ? conventionStageClientIdStagiaire : null,
          client_id_2: conventionStageClientIdEntreprise && conventionStageClientIdEntreprise !== "none" ? conventionStageClientIdEntreprise : null,
          donnees_formulaire: conventionStageData,
        })
        .select()
        .single();
      
      if (error) throw error;
      if (!contrat) throw new Error("Contrat non créé");
      
      // 2. Upload documents stagiaire
      for (const file of conventionStageStagiaireCarteEtudianteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/stagiaire/carte_etudiante_${file.name}`, file);
      }
      for (const file of conventionStageStagiaireAssuranceRCFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/stagiaire/assurance_rc_${file.name}`, file);
      }
      for (const file of conventionStageStagiaireRIBFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/stagiaire/rib_${file.name}`, file);
      }
      
      // 3. Upload documents établissement
      for (const file of conventionStageEtablissementAffiliationSecu) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/etablissement/affiliation_secu_${file.name}`, file);
      }
      for (const file of conventionStageEtablissementJustificatifPedago) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/etablissement/justificatif_pedago_${file.name}`, file);
      }
      
      // 4. Upload documents entreprise
      for (const file of conventionStageEntrepriseKbisFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/entreprise/kbis_${file.name}`, file);
      }
      for (const file of conventionStageEntrepriseAssuranceRCProFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/entreprise/assurance_rc_pro_${file.name}`, file);
      }
      
      // 5. Upload annexes
      for (const file of conventionStageFicheMissionsFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/fiche_missions_${file.name}`, file);
      }
      for (const file of conventionStageCharteInformatiqueFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/charte_info_${file.name}`, file);
      }
      for (const file of conventionStageReglementInterieurFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/reglement_${file.name}`, file);
      }
      for (const file of conventionStagePlanningFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/planning_${file.name}`, file);
      }
      for (const file of conventionStageGrilleEvaluationFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/grille_eval_${file.name}`, file);
      }
      for (const file of conventionStageEngagementConfidentialiteFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/engagement_conf_${file.name}`, file);
      }
      for (const file of conventionStageAnnexesFiles) {
        await supabase.storage.from('contrats')
          .upload(`${user.id}/${contrat.id}/annexes/autres_${file.name}`, file);
      }
      
      toast.success("Convention de stage créée avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création convention stage:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Rupture conventionnelle
  const handleCreateRuptureConventionnelleContract = async () => {
    if (!user) return;
    
    // Validations obligatoires
    if (!ruptureConventionnelleData.employeurDenomination || !ruptureConventionnelleData.salariNom || !ruptureConventionnelleData.salariPrenom) {
      toast.error("Identification des parties obligatoire", { description: "Employeur et salarié requis" });
      return;
    }
    
    if (ruptureConventionnelleData.salariTypeContrat !== 'CDI') {
      toast.error("Rupture conventionnelle réservée aux CDI uniquement", { description: "Impossible pour CDD, apprentissage, etc." });
      return;
    }
    
    if (!ruptureConventionnelleData.entretienDate) {
      toast.error("Date d'entretien obligatoire", { description: "Au moins un entretien formel est requis" });
      return;
    }
    
    if (!ruptureConventionnelleData.dateSignature || !ruptureConventionnelleData.dateRuptureEffective) {
      toast.error("Dates de signature et de rupture obligatoires");
      return;
    }
    
    // Vérification des situations à risque
    if (ruptureConventionnelleData.verificationAccidentTravail === 'oui' || 
        ruptureConventionnelleData.verificationArretMaladie === 'oui' || 
        ruptureConventionnelleData.verificationConflitGrave === 'oui') {
      toast.error("⚠️ Situation à risque détectée", { 
        description: "La rupture peut être annulée. Conseil juridique recommandé." 
      });
    }
    
    // Alerte cas particuliers
    if (ruptureConventionnelleData.casParticulierProtege === 'oui') {
      toast.error("⚠️ Salarié protégé", { 
        description: "Autorisation de l'Inspection du travail nécessaire" 
      });
    }
    
    if (ruptureConventionnelleData.casParticulierInaptitude === 'oui') {
      toast.error("⚠️ Inaptitude détectée", { 
        description: "Rupture conventionnelle déconseillée dans ce cas" 
      });
    }
    
    try {
      // Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Rupture conventionnelle - ${ruptureConventionnelleData.salariNom} ${ruptureConventionnelleData.salariPrenom} - ${ruptureConventionnelleData.employeurDenomination}`,
          client_id_1: ruptureConventionnelleClientIdEmployeur || null,
          client_id_2: ruptureConventionnelleClientIdSalarie || null,
          donnees_formulaire: ruptureConventionnelleData
        })
        .select()
        .single();
      
      if (error) throw error;
      
      // Upload des fichiers
      if (ruptureConvEmployeurKbisFiles.length > 0) {
        for (const file of ruptureConvEmployeurKbisFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/employeur/kbis_${file.name}`, file);
        }
      }
      if (ruptureConvEmployeurJustifRepresentantFiles.length > 0) {
        for (const file of ruptureConvEmployeurJustifRepresentantFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/employeur/justif_representant_${file.name}`, file);
        }
      }
      if (ruptureConvSalariePieceIdentiteFiles.length > 0) {
        for (const file of ruptureConvSalariePieceIdentiteFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/salarie/piece_identite_${file.name}`, file);
        }
      }
      if (ruptureConvSalarieRIBFiles.length > 0) {
        for (const file of ruptureConvSalarieRIBFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/salarie/rib_${file.name}`, file);
        }
      }
      if (ruptureConvFichePosteFiles.length > 0) {
        for (const file of ruptureConvFichePosteFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/fiche_poste_${file.name}`, file);
        }
      }
      if (ruptureConvContratTravailFiles.length > 0) {
        for (const file of ruptureConvContratTravailFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/contrat_travail_${file.name}`, file);
        }
      }
      if (ruptureConvBulletinsSalaireFiles.length > 0) {
        for (const file of ruptureConvBulletinsSalaireFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/bulletins_${file.name}`, file);
        }
      }
      if (ruptureConvCalculIndemniteFiles.length > 0) {
        for (const file of ruptureConvCalculIndemniteFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/calcul_indemnite_${file.name}`, file);
        }
      }
      if (ruptureConvAnnexesFiles.length > 0) {
        for (const file of ruptureConvAnnexesFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/annexes/${file.name}`, file);
        }
      }
      
      toast.success("Rupture conventionnelle créée avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création rupture conventionnelle:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le formulaire d'avenant au contrat de travail
  const handleCreateAvenantContratTravailContract = async () => {
    if (!user) return;
    
    // Validations obligatoires
    if (!avenantContratTravailData.employeur.raisonSociale || !avenantContratTravailData.salarie.nom || !avenantContratTravailData.salarie.prenom) {
      toast.error("Identification des parties obligatoire", { description: "Employeur et salarié requis" });
      return;
    }
    
    if (!avenantContratTravailData.contratInitial.dateContrat || !avenantContratTravailData.contratInitial.typeContrat) {
      toast.error("Référence au contrat initial obligatoire", { description: "Date et type du contrat initial requis" });
      return;
    }
    
    // Vérifier qu'au moins une modification est activée
    const hasModification = Object.values(avenantContratTravailData.modifications).some((mod: any) => mod.actif);
    if (!hasModification) {
      toast.error("Objet de l'avenant obligatoire", { description: "Veuillez sélectionner au moins une modification" });
      return;
    }
    
    if (!avenantContratTravailData.dateLieuSignature) {
      toast.error("Date de signature obligatoire", { description: "Veuillez renseigner la date de signature" });
      return;
    }
    
    try {
      // Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Avenant au contrat de travail - ${avenantContratTravailData.salarie.nom} ${avenantContratTravailData.salarie.prenom} - ${avenantContratTravailData.employeur.raisonSociale}`,
          client_id_1: avenantContratTravailClientIdEmployeur || null,
          client_id_2: avenantContratTravailClientIdSalarie || null,
          donnees_formulaire: avenantContratTravailData
        })
        .select()
        .single();
      
      if (error) throw error;
      
      // Upload des fichiers
      if (avenantContratInitialFiles.length > 0) {
        for (const file of avenantContratInitialFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/contrat_initial_${file.name}`, file);
        }
      }
      if (avenantPrecedentsFiles.length > 0) {
        for (const file of avenantPrecedentsFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/avenants_precedents_${file.name}`, file);
        }
      }
      if (avenantJustificatifsFiles.length > 0) {
        for (const file of avenantJustificatifsFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/justificatifs_${file.name}`, file);
        }
      }
      if (avenantAutresDocumentsFiles.length > 0) {
        for (const file of avenantAutresDocumentsFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/autres_${file.name}`, file);
        }
      }
      
      toast.success("Avenant au contrat de travail créé avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création avenant contrat de travail:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le formulaire d'accord de confidentialité employé
  const handleCreateAccordConfidentialiteContract = async () => {
    if (!user) return;
    
    // Validations obligatoires
    if (!accordConfidentialiteData.employeur.denominationSociale || !accordConfidentialiteData.employe.nom || !accordConfidentialiteData.employe.prenom) {
      toast.error("Identification des parties obligatoire", { description: "Employeur et employé requis" });
      return;
    }
    
    if (!accordConfidentialiteData.employe.posteOccupe || !accordConfidentialiteData.employe.typeContrat) {
      toast.error("Informations employé incomplètes", { description: "Poste et type de contrat requis" });
      return;
    }
    
    if (!accordConfidentialiteData.obligationsApres.dureeConfidentialite) {
      toast.error("Durée de confidentialité requise", { description: "Veuillez préciser la durée de l'obligation après le contrat" });
      return;
    }
    
    if (!accordConfidentialiteData.dateLieuSignature) {
      toast.error("Date de signature obligatoire", { description: "Veuillez renseigner la date de signature" });
      return;
    }
    
    try {
      // Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Accord de confidentialité - ${accordConfidentialiteData.employe.prenom} ${accordConfidentialiteData.employe.nom} - ${accordConfidentialiteData.employeur.denominationSociale}`,
          client_id_1: accordConfidClientIdEmployeur || null,
          client_id_2: accordConfidClientIdEmploye || null,
          donnees_formulaire: accordConfidentialiteData
        })
        .select()
        .single();
      
      if (error) throw error;
      
      // Upload des fichiers
      if (accordConfidEmployeurKbisFiles.length > 0) {
        for (const file of accordConfidEmployeurKbisFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/kbis_${file.name}`, file);
        }
      }
      if (accordConfidCharteInformatiqueFiles.length > 0) {
        for (const file of accordConfidCharteInformatiqueFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/charte_informatique_${file.name}`, file);
        }
      }
      if (accordConfidPolitiqueInterneFiles.length > 0) {
        for (const file of accordConfidPolitiqueInterneFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/politique_interne_${file.name}`, file);
        }
      }
      if (accordConfidEmployeIdentiteFiles.length > 0) {
        for (const file of accordConfidEmployeIdentiteFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/identite_employe_${file.name}`, file);
        }
      }
      
      toast.success("Accord de confidentialité employé créé avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création accord confidentialité:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Politique RGPD interne
  const handleCreatePolitiqueRGPDContract = async () => {
    if (!user) return;
    
    // Validations obligatoires
    if (!politiqueRGPDData.organisation.denominationSociale || !politiqueRGPDData.organisation.siret) {
      toast.error("Identification de l'organisation obligatoire", { description: "Dénomination sociale et SIRET requis" });
      return;
    }
    
    if (!politiqueRGPDData.organisation.representantLegal) {
      toast.error("Représentant légal requis", { description: "Veuillez renseigner le représentant légal" });
      return;
    }
    
    if (!politiqueRGPDData.objet.objectifsConformite) {
      toast.error("Objectifs de conformité requis", { description: "Veuillez définir les objectifs de conformité RGPD" });
      return;
    }
    
    if (!politiqueRGPDData.dateElaboration) {
      toast.error("Date d'élaboration requise", { description: "Veuillez renseigner la date d'élaboration" });
      return;
    }
    
    try {
      // Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          description: `Politique RGPD interne - ${politiqueRGPDData.organisation.denominationSociale}`,
          client_id_1: politiqueRGPDClientId || null,
          donnees_formulaire: politiqueRGPDData
        })
        .select()
        .single();
      
      if (error) throw error;
      
      // Upload des fichiers
      if (politiqueRGPDPreuveDesignationDPOFiles.length > 0) {
        for (const file of politiqueRGPDPreuveDesignationDPOFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/preuve_designation_dpo_${file.name}`, file);
        }
      }
      if (politiqueRGPDContratsSousTraitanceFiles.length > 0) {
        for (const file of politiqueRGPDContratsSousTraitanceFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/contrats_sous_traitance_${file.name}`, file);
        }
      }
      if (politiqueRGPDAttestationsSecuriteFiles.length > 0) {
        for (const file of politiqueRGPDAttestationsSecuriteFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/attestations_securite_${file.name}`, file);
        }
      }
      if (politiqueRGPDDocumentationsInternesFiles.length > 0) {
        for (const file of politiqueRGPDDocumentationsInternesFiles) {
          await supabase.storage.from('contrats')
            .upload(`${user.id}/${contrat.id}/documents/documentations_internes_${file.name}`, file);
        }
      }
      
      toast.success("Politique RGPD interne créée avec succès");
      setPendingContractType("");
      setShowQuestionDialog(false);
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création politique RGPD:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le formulaire de procuration authentique
  const handleProcurationSubmit = async () => {
    if (!user) return;

    // Validation
    if (procurationData.typeProcuration.length === 0) {
      toast.error("Type de procuration requis", { description: "Veuillez sélectionner au moins un type" });
      return;
    }
    if (!procurationData.mandant.nom || !procurationData.mandant.prenom || !procurationData.mandant.dateNaissance || !procurationData.mandant.adresseComplete) {
      toast.error("Champs mandant requis", { description: "Nom, prénom, date de naissance et adresse obligatoires" });
      return;
    }
    if (!procurationData.mandataire.nom || !procurationData.mandataire.prenom || !procurationData.mandataire.adresseComplete) {
      toast.error("Champs mandataire requis", { description: "Nom, prénom et adresse obligatoires" });
      return;
    }
    if (!procurationData.objet.descriptionPrecise.trim()) {
      toast.error("Objet de la procuration requis", { description: "Veuillez préciser l'objet de la procuration" });
      return;
    }
    if (!procurationData.mentionsNotariales.nomNotaire || !procurationData.mentionsNotariales.villeOffice || !procurationData.mentionsNotariales.dateReception || !procurationData.mentionsNotariales.lieuReception) {
      toast.error("Mentions notariales requises", { description: "Tous les champs notariaux sont obligatoires" });
      return;
    }

    try {
      const description = `Procuration - Mandant: ${procurationData.mandant.prenom} ${procurationData.mandant.nom} → Mandataire: ${procurationData.mandataire.prenom} ${procurationData.mandataire.nom}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: procurationData
        })
        .select()
        .single();

      if (error) throw error;

      toast.success("Procuration créée", { description: "Vous pouvez maintenant compléter les détails" });
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setProcurationData({
        typeProcuration: "",
        actesVises: "",
        mandant: {
          isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "",
          dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "", adresseComplete: "",
          telephone: "", email: "", situationMatrimoniale: "", regimeMatrimonial: "", conjointNom: "",
          conjointPrenom: "", capaciteJuridique: "majeur_capable", typeMesureProtection: "", autorisationJointe: false,
          typeIdentite: "", numeroIdentite: "", dateEmissionIdentite: "", autoriteEmettrice: "",
        },
        mandataire: {
          nom: "", prenom: "", nomNaissance: "", dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "",
          adresseComplete: "", telephone: "", email: "", lienMandant: "",
          typeIdentite: "", numeroIdentite: "", dateEmissionIdentite: "", autoriteEmettrice: "",
        },
        objet: {
          descriptionPrecise: "", listeActesAutorises: "", faculteSignerActes: false, faculteRecevoirSommes: false,
          immobilierVente: false, immobilierAchat: false, immobilierHypotheque: false, immobilierMainlevee: false,
          immobilierSignatureAvantContrats: false, immobilierAcceptationConditions: false, immobilierPercevoirPrix: false,
          faculteSubstituer: false,
        },
        etendue: {
          typeEtendue: "tres_large", precisionsLimitees: "", actesExclus: "", subdelegation: "interdite",
        },
        duree: {
          type: "indeterminee", dateFin: "", revocable: true,
        },
        acceptation: {
          type: "expresse", acceptationJourActe: true,
        },
        declarations: {
          agitLibrement: false, pleineCapacite: false, comprendPortee: false, consentLibre: false, pouvoirIrrevocable: false,
        },
        langue: {
          langueComprise: "Français", interpreteNecessaire: false, interpreteIdentite: "",
        },
        comparution: {
          typeComparution: "presence", lectureFaite: false, consentementRecueilli: false, typeSignature: "presentiel",
        },
        mentionsNotariales: {
          nomNotaire: "", villeOffice: "", dateReception: "", lieuReception: "", acteRecuMinute: false,
        },
        conservation: {
          minuteConservee: false, copiesSimples: false, copiesCertifiees: false, copiesExecutoires: false,
        }
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création procuration:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour le formulaire de mandat de protection future
  const handleMandatProtectionSubmit = async () => {
    if (!user) return;

    // Validation
    if (mandatProtectionData.typeMandat.length === 0) {
      toast.error("Type de mandat requis", { description: "Veuillez sélectionner au moins un type" });
      return;
    }
    if (!mandatProtectionData.mandant.nom || !mandatProtectionData.mandant.prenom || !mandatProtectionData.mandant.dateNaissance || !mandatProtectionData.mandant.adresseComplete) {
      toast.error("Champs mandant requis", { description: "Nom, prénom, date de naissance et adresse obligatoires" });
      return;
    }
    if (!mandatProtectionData.mandatairePrincipal.nom || !mandatProtectionData.mandatairePrincipal.prenom || !mandatProtectionData.mandatairePrincipal.adresseComplete) {
      toast.error("Champs mandataire requis", { description: "Nom, prénom et adresse obligatoires" });
      return;
    }
    if (!mandatProtectionData.forme.typeActe || !mandatProtectionData.forme.dateSignature) {
      toast.error("Forme du mandat requise", { description: "Type d'acte et date de signature obligatoires" });
      return;
    }
    if (!mandatProtectionData.juridictionConservation.tribunalCompetent || !mandatProtectionData.juridictionConservation.villeJuridiction || !mandatProtectionData.juridictionConservation.lieuConservation) {
      toast.error("Juridiction et conservation requises", { description: "Tribunal compétent, ville et lieu de conservation obligatoires" });
      return;
    }
    if (!mandatProtectionData.remuneration.typeRemuneration) {
      toast.error("Rémunération requise", { description: "Type de rémunération obligatoire" });
      return;
    }
    if (mandatProtectionData.remuneration.typeRemuneration === "remunere" && !mandatProtectionData.remuneration.modalitesRemuneration) {
      toast.error("Modalités de rémunération requises", { description: "Veuillez préciser les modalités de rémunération" });
      return;
    }
    if (!mandatProtectionData.clausesSpeciales.donationsAutorisees) {
      toast.error("Clause donations requise", { description: "Clause expresse obligatoire sur les donations et actes à titre gratuit" });
      return;
    }

    try {
      const description = `Mandat de protection future - Mandant: ${mandatProtectionData.mandant.prenom} ${mandatProtectionData.mandant.nom} → Mandataire: ${mandatProtectionData.mandatairePrincipal.prenom} ${mandatProtectionData.mandatairePrincipal.nom}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: mandatProtectionData
        })
        .select()
        .single();

      if (error) throw error;

      toast.success("Mandat de protection future créé", { description: "Vous pouvez maintenant compléter les détails" });
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setMandatProtectionData({
        typeMandat: [],
        mandatAutrui: { lienJuridique: "", justificationLegale: "" },
        mandant: {
          isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", dateNaissance: "", lieuNaissance: "",
          nationalite: "", profession: "", adresseComplete: "", telephone: "", email: "", situationMatrimoniale: "",
          regimeMatrimonial: "", conjointNom: "", conjointPrenom: "", capaciteJuridique: "majeur_capable",
          typeIdentite: "", numeroIdentite: "", dateEmissionIdentite: "", dateExpirationIdentite: "",
        },
        mandatairePrincipal: {
          nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", adresseComplete: "", profession: "",
          telephone: "", email: "", typeIdentite: "", numeroIdentite: "", dateExpirationIdentite: "",
          lienMandant: "", absenceIncapaciteLegale: false, absenceDecheanceAutorite: false,
          absenceInterdictionGestion: false, absenceMesureProtection: false, acceptationEcrite: false,
        },
        mandataireSubstitut: {
          existe: false, nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", adresseComplete: "",
          profession: "", telephone: "", email: "", typeIdentite: "", numeroIdentite: "",
          lienMandant: "", conditionsEntree: "", etenduePouvoirs: "",
        },
        pouvoirsPersonne: {
          representationActesCourants: false, choixEtablissement: false, demarchesSociales: false,
          organisationSoins: false, gestionMedecins: false, gestionQuotidien: false, precisionsAutres: "",
        },
        pouvoirsAdministration: {
          gestionComptes: false, encaissementRevenus: false, paiementDepenses: false,
          renouvellementBail: false, souscriptionAssurances: false, entretienBiens: false,
        },
        pouvoirsDisposition: {
          venteImmobilier: false, achatImmobilier: false, donationMobilier: false, gestionTitres: false,
          resiliationBail: false, reglementDettes: false, acceptationSuccession: false, renonciationSuccession: false,
          donations: false, modificationsSuccessorales: false, actesGratuits: false, modificationContratMariage: false,
        },
        biensPatrimoine: {
          biensImmobiliers: "", comptesBancaires: "", assurancesVie: "", livretsEpargne: "",
          biensMobiliers: "", partsSociales: "", revenusReguliers: "", dettesExistantes: "",
        },
        limites: {
          interdictionVenteCertainsBiens: false, biensConcernes: "", interdictionDeplacement: false,
          interdictionModificationContrats: false, montantMaximum: "", obligationComptesReguliers: false, periodiciteComptes: "",
        },
        controle: {
          obligationCompteGestion: false, controlePersonne: false, controleIdentite: "", controlePouvoirs: "",
          controleNotaire: false, controleExpertComptable: false, compteRenduAnnuel: false, periodicite: "",
        },
        miseEnOeuvre: {
          certificatMedical: true, medecinListe: "", dateConstat: "", depotGreffe: false, notificationMandataire: false,
        },
        finMandat: {
          finRetourFacultes: true, revocationMandant: true, destitutionJuge: true, decesMandant: true, remplacementSubstitut: false,
        },
        declarations: {
          volonteLibre: false, consentementSansPression: false, explicationComprise: false,
          acceptationActesDisposition: false, acceptationMandataire: false, droitRevocation: false,
        },
        forme: {
          typeActe: "", nomNotaire: "", villeOffice: "", dateSignature: "", datePriseEffet: "",
          lieuSignature: "", referenceLegale: "Articles 477 à 494 du Code civil",
        },
        juridictionConservation: {
          tribunalCompetent: "", villeJuridiction: "", lieuConservation: "", precisionsConservation: "",
        },
        remuneration: {
          typeRemuneration: "", modalitesRemuneration: "", remboursementFrais: false, precisionsRemboursement: "",
        },
        clausesSpeciales: {
          prioriteFamiliale: false, obligationInformationFamille: false, precisionsInformationFamille: "",
          ordreSubstitution: "", conditionsRemplacement: "", etenduePouvoirs: "",
          responsabiliteCivile: false, obligationInteretExclusif: true,
          donationsAutorisees: "", beneficiairesAutorises: "",
        },
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création mandat protection:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Quitus / reconnaissance de dette
  const handleQuitusDetteSubmit = async () => {
    if (!user) return;

    // Validation
    if (!quitusDetteData.typeActe) {
      toast.error("Type d'acte requis", { description: "Veuillez sélectionner le type d'acte" });
      return;
    }
    if (!quitusDetteData.creancier.nom || !quitusDetteData.creancier.prenom || !quitusDetteData.creancier.adresseComplete) {
      toast.error("Identité créancier requise", { description: "Nom, prénom et adresse obligatoires" });
      return;
    }
    if (!quitusDetteData.debiteur.nom || !quitusDetteData.debiteur.prenom || !quitusDetteData.debiteur.adresseComplete) {
      toast.error("Identité débiteur requise", { description: "Nom, prénom et adresse obligatoires" });
      return;
    }
    if (!quitusDetteData.objetDette.natureDette || !quitusDetteData.objetDette.dateNaissanceDette) {
      toast.error("Objet de la dette requis", { description: "Nature et date de la dette obligatoires" });
      return;
    }
    if (!quitusDetteData.montant.montantTotal || !quitusDetteData.montant.devise) {
      toast.error("Montant requis", { description: "Montant total et devise obligatoires" });
      return;
    }
    if (!quitusDetteData.signatures.dateSignature || !quitusDetteData.signatures.lieuSignature) {
      toast.error("Signatures requises", { description: "Date et lieu de signature obligatoires" });
      return;
    }

    // Validations spécifiques selon type d'acte
    if ((quitusDetteData.typeActe === "reconnaissance_dette" || quitusDetteData.typeActe === "reconnaissance_dette_modalites") && parseFloat(quitusDetteData.montant.montantTotal) > 1500 && !quitusDetteData.clausesLegales.mentionManuscrite) {
      toast.error("Mention manuscrite requise", { description: "Pour une dette > 1500€, la mention manuscrite est obligatoire" });
      return;
    }

    if ((quitusDetteData.typeActe === "quitus" || quitusDetteData.typeActe === "quitus_partiel" || quitusDetteData.typeActe === "solde_tout_compte" || quitusDetteData.typeActe === "attestation_reglement") && quitusDetteData.quitus.paiementsRecus.length === 0) {
      toast.error("Paiements requis", { description: "Veuillez indiquer les paiements reçus" });
      return;
    }

    try {
      const typeLabels: Record<string, string> = {
        reconnaissance_dette: "Reconnaissance de dette",
        reconnaissance_dette_modalites: "Reconnaissance de dette avec modalités",
        quitus: "Quitus total",
        quitus_partiel: "Quitus partiel",
        remise_dette: "Remise de dette",
        solde_tout_compte: "Solde de tout compte",
        attestation_reglement: "Attestation de règlement"
      };

      const description = `${typeLabels[quitusDetteData.typeActe] || quitusDetteData.typeActe} - Créancier: ${quitusDetteData.creancier.prenom} ${quitusDetteData.creancier.nom} / Débiteur: ${quitusDetteData.debiteur.prenom} ${quitusDetteData.debiteur.nom} - Montant: ${quitusDetteData.montant.montantTotal} ${quitusDetteData.montant.devise}`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: quitusDetteData
        })
        .select()
        .single();

      if (error) throw error;

      toast.success("Document créé", { description: "Vous pouvez maintenant compléter les détails" });
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setQuitusDetteData({
        typeActe: "",
        creancier: {
          isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", dateNaissance: "",
          lieuNaissance: "", nationalite: "", profession: "", adresseComplete: "", telephone: "",
          email: "", typeIdentite: "", numeroIdentite: "", situationMatrimoniale: "", rib: ""
        },
        debiteur: {
          isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", dateNaissance: "",
          lieuNaissance: "", nationalite: "", profession: "", adresseComplete: "", telephone: "",
          email: "", typeIdentite: "", numeroIdentite: "", situationMatrimoniale: "", rib: ""
        },
        objetDette: {
          natureDette: "", dateNaissanceDette: "", circonstancesDette: "", preuveEcriteExiste: "", temoinsEventuels: ""
        },
        montant: {
          montantTotal: "", devise: "EUR", sommeDejaRemboursee: "", sommeRestantDue: "", montantReconnuDebiteur: "", modalitePret: "", dateExigibiliteSolde: ""
        },
        remboursement: {
          modalite: "", conditionRemboursement: "",
          echeances: [{ id: 1, date: "", montant: "", moyenPaiement: "", consequencesRetard: "" }],
          avecInterets: false, tauxInteret: "", tauxUsuraire: "", capitalisationInterets: "",
          clausePenale: false, montantPenalite: "", pourcentagePenalite: "", delaiGrace: ""
        },
        suretes: {
          cautionPersonnelle: false, cautionIdentite: "", cautionMontant: "", cautionDuree: "",
          garantieSalaire: false, gageMobilier: false, gageDescription: "",
          nantissementTitres: false, nantissementDetails: "",
          hypotheque: false, hypothequeDetails: "",
          depotGarantie: false, depotMontant: "",
          acteAuthentique: false, notaireNom: ""
        },
        remiseDette: {
          remiseTotale: false, remisePartielle: false, montantRemise: "", conditionsRemise: "",
          effetsRetroactifs: false, renonciationPoursuites: false, preuvesPaiementsPartiels: ""
        },
        quitus: {
          typeQuitus: "",
          paiementsRecus: [{ id: 1, date: "", montant: "", modePaiement: "", referenceBancaire: "" }],
          sommesRecuesTotalement: false, renonciationReclamations: false, detteEteinte: false,
          annulationGaranties: false, restitutionDocuments: false
        },
        clausesLegales: {
          consentementLibre: false, reconnaissanceMontant: false, engagementRemboursement: false,
          mentionManuscrite: "", clauseSolidarite: false, clauseDivisibilite: false,
          extinctionDette: false, liberationDefinitive: false, renonciationRecours: false, identificationDette: "",
          clauseNonNovation: false, droitApplicable: "france", tribunalCompetent: "",
          pluraliteDebiteurs: false, solidarite: false
        },
        signatures: {
          dateSignature: "", lieuSignature: "", dateExtinctionEffective: "", signatureNotaire: "non", nomNotaire: "", villeNotaire: ""
        }
      });
      setQuitusCreancierIdentiteFiles([]);
      setQuitusDebiteurIdentiteFiles([]);
      setQuitusPreuveDetteFiles([]);
      setQuitusPreuveTransfertFiles([]);
      setQuitusEcheancierFiles([]);
      setQuitusCautionIdentiteFiles([]);
      setQuitusPreuvesPaiementsFiles([]);
      setQuitusAncienneDetteFiles([]);
      setQuitusJustifDomicileCreancierFiles([]);
      setQuitusJustifDomicileDebiteurFiles([]);
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création quitus/reconnaissance:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Cession de parts sociales
  const handleCessionPartsSubmit = async () => {
    if (!user) return;

    // Validation
    if (!cessionPartsData.typeSociete) {
      toast.error("Type de société requis", { description: "Veuillez sélectionner le type de société" });
      return;
    }
    if (!cessionPartsData.societe.denominationSociale || !cessionPartsData.societe.siren || !cessionPartsData.societe.siegeSocial) {
      toast.error("Informations société requises", { description: "Dénomination, SIREN et siège obligatoires" });
      return;
    }
    if (!cessionPartsData.cedant.nom || !cessionPartsData.cedant.prenom || !cessionPartsData.cedant.adresseComplete) {
      toast.error("Identité cédant requise", { description: "Nom, prénom et adresse obligatoires" });
      return;
    }
    if (cessionPartsData.cessionnaire.typePersonne === "physique") {
      if (!cessionPartsData.cessionnaire.nom || !cessionPartsData.cessionnaire.prenom || !cessionPartsData.cessionnaire.adresseComplete) {
        toast.error("Identité cessionnaire requise", { description: "Nom, prénom et adresse obligatoires" });
        return;
      }
    } else {
      if (!cessionPartsData.cessionnaire.denominationMorale || !cessionPartsData.cessionnaire.representantLegal) {
        toast.error("Informations personne morale requises", { description: "Dénomination et représentant obligatoires" });
        return;
      }
    }
    if (!cessionPartsData.objetCession.nombreParts || !cessionPartsData.objetCession.prixTotal) {
      toast.error("Objet de cession requis", { description: "Nombre de parts et prix obligatoires" });
      return;
    }
    if (!cessionPartsData.signatures.dateSignature || !cessionPartsData.signatures.lieuSignature) {
      toast.error("Signatures requises", { description: "Date et lieu de signature obligatoires" });
      return;
    }

    try {
      const description = `Cession de parts ${cessionPartsData.typeSociete.toUpperCase()} - ${cessionPartsData.societe.denominationSociale} - Cédant: ${cessionPartsData.cedant.prenom} ${cessionPartsData.cedant.nom} - ${cessionPartsData.objetCession.nombreParts} parts pour ${cessionPartsData.objetCession.prixTotal}€`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          contenu_json: cessionPartsData
        })
        .select()
        .single();

      if (error) throw error;

      toast.success("Document créé", { description: "Vous pouvez maintenant compléter les détails" });
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setCessionPartsData({
        typeSociete: "",
        societe: {
          denominationSociale: "", sigle: "", formeJuridique: "", capitalSocial: "", siegeSocial: "",
          siren: "", rcs: "", greffeCompetent: "", activiteSociete: "", dateCreation: "", objetSocial: "",
          pacteAssocies: false, expertComptable: false, gerantNom: "", gerantPrenom: "", gerantAdresse: "", gerantPouvoirs: ""
        },
        cedant: {
          isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", adresseComplete: "",
          email: "", telephone: "", dateNaissance: "", nationalite: "", profession: "", situationMatrimoniale: "",
          regimeMatrimonial: "", typeIdentite: "", numeroIdentite: "", qualiteSociete: ""
        },
        cessionnaire: {
          typePersonne: "physique", clientId: "", nom: "", prenom: "", adresseComplete: "", email: "", telephone: "",
          dateNaissance: "", nationalite: "", profession: "", situationMatrimoniale: "", typeIdentite: "",
          numeroIdentite: "", capaciteJuridique: "majeur", denominationMorale: "", representantLegal: ""
        },
        objetCession: {
          natureTitres: "", typeDroits: "", nombreParts: "", pourcentageCapital: "", valeurNominale: "", prixTotal: "",
          prixUnitaire: "", modeCalcul: "", modalitePaiement: "", ribCedant: "",
          dateEffetCession: "", dateEffetDifferee: "",
          agrement: false, approbationConjoint: false, financementBancaire: false, leveeNantissement: false,
          sansGarantiePassif: false
        },
        agrement: {
          procedureAgrement: "", organeCompetent: "", dateDecisionAgrement: "", modeVoteMajorite: "",
          convocationAssocies: false, voteEffectue: false, majoriteRequise: "",
          notificationStatut: "", delaiLegalRespecte: false
        },
        compteCourant: {
          cessionCCA: false, maintienCCA: false, remboursementImmediat: false, remboursementEchelonne: false,
          compensationPrix: false, garantieSolde: false, montantSoldeCCA: "",
          detteVersTiers: false, natureDetteTiers: "", montantDetteTiers: "", creancierTiers: "", acceptationCreancier: false
        },
        garanties: {
          garantieEviction: false, garantiePropriete: false, garantiePassif: "", garantieActifNet: false,
          absenceNantissement: false, absenceLitiges: false, plafondGarantie: "", dureeGarantie: "",
          exclusions: "", procedureMiseEnJeu: ""
        },
        conjoint: {
          identiteConjoint: "", acceptationCession: false, renonciationCession: false,
          signatureObligatoire: false, regimeMatrimonialPrecise: ""
        },
        droitsEnregistrement: {
          tauxApplicable: "", chargeDroits: ""
        },
        nonConcurrence: {
          clauseNonConcurrence: false, dureeNonConcurrence: "", zoneGeographique: "", activiteInterdite: ""
        },
        notificationSociete: {
          modeNotification: ""
        },
        declarationsLegales: {
          consentementLibre: false, origineLiciteFonds: false, absenceFraude: false, acceptationPrix: false,
          transfertProprieteDateSignature: false, mentionStatutsMisAJour: false, mentionImpositionFiscale: false,
          renonciationDroitPreemption: false
        },
        formalites: {
          modificationCapital: false, miseAJourRegistreMouvements: false, miseAJourRegistreAssocies: false,
          depotGreffe: false, publicationLegale: false, informationBanques: false
        },
        signatures: {
          dateSignature: "", lieuSignature: "", signatureNotaire: false, nomNotaire: "", villeNotaire: ""
        }
      });
      setCessionStatutsFiles([]);
      setCessionKbisFiles([]);
      setCessionComptesFiles([]);
      setCessionRegistreFiles([]);
      setCessionPacteFiles([]);
      setCessionCedantIdFiles([]);
      setCessionCedantMariageFiles([]);
      setCessionExpertiseFiles([]);
      setCessionCCAFiles([]);
      setCessionCessionnaireIdFiles([]);
      setCessionCessionnaireDomicileFiles([]);
      setCessionCessionnaireKbisFiles([]);
      setCessionOrigineFondsFiles([]);
      setCessionPVAgrementFiles([]);
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création cession parts:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour Attestation de propriété immobilière
  const handleAttestationSubmit = async () => {
    if (!user) return;

    // Validation
    if (!attestationData.defunt.nom || !attestationData.defunt.prenom || !attestationData.defunt.dateDeces) {
      toast.error("Informations défunt requises", { description: "Nom, prénom et date de décès obligatoires" });
      return;
    }
    if (attestationData.heritiers.length === 0 || !attestationData.heritiers[0].nom) {
      toast.error("Au moins un héritier requis", { description: "Veuillez ajouter les héritiers" });
      return;
    }
    if (attestationData.biens.length === 0 || !attestationData.biens[0].adresseComplete) {
      toast.error("Au moins un bien requis", { description: "Veuillez décrire les biens immobiliers" });
      return;
    }

    try {
      const description = `Attestation de propriété immobilière - Défunt: ${attestationData.defunt.prenom} ${attestationData.defunt.nom} (décédé le ${attestationData.defunt.dateDeces})
${attestationData.heritiers.length} héritier(s), ${attestationData.biens.length} bien(s)`;
      
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          details: JSON.stringify(attestationData),
          status: 'draft',
        })
        .select()
        .single();

      if (error) throw error;

      toast.success("Attestation créée", { description: "Vous pouvez maintenant compléter les détails" });
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setAttestationData({
        defunt: {
          nom: "", prenom: "", nomNaissance: "", sexe: "", dateNaissance: "", lieuNaissance: "", nationalite: "",
          profession: "", adresseDecesComplete: "", dateDeces: "", lieuDeces: "", domicileFiscalCommune: "", 
          domicileFiscalPays: "", situationMatrimoniale: "", regimeMatrimonial: "", regimeMatrimonialAutre: "",
          dateContratMariage: "", notaireContratMariage: "", existenceContratMariage: false, existencePacs: false, 
          existenceTestament: false, existenceDonationsEntreEpoux: false, existenceDonationsAnterieures: false,
        },
        heritiers: [{
          id: 1, nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", lienParente: "", adresseComplete: "",
          email: "", telephone: "", nationalite: "", profession: "", typeAcceptation: "", statutAge: "", 
          protectionJuridique: "", clientId: "",
        }],
        conjointSurvivant: {
          existe: false, nom: "", prenom: "", regimeMatrimonial: "", droitsConjoint: "",
        },
        biens: [{
          id: 1, adresseComplete: "", codePostal: "", commune: "", cadastreSection: "", cadastreNumero: "",
          cadastreContenance: "", typeBien: "", surfaceHabitable: "", nombrePieces: "", dependances: "", annexes: "",
          equipements: "", situationLocative: "", montantLoyer: "", dateAcquisition: "", natureAcquisition: "",
          repartitionDroits: "", quotePart: "", notaireAcquisition: "", datePublicationSPF: "", volumeSPF: "",
          numeroSPF: "", servitudesActives: "", servitudesPassives: "", pretEnCours: false,
          hypothequeInscrite: false, typeHypotheque: "", montantResiduel: "", necessitMainlevee: false,
          estCopropriete: false, numeroLot: "", quotepartCommunes: "", chargesAnnuelles: "",
          existenceLegsParticuliers: false, precisionLegs: "",
        }],
        regimeMatrimonial: "", droitsConjointSurvivant: "",
        repartitionDroits: { conjoint: "", heritiers: "" },
        destinationBien: "", loiSuccessoraleApplicable: "", confirmationAbsenceAutresHeritiers: false,
        indivisionSuccessorale: false, declarationFiscaleHonneur: false,
        valeurVenale: "", methodeEstimation: "", valeurDeclareeFiscale: "", bureauSPF: "", fichesPreparees: false,
        dateSignature: "", lieuSignature: "", notaireInstrumentaire: "",
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création attestation:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  const handleQuestionnaireSubmit = async () => {
    if (!user) return;
    
    try {
      // Récupérer les infos du client sélectionné
      const selectedClient = clients.find(c => c.id === questionnaireData.clientId);
      if (!selectedClient) {
        toast.error('Veuillez sélectionner un client');
        return;
      }

      // Déterminer qui est le vendeur et qui est l'acquéreur
      const isClientAcheteur = questionnaireData.clientRole === "acheteur";
      const vendeurInfo = isClientAcheteur 
        ? {
            nom: questionnaireData.nomAutrePartie,
            prenom: questionnaireData.prenomAutrePartie,
            adresse: questionnaireData.adresseAutrePartie
          }
        : {
            nom: selectedClient.nom,
            prenom: selectedClient.prenom,
            adresse: selectedClient.adresse
          };
      
      const acquereurInfo = isClientAcheteur
        ? {
            nom: selectedClient.nom,
            prenom: selectedClient.prenom,
            adresse: selectedClient.adresse
          }
        : {
            nom: questionnaireData.nomAutrePartie,
            prenom: questionnaireData.prenomAutrePartie,
            adresse: questionnaireData.adresseAutrePartie
          };

      // Créer le contrat avec les données du questionnaire en description
      const descriptionData = `
TYPE DE CONTRAT: ${questionnaireData.typeContrat === "compromis" ? "Compromis de vente" : "Promesse unilatérale de vente"}

INFORMATIONS SUR LE BIEN:
- Adresse: ${questionnaireData.adresseBien}
- Type de bien: ${questionnaireData.typeBien}
- Surface habitable: ${questionnaireData.surfaceHabitable} m²
- Nombre de pièces: ${questionnaireData.nombrePieces}
- Nature de la propriété: ${questionnaireData.naturePropriete}
- Bien en copropriété: ${questionnaireData.bienCopropriete}
${questionnaireData.bienCopropriete === "oui" ? `- Numéro de lot: ${questionnaireData.numeroLot}\n- Tantièmes: ${questionnaireData.tantièmes}` : ''}
- Occupation du bien: ${questionnaireData.occupationBien}
- Servitudes connues: ${questionnaireData.servitudesConnues}
${questionnaireData.servitudesConnues === "oui" ? `- Description des servitudes: ${questionnaireData.descriptionServitudes}` : ''}
- Bien vendu libre de toute occupation: ${questionnaireData.bienLibre}

VENDEUR:
- Nom: ${vendeurInfo.nom}
- Prénom: ${vendeurInfo.prenom}
- Adresse: ${vendeurInfo.adresse}
- Statut matrimonial: ${isClientAcheteur ? questionnaireData.statutMatrimonialAutrePartie : questionnaireData.statutMatrimonialClient}
${(isClientAcheteur ? questionnaireData.statutMatrimonialAutrePartie : questionnaireData.statutMatrimonialClient) === "marie" || (isClientAcheteur ? questionnaireData.statutMatrimonialAutrePartie : questionnaireData.statutMatrimonialClient) === "pacse" ? `- Régime matrimonial: ${isClientAcheteur ? questionnaireData.regimeMatrimonialAutrePartie : questionnaireData.regimeMatrimonialClient}` : ''}

ACQUÉREUR:
- Nom: ${acquereurInfo.nom}
- Prénom: ${acquereurInfo.prenom}
- Adresse: ${acquereurInfo.adresse}
- Statut matrimonial: ${isClientAcheteur ? questionnaireData.statutMatrimonialClient : questionnaireData.statutMatrimonialAutrePartie}
${(isClientAcheteur ? questionnaireData.statutMatrimonialClient : questionnaireData.statutMatrimonialAutrePartie) === "marie" || (isClientAcheteur ? questionnaireData.statutMatrimonialClient : questionnaireData.statutMatrimonialAutrePartie) === "pacse" ? `- Régime matrimonial: ${isClientAcheteur ? questionnaireData.regimeMatrimonialClient : questionnaireData.regimeMatrimonialAutrePartie}` : ''}

CONDITIONS FINANCIÈRES:
- Prix de vente: ${questionnaireData.prixVente} €
- Dépôt de garantie: ${questionnaireData.depotGarantie} €
- Modalités de paiement: ${questionnaireData.modalitesPaiement}

${questionnaireData.typeContrat === "compromis" ? `
CONDITIONS SUSPENSIVES:
- Condition de prêt: ${questionnaireData.conditionPret}
${questionnaireData.conditionPret === "oui" ? `
DÉTAILS DU PRÊT IMMOBILIER:
- Montant du prêt: ${questionnaireData.montantPret} €
- Durée du prêt: ${questionnaireData.dureePret} années
- Taux d'intérêt maximal: ${questionnaireData.tauxInteretMax} %
- Délai pour accord de prêt: ${questionnaireData.delaiAccordPret}` : ''}
- Diagnostics: ${questionnaireData.conditionDiagnostics}
- Autres conditions: ${questionnaireData.autresConditions}` : ''}

DROIT DE PRÉEMPTION:
- Droit de préemption urbain: ${questionnaireData.droitPreemptionUrbain}
- Locataire avec droit de préemption: ${questionnaireData.locatairePreemption}

${questionnaireData.typeContrat === "promesse_unilaterale" ? `
PROMESSE UNILATÉRALE:
- Durée de l'option: ${questionnaireData.dureeOption} jours
- Date limite de levée d'option: ${questionnaireData.dateLimiteOption}
- Indemnité d'immobilisation: ${questionnaireData.indemniteImmobilisation}` : ''}

DÉLAIS:
- Date signature acte définitif: ${questionnaireData.dateSignatureActeDefinitif}
- Délai de réflexion: ${questionnaireData.delaiReflexion} jours

INFORMATIONS COMPLÉMENTAIRES:
- Charges de copropriété: ${questionnaireData.chargesCopropriete}
- Travaux à prévoir: ${questionnaireData.travauxAPrevenir}
- Autres informations: ${questionnaireData.autresInformations}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success('Contrat créé avec succès', { 
        description: 'Les informations ont été enregistrées et pourront être utilisées pour générer le document'
      });
      
      setShowQuestionDialog(false);
      // Réinitialiser le questionnaire
      setQuestionnaireData({
        typeContrat: "",
        adresseBien: "",
        typeBien: "",
        surfaceHabitable: "",
        nombrePieces: "",
        naturePropriete: "",
        bienCopropriete: "",
        numeroLot: "",
        tantièmes: "",
        occupationBien: "",
        servitudesConnues: "",
        descriptionServitudes: "",
        bienLibre: "",
        clientId: "",
        clientRole: "",
        statutMatrimonialClient: "",
        regimeMatrimonialClient: "",
        precisionRegimeClient: "",
        nomAutrePartie: "",
        prenomAutrePartie: "",
        adresseAutrePartie: "",
        statutMatrimonialAutrePartie: "",
        regimeMatrimonialAutrePartie: "",
        precisionRegimeAutrePartie: "",
        prixVente: "",
        depotGarantie: "",
        modalitesPaiement: "",
        conditionPret: "",
        montantPret: "",
        dureePret: "",
        tauxInteretMax: "",
        delaiAccordPret: "",
        conditionDiagnostics: "",
        autresConditions: "",
        droitPreemptionUrbain: "",
        locatairePreemption: "",
        dateSignatureActeDefinitif: "",
        delaiReflexion: "",
        dureeOption: "",
        dateLimiteOption: "",
        indemniteImmobilisation: "",
        chargesCopropriete: "",
        travauxAPrevenir: "",
        autresInformations: "",
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour la soumission du questionnaire Acte de vente immobilière
  const handleActeVenteSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      // Validation des champs requis
      if (!acteVenteData.clientId || !acteVenteData.clientRole) {
        toast.error('Veuillez sélectionner un client et son rôle');
        return;
      }

      if (!acteVenteData.vendeurNom || !acteVenteData.acheteurNom) {
        toast.error('Veuillez remplir les informations du vendeur et de l\'acheteur');
        return;
      }

      if (!acteVenteData.adresseBien || !acteVenteData.typeBien || !acteVenteData.prixVente) {
        toast.error('Veuillez remplir les champs obligatoires (adresse, type de bien, prix)');
        return;
      }

      // Créer le contrat avec les données complètes en description
      const descriptionData = `
TYPE DE CONTRAT: Acte de vente immobilière

═══════════════════════════════════════════════════════════════
INFORMATIONS SUR LE BIEN
═══════════════════════════════════════════════════════════════
- Adresse complète: ${acteVenteData.adresseBien}
- Type de bien: ${acteVenteData.typeBien}
- Nature de propriété: ${acteVenteData.naturePropriete}
- Destination: ${acteVenteData.destinationBien}

RÉFÉRENCES CADASTRALES:
- Section cadastrale: ${acteVenteData.sectionCadastrale}
- Numéro cadastral: ${acteVenteData.numeroCadastral}
- Contenance cadastrale: ${acteVenteData.contenanceCadastrale}

SURFACES:
- Surface habitable: ${acteVenteData.surfaceHabitable} m²
- Surface terrain: ${acteVenteData.surfaceTerrain} m²
- Nombre de pièces: ${acteVenteData.nombrePieces}

${acteVenteData.bienCopropriete === "oui" ? `
COPROPRIÉTÉ:
- Bien en copropriété: Oui
- Numéros de lot(s): ${acteVenteData.numerosLots}
- Tantièmes / Quote-parts: ${acteVenteData.tantièmes}
- Règlement disponible: ${acteVenteData.reglementCopro}
- Charges annuelles: ${acteVenteData.chargesAnnuelles} €` : `
COPROPRIÉTÉ: Non`}

═══════════════════════════════════════════════════════════════
ÉTAT JURIDIQUE DU BIEN
═══════════════════════════════════════════════════════════════
- Servitudes existantes: ${acteVenteData.servitudesExistantes || 'Aucune'}
- Hypothèques / Inscriptions: ${acteVenteData.hypotheques || 'Aucune'}
- Bien libre ou occupé: ${acteVenteData.bienLibreOuOccupe}
${acteVenteData.bienLibreOuOccupe === "occupe" ? `- Informations bail: ${acteVenteData.informationsBail}` : ''}

═══════════════════════════════════════════════════════════════
VENDEUR
═══════════════════════════════════════════════════════════════
- Nom complet: ${acteVenteData.vendeurNom} ${acteVenteData.vendeurPrenom}
- Adresse: ${acteVenteData.vendeurAdresse}
- Date de naissance: ${acteVenteData.vendeurDateNaissance}
- Lieu de naissance: ${acteVenteData.vendeurLieuNaissance}
- Nationalité: ${acteVenteData.vendeurNationalite}
- Profession: ${acteVenteData.vendeurProfession}
- Statut matrimonial: ${acteVenteData.vendeurStatutMatrimonial}
${(acteVenteData.vendeurStatutMatrimonial === "marie" || acteVenteData.vendeurStatutMatrimonial === "pacse") ? `- Régime matrimonial: ${acteVenteData.vendeurRegimeMatrimonial}` : ''}
- Pièce d'identité: ${acteVenteData.vendeurPieceIdentite} n° ${acteVenteData.vendeurNumeroIdentite}

═══════════════════════════════════════════════════════════════
ACHETEUR
═══════════════════════════════════════════════════════════════
- Nom complet: ${acteVenteData.acheteurNom} ${acteVenteData.acheteurPrenom}
- Adresse: ${acteVenteData.acheteurAdresse}
- Date de naissance: ${acteVenteData.acheteurDateNaissance}
- Lieu de naissance: ${acteVenteData.acheteurLieuNaissance}
- Nationalité: ${acteVenteData.acheteurNationalite}
- Profession: ${acteVenteData.acheteurProfession}
- Statut matrimonial: ${acteVenteData.acheteurStatutMatrimonial}
${(acteVenteData.acheteurStatutMatrimonial === "marie" || acteVenteData.acheteurStatutMatrimonial === "pacse") ? `- Régime matrimonial: ${acteVenteData.acheteurRegimeMatrimonial}` : ''}
- Mode d'acquisition: ${acteVenteData.acheteurModeAcquisition}
${acteVenteData.acheteurModeAcquisition === "indivision" ? `- Quote-part: ${acteVenteData.acheteurQuotePart}%` : ''}

═══════════════════════════════════════════════════════════════
CONDITIONS FINANCIÈRES
═══════════════════════════════════════════════════════════════
- Prix de vente: ${acteVenteData.prixVente} €
- Origine des fonds: ${acteVenteData.origineFonds}
- Dépôt de garantie: ${acteVenteData.depotGarantie} €
- Frais de notaire: ${acteVenteData.fraisNotaire} €
- Répartition prorata: ${acteVenteData.repartitionProrata}
- Modalités de paiement: ${acteVenteData.modalitesPaiement}

${acteVenteData.pretImmobilier === "oui" ? `
PRÊT IMMOBILIER:
- Montant du prêt: ${acteVenteData.montantPret} €
- Banque prêteuse: ${acteVenteData.banquePreteur}
- Taux réel: ${acteVenteData.tauxPret} %
- Durée: ${acteVenteData.dureePret} années
- Type de prêt: ${acteVenteData.typePret}
- Date accord: ${acteVenteData.dateAccordPret}
- Conditions: ${acteVenteData.conditionsPret}` : ''}

═══════════════════════════════════════════════════════════════
DOCUMENTS & DIAGNOSTICS
═══════════════════════════════════════════════════════════════
${acteVenteData.diagnosticsFournis}

═══════════════════════════════════════════════════════════════
ORIGINE DE PROPRIÉTÉ & DÉCLARATIONS
═══════════════════════════════════════════════════════════════
- Date d'acquisition précédente: ${acteVenteData.origineProprieteDateAcquisition}
- Référence acte: ${acteVenteData.origineReferenceActe}
- Travaux (10 ans): ${acteVenteData.travauxDerniers10ans || 'Aucun'}
- Conformité urbanisme: ${acteVenteData.conformiteUrbanisme}
- Assurance dommage-ouvrage: ${acteVenteData.assuranceDommageOuvrage}
- Taxes foncières N-1: ${acteVenteData.taxesFoncieres} €
- Sinistre récent: ${acteVenteData.sinistreRecent}

═══════════════════════════════════════════════════════════════
URBANISME
═══════════════════════════════════════════════════════════════
- Zone PLU/POS: ${acteVenteData.zonePLU}
- Droit de préemption: ${acteVenteData.droitPreemption}
- Déclarations d'urbanisme: ${acteVenteData.declarationsUrbanisme}
- Documents fournis: ${acteVenteData.documentsUrbanisme}

═══════════════════════════════════════════════════════════════
DÉLAIS & SIGNATURE
═══════════════════════════════════════════════════════════════
- Date de signature: ${acteVenteData.dateSignatureActe}
- Lieu de signature: ${acteVenteData.lieuSignature}
- Remise des clés: ${acteVenteData.remiseCles}
${acteVenteData.procuration === "oui" ? `- Procuration: Oui\n- Mandataire: ${acteVenteData.identiteMandataire}` : '- Procuration: Non'}

═══════════════════════════════════════════════════════════════
ANNEXES
═══════════════════════════════════════════════════════════════
- Titre de propriété: ${acteVenteData.titrePropriete}
- Diagnostics: ${acteVenteData.diagnostics}
- Plan du bien: ${acteVenteData.planBien}
- Règlement copropriété: ${acteVenteData.reglementCopropriete}
- État daté: ${acteVenteData.etatDate}
- Attestation assurance: ${acteVenteData.attestationAssurance}
- Relevé syndic: ${acteVenteData.releveSyndic}

═══════════════════════════════════════════════════════════════
INFORMATIONS COMPLÉMENTAIRES
═══════════════════════════════════════════════════════════════
- Travaux prévus copropriété: ${acteVenteData.travauxPrevusCopro || 'Aucun'}
- Procédures en cours: ${acteVenteData.proceduresEnCours || 'Aucune'}
- Différends voisins: ${acteVenteData.differendsVoisins || 'Aucun'}
- Particularités: ${acteVenteData.particularitesBien || 'Aucune'}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success('Acte de vente créé avec succès', { 
        description: 'Toutes les informations ont été enregistrées et pourront être utilisées pour générer le document'
      });
      
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire acte de vente
      setActeVenteData({
        clientId: "",
        clientRole: "",
        adresseBien: "",
        typeBien: "",
        naturePropriete: "",
        sectionCadastrale: "",
        numeroCadastral: "",
        contenanceCadastrale: "",
        surfaceHabitable: "",
        surfaceTerrain: "",
        nombrePieces: "",
        equipements: [],
        bienCopropriete: "",
        numerosLots: "",
        tantièmes: "",
        reglementCopro: "",
        chargesAnnuelles: "",
        servitudesExistantes: "",
        hypotheques: "",
        destinationBien: "",
        bienLibreOuOccupe: "",
        informationsBail: "",
        vendeurNom: "",
        vendeurPrenom: "",
        vendeurAdresse: "",
        vendeurDateNaissance: "",
        vendeurLieuNaissance: "",
        vendeurNationalite: "",
        vendeurProfession: "",
        vendeurStatutMatrimonial: "",
        vendeurRegimeMatrimonial: "",
        vendeurPrecisionRegime: "",
        vendeurPieceIdentite: "",
        vendeurNumeroIdentite: "",
        acheteurNom: "",
        acheteurPrenom: "",
        acheteurAdresse: "",
        acheteurDateNaissance: "",
        acheteurLieuNaissance: "",
        acheteurNationalite: "",
        acheteurProfession: "",
        acheteurStatutMatrimonial: "",
        acheteurRegimeMatrimonial: "",
        acheteurPrecisionRegime: "",
        acheteurModeAcquisition: "",
        acheteurQuotePart: "",
        prixVente: "",
        origineFonds: "",
        depotGarantie: "",
        fraisNotaire: "",
        repartitionProrata: "",
        modalitesPaiement: "",
        pretImmobilier: "",
        montantPret: "",
        banquePreteur: "",
        tauxPret: "",
        dureePret: "",
        typePret: "",
        dateAccordPret: "",
        conditionsPret: "",
        diagnosticsFournis: "",
        origineProprieteDateAcquisition: "",
        origineReferenceActe: "",
        travauxDerniers10ans: "",
        conformiteUrbanisme: "",
        assuranceDommageOuvrage: "",
        taxesFoncieres: "",
        sinistreRecent: "",
        zonePLU: "",
        droitPreemption: "",
        declarationsUrbanisme: "",
        documentsUrbanisme: "",
        dateSignatureActe: "",
        lieuSignature: "",
        remiseCles: "",
        procuration: "",
        identiteMandataire: "",
        titrePropriete: "",
        diagnostics: "",
        planBien: "",
        reglementCopropriete: "",
        etatDate: "",
        attestationAssurance: "",
        releveSyndic: "",
        travauxPrevusCopro: "",
        proceduresEnCours: "",
        differendsVoisins: "",
        particularitesBien: "",
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création acte de vente:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  const refreshContrats = () => {
    // Force un rechargement
    if (!user) return;
    supabase
      .from('contrats')
      .select('id,name,category,type,created_at,updated_at')
      .eq('owner_id', user.id)
      .eq('role', role)
      .order('created_at', { ascending: false })
      .then(({ data, error }) => {
        if (error) {
          console.error('Erreur rechargement contrats:', error);
        } else {
          setContrats(data as ContratRow[]);
        }
      });
  };

  // Handler pour la soumission du bail d'habitation
  const handleBailHabitationSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!bailHabitationData.bailleurClientId) {
        toast.error('Veuillez sélectionner un client bailleur');
        return;
      }

      if (!bailHabitationData.locataireNom || !bailHabitationData.adresseLogement || !bailHabitationData.loyerMensuel) {
        toast.error('Veuillez remplir les champs obligatoires (locataire, adresse logement, loyer)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: Bail d'habitation ${bailHabitationData.typeBail === "meuble" ? "meublé" : "vide"}

═══════════════════════════════════════════════════════════════
BAILLEUR
═══════════════════════════════════════════════════════════════
- Nom complet: ${bailHabitationData.bailleurNom} ${bailHabitationData.bailleurPrenom}
- Adresse: ${bailHabitationData.bailleurAdresse}
- Date de naissance: ${bailHabitationData.bailleurDateNaissance}
- Lieu de naissance: ${bailHabitationData.bailleurLieuNaissance}
- Nationalité: ${bailHabitationData.bailleurNationalite}
- Profession: ${bailHabitationData.bailleurProfession}
- Statut matrimonial: ${bailHabitationData.bailleurStatutMatrimonial}
- Pièce d'identité: ${bailHabitationData.bailleurPieceIdentite} n° ${bailHabitationData.bailleurNumeroIdentite}

═══════════════════════════════════════════════════════════════
LOCATAIRE
═══════════════════════════════════════════════════════════════
- Nom complet: ${bailHabitationData.locataireNom} ${bailHabitationData.locatairePrenom}
- Adresse: ${bailHabitationData.locataireAdresse}
- Date de naissance: ${bailHabitationData.locataireDateNaissance}
- Lieu de naissance: ${bailHabitationData.locataireLieuNaissance}
- Nationalité: ${bailHabitationData.locataireNationalite}
- Profession: ${bailHabitationData.locataireProfession}
- Statut matrimonial: ${bailHabitationData.locataireStatutMatrimonial}
- Pièce d'identité: ${bailHabitationData.locatairePieceIdentite} n° ${bailHabitationData.locataireNumeroIdentite}
- Nombre d'occupants: ${bailHabitationData.nombreOccupants}

${bailHabitationData.aGarant === "oui" ? `═══════════════════════════════════════════════════════════════
GARANT
═══════════════════════════════════════════════════════════════
- Nom complet: ${bailHabitationData.garantNom} ${bailHabitationData.garantPrenom}
- Adresse: ${bailHabitationData.garantAdresse}
- Profession: ${bailHabitationData.garantProfession}
- Type de caution: ${bailHabitationData.typeCaution}
` : ''}

═══════════════════════════════════════════════════════════════
LOGEMENT
═══════════════════════════════════════════════════════════════
- Adresse complète: ${bailHabitationData.adresseLogement}
- Type de logement: ${bailHabitationData.typeLogement}
- Surface habitable: ${bailHabitationData.surfaceHabitable} m²
- Année construction: ${bailHabitationData.anneeConstruction || 'Non renseignée'}
- État d'usage: ${bailHabitationData.etatUsage}
- Copropriété: ${bailHabitationData.logementCopropriete}

═══════════════════════════════════════════════════════════════
CONDITIONS FINANCIÈRES
═══════════════════════════════════════════════════════════════
- Loyer mensuel: ${bailHabitationData.loyerMensuel} €
- Charges mensuelles: ${bailHabitationData.chargesMensuelles} €
- Type de charges: ${bailHabitationData.typologieCharges}
- Dépôt de garantie: ${bailHabitationData.depotGarantie} €
- Premier loyer payable le: ${bailHabitationData.premierLoyerDate}
- Mode de paiement: ${bailHabitationData.modePaiement}

═══════════════════════════════════════════════════════════════
DATES DU BAIL
═══════════════════════════════════════════════════════════════
- Type: ${bailHabitationData.typeBail === "meuble" ? "Location meublée" : "Location vide"}
- Durée: ${bailHabitationData.typeBailDuree}
- Date de début: ${bailHabitationData.dateDebutBail}

═══════════════════════════════════════════════════════════════
INFORMATIONS COMPLÉMENTAIRES
═══════════════════════════════════════════════════════════════
${bailHabitationData.informationsComplementaires || 'Aucune'}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Bail d'habitation - ${bailHabitationData.locataireNom} ${bailHabitationData.locatairePrenom}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Bail d'habitation créé avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setBailHabitationData({
        clientRole: "",
        clientId: "",
        bailleurClientId: "",
        bailleurNom: "",
        bailleurPrenom: "",
        bailleurAdresse: "",
        bailleurDateNaissance: "",
        bailleurLieuNaissance: "",
        bailleurNationalite: "",
        bailleurProfession: "",
        bailleurStatutMatrimonial: "",
        bailleurPieceIdentite: "",
        bailleurNumeroIdentite: "",
        locataireClientId: "",
        locataireNom: "",
        locatairePrenom: "",
        locataireAdresse: "",
        locataireDateNaissance: "",
        locataireLieuNaissance: "",
        locataireNationalite: "",
        locataireProfession: "",
        locataireStatutMatrimonial: "",
        locatairePieceIdentite: "",
        locataireNumeroIdentite: "",
        nombreOccupants: "",
        locataireRevenusMensuelsNets: "",
        locataireTypeContrat: "",
        locataireEmployeur: "",
        locataireEmployeurAdresse: "",
        locataireAncienneteEmployeur: "",
        colocation: "",
        solidariteColocataires: "",
        nombreColocataires: "",
        colocatairesNoms: "",
        aGarant: "",
        garantNom: "",
        garantPrenom: "",
        garantAdresse: "",
        garantDateNaissance: "",
        garantLieuNaissance: "",
        garantStatutMatrimonial: "",
        garantProfession: "",
        garantPieceIdentite: "",
        garantNumeroIdentite: "",
        typeCaution: "",
        adresseLogement: "",
        typeLogement: "",
        etageNumeroLot: "",
        surfaceHabitable: "",
        surfaceAnnexes: "",
        anneeConstruction: "",
        etatUsage: "",
        dependances: [],
        placeParking: "",
        numeroPlaceParking: "",
        entretienJardin: "",
        logementCopropriete: "",
        reglementCoproFourni: "",
        typeBail: "",
        contratMeuble: "",
        mobilierListeComplete: [],
        inventaireFourni: "",
        inventaireMobilierTexte: "",
        etatMobilierEntree: "",
        entretienMobilier: "",
        mobilierLiterie: false,
        mobilierOccultation: false,
        mobilierPlaquesCuisson: false,
        mobilierFourMicroondes: false,
        mobilierRefrigo: false,
        mobilierCongelateur: false,
        mobilierVaisselle: false,
        mobilierUstensiles: false,
        mobilierTable: false,
        mobilierSieges: false,
        mobilierEtageres: false,
        mobilierLampes: false,
        mobilierMaterielEntretien: false,
        typeDureeMeuble: "",
        motifBailMobilite: "",
        natureBailleur: "",
        residencePrincipale: "",
        destinationBien: "",
        souslocationAutorisee: "",
        colocationPossible: "",
        animauxAutorises: "",
        precisionAnimaux: "",
        loyerMensuel: "",
        chargesMensuelles: "",
        typeCharges: "",
        typologieCharges: "",
        depotGarantie: "",
        premierLoyerDate: "",
        modePaiement: "",
        ibanBailleur: "",
        periodiciteRegularisationCharges: "",
        revisionLoyerPrevue: "",
        indiceIRL: "",
        trimestreReference: "",
        typeBailDuree: "",
        dateDebutBail: "",
        dureeBail: "",
        diagnosticsFournis: "",
        diagnosticDPE: "",
        diagnosticElectricite: "",
        diagnosticGaz: "",
        diagnosticERP: "",
        diagnosticPlomb: "",
        diagnosticAmiante: "",
        etatLieuxFourni: "",
        inventaireMobilierFourni: "",
        travauxRecents: "",
        travauxDerniers6Mois: "",
        descriptionTravaux: "",
        typeChauffage: "",
        compteursIndividuels: "",
        releveCompteurs: "",
        attestationAssurance: "",
        servitudes: "",
        logementZoneERP: "",
        usageProfessionnel: "",
        informationsComplementaires: "",
        nombreJeuxCles: "",
        typesCles: [],
        codesFournis: "",
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création bail:', err);
      toast.error('Erreur lors de la création du bail');
    }
  };

  const handleBailCommercialSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!bailCommercialData.typeBail || !bailCommercialData.statutBailleur || !bailCommercialData.adresseLocal || !bailCommercialData.loyerMensuelHT) {
        toast.error('Veuillez remplir les champs obligatoires (type de bail, statut bailleur, adresse local, loyer)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: ${bailCommercialData.typeBail === "commercial" ? "Bail commercial" : "Bail professionnel"}

═══════════════════════════════════════════════════════════════
BAILLEUR
═══════════════════════════════════════════════════════════════
- Statut: ${bailCommercialData.statutBailleur === "physique" ? "Personne physique" : "Personne morale (société)"}
${bailCommercialData.statutBailleur === "physique" ? `- Nom: ${bailCommercialData.bailleurNom} ${bailCommercialData.bailleurPrenom}` : `- Dénomination: ${bailCommercialData.bailleurDenomination}
- Forme juridique: ${bailCommercialData.bailleurFormeJuridique}
- SIREN: ${bailCommercialData.bailleurSiren}
- SIRET: ${bailCommercialData.bailleurSiret}`}
- Adresse: ${bailCommercialData.bailleurAdresse}

═══════════════════════════════════════════════════════════════
LOCAL COMMERCIAL
═══════════════════════════════════════════════════════════════
- Adresse: ${bailCommercialData.adresseLocal}
- Nature: ${bailCommercialData.natureLocal}
- Surface totale: ${bailCommercialData.surfaceTotale} m²

═══════════════════════════════════════════════════════════════
ACTIVITÉ
═══════════════════════════════════════════════════════════════
- Activité principale autorisée: ${bailCommercialData.activitePrincipale}

═══════════════════════════════════════════════════════════════
CONDITIONS FINANCIÈRES
═══════════════════════════════════════════════════════════════
- Loyer mensuel HT: ${bailCommercialData.loyerMensuelHT} €
- Charges mensuelles: ${bailCommercialData.chargesMensuelles} €

═══════════════════════════════════════════════════════════════
DURÉE DU BAIL
═══════════════════════════════════════════════════════════════
- Type de bail: ${bailCommercialData.typeBail}
- Date de prise d'effet: ${bailCommercialData.datePriseEffet}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Bail commercial - ${bailCommercialData.adresseLocal}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Bail commercial créé avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setBailCommercialData({
        clientRole: "",
        clientId: "",
        bailleurClientId: "",
        statutBailleur: "",
        bailleurNom: "",
        bailleurPrenom: "",
        bailleurAdresse: "",
        bailleurDateNaissance: "",
        bailleurLieuNaissance: "",
        bailleurNationalite: "",
        bailleurStatutMatrimonial: "",
        bailleurRegimeMatrimonial: "",
        bailleurProfession: "",
        bailleurDenomination: "",
        bailleurFormeJuridique: "",
        bailleurSiren: "",
        bailleurSiret: "",
        bailleurSiegeSocial: "",
        bailleurCapitalSocial: "",
        bailleurRepresentant: "",
        bailleurRepresentantPrenom: "",
        bailleurRepresentantFonction: "",
        bailleurRepresentantEstLegal: "",
        bailleurMandataireNom: "",
        bailleurMandatairePrenom: "",
        bailleurMandataireTypePouvoir: "",
        locataireClientId: "",
        statutLocataire: "",
        locataireNom: "",
        locatairePrenom: "",
        locataireAdresse: "",
        locataireDateNaissance: "",
        locataireLieuNaissance: "",
        locataireNationalite: "",
        locataireStatutMatrimonial: "",
        locataireRegimeMatrimonial: "",
        locataireProfession: "",
        locataireTelephone: "",
        locataireEmail: "",
        locataireExerceEnNomPropre: "",
        locataireActivite: "",
        locataireSirenPersonnel: "",
        locataireEntrepriseEnCreation: "",
        locataireImmatriculation: "",
        locataireDenomination: "",
        locataireFormeJuridique: "",
        locataireSiege: "",
        locataireSiren: "",
        locataireSiret: "",
        locataireObjetSocial: "",
        locataireCapital: "",
        locataireRepresentant: "",
        locataireRepresentantPrenom: "",
        locataireRepresentantFonction: "",
        locataireMandataireNom: "",
        locataireMandatairePrenom: "",
        locataireMandataireTypePouvoir: "",
        activitePrincipale: "",
        activitesAnnexes: "",
        destinationBail: "",
        clauseExclusivite: "",
        clauseNonConcurrence: "",
        adresseLocal: "",
        natureLocal: "",
        surfaceTotale: "",
        lotsCopropriete: "",
        etageNumero: "",
        partiesPrivatives: [],
        longueurVitrine: "",
        accesLivraison: "",
        etatGeneral: "",
        travauxBailleur: "",
        travauxLocataire: "",
        etatLocalRemise: "",
        diagnosticAmiante: "",
        typeBail: "",
        datePriseEffet: "",
        dureeTotale: "",
        renouvellementAuto: "",
        loyerAnnuelHT: "",
        loyerMensuelHT: "",
        modalitePaiement: "",
        typeIndexation: "",
        chargesMensuelles: "",
        typeCharges: "",
        depotGarantie: "",
        modePaiementLoyer: "",
        ibanBailleur: "",
        chargesLocataire: [],
        chargesBailleur: [],
        compteursIndividuels: "",
        cautionPersonnelle: "",
        garantieBancaire: "",
        montantGaranti: "",
        dureeGarantie: "",
        diagnosticDPE: "",
        diagnosticAmianteDTA: "",
        diagnosticERP: "",
        diagnosticElectricite: "",
        diagnosticGaz: "",
        diagnosticTermites: "",
        attestationConformiteERP: "",
        cedabilite: "",
        conditionsCession: "",
        droitPreemptionCommune: "",
        derogationUsageLocal: "",
        clauseRecettes: "",
        clauseNonAffectation: "",
        clauseNonConcurrenceDetails: "",
        presenceCompteurs: "",
        releveCompteurs: "",
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création bail commercial:', err);
      toast.error('Erreur lors de la création du bail commercial');
    }
  };

  const handleIndivisionSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!indivisionData.typeBien || !indivisionData.origineIndivision) {
        toast.error('Veuillez remplir les champs obligatoires (type de bien, origine)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: Convention d'indivision

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Type de bien: ${indivisionData.typeBien}
${indivisionData.typeBien === "autre" ? `- Précision: ${indivisionData.typeBienAutre}` : ""}
- Origine de l'indivision: ${indivisionData.origineIndivision}
${indivisionData.origineIndivision === "autre" ? `- Précision: ${indivisionData.origineIndivisionAutre}` : ""}
- Objet: ${indivisionData.objetConvention}

═══════════════════════════════════════════════════════════════
INDIVISAIRES
═══════════════════════════════════════════════════════════════
Nombre d'indivisaires: ${indivisionData.indivisaires.length}
${indivisionData.indivisaires.map((ind, idx) => `
Indivisaire ${idx + 1}:
- Nom: ${ind.nom} ${ind.prenom}
- Quote-part: ${ind.quotePart}%
`).join('')}

═══════════════════════════════════════════════════════════════
BIEN EN INDIVISION
═══════════════════════════════════════════════════════════════
${indivisionData.typeBien === "immobilier" ? `- Adresse: ${indivisionData.adresseBien}
- Nature: ${indivisionData.natureBienImmobilier}
- Description: ${indivisionData.descriptionBien}
- Surface: ${indivisionData.surfaceBien} m²
- Références cadastrales: ${indivisionData.referencesCadastrales}
- État locatif: ${indivisionData.etatLocatif}
- Valeur vénale: ${indivisionData.valeurVenale} €` : 
indivisionData.typeBien === "mobilier" ? `- Description: ${indivisionData.descriptionBienMobilier}
- Valeur estimée: ${indivisionData.valeurEstimee} €` : ""}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Convention d'indivision - ${indivisionData.adresseBien || indivisionData.descriptionBienMobilier || 'Bien indivis'}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Convention d'indivision créée avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setIndivisionData({
        typeBien: "",
        typeBienAutre: "",
        origineIndivision: "",
        origineIndivisionAutre: "",
        objetConvention: "",
        indivisaires: [{
          id: 1,
          isClient: false,
          clientId: "",
          nom: "",
          prenom: "",
          adresse: "",
          dateNaissance: "",
          lieuNaissance: "",
          nationalite: "",
          profession: "",
          statutMatrimonial: "",
          regimeMatrimonial: "",
          typeIdentite: "",
          numeroIdentite: "",
          email: "",
          telephone: "",
          quotePart: "",
          origineQuotePart: "",
        }],
        adresseBien: "",
        natureBienImmobilier: "",
        descriptionBien: "",
        surfaceBien: "",
        referencesCadastrales: "",
        etatLocatif: "",
        montantLoyer: "",
        dureeBail: "",
        valeurVenale: "",
        dateEstimation: "",
        sourceEstimation: "",
        descriptionBienMobilier: "",
        valeurEstimee: "",
        numerosSerie: "",
        dureeType: "",
        dureeAnnees: "",
        conditionsRenouvellement: "",
        conditionsSortie: "",
        gerantNom: "",
        gerantPrenom: "",
        gerantEstIndivisaire: "",
        pouvoirsGerant: [],
        pouvoirsAutres: "",
        dureeMandat: "",
        decisionsType: "",
        casUnanimite: "",
        chargesRepartition: "",
        chargesRepartitionAutre: "",
        modalitesRemboursement: "",
        compteBancaire: "",
        compteTitulaires: "",
        compteModalites: "",
        utilisationParIndivisaires: "",
        utilisationConditions: "",
        indemnitéOccupation: "",
        indemniteOccupationMontant: "",
        indemniteOccupationFrequence: "",
        locationAutorisee: "",
        locationMandataire: "",
        locationRepartitionLoyers: "",
        travauxAutorises: "",
        travauxDecision: "",
        travauxRepartitionCouts: "",
        travauxUrgents: "",
        travauxDocumentation: "",
        ventePartLibre: "",
        droitPreemption: "",
        evaluationPart: "",
        delaiRachat: "",
        modalitesPaiement: "",
        conditionsMiseEnVente: "",
        decisionVente: "",
        mandataireVente: "",
        repartitionPrix: "",
        gestionPlusValues: "",
        registreDepenses: "",
        archivageFactures: "",
        modalitesRemboursementAvances: "",
        rapportAnnuel: "",
        resolutionLitiges: [],
        solidariteDettes: "",
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création convention d\'indivision:', err);
      toast.error('Erreur lors de la création de la convention');
    }
  };

  const handleMainleveeSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!mainleveeData.informationsGenerales.typeMainlevee || !mainleveeData.informationsGenerales.natureInscription) {
        toast.error('Veuillez remplir les champs obligatoires (type de mainlevée, nature de l\'inscription)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: Mainlevée d'hypothèque

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Type de mainlevée: ${mainleveeData.informationsGenerales.typeMainlevee}
${mainleveeData.informationsGenerales.typeMainlevee === "partielle" ? `- Précision: ${mainleveeData.informationsGenerales.precisionPartielle}` : ""}
- Nature de l'inscription: ${mainleveeData.informationsGenerales.natureInscription}
- Numéro d'inscription: ${mainleveeData.informationsGenerales.numeroInscription}
- Date d'inscription: ${mainleveeData.informationsGenerales.dateInscription}
- Volume: ${mainleveeData.informationsGenerales.volume}
- Numéro de publication: ${mainleveeData.informationsGenerales.numeroPublication}

═══════════════════════════════════════════════════════════════
CRÉANCIER
═══════════════════════════════════════════════════════════════
Type: ${mainleveeData.creancier.typeCreancier}
${mainleveeData.creancier.typeCreancier === "banque" ? `
- Dénomination: ${mainleveeData.creancierBanque.denomination}
- SIREN: ${mainleveeData.creancierBanque.siren}
- Siège social: ${mainleveeData.creancierBanque.siegeSocial}
- Représentant: ${mainleveeData.creancierBanque.representantNom} ${mainleveeData.creancierBanque.representantPrenom}
- Fonction: ${mainleveeData.creancierBanque.representantFonction}
` : `
- Nom: ${mainleveeData.creancierPersonne.nom} ${mainleveeData.creancierPersonne.prenom}
- Date de naissance: ${mainleveeData.creancierPersonne.dateNaissance}
- Lieu de naissance: ${mainleveeData.creancierPersonne.lieuNaissance}
- Adresse: ${mainleveeData.creancierPersonne.adresse}
- Nationalité: ${mainleveeData.creancierPersonne.nationalite}
- Situation familiale: ${mainleveeData.creancierPersonne.situationFamiliale}
${mainleveeData.creancierPersonne.regimeMatrimonial ? `- Régime matrimonial: ${mainleveeData.creancierPersonne.regimeMatrimonial}` : ""}
`}

═══════════════════════════════════════════════════════════════
DÉBITEURS
═══════════════════════════════════════════════════════════════
Nombre de débiteurs: ${mainleveeData.debiteurs.length}
${mainleveeData.debiteurs.map((deb, idx) => `
Débiteur ${idx + 1}:
- Nom: ${deb.nom} ${deb.prenom}
- Date de naissance: ${deb.dateNaissance}
- Lieu de naissance: ${deb.lieuNaissance}
- Adresse: ${deb.adresse}
- Situation familiale: ${deb.situationFamiliale}
${deb.regimeMatrimonial ? `- Régime matrimonial: ${deb.regimeMatrimonial}` : ""}
- Qualité: ${deb.qualite}
`).join('')}

═══════════════════════════════════════════════════════════════
ACTE CONSTITUTIF
═══════════════════════════════════════════════════════════════
- Date de signature: ${mainleveeData.acteOrigine.dateSignature}
- Nature de l'acte: ${mainleveeData.acteOrigine.natureActe}
- Notaire/Auteur: ${mainleveeData.acteOrigine.notaireAuteur}
- Date de publication: ${mainleveeData.acteOrigine.datePublication}
- Numéro de publication: ${mainleveeData.acteOrigine.numeroPublication}

CONDITIONS DU PRÊT:
- Montant initial: ${mainleveeData.conditionsPret.montantInitial} €
- Taux d'intérêt: ${mainleveeData.conditionsPret.tauxInteret}
- Durée: ${mainleveeData.conditionsPret.dureePret}
- Numéro de contrat: ${mainleveeData.conditionsPret.numeroContrat}
- Établissement prêteur: ${mainleveeData.conditionsPret.etablissementPreteur}
- Numéro de dossier: ${mainleveeData.conditionsPret.numeroDossier}

═══════════════════════════════════════════════════════════════
BIENS HYPOTHÉQUÉS
═══════════════════════════════════════════════════════════════
Nombre de biens: ${mainleveeData.biens.length}
${mainleveeData.biens.map((bien, idx) => `
Bien ${idx + 1}:
- Adresse: ${bien.adresse}
- Type: ${bien.typeBien}
- Description: ${bien.descriptionBien}
- Mode de détention: ${bien.modeDetention === "propriete_exclusive" ? "Propriété exclusive" : bien.modeDetention === "indivision" ? `Indivision (${bien.quotepartsIndivision})` : bien.modeDetention === "communaute_acquets" ? "Communauté réduite aux acquêts" : bien.modeDetention === "separation_biens" ? "Séparation de biens" : bien.modeDetention === "autre" ? `Autre: ${bien.autreRegime}` : "Non précisé"}
- Cadastre: Section ${bien.cadastreSection}, Parcelle ${bien.cadastreParcelle}
- Contenance: ${bien.cadastreContenance}
${bien.estCopropriete === "oui" ? `- Copropriété: Lot n°${bien.numeroLot}, Quote-part: ${bien.quotePart}` : ""}
`).join('')}

═══════════════════════════════════════════════════════════════
DÉCLARATION DU CRÉANCIER
═══════════════════════════════════════════════════════════════
- Créance intégralement payée: ${mainleveeData.declaration.creancePayee ? "Oui" : "Non"}
- Aucune dette subsistante: ${mainleveeData.declaration.aucuneDette ? "Oui" : "Non"}
- Consent à la mainlevée: ${mainleveeData.declaration.consentMainlevee ? "Oui" : "Non"}
- Renonce à l'inscription: ${mainleveeData.declaration.renonciation ? "Oui" : "Non"}
- Demande la radiation au SPF: ${mainleveeData.declaration.demandeRadiation ? "Oui" : "Non"}

═══════════════════════════════════════════════════════════════
MANDAT/PROCURATION
═══════════════════════════════════════════════════════════════
${mainleveeData.mandataire.existe === "oui" ? `
- Mandataire: ${mainleveeData.mandataire.nom} ${mainleveeData.mandataire.prenom}
- Fonction: ${mainleveeData.mandataire.fonction}
- Pouvoirs: ${mainleveeData.mandataire.pouvoirSigner ? "Signer la mainlevée" : ""}${mainleveeData.mandataire.pouvoirDeposer ? ", Déposer au SPF" : ""}
` : "Aucun mandataire"}

═══════════════════════════════════════════════════════════════
CONSENTEMENT DÉBITEUR
═══════════════════════════════════════════════════════════════
${mainleveeData.consentementDebiteur.requis === "oui" ? `
- Accord pour la radiation: ${mainleveeData.consentementDebiteur.accordRadiation ? "Oui" : "Non"}
- Déclarations complémentaires: ${mainleveeData.consentementDebiteur.declarationsComplementaires}
` : "Non requis"}

═══════════════════════════════════════════════════════════════
FRAIS
═══════════════════════════════════════════════════════════════
- Frais de radiation: ${mainleveeData.frais.fraisRadiation} €
- Honoraires: ${mainleveeData.frais.honoraires} €
- Timbres fiscaux: ${mainleveeData.frais.timbresFiscaux} €
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Mainlevée d'hypothèque - ${mainleveeData.debiteurs[0]?.nom || 'Débiteur'} - ${mainleveeData.biens[0]?.adresse || 'Bien'}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Mainlevée d'hypothèque créée avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setMainleveeData({
        informationsGenerales: {
          typeMainlevee: "",
          precisionPartielle: "",
          natureInscription: "",
          numeroInscription: "",
          dateInscription: "",
          volume: "",
          numeroPublication: "",
        },
        creancier: {
          typeCreancier: "",
        },
        creancierBanque: {
          denomination: "",
          siren: "",
          siegeSocial: "",
          representantNom: "",
          representantPrenom: "",
          representantFonction: "",
        },
        creancierPersonne: {
          isClient: false,
          clientId: "",
          nom: "",
          prenom: "",
          dateNaissance: "",
          lieuNaissance: "",
          adresse: "",
          nationalite: "",
          situationFamiliale: "",
          regimeMatrimonial: "",
          typeIdentite: "",
          numeroIdentite: "",
        },
        debiteurs: [{
          id: 1,
          isClient: false,
          clientId: "",
          nom: "",
          prenom: "",
          dateNaissance: "",
          lieuNaissance: "",
          adresse: "",
          nationalite: "",
          situationFamiliale: "",
          regimeMatrimonial: "",
          qualite: "",
          typeIdentite: "",
          numeroIdentite: "",
        }],
        acteOrigine: {
          dateSignature: "",
          natureActe: "",
          notaireAuteur: "",
          datePublication: "",
          numeroPublication: "",
        },
        conditionsPret: {
          montantInitial: "",
          tauxInteret: "",
          dureePret: "",
          numeroContrat: "",
          etablissementPreteur: "",
          numeroDossier: "",
        },
        biens: [{
          id: 1,
          adresse: "",
          descriptionBien: "",
          typeBien: "",
          modeDetention: "",
          quotepartsIndivision: "",
          autreRegime: "",
          cadastreSection: "",
          cadastreParcelle: "",
          cadastreContenance: "",
          estCopropriete: "non",
          numeroLot: "",
          quotePart: "",
        }],
        declaration: {
          creancePayee: false,
          aucuneDette: false,
          consentMainlevee: false,
          renonciation: false,
          demandeRadiation: false,
        },
        mandataire: {
          existe: "non",
          nom: "",
          prenom: "",
          fonction: "",
          pouvoirSigner: false,
          pouvoirDeposer: false,
        },
        consentementDebiteur: {
          requis: "non",
          accordRadiation: false,
          declarationsComplementaires: "",
        },
        frais: {
          fraisRadiation: "",
          honoraires: "",
          timbresFiscaux: "",
        },
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création mainlevée d\'hypothèque:', err);
      toast.error('Erreur lors de la création de la mainlevée');
    }
  };

  const handleContratMariageSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!contratMariageData.typeRegime) {
        toast.error('Veuillez sélectionner un type de régime matrimonial');
        return;
      }

      if (!contratMariageData.dateMariagePrevue) {
        toast.error('Veuillez renseigner la date prévue du mariage');
        return;
      }

      if (!contratMariageData.lieuMariage.mairie || !contratMariageData.lieuMariage.commune) {
        toast.error('Veuillez renseigner le lieu du mariage (mairie et commune obligatoires)');
        return;
      }

      const regimeLabels: Record<string, string> = {
        separation_biens: "Séparation de biens",
        communaute_acquets: "Communauté réduite aux acquêts",
        communaute_acquets_amenagee: "Communauté réduite aux acquêts aménagée",
        communaute_universelle: "Communauté universelle",
        participation_acquets: "Participation aux acquêts",
        autre: contratMariageData.autreRegimePrecision
      };

      const descriptionData = `
TYPE DE CONTRAT: Contrat de mariage prénuptial (régimes matrimoniaux)

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Régime matrimonial choisi: ${regimeLabels[contratMariageData.typeRegime] || contratMariageData.typeRegime}

DATE ET LIEU DU MARIAGE:
- Date prévue: ${contratMariageData.dateMariagePrevue || "Non renseignée"}
- Mairie: ${contratMariageData.lieuMariage.mairie || "Non renseignée"}
- Commune: ${contratMariageData.lieuMariage.commune || "Non renseignée"}
- Département: ${contratMariageData.lieuMariage.departement || "Non renseigné"}
- Pays: ${contratMariageData.lieuMariage.pays || "France"}

LOI APPLICABLE:
- ${contratMariageData.choixLoiApplicable === "autre" ? contratMariageData.choixLoiApplicableAutre : contratMariageData.choixLoiApplicable}

═══════════════════════════════════════════════════════════════
ÉPOUX
═══════════════════════════════════════════════════════════════
${contratMariageData.epoux.map((epoux, idx) => `
Époux ${idx + 1}:
- Nom: ${epoux.nom} ${epoux.prenom}
- Date de naissance: ${epoux.dateNaissance}
- Lieu de naissance: ${epoux.lieuNaissance}
- Nationalité: ${epoux.nationalite}
- Profession: ${epoux.profession}
- Situation familiale: ${epoux.situationFamiliale}
- Domicile actuel: ${epoux.domicileActuel}
${epoux.domicileApresMariage ? `- Domicile après mariage: ${epoux.domicileApresMariage}` : ""}
${epoux.mariageAnterieurtHorsFrance === "oui" ? `
MARIAGE ANTÉRIEUR HORS FRANCE:
- Date: ${epoux.datePremierMariage}
- Lieu: ${epoux.lieuPremierMariage}
- Régime initial: ${epoux.regimeMatrimonialInitial}
` : ""}
`).join('')}

═══════════════════════════════════════════════════════════════
ENFANTS (si changement de régime)
═══════════════════════════════════════════════════════════════
${contratMariageData.nombreEnfants ? `
- Nombre d'enfants: ${contratMariageData.nombreEnfants}
- Enfants mineurs: ${contratMariageData.enfantsMineurs}
- Information au juge: ${contratMariageData.informationJugeNecessaire}
` : "Non applicable"}

═══════════════════════════════════════════════════════════════
CLAUSES SPÉCIFIQUES DU RÉGIME
═══════════════════════════════════════════════════════════════
Régime: ${regimeLabels[contratMariageData.typeRegime] || contratMariageData.typeRegime}

${contratMariageData.typeRegime === "separation_biens" ? `
SÉPARATION DE BIENS:
- Administration exclusive: ${contratMariageData.clausesSeparation.administrationExclusive ? "Oui" : "Non"}
- Comptes séparés: ${contratMariageData.clausesSeparation.comptesSepares ? "Oui" : "Non"}
- Contribution aux charges: ${contratMariageData.clausesSeparation.contributionCharges}
` : ""}

${contratMariageData.typeRegime === "communaute_universelle" ? `
COMMUNAUTÉ UNIVERSELLE:
- Attribution intégrale au survivant: ${contratMariageData.clausesCommunauteUniverselle.attributionIntegraleSurvivant}
- Clause de préciput: ${contratMariageData.clausesCommunauteUniverselle.clausesPreciput}
- Exclusions de biens: ${contratMariageData.clausesCommunauteUniverselle.exclusionCertainsBiens}
` : ""}

${contratMariageData.typeRegime === "participation_acquets" ? `
PARTICIPATION AUX ACQUÊTS:
- Patrimoine originel défini: ${contratMariageData.clausesParticipation.definitionPatrimoinesOriginels}
- Calcul créance: ${contratMariageData.clausesParticipation.calculCreanceParticipation}
` : ""}

═══════════════════════════════════════════════════════════════
DÉCLARATIONS DES ÉPOUX
═══════════════════════════════════════════════════════════════
- Identité: ${contratMariageData.declarations.identite ? "✓" : "✗"}
- Capacité juridique: ${contratMariageData.declarations.capaciteJuridique ? "✓" : "✗"}
- Choix libre et éclairé: ${contratMariageData.declarations.choixLibreEclaire ? "✓" : "✗"}
- Connaissance des effets juridiques: ${contratMariageData.declarations.connaissanceEffetsJuridiques ? "✓" : "✗"}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Contrat de mariage - ${contratMariageData.epoux[0]?.nom || 'Époux 1'} & ${contratMariageData.epoux[1]?.nom || 'Époux 2'}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Contrat de mariage créé avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire (structure minimale pour ne pas alourdir)
      setContratMariageData({
        typeRegime: "",
        autreRegimePrecision: "",
        typeContrat: "prenuptial",
        dateMariagePrevue: "",
        lieuMariage: {
          mairie: "",
          commune: "",
          departement: "",
          pays: "France",
        },
        dateMariage: "",
        regimeActuel: "",
        regimeActuelAutre: "",
        motifChangement: "",
        accordEnfantsMajeurs: "",
        accordCreancier: "",
        consentementEnfantsMajeursRequis: "non",
        liquidationRegimeActuel: "non",
        biensCommuns: [{
          id: 1,
          description: "",
          valeurEstimee: "",
          dettesAttachees: "",
          affectationPrevue: "",
          repartitionEnvisagee: "",
        }],
        passifCommun: [{
          id: 1,
          description: "",
          montant: "",
          modeRepartition: "",
        }],
        soulte: {
          soulteDue: "non",
          montantSoulte: "",
          epouxDebiteur: "",
          modalitesPaiement: "",
          dateLimitePaiement: "",
        },
        actifsFinanciers: [{
          id: 1,
          natureCompte: "",
          etablissement: "",
          solde: "",
          modePartage: "",
          partagePersonnalise: "",
        }],
        observationsLiquidation: "",
        choixLoiApplicable: "loi_francaise",
        choixLoiApplicableAutre: "",
        accordJugeRequis: "non",
        epoux: [
          {
            id: 1,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            adresse: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            lieuEmissionIdentite: "",
            domicileActuel: "",
            domicileApresMariage: "",
            mariageAnterieurtHorsFrance: "non",
            datePremierMariage: "",
            lieuPremierMariage: "",
            regimeMatrimonialInitial: "",
            acteEtatCivilEtranger: "",
          },
          {
            id: 2,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            adresse: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            lieuEmissionIdentite: "",
            domicileActuel: "",
            domicileApresMariage: "",
            mariageAnterieurtHorsFrance: "non",
            datePremierMariage: "",
            lieuPremierMariage: "",
            regimeMatrimonialInitial: "",
            acteEtatCivilEtranger: "",
          },
        ],
        nombreEnfants: "",
        enfantsMajeurs: [{
          id: 1,
          nom: "",
          prenom: "",
          adresse: "",
          accordInformation: "",
        }],
        enfantsMineurs: "",
        informationJugeNecessaire: "",
        patrimoineEpoux1: {
          biensPropres: "",
          biensAcquisPendantMariage: "",
          valeurEstimee: "",
          dettesPersonnelles: "",
          dettesCommunes: "",
          masseDepart: "",
          masseFin: "",
        },
        patrimoineEpoux2: {
          biensPropres: "",
          biensAcquisPendantMariage: "",
          valeurEstimee: "",
          dettesPersonnelles: "",
          dettesCommunes: "",
          masseDepart: "",
          masseFin: "",
        },
        clausesSeparation: {
          administrationExclusive: false,
          comptesSepares: false,
          contributionCharges: "",
          contributionChargesAutre: "",
          miseEnCommunBien: "",
          abandonCreance: "",
        },
        clausesCommunauteAmenagee: {
          definitionBiensCommunsPropres: "",
          amenagementBiensProfessionnels: "",
          contributionCharges: "",
          repartitionDettes: "",
          typeAdministration: "",
          pouvoirUniqueDetails: "",
        },
        clausesCommunauteUniverselle: {
          tousLiensCommunsPresentsEtFuturs: true,
          attributionIntegraleSurvivant: "",
          clausesPreciput: "",
          exclusionCertainsBiens: "",
        },
        clausesParticipation: {
          definitionPatrimoinesOriginels: "",
          definitionPatrimoineFinal: "",
          calculCreanceParticipation: "",
          renonciationCreance: "",
          biensPropresParNature: "",
        },
        clausesAvancees: {
          clauseRemploi: "",
          clausePreciput: "",
          attributionPreferentielle: "",
          gestionSepareeBiensProfessionnels: "",
          protectionConjointSurvivant: "",
          donationEntreEpoux: "",
          solidariteDetteSpecifiques: "",
        },
        declarations: {
          identite: true,
          capaciteJuridique: true,
          situationMatrimoniale: true,
          absenceOpposition: true,
          choixLibreEclaire: true,
          connaissanceEffetsJuridiques: true,
        },
      });

      // Reset file uploads
      setContratMariageEpoux1IdentiteFiles([]);
      setContratMariageEpoux2IdentiteFiles([]);
      setContratMariageEpoux1ActeNaissanceFiles([]);
      setContratMariageEpoux2ActeNaissanceFiles([]);
      setContratMariageEpoux1DomicileFiles([]);
      setContratMariageEpoux2DomicileFiles([]);
      setContratMariageContratInitialFiles([]);
      setContratMariageJustificatifMariageFiles([]);
      setContratMariageAccordEnfantsFiles([]);
      setContratMariageTitresProprieteFiles([]);
      setContratMariageEstimationBiensFiles([]);
      setContratMariageActeDecesFiles([]);
      setContratMariageConsentementEnfantsFiles([]);
      setContratMariageCertificatBansFiles([]);
      setContratMariageDecisionJugeFiles([]);

      refreshContrats();
    } catch (err) {
      console.error('Erreur création contrat de mariage:', err);
      toast.error('Erreur lors de la création du contrat de mariage');
    }
  };

  const handlePacsSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      // Validations obligatoires
      if (!pacsData.regimePacs) {
        toast.error('Veuillez sélectionner un régime de PACS');
        return;
      }

      if (!pacsData.adresseCommune) {
        toast.error('Veuillez renseigner l\'adresse commune (obligatoire pour l\'enregistrement)');
        return;
      }

      if (!pacsData.declarations.residenceCommune || !pacsData.declarations.absenceLienParente || !pacsData.declarations.absenceMariageEtPacs) {
        toast.error('Veuillez valider toutes les déclarations sur l\'honneur obligatoires');
        return;
      }

      const regimeLabels: Record<string, string> = {
        separation: "Séparation de biens (régime légal par défaut)",
        indivision: "Indivision",
        personnalise: "Régime personnalisé"
      };

      const objetLabels: Record<string, string> = {
        initial: "PACS initial",
        modification: "Modification de PACS existant",
        dissolution: "Dissolution de PACS"
      };

      const descriptionData = `
TYPE DE CONTRAT: PACS (Pacte Civil de Solidarité)

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Objet du PACS: ${objetLabels[pacsData.objetPacs] || pacsData.objetPacs}
- Régime choisi: ${regimeLabels[pacsData.regimePacs] || pacsData.regimePacs}
${pacsData.regimePacs === "personnalise" ? `
  • Définition biens communs: ${pacsData.regimePersonnalise.definitionBiensCommuns || "Non renseigné"}
  • Biens propres: ${pacsData.regimePersonnalise.biensPropres || "Non renseigné"}
  • Clauses spécifiques: ${pacsData.regimePersonnalise.clausesSpecifiques || "Non renseigné"}
` : ""}
- Date de prise d'effet souhaitée: ${pacsData.datePriseEffetSouhaitee || "À l'enregistrement"}

${pacsData.objetPacs === "modification" ? `
RÉFÉRENCE DU PACS INITIAL:
- Date: ${pacsData.pacsInitialDate || "Non renseignée"}
- Mairie/Notaire: ${pacsData.pacsInitialMairie || "Non renseigné"}
- Numéro d'enregistrement: ${pacsData.pacsInitialNumero || "Non renseigné"}
- Clauses modifiées: ${pacsData.clausesModifiees || "Non renseigné"}
` : ""}

═══════════════════════════════════════════════════════════════
PARTENAIRES
═══════════════════════════════════════════════════════════════
${pacsData.partenaires.map((p, idx) => `
Partenaire ${idx + 1}:
- Nom: ${p.nom} ${p.prenom}
- Nom de naissance: ${p.nomNaissance || p.nom}
- Date de naissance: ${p.dateNaissance || "Non renseignée"}
- Lieu de naissance: ${p.lieuNaissance || "Non renseigné"}
- Nationalité: ${p.nationalite || "Non renseignée"}
- Profession: ${p.profession || "Non renseignée"}
- Adresse actuelle: ${p.adresseActuelle || "Non renseignée"}
- Téléphone: ${p.telephone || "Non renseigné"}
- Email: ${p.email || "Non renseigné"}
- Situation familiale: ${p.situationFamiliale || "Non renseignée"}
- Pièce d'identité: ${p.typeIdentite || "Non renseigné"} n°${p.numeroIdentite || "Non renseigné"}
  Délivrée le ${p.dateEmissionIdentite || "Non renseigné"} par ${p.autoriteDelivrante || "Non renseigné"}
${p.estEtranger ? `
  ⚠️ PARTENAIRE ÉTRANGER:
  - Attestation non-PACS pays d'origine: ${p.attestationNonPacsPaysOrigine ? "Oui" : "Non"}
  - Certificat de coutume requis: ${p.certificatCoutumeRequis ? "Oui" : "Non"}
  - Traduction requise: ${p.traductionRequise ? "Oui" : "Non"}
` : ""}
`).join('\n')}

═══════════════════════════════════════════════════════════════
ADRESSE COMMUNE (OBLIGATOIRE)
═══════════════════════════════════════════════════════════════
- Adresse commune déclarée: ${pacsData.adresseCommune}
- Date de début de résidence commune: ${pacsData.dateDebutResidenceCommune || "Non renseignée"}

═══════════════════════════════════════════════════════════════
CLAUSES DU PACS
═══════════════════════════════════════════════════════════════
A. CLAUSES OBLIGATOIRES
- Contribution aux charges du ménage: ${pacsData.contributionCharges === "proportionnelle" ? "Proportionnelle aux revenus" : pacsData.contributionCharges === "50_50" ? "50/50" : pacsData.contributionChargesAutre || "Non renseigné"}

B. CLAUSES FACULTATIVES
${pacsData.clausesFacultatives.gestionBiensPersonnels ? `- Gestion des biens personnels: ${pacsData.clausesFacultatives.gestionBiensPersonnels}` : ""}
${pacsData.clausesFacultatives.gestionBienCommun ? `- Gestion d'un bien commun: ${pacsData.clausesFacultatives.gestionBienCommun}` : ""}
${pacsData.clausesFacultatives.usageBienIndivis ? `- Usage d'un bien indivis: ${pacsData.clausesFacultatives.usageBienIndivis}` : ""}
${pacsData.clausesFacultatives.repartitionDepensesSpecifiques ? `- Répartition dépenses spécifiques: ${pacsData.clausesFacultatives.repartitionDepensesSpecifiques}` : ""}
${pacsData.clausesFacultatives.clauseOccupationLogementSeparation ? `- Clause occupation logement en cas de séparation: ${pacsData.clausesFacultatives.clauseOccupationLogementSeparation}` : ""}
${pacsData.clausesFacultatives.clauseRepriseBienDeces ? `- Clause reprise bien en cas de décès: ${pacsData.clausesFacultatives.clauseRepriseBienDeces}` : ""}
${pacsData.clausesFacultatives.clauseAbandonCreance ? `- Clause abandon de créance: ${pacsData.clausesFacultatives.clauseAbandonCreance}` : ""}
${pacsData.clausesFacultatives.modalitesCompteBancaireCommun ? `- Modalités compte bancaire commun: ${pacsData.clausesFacultatives.modalitesCompteBancaireCommun}` : ""}
${pacsData.clausesFacultatives.clausesFinancieresPersonnalisees ? `- Clauses financières personnalisées: ${pacsData.clausesFacultatives.clausesFinancieresPersonnalisees}` : ""}
${pacsData.clausesFacultatives.clausesSolidariteDettes ? `- Clauses solidarité sur dettes: ${pacsData.clausesFacultatives.clausesSolidariteDettes}` : ""}

═══════════════════════════════════════════════════════════════
DÉCLARATIONS SUR L'HONNEUR (OBLIGATOIRES)
═══════════════════════════════════════════════════════════════
✓ Déclaration de résidence commune: ${pacsData.declarations.residenceCommune ? "Oui" : "Non"}
✓ Déclaration d'absence de lien de parenté: ${pacsData.declarations.absenceLienParente ? "Oui" : "Non"}
✓ Déclaration d'absence de mariage et PACS en cours: ${pacsData.declarations.absenceMariageEtPacs ? "Oui" : "Non"}

${pacsData.enfantEnCommun === "oui" ? `
═══════════════════════════════════════════════════════════════
ENFANT(S) EN COMMUN
═══════════════════════════════════════════════════════════════
${pacsData.enfants.map((e, idx) => `
Enfant ${idx + 1}:
- Nom: ${e.nom} ${e.prenom}
- Date de naissance: ${e.dateNaissance || "Non renseignée"}
- Autorité parentale: ${e.autoriteParentale || "Non renseignée"}
`).join('\n')}
` : ""}

${pacsData.droitApplicable !== "francais" ? `
═══════════════════════════════════════════════════════════════
RÉGIME PATRIMONIAL ÉTRANGER
═══════════════════════════════════════════════════════════════
- Droit applicable: ${pacsData.droitApplicableAutre || pacsData.droitApplicable}
- Clause de priorité du droit français pour le PACS appliquée
` : ""}

${pacsData.biensPreexistants === "oui" ? `
═══════════════════════════════════════════════════════════════
BIENS DÉJÀ ACQUIS ENSEMBLE
═══════════════════════════════════════════════════════════════
${pacsData.biensListe.map((b, idx) => `
Bien ${idx + 1}:
- Description: ${b.description || "Non renseigné"}
- Quote-part partenaire 1: ${b.quotePart1 || "Non renseigné"}
- Quote-part partenaire 2: ${b.quotePart2 || "Non renseigné"}
- Indivision: ${b.indivision || "Non renseigné"}
`).join('\n')}
` : ""}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          type: 'pacs',
          name: `PACS - ${pacsData.partenaires[0]?.nom || "Sans nom"} & ${pacsData.partenaires[1]?.nom || "Sans nom"}`,
          status: 'draft',
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;

      toast.success('Convention de PACS créée avec succès');

      // Reset du formulaire
      setPacsData({
        objetPacs: "initial",
        regimePacs: "separation",
        regimePersonnalise: {
          definitionBiensCommuns: "",
          biensPropres: "",
          clausesSpecifiques: "",
        },
        datePriseEffetSouhaitee: "",
        pacsInitialDate: "",
        pacsInitialMairie: "",
        pacsInitialNumero: "",
        clausesModifiees: "",
        partenaires: [
          {
            id: 1,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            nomNaissance: "",
            adresseActuelle: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            telephone: "",
            email: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            autoriteDelivrante: "",
            estEtranger: false,
            attestationNonPacsPaysOrigine: false,
            certificatCoutumeRequis: false,
            traductionRequise: false,
          },
          {
            id: 2,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            nomNaissance: "",
            adresseActuelle: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            telephone: "",
            email: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            autoriteDelivrante: "",
            estEtranger: false,
            attestationNonPacsPaysOrigine: false,
            certificatCoutumeRequis: false,
            traductionRequise: false,
          }
        ],
        adresseCommune: "",
        dateDebutResidenceCommune: "",
        contributionCharges: "proportionnelle",
        contributionChargesAutre: "",
        clausesFacultatives: {
          gestionBiensPersonnels: "",
          gestionBienCommun: "",
          usageBienIndivis: "",
          repartitionDepensesSpecifiques: "",
          clauseOccupationLogementSeparation: "",
          clauseRepriseBienDeces: "",
          clauseAbandonCreance: "",
          modalitesCompteBancaireCommun: "",
          clausesFinancieresPersonnalisees: "",
          clausesSolidariteDettes: "",
        },
        declarations: {
          residenceCommune: false,
          absenceLienParente: false,
          absenceMariageEtPacs: false,
        },
        enfantEnCommun: "non",
        enfants: [{
          id: 1,
          nom: "",
          prenom: "",
          dateNaissance: "",
          autoriteParentale: "",
        }],
        droitApplicable: "francais",
        droitApplicableAutre: "",
        biensPreexistants: "non",
        biensListe: [{
          id: 1,
          description: "",
          quotePart1: "",
          quotePart2: "",
          indivision: "",
        }],
      });

      // Reset file uploads
      setPacsPartenaire1IdentiteFiles([]);
      setPacsPartenaire2IdentiteFiles([]);
      setPacsPartenaire1ActeNaissanceFiles([]);
      setPacsPartenaire2ActeNaissanceFiles([]);
      setPacsPartenaire1DomicileFiles([]);
      setPacsPartenaire2DomicileFiles([]);
      setPacsPartenaire1DivorceFiles([]);
      setPacsPartenaire2DivorceFiles([]);
      setPacsPartenaire1DecesFiles([]);
      setPacsPartenaire2DecesFiles([]);
      setPacsPartenaire1CertificatCoutumeFiles([]);
      setPacsPartenaire2CertificatCoutumeFiles([]);
      setPacsPartenaire1CertificatNonPacsFiles([]);
      setPacsPartenaire2CertificatNonPacsFiles([]);
      setPacsPartenaire1TraductionsFiles([]);
      setPacsPartenaire2TraductionsFiles([]);

      refreshContrats();
    } catch (err) {
      console.error('Erreur création PACS:', err);
      toast.error('Erreur lors de la création de la convention de PACS');
    }
  };

  const handleDonationEntreEpouxSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      // Validations obligatoires
      if (!donationEntreEpouxData.typeDonation) {
        toast.error('Veuillez sélectionner un type de donation');
        return;
      }

      if (donationEntreEpouxData.objetDonation.length === 0) {
        toast.error('Veuillez sélectionner au moins un objet de donation');
        return;
      }

      if (!donationEntreEpouxData.epoux[0].regimeMatrimonial || !donationEntreEpouxData.epoux[1].regimeMatrimonial) {
        toast.error('Veuillez renseigner le régime matrimonial des deux époux');
        return;
      }

      const typeLabels: Record<string, string> = {
        au_dernier_vivant: "Donation entre époux au dernier vivant (effets au décès)",
        biens_presents: "Donation de biens présents (effets immédiats)",
        mixte: "Donation mixte"
      };

      const regimeLabels: Record<string, string> = {
        communaute_legale: "Communauté légale",
        communaute_universelle: "Communauté universelle",
        separation_biens: "Séparation de biens",
        participation_acquets: "Participation aux acquêts",
        autre: "Autre régime"
      };

      const descriptionData = `
TYPE DE CONTRAT: DONATION ENTRE ÉPOUX

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Type de donation: ${typeLabels[donationEntreEpouxData.typeDonation] || donationEntreEpouxData.typeDonation}
- Objet(s) de la donation: ${donationEntreEpouxData.objetDonation.map(o => {
  const labels: Record<string, string> = {
    protection_conjoint: "Protection du conjoint survivant",
    transmission_bien: "Transmission d'un bien particulier",
    partage_inegal: "Partage inégal",
    renforcement_droits: "Renforcement des droits successoraux"
  };
  return labels[o] || o;
}).join(', ')}
- Date prévue de signature: ${donationEntreEpouxData.datePrevueSignature || "Non renseignée"}

═══════════════════════════════════════════════════════════════
IDENTITÉ DES ÉPOUX
═══════════════════════════════════════════════════════════════
${donationEntreEpouxData.epoux.map((e, idx) => `
Époux ${idx + 1}:
- Nom: ${e.nom} ${e.prenom}
- Nom de naissance: ${e.nomNaissance || e.nom}
- Date de naissance: ${e.dateNaissance || "Non renseignée"}
- Lieu de naissance: ${e.lieuNaissance || "Non renseigné"}
- Nationalité: ${e.nationalite || "Non renseignée"}
- Profession: ${e.profession || "Non renseignée"}
- Adresse: ${e.adresseComplete || "Non renseignée"}
- Téléphone: ${e.telephone || "Non renseigné"}
- Email: ${e.email || "Non renseigné"}
- Régime matrimonial: ${regimeLabels[e.regimeMatrimonial] || e.regimeMatrimonialAutre || "Non renseigné"}
- Date du mariage: ${e.dateMariage || "Non renseignée"}
- Lieu du mariage: ${e.lieuMariage || "Non renseigné"}
- Contrat de mariage: ${e.existenceContratMariage === "oui" ? "Oui (copie à joindre)" : "Non"}
- Pièce d'identité: ${e.typeIdentite || "Non renseigné"} n°${e.numeroIdentite || "Non renseigné"}
  Autorité: ${e.autoriteDelivrance || "Non renseigné"}, Expiration: ${e.dateExpiration || "Non renseignée"}
`).join('\n')}

═══════════════════════════════════════════════════════════════
ENFANTS ET HÉRITIERS RÉSERVATAIRES
═══════════════════════════════════════════════════════════════
A. ENFANTS COMMUNS (${donationEntreEpouxData.enfantsCommuns.length || 0})
${donationEntreEpouxData.enfantsCommuns.filter(e => e.nom).map(e => `- ${e.nom} ${e.prenom}, né(e) le ${e.dateNaissance || "Non renseigné"}`).join('\n') || "Aucun enfant commun déclaré"}

B. ENFANTS NON COMMUNS (${donationEntreEpouxData.enfantsNonCommuns.filter(e => e.nom).length || 0})
${donationEntreEpouxData.enfantsNonCommuns.filter(e => e.nom).map(e => `- ${e.nom} ${e.prenom} (époux ${e.epoux}), né(e) le ${e.dateNaissance || "Non renseigné"}`).join('\n') || "Aucun enfant non commun déclaré"}

C. PARENTS VIVANTS
- Parents époux 1: ${donationEntreEpouxData.parentsVivants.epoux1 === "oui" ? "Oui" : "Non"}
- Parents époux 2: ${donationEntreEpouxData.parentsVivants.epoux2 === "oui" ? "Oui" : "Non"}

D. AUTRES HÉRITIERS
${donationEntreEpouxData.autresHeritiers || "Aucun autre héritier déclaré"}

═══════════════════════════════════════════════════════════════
PATRIMOINE DES ÉPOUX
═══════════════════════════════════════════════════════════════
A. BIENS PROPRES ÉPOUX 1 (${donationEntreEpouxData.biensPropresEpoux1.filter(b => b.description).length})
${donationEntreEpouxData.biensPropresEpoux1.filter(b => b.description).map(b => 
  `- ${b.type}: ${b.description}, valeur: ${b.valeur || "Non estimée"}, origine: ${b.origine || "Non précisée"}`
).join('\n') || "Aucun bien propre déclaré"}

B. BIENS PROPRES ÉPOUX 2 (${donationEntreEpouxData.biensPropresEpoux2.filter(b => b.description).length})
${donationEntreEpouxData.biensPropresEpoux2.filter(b => b.description).map(b => 
  `- ${b.type}: ${b.description}, valeur: ${b.valeur || "Non estimée"}, origine: ${b.origine || "Non précisée"}`
).join('\n') || "Aucun bien propre déclaré"}

C. BIENS COMMUNS (${donationEntreEpouxData.biensCommuns.filter(b => b.description).length})
${donationEntreEpouxData.biensCommuns.filter(b => b.description).map(b => 
  `- ${b.description}, valeur: ${b.valeur || "Non estimée"}, parts: ${b.partEpoux1 || "50"}% / ${b.partEpoux2 || "50"}%`
).join('\n') || "Aucun bien commun déclaré"}

D. DROITS PARTICULIERS
${donationEntreEpouxData.droitsParticuliers.nueProprieteBiens ? `- Nue-propriété: ${donationEntreEpouxData.droitsParticuliers.nueProprieteBiens}` : ""}
${donationEntreEpouxData.droitsParticuliers.usufruitBiens ? `- Usufruit: ${donationEntreEpouxData.droitsParticuliers.usufruitBiens}` : ""}
${donationEntreEpouxData.droitsParticuliers.biensIndivis ? `- Biens indivis: ${donationEntreEpouxData.droitsParticuliers.biensIndivis}` : ""}
${donationEntreEpouxData.droitsParticuliers.biensHypotheques ? `- Hypothèques: ${donationEntreEpouxData.droitsParticuliers.biensHypotheques}` : ""}

═══════════════════════════════════════════════════════════════
CLAUSES DE LA DONATION
═══════════════════════════════════════════════════════════════
${donationEntreEpouxData.typeDonation === "au_dernier_vivant" || donationEntreEpouxData.typeDonation === "mixte" ? `
A. DONATION AU DERNIER VIVANT
Options successorales choisies:
${donationEntreEpouxData.donationDernierVivant.optionsSuccessorales.map(o => {
  const labels: Record<string, string> = {
    pleine_propriete_quotite: "- Pleine propriété de la quotité disponible",
    usufruit_universel: "- Usufruit universel de la succession",
    quart_pleine_3quarts_usufruit: "- 1/4 en pleine propriété + 3/4 en usufruit",
    choix_multiple: "- Choix entre plusieurs options au décès",
    attribution_biens_specifiques: "- Attribution de biens spécifiques"
  };
  return labels[o] || o;
}).join('\n') || "Aucune option sélectionnée"}
${donationEntreEpouxData.donationDernierVivant.biensSpecifiques ? `Biens spécifiques: ${donationEntreEpouxData.donationDernierVivant.biensSpecifiques}` : ""}

Attribution préférentielle:
${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.active ? `
- Logement familial: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.logementFamilial ? "Oui" : "Non"}
- Mobilier: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.mobilier ? "Oui" : "Non"}
- Bien professionnel: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.bienProfessionnel ? "Oui" : "Non"}
- Véhicule: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.vehicule ? "Oui" : "Non"}
${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.autresBiens ? `- Autres biens: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.autresBiens}` : ""}
` : "Non activée"}

Clause de préciput: ${donationEntreEpouxData.donationDernierVivant.clausePreciput.active ? `
- Bien: ${donationEntreEpouxData.donationDernierVivant.clausePreciput.descriptionBien || "Non précisé"}
- Effet: ${donationEntreEpouxData.donationDernierVivant.clausePreciput.effet === "hors_part" ? "Hors part successorale" : "Valorisé dans la part"}
` : "Non activée"}

Clause de cantonnement: ${donationEntreEpouxData.donationDernierVivant.clauseCantonnement ? "Oui (optimisation fiscale)" : "Non"}

Clause d'exclusion: ${donationEntreEpouxData.donationDernierVivant.clauseExclusion.active ? `
- Biens exclus: ${donationEntreEpouxData.donationDernierVivant.clauseExclusion.biensExclus || "Non précisé"}
- Cas particuliers: ${donationEntreEpouxData.donationDernierVivant.clauseExclusion.casParticuliers || "Non précisé"}
` : "Non activée"}
` : ""}

${donationEntreEpouxData.typeDonation === "biens_presents" || donationEntreEpouxData.typeDonation === "mixte" ? `
B. DONATION DE BIENS PRÉSENTS
Biens donnés immédiatement (${donationEntreEpouxData.donationBiensPresents.biensDonnes.filter(b => b.description).length}):
${donationEntreEpouxData.donationBiensPresents.biensDonnes.filter(b => b.description).map(b => 
  `- ${b.nature}: ${b.description}, valeur: ${b.valeur || "Non estimée"}, régime: ${b.regimePropriete || "Non précisé"}`
).join('\n') || "Aucun bien donné"}

Irrévocabilité: ${donationEntreEpouxData.donationBiensPresents.irrevocabilite === "oui" ? "Oui (donation irrévocable)" : "Non"}
Clause de retour en cas de prédécès: ${donationEntreEpouxData.donationBiensPresents.clauseRetourPredeces === "oui" ? "Oui" : "Non"}
Réserve d'usufruit: ${donationEntreEpouxData.donationBiensPresents.reserveUsufruit.active ? `Oui - ${donationEntreEpouxData.donationBiensPresents.reserveUsufruit.conditions || "Conditions non précisées"}` : "Non"}
` : ""}

C. CLAUSES COMMUNES
${donationEntreEpouxData.clausesCommunes.administrationGestion ? `- Administration et gestion: ${donationEntreEpouxData.clausesCommunes.administrationGestion}` : ""}
${donationEntreEpouxData.clausesCommunes.conditionSuspensiveResolutoire ? `- Condition suspensive/résolutoire: ${donationEntreEpouxData.clausesCommunes.conditionSuspensiveResolutoire}` : ""}
- Acceptation du bénéficiaire: ${donationEntreEpouxData.clausesCommunes.acceptationBeneficiaire ? "Oui (obligatoire)" : "En attente"}
- Renonciation droits successoraux standards: ${donationEntreEpouxData.clausesCommunes.renonciationDroitsSuccessorauxStandards ? "Oui" : "Non"}
- Clause de non-révocation: ${donationEntreEpouxData.clausesCommunes.clauseNonRevocation ? "Oui" : "Non"}

═══════════════════════════════════════════════════════════════
MENTIONS LÉGALES OBLIGATOIRES
═══════════════════════════════════════════════════════════════
✓ Articles du Code civil applicables
✓ Effets de la donation entre époux
✓ Quotité disponible spéciale entre époux
✓ Limites de la réserve héréditaire
✓ Déclaration de capacité juridique
✓ Consentement éclairé des deux époux
✓ Lecture de l'acte
✓ Signatures électroniques

═══════════════════════════════════════════════════════════════
FIN DE LA CONVENTION
═══════════════════════════════════════════════════════════════
`;

      await supabase.from('contrats').insert({
        owner_id: user.id,
        role: role,
        name: `Donation entre époux - ${donationEntreEpouxData.epoux[0].nom} ${donationEntreEpouxData.epoux[0].prenom} & ${donationEntreEpouxData.epoux[1].nom} ${donationEntreEpouxData.epoux[1].prenom}`,
        type: 'Donation entre époux',
        category: pendingCategory,
        description: descriptionData,
      });

      toast.success('Donation entre époux créée avec succès');
      setShowQuestionDialog(false);

      // Reset form
      setDonationEntreEpouxData({
        typeDonation: "au_dernier_vivant",
        objetDonation: [],
        datePrevueSignature: "",
        epoux: [
          {
            id: 1, isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", adresseComplete: "",
            telephone: "", email: "", dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "",
            situationMatrimoniale: "marie", regimeMatrimonial: "", regimeMatrimonialAutre: "",
            dateMariage: "", lieuMariage: "", existenceContratMariage: "non",
            typeIdentite: "", numeroIdentite: "", autoriteDelivrance: "", dateExpiration: "",
          },
          {
            id: 2, isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", adresseComplete: "",
            telephone: "", email: "", dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "",
            situationMatrimoniale: "marie", regimeMatrimonial: "", regimeMatrimonialAutre: "",
            dateMariage: "", lieuMariage: "", existenceContratMariage: "non",
            typeIdentite: "", numeroIdentite: "", autoriteDelivrance: "", dateExpiration: "",
          }
        ],
        enfantsCommuns: [{ id: 1, nom: "", prenom: "", dateNaissance: "" }],
        enfantsNonCommuns: [{ id: 1, epoux: "1", nom: "", prenom: "", dateNaissance: "" }],
        parentsVivants: { epoux1: "non", epoux2: "non" },
        autresHeritiers: "",
        biensPropresEpoux1: [{ id: 1, type: "", description: "", valeur: "", origine: "" }],
        biensPropresEpoux2: [{ id: 1, type: "", description: "", valeur: "", origine: "" }],
        biensCommuns: [{ id: 1, description: "", valeur: "", partEpoux1: "", partEpoux2: "" }],
        droitsParticuliers: { nueProprieteBiens: "", usufruitBiens: "", biensIndivis: "", biensHypotheques: "" },
        donationDernierVivant: {
          optionsSuccessorales: [],
          biensSpecifiques: "",
          attributionPreferentielle: {
            active: false, logementFamilial: false, mobilier: false, bienProfessionnel: false,
            vehicule: false, autresBiens: "",
          },
          clausePreciput: { active: false, descriptionBien: "", effet: "" },
          clauseCantonnement: false,
          clauseExclusion: { active: false, biensExclus: "", casParticuliers: "" },
        },
        donationBiensPresents: {
          biensDonnes: [{ id: 1, nature: "", description: "", valeur: "", regimePropriete: "" }],
          irrevocabilite: "oui",
          clauseRetourPredeces: "non",
          reserveUsufruit: { active: false, conditions: "" },
        },
        clausesCommunes: {
          administrationGestion: "",
          conditionSuspensiveResolutoire: "",
          acceptationBeneficiaire: false,
          renonciationDroitsSuccessorauxStandards: false,
          clauseNonRevocation: false,
        },
        mentionsLegales: {
          articlesCodeCivil: true, effetsDonation: true, quotiteDisponible: true,
          limitesReserveHereditaire: true, declarationCapaciteJuridique: true,
          consentementEclaire: true, lectureActe: true, signaturesElectroniques: true,
        },
      });

      // Reset file states
      setDonationEpoux1IdentiteFiles([]);
      setDonationEpoux2IdentiteFiles([]);
      setDonationEpoux1LivretFamilleFiles([]);
      setDonationEpoux2LivretFamilleFiles([]);
      setDonationEpoux1ActeMariageFiles([]);
      setDonationEpoux2ActeMariageFiles([]);
      setDonationEpoux1ContratMariageFiles([]);
      setDonationEpoux2ContratMariageFiles([]);
      setDonationEpoux1DomicileFiles([]);
      setDonationEpoux2DomicileFiles([]);
      setDonationTitresProprieteBiensFiles([]);
      setDonationEstimationBiensFiles([]);
      setDonationHypothequesFiles([]);
      setDonationSituationLocativeFiles([]);
      setDonationRIBFiles([]);
      setDonationCarteGriseFiles([]);
      setDonationAutresDocumentsFiles([]);

      refreshContrats();
    } catch (err) {
      console.error('Erreur création donation entre époux:', err);
      toast.error('Erreur lors de la création de la donation entre époux');
    }
  };

  const handleDonationSimpleSubmit = async () => {
    if (!user) return;
    
    // Validation
    if (!donationSimpleData.typeDonation) {
      toast.error("Veuillez sélectionner un type de donation");
      return;
    }
    if (!donationSimpleData.donateur.nom || !donationSimpleData.donateur.prenom) {
      toast.error("Veuillez renseigner le donateur");
      return;
    }
    if (!donationSimpleData.donataire.nom || !donationSimpleData.donataire.prenom) {
      toast.error("Veuillez renseigner le donataire");
      return;
    }
    if (!donationSimpleData.mentionsLegales.acceptationExpresse) {
      toast.error("L'acceptation expresse du donataire est obligatoire");
      return;
    }
    if (!donationSimpleData.mentionsLegales.consentementEclaire) {
      toast.error("Le consentement éclairé du donateur est obligatoire");
      return;
    }
    
    try {
      // Construction de la description détaillée
      let description = `DONATION SIMPLE\n\n`;
      
      // Type de donation
      const typesLibelles: Record<string, string> = {
        biens_meubles: "Donation simple de biens meubles",
        biens_immobiliers: "Donation simple de biens immobiliers",
        sommes_argent: "Donation de sommes d'argent",
        nue_propriete: "Donation de nue-propriété",
        usufruit: "Donation d'usufruit",
        parts_sociales: "Donation de parts sociales / actions",
        manuelle: "Donation manuelle",
        mixte: "Donation mixte",
      };
      description += `Type : ${typesLibelles[donationSimpleData.typeDonation] || donationSimpleData.typeDonation}\n`;
      description += `Avec charges : ${donationSimpleData.donationAvecCharges ? "Oui" : "Non"}\n`;
      if (donationSimpleData.donationAvecCharges) {
        description += `Charges : ${donationSimpleData.descriptionCharges}\n`;
      }
      description += `Avec réserve d'usufruit : ${donationSimpleData.donationAvecReserveUsufruit ? "Oui" : "Non"}\n`;
      description += `Avec droit de retour : ${donationSimpleData.donationAvecDroitRetour ? "Oui" : "Non"}\n\n`;
      
      // Donateur
      description += `DONATEUR :\n`;
      description += `${donationSimpleData.donateur.prenom} ${donationSimpleData.donateur.nom}\n`;
      if (donationSimpleData.donateur.nomNaissance) description += `Nom de naissance : ${donationSimpleData.donateur.nomNaissance}\n`;
      description += `Né(e) le ${donationSimpleData.donateur.dateNaissance} à ${donationSimpleData.donateur.lieuNaissance}\n`;
      description += `Adresse : ${donationSimpleData.donateur.adresseComplete}\n`;
      description += `Téléphone : ${donationSimpleData.donateur.telephone}\n`;
      description += `Email : ${donationSimpleData.donateur.email}\n`;
      description += `Nationalité : ${donationSimpleData.donateur.nationalite}\n`;
      description += `Profession : ${donationSimpleData.donateur.profession}\n`;
      description += `Situation familiale : ${donationSimpleData.donateur.situationFamiliale}\n`;
      if (donationSimpleData.donateur.situationFamiliale === "marie") {
        description += `Régime matrimonial : ${donationSimpleData.donateur.regimeMatrimonial}\n`;
      }
      if (donationSimpleData.donateur.situationFiscale) {
        description += `Situation fiscale : ${donationSimpleData.donateur.situationFiscale}\n`;
      }
      description += `\n`;
      
      // Donataire
      description += `DONATAIRE :\n`;
      description += `${donationSimpleData.donataire.prenom} ${donationSimpleData.donataire.nom}\n`;
      if (donationSimpleData.donataire.nomNaissance) description += `Nom de naissance : ${donationSimpleData.donataire.nomNaissance}\n`;
      description += `Né(e) le ${donationSimpleData.donataire.dateNaissance} à ${donationSimpleData.donataire.lieuNaissance}\n`;
      description += `Adresse : ${donationSimpleData.donataire.adresseComplete}\n`;
      description += `Téléphone : ${donationSimpleData.donataire.telephone}\n`;
      description += `Email : ${donationSimpleData.donataire.email}\n`;
      description += `Nationalité : ${donationSimpleData.donataire.nationalite}\n`;
      description += `Profession : ${donationSimpleData.donataire.profession}\n`;
      description += `Lien avec le donateur : ${donationSimpleData.donataire.lienDonateur}\n`;
      description += `\n`;
      
      // Enfants / héritiers
      if (donationSimpleData.nombreEnfants) {
        description += `ENFANTS DU DONATEUR :\n`;
        description += `Nombre : ${donationSimpleData.nombreEnfants}\n`;
        donationSimpleData.enfants.forEach((enfant, idx) => {
          if (enfant.nom) {
            description += `- ${enfant.prenom} ${enfant.nom}, né(e) le ${enfant.dateNaissance}\n`;
          }
        });
        description += `Type de donation : ${donationSimpleData.donationHorsPartSuccessorale ? "Hors part successorale" : ""}${donationSimpleData.donationAvancementPart ? "En avancement de part successorale" : ""}\n`;
        description += `\n`;
      }
      
      // Description des biens selon type
      description += `BIEN(S) DONNÉ(S) :\n`;
      if (donationSimpleData.typeDonation === "biens_immobiliers" && donationSimpleData.bienImmobilier.adresseComplete) {
        description += `Bien immobilier :\n`;
        description += `Adresse : ${donationSimpleData.bienImmobilier.adresseComplete}\n`;
        description += `Nature : ${donationSimpleData.bienImmobilier.natureBien}\n`;
        description += `Désignation cadastrale : Section ${donationSimpleData.bienImmobilier.sectionCadastrale}, N° ${donationSimpleData.bienImmobilier.numeroCadastral}\n`;
        description += `Contenance : ${donationSimpleData.bienImmobilier.contenance}\n`;
        description += `Description : ${donationSimpleData.bienImmobilier.descriptionDetaille}\n`;
        description += `Situation locative : ${donationSimpleData.bienImmobilier.situationLocative}\n`;
        description += `Valeur vénale : ${donationSimpleData.bienImmobilier.valeurVenale} €\n`;
        if (donationSimpleData.bienImmobilier.existenceHypotheques) {
          description += `Hypothèques : ${donationSimpleData.bienImmobilier.montantHypotheques} €\n`;
        }
        if (donationSimpleData.bienImmobilier.repartitionUsufruit) {
          description += `Usufruit : ${donationSimpleData.bienImmobilier.repartitionUsufruit}\n`;
          description += `Nue-propriété : ${donationSimpleData.bienImmobilier.repartitionNuePropriete}\n`;
        }
      }
      
      if (donationSimpleData.typeDonation === "biens_meubles" && donationSimpleData.bienMobilier.descriptionPrecise) {
        description += `Bien mobilier :\n`;
        description += `Description : ${donationSimpleData.bienMobilier.descriptionPrecise}\n`;
        if (donationSimpleData.bienMobilier.numeroSerie) description += `N° série : ${donationSimpleData.bienMobilier.numeroSerie}\n`;
        description += `Valeur estimée : ${donationSimpleData.bienMobilier.valeurEstimee} €\n`;
      }
      
      if (donationSimpleData.typeDonation === "sommes_argent" && donationSimpleData.sommesArgent.montantExact) {
        description += `Somme d'argent :\n`;
        description += `Montant : ${donationSimpleData.sommesArgent.montantExact} €\n`;
        description += `Provenance : ${donationSimpleData.sommesArgent.provenanceFonds}\n`;
        description += `Modalité : ${donationSimpleData.sommesArgent.modalite}\n`;
        description += `Date transfert : ${donationSimpleData.sommesArgent.dateTransfert}\n`;
      }
      
      if (donationSimpleData.typeDonation === "parts_sociales" && donationSimpleData.partsSociales.typeSociete) {
        description += `Parts sociales / Actions :\n`;
        description += `Type société : ${donationSimpleData.partsSociales.typeSociete}\n`;
        description += `Nombre de parts : ${donationSimpleData.partsSociales.nombreParts}\n`;
        description += `Valeur unitaire : ${donationSimpleData.partsSociales.valeurUnitaire} €\n`;
        description += `Pourcentage du capital : ${donationSimpleData.partsSociales.pourcentageCapital}%\n`;
        description += `Agrément obligatoire : ${donationSimpleData.partsSociales.agrementObligatoire ? "Oui" : "Non"}\n`;
        if (donationSimpleData.partsSociales.clausesSpecifiques) {
          description += `Clauses spécifiques : ${donationSimpleData.partsSociales.clausesSpecifiques}\n`;
        }
      }
      
      if ((donationSimpleData.typeDonation === "nue_propriete" || donationSimpleData.typeDonation === "usufruit") && donationSimpleData.nueProprieteUsufruit.valeurNuePropriete) {
        description += `Nue-propriété / Usufruit :\n`;
        description += `Valeur nue-propriété : ${donationSimpleData.nueProprieteUsufruit.valeurNuePropriete} €\n`;
        description += `Valeur usufruit : ${donationSimpleData.nueProprieteUsufruit.valeurUsufruit} €\n`;
        description += `Durée : ${donationSimpleData.nueProprieteUsufruit.duree}\n`;
        description += `Répartition charges : ${donationSimpleData.nueProprieteUsufruit.repartitionCharges}\n`;
      }
      description += `\n`;
      
      // Clauses optionnelles
      if (donationSimpleData.clausesOptionnelles.reserveUsufruit) {
        description += `RÉSERVE D'USUFRUIT :\n`;
        description += `Étendue : ${donationSimpleData.clausesOptionnelles.etendueUsufruit}\n`;
        description += `Droit usage/habitation : ${donationSimpleData.clausesOptionnelles.droitUsageHabitation ? "Oui" : "Non"}\n\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.droitRetour) {
        description += `DROIT DE RETOUR CONVENTIONNEL :\n`;
        description += `Étendue : ${donationSimpleData.clausesOptionnelles.etendueRetour}\n\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.chargeImposee) {
        description += `CHARGE IMPOSÉE AU DONATAIRE :\n`;
        description += `Description : ${donationSimpleData.clausesOptionnelles.descriptionCharge}\n`;
        description += `Montant/Nature : ${donationSimpleData.clausesOptionnelles.montantNatureCharge}\n`;
        description += `Conditions : ${donationSimpleData.clausesOptionnelles.conditionsExecution}\n\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.usageProfessionnel) {
        description += `Bien donné pour usage professionnel\n`;
      }
      if (donationSimpleData.clausesOptionnelles.exclusionCommunaute) {
        description += `Exclusion de la communauté en cas de mariage du donataire\n`;
      }
      if (donationSimpleData.clausesOptionnelles.donationRapportable) {
        description += `Type de donation : ${donationSimpleData.clausesOptionnelles.donationRapportable === "avancement_hoirie" ? "En avancement d'hoirie (rapportable)" : "Hors part successorale (non rapportable)"}\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.clauseInalienabilite) {
        description += `CLAUSE D'INALIÉNABILITÉ :\n`;
        description += `Durée : ${donationSimpleData.clausesOptionnelles.dureeInalienabilite}\n`;
        description += `Motif légitime : ${donationSimpleData.clausesOptionnelles.motifLegitime}\n`;
        description += `Autorisation requise : ${donationSimpleData.clausesOptionnelles.autorisationRequise ? "Oui" : "Non"}\n`;
      }
      
      // Créer le contrat
      const { data: contrat, error: contratError } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Donation simple - ${donationSimpleData.donateur.nom} → ${donationSimpleData.donataire.nom}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          questionnaire_data: donationSimpleData,
        })
        .select()
        .single();
      
      if (contratError) throw contratError;
      
      // Upload des fichiers
      const uploadTasks: Promise<void>[] = [];
      
      const uploadFiles = async (files: File[], folder: string) => {
        for (const file of files) {
          const uniqueName = `${Date.now()}_${file.name}`;
          const filePath = `contrats/${contrat.id}/${folder}/${uniqueName}`;
          
          const { error: uploadError } = await supabase.storage
            .from('contrat-documents')
            .upload(filePath, file);
          
          if (uploadError) {
            console.error(`Erreur upload ${folder}:`, uploadError);
          }
        }
      };
      
      if (donationSimpleDonateurIdentiteFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonateurIdentiteFiles, 'donateur_identite'));
      if (donationSimpleDonateurLivretFamilleFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonateurLivretFamilleFiles, 'donateur_livret_famille'));
      if (donationSimpleDonateurDomicileFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonateurDomicileFiles, 'donateur_domicile'));
      if (donationSimpleDonatairePieceIdentiteFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonatairePieceIdentiteFiles, 'donataire_identite'));
      if (donationSimpleDonataireDomicileFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonataireDomicileFiles, 'donataire_domicile'));
      if (donationSimpleTitreProprieteFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleTitreProprieteFiles, 'titre_propriete'));
      if (donationSimpleEvaluationBienFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleEvaluationBienFiles, 'evaluation_bien'));
      if (donationSimpleAutresDocumentsFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleAutresDocumentsFiles, 'autres_documents'));
      
      await Promise.all(uploadTasks);
      
      // Rafraîchir la liste
      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Donation simple créée avec succès');
      navigate(role === 'notaire' ? '/notaires/contracts' : '/avocats/contracts');
      
    } catch (err: unknown) {
      console.error('Erreur création donation simple:', err);
      toast.error('Erreur lors de la création de la donation simple');
    }
  };

  const handleTestamentSubmit = async () => {
    if (!user) return;
    
    // Validation
    if (!testamentData.typeTestament) {
      toast.error("Veuillez sélectionner le type de testament");
      return;
    }
    
    if (!testamentData.testateurNom || !testamentData.testateurPrenom) {
      toast.error("Veuillez renseigner l'identité complète du testateur");
      return;
    }

    try {
      // Générer la description détaillée
      let description = `TESTAMENT ${testamentData.typeTestament.toUpperCase()}\n\n`;
      
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `INFORMATIONS GÉNÉRALES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `Type : ${testamentData.typeTestament === "authentique" ? "Testament authentique" : "Testament mystique"}\n`;
      description += `Caractère : ${testamentData.caractereTestament}\n`;
      if (testamentData.dateSouhaiteeRedaction) {
        description += `Date souhaitée : ${testamentData.dateSouhaiteeRedaction}\n`;
      }
      description += `\n`;
      
      // Testateur
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `TESTATEUR\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `${testamentData.testateurPrenom} ${testamentData.testateurNom}\n`;
      if (testamentData.testateurNomNaissance) description += `Nom de naissance : ${testamentData.testateurNomNaissance}\n`;
      description += `Né(e) le ${testamentData.testateurDateNaissance} à ${testamentData.testateurLieuNaissance}\n`;
      description += `Adresse : ${testamentData.testateurAdresse}\n`;
      description += `Téléphone : ${testamentData.testateurTelephone}\n`;
      description += `Email : ${testamentData.testateurEmail}\n`;
      description += `Nationalité : ${testamentData.testateurNationalite}\n`;
      description += `Profession : ${testamentData.testateurProfession}\n`;
      description += `Situation familiale : ${testamentData.testateurSituationFamiliale}\n`;
      if (testamentData.regimeMatrimonial.nature) {
        description += `Régime matrimonial : ${testamentData.regimeMatrimonial.nature}\n`;
      }
      description += `Pièce d'identité : ${testamentData.testateurPieceType} n°${testamentData.testateurPieceNumero}\n`;
      description += `Capacité juridique confirmée : ${testamentData.capaciteJuridiqueConfirmee ? "Oui" : "Non"}\n`;
      if (testamentData.sousTutelleCuratelle) {
        description += `⚠️ Sous tutelle/curatelle\n`;
      }
      description += `\n`;
      
      // Héritiers réservataires
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `HÉRITIERS RÉSERVATAIRES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      if (testamentData.heritiersReservataires.enfants.length > 0 && testamentData.heritiersReservataires.enfants[0]?.nom) {
        description += `\nENFANTS (${testamentData.heritiersReservataires.enfants.filter(e => e.nom).length}) :\n`;
        testamentData.heritiersReservataires.enfants.forEach((enfant, idx) => {
          if (enfant.nom) {
            description += `${idx + 1}. ${enfant.prenom} ${enfant.nom}, né(e) le ${enfant.dateNaissance}\n`;
          }
        });
      }
      
      if (testamentData.heritiersReservataires.descendants.length > 0 && testamentData.heritiersReservataires.descendants[0]?.nom) {
        description += `\nDESCENDANTS (petits-enfants) :\n`;
        testamentData.heritiersReservataires.descendants.forEach((desc, idx) => {
          if (desc.nom) {
            description += `${idx + 1}. ${desc.prenom} ${desc.nom} - ${desc.lien}\n`;
          }
        });
      }
      
      if (testamentData.heritiersReservataires.pereVivant === "oui" || testamentData.heritiersReservataires.mereVivante === "oui") {
        description += `\nPARENTS VIVANTS :\n`;
        if (testamentData.heritiersReservataires.pereVivant === "oui") {
          description += `Père : ${testamentData.heritiersReservataires.nomPrenomPere}\n`;
        }
        if (testamentData.heritiersReservataires.mereVivante === "oui") {
          description += `Mère : ${testamentData.heritiersReservataires.nomPrenomMere}\n`;
        }
      }
      
      description += `\n`;
      
      // Légataires
      if (testamentData.legataires.length > 0 && testamentData.legataires[0]?.nom) {
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `LÉGATAIRES\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        testamentData.legataires.forEach((leg, idx) => {
          if (leg.nom) {
            description += `${idx + 1}. ${leg.prenom} ${leg.nom}\n`;
            description += `   Adresse : ${leg.adresse}\n`;
            description += `   Lien : ${leg.lien}\n`;
          }
        });
        description += `\n`;
      }
      
      // Dispositions testamentaires
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `DISPOSITIONS TESTAMENTAIRES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      
      if (testamentData.dispositionsTestamentaires.legsUniversel.actif) {
        description += `\n✓ LEGS UNIVERSEL\n`;
        description += `Bénéficiaire : ${testamentData.dispositionsTestamentaires.legsUniversel.beneficiaire}\n`;
        if (testamentData.dispositionsTestamentaires.legsUniversel.conditions) {
          description += `Conditions : ${testamentData.dispositionsTestamentaires.legsUniversel.conditions}\n`;
        }
      }
      
      if (testamentData.dispositionsTestamentaires.legsTitreUniversel.actif) {
        description += `\n✓ LEGS À TITRE UNIVERSEL\n`;
        description += `Quotité : ${testamentData.dispositionsTestamentaires.legsTitreUniversel.quotite}\n`;
        description += `Bénéficiaire : ${testamentData.dispositionsTestamentaires.legsTitreUniversel.beneficiaire}\n`;
        if (testamentData.dispositionsTestamentaires.legsTitreUniversel.conditions) {
          description += `Conditions : ${testamentData.dispositionsTestamentaires.legsTitreUniversel.conditions}\n`;
        }
      }
      
      if (testamentData.dispositionsTestamentaires.legsParticuliers.length > 0 && testamentData.dispositionsTestamentaires.legsParticuliers[0]?.beneficiaire) {
        description += `\n✓ LEGS PARTICULIERS (${testamentData.dispositionsTestamentaires.legsParticuliers.length})\n`;
        testamentData.dispositionsTestamentaires.legsParticuliers.forEach((leg, idx) => {
          if (leg.beneficiaire) {
            description += `${idx + 1}. ${leg.description} → ${leg.beneficiaire}\n`;
          }
        });
      }
      
      if (testamentData.dispositionsTestamentaires.executeurTestamentaire.actif) {
        description += `\n✓ EXÉCUTEUR TESTAMENTAIRE\n`;
        description += `${testamentData.dispositionsTestamentaires.executeurTestamentaire.prenom} ${testamentData.dispositionsTestamentaires.executeurTestamentaire.nom}\n`;
        description += `Mission : ${testamentData.dispositionsTestamentaires.executeurTestamentaire.mission}\n`;
      }
      description += `\n`;
      
      // Patrimoine
      if (testamentData.patrimoine.biensImmobiliers.length > 0 && testamentData.patrimoine.biensImmobiliers[0]?.adresse) {
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `PATRIMOINE\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `\nBIENS IMMOBILIERS :\n`;
        testamentData.patrimoine.biensImmobiliers.forEach((bien, idx) => {
          if (bien.adresse) {
            description += `${idx + 1}. ${bien.typeBien} - ${bien.adresse} (${bien.valeurEstimative}€)\n`;
          }
        });
      }
      
      // Testament authentique spécifique
      if (testamentData.typeTestament === "authentique") {
        description += `\n═══════════════════════════════════════════════════════════════\n`;
        description += `TESTAMENT AUTHENTIQUE - FORMALITÉS\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `Notaire : ${testamentData.testamentAuthentique.notaireNom}\n`;
        description += `Office : ${testamentData.testamentAuthentique.notaireOffice}\n`;
        
        if (testamentData.testamentAuthentique.presenceSecondNotaire) {
          description += `Deuxième notaire : ${testamentData.testamentAuthentique.secondNotaireNom}\n`;
        }
        
        if (testamentData.testamentAuthentique.temoins.length > 0 && testamentData.testamentAuthentique.temoins[0]?.nom) {
          description += `\nTÉMOINS :\n`;
          testamentData.testamentAuthentique.temoins.forEach((temoin, idx) => {
            if (temoin.nom) {
              description += `${idx + 1}. ${temoin.prenom} ${temoin.nom} - ${temoin.adresse}\n`;
            }
          });
        }
        
        description += `\nFormalités accomplies :\n`;
        description += `- Testament dicté : ${testamentData.testamentAuthentique.formaliteDicte ? "✓" : "✗"}\n`;
        description += `- Testament relu : ${testamentData.testamentAuthentique.formaliteRelu ? "✓" : "✗"}\n`;
        description += `- Testament signé : ${testamentData.testamentAuthentique.formaliteSigne ? "✓" : "✗"}\n`;
        description += `- Inscription FCDDV : ${testamentData.testamentAuthentique.formaliteRegistre ? "✓" : "✗"}\n`;
      }
      
      // Testament mystique spécifique
      if (testamentData.typeTestament === "mystique") {
        description += `\n═══════════════════════════════════════════════════════════════\n`;
        description += `TESTAMENT MYSTIQUE - FORMALITÉS\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `Type d'écriture : ${testamentData.testamentMystique.typeEcriture}\n`;
        description += `Enveloppe cachetée : ${testamentData.testamentMystique.cachete ? "Oui" : "Non"}\n`;
        if (testamentData.testamentMystique.suscription) {
          description += `Suscription : ${testamentData.testamentMystique.suscription}\n`;
        }
        
        if (testamentData.testamentMystique.temoins.length > 0 && testamentData.testamentMystique.temoins[0]?.nom) {
          description += `\nTÉMOINS OBLIGATOIRES :\n`;
          testamentData.testamentMystique.temoins.forEach((temoin, idx) => {
            if (temoin.nom) {
              description += `${idx + 1}. ${temoin.prenom} ${temoin.nom}\n`;
            }
          });
        }
        description += `Inscription FCDDV : ${testamentData.testamentMystique.inscriptionFCDDV ? "Oui" : "Non"}\n`;
      }

      // Créer le contrat
      const { data: contrat, error: contratError } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Testament ${testamentData.typeTestament} - ${testamentData.testateur.nom}`,
          type: "Testament authentique ou mystique",
          category: pendingCategory,
          role: role,
          description: description,
        })
        .select()
        .single();

      if (contratError) throw contratError;

      // Upload des fichiers (même logique que donation simple)
      // ... Upload de tous les fichiers testament

      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Testament créé avec succès');
      navigate(role === 'notaire' ? '/notaires/contracts' : '/avocats/contracts');
      
    } catch (err: unknown) {
      console.error('Erreur création testament:', err);
      toast.error('Erreur lors de la création du testament');
    }
  };

  const handleSuccessionSubmit = async () => {
    if (!user) return;
    
    // Validation des champs obligatoires
    if (!successionData.dateDeces || !successionData.lieuDeces || !successionData.communeDernierDomicile) {
      toast.error("Veuillez renseigner les informations générales sur le décès");
      return;
    }
    
    if (!successionData.defunt.nom || !successionData.defunt.prenom || !successionData.defunt.dateNaissance || !successionData.defunt.situationMatrimoniale) {
      toast.error("Veuillez renseigner l'identité complète du défunt");
      return;
    }
    
    if (!successionActeDeces) {
      toast.error("L'acte de décès est obligatoire");
      return;
    }

    try {
      // Générer la description détaillée
      let description = `DÉCLARATION DE SUCCESSION\n\n`;
      
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `INFORMATIONS GÉNÉRALES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `Date du décès : ${successionData.dateDeces}\n`;
      description += `Lieu du décès : ${successionData.lieuDeces}\n`;
      description += `Commune du dernier domicile : ${successionData.communeDernierDomicile}\n`;
      if (successionData.numeroActeDeces) {
        description += `Numéro d'acte de décès : ${successionData.numeroActeDeces}\n`;
      }
      if (successionData.notaireCharge) {
        description += `Notaire chargé : ${successionData.notaireCharge}\n`;
      }
      description += `Déclaration dans les 6 mois : ${successionData.declarationDans6Mois ? "Oui" : "Non"}\n`;
      if (successionData.decesEtranger) {
        description += `⚠️ Décès à l'étranger (délai 12 mois)\n`;
      }
      description += `\n`;
      
      // Identité du défunt
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `IDENTITÉ DU DÉFUNT\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `${successionData.defunt.prenom} ${successionData.defunt.nom}\n`;
      if (successionData.defunt.nomNaissance) {
        description += `Nom de naissance : ${successionData.defunt.nomNaissance}\n`;
      }
      description += `Né(e) le ${successionData.defunt.dateNaissance}`;
      if (successionData.defunt.lieuNaissance) {
        description += ` à ${successionData.defunt.lieuNaissance}`;
      }
      description += `\n`;
      if (successionData.defunt.nationalite) {
        description += `Nationalité : ${successionData.defunt.nationalite}\n`;
      }
      if (successionData.defunt.profession) {
        description += `Profession : ${successionData.defunt.profession}\n`;
      }
      if (successionData.defunt.adresse) {
        description += `Adresse : ${successionData.defunt.adresse}\n`;
      }
      description += `\n`;
      
      // Situation familiale
      description += `SITUATION FAMILIALE\n`;
      description += `Situation matrimoniale : ${successionData.defunt.situationMatrimoniale}\n`;
      if (successionData.defunt.regimeMatrimonial) {
        description += `Régime matrimonial : ${successionData.defunt.regimeMatrimonial}\n`;
      }
      if (successionData.defunt.contratMariageExiste) {
        description += `✓ Contrat de mariage existant\n`;
      }
      if (successionData.defunt.testamentExiste) {
        description += `✓ Testament existant`;
        if (successionData.defunt.typeTestament) {
          description += ` (${successionData.defunt.typeTestament})`;
        }
        description += `\n`;
      }
      if (successionData.defunt.donationsAnterieuresExistent) {
        description += `✓ Donations antérieures\n`;
      }
      if (successionData.defunt.mandatProtectionFuture) {
        description += `✓ Mandat de protection future\n`;
      }
      if (successionData.defunt.pacteSuccessoral) {
        description += `✓ Pacte successoral\n`;
      }
      description += `\n`;
      
      // Pièces fournies
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `PIÈCES JUSTIFICATIVES FOURNIES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      if (successionActeDeces) description += `✓ Acte de décès\n`;
      if (successionLivretFamille) description += `✓ Livret de famille\n`;
      if (successionContratMariage) description += `✓ Contrat de mariage\n`;
      if (successionTestament) description += `✓ Testament\n`;
      if (successionTitresPropriete) description += `✓ Titres de propriété\n`;
      if (successionAvisImposition) description += `✓ Avis d'imposition\n`;
      if (successionRelevesBancaires) description += `✓ Relevés bancaires\n`;
      if (successionAssuranceVie) description += `✓ Contrats d'assurance-vie\n`;
      if (successionStatutsSocietes) description += `✓ Statuts de sociétés\n`;
      if (successionJustifsDettes) description += `✓ Justificatifs des dettes\n`;
      if (successionFactureFuneraires) description += `✓ Facture pompes funèbres\n`;
      description += `\n`;
      
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `NOTE\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `Les informations détaillées sur les héritiers, le patrimoine complet,\n`;
      description += `le passif et les donations seront complétées par le notaire lors de\n`;
      description += `l'instruction du dossier de succession.\n`;
      description += `\nCes informations préliminaires permettent de démarrer la procédure.\n`;

      // Créer le contrat
      const { data: contrat, error: contratError } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Déclaration de succession - ${successionData.defunt.nom}`,
          type: "Déclaration de succession",
          category: pendingCategory,
          role: role,
          description: description,
        })
        .select()
        .single();

      if (contratError) throw contratError;

      // Upload des fichiers
      const uploadFile = async (file: File | null, fieldName: string) => {
        if (!file) return;
        
        const filePath = `${user.id}/${contrat.id}/${fieldName}_${Date.now()}_${file.name}`;
        const { error: uploadError } = await supabase.storage
          .from('contrats')
          .upload(filePath, file);
        
        if (uploadError) {
          console.error(`Erreur upload ${fieldName}:`, uploadError);
        }
      };

      // Upload de tous les fichiers
      await Promise.all([
        uploadFile(successionActeDeces, 'acte_deces'),
        uploadFile(successionLivretFamille, 'livret_famille'),
        uploadFile(successionContratMariage, 'contrat_mariage'),
        uploadFile(successionTestament, 'testament'),
        uploadFile(successionTitresPropriete, 'titres_propriete'),
        uploadFile(successionAvisImposition, 'avis_imposition'),
        uploadFile(successionRelevesBancaires, 'releves_bancaires'),
        uploadFile(successionAssuranceVie, 'assurance_vie'),
        uploadFile(successionStatutsSocietes, 'statuts_societes'),
        uploadFile(successionJustifsDettes, 'justifs_dettes'),
        uploadFile(successionFactureFuneraires, 'facture_funeraires'),
      ]);

      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Déclaration de succession créée avec succès');
      navigate(role === 'notaire' ? `/notaires/contrats/${contrat.id}` : `/avocats/contrats/${contrat.id}`);
      
    } catch (err: unknown) {
      console.error('Erreur création succession:', err);
      toast.error('Erreur lors de la création de la déclaration de succession');
    }
  };

  const handleActeNotorieteSubmit = async () => {
    if (!user) return;
    
    try {
      // Générer la description structurée
      let description = `ACTE DE NOTORIÉTÉ\n\n`;
      description += `TYPE D'ACTE: ${acteNotorieteData.typeActe === "succession" ? "Succession (détermination des héritiers)" : 
                                     acteNotorieteData.typeActe === "filiation" ? "Filiation / Possession d'état" :
                                     acteNotorieteData.typeActe === "reconstitution_fait" ? "Reconstitution d'un fait juridique" :
                                     "Qualité héréditaire particulière"}\n\n`;
      
      // Informations défunt (si succession)
      if (acteNotorieteData.typeActe === "succession" && acteNotorieteData.defunt.nom) {
        description += `--- DÉFUNT ---\n`;
        description += `Nom : ${acteNotorieteData.defunt.nom}\n`;
        description += `Prénom : ${acteNotorieteData.defunt.prenom}\n`;
        description += `Nom de naissance : ${acteNotorieteData.defunt.nomNaissance}\n`;
        description += `Date de naissance : ${acteNotorieteData.defunt.dateNaissance}\n`;
        description += `Lieu de naissance : ${acteNotorieteData.defunt.lieuNaissance}\n`;
        description += `Date de décès : ${acteNotorieteData.defunt.dateDeces}\n`;
        description += `Lieu de décès : ${acteNotorieteData.defunt.lieuDeces}\n`;
        description += `Situation matrimoniale : ${acteNotorieteData.defunt.situationMatrimoniale}\n`;
        if (acteNotorieteData.defunt.regimeMatrimonial) {
          description += `Régime matrimonial : ${acteNotorieteData.defunt.regimeMatrimonial}\n`;
        }
        description += `Testaments connus : ${acteNotorieteData.defunt.testamentsConnus ? "Oui" : "Non"}\n`;
        description += `\n`;
      }
      
      // Héritiers
      if (acteNotorieteData.heritiers.length > 0) {
        description += `--- HÉRITIERS (${acteNotorieteData.heritiers.length}) ---\n`;
        acteNotorieteData.heritiers.forEach((heritier, index) => {
          description += `\nHéritier ${index + 1}:\n`;
          description += `Nom : ${heritier.nom} ${heritier.prenom}\n`;
          description += `Lien de parenté : ${heritier.lienParente}\n`;
          description += `Option successorale : ${heritier.optionSuccessorale}\n`;
          if (heritier.estMajeurProtege) {
            description += `Majeur protégé (${heritier.typeProtection}) - Tuteur : ${heritier.tuteurNom}\n`;
          }
        });
        description += `\n`;
      }
      
      // Témoins
      if (acteNotorieteData.temoins.length > 0) {
        description += `--- TÉMOINS (${acteNotorieteData.temoins.length}) ---\n`;
        acteNotorieteData.temoins.forEach((temoin, index) => {
          description += `Témoin ${index + 1}: ${temoin.nom} ${temoin.prenom} (${temoin.profession})\n`;
        });
        description += `\n`;
      }
      
      // Conjoint survivant
      if (acteNotorieteData.conjointSurvivant.existe) {
        description += `--- CONJOINT SURVIVANT ---\n`;
        description += `Donation entre époux existante : ${acteNotorieteData.conjointSurvivant.donationEntreEpouxExiste ? "Oui" : "Non"}\n`;
        description += `Election optionnelle : ${acteNotorieteData.conjointSurvivant.electionOptionnelle}\n`;
        description += `\n`;
      }

      // Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Acte de notoriété - ${acteNotorieteData.defunt.nom || "Non renseigné"}`,
          type: "Acte de notoriété",
          category: "Succession",
          role: role,
          description: description,
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers avec await pour chaque fichier de chaque array
      const uploadFile = async (files: File[], subfolder: string) => {
        for (const file of files) {
          const filePath = `contrats/${contrat.id}/${subfolder}/${file.name}`;
          const { error: uploadError } = await supabase.storage
            .from('documents')
            .upload(filePath, file);
          if (uploadError) {
            console.error(`Erreur upload ${file.name}:`, uploadError);
          }
        }
      };

      // Upload tous les fichiers
      await Promise.all([
        // Défunt
        uploadFile(acteNotorieteDefuntActeDeces, 'defunt_acte_deces'),
        uploadFile(acteNotorieteDefuntActeNaissance, 'defunt_acte_naissance'),
        uploadFile(acteNotorieteDefuntLivretFamille, 'defunt_livret_famille'),
        uploadFile(acteNotorieteDefuntActeMariage, 'defunt_acte_mariage'),
        uploadFile(acteNotorieteDefuntContratMariage, 'defunt_contrat_mariage'),
        uploadFile(acteNotorieteDefuntJugementDivorce, 'defunt_jugement_divorce'),
        uploadFile(acteNotorieteDefuntTestament, 'defunt_testament'),
        uploadFile(acteNotorieteDefuntDonations, 'defunt_donations'),
        uploadFile(acteNotorieteDefuntJustifDomicile, 'defunt_justif_domicile'),
        uploadFile(acteNotorieteDefuntPieceIdentite, 'defunt_piece_identite'),
        
        // Preuves filiation
        uploadFile(acteNotorietePreuvePhotos, 'preuves_photos'),
        uploadFile(acteNotorietePreuveCertificats, 'preuves_certificats'),
        uploadFile(acteNotorietePreuveDocumentsScolaires, 'preuves_documents_scolaires'),
        uploadFile(acteNotorietePreuveCorrespondances, 'preuves_correspondances'),
        uploadFile(acteNotorietePreuveAutres, 'preuves_autres'),
        
        // Héritiers collectifs
        uploadFile(acteNotorieteHeritiersActesNaissance, 'heritiers_actes_naissance'),
        uploadFile(acteNotorieteHeritiersPiecesIdentite, 'heritiers_pieces_identite'),
        uploadFile(acteNotorieteHeritiersJustifsDomicile, 'heritiers_justifs_domicile'),
        uploadFile(acteNotorieteHeritiersLivretsFamille, 'heritiers_livrets_famille'),
        uploadFile(acteNotorieteHeritiersActesNotoriete, 'heritiers_actes_notoriete'),
        uploadFile(acteNotorieteHeritiersCertificatsHeredite, 'heritiers_certificats_heredite'),
        uploadFile(acteNotorieteHeritiersTutelleCuratelle, 'heritiers_tutelle_curatelle'),
        
        // Témoins collectifs
        uploadFile(acteNotorieteTemoinsPiecesIdentite, 'temoins_pieces_identite'),
        uploadFile(acteNotorieteTemoinsJustifsDomicile, 'temoins_justifs_domicile'),
        
        // Autres documents
        uploadFile(acteNotorieteAutresAttestations, 'autres_attestations'),
        uploadFile(acteNotorieteAutresCertificatsMedicaux, 'autres_certificats_medicaux'),
        uploadFile(acteNotorieteAutresCorrespondances, 'autres_correspondances'),
        uploadFile(acteNotorieteAutresDocuments, 'autres_documents'),
      ]);
      
      // Upload des fichiers héritiers individuels (dynamiques)
      for (const heritierId of Object.keys(acteNotorieteHeritierFiles)) {
        const id = Number(heritierId);
        await uploadFile(acteNotorieteHeritierFiles[id] || [], `heritier_${id}_documents`);
      }
      
      // Upload des fichiers témoins individuels (dynamiques)
      for (const temoinId of Object.keys(acteNotorieteTemoinFiles)) {
        const id = Number(temoinId);
        await uploadFile(acteNotorieteTemoinFiles[id] || [], `temoin_${id}_documents`);
      }

      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Acte de notoriété créé avec succès');
      navigate(role === 'notaire' ? `/notaires/contrats/${contrat.id}` : `/avocats/contrats/${contrat.id}`);
      
    } catch (err: unknown) {
      console.error('Erreur création acte de notoriété:', err);
      toast.error("Erreur lors de la création de l'acte de notoriété");
    }
  };

  const handlePartageSuccessoralSubmit = async () => {
    if (!user) return;
    
    try {
      // Générer la description structurée
      let description = `PARTAGE SUCCESSORAL\n\n`;
      
      // Défunt
      description += `--- DÉFUNT ---\n`;
      description += `${partageSuccessoralData.succession.defunt.prenom} ${partageSuccessoralData.succession.defunt.nom}\n`;
      description += `Né(e) le ${partageSuccessoralData.succession.defunt.dateNaissance} à ${partageSuccessoralData.succession.defunt.lieuNaissance}\n`;
      description += `Décédé(e) le ${partageSuccessoralData.succession.defunt.dateDeces} à ${partageSuccessoralData.succession.defunt.lieuDeces}\n`;
      description += `Régime matrimonial : ${partageSuccessoralData.succession.defunt.regimeMatrimonial}\n\n`;
      
      // Héritiers
      description += `--- HÉRITIERS (${partageSuccessoralData.heritiers.length}) ---\n`;
      partageSuccessoralData.heritiers.forEach((heritier, index) => {
        description += `${index + 1}. ${heritier.prenom} ${heritier.nom} (${heritier.lienDefunt})\n`;
        description += `   Quote-part : ${heritier.quotePart}\n`;
        description += `   Statut : ${heritier.acceptationRenonciation || "Accepte"}\n`;
      });
      description += `\n`;
      
      // Type de partage
      description += `--- TYPE DE PARTAGE ---\n`;
      description += `${partageSuccessoralData.partage.typePartage === "total" ? "Partage total" :
                       partageSuccessoralData.partage.typePartage === "partiel" ? "Partage partiel" :
                       partageSuccessoralData.partage.typePartage === "attribution_preferentielle" ? "Attribution préférentielle" :
                       partageSuccessoralData.partage.typePartage === "amiable" ? "Partage amiable" :
                       "Partage judiciaire"}\n\n`;
      
      // Actif
      if (partageSuccessoralData.actif.biensImmobiliers.length > 0) {
        description += `--- BIENS IMMOBILIERS (${partageSuccessoralData.actif.biensImmobiliers.length}) ---\n`;
        partageSuccessoralData.actif.biensImmobiliers.forEach((bien, index) => {
          description += `${index + 1}. ${bien.adresse} - Valeur : ${bien.valeurVenale}€\n`;
        });
        description += `\n`;
      }
      
      // Lots
      if (partageSuccessoralData.partage.lots.length > 0) {
        description += `--- LOTS DE PARTAGE (${partageSuccessoralData.partage.lots.length}) ---\n`;
        partageSuccessoralData.partage.lots.forEach((lot, index) => {
          description += `Lot ${index + 1} : ${lot.nomLot}\n`;
          description += `   Valeur : ${lot.valeurTotale}€\n`;
          description += `   Attribution : ${lot.attributionHeritier}\n`;
          if (lot.soulte) description += `   Soulte : ${lot.soulte}€\n`;
        });
      }

      // Créer le contrat
      const { data: contrat, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Partage successoral - ${partageSuccessoralData.succession.defunt.nom}`,
          type: "Partage successoral",
          category: "Succession",
          role: role,
          description: description,
        })
        .select()
        .single();

      if (error) throw error;

      // Upload des fichiers
      const uploadFile = async (files: File[], subfolder: string) => {
        for (const file of files) {
          const filePath = `contrats/${contrat.id}/${subfolder}/${file.name}`;
          const { error: uploadError } = await supabase.storage
            .from('documents')
            .upload(filePath, file);
          if (uploadError) {
            console.error(`Erreur upload ${file.name}:`, uploadError);
          }
        }
      };

      // Upload tous les fichiers
      await Promise.all([
        // Défunt
        uploadFile(partageDefuntActeDeces, 'defunt_acte_deces'),
        uploadFile(partageDefuntLivretFamille, 'defunt_livret_famille'),
        uploadFile(partageDefuntContratMariage, 'defunt_contrat_mariage'),
        uploadFile(partageDefuntTestaments, 'defunt_testaments'),
        uploadFile(partageDefuntDonationsEntreEpoux, 'defunt_donations_entre_epoux'),
        uploadFile(partageDefuntDonationsAnterieures, 'defunt_donations_anterieures'),
        uploadFile(partageDefuntTitresPropriete, 'defunt_titres_propriete'),
        uploadFile(partageDefuntRelevesBancaires, 'defunt_releves_bancaires'),
        uploadFile(partageDefuntBilansEntreprises, 'defunt_bilans_entreprises'),
        uploadFile(partageDefuntInventaireMobilier, 'defunt_inventaire_mobilier'),
        
        // Autres documents
        uploadFile(partageAutresDiagnostics, 'autres_diagnostics'),
        uploadFile(partageAutresEvaluations, 'autres_evaluations'),
        uploadFile(partageAutresStatutsSocietes, 'autres_statuts_societes'),
        uploadFile(partageAutresDocuments, 'autres_documents'),
      ]);
      
      // Upload des fichiers héritiers (dynamiques)
      for (const heritierId of Object.keys(partageHeritierFiles)) {
        const id = Number(heritierId);
        await uploadFile(partageHeritierFiles[id] || [], `heritier_${id}_documents`);
      }
      
      // Upload des fichiers biens immobiliers (dynamiques)
      for (const bienId of Object.keys(partageBienImmobilierFiles)) {
        const id = Number(bienId);
        await uploadFile(partageBienImmobilierFiles[id] || [], `bien_immobilier_${id}_documents`);
      }

      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Partage successoral créé avec succès');
      navigate(role === 'notaire' ? `/notaires/contrats/${contrat.id}` : `/avocats/contrats/${contrat.id}`);
      
    } catch (err: unknown) {
      console.error('Erreur création partage successoral:', err);
      toast.error("Erreur lors de la création du partage successoral");
    }
  };

  const handleChangementRegimeSubmit = async () => {
    if (!user) return;
    
    toast.error("La fonction de création du changement de régime matrimonial n'est pas encore implémentée");
  };

  const handleDelete = async (contrat: ContratRow) => {
    if (!user) return;
    if (!confirm(`Supprimer "${contrat.name}" ?`)) return;
    
    try {
      const { error } = await supabase
        .from('contrats')
        .delete()
        .eq('id', contrat.id)
        .eq('owner_id', user.id);
      
      if (error) throw error;
      
      setContrats((prev) => prev.filter((c) => c.id !== contrat.id));
      toast.success('Contrat supprimé');
    } catch (err: unknown) {
      console.error('Erreur suppression contrat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la suppression', { description: message });
    }
  };

  const handleView = (contrat: ContratRow) => {
    navigate(role === 'notaire' ? `/notaires/contrats/${contrat.id}` : `/avocats/contrats/${contrat.id}`);
  };

  // Résultats déjà filtrés côté SQL
  const filteredContrats = contrats;

  return (
    <AppLayout>
      <div className="p-6">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-bold">{role === 'notaire' ? 'Actes' : 'Contrats'}</h1>
            <p className="text-foreground mt-1">
              Centralisez et créez vos modèles de contrats
            </p>
          </div>
          <div>
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button className={mainButtonColor}>
                  <Plus className="h-4 w-4 mr-2" />
                  Ajouter
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end" className={menuContentClass}>
                <DropdownMenuItem className={role === 'notaire' ? 'focus:bg-orange-600 focus:text-white' : 'focus:bg-blue-600 focus:text-white'} onClick={() => window.location.href = (role === 'notaire' ? '/notaires/documents?openImport=1' : '/avocats/documents?openImport=1')}>
                  <Upload className="mr-2 h-4 w-4" />
                  Importer depuis mon appareil
                </DropdownMenuItem>

                <DropdownMenuSub>
                    <DropdownMenuSubTrigger className={role === 'notaire' ? 'font-semibold hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white data-[state=open]:bg-orange-600 data-[state=open]:text-white' : 'font-semibold hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white data-[state=open]:bg-blue-600 data-[state=open]:text-white'}>Créer un contrat</DropdownMenuSubTrigger>
                  <DropdownMenuSubContent className={menuContentClass}>
                    {(role === 'notaire' ? NOTAIRE_CONTRACT_CATEGORIES : AVOCAT_CONTRACT_CATEGORIES).map((cat) => (
                      <DropdownMenuSub key={cat.key}>
                          <DropdownMenuSubTrigger className={role === 'notaire' ? 'font-semibold hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white data-[state=open]:bg-orange-600 data-[state=open]:text-white' : 'font-semibold hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white data-[state=open]:bg-blue-600 data-[state=open]:text-white'}>{cat.label}</DropdownMenuSubTrigger>
                            <DropdownMenuSubContent className={menuContentClass}>
                          {cat.contracts.map((contract) => (
                            <DropdownMenuItem
                              key={contract}
                              className={role === 'notaire' ? 'cursor-pointer hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'cursor-pointer hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}
                              onClick={() => createContract(contract, cat.key)}
                            >
                              {contract}
                            </DropdownMenuItem>
                          ))}
                        </DropdownMenuSubContent>
                      </DropdownMenuSub>
                    ))}
                  </DropdownMenuSubContent>
                </DropdownMenuSub>
              </DropdownMenuContent>
            </DropdownMenu>
          </div>
        </div>

        {loading ? (
          <div className="flex items-center justify-center h-[400px] border border-dashed border-border rounded-lg">
            <p className="text-foreground">Chargement…</p>
          </div>
        ) : contrats.length === 0 ? (
          <div className="flex items-center justify-center h-[400px] border border-dashed border-border rounded-lg">
            <div className="text-center">
              <p className="text-foreground">Aucun contrat pour le moment</p>
              <div className="mt-4 flex justify-center">
                <DropdownMenu>
                  <DropdownMenuTrigger asChild>
                    <Button className={mainButtonColor}>
                      <Plus className="h-4 w-4 mr-2" />
                      Ajouter
                    </Button>
                  </DropdownMenuTrigger>
                  <DropdownMenuContent align="end" className={menuContentClass}>
                    <DropdownMenuSub>
                      <DropdownMenuSubTrigger className={`font-semibold ${role === 'notaire' ? 'hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}`}>Créer un contrat</DropdownMenuSubTrigger>
                      <DropdownMenuSubContent className={menuContentClass}>
                        {(role === 'notaire' ? NOTAIRE_CONTRACT_CATEGORIES : AVOCAT_CONTRACT_CATEGORIES).map((cat) => (
                          <DropdownMenuSub key={cat.key}>
                            <DropdownMenuSubTrigger className={`font-semibold ${role === 'notaire' ? 'hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}`}>{cat.label}</DropdownMenuSubTrigger>
                            <DropdownMenuSubContent className={menuContentClass}>
                              {cat.contracts.map((contract) => (
                                <DropdownMenuItem
                                  key={contract}
                                  className={role === 'notaire' ? 'cursor-pointer hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'cursor-pointer hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}
                                  onClick={() => createContract(contract, cat.key)}
                                >
                                  {contract}
                                </DropdownMenuItem>
                              ))}
                            </DropdownMenuSubContent>
                          </DropdownMenuSub>
                        ))}
                      </DropdownMenuSubContent>
                    </DropdownMenuSub>
                  </DropdownMenuContent>
                </DropdownMenu>
              </div>
            </div>
          </div>
        ) : (
          <>
            <div className="flex items-center gap-4 mb-4 bg-white p-4 rounded-lg border">
              <div className="relative flex-1">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-foreground" />
                <Input
                  placeholder="Rechercher un contrat..."
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                  className="pl-10 bg-white text-foreground placeholder:text-foreground/50"
                />
              </div>
              <Select value={categoryFilter} onValueChange={setCategoryFilter}>
                <SelectTrigger className="w-[280px]">
                  <SelectValue placeholder="Catégorie" />
                </SelectTrigger>
                <SelectContent className={selectContentClass}>
                  {(role === 'notaire' ? categoriesNotaire : categoriesAvocat).map((cat) => (
                    <SelectItem key={cat} value={cat} className={selectItemClass}>
                      {cat}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <Card>
              <CardHeader>
                <CardTitle className="text-lg">{role === 'notaire' ? 'Liste des actes' : 'Liste des contrats'}</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="border rounded-lg bg-white">
                  <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>Nom du contrat</TableHead>
                    <TableHead>Type</TableHead>
                    <TableHead>Catégorie</TableHead>
                    <TableHead>Créé le</TableHead>
                    <TableHead className="w-[50px]"></TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {filteredContrats.length === 0 ? (
                    <TableRow>
                      <TableCell colSpan={5} className="text-center text-foreground">
                        Aucun contrat trouvé
                      </TableCell>
                    </TableRow>
                  ) : (
                    filteredContrats.map((contrat) => (
                      <TableRow key={contrat.id}>
                        <TableCell className="font-medium">{contrat.name}</TableCell>
                        <TableCell className="text-sm text-foreground">{contrat.type}</TableCell>
                        <TableCell>
                          <Badge variant="outline" className={
                            role === 'notaire'
                              ? 'bg-orange-100 text-orange-600 border-orange-200'
                              : 'bg-blue-100 text-gray-700 border-gray-200'
                          }>
                            {contrat.category}
                          </Badge>
                        </TableCell>
                        <TableCell className="text-sm text-foreground">
                          {new Date(contrat.created_at).toLocaleDateString()}
                        </TableCell>
                        <TableCell>
                          <div className="flex items-center gap-1">
                            <ShareToCollaborativeDialog
                              itemId={contrat.id}
                              itemName={contrat.name}
                              itemType="contrat"
                              role={role}
                              onSuccess={() => {
                                toast.success('Contrat partagé');
                              }}
                            />
                            <DropdownMenu>
                              <DropdownMenuTrigger asChild>
                                <Button 
                                  variant="ghost" 
                                  size="icon"
                                  className={role === 'notaire' ? 'hover:bg-orange-100 hover:text-orange-600' : 'hover:bg-blue-100 hover:text-gray-700'}
                                >
                                  <MoreHorizontal className="h-4 w-4" />
                                </Button>
                              </DropdownMenuTrigger>
                              <DropdownMenuContent align="end" className={menuContentClass}>
                                <DropdownMenuItem 
                                  className={menuItemClass}
                                  onClick={() => handleView(contrat)}
                                >
                                  <Eye className="mr-2 h-4 w-4" />
                                  Voir
                                </DropdownMenuItem>
                                <DropdownMenuItem 
                                  className={`text-destructive ${menuItemClass}`}
                                  onClick={() => handleDelete(contrat)}
                                >
                                  <Trash2 className="mr-2 h-4 w-4" />
                                  Supprimer
                                </DropdownMenuItem>
                              </DropdownMenuContent>
                            </DropdownMenu>
                          </div>
                        </TableCell>
                      </TableRow>
                    ))
                  )}
                </TableBody>
                  </Table>
                </div>
              </CardContent>
            </Card>
          </>
        )}
      </div>

      {/* Dialog questionnaire pour compromis de vente / acte de vente */}
      <Dialog open={showQuestionDialog} onOpenChange={setShowQuestionDialog}>
        <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>
              {pendingContractType === "Compromis de vente / Promesse unilatérale de vente"
                ? (questionnaireData.typeContrat === "promesse_unilaterale" 
                    ? "Informations pour la promesse unilatérale de vente"
                    : "Informations pour le compromis de vente")
                : pendingContractType === "Acte de vente immobilière" 
                ? "Informations pour l'acte de vente immobilière" 
                : (pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé")
                ? "Informations pour le bail d'habitation"
                : pendingContractType === "Bail commercial / professionnel"
                ? (bailCommercialData.typeBail === "commercial" 
                    ? "Informations pour le bail commercial"
                    : bailCommercialData.typeBail === "professionnel"
                    ? "Informations pour le bail professionnel" 
                    : "Informations pour le bail commercial / professionnel")
                : pendingContractType === "Convention d'indivision"
                ? "Informations pour la convention d'indivision"
                : pendingContractType === "Mainlevée d'hypothèque"
                ? "Informations pour la mainlevée d'hypothèque"
                : pendingContractType === "Contrat de mariage (régimes matrimoniaux)"
                ? "Informations pour le contrat de mariage"
                : pendingContractType === "PACS (convention + enregistrement)"
                ? "Informations pour le PACS"
                : pendingContractType === "Donation entre époux"
                ? "Informations pour la donation entre époux"
                : pendingContractType === "Donation simple (parent → enfant, etc.)"
                ? "Informations pour la donation simple"
                : pendingContractType === "Testament authentique ou mystique"
                ? "Informations pour le testament"
                : pendingContractType === "Acte de notoriété"
                ? "Informations pour l'acte de notoriété"
                : pendingContractType === "Partage successoral"
                ? "Informations pour le partage successoral"
                : pendingContractType === "Procuration authentique"
                ? "Informations pour la procuration authentique"
                : pendingContractType === "Procuration notariée liée à la succession"
                ? "Informations pour la procuration notariée liée à la succession"
                : pendingContractType === "Mandat de protection future"
                ? "Informations pour le mandat de protection future"
                : pendingContractType === "Mandat de protection future sous seing privé"
                ? "Informations pour le mandat de protection future sous seing privé"
                : pendingContractType === "Pacte de concubinage"
                ? "Informations pour le pacte de concubinage"
                : pendingContractType === "Convention parentale"
                ? "Informations pour la convention parentale"
                : pendingContractType === "Reconnaissance de dettes"
                ? "Informations pour la reconnaissance de dettes"
                : pendingContractType === "Attestation de propriété immobilière"
                ? "Informations pour l'attestation de propriété immobilière"
                : pendingContractType === "Quitus / reconnaissance de dette"
                ? "Informations pour le quitus / reconnaissance de dette"
                : pendingContractType === "Changement de régime matrimonial"
                ? "Informations pour le changement de régime matrimonial"
                : pendingContractType === "Déclaration de succession"
                ? "Informations pour la déclaration de succession"
                : "Informations pour le " + (pendingContractType || "contrat").toLowerCase()}
            </DialogTitle>
            <DialogDescription>
              Remplissez les informations suivantes pour préparer le document. Ces informations aideront l'IA à rédiger un contrat personnalisé.
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-6 mt-4">
            {/* Formulaire spécifique pour Compromis de vente */}
            {pendingContractType === "Compromis de vente / Promesse unilatérale de vente" && (
              <>
            {/* Choix du type de contrat */}
            <div className="space-y-4 bg-muted/50 p-4 rounded-lg">
              <h3 className="font-semibold text-lg">Type de contrat *</h3>
              <RadioGroup 
                value={questionnaireData.typeContrat}
                onValueChange={(value) => setQuestionnaireData({...questionnaireData, typeContrat: value})}
              >
                <div className="flex items-center space-x-2">
                  <RadioGroupItem value="compromis" id="compromis" />
                  <Label htmlFor="compromis" className="cursor-pointer">Compromis de vente</Label>
                </div>
                <div className="flex items-center space-x-2">
                  <RadioGroupItem value="promesse_unilaterale" id="promesse_unilaterale" />
                  <Label htmlFor="promesse_unilaterale" className="cursor-pointer">Promesse unilatérale de vente</Label>
                </div>
              </RadioGroup>
            </div>

            {/* Section Vendeur */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">👤 Vendeur</h3>
              <div className="space-y-4">
                {questionnaireData.clientRole === "vendeur" ? (
                  <>
                    {/* Le client est le vendeur */}
                    <ClientSelector 
                      clients={clients}
                      selectedClientId={questionnaireData.clientId}
                      onClientChange={(clientId) => {
                        setQuestionnaireData({...questionnaireData, clientId: clientId});
                      }}
                      label="Sélectionner votre client"
                      placeholder="Choisir un client"
                    />

                    {/* Afficher les informations du client sélectionné */}
                    {questionnaireData.clientId && clients.find(c => c.id === questionnaireData.clientId) && (
                      <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                        <p><strong>Nom complet:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nom} {clients.find(c => c.id === questionnaireData.clientId)?.prenom}</p>
                        {clients.find(c => c.id === questionnaireData.clientId)?.adresse && (
                          <p><strong>Adresse:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.adresse}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.telephone && (
                          <p><strong>Téléphone:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.telephone}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.email && (
                          <p><strong>Email:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.email}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.date_naissance && (
                          <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === questionnaireData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.nationalite && (
                          <p><strong>Nationalité:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nationalite}</p>
                        )}
                      </div>
                    )}

                    {/* Statut matrimonial du client vendeur */}
                    <div className="space-y-2">
                      <Label htmlFor="statutMatrimonialClient">Statut matrimonial *</Label>
                      <Input 
                        id="statutMatrimonialClient"
                        value={questionnaireData.statutMatrimonialClient} 
                        onChange={(e) => setQuestionnaireData({...questionnaireData, statutMatrimonialClient: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>

                    {(questionnaireData.statutMatrimonialClient === "marie" || questionnaireData.statutMatrimonialClient === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="regimeMatrimonialClient">Régime matrimonial *</Label>
                          <Select value={questionnaireData.regimeMatrimonialClient} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialClient: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {questionnaireData.regimeMatrimonialClient === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="precisionRegimeClient">Préciser le régime</Label>
                            <Input 
                              id="precisionRegimeClient"
                              value={questionnaireData.precisionRegimeClient}
                              onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeClient: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}

                    {/* Pièce d'identité du client vendeur */}
                    {questionnaireData.clientId && (
                      <div className="space-y-2">
                        <Label>📎 Pièce d'identité</Label>
                        {compromisClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(compromisClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    {/* Saisie manuelle vendeur (le client est acheteur) */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="nomAutrePartie">Nom *</Label>
                        <Input 
                          id="nomAutrePartie"
                          value={questionnaireData.nomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, nomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="prenomAutrePartie">Prénom *</Label>
                        <Input 
                          id="prenomAutrePartie"
                          value={questionnaireData.prenomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, prenomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="adresseAutrePartie">Adresse complète *</Label>
                        <Input 
                          id="adresseAutrePartie"
                          value={questionnaireData.adresseAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, adresseAutrePartie: e.target.value})}
                        />
                      </div>

                      {/* Statut matrimonial autre partie */}
                      <div className="space-y-2">
                        <Label htmlFor="statutMatrimonialAutrePartie">Statut matrimonial *</Label>
                        <Select value={questionnaireData.statutMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, statutMatrimonialAutrePartie: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="celibataire">Célibataire</SelectItem>
                            <SelectItem value="marie">Marié</SelectItem>
                            <SelectItem value="pacse">Pacsé</SelectItem>
                            <SelectItem value="divorce">Divorcé</SelectItem>
                            <SelectItem value="veuf">Veuf</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {(questionnaireData.statutMatrimonialAutrePartie === "marie" || questionnaireData.statutMatrimonialAutrePartie === "pacse") && (
                        <>
                          <div className="space-y-2">
                            <Label htmlFor="regimeMatrimonialAutrePartie">Régime matrimonial *</Label>
                            <Select value={questionnaireData.regimeMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialAutrePartie: value})}>
                              <SelectTrigger>
                                <SelectValue placeholder="Sélectionner..." />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {questionnaireData.regimeMatrimonialAutrePartie === "autre" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label htmlFor="precisionRegimeAutrePartie">Préciser le régime</Label>
                              <Input 
                                id="precisionRegimeAutrePartie"
                                value={questionnaireData.precisionRegimeAutrePartie}
                                onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeAutrePartie: e.target.value})}
                                placeholder="Précisez le régime matrimonial..."
                              />
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </>
                )}
              </div>
            </div>

            {/* Section Acquéreur */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">👥 Acquéreur</h3>
              <div className="space-y-4">
                {questionnaireData.clientRole === "acheteur" ? (
                  <>
                    {/* Le client est l'acheteur */}
                    <ClientSelector 
                      clients={clients}
                      selectedClientId={questionnaireData.clientId}
                      onClientChange={(clientId) => {
                        setQuestionnaireData({...questionnaireData, clientId: clientId});
                      }}
                      label="Sélectionner votre client"
                      placeholder="Choisir un client"
                    />

                    {/* Afficher les informations du client sélectionné */}
                    {questionnaireData.clientId && clients.find(c => c.id === questionnaireData.clientId) && (
                      <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                        <p><strong>Nom complet:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nom} {clients.find(c => c.id === questionnaireData.clientId)?.prenom}</p>
                        {clients.find(c => c.id === questionnaireData.clientId)?.adresse && (
                          <p><strong>Adresse:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.adresse}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.telephone && (
                          <p><strong>Téléphone:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.telephone}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.email && (
                          <p><strong>Email:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.email}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.date_naissance && (
                          <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === questionnaireData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.nationalite && (
                          <p><strong>Nationalité:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nationalite}</p>
                        )}
                      </div>
                    )}

                    {/* Statut matrimonial du client acheteur */}
                    <div className="space-y-2">
                      <Label htmlFor="statutMatrimonialClient">Statut matrimonial *</Label>
                      <Input 
                        id="statutMatrimonialClient"
                        value={questionnaireData.statutMatrimonialClient} 
                        onChange={(e) => setQuestionnaireData({...questionnaireData, statutMatrimonialClient: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>

                    {(questionnaireData.statutMatrimonialClient === "marie" || questionnaireData.statutMatrimonialClient === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="regimeMatrimonialClient">Régime matrimonial *</Label>
                          <Select value={questionnaireData.regimeMatrimonialClient} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialClient: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {questionnaireData.regimeMatrimonialClient === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="precisionRegimeClient">Préciser le régime</Label>
                            <Input 
                              id="precisionRegimeClient"
                              value={questionnaireData.precisionRegimeClient}
                              onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeClient: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}

                    {/* Pièce d'identité du client acquéreur */}
                    {questionnaireData.clientId && (
                      <div className="space-y-2">
                        <Label>📎 Pièce d'identité</Label>
                        {compromisClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(compromisClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    {/* Saisie manuelle acquéreur (le client est vendeur) */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="nomAutrePartie">Nom *</Label>
                        <Input 
                          id="nomAutrePartie"
                          value={questionnaireData.nomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, nomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="prenomAutrePartie">Prénom *</Label>
                        <Input 
                          id="prenomAutrePartie"
                          value={questionnaireData.prenomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, prenomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="adresseAutrePartie">Adresse complète *</Label>
                        <Input 
                          id="adresseAutrePartie"
                          value={questionnaireData.adresseAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, adresseAutrePartie: e.target.value})}
                        />
                      </div>

                      {/* Statut matrimonial autre partie */}
                      <div className="space-y-2">
                        <Label htmlFor="statutMatrimonialAutrePartie">Statut matrimonial *</Label>
                        <Select value={questionnaireData.statutMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, statutMatrimonialAutrePartie: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="celibataire">Célibataire</SelectItem>
                            <SelectItem value="marie">Marié</SelectItem>
                            <SelectItem value="pacse">Pacsé</SelectItem>
                            <SelectItem value="divorce">Divorcé</SelectItem>
                            <SelectItem value="veuf">Veuf</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {(questionnaireData.statutMatrimonialAutrePartie === "marie" || questionnaireData.statutMatrimonialAutrePartie === "pacse") && (
                        <>
                          <div className="space-y-2">
                            <Label htmlFor="regimeMatrimonialAutrePartie">Régime matrimonial *</Label>
                            <Select value={questionnaireData.regimeMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialAutrePartie: value})}>
                              <SelectTrigger>
                                <SelectValue placeholder="Sélectionner..." />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {questionnaireData.regimeMatrimonialAutrePartie === "autre" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label htmlFor="precisionRegimeAutrePartie">Préciser le régime</Label>
                              <Input 
                                id="precisionRegimeAutrePartie"
                                value={questionnaireData.precisionRegimeAutrePartie}
                                onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeAutrePartie: e.target.value})}
                                placeholder="Précisez le régime matrimonial..."
                              />
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </>
                )}
              </div>
              <div className="space-y-2">
                <Label>📎 Pièce d'identité de l'autre partie</Label>
                
                {/* Upload pour l'autre partie */}
                {questionnaireData.clientId && (
                  <div className="space-y-2">
                    <p className="text-sm font-medium text-muted-foreground">
                      {questionnaireData.clientRole === "vendeur" ? "Acquéreur" : "Vendeur"}
                    </p>
                    <MultiFileUpload
                      label="📎 Pièce d'identité de l'autre partie"
                      files={compromisAutrePartieFiles}
                      onFilesChange={setCompromisAutrePartieFiles}
                      accept="application/pdf,image/*"
                    />
                  </div>
                )}
              </div>
            </div>

            {/* Informations sur le bien */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">🏠 Informations sur le bien</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="adresseBien">Adresse complète du bien *</Label>
                  <Input 
                    id="adresseBien"
                    value={questionnaireData.adresseBien}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, adresseBien: e.target.value})}
                    placeholder="Ex: 12 rue de la Paix, 75002 Paris"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="typeBien">Type de bien *</Label>
                  <Select value={questionnaireData.typeBien} onValueChange={(value) => setQuestionnaireData({...questionnaireData, typeBien: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="appartement">Appartement</SelectItem>
                      <SelectItem value="maison">Maison</SelectItem>
                      <SelectItem value="terrain">Terrain</SelectItem>
                      <SelectItem value="immeuble">Immeuble</SelectItem>
                      <SelectItem value="local_commercial">Local commercial</SelectItem>
                      <SelectItem value="parking">Parking/Garage</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="surfaceHabitable">Surface habitable (m²) *</Label>
                  <Input 
                    id="surfaceHabitable"
                    type="number"
                    value={questionnaireData.surfaceHabitable}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, surfaceHabitable: e.target.value})}
                    placeholder="Ex: 75"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="nombrePieces">Nombre de pièces</Label>
                  <Input 
                    id="nombrePieces"
                    type="number"
                    value={questionnaireData.nombrePieces}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, nombrePieces: e.target.value})}
                    placeholder="Ex: 3"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="naturePropriete">Nature de la propriété *</Label>
                  <Select value={questionnaireData.naturePropriete} onValueChange={(value) => setQuestionnaireData({...questionnaireData, naturePropriete: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="pleine_propriete">Pleine propriété</SelectItem>
                      <SelectItem value="usufruit">Usufruit</SelectItem>
                      <SelectItem value="nue_propriete">Nue-propriété</SelectItem>
                      <SelectItem value="indivision">Indivision</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="bienCopropriete">Bien en copropriété ? *</Label>
                  <Select value={questionnaireData.bienCopropriete} onValueChange={(value) => setQuestionnaireData({...questionnaireData, bienCopropriete: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                {questionnaireData.bienCopropriete === "oui" && (
                  <>
                    <div className="space-y-2">
                      <Label htmlFor="numeroLot">Numéro de lot</Label>
                      <Input 
                        id="numeroLot"
                        value={questionnaireData.numeroLot}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, numeroLot: e.target.value})}
                        placeholder="Ex: 123"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="tantièmes">Tantièmes / Quote-part des parties communes</Label>
                      <Input 
                        id="tantièmes"
                        value={questionnaireData.tantièmes}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, tantièmes: e.target.value})}
                        placeholder="Ex: 150/10000"
                      />
                    </div>
                  </>
                )}
                <div className="space-y-2">
                  <Label htmlFor="occupationBien">Occupation du bien *</Label>
                  <Select value={questionnaireData.occupationBien} onValueChange={(value) => setQuestionnaireData({...questionnaireData, occupationBien: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="libre">Libre</SelectItem>
                      <SelectItem value="occupe_vendeur">Occupé par le vendeur</SelectItem>
                      <SelectItem value="occupe_locataire">Occupé par un locataire</SelectItem>
                      <SelectItem value="bail_en_cours">Bail en cours</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="servitudesConnues">Servitudes connues ? *</Label>
                  <Select value={questionnaireData.servitudesConnues} onValueChange={(value) => setQuestionnaireData({...questionnaireData, servitudesConnues: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                {questionnaireData.servitudesConnues === "oui" && (
                  <div className="space-y-2 md:col-span-2">
                    <Label htmlFor="descriptionServitudes">Description des servitudes</Label>
                    <Textarea 
                      id="descriptionServitudes"
                      value={questionnaireData.descriptionServitudes}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, descriptionServitudes: e.target.value})}
                      placeholder="Décrivez les servitudes..."
                      rows={3}
                    />
                  </div>
                )}
                <div className="space-y-2">
                  <Label htmlFor="bienLibre">Bien vendu libre de toute occupation à la signature ? *</Label>
                  <Select value={questionnaireData.bienLibre} onValueChange={(value) => setQuestionnaireData({...questionnaireData, bienLibre: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>

            {/* Conditions financières */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Conditions financières</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="prixVente">Prix de vente (€) *</Label>
                  <Input 
                    id="prixVente"
                    type="number"
                    value={questionnaireData.prixVente}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, prixVente: e.target.value})}
                    placeholder="Ex: 350000"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="depotGarantie">Dépôt de garantie (€)</Label>
                  <Input 
                    id="depotGarantie"
                    type="number"
                    value={questionnaireData.depotGarantie}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, depotGarantie: e.target.value})}
                    placeholder="Ex: 35000"
                  />
                </div>
                <div className="space-y-2 md:col-span-2">
                  <Label htmlFor="modalitesPaiement">Modalités de paiement</Label>
                  <Textarea 
                    id="modalitesPaiement"
                    rows={2}
                    value={questionnaireData.modalitesPaiement}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, modalitesPaiement: e.target.value})}
                    placeholder="Décrivez les modalités de paiement (comptant, crédit, etc.)"
                  />
                </div>
              </div>
            </div>

            {/* Conditions suspensives - Uniquement pour Compromis */}
            {questionnaireData.typeContrat === "compromis" && (
              <div className="space-y-4">
                <h3 className="font-semibold text-lg border-b pb-2">Conditions suspensives</h3>
                <div className="space-y-4">
                  <div className="space-y-2">
                    <Label htmlFor="conditionPret">Condition d'obtention de prêt ? *</Label>
                    <Select value={questionnaireData.conditionPret} onValueChange={(value) => setQuestionnaireData({...questionnaireData, conditionPret: value})}>
                      <SelectTrigger>
                        <SelectValue placeholder="Sélectionner..." />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  {questionnaireData.conditionPret === "oui" && (
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg">
                    <div className="md:col-span-2">
                      <h4 className="font-medium text-sm mb-4">Détails du prêt immobilier</h4>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="montantPret">Montant du prêt envisagé (€) *</Label>
                      <Input 
                        id="montantPret"
                        type="number"
                        value={questionnaireData.montantPret}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, montantPret: e.target.value})}
                        placeholder="Ex: 280000"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="dureePret">Durée maximale du prêt (années) *</Label>
                      <Input 
                        id="dureePret"
                        type="number"
                        value={questionnaireData.dureePret}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, dureePret: e.target.value})}
                        placeholder="Ex: 25"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="tauxInteretMax">Taux d'intérêt maximal accepté (%) *</Label>
                      <Input 
                        id="tauxInteretMax"
                        type="number"
                        step="0.01"
                        value={questionnaireData.tauxInteretMax}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, tauxInteretMax: e.target.value})}
                        placeholder="Ex: 3.5"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="delaiAccordPret">Délai pour obtenir l'accord de prêt *</Label>
                      <Input 
                        id="delaiAccordPret"
                        value={questionnaireData.delaiAccordPret}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, delaiAccordPret: e.target.value})}
                        placeholder="Ex: 45 jours ou date limite"
                      />
                    </div>
                  </div>
                )}
                <div className="space-y-2">
                  <Label htmlFor="conditionDiagnostics">Diagnostics et contrôles techniques</Label>
                  <Textarea 
                    id="conditionDiagnostics"
                    rows={2}
                    value={questionnaireData.conditionDiagnostics}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, conditionDiagnostics: e.target.value})}
                    placeholder="Ex: DPE, diagnostic amiante, plomb, termites..."
                  />
                </div>
                <MultiFileUpload
                  label="📎 Joindre les diagnostics"
                  files={compromisDiagnosticsFiles}
                  onFilesChange={setCompromisDiagnosticsFiles}
                  accept="application/pdf"
                />
                <div className="space-y-2">
                  <Label htmlFor="autresConditions">Autres conditions suspensives</Label>
                  <Textarea 
                    id="autresConditions"
                    rows={2}
                    value={questionnaireData.autresConditions}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, autresConditions: e.target.value})}
                    placeholder="Autres conditions éventuelles"
                  />
                </div>
              </div>
            </div>
            )}

            {/* Droit de préemption */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Droit de préemption</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="droitPreemptionUrbain">Bien soumis au droit de préemption urbain ? *</Label>
                  <Select value={questionnaireData.droitPreemptionUrbain} onValueChange={(value) => setQuestionnaireData({...questionnaireData, droitPreemptionUrbain: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                      <SelectItem value="inconnu">Inconnu</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="locatairePreemption">Présence d'un locataire avec droit de préemption ? *</Label>
                  <Select value={questionnaireData.locatairePreemption} onValueChange={(value) => setQuestionnaireData({...questionnaireData, locatairePreemption: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>

            {/* Promesse unilatérale spécifique */}
            {questionnaireData.typeContrat === "promesse_unilaterale" && (
              <div className="space-y-4">
                <h3 className="font-semibold text-lg border-b pb-2">Spécifique à la promesse unilatérale de vente</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="dureeOption">Durée de l'option (en jours) *</Label>
                    <Input 
                      id="dureeOption"
                      type="number"
                      value={questionnaireData.dureeOption}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, dureeOption: e.target.value})}
                      placeholder="Ex: 60"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="dateLimiteOption">Date limite de levée d'option *</Label>
                    <Input 
                      id="dateLimiteOption"
                      type="date"
                      value={questionnaireData.dateLimiteOption}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, dateLimiteOption: e.target.value})}
                    />
                  </div>
                  <div className="space-y-2 md:col-span-2">
                    <Label htmlFor="indemniteImmobilisation">Indemnité d'immobilisation (€ ou %) *</Label>
                    <Input 
                      id="indemniteImmobilisation"
                      value={questionnaireData.indemniteImmobilisation}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, indemniteImmobilisation: e.target.value})}
                      placeholder="Ex: 5000 € ou 5% du prix de vente"
                    />
                  </div>
                </div>
              </div>
            )}

            {/* Délais */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Délais</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="dateSignatureActeDefinitif">Date prévue signature acte définitif</Label>
                  <Input 
                    id="dateSignatureActeDefinitif"
                    type="date"
                    value={questionnaireData.dateSignatureActeDefinitif}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, dateSignatureActeDefinitif: e.target.value})}
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="delaiReflexion">Délai de rétractation (jours)</Label>
                  <Input 
                    id="delaiReflexion"
                    type="number"
                    value={questionnaireData.delaiReflexion}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, delaiReflexion: e.target.value})}
                    placeholder="Ex: 10"
                  />
                </div>
              </div>
            </div>

            {/* Informations complémentaires */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Informations complémentaires</h3>
              <div className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="chargesCopropriete">Charges de copropriété (si applicable)</Label>
                  <Textarea 
                    id="chargesCopropriete"
                    rows={2}
                    value={questionnaireData.chargesCopropriete}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, chargesCopropriete: e.target.value})}
                    placeholder="Montant annuel, répartition, détails..."
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="travauxAPrevenir">Travaux à prévoir</Label>
                  <Textarea 
                    id="travauxAPrevenir"
                    rows={2}
                    value={questionnaireData.travauxAPrevenir}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, travauxAPrevenir: e.target.value})}
                    placeholder="Description des travaux prévus ou nécessaires"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="autresInformations">Autres informations utiles</Label>
                  <Textarea 
                    id="autresInformations"
                    rows={3}
                    value={questionnaireData.autresInformations}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, autresInformations: e.target.value})}
                    placeholder="Toute information complémentaire pertinente pour le contrat"
                  />
                </div>
              </div>
            </div>
          </>
            )}

            {/* Formulaire spécifique pour Acte de vente immobilière */}
            {pendingContractType === "Acte de vente immobilière" && (
              <>
                {/* Vendeur - avec auto-fill si client sélectionné comme vendeur, sinon manuel */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">👤 Vendeur</h3>
                  <div className="space-y-4">
                    {acteVenteData.clientRole === "vendeur" ? (
                      <>
                        {/* Le client est le vendeur */}
                        <ClientSelector 
                          clients={clients}
                          selectedClientId={acteVenteData.clientId}
                          onClientChange={(clientId) => {
                            setActeVenteData({...acteVenteData, clientId: clientId});
                          }}
                          label="Sélectionner votre client"
                          placeholder="Choisir un client"
                        />

                        {/* Afficher les informations du client sélectionné */}
                        {acteVenteData.clientId && clients.find(c => c.id === acteVenteData.clientId) && (
                          <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                            <p><strong>Nom complet:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nom} {clients.find(c => c.id === acteVenteData.clientId)?.prenom}</p>
                            {clients.find(c => c.id === acteVenteData.clientId)?.adresse && (
                              <p><strong>Adresse:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.adresse}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.telephone && (
                              <p><strong>Téléphone:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.telephone}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.email && (
                              <p><strong>Email:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.email}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.date_naissance && (
                              <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === acteVenteData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.nationalite && (
                              <p><strong>Nationalité:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nationalite}</p>
                            )}
                          </div>
                        )}
                      </>
                    ) : (
                      <>
                        {/* Saisie manuelle vendeur (le client est acheteur) */}
                        <div className="text-sm text-muted-foreground mb-2">
                          Saisir manuellement les informations du vendeur
                        </div>
                      </>
                    )}
                  </div>
                  
                  {/* Type de partie - Vendeur */}
                  <div className="space-y-4">
                    <Label>Type de partie *</Label>
                    <RadioGroup 
                      value={acteVenteData.vendeurTypePartie}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurTypePartie: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_physique" id="vendeur_pp" />
                        <Label htmlFor="vendeur_pp" className="cursor-pointer">Personne physique</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_morale" id="vendeur_pm" />
                        <Label htmlFor="vendeur_pm" className="cursor-pointer">Personne morale (société)</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si personne morale */}
                  {acteVenteData.vendeurTypePartie === "personne_morale" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="vendeur_denomination">Dénomination sociale *</Label>
                        <Input 
                          id="vendeur_denomination"
                          value={acteVenteData.vendeurDenominationSociale}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurDenominationSociale: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_forme">Forme juridique *</Label>
                        <Input 
                          id="vendeur_forme"
                          value={acteVenteData.vendeurFormeJuridique}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurFormeJuridique: e.target.value})}
                          placeholder="SARL, SAS, SCI..."
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_siren">SIREN *</Label>
                        <Input 
                          id="vendeur_siren"
                          value={acteVenteData.vendeurSiren}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurSiren: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="vendeur_siege">Adresse du siège social *</Label>
                        <Input 
                          id="vendeur_siege"
                          value={acteVenteData.vendeurSiegeSocial}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurSiegeSocial: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_representant">Nom du représentant légal *</Label>
                        <Input 
                          id="vendeur_representant"
                          value={acteVenteData.vendeurRepresentantNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurRepresentantNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_qualite">Qualité *</Label>
                        <Input 
                          id="vendeur_qualite"
                          value={acteVenteData.vendeurRepresentantQualite}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurRepresentantQualite: e.target.value})}
                          placeholder="Gérant, Président..."
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Extrait Kbis</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('kbis-vendeur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="kbis-vendeur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}

                  {/* Représentation - Vendeur */}
                  <div className="space-y-4">
                    <Label>La partie est-elle représentée ?</Label>
                    <RadioGroup 
                      value={acteVenteData.vendeurRepresente}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurRepresente: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="non" id="vendeur_rep_non" />
                        <Label htmlFor="vendeur_rep_non" className="cursor-pointer">Non</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="oui" id="vendeur_rep_oui" />
                        <Label htmlFor="vendeur_rep_oui" className="cursor-pointer">Oui</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si représenté */}
                  {acteVenteData.vendeurRepresente === "oui" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_mand_nom">Nom du mandataire *</Label>
                        <Input 
                          id="vendeur_mand_nom"
                          value={acteVenteData.vendeurMandataireNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurMandataireNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_mand_prenom">Prénom du mandataire *</Label>
                        <Input 
                          id="vendeur_mand_prenom"
                          value={acteVenteData.vendeurMandatairePrenom}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurMandatairePrenom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="vendeur_type_pouvoir">Type de pouvoir *</Label>
                        <Select value={acteVenteData.vendeurTypePouvoir} onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurTypePouvoir: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="mandat_authentique">Mandat authentique</SelectItem>
                            <SelectItem value="mandat_ssp">Mandat sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Joindre le mandat (PDF)</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('mandat-vendeur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="mandat-vendeur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}
                  
                  {/* Champs communs pour le vendeur */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurNom">Nom *</Label>
                      <Input 
                        id="acte_vendeurNom" 
                        value={acteVenteData.vendeurNom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurNom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurPrenom">Prénom *</Label>
                      <Input 
                        id="acte_vendeurPrenom" 
                        value={acteVenteData.vendeurPrenom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurPrenom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_vendeurAdresse">Adresse *</Label>
                      <Input 
                        id="acte_vendeurAdresse" 
                        value={acteVenteData.vendeurAdresse} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurAdresse: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurDateNaissance">Date de naissance *</Label>
                      <Input 
                        id="acte_vendeurDateNaissance" 
                        type="date" 
                        value={acteVenteData.vendeurDateNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurDateNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurLieuNaissance">Lieu de naissance *</Label>
                      <Input 
                        id="acte_vendeurLieuNaissance" 
                        value={acteVenteData.vendeurLieuNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurLieuNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurNationalite">Nationalité *</Label>
                      <Input 
                        id="acte_vendeurNationalite" 
                        value={acteVenteData.vendeurNationalite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurNationalite: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurProfession">Profession *</Label>
                      <Input 
                        id="acte_vendeurProfession" 
                        value={acteVenteData.vendeurProfession} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurProfession: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurStatut">Statut matrimonial *</Label>
                      <Input 
                        id="acte_vendeurStatut"
                        value={acteVenteData.vendeurStatutMatrimonial} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurStatutMatrimonial: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>
                    {(acteVenteData.vendeurStatutMatrimonial === "marie" || acteVenteData.vendeurStatutMatrimonial === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="acte_vendeurRegime">Régime matrimonial *</Label>
                          <Select value={acteVenteData.vendeurRegimeMatrimonial} onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurRegimeMatrimonial: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {acteVenteData.vendeurRegimeMatrimonial === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="acte_vendeurPrecisionRegime">Préciser le régime</Label>
                            <Input 
                              id="acte_vendeurPrecisionRegime"
                              value={acteVenteData.vendeurPrecisionRegime}
                              onChange={(e) => setActeVenteData({...acteVenteData, vendeurPrecisionRegime: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurPiece">Type de pièce d'identité *</Label>
                      <Input 
                        id="acte_vendeurPiece" 
                        value={acteVenteData.vendeurPieceIdentite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurPieceIdentite: e.target.value})} 
                        placeholder="Ex: CNI, Passeport" 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurNumero">Numéro de pièce d'identité *</Label>
                      <Input 
                        id="acte_vendeurNumero" 
                        value={acteVenteData.vendeurNumeroIdentite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurNumeroIdentite: e.target.value})} 
                        
                      />
                    </div>
                  </div>
                  
                  {/* Pièce d'identité du vendeur - chargée depuis client ou upload */}
                  {acteVenteData.clientRole === "vendeur" && acteVenteData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {acteClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(acteClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="w-4 h-4" />
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : (
                    /* Upload de pièces d'identité vendeur */
                    <MultiFileUpload
                      label="📎 Pièces d'identité du vendeur"
                      files={acteVendeurFiles}
                      onFilesChange={setActeVendeurFiles}
                      accept="application/pdf,image/*"
                    />
                  )}
                </div>

                {/* Acheteur - avec auto-fill si client sélectionné comme acheteur, sinon manuel */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">👥 Acquéreur</h3>
                  <div className="space-y-4">
                    {acteVenteData.clientRole === "acheteur" ? (
                      <>
                        {/* Le client est l'acheteur */}
                        <ClientSelector 
                          clients={clients}
                          selectedClientId={acteVenteData.clientId}
                          onClientChange={(clientId) => {
                            setActeVenteData({...acteVenteData, clientId: clientId});
                          }}
                          label="Sélectionner votre client"
                          placeholder="Choisir un client"
                        />

                        {/* Afficher les informations du client sélectionné */}
                        {acteVenteData.clientId && clients.find(c => c.id === acteVenteData.clientId) && (
                          <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                            <p><strong>Nom complet:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nom} {clients.find(c => c.id === acteVenteData.clientId)?.prenom}</p>
                            {clients.find(c => c.id === acteVenteData.clientId)?.adresse && (
                              <p><strong>Adresse:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.adresse}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.telephone && (
                              <p><strong>Téléphone:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.telephone}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.email && (
                              <p><strong>Email:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.email}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.date_naissance && (
                              <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === acteVenteData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.nationalite && (
                              <p><strong>Nationalité:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nationalite}</p>
                            )}
                          </div>
                        )}
                      </>
                    ) : (
                      <>
                        {/* Saisie manuelle acheteur (le client est vendeur) */}
                        <div className="text-sm text-muted-foreground mb-2">
                          Saisir manuellement les informations de l'acheteur
                        </div>
                      </>
                    )}
                  </div>
                  
                  {/* Champs communs pour l'acheteur */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurNom">Nom *</Label>
                      <Input 
                        id="acte_acheteurNom" 
                        value={acteVenteData.acheteurNom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurNom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurPrenom">Prénom *</Label>
                      <Input 
                        id="acte_acheteurPrenom" 
                        value={acteVenteData.acheteurPrenom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurPrenom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_acheteurAdresse">Adresse *</Label>
                      <Input 
                        id="acte_acheteurAdresse" 
                        value={acteVenteData.acheteurAdresse} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurAdresse: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurDateNaissance">Date de naissance *</Label>
                      <Input 
                        id="acte_acheteurDateNaissance" 
                        type="date" 
                        value={acteVenteData.acheteurDateNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurDateNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurLieuNaissance">Lieu de naissance *</Label>
                      <Input 
                        id="acte_acheteurLieuNaissance" 
                        value={acteVenteData.acheteurLieuNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurLieuNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurNationalite">Nationalité *</Label>
                      <Input 
                        id="acte_acheteurNationalite" 
                        value={acteVenteData.acheteurNationalite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurNationalite: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurProfession">Profession *</Label>
                      <Input 
                        id="acte_acheteurProfession" 
                        value={acteVenteData.acheteurProfession} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurProfession: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurStatut">Statut matrimonial *</Label>
                      <Input 
                        id="acte_acheteurStatut"
                        value={acteVenteData.acheteurStatutMatrimonial} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurStatutMatrimonial: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>
                    {(acteVenteData.acheteurStatutMatrimonial === "marie" || acteVenteData.acheteurStatutMatrimonial === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="acte_acheteurRegime">Régime matrimonial *</Label>
                          <Select value={acteVenteData.acheteurRegimeMatrimonial} onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurRegimeMatrimonial: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {acteVenteData.acheteurRegimeMatrimonial === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="acte_acheteurPrecisionRegime">Préciser le régime</Label>
                            <Input 
                              id="acte_acheteurPrecisionRegime"
                              value={acteVenteData.acheteurPrecisionRegime}
                              onChange={(e) => setActeVenteData({...acteVenteData, acheteurPrecisionRegime: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}
                    <div className="space-y-2">
                      <Label htmlFor="acte_modeAcquisition">Mode d'acquisition *</Label>
                      <Select value={acteVenteData.acheteurModeAcquisition} onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurModeAcquisition: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="seul">Achat seul</SelectItem>
                          <SelectItem value="couple">En couple</SelectItem>
                          <SelectItem value="indivision">En indivision</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.acheteurModeAcquisition === "indivision" && (
                      <div className="space-y-2">
                        <Label htmlFor="acte_quotePart">Quote-part d'acquisition (%)</Label>
                        <Input id="acte_quotePart" type="number" value={acteVenteData.acheteurQuotePart} onChange={(e) => setActeVenteData({...acteVenteData, acheteurQuotePart: e.target.value})} placeholder="Ex: 50" />
                      </div>
                    )}
                  </div>
                  
                  {/* Type de partie - Acquéreur */}
                  <div className="space-y-4">
                    <Label>Type de partie *</Label>
                    <RadioGroup 
                      value={acteVenteData.acheteurTypePartie}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurTypePartie: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_physique" id="acheteur_pp" />
                        <Label htmlFor="acheteur_pp" className="cursor-pointer">Personne physique</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_morale" id="acheteur_pm" />
                        <Label htmlFor="acheteur_pm" className="cursor-pointer">Personne morale (société)</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si personne morale - Acquéreur */}
                  {acteVenteData.acheteurTypePartie === "personne_morale" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acheteur_denomination">Dénomination sociale *</Label>
                        <Input 
                          id="acheteur_denomination"
                          value={acteVenteData.acheteurDenominationSociale}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurDenominationSociale: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_forme">Forme juridique *</Label>
                        <Input 
                          id="acheteur_forme"
                          value={acteVenteData.acheteurFormeJuridique}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurFormeJuridique: e.target.value})}
                          placeholder="SARL, SAS, SCI..."
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_siren">SIREN *</Label>
                        <Input 
                          id="acheteur_siren"
                          value={acteVenteData.acheteurSiren}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurSiren: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acheteur_siege">Adresse du siège social *</Label>
                        <Input 
                          id="acheteur_siege"
                          value={acteVenteData.acheteurSiegeSocial}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurSiegeSocial: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_representant">Nom du représentant légal *</Label>
                        <Input 
                          id="acheteur_representant"
                          value={acteVenteData.acheteurRepresentantNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurRepresentantNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_qualite">Qualité *</Label>
                        <Input 
                          id="acheteur_qualite"
                          value={acteVenteData.acheteurRepresentantQualite}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurRepresentantQualite: e.target.value})}
                          placeholder="Gérant, Président..."
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Extrait Kbis</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('kbis-acheteur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="kbis-acheteur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}

                  {/* Représentation - Acquéreur */}
                  <div className="space-y-4">
                    <Label>La partie est-elle représentée ?</Label>
                    <RadioGroup 
                      value={acteVenteData.acheteurRepresente}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurRepresente: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="non" id="acheteur_rep_non" />
                        <Label htmlFor="acheteur_rep_non" className="cursor-pointer">Non</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="oui" id="acheteur_rep_oui" />
                        <Label htmlFor="acheteur_rep_oui" className="cursor-pointer">Oui</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si représenté - Acquéreur */}
                  {acteVenteData.acheteurRepresente === "oui" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_mand_nom">Nom du mandataire *</Label>
                        <Input 
                          id="acheteur_mand_nom"
                          value={acteVenteData.acheteurMandataireNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurMandataireNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_mand_prenom">Prénom du mandataire *</Label>
                        <Input 
                          id="acheteur_mand_prenom"
                          value={acteVenteData.acheteurMandatairePrenom}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurMandatairePrenom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acheteur_type_pouvoir">Type de pouvoir *</Label>
                        <Select value={acteVenteData.acheteurTypePouvoir} onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurTypePouvoir: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="mandat_authentique">Mandat authentique</SelectItem>
                            <SelectItem value="mandat_ssp">Mandat sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Joindre le mandat (PDF)</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('mandat-acheteur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="mandat-acheteur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}
                  
                  {/* Pièce d'identité de l'acquéreur - chargée depuis client ou upload */}
                  {acteVenteData.clientRole === "acheteur" && acteVenteData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {acteClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(acteClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="w-4 h-4" />
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : (
                    /* Upload de pièces d'identité acheteur */
                  <MultiFileUpload
                    label="📎 Pièces d'identité de l'acheteur"
                    files={acteAcheteurFiles}
                    onFilesChange={setActeAcheteurFiles}
                    accept="application/pdf,image/*"
                  />
                  )}
                </div>

                {/* Informations sur le bien */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏠 Informations sur le bien</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_adresse">Adresse complète du bien *</Label>
                      <Input 
                        id="acte_adresse"
                        value={acteVenteData.adresseBien}
                        onChange={(e) => setActeVenteData({...acteVenteData, adresseBien: e.target.value})}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_typeBien">Type de bien *</Label>
                      <Select value={acteVenteData.typeBien} onValueChange={(value) => setActeVenteData({...acteVenteData, typeBien: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="appartement">Appartement</SelectItem>
                          <SelectItem value="maison">Maison</SelectItem>
                          <SelectItem value="terrain">Terrain</SelectItem>
                          <SelectItem value="immeuble">Immeuble</SelectItem>
                          <SelectItem value="local_commercial">Local commercial</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_naturePropriete">Nature de propriété *</Label>
                      <Select value={acteVenteData.naturePropriete} onValueChange={(value) => setActeVenteData({...acteVenteData, naturePropriete: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="pleine_propriete">Pleine propriété</SelectItem>
                          <SelectItem value="usufruit">Usufruit</SelectItem>
                          <SelectItem value="nue_propriete">Nue-propriété</SelectItem>
                          <SelectItem value="indivision">Indivision</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_sectionCadastrale">Section cadastrale *</Label>
                      <Input id="acte_sectionCadastrale" value={acteVenteData.sectionCadastrale} onChange={(e) => setActeVenteData({...acteVenteData, sectionCadastrale: e.target.value})} placeholder="Ex: AB" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_numeroCadastral">Numéro cadastral *</Label>
                      <Input id="acte_numeroCadastral" value={acteVenteData.numeroCadastral} onChange={(e) => setActeVenteData({...acteVenteData, numeroCadastral: e.target.value})} placeholder="Ex: 123" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_contenanceCadastrale">Contenance cadastrale *</Label>
                      <Input id="acte_contenanceCadastrale" value={acteVenteData.contenanceCadastrale} onChange={(e) => setActeVenteData({...acteVenteData, contenanceCadastrale: e.target.value})} placeholder="Ex: 500 m²" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_surfaceHabitable">Surface habitable (m²) *</Label>
                      <Input id="acte_surfaceHabitable" type="number" value={acteVenteData.surfaceHabitable} onChange={(e) => setActeVenteData({...acteVenteData, surfaceHabitable: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_surfaceTerrain">Surface du terrain (m²)</Label>
                      <Input id="acte_surfaceTerrain" type="number" value={acteVenteData.surfaceTerrain} onChange={(e) => setActeVenteData({...acteVenteData, surfaceTerrain: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_nombrePieces">Nombre de pièces</Label>
                      <Input id="acte_nombrePieces" type="number" value={acteVenteData.nombrePieces} onChange={(e) => setActeVenteData({...acteVenteData, nombrePieces: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_anneeConstruction">Année de construction</Label>
                      <Input id="acte_anneeConstruction" type="number" value={acteVenteData.anneeConstruction} onChange={(e) => setActeVenteData({...acteVenteData, anneeConstruction: e.target.value})} placeholder="Ex: 1990" />
                    </div>
                  </div>

                  {/* Annexes et dépendances */}
                  <div className="space-y-4 p-4 bg-slate-50 dark:bg-slate-900 rounded-lg">
                    <h4 className="font-medium">Annexes et dépendances</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_garage">Garage</Label>
                        <Select value={acteVenteData.bienGarage} onValueChange={(value) => setActeVenteData({...acteVenteData, bienGarage: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_parking">Parking</Label>
                        <Select value={acteVenteData.bienParking} onValueChange={(value) => setActeVenteData({...acteVenteData, bienParking: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_cave">Cave</Label>
                        <Select value={acteVenteData.bienCave} onValueChange={(value) => setActeVenteData({...acteVenteData, bienCave: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_grenier">Grenier</Label>
                        <Select value={acteVenteData.bienGrenier} onValueChange={(value) => setActeVenteData({...acteVenteData, bienGrenier: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_jardin">Jardin</Label>
                        <Select value={acteVenteData.bienJardin} onValueChange={(value) => setActeVenteData({...acteVenteData, bienJardin: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_autresDep">Autres dépendances</Label>
                        <Input 
                          id="acte_autresDep"
                          value={acteVenteData.autresDependances}
                          onChange={(e) => setActeVenteData({...acteVenteData, autresDependances: e.target.value})}
                          placeholder="Ex: buanderie, atelier..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* Équipements inclus dans la vente */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h4 className="font-medium">Équipements inclus dans la vente</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_cuisine">Cuisine équipée</Label>
                        <Select value={acteVenteData.cuisineEquipee} onValueChange={(value) => setActeVenteData({...acteVenteData, cuisineEquipee: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_electromenagers">Électroménagers inclus</Label>
                        <Select value={acteVenteData.electromenagersInclus} onValueChange={(value) => setActeVenteData({...acteVenteData, electromenagersInclus: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {acteVenteData.electromenagersInclus === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label htmlFor="acte_electroListe">Liste des électroménagers</Label>
                          <Textarea 
                            id="acte_electroListe"
                            value={acteVenteData.electromenagersListe}
                            onChange={(e) => setActeVenteData({...acteVenteData, electromenagersListe: e.target.value})}
                            placeholder="Ex: réfrigérateur, four, lave-vaisselle..."
                            rows={2}
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label htmlFor="acte_mobilier">Mobilier laissé</Label>
                        <Select value={acteVenteData.mobilierLaisse} onValueChange={(value) => setActeVenteData({...acteVenteData, mobilierLaisse: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_autresEquip">Autres équipements</Label>
                        <Input 
                          id="acte_autresEquip"
                          value={acteVenteData.autresEquipements}
                          onChange={(e) => setActeVenteData({...acteVenteData, autresEquipements: e.target.value})}
                          placeholder="Ex: climatisation, alarme..."
                        />
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_destinationBien">Destination du bien *</Label>
                      <Select value={acteVenteData.destinationBien} onValueChange={(value) => setActeVenteData({...acteVenteData, destinationBien: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="habitation">Habitation</SelectItem>
                          <SelectItem value="commerciale">Commerciale</SelectItem>
                          <SelectItem value="mixte">Mixte</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Copropriété */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏢 Copropriété</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_bienCopropriete">Bien en copropriété ? *</Label>
                      <Select value={acteVenteData.bienCopropriete} onValueChange={(value) => setActeVenteData({...acteVenteData, bienCopropriete: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.bienCopropriete === "oui" && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="acte_numerosLots">Numéros de lot(s)</Label>
                          <Input id="acte_numerosLots" value={acteVenteData.numerosLots} onChange={(e) => setActeVenteData({...acteVenteData, numerosLots: e.target.value})} placeholder="Ex: 12, 13, 14" />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_tantiemes">Tantièmes / Quote-parts</Label>
                          <Input id="acte_tantiemes" value={acteVenteData.tantièmes} onChange={(e) => setActeVenteData({...acteVenteData, tantièmes: e.target.value})} placeholder="Ex: 150/10000" />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_reglementCopro">Règlement de copropriété disponible ?</Label>
                          <Select value={acteVenteData.reglementCopro} onValueChange={(value) => setActeVenteData({...acteVenteData, reglementCopro: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_chargesAnnuelles">Charges annuelles (€)</Label>
                          <Input id="acte_chargesAnnuelles" type="number" value={acteVenteData.chargesAnnuelles} onChange={(e) => setActeVenteData({...acteVenteData, chargesAnnuelles: e.target.value})} />
                        </div>
                      </>
                    )}
                  </div>
                </div>

                {/* État juridique */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">⚖️ État juridique du bien</h3>
                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_servitudes">Servitudes existantes</Label>
                      <Textarea id="acte_servitudes" value={acteVenteData.servitudesExistantes} onChange={(e) => setActeVenteData({...acteVenteData, servitudesExistantes: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_hypotheques">Hypothèques / Inscriptions existantes</Label>
                      <Textarea id="acte_hypotheques" value={acteVenteData.hypotheques} onChange={(e) => setActeVenteData({...acteVenteData, hypotheques: e.target.value})} rows={2} />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_bienLibre">Bien libre ou occupé à l'acte ?</Label>
                        <Select value={acteVenteData.bienLibreOuOccupe} onValueChange={(value) => setActeVenteData({...acteVenteData, bienLibreOuOccupe: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="libre">Libre</SelectItem>
                            <SelectItem value="occupe">Occupé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {acteVenteData.bienLibreOuOccupe === "occupe" && (
                        <div className="space-y-2">
                          <Label htmlFor="acte_infoBail">Informations sur le bail</Label>
                          <Input id="acte_infoBail" value={acteVenteData.informationsBail} onChange={(e) => setActeVenteData({...acteVenteData, informationsBail: e.target.value})} />
                        </div>
                      )}
                    </div>

                    {/* Détails d'occupation si occupé */}
                    {acteVenteData.bienLibreOuOccupe === "occupe" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                        <div className="space-y-2 md:col-span-2">
                          <Label htmlFor="acte_locataireNom">Nom du locataire</Label>
                          <Input 
                            id="acte_locataireNom"
                            value={acteVenteData.locataireNom}
                            onChange={(e) => setActeVenteData({...acteVenteData, locataireNom: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dateBail">Date du bail</Label>
                          <Input 
                            id="acte_dateBail"
                            type="date"
                            value={acteVenteData.dateBail}
                            onChange={(e) => setActeVenteData({...acteVenteData, dateBail: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dureeBail">Durée du bail</Label>
                          <Input 
                            id="acte_dureeBail"
                            value={acteVenteData.dureeBail}
                            onChange={(e) => setActeVenteData({...acteVenteData, dureeBail: e.target.value})}
                            placeholder="Ex: 3 ans"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_montantLoyer">Montant du loyer mensuel (€)</Label>
                          <Input 
                            id="acte_montantLoyer"
                            type="number"
                            value={acteVenteData.montantLoyer}
                            onChange={(e) => setActeVenteData({...acteVenteData, montantLoyer: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_depotGarantieLocataire">Dépôt de garantie (€)</Label>
                          <Input 
                            id="acte_depotGarantieLocataire"
                            type="number"
                            value={acteVenteData.depotGarantieLocataire}
                            onChange={(e) => setActeVenteData({...acteVenteData, depotGarantieLocataire: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dateLiberation">Date prévue de libération</Label>
                          <Input 
                            id="acte_dateLiberation"
                            type="date"
                            value={acteVenteData.dateLiberation}
                            onChange={(e) => setActeVenteData({...acteVenteData, dateLiberation: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Bail locatif (PDF)</Label>
                          <button
                            type="button"
                            className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                            onClick={() => document.getElementById('bail-locatif')?.click()}
                          >
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                          </button>
                          <Input id="bail-locatif" type="file" accept=".pdf" className="hidden" />
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* Conditions financières */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">💶 Conditions financières</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_prixVente">Prix de vente (€) *</Label>
                      <Input id="acte_prixVente" type="number" value={acteVenteData.prixVente} onChange={(e) => setActeVenteData({...acteVenteData, prixVente: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_origineFonds">Origine des fonds</Label>
                      <Input id="acte_origineFonds" value={acteVenteData.origineFonds} onChange={(e) => setActeVenteData({...acteVenteData, origineFonds: e.target.value})} placeholder="Épargne / Revente / Prêt" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_depotGarantie">Dépôt de garantie versé (€)</Label>
                      <Input id="acte_depotGarantie" type="number" value={acteVenteData.depotGarantie} onChange={(e) => setActeVenteData({...acteVenteData, depotGarantie: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_fraisNotaire">Frais de notaire estimés (€)</Label>
                      <Input id="acte_fraisNotaire" type="number" value={acteVenteData.fraisNotaire} onChange={(e) => setActeVenteData({...acteVenteData, fraisNotaire: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_repartition">Répartition prorata temporis</Label>
                      <Textarea id="acte_repartition" value={acteVenteData.repartitionProrata} onChange={(e) => setActeVenteData({...acteVenteData, repartitionProrata: e.target.value})} rows={2} placeholder="Taxe foncière, charges, loyers..." />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_modalitesPaiement">Modalités de paiement</Label>
                      <Textarea id="acte_modalitesPaiement" value={acteVenteData.modalitesPaiement} onChange={(e) => setActeVenteData({...acteVenteData, modalitesPaiement: e.target.value})} rows={2} placeholder="Virement notarial / Prêts bancaires" />
                    </div>
                  </div>
                </div>

                {/* Prêt immobilier */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏦 Prêt immobilier</h3>
                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_pretImmobilier">Achat financé par prêt ?</Label>
                      <Select value={acteVenteData.pretImmobilier} onValueChange={(value) => setActeVenteData({...acteVenteData, pretImmobilier: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.pretImmobilier === "oui" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg">
                        <div className="space-y-2">
                          <Label htmlFor="acte_montantPret">Montant du prêt (€) *</Label>
                          <Input id="acte_montantPret" type="number" value={acteVenteData.montantPret} onChange={(e) => setActeVenteData({...acteVenteData, montantPret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_banque">Banque prêteuse *</Label>
                          <Input id="acte_banque" value={acteVenteData.banquePreteur} onChange={(e) => setActeVenteData({...acteVenteData, banquePreteur: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_tauxPret">Taux réel obtenu (%) *</Label>
                          <Input id="acte_tauxPret" type="number" step="0.01" value={acteVenteData.tauxPret} onChange={(e) => setActeVenteData({...acteVenteData, tauxPret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dureePret">Durée du prêt (années) *</Label>
                          <Input id="acte_dureePret" type="number" value={acteVenteData.dureePret} onChange={(e) => setActeVenteData({...acteVenteData, dureePret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_typePret">Type de prêt *</Label>
                          <Input id="acte_typePret" value={acteVenteData.typePret} onChange={(e) => setActeVenteData({...acteVenteData, typePret: e.target.value})} placeholder="Amortissable / Relais / PTZ" />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dateAccordPret">Date accord de prêt *</Label>
                          <Input id="acte_dateAccordPret" type="date" value={acteVenteData.dateAccordPret} onChange={(e) => setActeVenteData({...acteVenteData, dateAccordPret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_tauxMaximal">Taux maximal accepté (%)</Label>
                          <Input 
                            id="acte_tauxMaximal"
                            type="number"
                            step="0.01"
                            value={acteVenteData.tauxMaximal}
                            onChange={(e) => setActeVenteData({...acteVenteData, tauxMaximal: e.target.value})}
                            placeholder="Ex: 4.5"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_conditionSuspensivePret">Condition suspensive de prêt</Label>
                          <Select 
                            value={acteVenteData.conditionSuspensivePret} 
                            onValueChange={(value) => setActeVenteData({...acteVenteData, conditionSuspensivePret: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label htmlFor="acte_conditionsPret">Conditions particulières du prêt</Label>
                          <Textarea id="acte_conditionsPret" value={acteVenteData.conditionsPret} onChange={(e) => setActeVenteData({...acteVenteData, conditionsPret: e.target.value})} rows={2} />
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* Documents et diagnostics */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">📜 Documents & diagnostics obligatoires</h3>
                  
                  {/* Diagnostics - données essentielles */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <div className="space-y-2">
                      <Label htmlFor="acte_dateDPE">Date du DPE</Label>
                      <Input 
                        id="acte_dateDPE"
                        type="date"
                        value={acteVenteData.dateDPE}
                        onChange={(e) => setActeVenteData({...acteVenteData, dateDPE: e.target.value})}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_classeEnergetique">Classe énergétique</Label>
                      <Select 
                        value={acteVenteData.classeEnergetique} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, classeEnergetique: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="A">A</SelectItem>
                          <SelectItem value="B">B</SelectItem>
                          <SelectItem value="C">C</SelectItem>
                          <SelectItem value="D">D</SelectItem>
                          <SelectItem value="E">E</SelectItem>
                          <SelectItem value="F">F</SelectItem>
                          <SelectItem value="G">G</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_presenceAmiante">Présence d'amiante</Label>
                      <Select 
                        value={acteVenteData.presenceAmiante} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, presenceAmiante: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_presencePlomb">Présence de plomb</Label>
                      <Select 
                        value={acteVenteData.presencePlomb} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, presencePlomb: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_presenceTermites">Présence de termites</Label>
                      <Select 
                        value={acteVenteData.presenceTermites} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, presenceTermites: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_assainissementConforme">Assainissement conforme</Label>
                      <Select 
                        value={acteVenteData.assainissementConforme} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, assainissementConforme: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="acte_diagnostics">Autres diagnostics fournis</Label>
                    <Textarea id="acte_diagnostics" value={acteVenteData.diagnosticsFournis} onChange={(e) => setActeVenteData({...acteVenteData, diagnosticsFournis: e.target.value})} rows={3} placeholder="Électricité, Gaz, Loi Carrez, ERP, Audit énergétique..." />
                  </div>
                  <MultiFileUpload
                    label="📎 Joindre les diagnostics et documents obligatoires"
                    files={acteDiagnosticsFiles}
                    onFilesChange={setActeDiagnosticsFiles}
                    accept="application/pdf"
                  />
                </div>

                {/* Déclarations vendeur */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">Déclarations & attestations du vendeur</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_origineDate">Date d'acquisition précédente *</Label>
                      <Input id="acte_origineDate" type="date" value={acteVenteData.origineProprieteDateAcquisition} onChange={(e) => setActeVenteData({...acteVenteData, origineProprieteDateAcquisition: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_origineRef">Référence acte d'acquisition *</Label>
                      <Input id="acte_origineRef" value={acteVenteData.origineReferenceActe} onChange={(e) => setActeVenteData({...acteVenteData, origineReferenceActe: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_travaux">Travaux réalisés (10 dernières années)</Label>
                      <Textarea id="acte_travaux" value={acteVenteData.travauxDerniers10ans} onChange={(e) => setActeVenteData({...acteVenteData, travauxDerniers10ans: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_conformiteUrbanisme">Conformité urbanisme</Label>
                      <Input id="acte_conformiteUrbanisme" value={acteVenteData.conformiteUrbanisme} onChange={(e) => setActeVenteData({...acteVenteData, conformiteUrbanisme: e.target.value})} placeholder="Permis, déclarations..." />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_assuranceDO">Assurance dommage-ouvrage</Label>
                      <Input id="acte_assuranceDO" value={acteVenteData.assuranceDommageOuvrage} onChange={(e) => setActeVenteData({...acteVenteData, assuranceDommageOuvrage: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_taxesFoncieres">Taxes foncières N-1 (€)</Label>
                      <Input id="acte_taxesFoncieres" type="number" value={acteVenteData.taxesFoncieres} onChange={(e) => setActeVenteData({...acteVenteData, taxesFoncieres: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_sinistre">Sinistre récent ?</Label>
                      <Select value={acteVenteData.sinistreRecent} onValueChange={(value) => setActeVenteData({...acteVenteData, sinistreRecent: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Urbanisme */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏛️ Urbanisme</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_zonePLU">Zone PLU / POS</Label>
                      <Input id="acte_zonePLU" value={acteVenteData.zonePLU} onChange={(e) => setActeVenteData({...acteVenteData, zonePLU: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_droitPreemption">Droit de préemption</Label>
                      <Input id="acte_droitPreemption" value={acteVenteData.droitPreemption} onChange={(e) => setActeVenteData({...acteVenteData, droitPreemption: e.target.value})} placeholder="Exercé / Levé + date" />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_declarationsUrbanisme">Déclarations d'urbanisme passées</Label>
                      <Textarea id="acte_declarationsUrbanisme" value={acteVenteData.declarationsUrbanisme} onChange={(e) => setActeVenteData({...acteVenteData, declarationsUrbanisme: e.target.value})} rows={2} placeholder="DP, permis de construire, etc." />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_documentsUrbanisme">Documents d'urbanisme fournis</Label>
                      <Input id="acte_documentsUrbanisme" value={acteVenteData.documentsUrbanisme} onChange={(e) => setActeVenteData({...acteVenteData, documentsUrbanisme: e.target.value})} />
                    </div>
                  </div>

                  {/* DIA - Déclaration d'Intention d'Aliéner */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <div className="space-y-2">
                      <Label htmlFor="acte_dateEnvoiDIA">Date d'envoi de la DIA</Label>
                      <Input 
                        id="acte_dateEnvoiDIA"
                        type="date"
                        value={acteVenteData.dateEnvoiDIA}
                        onChange={(e) => setActeVenteData({...acteVenteData, dateEnvoiDIA: e.target.value})}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_reponseMairieDIA">Réponse de la mairie</Label>
                      <Select 
                        value={acteVenteData.reponseMairieDIA} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, reponseMairieDIA: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non_preemption">Non préemption</SelectItem>
                          <SelectItem value="preemption">Préemption</SelectItem>
                          <SelectItem value="en_attente">En attente</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Délais et signature */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">📅 Délais & modalités de signature</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_dateSignature">Date de signature de l'acte *</Label>
                      <Input id="acte_dateSignature" type="date" value={acteVenteData.dateSignatureActe} onChange={(e) => setActeVenteData({...acteVenteData, dateSignatureActe: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_lieuSignature">Lieu de signature *</Label>
                      <Input id="acte_lieuSignature" value={acteVenteData.lieuSignature} onChange={(e) => setActeVenteData({...acteVenteData, lieuSignature: e.target.value})} placeholder="Étude notariale" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_remiseCles">Remise des clés</Label>
                      <Select value={acteVenteData.remiseCles} onValueChange={(value) => setActeVenteData({...acteVenteData, remiseCles: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="signature">À la signature</SelectItem>
                          <SelectItem value="differee">Différée</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_procuration">Procuration ?</Label>
                      <Select value={acteVenteData.procuration} onValueChange={(value) => setActeVenteData({...acteVenteData, procuration: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.procuration === "oui" && (
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acte_mandataire">Identité du mandataire</Label>
                        <Input id="acte_mandataire" value={acteVenteData.identiteMandataire} onChange={(e) => setActeVenteData({...acteVenteData, identiteMandataire: e.target.value})} />
                      </div>
                    )}
                  </div>

                  {/* Remise des clés anticipée */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h4 className="font-medium">Remise des clés anticipée</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_remiseClesAnticipee">Remise anticipée des clés</Label>
                        <Select 
                          value={acteVenteData.remiseClesAnticipee} 
                          onValueChange={(value) => setActeVenteData({...acteVenteData, remiseClesAnticipee: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {acteVenteData.remiseClesAnticipee === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label htmlFor="acte_dateRemiseAnticipee">Date de remise anticipée</Label>
                            <Input 
                              id="acte_dateRemiseAnticipee"
                              type="date"
                              value={acteVenteData.dateRemiseAnticipee}
                              onChange={(e) => setActeVenteData({...acteVenteData, dateRemiseAnticipee: e.target.value})}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label htmlFor="acte_indemnitéOccupation">Indemnité d'occupation</Label>
                            <Select 
                              value={acteVenteData.indemnitéOccupation} 
                              onValueChange={(value) => setActeVenteData({...acteVenteData, indemnitéOccupation: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="non">Non</SelectItem>
                                <SelectItem value="oui">Oui</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {acteVenteData.indemnitéOccupation === "oui" && (
                            <div className="space-y-2">
                              <Label htmlFor="acte_montantIndemnite">Montant de l'indemnité (€/jour)</Label>
                              <Input 
                                id="acte_montantIndemnite"
                                type="number"
                                value={acteVenteData.montantIndemnite}
                                onChange={(e) => setActeVenteData({...acteVenteData, montantIndemnite: e.target.value})}
                              />
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </div>
                </div>

                {/* Annexes */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🧩 Annexes à joindre</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_titrePropriete">Titre de propriété précédent</Label>
                      <Input id="acte_titrePropriete" value={acteVenteData.titrePropriete} onChange={(e) => setActeVenteData({...acteVenteData, titrePropriete: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_diagnosticsAnnexes">Diagnostics (fichiers)</Label>
                      <Input id="acte_diagnosticsAnnexes" value={acteVenteData.diagnostics} onChange={(e) => setActeVenteData({...acteVenteData, diagnostics: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_plan">Plan du bien</Label>
                      <Input id="acte_plan" value={acteVenteData.planBien} onChange={(e) => setActeVenteData({...acteVenteData, planBien: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_reglementCoproAnnexe">Copie règlement de copropriété</Label>
                      <Input id="acte_reglementCoproAnnexe" value={acteVenteData.reglementCopropriete} onChange={(e) => setActeVenteData({...acteVenteData, reglementCopropriete: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_etatDate">État daté</Label>
                      <Input id="acte_etatDate" value={acteVenteData.etatDate} onChange={(e) => setActeVenteData({...acteVenteData, etatDate: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_attestationAssurance">Attestation d'assurance (PNO)</Label>
                      <Input id="acte_attestationAssurance" value={acteVenteData.attestationAssurance} onChange={(e) => setActeVenteData({...acteVenteData, attestationAssurance: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_releveSyndic">Relevé du syndic</Label>
                      <Input id="acte_releveSyndic" value={acteVenteData.releveSyndic} onChange={(e) => setActeVenteData({...acteVenteData, releveSyndic: e.target.value})} />
                    </div>
                  </div>
                </div>

                {/* Informations complémentaires */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🎯 Informations complémentaires</h3>
                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_travauxPrevus">Travaux prévus par la copropriété</Label>
                      <Textarea id="acte_travauxPrevus" value={acteVenteData.travauxPrevusCopro} onChange={(e) => setActeVenteData({...acteVenteData, travauxPrevusCopro: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_procedures">Procédures en cours</Label>
                      <Textarea id="acte_procedures" value={acteVenteData.proceduresEnCours} onChange={(e) => setActeVenteData({...acteVenteData, proceduresEnCours: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_differends">Différends connus avec un voisin</Label>
                      <Textarea id="acte_differends" value={acteVenteData.differendsVoisins} onChange={(e) => setActeVenteData({...acteVenteData, differendsVoisins: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_particularites">Particularités du bien</Label>
                      <Textarea id="acte_particularites" value={acteVenteData.particularitesBien} onChange={(e) => setActeVenteData({...acteVenteData, particularitesBien: e.target.value})} rows={3} />
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* ========== FORMULAIRE BAIL D'HABITATION - ESPACE AVOCAT ========== */}
            {(pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé") && role === 'avocat' && (
              <>
                {/* Bailleur */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">👤 Bailleur</h3>
                  
                  {/* Sélection du client si bailleur */}
                  {bailHabitationData.clientRole === "bailleur" ? (
                    <div className="space-y-2">
                      <Label>Sélectionner le client bailleur *</Label>
                      <Select 
                        value={bailHabitationData.clientId} 
                        onValueChange={(value) => {
                          const selectedClient = clients.find(c => c.id === value);
                          if (selectedClient) {
                            setBailHabitationData({
                              ...bailHabitationData,
                              clientId: value,
                              bailleurClientId: value,
                              bailleurNom: selectedClient.nom,
                              bailleurPrenom: selectedClient.prenom,
                              bailleurAdresse: selectedClient.adresse || "",
                              bailleurDateNaissance: selectedClient.date_naissance || "",
                              bailleurLieuNaissance: selectedClient.lieu_naissance || "",
                              bailleurNationalite: selectedClient.nationalite || "",
                              bailleurProfession: selectedClient.profession || "",
                              bailleurStatutMatrimonial: selectedClient.statut_matrimonial || "",
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>{client.nom} {client.prenom}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  ) : (
                    <div className="text-sm text-muted-foreground mb-2">
                      Saisir manuellement les informations du bailleur
                    </div>
                  )}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom *</Label>
                      <Input value={bailHabitationData.bailleurNom} onChange={(e) => setBailHabitationData({...bailHabitationData, bailleurNom: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Prénom *</Label>
                      <Input value={bailHabitationData.bailleurPrenom} onChange={(e) => setBailHabitationData({...bailHabitationData, bailleurPrenom: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse *</Label>
                      <Input value={bailHabitationData.bailleurAdresse} onChange={(e) => setBailHabitationData({...bailHabitationData, bailleurAdresse: e.target.value})} />
                    </div>
                  </div>

                  {/* Pièce d'identité du bailleur - chargée depuis client si c'est le client */}
                  {bailHabitationData.clientRole === "bailleur" && bailHabitationData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {bailClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(bailClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="mr-2 h-4 w-4" />
                            Voir
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : bailHabitationData.clientRole === "locataire" && (
                    /* Upload pour bailleur si le client est locataire */
                    <MultiFileUpload
                      label="📎 Pièce d'identité du bailleur"
                      files={bailleurIdFiles}
                      onFilesChange={setBailleurIdFiles}
                      accept="application/pdf,image/*"
                      role="avocat"
                    />
                  )}
                </div>

                {/* Locataire */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">👥 Locataire</h3>
                  
                  {/* Sélection du client si locataire */}
                  {bailHabitationData.clientRole === "locataire" ? (
                    <div className="space-y-2">
                      <Label>Sélectionner le client locataire *</Label>
                      <Select 
                        value={bailHabitationData.clientId} 
                        onValueChange={(value) => {
                          const selectedClient = clients.find(c => c.id === value);
                          if (selectedClient) {
                            setBailHabitationData({
                              ...bailHabitationData,
                              clientId: value,
                              locataireClientId: value,
                              locataireNom: selectedClient.nom,
                              locatairePrenom: selectedClient.prenom,
                              locataireAdresse: selectedClient.adresse || "",
                              locataireDateNaissance: selectedClient.date_naissance || "",
                              locataireLieuNaissance: selectedClient.lieu_naissance || "",
                              locataireNationalite: selectedClient.nationalite || "",
                              locataireProfession: selectedClient.profession || "",
                              locataireStatutMatrimonial: selectedClient.statut_matrimonial || "",
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>{client.nom} {client.prenom}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  ) : (
                    <div className="text-sm text-muted-foreground mb-2">
                      Saisir manuellement les informations du locataire
                    </div>
                  )}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom *</Label>
                      <Input value={bailHabitationData.locataireNom} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireNom: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Prénom *</Label>
                      <Input value={bailHabitationData.locatairePrenom} onChange={(e) => setBailHabitationData({...bailHabitationData, locatairePrenom: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse actuelle *</Label>
                      <Input value={bailHabitationData.locataireAdresse} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireAdresse: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Date de naissance *</Label>
                      <Input type="date" value={bailHabitationData.locataireDateNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireDateNaissance: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Lieu de naissance *</Label>
                      <Input value={bailHabitationData.locataireLieuNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireLieuNaissance: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Profession *</Label>
                      <Input value={bailHabitationData.locataireProfession} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireProfession: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Statut matrimonial *</Label>
                      <Input value={bailHabitationData.locataireStatutMatrimonial} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireStatutMatrimonial: e.target.value})} placeholder="Ex: Célibataire, Marié..." />
                    </div>
                    <div className="space-y-2">
                      <Label>Nombre d'occupants *</Label>
                      <Input type="number" value={bailHabitationData.nombreOccupants} onChange={(e) => setBailHabitationData({...bailHabitationData, nombreOccupants: e.target.value})} />
                    </div>
                  </div>

                  {/* Pièce d'identité du locataire - chargée depuis client si c'est le client */}
                  {bailHabitationData.clientRole === "locataire" && bailHabitationData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {bailClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(bailClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="mr-2 h-4 w-4" />
                            Voir
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : bailHabitationData.clientRole === "bailleur" && (
                    /* Upload section pour documents locataire si le client est bailleur */
                    <MultiFileUpload
                      label="📎 Documents du locataire (pièce d'identité, justificatifs de revenus)"
                      files={locataireIdFiles}
                      onFilesChange={setLocataireIdFiles}
                      accept="application/pdf,image/*"
                      role="avocat"
                    />
                  )}

                  {/* Situation financière du locataire */}
                  <div className="p-4 bg-blue-50 dark:bg-blue-950 rounded-lg space-y-4">
                    <h4 className="font-medium">Situation financière du locataire</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Revenus mensuels nets (€)</Label>
                        <Input 
                          type="number"
                          value={bailHabitationData.locataireRevenusMensuelsNets} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireRevenusMensuelsNets: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Type de contrat de travail</Label>
                        <Select 
                          value={bailHabitationData.locataireTypeContrat} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, locataireTypeContrat: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CDI">CDI</SelectItem>
                            <SelectItem value="CDD">CDD</SelectItem>
                            <SelectItem value="Intérim">Intérim</SelectItem>
                            <SelectItem value="Étudiant">Étudiant</SelectItem>
                            <SelectItem value="Indépendant">Indépendant</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Employeur actuel</Label>
                        <Input 
                          value={bailHabitationData.locataireEmployeur} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireEmployeur: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Adresse de l'employeur</Label>
                        <Input 
                          value={bailHabitationData.locataireEmployeurAdresse} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireEmployeurAdresse: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Ancienneté dans l'emploi</Label>
                        <Input 
                          value={bailHabitationData.locataireAncienneteEmployeur} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireAncienneteEmployeur: e.target.value})} 
                          placeholder="Ex: 2 ans"
                        />
                      </div>
                    </div>
                  </div>

                  {/* Colocation */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h4 className="font-medium">Colocation</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>S'agit-il d'une colocation ?</Label>
                        <Select 
                          value={bailHabitationData.colocation} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, colocation: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Non">Non</SelectItem>
                            <SelectItem value="Oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {bailHabitationData.colocation === "Oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Solidarité entre colocataires ?</Label>
                            <Select 
                              value={bailHabitationData.solidariteColocataires} 
                              onValueChange={(value) => setBailHabitationData({...bailHabitationData, solidariteColocataires: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="Oui">Oui (solidaires)</SelectItem>
                                <SelectItem value="Non">Non (séparés)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2">
                            <Label>Nombre de colocataires</Label>
                            <Input 
                              type="number"
                              value={bailHabitationData.nombreColocataires} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, nombreColocataires: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Noms et prénoms des colocataires</Label>
                            <Textarea 
                              value={bailHabitationData.colocatairesNoms} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, colocatairesNoms: e.target.value})} 
                              placeholder="Ex: Jean Dupont, Marie Martin..."
                              rows={2}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                  
                  <MultiFileUpload
                    label="📎 Documents du locataire (pièce d'identité, justificatifs de revenus)"
                    files={locataireDocsFiles}
                    onFilesChange={setLocataireDocsFiles}
                    accept="application/pdf,image/*"
                    role="avocat"
                  />
                </div>

                {/* Logement */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🏠 Logement</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse complète du logement *</Label>
                      <Input value={bailHabitationData.adresseLogement} onChange={(e) => setBailHabitationData({...bailHabitationData, adresseLogement: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Type de logement *</Label>
                      <Input value={bailHabitationData.typeLogement} onChange={(e) => setBailHabitationData({...bailHabitationData, typeLogement: e.target.value})} placeholder="Ex: T2, Studio, Maison..." />
                    </div>
                    <div className="space-y-2">
                      <Label>Étage / N° appartement</Label>
                      <Input value={bailHabitationData.etageNumeroLot} onChange={(e) => setBailHabitationData({...bailHabitationData, etageNumeroLot: e.target.value})} placeholder="Ex: 3ème étage, Appt 12..." />
                    </div>
                    <div className="space-y-2">
                      <Label>Surface habitable (m²) *</Label>
                      <Input type="number" value={bailHabitationData.surfaceHabitable} onChange={(e) => setBailHabitationData({...bailHabitationData, surfaceHabitable: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Logement en copropriété ? *</Label>
                      <Select value={bailHabitationData.logementCopropriete} onValueChange={(value) => setBailHabitationData({...bailHabitationData, logementCopropriete: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.logementCopropriete === "oui" && (
                      <div className="space-y-2">
                        <Label>Règlement de copropriété fourni ?</Label>
                        <Select value={bailHabitationData.reglementCoproFourni} onValueChange={(value) => setBailHabitationData({...bailHabitationData, reglementCoproFourni: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    )}
                    <div className="space-y-2 md:col-span-2">
                      <Label>Dépendances incluses *</Label>
                      <div className="flex flex-wrap gap-3">
                        {["Cave", "Parking", "Grenier", "Jardin"].map((dep) => (
                          <label key={dep} className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              checked={bailHabitationData.dependances.includes(dep)}
                              onChange={(e) => {
                                if (e.target.checked) {
                                  setBailHabitationData({...bailHabitationData, dependances: [...bailHabitationData.dependances, dep]});
                                } else {
                                  setBailHabitationData({...bailHabitationData, dependances: bailHabitationData.dependances.filter(d => d !== dep)});
                                }
                              }}
                              className="rounded border-gray-300"
                            />
                            <span className="text-sm">{dep}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Détails parking */}
                  {bailHabitationData.dependances.includes("Parking") && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-slate-50 dark:bg-slate-900 rounded-lg">
                      <div className="space-y-2">
                        <Label>Place de parking numérotée ?</Label>
                        <Select 
                          value={bailHabitationData.placeParking} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, placeParking: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Oui">Oui</SelectItem>
                            <SelectItem value="Non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {bailHabitationData.placeParking === "Oui" && (
                        <div className="space-y-2">
                          <Label>Numéro de la place</Label>
                          <Input 
                            value={bailHabitationData.numeroPlaceParking} 
                            onChange={(e) => setBailHabitationData({...bailHabitationData, numeroPlaceParking: e.target.value})} 
                            placeholder="Ex: P12"
                          />
                        </div>
                      )}
                    </div>
                  )}

                  {/* Entretien jardin */}
                  {bailHabitationData.dependances.includes("Jardin") && (
                    <div className="space-y-2 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <Label>Entretien du jardin à la charge de</Label>
                      <Select 
                        value={bailHabitationData.entretienJardin} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, entretienJardin: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Locataire">Locataire</SelectItem>
                          <SelectItem value="Bailleur">Bailleur</SelectItem>
                          <SelectItem value="Partagé">Partagé</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                </div>

                {/* Spécificités du bail meublé */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🛋️ Spécificités du bail meublé</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {/* Type et durée du bail meublé */}
                    <div className="space-y-2">
                      <Label>Type de durée du bail meublé</Label>
                      <Select 
                        value={bailHabitationData.typeDureeMeuble} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeDureeMeuble: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="1an">1 an renouvelable (cas général)</SelectItem>
                          <SelectItem value="9mois">9 mois étudiant (non renouvelable)</SelectItem>
                          <SelectItem value="mobilite">Bail mobilité (1 à 10 mois)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {bailHabitationData.typeDureeMeuble === "mobilite" && (
                          <div className="space-y-2">
                            <Label>Motif du bail mobilité</Label>
                            <Input 
                              value={bailHabitationData.motifBailMobilite} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, motifBailMobilite: e.target.value})} 
                              placeholder="Ex: Stage, études, mission professionnelle..."
                            />
                          </div>
                        )}

                        {/* Inventaire du mobilier */}
                        <div className="md:col-span-2 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg space-y-3">
                          <h4 className="font-medium text-blue-800 dark:text-blue-200">📋 Inventaire complet du mobilier (OBLIGATOIRE LÉGALEMENT)</h4>
                          <div className="space-y-2">
                            <Label>Description détaillée pièce par pièce *</Label>
                            <Textarea 
                              value={bailHabitationData.inventaireMobilierTexte} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, inventaireMobilierTexte: e.target.value})} 
                              placeholder="Ex: Salon: canapé 3 places en tissu gris, table basse en bois, 2 lampes...\nChambre: lit 140x190, matelas, couette, 2 oreillers, armoire 3 portes..."
                              rows={5}
                            />
                          </div>
                          <MultiFileUpload
                            label="Fichier inventaire (PDF ou images)"
                            files={inventaireMobilierFiles}
                            onFilesChange={setInventaireMobilierFiles}
                            accept="application/pdf,image/*"
                            role="avocat"
                          />
                        </div>

                        {/* Liste légale du mobilier minimal (décret 2015-981) */}
                        <div className="md:col-span-2 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg space-y-3">
                          <h4 className="font-medium">✅ Mobilier minimal obligatoire (décret n°2015-981)</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {[
                              { key: 'mobilierLiterie', label: 'Literie + couette ou couverture' },
                              { key: 'mobilierOccultation', label: 'Dispositif d\'occultation des fenêtres' },
                              { key: 'mobilierPlaquesCuisson', label: 'Plaques de cuisson' },
                              { key: 'mobilierFourMicroondes', label: 'Four ou micro-ondes' },
                              { key: 'mobilierRefrigo', label: 'Réfrigérateur' },
                              { key: 'mobilierCongelateur', label: 'Congélateur ou compartiment freezer' },
                              { key: 'mobilierVaisselle', label: 'Vaisselle en quantité suffisante' },
                              { key: 'mobilierUstensiles', label: 'Ustensiles de cuisine' },
                              { key: 'mobilierTable', label: 'Table' },
                              { key: 'mobilierSieges', label: 'Sièges' },
                              { key: 'mobilierEtageres', label: 'Étagères de rangement' },
                              { key: 'mobilierLampes', label: 'Lampes' },
                              { key: 'mobilierMaterielEntretien', label: 'Matériel d\'entretien' },
                            ].map((item) => (
                              <div key={item.key} className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id={item.key}
                                  checked={bailHabitationData[item.key as keyof typeof bailHabitationData] as boolean}
                                  onChange={(e) => setBailHabitationData({...bailHabitationData, [item.key]: e.target.checked})}
                                  className="w-4 h-4"
                                />
                                <Label htmlFor={item.key} className="cursor-pointer text-sm">{item.label}</Label>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* État du mobilier */}
                        <div className="space-y-2 md:col-span-2">
                          <Label>État du mobilier lors de l'entrée</Label>
                          <Textarea 
                            value={bailHabitationData.etatMobilierEntree} 
                            onChange={(e) => setBailHabitationData({...bailHabitationData, etatMobilierEntree: e.target.value})} 
                            placeholder="Description de l'état du mobilier pièce par pièce..."
                            rows={3}
                          />
                        </div>

                        {/* Entretien du mobilier */}
                        <div className="space-y-2">
                          <Label>Entretien du mobilier à la charge de</Label>
                          <Select 
                            value={bailHabitationData.entretienMobilier} 
                            onValueChange={(value) => setBailHabitationData({...bailHabitationData, entretienMobilier: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="Locataire">Locataire</SelectItem>
                              <SelectItem value="Bailleur">Bailleur</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                  </div>
                </div>

                {/* Animaux */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🐾 Animaux domestiques</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Animaux domestiques autorisés ?</Label>
                      <Select 
                        value={bailHabitationData.animauxAutorises} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, animauxAutorises: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Oui">Oui</SelectItem>
                          <SelectItem value="Non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.animauxAutorises === "Oui" && (
                      <div className="space-y-2">
                        <Label>Précisions</Label>
                        <Input 
                          value={bailHabitationData.precisionAnimaux} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, precisionAnimaux: e.target.value})} 
                          placeholder="Ex: petits chiens, chats..."
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* Nature du bailleur et durée */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">⚖️ Nature du bailleur et durée du bail</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nature du bailleur *</Label>
                      <Select value={bailHabitationData.natureBailleur} onValueChange={(value) => setBailHabitationData({...bailHabitationData, natureBailleur: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="physique">Personne physique (3 ans pour bail vide)</SelectItem>
                          <SelectItem value="morale">Personne morale (6 ans pour bail vide)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Résidence principale du locataire ? *</Label>
                      <Select value={bailHabitationData.residencePrincipale} onValueChange={(value) => setBailHabitationData({...bailHabitationData, residencePrincipale: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Garant */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">👥 Garant (si applicable)</h3>
                  <div className="space-y-2">
                    <Label>A-t-il un garant ?</Label>
                    <Select value={bailHabitationData.aGarant} onValueChange={(value) => setBailHabitationData({...bailHabitationData, aGarant: value})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {bailHabitationData.aGarant === "oui" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg">
                      <div className="space-y-2">
                        <Label>Nom du garant *</Label>
                        <Input value={bailHabitationData.garantNom} onChange={(e) => setBailHabitationData({...bailHabitationData, garantNom: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom *</Label>
                        <Input value={bailHabitationData.garantPrenom} onChange={(e) => setBailHabitationData({...bailHabitationData, garantPrenom: e.target.value})} />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse *</Label>
                        <Input value={bailHabitationData.garantAdresse} onChange={(e) => setBailHabitationData({...bailHabitationData, garantAdresse: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de naissance *</Label>
                        <Input type="date" value={bailHabitationData.garantDateNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, garantDateNaissance: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de naissance *</Label>
                        <Input value={bailHabitationData.garantLieuNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, garantLieuNaissance: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Profession *</Label>
                        <Input value={bailHabitationData.garantProfession} onChange={(e) => setBailHabitationData({...bailHabitationData, garantProfession: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Type de caution *</Label>
                        <Select value={bailHabitationData.typeCaution} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeCaution: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="simple">Caution simple</SelectItem>
                            <SelectItem value="solidaire">Caution solidaire</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <MultiFileUpload
                          label="📎 Documents du garant (pièce d'identité, justificatifs de revenus)"
                          files={garantDocsFiles}
                          onFilesChange={setGarantDocsFiles}
                          accept="application/pdf,image/*"
                          role="avocat"
                        />
                      </div>
                    </div>
                  )}
                </div>

                {/* Conditions financières */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">💶 Conditions financières</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Loyer mensuel (€) *</Label>
                      <Input type="number" value={bailHabitationData.loyerMensuel} onChange={(e) => setBailHabitationData({...bailHabitationData, loyerMensuel: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Charges mensuelles (€)</Label>
                      <Input type="number" value={bailHabitationData.chargesMensuelles} onChange={(e) => setBailHabitationData({...bailHabitationData, chargesMensuelles: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Type de charges *</Label>
                      <Select value={bailHabitationData.typeCharges} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeCharges: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="provision">Provision + régularisation annuelle</SelectItem>
                          <SelectItem value="forfait">Forfait</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Dépôt de garantie (€) *</Label>
                      <Input type="number" value={bailHabitationData.depotGarantie} onChange={(e) => setBailHabitationData({...bailHabitationData, depotGarantie: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Révision du loyer prévue ? *</Label>
                      <Select value={bailHabitationData.revisionLoyerPrevue} onValueChange={(value) => setBailHabitationData({...bailHabitationData, revisionLoyerPrevue: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.revisionLoyerPrevue === "oui" && (
                      <div className="space-y-2">
                        <Label>Trimestre de référence IRL *</Label>
                        <Input value={bailHabitationData.trimestreReference} onChange={(e) => setBailHabitationData({...bailHabitationData, trimestreReference: e.target.value})} placeholder="Ex: 2e trimestre 2025" />
                      </div>
                    )}
                    <div className="space-y-2">
                      <Label>Type de bail</Label>
                      <Select value={bailHabitationData.typeBail} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeBail: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="vide">Location vide</SelectItem>
                          <SelectItem value="meuble">Location meublée</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  {/* Mode de paiement */}
                  <div className="p-4 bg-blue-50 dark:bg-blue-950 rounded-lg space-y-4">
                    <h4 className="font-medium">Mode de paiement du loyer</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Mode de paiement choisi</Label>
                        <Select 
                          value={bailHabitationData.modePaiement} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, modePaiement: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Virement">Virement</SelectItem>
                            <SelectItem value="Prélèvement automatique">Prélèvement automatique</SelectItem>
                            <SelectItem value="Chèque">Chèque</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>IBAN du bailleur</Label>
                        <Input 
                          value={bailHabitationData.ibanBailleur} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, ibanBailleur: e.target.value})} 
                          placeholder="FR76..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* Régularisation des charges */}
                  {bailHabitationData.typeCharges === "provision" && (
                    <div className="space-y-2 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <Label>Périodicité de régularisation des charges</Label>
                      <Select 
                        value={bailHabitationData.periodiciteRegularisationCharges} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, periodiciteRegularisationCharges: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Annuelle">Annuelle</SelectItem>
                          <SelectItem value="Semestrielle">Semestrielle</SelectItem>
                          <SelectItem value="Autre">Autre</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                </div>

                {/* Dates */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">📅 Dates du bail</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Date de début du bail *</Label>
                      <Input type="date" value={bailHabitationData.dateDebutBail} onChange={(e) => setBailHabitationData({...bailHabitationData, dateDebutBail: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Durée du bail</Label>
                      <Select value={bailHabitationData.typeBailDuree} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeBailDuree: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="3ans">3 ans (vide)</SelectItem>
                          <SelectItem value="6ans">6 ans (vide - personne morale)</SelectItem>
                          <SelectItem value="1an">1 an (meublé)</SelectItem>
                          <SelectItem value="9mois">9 mois (étudiant)</SelectItem>
                          <SelectItem value="mobilite">Bail mobilité (1 à 10 mois)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Caractéristiques techniques ALUR */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🔌 Caractéristiques techniques (obligatoires ALUR)</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Type de chauffage *</Label>
                      <Select value={bailHabitationData.typeChauffage} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeChauffage: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="electrique">Électrique</SelectItem>
                          <SelectItem value="gaz">Gaz</SelectItem>
                          <SelectItem value="fioul">Fioul</SelectItem>
                          <SelectItem value="collectif">Collectif</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Compteurs individuels ? *</Label>
                      <Select value={bailHabitationData.compteursIndividuels} onValueChange={(value) => setBailHabitationData({...bailHabitationData, compteursIndividuels: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Relevé des compteurs à l'entrée</Label>
                      <Input value={bailHabitationData.releveCompteurs} onChange={(e) => setBailHabitationData({...bailHabitationData, releveCompteurs: e.target.value})} placeholder="Électricité: XX kWh, Eau: XX m3..." />
                    </div>
                  </div>
                </div>

                {/* Travaux récents */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🔨 Travaux effectués</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Travaux réalisés dans les 6 derniers mois ?</Label>
                      <Select 
                        value={bailHabitationData.travauxDerniers6Mois} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, travauxDerniers6Mois: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Non">Non</SelectItem>
                          <SelectItem value="Oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.travauxDerniers6Mois === "Oui" && (
                      <div className="space-y-2 md:col-span-2">
                        <Label>Description des travaux</Label>
                        <Textarea 
                          value={bailHabitationData.descriptionTravaux} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, descriptionTravaux: e.target.value})} 
                          placeholder="Ex: Peinture, rénovation salle de bain, électricité..."
                          rows={3}
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* Diagnostics obligatoires */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">📁 Diagnostics obligatoires</h3>
                  <div className="space-y-2">
                    <Label>Diagnostics fournis ? *</Label>
                    <Select value={bailHabitationData.diagnosticsFournis} onValueChange={(value) => setBailHabitationData({...bailHabitationData, diagnosticsFournis: value})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui - Tous les diagnostics obligatoires sont fournis</SelectItem>
                        <SelectItem value="non">Non - Diagnostics manquants</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="text-sm text-muted-foreground p-3 bg-muted/30 rounded-lg">
                    <p className="font-medium mb-2">Diagnostics obligatoires pour un bail vide :</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li>DPE (Diagnostic de Performance Énergétique)</li>
                      <li>État de l'installation électrique (si + de 15 ans)</li>
                      <li>État de l'installation gaz (si + de 15 ans)</li>
                      <li>ERP (État des Risques et Pollutions)</li>
                      <li>CREP - Plomb (si immeuble avant 1949)</li>
                      <li>Amiante (information obligatoire)</li>
                    </ul>
                  </div>
                  <MultiFileUpload
                    label="📎 Joindre les diagnostics (PDF)"
                    files={bailDiagnosticsFiles}
                    onFilesChange={setBailDiagnosticsFiles}
                    accept="application/pdf"
                    role="avocat"
                  />
                </div>

                {/* État des lieux */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🛠️ État des lieux</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>État des lieux d'entrée fourni ? *</Label>
                      <Select value={bailHabitationData.etatLieuxFourni} onValueChange={(value) => setBailHabitationData({...bailHabitationData, etatLieuxFourni: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non - À établir lors de la remise des clés</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Assurance */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🛡️ Assurance habitation</h3>
                  <div className="space-y-2">
                    <Label>Attestation d'assurance fournie par le locataire ? *</Label>
                    <Select value={bailHabitationData.attestationAssurance} onValueChange={(value) => setBailHabitationData({...bailHabitationData, attestationAssurance: value})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui - Attestation fournie</SelectItem>
                        <SelectItem value="non">Non - À fournir avant la remise des clés</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <p className="text-sm text-muted-foreground">L'assurance habitation est obligatoire pour le locataire avant l'entrée dans les lieux.</p>
                </div>

                {/* Remise des clés */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🔑 Remise des clés et accès</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nombre de jeux de clés remis</Label>
                      <Input 
                        type="number"
                        value={bailHabitationData.nombreJeuxCles} 
                        onChange={(e) => setBailHabitationData({...bailHabitationData, nombreJeuxCles: e.target.value})} 
                        placeholder="Ex: 2"
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Types de clés</Label>
                      <div className="flex flex-wrap gap-3">
                        {[
                          { value: "portes", label: "Portes" },
                          { value: "boites_aux_lettres", label: "Boîtes aux lettres" },
                          { value: "garage", label: "Garage" },
                          { value: "badges", label: "Badges" },
                          { value: "telecommande", label: "Télécommande portail" }
                        ].map((type) => (
                          <label key={type.value} className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              checked={bailHabitationData.typesCles.includes(type.value)}
                              onChange={(e) => {
                                if (e.target.checked) {
                                  setBailHabitationData({
                                    ...bailHabitationData, 
                                    typesCles: [...bailHabitationData.typesCles, type.value]
                                  });
                                } else {
                                  setBailHabitationData({
                                    ...bailHabitationData, 
                                    typesCles: bailHabitationData.typesCles.filter(t => t !== type.value)
                                  });
                                }
                              }}
                              className="rounded border-gray-300"
                            />
                            <span className="text-sm">{type.label}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Codes fournis (optionnel)</Label>
                      <Textarea 
                        value={bailHabitationData.codesFournis} 
                        onChange={(e) => setBailHabitationData({...bailHabitationData, codesFournis: e.target.value})} 
                        rows={2}
                        placeholder="Ex: WIFI, interphone, digicode d'entrée..."
                      />
                    </div>
                  </div>
                </div>

                {/* Informations complémentaires */}
                <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                  <h3 className="font-semibold text-lg border-b pb-2">🎯 Informations complémentaires</h3>
                  <div className="space-y-2">
                    <Label>Précisions, particularités...</Label>
                    <Textarea 
                      value={bailHabitationData.informationsComplementaires} 
                      onChange={(e) => setBailHabitationData({...bailHabitationData, informationsComplementaires: e.target.value})} 
                      rows={4}
                      placeholder="Garant, travaux récents, diagnostics fournis, assurance, etc."
                    />
                  </div>
                </div>
              </>
            )}

            {/* ========== FORMULAIRE BAIL D'HABITATION - ESPACE NOTAIRE ========== */}
            {(pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé") && role === 'notaire' && (
              <>
                <div className="p-3 bg-orange-50 border border-orange-200 rounded-lg mb-4">
                  <p className="text-sm font-medium text-orange-800">🏠 Formulaire Bail d'Habitation - Espace Notaire</p>
                  <p className="text-xs text-orange-600 mt-1">Ce formulaire est indépendant de l'espace avocat</p>
                </div>
                
                {/* Message temporaire */}
                <div className="p-6 bg-muted rounded-lg">
                  <p className="text-sm text-center text-muted-foreground">
                    📝 Formulaire bail d'habitation notaire - Version simplifiée
                  </p>
                  <p className="text-xs text-center text-muted-foreground mt-2">
                    Les champs détaillés seront ajoutés selon vos besoins spécifiques
                  </p>
                </div>
              </>
            )}

            {/* ========== FORMULAIRE BAIL COMMERCIAL - ESPACE AVOCAT ========== */}
            {pendingContractType === "Bail commercial / professionnel" && role === 'avocat' && (
              <>
                <div className="space-y-6">
                  {/* Sélection du type de bail */}
                  <div className="space-y-4 bg-blue-50 dark:bg-blue-950 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg">📋 Type de bail *</h3>
                    <p className="text-sm text-muted-foreground">Commencez par sélectionner le type de bail pour accéder au formulaire complet</p>
                    <div className="space-y-2">
                      <RadioGroup 
                        value={bailCommercialData.typeBail} 
                        onValueChange={(value) => setBailCommercialData({...bailCommercialData, typeBail: value})}
                      >
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="commercial" id="bail_type_commercial_avocat" />
                          <Label htmlFor="bail_type_commercial_avocat" className="cursor-pointer">
                            <span className="font-medium">Bail commercial</span>
                            <span className="text-xs text-muted-foreground ml-2">(statut 3/6/9 - activité commerciale)</span>
                          </Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="professionnel" id="bail_type_professionnel_avocat" />
                          <Label htmlFor="bail_type_professionnel_avocat" className="cursor-pointer">
                            <span className="font-medium">Bail professionnel</span>
                            <span className="text-xs text-muted-foreground ml-2">(profession libérale - min. 6 ans)</span>
                          </Label>
                        </div>
                      </RadioGroup>
                    </div>
                  </div>

                  {/* Bailleur */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🏢 Bailleur</h3>
                    
                    {/* Sélection du client si bailleur */}
                    {bailCommercialData.clientRole === "bailleur" && (
                      <ClientSelector
                        clients={clients}
                        selectedClientId={bailCommercialData.clientId}
                        onClientChange={(clientId) => {
                          if (clientId) {
                            const selectedClient = clients.find(c => c.id === clientId);
                            if (selectedClient) {
                              console.log('🔍 BAILLEUR - Client:', selectedClient);
                              console.log('🔍 BAILLEUR - situation_matrimoniale:', selectedClient.situation_matrimoniale);
                              console.log('🔍 BAILLEUR - situation_familiale:', selectedClient.situation_familiale);
                              
                              let situationFamiliale = "";
                              let regimeMatrimonial = "";
                              
                              // Essayer d'abord situation_matrimoniale
                              if (selectedClient.situation_matrimoniale) {
                                if (typeof selectedClient.situation_matrimoniale === 'object') {
                                  // Cas 1: Objet JSON dans situation_matrimoniale
                                  situationFamiliale = selectedClient.situation_matrimoniale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_matrimoniale.regime_matrimonial || '';
                                  
                                  console.log('🔍 BAILLEUR - Extrait de situation_matrimoniale:', situationFamiliale, regimeMatrimonial);
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_matrimoniale === 'string') {
                                  // Cas 2: Simple chaîne de texte
                                  situationFamiliale = selectedClient.situation_matrimoniale;
                                  console.log('🔍 BAILLEUR - String directe:', situationFamiliale);
                                }
                              }
                              
                              // Si pas trouvé, essayer situation_familiale
                              if (!situationFamiliale && selectedClient.situation_familiale) {
                                if (typeof selectedClient.situation_familiale === 'object') {
                                  // Objet JSON dans situation_familiale
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_familiale.regime_matrimonial || '';
                                  
                                  console.log('🔍 BAILLEUR - Extrait de situation_familiale:', situationFamiliale, regimeMatrimonial);
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  // Simple chaîne
                                  situationFamiliale = selectedClient.situation_familiale;
                                  console.log('🔍 BAILLEUR - String situation_familiale:', situationFamiliale);
                                }
                              }
                              
                              console.log('🔍 BAILLEUR - Valeurs finales:', { situationFamiliale, regimeMatrimonial });
                              
                              setBailCommercialData({
                                ...bailCommercialData,
                                clientId: clientId,
                                bailleurClientId: clientId,
                                statutBailleur: "physique",
                                bailleurNom: selectedClient.nom || "",
                                bailleurPrenom: selectedClient.prenom || "",
                                bailleurAdresse: selectedClient.adresse || "",
                                bailleurDateNaissance: selectedClient.date_naissance || "",
                                bailleurLieuNaissance: selectedClient.lieu_naissance || "",
                                bailleurNationalite: selectedClient.nationalite || "",
                                bailleurSituationFamiliale: situationFamiliale,
                                bailleurRegimeMatrimonial: regimeMatrimonial,
                                bailleurProfession: selectedClient.profession || "",
                              });
                            }
                          } else {
                            setBailCommercialData({
                              ...bailCommercialData,
                              clientId: "",
                              bailleurClientId: "",
                              bailleurNom: "",
                              bailleurPrenom: "",
                              bailleurAdresse: "",
                              bailleurDateNaissance: "",
                              bailleurLieuNaissance: "",
                              bailleurNationalite: "",
                              bailleurSituationFamiliale: "",
                              bailleurRegimeMatrimonial: "",
                              bailleurProfession: "",
                            });
                          }
                        }}
                        label="Sélectionner le client bailleur *"
                        placeholder="Choisir un client"
                      />
                    )}
                    
                    {bailCommercialData.clientRole === "preneur" && (
                      <div className="text-sm text-muted-foreground mb-2">
                        Saisir manuellement les informations du bailleur
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Statut du bailleur *</Label>
                        <Select 
                          value={bailCommercialData.statutBailleur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, statutBailleur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="physique">Personne physique</SelectItem>
                            <SelectItem value="morale">Personne morale (société)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {/* Champs personne physique */}
                    {bailCommercialData.statutBailleur === "physique" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input value={bailCommercialData.bailleurNom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurNom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input value={bailCommercialData.bailleurPrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurPrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Input value={bailCommercialData.bailleurAdresse} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurAdresse: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={bailCommercialData.bailleurDateNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurDateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input value={bailCommercialData.bailleurLieuNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurLieuNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input value={bailCommercialData.bailleurNationalite} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurNationalite: e.target.value})} placeholder="Ex: Française" />
                        </div>
                        <div className="space-y-2">
                          <Label>Situation familiale</Label>
                          <Input value={bailCommercialData.bailleurSituationFamiliale} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSituationFamiliale: e.target.value})} placeholder="Ex: Célibataire, Marié, Divorcé..." />
                        </div>
                        {bailCommercialData.bailleurSituationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => bailCommercialData.bailleurSituationFamiliale.toLowerCase().includes(term)) && (
                          <div className="space-y-2">
                            <Label>Régime matrimonial</Label>
                            <Input value={bailCommercialData.bailleurRegimeMatrimonial} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRegimeMatrimonial: e.target.value})} placeholder="Ex: Communauté légale, Séparation de biens..." />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input value={bailCommercialData.bailleurProfession} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurProfession: e.target.value})} />
                        </div>

                        {/* Upload carte identité bailleur si le client est preneur (avant la fin de la grid) */}
                        {bailCommercialData.clientRole === "preneur" && (
                          <MultiFileUpload
                            label="📎 Pièce d'identité du bailleur"
                            files={bailCommercialBailleurFiles}
                            onFilesChange={setBailCommercialBailleurFiles}
                            accept="application/pdf,image/*"
                            role="avocat"
                          />
                        )}
                      </div>
                    )}

                    {/* Pièce d'identité du bailleur (si client sélectionné) */}
                    {bailCommercialData.clientRole === "bailleur" && bailCommercialData.clientId && (
                      <div className="space-y-2 mt-4">
                        <Label>📎 Pièce d'identité du bailleur</Label>
                        {bailCommercialBailleurClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(bailCommercialBailleurClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}

                    {/* Champs personne morale */}
                    {bailCommercialData.statutBailleur === "morale" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Dénomination sociale *</Label>
                          <Input value={bailCommercialData.bailleurDenomination} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurDenomination: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Forme juridique *</Label>
                          <Select value={bailCommercialData.bailleurFormeJuridique} onValueChange={(value) => setBailCommercialData({...bailCommercialData, bailleurFormeJuridique: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="SAS">SAS</SelectItem>
                              <SelectItem value="SARL">SARL</SelectItem>
                              <SelectItem value="SCI">SCI</SelectItem>
                              <SelectItem value="SA">SA</SelectItem>
                              <SelectItem value="EURL">EURL</SelectItem>
                              <SelectItem value="SASU">SASU</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>SIREN *</Label>
                          <Input value={bailCommercialData.bailleurSiren} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSiren: e.target.value})} placeholder="9 chiffres" />
                        </div>
                        <div className="space-y-2">
                          <Label>SIRET *</Label>
                          <Input value={bailCommercialData.bailleurSiret} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSiret: e.target.value})} placeholder="14 chiffres" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse du siège social *</Label>
                          <Input value={bailCommercialData.bailleurSiegeSocial} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSiegeSocial: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Capital social</Label>
                          <Input value={bailCommercialData.bailleurCapitalSocial} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurCapitalSocial: e.target.value})} placeholder="Ex: 10000 €" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-4">Représentant légal</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du représentant *</Label>
                          <Input value={bailCommercialData.bailleurRepresentant} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRepresentant: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du représentant *</Label>
                          <Input value={bailCommercialData.bailleurRepresentantPrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRepresentantPrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Fonction *</Label>
                          <Input value={bailCommercialData.bailleurRepresentantFonction} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRepresentantFonction: e.target.value})} placeholder="Ex: Gérant, Président..." />
                        </div>
                        <div className="space-y-2">
                          <Label>Le signataire est-il le représentant légal ? *</Label>
                          <Select value={bailCommercialData.bailleurRepresentantEstLegal} onValueChange={(value) => setBailCommercialData({...bailCommercialData, bailleurRepresentantEstLegal: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non (mandataire)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {bailCommercialData.bailleurRepresentantEstLegal === "non" && (
                          <>
                            <div className="space-y-2 md:col-span-2">
                              <h4 className="font-medium text-sm mt-2">Mandataire</h4>
                            </div>
                            <div className="space-y-2">
                              <Label>Nom du mandataire *</Label>
                              <Input value={bailCommercialData.bailleurMandataireNom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurMandataireNom: e.target.value})} />
                            </div>
                            <div className="space-y-2">
                              <Label>Prénom du mandataire *</Label>
                              <Input value={bailCommercialData.bailleurMandatairePrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurMandatairePrenom: e.target.value})} />
                            </div>
                            <div className="space-y-2 md:col-span-2">
                              <Label>Type de pouvoir *</Label>
                              <Input value={bailCommercialData.bailleurMandataireTypePouvoir} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurMandataireTypePouvoir: e.target.value})} placeholder="Ex: Procuration spéciale..." />
                            </div>
                          </>
                        )}
                      </div>
                    )}
                  </div>

                  {/* Local commercial */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🏪 Local commercial</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète du local *</Label>
                        <Input 
                          value={bailCommercialData.adresseLocal} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, adresseLocal: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Nature du local *</Label>
                        <Select 
                          value={bailCommercialData.natureLocal} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, natureLocal: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="boutique">Boutique</SelectItem>
                            <SelectItem value="bureaux">Bureaux</SelectItem>
                            <SelectItem value="restaurant">Restaurant</SelectItem>
                            <SelectItem value="entrepot">Entrepôt</SelectItem>
                            <SelectItem value="atelier">Atelier</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Surface totale (m²) *</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.surfaceTotale} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, surfaceTotale: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* Preneur (Locataire) */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🏢 Preneur (Locataire)</h3>
                    
                    {/* Sélection du client si preneur */}
                    {bailCommercialData.clientRole === "preneur" && (
                      <ClientSelector
                        clients={clients}
                        selectedClientId={bailCommercialData.clientId}
                        onClientChange={(clientId) => {
                          if (clientId) {
                            const selectedClient = clients.find(c => c.id === clientId);
                            if (selectedClient) {
                              let situationFamiliale = "";
                              let regimeMatrimonial = "";
                              
                              // Essayer d'abord situation_matrimoniale
                              if (selectedClient.situation_matrimoniale) {
                                if (typeof selectedClient.situation_matrimoniale === 'object') {
                                  // Cas 1: Objet JSON dans situation_matrimoniale
                                  situationFamiliale = selectedClient.situation_matrimoniale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_matrimoniale.regime_matrimonial || '';
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_matrimoniale === 'string') {
                                  // Cas 2: Simple chaîne de texte
                                  situationFamiliale = selectedClient.situation_matrimoniale;
                                }
                              }
                              
                              // Si pas trouvé, essayer situation_familiale
                              if (!situationFamiliale && selectedClient.situation_familiale) {
                                if (typeof selectedClient.situation_familiale === 'object') {
                                  // Objet JSON dans situation_familiale
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_familiale.regime_matrimonial || '';
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  // Simple chaîne
                                  situationFamiliale = selectedClient.situation_familiale;
                                }
                              }
                              
                              setBailCommercialData({
                                ...bailCommercialData,
                                clientId: clientId,
                                locataireClientId: clientId,
                                statutLocataire: "physique",
                                locataireNom: selectedClient.nom || "",
                                locatairePrenom: selectedClient.prenom || "",
                                locataireAdresse: selectedClient.adresse || "",
                                locataireDateNaissance: selectedClient.date_naissance || "",
                                locataireLieuNaissance: selectedClient.lieu_naissance || "",
                                locataireNationalite: selectedClient.nationalite || "",
                                locataireSituationFamiliale: situationFamiliale,
                                locataireRegimeMatrimonial: regimeMatrimonial,
                                locataireProfession: selectedClient.profession || "",
                                locataireTelephone: selectedClient.telephone || "",
                                locataireEmail: selectedClient.email || "",
                              });
                            }
                          } else {
                            setBailCommercialData({
                              ...bailCommercialData,
                              clientId: "",
                              locataireClientId: "",
                              locataireNom: "",
                              locatairePrenom: "",
                              locataireAdresse: "",
                              locataireDateNaissance: "",
                              locataireLieuNaissance: "",
                              locataireNationalite: "",
                              locataireSituationFamiliale: "",
                              locataireRegimeMatrimonial: "",
                              locataireProfession: "",
                              locataireTelephone: "",
                              locataireEmail: "",
                            });
                          }
                        }}
                        label="Sélectionner le client preneur *"
                        placeholder="Choisir un client"
                      />
                    )}
                    
                    {bailCommercialData.clientRole === "bailleur" && (
                      <div className="text-sm text-muted-foreground mb-2">
                        Saisir manuellement les informations du preneur
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Statut du preneur *</Label>
                        <Select 
                          value={bailCommercialData.statutLocataire} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, statutLocataire: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="physique">Personne physique</SelectItem>
                            <SelectItem value="morale">Personne morale (société)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {/* Champs personne physique */}
                    {bailCommercialData.statutLocataire === "physique" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input value={bailCommercialData.locataireNom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireNom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input value={bailCommercialData.locatairePrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, locatairePrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse actuelle *</Label>
                          <Input value={bailCommercialData.locataireAdresse} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireAdresse: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={bailCommercialData.locataireDateNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireDateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input value={bailCommercialData.locataireLieuNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireLieuNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input value={bailCommercialData.locataireNationalite} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireNationalite: e.target.value})} placeholder="Ex: Française" />
                        </div>
                        <div className="space-y-2">
                          <Label>Situation familiale</Label>
                          <Input value={bailCommercialData.locataireSituationFamiliale} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSituationFamiliale: e.target.value})} placeholder="Ex: Célibataire, Marié, Divorcé..." />
                        </div>
                        {bailCommercialData.locataireSituationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => bailCommercialData.locataireSituationFamiliale.toLowerCase().includes(term)) && (
                          <div className="space-y-2">
                            <Label>Régime matrimonial</Label>
                            <Input value={bailCommercialData.locataireRegimeMatrimonial} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRegimeMatrimonial: e.target.value})} placeholder="Ex: Communauté légale, Séparation de biens..." />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Profession *</Label>
                          <Input value={bailCommercialData.locataireProfession} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireProfession: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone *</Label>
                          <Input value={bailCommercialData.locataireTelephone} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireTelephone: e.target.value})} placeholder="06 XX XX XX XX" />
                        </div>

                        {/* Upload carte identité preneur si le client est bailleur (avant Email) */}
                        {bailCommercialData.clientRole === "bailleur" && (
                          <MultiFileUpload
                            label="📎 Pièce d'identité du preneur"
                            files={bailCommercialLocataireFiles}
                            onFilesChange={setBailCommercialLocataireFiles}
                            accept="application/pdf,image/*"
                            role="avocat"
                          />
                        )}

                        <div className="space-y-2 md:col-span-2">
                          <Label>Email *</Label>
                          <Input type="email" value={bailCommercialData.locataireEmail} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireEmail: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-4">Activité professionnelle</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Exerce en nom propre ou sous EI ? *</Label>
                          <Select value={bailCommercialData.locataireExerceEnNomPropre} onValueChange={(value) => setBailCommercialData({...bailCommercialData, locataireExerceEnNomPropre: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="nom_propre">Nom propre</SelectItem>
                              <SelectItem value="ei">EI</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Intitulé de l'activité exercée *</Label>
                          <Input value={bailCommercialData.locataireActivite} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireActivite: e.target.value})} placeholder="Ex: Commerce de détail, Artisan..." />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéro SIREN</Label>
                          <Input value={bailCommercialData.locataireSirenPersonnel} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSirenPersonnel: e.target.value})} placeholder="Si existant" />
                        </div>
                        <div className="space-y-2">
                          <Label>Entreprise en cours de création ? *</Label>
                          <Select value={bailCommercialData.locataireEntrepriseEnCreation} onValueChange={(value) => setBailCommercialData({...bailCommercialData, locataireEntrepriseEnCreation: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                    )}

                    {/* Pièce d'identité du preneur (si client sélectionné) */}
                    {bailCommercialData.clientRole === "preneur" && bailCommercialData.clientId && bailCommercialData.statutLocataire === "physique" && (
                      <div className="space-y-2 mt-4">
                        <Label>📎 Pièce d'identité du preneur</Label>
                        {bailCommercialPreneurClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(bailCommercialPreneurClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}

                    {/* Upload carte identité pour l'autre partie (bailleur qui n'est pas client) - déplacé ailleurs */}

                    {/* Champs personne morale */}
                    {bailCommercialData.statutLocataire === "morale" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Dénomination sociale *</Label>
                          <Input value={bailCommercialData.locataireDenomination} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireDenomination: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Forme juridique *</Label>
                          <Select value={bailCommercialData.locataireFormeJuridique} onValueChange={(value) => setBailCommercialData({...bailCommercialData, locataireFormeJuridique: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="SAS">SAS</SelectItem>
                              <SelectItem value="SARL">SARL</SelectItem>
                              <SelectItem value="SCI">SCI</SelectItem>
                              <SelectItem value="SA">SA</SelectItem>
                              <SelectItem value="EURL">EURL</SelectItem>
                              <SelectItem value="SASU">SASU</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>SIREN *</Label>
                          <Input value={bailCommercialData.locataireSiren} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSiren: e.target.value})} placeholder="9 chiffres" />
                        </div>
                        <div className="space-y-2">
                          <Label>SIRET *</Label>
                          <Input value={bailCommercialData.locataireSiret} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSiret: e.target.value})} placeholder="14 chiffres" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse du siège social *</Label>
                          <Input value={bailCommercialData.locataireSiege} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSiege: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Objet social *</Label>
                          <Input value={bailCommercialData.locataireObjetSocial} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireObjetSocial: e.target.value})} placeholder="Pour vérifier compatibilité" />
                        </div>
                        <div className="space-y-2">
                          <Label>Capital social</Label>
                          <Input value={bailCommercialData.locataireCapital} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireCapital: e.target.value})} placeholder="Ex: 5000 €" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-4">Représentant légal</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du représentant *</Label>
                          <Input value={bailCommercialData.locataireRepresentant} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRepresentant: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du représentant *</Label>
                          <Input value={bailCommercialData.locataireRepresentantPrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRepresentantPrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Fonction *</Label>
                          <Input value={bailCommercialData.locataireRepresentantFonction} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRepresentantFonction: e.target.value})} placeholder="Ex: Gérant, Président..." />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-2">Mandataire (si différent du représentant)</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du mandataire</Label>
                          <Input value={bailCommercialData.locataireMandataireNom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireMandataireNom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du mandataire</Label>
                          <Input value={bailCommercialData.locataireMandatairePrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireMandatairePrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Type de pouvoir</Label>
                          <Input value={bailCommercialData.locataireMandataireTypePouvoir} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireMandataireTypePouvoir: e.target.value})} placeholder="Ex: Procuration..." />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Activité */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">💼 Activité</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Activité principale autorisée *</Label>
                        <Input 
                          value={bailCommercialData.activitePrincipale} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, activitePrincipale: e.target.value})} 
                          placeholder="Ex: Commerce de détail, Restauration, Cabinet médical..."
                        />
                      </div>

                      {/* COMMERCIAL UNIQUEMENT - 1. Destination des lieux */}
                      {bailCommercialData.typeBail === "commercial" && (
                        <>
                          <div className="space-y-2">
                            <Label>Destination contractuelle précise *</Label>
                            <Textarea 
                              value={bailCommercialData.destinationContractuelle} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, destinationContractuelle: e.target.value})} 
                              placeholder="Ex: Vente et préparation de produits alimentaires à consommer sur place ou à emporter"
                              rows={3}
                            />
                            <p className="text-xs text-muted-foreground">Décrivez précisément les activités autorisées</p>
                          </div>

                          <div className="space-y-2">
                            <Label>Exclusivités éventuelles</Label>
                            <Textarea 
                              value={bailCommercialData.exclusivitesEventuelles} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, exclusivitesEventuelles: e.target.value})} 
                              placeholder="Ex: Exclusivité de vente de produits bio dans l'immeuble"
                              rows={2}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Interdictions d'usage</Label>
                            <Textarea 
                              value={bailCommercialData.interdictionsUsage} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, interdictionsUsage: e.target.value})} 
                              placeholder="Ex: À l'exclusion de toute activité bruyante ou nuisible"
                              rows={2}
                            />
                          </div>
                        </>
                      )}

                      {/* PROFESSIONNEL UNIQUEMENT - Type de profession */}
                      {bailCommercialData.typeBail === "professionnel" && (
                        <>
                          <div className="space-y-2">
                            <Label>Type de profession *</Label>
                            <Select 
                              value={bailCommercialData.typeProfession} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, typeProfession: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="libérale_reglementee">Profession libérale réglementée (médecin, avocat, architecte...)</SelectItem>
                                <SelectItem value="libérale_non_reglementee">Profession libérale non réglementée (consultant, coach...)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {bailCommercialData.typeProfession === "libérale_reglementee" && (
                            <>
                              <div className="space-y-2">
                                <Label>Numéro d'ordre professionnel *</Label>
                                <Input 
                                  value={bailCommercialData.numeroOrdreProfessionnel} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, numeroOrdreProfessionnel: e.target.value})} 
                                  placeholder="Ex: Numéro RPPS, numéro d'inscription au barreau..."
                                />
                              </div>

                              <MultiFileUpload
                                label="📎 Attestation d'inscription à l'ordre"
                                files={bailProfessionnelOrdreFiles}
                                onFilesChange={setBailProfessionnelOrdreFiles}
                                accept="application/pdf"
                                role="avocat"
                              />
                            </>
                          )}
                        </>
                      )}
                    </div>
                  </div>

                  {/* Conditions financières */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">💶 Conditions financières</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Loyer mensuel HT (€) *</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.loyerMensuelHT} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, loyerMensuelHT: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Charges mensuelles (€) *</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.chargesMensuelles} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, chargesMensuelles: e.target.value})} 
                        />
                      </div>

                      {/* 2. Clause de révision du loyer */}
                      <div className="space-y-2 md:col-span-2 mt-4">
                        <h4 className="font-medium">Révision du loyer</h4>
                      </div>
                      
                      {bailCommercialData.typeBail === "commercial" ? (
                        <>
                          <div className="space-y-2">
                            <Label>Indice applicable *</Label>
                            <Select 
                              value={bailCommercialData.indiceApplicable} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, indiceApplicable: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="ILC">ILC (Indice des Loyers Commerciaux)</SelectItem>
                                <SelectItem value="ILAT">ILAT (Indice des Loyers des Activités Tertiaires)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2">
                            <Label>Base de calcul de l'indice</Label>
                            <Input 
                              value={bailCommercialData.baseCalculIndice} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, baseCalculIndice: e.target.value})} 
                              placeholder="Ex: Indice du 1er trimestre 2025"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Modalité de révision *</Label>
                            <Select 
                              value={bailCommercialData.modaliteRevision} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, modaliteRevision: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="annuelle">Annuelle</SelectItem>
                                <SelectItem value="triennale">Triennale</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                        </>
                      ) : (
                        <>
                          {/* PROFESSIONNEL - Révision via IRL uniquement */}
                          <div className="space-y-2 md:col-span-2">
                            <p className="text-sm text-muted-foreground">
                              Pour un bail professionnel : révision annuelle via IRL (Indice de Référence des Loyers)
                            </p>
                          </div>
                          <div className="space-y-2">
                            <Label>Base de calcul de l'indice IRL</Label>
                            <Input 
                              value={bailCommercialData.baseCalculIndice} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, baseCalculIndice: e.target.value})} 
                              placeholder="Ex: IRL du 1er trimestre 2025"
                            />
                          </div>
                        </>
                      )}

                      {/* 7. Charges récupérables */}
                      <div className="space-y-2">
                        <Label>Mode de règlement des charges *</Label>
                        <Select 
                          value={bailCommercialData.modeReglementCharges} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, modeReglementCharges: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="forfait">Forfait</SelectItem>
                            <SelectItem value="provision">Provision avec régularisation</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* 3. Dépôt de garantie */}
                      <div className="space-y-2 md:col-span-2 mt-4">
                        <h4 className="font-medium">Dépôt de garantie</h4>
                      </div>
                      <div className="space-y-2">
                        <Label>Montant du dépôt de garantie (€)</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.montantDepotGarantie} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, montantDepotGarantie: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Modalités de restitution</Label>
                        <Input 
                          value={bailCommercialData.restitutionDepot} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, restitutionDepot: e.target.value})} 
                          placeholder="Ex: Dans les 30 jours suivant la restitution des lieux"
                        />
                      </div>
                    </div>
                  </div>

                  {/* Durée */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📅 Durée du bail</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {bailCommercialData.typeBail === "commercial" ? (
                        <div className="space-y-2">
                          <Label>Type de bail *</Label>
                          <Select 
                            value={bailCommercialData.dureeBail} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, dureeBail: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="3-6-9">Bail commercial 3/6/9</SelectItem>
                              <SelectItem value="derogatoire">Bail dérogatoire (≤ 3 ans)</SelectItem>
                              <SelectItem value="saisonnier">Bail saisonnier</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      ) : (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Durée du bail professionnel</Label>
                          <p className="text-sm text-muted-foreground">Durée minimum de 6 ans avec possibilité de résiliation triennale</p>
                          <Input 
                            type="number"
                            value={bailCommercialData.dureeBail || "6"} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, dureeBail: e.target.value})}
                            placeholder="6"
                            min="6"
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Date de prise d'effet *</Label>
                        <Input 
                          type="date"
                          value={bailCommercialData.datePriseEffet} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, datePriseEffet: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4. Travaux et réparations (COMMERCIAL UNIQUEMENT) */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">🔧 Travaux et réparations</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Travaux à la charge du bailleur</Label>
                          <Textarea 
                            value={bailCommercialData.travauxChargeBailleur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, travauxChargeBailleur: e.target.value})} 
                            placeholder="Ex: Gros œuvre, ravalement, toiture, structure..."
                            rows={3}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Travaux à la charge du preneur</Label>
                          <Textarea 
                            value={bailCommercialData.travauxChargePreneur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, travauxChargePreneur: e.target.value})} 
                            placeholder="Ex: Entretien courant, réparations locatives, aménagements intérieurs..."
                            rows={3}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Charges supportées par le bailleur</Label>
                          <Textarea 
                            value={bailCommercialData.chargesSupporteesBailleur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, chargesSupporteesBailleur: e.target.value})} 
                            placeholder="Ex: Taxe foncière, gros entretien..."
                            rows={2}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Charges supportées par le preneur</Label>
                          <Textarea 
                            value={bailCommercialData.chargesSupporteesPreneur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, chargesSupporteesPreneur: e.target.value})} 
                            placeholder="Ex: Eau, électricité, chauffage, taxe ordures ménagères..."
                            rows={2}
                        />
                      </div>
                    </div>
                  </div>
                  )}

                  {/* 5. Impôts et taxes (COMMERCIAL UNIQUEMENT) */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">💰 Impôts et taxes</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Taxe foncière supportée par *</Label>
                          <Select 
                            value={bailCommercialData.taxeFonciereSupporteePar} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, taxeFonciereSupporteePar: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="bailleur">Bailleur</SelectItem>
                              <SelectItem value="locataire">Locataire</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Taxes et contributions récupérables</Label>
                          <Textarea 
                            value={bailCommercialData.taxesRecuperables} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, taxesRecuperables: e.target.value})} 
                            placeholder="Ex: TEOM, CFE..."
                            rows={2}
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 6. État des lieux */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 État des lieux</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>État des lieux d'entrée réalisé ? *</Label>
                        <Select 
                          value={bailCommercialData.etatLieuxRealise} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, etatLieuxRealise: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.etatLieuxRealise === "oui" && (
                        <MultiFileUpload
                          label="📎 État des lieux (PDF)"
                          files={bailCommercialEtatLieuxFiles}
                          onFilesChange={setBailCommercialEtatLieuxFiles}
                          accept="application/pdf"
                          role="avocat"
                        />
                      )}
                    </div>
                  </div>

                  {/* 8. Sous-location & cession (COMMERCIAL UNIQUEMENT) */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">📄 Sous-location & Cession</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Sous-location autorisée ? *</Label>
                          <Select 
                            value={bailCommercialData.souslocationAutorisee} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, souslocationAutorisee: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {bailCommercialData.souslocationAutorisee === "oui" && (
                          <div className="space-y-2">
                            <Label>Conditions de sous-location</Label>
                            <Input 
                              value={bailCommercialData.souslocationConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, souslocationConditions: e.target.value})} 
                              placeholder="Ex: Avec accord préalable du bailleur"
                            />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Cession du bail autorisée ? *</Label>
                          <Select 
                            value={bailCommercialData.cessionBailAutorisee} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, cessionBailAutorisee: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {bailCommercialData.cessionBailAutorisee === "oui" && (
                          <div className="space-y-2">
                            <Label>Conditions de cession</Label>
                            <Input 
                              value={bailCommercialData.cessionConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, cessionConditions: e.target.value})} 
                              placeholder="Ex: Agrément du bailleur requis"
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 9. Garanties */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🛡️ Garanties</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Caution personnelle ? *</Label>
                        <Select 
                          value={bailCommercialData.cautionPersonnelleOuiNon} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, cautionPersonnelleOuiNon: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.cautionPersonnelleOuiNon === "oui" && (
                        <>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom de la caution *</Label>
                              <Input 
                                value={bailCommercialData.nomCaution} 
                                onChange={(e) => setBailCommercialData({...bailCommercialData, nomCaution: e.target.value})} 
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Prénom de la caution *</Label>
                              <Input 
                                value={bailCommercialData.prenomCaution} 
                                onChange={(e) => setBailCommercialData({...bailCommercialData, prenomCaution: e.target.value})} 
                              />
                            </div>
                          </div>
                          <div className="space-y-2">
                            <Label>Montant garanti (€)</Label>
                            <Input 
                              type="number"
                              value={bailCommercialData.montantGaranti} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, montantGaranti: e.target.value})} 
                            />
                          </div>

                          <MultiFileUpload
                            label="📎 Pièce d'identité de la caution"
                            files={bailCommercialCautionIdFiles}
                            onFilesChange={setBailCommercialCautionIdFiles}
                            accept="application/pdf,image/*"
                            role="avocat"
                          />
                        </>
                      )}
                    </div>
                  </div>

                  {/* 10. Assurance obligatoire */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🏥 Assurance obligatoire</h3>
                    <div className="grid grid-cols-1 gap-4">
                      {bailCommercialData.typeBail === "commercial" ? (
                        <>
                          {/* COMMERCIAL - Assurance multirisque professionnelle */}
                          <div className="space-y-2">
                            <Label>Assurance multirisque professionnelle souscrite ? *</Label>
                            <Select 
                              value={bailCommercialData.assuranceMultirisqueSouscrite} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, assuranceMultirisqueSouscrite: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui</SelectItem>
                                <SelectItem value="non">Non (à souscrire avant entrée)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {bailCommercialData.assuranceMultirisqueSouscrite === "oui" && (
                            <>
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-2">
                                  <Label>Nom de l'assureur</Label>
                                  <Input 
                                    value={bailCommercialData.nomAssureur} 
                                    onChange={(e) => setBailCommercialData({...bailCommercialData, nomAssureur: e.target.value})} 
                                    placeholder="Ex: AXA, Allianz..."
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Numéro de police</Label>
                                  <Input 
                                    value={bailCommercialData.numeropolice} 
                                    onChange={(e) => setBailCommercialData({...bailCommercialData, numeropolice: e.target.value})} 
                                  />
                                </div>
                              </div>

                              <MultiFileUpload
                                label="📎 Attestation d'assurance"
                                files={bailCommercialAssuranceFiles}
                                onFilesChange={setBailCommercialAssuranceFiles}
                                accept="application/pdf"
                                role="avocat"
                              />
                            </>
                          )}
                        </>
                      ) : (
                        <>
                          {/* PROFESSIONNEL - RC Pro + Assurance locaux */}
                          <div className="space-y-2 md:col-span-2">
                            <p className="text-sm text-muted-foreground">
                              Pour un bail professionnel : obligation d'assurer la RC professionnelle et les locaux
                            </p>
                          </div>

                          <div className="space-y-2">
                            <Label>Assurance RC Professionnelle souscrite ? *</Label>
                            <Select 
                              value={bailCommercialData.assuranceRCPro} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, assuranceRCPro: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui</SelectItem>
                                <SelectItem value="non">Non (à souscrire avant entrée)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Assurance des locaux souscrite ? *</Label>
                            <Select 
                              value={bailCommercialData.assuranceLocaux} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, assuranceLocaux: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui</SelectItem>
                                <SelectItem value="non">Non (à souscrire avant entrée)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {(bailCommercialData.assuranceRCPro === "oui" || bailCommercialData.assuranceLocaux === "oui") && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2">
                              <div className="space-y-2">
                                <Label>Nom de l'assureur</Label>
                                <Input 
                                  value={bailCommercialData.nomAssureur} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, nomAssureur: e.target.value})} 
                                  placeholder="Ex: AXA, Allianz..."
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Numéro de police</Label>
                                <Input 
                                  value={bailCommercialData.numeropolice} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, numeropolice: e.target.value})} 
                                />
                              </div>
                            </div>
                          )}

                          {(bailCommercialData.assuranceRCPro === "oui" || bailCommercialData.assuranceLocaux === "oui") && (
                            <MultiFileUpload
                              label="📎 Attestations d'assurance"
                              files={bailCommercialAssuranceFiles}
                              onFilesChange={setBailCommercialAssuranceFiles}
                              accept="application/pdf"
                              role="avocat"
                            />
                          )}
                        </>
                      )}
                    </div>
                  </div>

                  {/* ========== 1️⃣ RENOUVELLEMENT & FIN DU BAIL ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🔁 Renouvellement & Fin du bail</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Bloc fondamental en contentieux</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Droit au renouvellement *</Label>
                        <Select 
                          value={bailCommercialData.droitRenouvellement} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, droitRenouvellement: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (droit légal)</SelectItem>
                            <SelectItem value="non">Non (bail dérogatoire ou renonciation)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Modalités de congé *</Label>
                        <Select 
                          value={bailCommercialData.modaliteConge} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, modaliteConge: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="rar">Lettre recommandée avec AR</SelectItem>
                            <SelectItem value="huissier">Acte d'huissier</SelectItem>
                            <SelectItem value="rar_ou_huissier">RAR ou acte d'huissier</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Délai de congé *</Label>
                        <Input 
                          value={bailCommercialData.delaiConge} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, delaiConge: e.target.value})} 
                          placeholder="Ex: 6 mois avant échéance"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Acte d'huissier obligatoire ?</Label>
                        <Select 
                          value={bailCommercialData.acteHuissierObligatoire} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, acteHuissierObligatoire: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Indemnité d'éviction *</Label>
                        <Select 
                          value={bailCommercialData.indemniteEviction} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, indemniteEviction: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (droit légal)</SelectItem>
                            <SelectItem value="exclusion">Exclusion (bail dérogatoire)</SelectItem>
                            <SelectItem value="amenagement">Aménagement conventionnel</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.indemniteEviction === "amenagement" && (
                        <>
                          <div className="space-y-2">
                            <Label>Montant de l'indemnité</Label>
                            <Input 
                              value={bailCommercialData.indemniteEvictionMontant} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, indemniteEvictionMontant: e.target.value})} 
                              placeholder="Montant en €"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Conditions particulières</Label>
                            <Input 
                              value={bailCommercialData.indemniteEvictionConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, indemniteEvictionConditions: e.target.value})} 
                              placeholder="Préciser les conditions"
                            />
                          </div>
                        </>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Renonciation éventuelle du preneur</Label>
                        <Select 
                          value={bailCommercialData.renonciationPreneur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, renonciationPreneur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (⚠️ doit être encadrée)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.renonciationPreneur === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Encadrement de la renonciation</Label>
                          <Textarea 
                            value={bailCommercialData.renonciationPreneurEncadrement} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, renonciationPreneurEncadrement: e.target.value})} 
                            placeholder="Décrire les conditions et limites de la renonciation..."
                            rows={3}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* ========== 2️⃣ PLAFONNEMENT / DÉPLAFONNEMENT ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📈 Plafonnement / Déplafonnement du loyer</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Très important pour investisseurs / centres-villes</p>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Principe de plafonnement du loyer *</Label>
                        <Select 
                          value={bailCommercialData.plafonnementLoyer} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, plafonnementLoyer: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (principe légal)</SelectItem>
                            <SelectItem value="non">Non (dérogation conventionnelle)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Description du principe de plafonnement</Label>
                        <Textarea 
                          value={bailCommercialData.plafonnementPrincipe} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, plafonnementPrincipe: e.target.value})} 
                          placeholder="Ex: Limitation de l'augmentation du loyer selon l'indice ILC..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Déplafonnement autorisé ? *</Label>
                        <Select 
                          value={bailCommercialData.deplafonnementAutorise} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, deplafonnementAutorise: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (cas légaux)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.deplafonnementAutorise === "oui" && (
                        <>
                          <div className="space-y-3 p-3 bg-white dark:bg-slate-900 rounded border">
                            <h4 className="font-medium text-sm">Cas de déplafonnement :</h4>
                            
                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="deplafo_destination"
                                checked={bailCommercialData.deplafonnementModificationDestination === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  deplafonnementModificationDestination: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="deplafo_destination" className="cursor-pointer font-normal">
                                Modification notable de la destination
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="deplafo_facteurs"
                                checked={bailCommercialData.deplafonnementFacteursLocaux === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  deplafonnementFacteursLocaux: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="deplafo_facteurs" className="cursor-pointer font-normal">
                                Facteurs locaux de commercialité
                              </Label>
                            </div>

                            {bailCommercialData.deplafonnementFacteursLocaux === "oui" && (
                              <div className="space-y-2 ml-6">
                                <Label>Description des facteurs locaux</Label>
                                <Textarea 
                                  value={bailCommercialData.deplafonnementFacteursLocauxDescription} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, deplafonnementFacteursLocauxDescription: e.target.value})} 
                                  placeholder="Ex: Nouvelle zone commerciale, ligne de métro..."
                                  rows={2}
                                />
                              </div>
                            )}
                          </div>

                          <div className="space-y-2">
                            <Label>Clause d'acceptation du déplafonnement</Label>
                            <Select 
                              value={bailCommercialData.deplafonnementClauseAcceptation} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, deplafonnementClauseAcceptation: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui (acceptation expresse)</SelectItem>
                                <SelectItem value="non">Non</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Conditions du déplafonnement</Label>
                            <Textarea 
                              value={bailCommercialData.deplafonnementConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, deplafonnementConditions: e.target.value})} 
                              placeholder="Préciser les conditions et modalités..."
                              rows={3}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* ========== 3️⃣ INDEXATION : SÉCURITÉ JURIDIQUE (AMÉLIORATION) ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📊 Indexation : Sécurité juridique (compléments)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Clause de réciprocité (hausse ET baisse) *</Label>
                        <Select 
                          value={bailCommercialData.indexationClauseReciprocite} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, indexationClauseReciprocite: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (indice à la hausse ET à la baisse)</SelectItem>
                            <SelectItem value="non">Non (hausse uniquement)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Clause de sauvegarde (indice supprimé) *</Label>
                        <Select 
                          value={bailCommercialData.indexationClauseSauvegarde} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, indexationClauseSauvegarde: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (indice de substitution prévu)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.indexationClauseSauvegarde === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Indice de substitution</Label>
                          <Input 
                            value={bailCommercialData.indexationIndiceSubstitution} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, indexationIndiceSubstitution: e.target.value})} 
                            placeholder="Ex: Indice le plus proche en termes d'évolution..."
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Date anniversaire exacte de la révision *</Label>
                        <Input 
                          type="date"
                          value={bailCommercialData.indexationDateAnniversaire} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, indexationDateAnniversaire: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* ========== 4️⃣ GROS TRAVAUX & ARTICLE 606 ========== */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">🧱 Gros travaux & Article 606 du Code civil</h3>
                      <p className="text-xs text-muted-foreground">⚠️ Clause très contrôlée par les juges</p>
                      
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Référence à l'article 606 du Code civil *</Label>
                          <Select 
                            value={bailCommercialData.travauxArticle606Reference} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxArticle606Reference: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui (référence explicite)</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                          <p className="text-xs text-muted-foreground mt-1">
                            L'article 606 définit les grosses réparations à la charge du bailleur (murs maîtres, voûtes, toiture, etc.)
                          </p>
                        </div>

                        <div className="space-y-2">
                          <Label>Exclusion explicite des grosses réparations (charge bailleur) *</Label>
                          <Select 
                            value={bailCommercialData.travauxGrossesReparationsExclusion} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxGrossesReparationsExclusion: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui (restent à la charge du bailleur)</SelectItem>
                              <SelectItem value="non">Non (transfert au preneur)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {bailCommercialData.travauxGrossesReparationsExclusion === "non" && (
                          <>
                            <div className="p-3 bg-orange-50 border border-orange-200 rounded">
                              <p className="text-sm text-orange-800">
                                ⚠️ Attention : Le transfert des grosses réparations au preneur doit être encadré et justifié
                              </p>
                            </div>

                            <div className="space-y-2">
                              <Label>Transfert encadré au preneur</Label>
                              <Select 
                                value={bailCommercialData.travauxGrossesReparationsTransfert} 
                                onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxGrossesReparationsTransfert: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="oui">Oui (transfert encadré)</SelectItem>
                                  <SelectItem value="non">Non</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            {bailCommercialData.travauxGrossesReparationsTransfert === "oui" && (
                              <div className="space-y-2">
                                <Label>Encadrement du transfert (justification, limites, compensations...)</Label>
                                <Textarea 
                                  value={bailCommercialData.travauxGrossesReparationsEncadrement} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, travauxGrossesReparationsEncadrement: e.target.value})} 
                                  placeholder="Ex: Contrepartie en termes de loyer, limitations de montant, nature des travaux..."
                                  rows={4}
                                />
                              </div>
                            )}
                          </>
                        )}
                      </div>
                    </div>
                  )}

                  {/* ========== 5️⃣ ANNEXES LÉGALES OBLIGATOIRES ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📑 Annexes légales obligatoires</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Obligation légale du bailleur</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>DPE (Diagnostic de Performance Énergétique) *</Label>
                        <Select 
                          value={bailCommercialData.annexeDPEFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeDPEFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non (non applicable)</SelectItem>
                            <SelectItem value="en_cours">En cours d'obtention</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>État des risques (ERP / ERNMT) *</Label>
                        <Select 
                          value={bailCommercialData.annexeEtatRisquesFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeEtatRisquesFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="en_cours">En cours d'obtention</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Diagnostic amiante *</Label>
                        <Select 
                          value={bailCommercialData.annexeDiagnosticAmianteFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeDiagnosticAmianteFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non (permis postérieur à 1997)</SelectItem>
                            <SelectItem value="en_cours">En cours d'obtention</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Inventaire des charges, impôts et taxes (L145-40-2) *</Label>
                        <Select 
                          value={bailCommercialData.annexeInventaireChargesFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeInventaireChargesFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (obligatoire - annexé)</SelectItem>
                            <SelectItem value="en_cours">En cours de préparation</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>État récapitulatif triennal (L145-40-2) *</Label>
                        <Select 
                          value={bailCommercialData.annexeEtatRecapitulatifTriennal} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeEtatRecapitulatifTriennal: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non (premier bail)</SelectItem>
                            <SelectItem value="en_cours">En cours de préparation</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-muted-foreground">
                          État récapitulatif des charges, impôts, taxes et travaux des 3 dernières années
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* ========== 6️⃣ CLAUSE RÉSOLUTOIRE ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">⚖️ Clause résolutoire</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Indispensable : sans elle, procédure longue et risquée</p>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Clause résolutoire active ? *</Label>
                        <Select 
                          value={bailCommercialData.clauseResolutoireActive} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseResolutoireActive: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (recommandé)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.clauseResolutoireActive === "oui" && (
                        <>
                          <div className="space-y-3 p-3 bg-white dark:bg-slate-900 rounded border">
                            <h4 className="font-medium text-sm">Cas d'application de la clause :</h4>
                            
                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="resol_impaye"
                                checked={bailCommercialData.clauseResolutoireImpayeLoyers === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  clauseResolutoireImpayeLoyers: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="resol_impaye" className="cursor-pointer font-normal">
                                Impayé de loyers ou charges
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="resol_assurance"
                                checked={bailCommercialData.clauseResolutoireDefautAssurance === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  clauseResolutoireDefautAssurance: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="resol_assurance" className="cursor-pointer font-normal">
                                Défaut d'assurance
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="resol_destination"
                                checked={bailCommercialData.clauseResolutoireNonRespectDestination === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  clauseResolutoireNonRespectDestination: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="resol_destination" className="cursor-pointer font-normal">
                                Non-respect de la destination
                              </Label>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Autres cas de résolution</Label>
                            <Textarea 
                              value={bailCommercialData.clauseResolutoireAutresCas} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, clauseResolutoireAutresCas: e.target.value})} 
                              placeholder="Ex: Sous-location non autorisée, travaux sans accord..."
                              rows={2}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Commandement de payer requis ? *</Label>
                            <Select 
                              value={bailCommercialData.clauseResolutoireCommandement} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseResolutoireCommandement: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui (commandement préalable)</SelectItem>
                                <SelectItem value="non">Non (résiliation immédiate)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Délai avant résolution *</Label>
                            <Input 
                              value={bailCommercialData.clauseResolutoireDelai} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, clauseResolutoireDelai: e.target.value})} 
                              placeholder="Ex: 1 mois, 8 jours..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Procédure détaillée</Label>
                            <Textarea 
                              value={bailCommercialData.clauseResolutoireProcedure} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, clauseResolutoireProcedure: e.target.value})} 
                              placeholder="Décrire la procédure (mise en demeure, commandement, délais, résiliation...)"
                              rows={4}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* ========== 7️⃣ RÉSILIATION ANTICIPÉE ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🚪 Résiliation anticipée</h3>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Résiliation triennale par le preneur *</Label>
                        <Select 
                          value={bailCommercialData.resiliationTriennalePreneur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, resiliationTriennalePreneur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (droit légal 3-6-9)</SelectItem>
                            <SelectItem value="non">Non (renonciation ou bail dérogatoire)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.resiliationTriennalePreneur === "oui" && (
                        <div className="space-y-2">
                          <Label>Conditions de la résiliation triennale</Label>
                          <Textarea 
                            value={bailCommercialData.resiliationTriennalePreneurConditions} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, resiliationTriennalePreneurConditions: e.target.value})} 
                            placeholder="Ex: Préavis de 6 mois, lettre recommandée avec AR..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Renonciation possible du preneur ?</Label>
                        <Select 
                          value={bailCommercialData.resiliationRenonciationPreneur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, resiliationRenonciationPreneur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (⚠️ doit être encadrée)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.resiliationRenonciationPreneur === "oui" && (
                        <div className="space-y-2">
                          <Label>Encadrement de la renonciation</Label>
                          <Textarea 
                            value={bailCommercialData.resiliationRenonciationEncadrement} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, resiliationRenonciationEncadrement: e.target.value})} 
                            placeholder="Décrire les conditions et limites de la renonciation à la résiliation triennale..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-3 p-3 bg-white dark:bg-slate-900 rounded border">
                        <h4 className="font-medium text-sm">Conditions spécifiques de résiliation :</h4>
                        
                        <div className="flex items-center space-x-2">
                          <Checkbox 
                            id="resil_travaux"
                            checked={bailCommercialData.resiliationTravaux === "oui"}
                            onCheckedChange={(checked) => setBailCommercialData({
                              ...bailCommercialData, 
                              resiliationTravaux: checked ? "oui" : "non"
                            })}
                          />
                          <Label htmlFor="resil_travaux" className="cursor-pointer font-normal">
                            Travaux du bailleur empêchant l'exploitation
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <Checkbox 
                            id="resil_destruction"
                            checked={bailCommercialData.resiliationDestruction === "oui"}
                            onCheckedChange={(checked) => setBailCommercialData({
                              ...bailCommercialData, 
                              resiliationDestruction: checked ? "oui" : "non"
                            })}
                          />
                          <Label htmlFor="resil_destruction" className="cursor-pointer font-normal">
                            Destruction partielle ou totale du local
                          </Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Autres conditions spécifiques</Label>
                        <Textarea 
                          value={bailCommercialData.resiliationConditionsSpecifiques} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, resiliationConditionsSpecifiques: e.target.value})} 
                          placeholder="Ex: Force majeure, expropriation..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* ========== 8️⃣ TRAVAUX DU PRENEUR ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🏗️ Travaux du preneur</h3>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Autorisation préalable du bailleur requise ? *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurAutorisationPrealable} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurAutorisationPrealable: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (autorisation écrite obligatoire)</SelectItem>
                            <SelectItem value="partiel">Partiel (selon nature des travaux)</SelectItem>
                            <SelectItem value="non">Non (liberté totale)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Conformité urbanisme *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurConformiteUrbanisme} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurConformiteUrbanisme: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (obtention autorisations requise)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Remise en état en fin de bail *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurRemiseEtat} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurRemiseEtat: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (remise en état initial)</SelectItem>
                            <SelectItem value="conservation">Conservation des améliorations</SelectItem>
                            <SelectItem value="negociation">À négocier en fin de bail</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Propriété des améliorations / méliorations *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurProprieteMeliorations} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurProprieteMeliorations: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="bailleur">Propriété du bailleur (sans indemnité)</SelectItem>
                            <SelectItem value="preneur">Propriété du preneur (démontables)</SelectItem>
                            <SelectItem value="partage">Partage selon nature</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.travauxPreneurProprieteMeliorations !== "bailleur" && (
                        <div className="space-y-2">
                          <Label>Indemnisation des méliorations</Label>
                          <Select 
                            value={bailCommercialData.travauxPreneurIndemnisationMeliorations} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurIndemnisationMeliorations: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui (indemnisation en fin de bail)</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                              <SelectItem value="negociation">À négocier</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* ========== 9️⃣ CLAUSES SENSIBLES (PROTECTION BAILLEUR) ========== */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">⚠️ Clauses sensibles (protection bailleur)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Clause de solidarité en cas de cession</Label>
                        <Select 
                          value={bailCommercialData.clauseSolidariteCession} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseSolidariteCession: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (cédant solidaire avec cessionnaire)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Clause pénale</Label>
                        <Select 
                          value={bailCommercialData.clausePenale} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clausePenale: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (pénalités prévues)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.clausePenale === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Montant de la clause pénale</Label>
                          <Input 
                            value={bailCommercialData.clausePenaleMontant} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, clausePenaleMontant: e.target.value})} 
                            placeholder="Ex: 10% du loyer annuel, montant forfaitaire..."
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Intérêts de retard</Label>
                        <Select 
                          value={bailCommercialData.clauseInteretsRetard} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseInteretsRetard: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (taux prévu)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.clauseInteretsRetard === "oui" && (
                        <div className="space-y-2">
                          <Label>Taux des intérêts de retard *</Label>
                          <Input 
                            value={bailCommercialData.clauseInteretsRetardTaux} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, clauseInteretsRetardTaux: e.target.value})} 
                            placeholder="Ex: Taux légal + 5 points, 12% annuel..."
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Élection de domicile</Label>
                        <Input 
                          value={bailCommercialData.clauseElectionDomicile} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, clauseElectionDomicile: e.target.value})} 
                          placeholder="Ex: Adresse du bailleur, cabinet d'avocat..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Attribution de compétence territoriale</Label>
                        <Input 
                          value={bailCommercialData.clauseAttributionCompetence} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, clauseAttributionCompetence: e.target.value})} 
                          placeholder="Ex: Tribunal de commerce de Paris..."
                        />
                        <p className="text-xs text-muted-foreground">
                          Tribunal compétent en cas de litige
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* ========== FORMULAIRE BAIL COMMERCIAL - ESPACE NOTAIRE ========== */}
            {pendingContractType === "Bail commercial / professionnel" && role === 'notaire' && (
              <>
                <div className="space-y-6">
                  <div className="p-3 bg-orange-50 border border-orange-200 rounded-lg">
                    <p className="text-sm font-medium text-orange-800">📋 Formulaire Bail Commercial - Espace Notaire</p>
                    <p className="text-xs text-orange-600 mt-1">Ce formulaire est indépendant de l'espace avocat</p>
                  </div>

                  {/* Sélection du type de bail */}
                  <div className="space-y-4 bg-muted/50 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg">📋 Type de bail *</h3>
                    <div className="space-y-2">
                      <RadioGroup 
                        value={bailCommercialData.typeBail} 
                        onValueChange={(value) => setBailCommercialData({...bailCommercialData, typeBail: value})}
                      >
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="commercial" id="bail_type_commercial_notaire" />
                          <Label htmlFor="bail_type_commercial_notaire" className="cursor-pointer">
                            <span className="font-medium">Bail commercial</span>
                            <span className="text-xs text-muted-foreground ml-2">(statut 3/6/9 - activité commerciale)</span>
                          </Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="professionnel" id="bail_type_professionnel_notaire" />
                          <Label htmlFor="bail_type_professionnel_notaire" className="cursor-pointer">
                            <span className="font-medium">Bail professionnel</span>
                            <span className="text-xs text-muted-foreground ml-2">(profession libérale - min. 6 ans)</span>
                          </Label>
                        </div>
                      </RadioGroup>
                    </div>
                  </div>

                  {/* Sélection du rôle du client */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">👤 Votre client</h3>
                    <div className="space-y-2">
                      <Label>Votre client est le *</Label>
                      <RadioGroup 
                        value={bailCommercialData.clientRole} 
                        onValueChange={(value) => {
                          setBailCommercialData({
                            ...bailCommercialData, 
                            clientRole: value,
                            clientId: "",
                          });
                        }}
                      >
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="bailleur" id="bc_role_bailleur_notaire" />
                          <Label htmlFor="bc_role_bailleur_notaire" className="cursor-pointer">Bailleur (propriétaire)</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="preneur" id="bc_role_preneur_notaire" />
                          <Label htmlFor="bc_role_preneur_notaire" className="cursor-pointer">Preneur (locataire)</Label>
                        </div>
                      </RadioGroup>
                    </div>
                  </div>

                  {/* ========== 1️⃣ RENOUVELLEMENT & FIN DU BAIL ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🔁 Renouvellement & Fin du bail</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Bloc fondamental en contentieux</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Droit au renouvellement *</Label>
                        <Select 
                          value={bailCommercialData.droitRenouvellement} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, droitRenouvellement: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (droit légal)</SelectItem>
                            <SelectItem value="non">Non (bail dérogatoire ou renonciation)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Modalités de congé *</Label>
                        <Select 
                          value={bailCommercialData.modaliteConge} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, modaliteConge: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="rar">Lettre recommandée avec AR</SelectItem>
                            <SelectItem value="huissier">Acte d'huissier</SelectItem>
                            <SelectItem value="rar_ou_huissier">RAR ou acte d'huissier</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Délai de congé *</Label>
                        <Input 
                          value={bailCommercialData.delaiConge} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, delaiConge: e.target.value})} 
                          placeholder="Ex: 6 mois avant échéance"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Acte d'huissier obligatoire ?</Label>
                        <Select 
                          value={bailCommercialData.acteHuissierObligatoire} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, acteHuissierObligatoire: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Indemnité d'éviction *</Label>
                        <Select 
                          value={bailCommercialData.indemniteEviction} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, indemniteEviction: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (droit légal)</SelectItem>
                            <SelectItem value="exclusion">Exclusion (bail dérogatoire)</SelectItem>
                            <SelectItem value="amenagement">Aménagement conventionnel</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.indemniteEviction === "amenagement" && (
                        <>
                          <div className="space-y-2">
                            <Label>Montant de l'indemnité</Label>
                            <Input 
                              value={bailCommercialData.indemniteEvictionMontant} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, indemniteEvictionMontant: e.target.value})} 
                              placeholder="Montant en €"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Conditions particulières</Label>
                            <Input 
                              value={bailCommercialData.indemniteEvictionConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, indemniteEvictionConditions: e.target.value})} 
                              placeholder="Préciser les conditions"
                            />
                          </div>
                        </>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Renonciation éventuelle du preneur</Label>
                        <Select 
                          value={bailCommercialData.renonciationPreneur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, renonciationPreneur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (⚠️ doit être encadrée)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.renonciationPreneur === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Encadrement de la renonciation</Label>
                          <Textarea 
                            value={bailCommercialData.renonciationPreneurEncadrement} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, renonciationPreneurEncadrement: e.target.value})} 
                            placeholder="Décrire les conditions et limites de la renonciation..."
                            rows={3}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* ========== 2️⃣ PLAFONNEMENT / DÉPLAFONNEMENT ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📈 Plafonnement / Déplafonnement du loyer</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Très important pour investisseurs / centres-villes</p>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Principe de plafonnement du loyer *</Label>
                        <Select 
                          value={bailCommercialData.plafonnementLoyer} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, plafonnementLoyer: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (principe légal)</SelectItem>
                            <SelectItem value="non">Non (dérogation conventionnelle)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Description du principe de plafonnement</Label>
                        <Textarea 
                          value={bailCommercialData.plafonnementPrincipe} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, plafonnementPrincipe: e.target.value})} 
                          placeholder="Ex: Limitation de l'augmentation du loyer selon l'indice ILC..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Déplafonnement autorisé ? *</Label>
                        <Select 
                          value={bailCommercialData.deplafonnementAutorise} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, deplafonnementAutorise: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (cas légaux)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.deplafonnementAutorise === "oui" && (
                        <>
                          <div className="space-y-3 p-3 bg-white dark:bg-slate-900 rounded border">
                            <h4 className="font-medium text-sm">Cas de déplafonnement :</h4>
                            
                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="deplafo_destination_notaire"
                                checked={bailCommercialData.deplafonnementModificationDestination === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  deplafonnementModificationDestination: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="deplafo_destination_notaire" className="cursor-pointer font-normal">
                                Modification notable de la destination
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="deplafo_facteurs_notaire"
                                checked={bailCommercialData.deplafonnementFacteursLocaux === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  deplafonnementFacteursLocaux: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="deplafo_facteurs_notaire" className="cursor-pointer font-normal">
                                Facteurs locaux de commercialité
                              </Label>
                            </div>

                            {bailCommercialData.deplafonnementFacteursLocaux === "oui" && (
                              <div className="space-y-2 ml-6">
                                <Label>Description des facteurs locaux</Label>
                                <Textarea 
                                  value={bailCommercialData.deplafonnementFacteursLocauxDescription} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, deplafonnementFacteursLocauxDescription: e.target.value})} 
                                  placeholder="Ex: Nouvelle zone commerciale, ligne de métro..."
                                  rows={2}
                                />
                              </div>
                            )}
                          </div>

                          <div className="space-y-2">
                            <Label>Clause d'acceptation du déplafonnement</Label>
                            <Select 
                              value={bailCommercialData.deplafonnementClauseAcceptation} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, deplafonnementClauseAcceptation: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui (acceptation expresse)</SelectItem>
                                <SelectItem value="non">Non</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Conditions du déplafonnement</Label>
                            <Textarea 
                              value={bailCommercialData.deplafonnementConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, deplafonnementConditions: e.target.value})} 
                              placeholder="Préciser les conditions et modalités..."
                              rows={3}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* ========== 3️⃣ INDEXATION : SÉCURITÉ JURIDIQUE (AMÉLIORATION) ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📊 Indexation : Sécurité juridique (compléments)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Clause de réciprocité (hausse ET baisse) *</Label>
                        <Select 
                          value={bailCommercialData.indexationClauseReciprocite} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, indexationClauseReciprocite: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (indice à la hausse ET à la baisse)</SelectItem>
                            <SelectItem value="non">Non (hausse uniquement)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Clause de sauvegarde (indice supprimé) *</Label>
                        <Select 
                          value={bailCommercialData.indexationClauseSauvegarde} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, indexationClauseSauvegarde: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (indice de substitution prévu)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.indexationClauseSauvegarde === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Indice de substitution</Label>
                          <Input 
                            value={bailCommercialData.indexationIndiceSubstitution} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, indexationIndiceSubstitution: e.target.value})} 
                            placeholder="Ex: Indice le plus proche en termes d'évolution..."
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Date anniversaire exacte de la révision *</Label>
                        <Input 
                          type="date"
                          value={bailCommercialData.indexationDateAnniversaire} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, indexationDateAnniversaire: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* ========== 4️⃣ GROS TRAVAUX & ARTICLE 606 ========== */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">🧱 Gros travaux & Article 606 du Code civil</h3>
                      <p className="text-xs text-muted-foreground">⚠️ Clause très contrôlée par les juges</p>
                      
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Référence à l'article 606 du Code civil *</Label>
                          <Select 
                            value={bailCommercialData.travauxArticle606Reference} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxArticle606Reference: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui (référence explicite)</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                          <p className="text-xs text-muted-foreground mt-1">
                            L'article 606 définit les grosses réparations à la charge du bailleur (murs maîtres, voûtes, toiture, etc.)
                          </p>
                        </div>

                        <div className="space-y-2">
                          <Label>Exclusion explicite des grosses réparations (charge bailleur) *</Label>
                          <Select 
                            value={bailCommercialData.travauxGrossesReparationsExclusion} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxGrossesReparationsExclusion: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui (restent à la charge du bailleur)</SelectItem>
                              <SelectItem value="non">Non (transfert au preneur)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {bailCommercialData.travauxGrossesReparationsExclusion === "non" && (
                          <>
                            <div className="p-3 bg-orange-50 border border-orange-200 rounded">
                              <p className="text-sm text-orange-800">
                                ⚠️ Attention : Le transfert des grosses réparations au preneur doit être encadré et justifié
                              </p>
                            </div>

                            <div className="space-y-2">
                              <Label>Transfert encadré au preneur</Label>
                              <Select 
                                value={bailCommercialData.travauxGrossesReparationsTransfert} 
                                onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxGrossesReparationsTransfert: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="oui">Oui (transfert encadré)</SelectItem>
                                  <SelectItem value="non">Non</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            {bailCommercialData.travauxGrossesReparationsTransfert === "oui" && (
                              <div className="space-y-2">
                                <Label>Encadrement du transfert (justification, limites, compensations...)</Label>
                                <Textarea 
                                  value={bailCommercialData.travauxGrossesReparationsEncadrement} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, travauxGrossesReparationsEncadrement: e.target.value})} 
                                  placeholder="Ex: Contrepartie en termes de loyer, limitations de montant, nature des travaux..."
                                  rows={4}
                                />
                              </div>
                            )}
                          </>
                        )}
                      </div>
                    </div>
                  )}

                  {/* ========== 5️⃣ ANNEXES LÉGALES OBLIGATOIRES ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">📑 Annexes légales obligatoires</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Obligation légale du bailleur</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>DPE (Diagnostic de Performance Énergétique) *</Label>
                        <Select 
                          value={bailCommercialData.annexeDPEFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeDPEFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non (non applicable)</SelectItem>
                            <SelectItem value="en_cours">En cours d'obtention</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>État des risques (ERP / ERNMT) *</Label>
                        <Select 
                          value={bailCommercialData.annexeEtatRisquesFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeEtatRisquesFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="en_cours">En cours d'obtention</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Diagnostic amiante *</Label>
                        <Select 
                          value={bailCommercialData.annexeDiagnosticAmianteFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeDiagnosticAmianteFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non (permis postérieur à 1997)</SelectItem>
                            <SelectItem value="en_cours">En cours d'obtention</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Inventaire des charges, impôts et taxes (L145-40-2) *</Label>
                        <Select 
                          value={bailCommercialData.annexeInventaireChargesFourni} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeInventaireChargesFourni: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (obligatoire - annexé)</SelectItem>
                            <SelectItem value="en_cours">En cours de préparation</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>État récapitulatif triennal (L145-40-2) *</Label>
                        <Select 
                          value={bailCommercialData.annexeEtatRecapitulatifTriennal} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, annexeEtatRecapitulatifTriennal: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (annexé)</SelectItem>
                            <SelectItem value="non">Non (premier bail)</SelectItem>
                            <SelectItem value="en_cours">En cours de préparation</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-muted-foreground">
                          État récapitulatif des charges, impôts, taxes et travaux des 3 dernières années
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* ========== 6️⃣ CLAUSE RÉSOLUTOIRE ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">⚖️ Clause résolutoire</h3>
                    <p className="text-xs text-muted-foreground">⚠️ Indispensable : sans elle, procédure longue et risquée</p>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Clause résolutoire active ? *</Label>
                        <Select 
                          value={bailCommercialData.clauseResolutoireActive} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseResolutoireActive: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (recommandé)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.clauseResolutoireActive === "oui" && (
                        <>
                          <div className="space-y-3 p-3 bg-white dark:bg-slate-900 rounded border">
                            <h4 className="font-medium text-sm">Cas d'application de la clause :</h4>
                            
                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="resol_impaye_notaire"
                                checked={bailCommercialData.clauseResolutoireImpayeLoyers === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  clauseResolutoireImpayeLoyers: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="resol_impaye_notaire" className="cursor-pointer font-normal">
                                Impayé de loyers ou charges
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="resol_assurance_notaire"
                                checked={bailCommercialData.clauseResolutoireDefautAssurance === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  clauseResolutoireDefautAssurance: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="resol_assurance_notaire" className="cursor-pointer font-normal">
                                Défaut d'assurance
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <Checkbox 
                                id="resol_destination_notaire"
                                checked={bailCommercialData.clauseResolutoireNonRespectDestination === "oui"}
                                onCheckedChange={(checked) => setBailCommercialData({
                                  ...bailCommercialData, 
                                  clauseResolutoireNonRespectDestination: checked ? "oui" : "non"
                                })}
                              />
                              <Label htmlFor="resol_destination_notaire" className="cursor-pointer font-normal">
                                Non-respect de la destination
                              </Label>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Autres cas de résolution</Label>
                            <Textarea 
                              value={bailCommercialData.clauseResolutoireAutresCas} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, clauseResolutoireAutresCas: e.target.value})} 
                              placeholder="Ex: Sous-location non autorisée, travaux sans accord..."
                              rows={2}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Commandement de payer requis ? *</Label>
                            <Select 
                              value={bailCommercialData.clauseResolutoireCommandement} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseResolutoireCommandement: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui (commandement préalable)</SelectItem>
                                <SelectItem value="non">Non (résiliation immédiate)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Délai avant résolution *</Label>
                            <Input 
                              value={bailCommercialData.clauseResolutoireDelai} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, clauseResolutoireDelai: e.target.value})} 
                              placeholder="Ex: 1 mois, 8 jours..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Procédure détaillée</Label>
                            <Textarea 
                              value={bailCommercialData.clauseResolutoireProcedure} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, clauseResolutoireProcedure: e.target.value})} 
                              placeholder="Décrire la procédure (mise en demeure, commandement, délais, résiliation...)"
                              rows={4}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* ========== 7️⃣ RÉSILIATION ANTICIPÉE ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🚪 Résiliation anticipée</h3>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Résiliation triennale par le preneur *</Label>
                        <Select 
                          value={bailCommercialData.resiliationTriennalePreneur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, resiliationTriennalePreneur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (droit légal 3-6-9)</SelectItem>
                            <SelectItem value="non">Non (renonciation ou bail dérogatoire)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.resiliationTriennalePreneur === "oui" && (
                        <div className="space-y-2">
                          <Label>Conditions de la résiliation triennale</Label>
                          <Textarea 
                            value={bailCommercialData.resiliationTriennalePreneurConditions} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, resiliationTriennalePreneurConditions: e.target.value})} 
                            placeholder="Ex: Préavis de 6 mois, lettre recommandée avec AR..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Renonciation possible du preneur ?</Label>
                        <Select 
                          value={bailCommercialData.resiliationRenonciationPreneur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, resiliationRenonciationPreneur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (⚠️ doit être encadrée)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.resiliationRenonciationPreneur === "oui" && (
                        <div className="space-y-2">
                          <Label>Encadrement de la renonciation</Label>
                          <Textarea 
                            value={bailCommercialData.resiliationRenonciationEncadrement} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, resiliationRenonciationEncadrement: e.target.value})} 
                            placeholder="Décrire les conditions et limites de la renonciation à la résiliation triennale..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-3 p-3 bg-white dark:bg-slate-900 rounded border">
                        <h4 className="font-medium text-sm">Conditions spécifiques de résiliation :</h4>
                        
                        <div className="flex items-center space-x-2">
                          <Checkbox 
                            id="resil_travaux_notaire"
                            checked={bailCommercialData.resiliationTravaux === "oui"}
                            onCheckedChange={(checked) => setBailCommercialData({
                              ...bailCommercialData, 
                              resiliationTravaux: checked ? "oui" : "non"
                            })}
                          />
                          <Label htmlFor="resil_travaux_notaire" className="cursor-pointer font-normal">
                            Travaux du bailleur empêchant l'exploitation
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <Checkbox 
                            id="resil_destruction_notaire"
                            checked={bailCommercialData.resiliationDestruction === "oui"}
                            onCheckedChange={(checked) => setBailCommercialData({
                              ...bailCommercialData, 
                              resiliationDestruction: checked ? "oui" : "non"
                            })}
                          />
                          <Label htmlFor="resil_destruction_notaire" className="cursor-pointer font-normal">
                            Destruction partielle ou totale du local
                          </Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Autres conditions spécifiques</Label>
                        <Textarea 
                          value={bailCommercialData.resiliationConditionsSpecifiques} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, resiliationConditionsSpecifiques: e.target.value})} 
                          placeholder="Ex: Force majeure, expropriation..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* ========== 8️⃣ TRAVAUX DU PRENEUR ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🏗️ Travaux du preneur</h3>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Autorisation préalable du bailleur requise ? *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurAutorisationPrealable} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurAutorisationPrealable: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (autorisation écrite obligatoire)</SelectItem>
                            <SelectItem value="partiel">Partiel (selon nature des travaux)</SelectItem>
                            <SelectItem value="non">Non (liberté totale)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Conformité urbanisme *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurConformiteUrbanisme} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurConformiteUrbanisme: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (obtention autorisations requise)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Remise en état en fin de bail *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurRemiseEtat} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurRemiseEtat: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (remise en état initial)</SelectItem>
                            <SelectItem value="conservation">Conservation des améliorations</SelectItem>
                            <SelectItem value="negociation">À négocier en fin de bail</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Propriété des améliorations / méliorations *</Label>
                        <Select 
                          value={bailCommercialData.travauxPreneurProprieteMeliorations} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurProprieteMeliorations: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="bailleur">Propriété du bailleur (sans indemnité)</SelectItem>
                            <SelectItem value="preneur">Propriété du preneur (démontables)</SelectItem>
                            <SelectItem value="partage">Partage selon nature</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.travauxPreneurProprieteMeliorations !== "bailleur" && (
                        <div className="space-y-2">
                          <Label>Indemnisation des méliorations</Label>
                          <Select 
                            value={bailCommercialData.travauxPreneurIndemnisationMeliorations} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, travauxPreneurIndemnisationMeliorations: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui (indemnisation en fin de bail)</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                              <SelectItem value="negociation">À négocier</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* ========== 9️⃣ CLAUSES SENSIBLES (PROTECTION BAILLEUR) ========== */}
                  <div className="space-y-4 p-4 bg-muted/50 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">⚠️ Clauses sensibles (protection bailleur)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Clause de solidarité en cas de cession</Label>
                        <Select 
                          value={bailCommercialData.clauseSolidariteCession} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseSolidariteCession: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (cédant solidaire avec cessionnaire)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Clause pénale</Label>
                        <Select 
                          value={bailCommercialData.clausePenale} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clausePenale: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (pénalités prévues)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.clausePenale === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Montant de la clause pénale</Label>
                          <Input 
                            value={bailCommercialData.clausePenaleMontant} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, clausePenaleMontant: e.target.value})} 
                            placeholder="Ex: 10% du loyer annuel, montant forfaitaire..."
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Intérêts de retard</Label>
                        <Select 
                          value={bailCommercialData.clauseInteretsRetard} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, clauseInteretsRetard: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (taux prévu)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.clauseInteretsRetard === "oui" && (
                        <div className="space-y-2">
                          <Label>Taux des intérêts de retard *</Label>
                          <Input 
                            value={bailCommercialData.clauseInteretsRetardTaux} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, clauseInteretsRetardTaux: e.target.value})} 
                            placeholder="Ex: Taux légal + 5 points, 12% annuel..."
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Élection de domicile</Label>
                        <Input 
                          value={bailCommercialData.clauseElectionDomicile} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, clauseElectionDomicile: e.target.value})} 
                          placeholder="Ex: Adresse du bailleur, cabinet de notaire..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Attribution de compétence territoriale</Label>
                        <Input 
                          value={bailCommercialData.clauseAttributionCompetence} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, clauseAttributionCompetence: e.target.value})} 
                          placeholder="Ex: Tribunal de commerce de Paris..."
                        />
                        <p className="text-xs text-muted-foreground">
                          Tribunal compétent en cas de litige
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* ========== FORMULAIRE ÉTAT DES LIEUX ========== */}
            {pendingContractType === "État des lieux (annexe)" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1️⃣ IDENTIFICATION DU DOCUMENT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣ Identification du document</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type d'état des lieux *</Label>
                        <Select 
                          value={etatLieuxData.typeEtatLieux} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, typeEtatLieux: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="entree">État des lieux d'entrée</SelectItem>
                            <SelectItem value="sortie">État des lieux de sortie</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Adresse complète du logement *</Label>
                        <Input 
                          value={etatLieuxData.adresseLogement} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, adresseLogement: e.target.value})} 
                          placeholder="Numéro, rue, CP, ville"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date *</Label>
                        <Input 
                          type="date"
                          value={etatLieuxData.dateEtatLieux} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, dateEtatLieux: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Heure</Label>
                        <Input 
                          type="time"
                          value={etatLieuxData.heureEtatLieux} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, heureEtatLieux: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Réalisé par *</Label>
                        <Select 
                          value={etatLieuxData.realisePar} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, realisePar: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="bailleur">Bailleur</SelectItem>
                            <SelectItem value="locataire">Locataire</SelectItem>
                            <SelectItem value="mandataire">Mandataire / Agence</SelectItem>
                            <SelectItem value="huissier">Huissier</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Bailleur présent ? *</Label>
                        <Select 
                          value={etatLieuxData.bailleurPresent} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, bailleurPresent: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Locataire présent ? *</Label>
                        <Select 
                          value={etatLieuxData.locatairePresent} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, locatairePresent: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Témoins / Représentants</Label>
                        <Textarea 
                          value={etatLieuxData.temoinsRepresentants} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, temoinsRepresentants: e.target.value})} 
                          placeholder="Noms et qualités des témoins ou représentants présents"
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 2️⃣ IDENTITÉ DES PARTIES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣ Identité des parties</h3>
                    
                    {/* Bailleur */}
                    <div className="space-y-3">
                      <h4 className="font-medium">A. Bailleur</h4>
                      
                      {/* Sélection du client bailleur */}
                      <ClientSelector
                          clients={clients}
                          selectedClientId={etatLieuxData.bailleurClientId}
                          onClientChange={(value) => {
                            if (value === '') {
                              // Saisie manuelle
                              setEtatLieuxData({
                                ...etatLieuxData,
                                bailleurClientId: "",
                                bailleurNom: "",
                                bailleurPrenom: "",
                                bailleurAdresse: "",
                                bailleurEmail: "",
                                bailleurTelephone: "",
                              });
                            } else {
                              const selectedClient = clients.find(c => c.id === value) as any;
                              if (selectedClient) {
                                setEtatLieuxData({
                                  ...etatLieuxData,
                                  bailleurClientId: value,
                                  bailleurNom: selectedClient.nom || "",
                                  bailleurPrenom: selectedClient.prenom || "",
                                  bailleurAdresse: selectedClient.adresse || "",
                                  bailleurEmail: selectedClient.email || "",
                                  bailleurTelephone: selectedClient.telephone || "",
                                });
                              }
                            }
                          }}
                          label="Sélectionner le client bailleur *"
                          placeholder="Choisir un client"
                        />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input 
                            value={etatLieuxData.bailleurNom} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, bailleurNom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input 
                            value={etatLieuxData.bailleurPrenom} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, bailleurPrenom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse *</Label>
                          <Input 
                            value={etatLieuxData.bailleurAdresse} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, bailleurAdresse: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Email</Label>
                          <Input 
                            type="email"
                            value={etatLieuxData.bailleurEmail} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, bailleurEmail: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone</Label>
                          <Input 
                            type="tel"
                            value={etatLieuxData.bailleurTelephone} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, bailleurTelephone: e.target.value})} 
                          />
                        </div>
                      </div>
                    </div>

                    {/* Locataire */}
                    <div className="space-y-3">
                      <h4 className="font-medium">B. Locataire</h4>
                      
                      {/* Sélection du client locataire */}
                      <ClientSelector
                          clients={clients}
                          selectedClientId={etatLieuxData.locataireClientId}
                          onClientChange={(value) => {
                            if (value === '') {
                              // Saisie manuelle
                              setEtatLieuxData({
                                ...etatLieuxData,
                                locataireClientId: "",
                                locataireNom: "",
                                locatairePrenom: "",
                                locataireAdresse: "",
                                locataireEmail: "",
                                locataireTelephone: "",
                              });
                            } else {
                              const selectedClient = clients.find(c => c.id === value) as any;
                              if (selectedClient) {
                                setEtatLieuxData({
                                  ...etatLieuxData,
                                  locataireClientId: value,
                                  locataireNom: selectedClient.nom || "",
                                  locatairePrenom: selectedClient.prenom || "",
                                  locataireAdresse: selectedClient.adresse || "",
                                  locataireEmail: selectedClient.email || "",
                                  locataireTelephone: selectedClient.telephone || "",
                                });
                              }
                            }
                          }}
                          label="Sélectionner le client locataire *"
                          placeholder="Choisir un client"
                        />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input 
                            value={etatLieuxData.locataireNom} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, locataireNom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input 
                            value={etatLieuxData.locatairePrenom} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, locatairePrenom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse / Futur domicile *</Label>
                          <Input 
                            value={etatLieuxData.locataireAdresse} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, locataireAdresse: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Email</Label>
                          <Input 
                            type="email"
                            value={etatLieuxData.locataireEmail} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, locataireEmail: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone</Label>
                          <Input 
                            type="tel"
                            value={etatLieuxData.locataireTelephone} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, locataireTelephone: e.target.value})} 
                          />
                        </div>
                      </div>
                    </div>

                    {/* Agence */}
                    <div className="space-y-3">
                      <h4 className="font-medium">C. Agence immobilière (si applicable)</h4>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Agence présente ?</Label>
                          <Select 
                            value={etatLieuxData.agencePresente} 
                            onValueChange={(value) => setEtatLieuxData({...etatLieuxData, agencePresente: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {etatLieuxData.agencePresente === "oui" && (
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2 md:col-span-2">
                              <Label>Raison sociale</Label>
                              <Input 
                                value={etatLieuxData.agenceRaisonSociale} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, agenceRaisonSociale: e.target.value})} 
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>N° carte professionnelle</Label>
                              <Input 
                                value={etatLieuxData.agenceCarteProf} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, agenceCarteProf: e.target.value})} 
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Adresse</Label>
                              <Input 
                                value={etatLieuxData.agenceAdresse} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, agenceAdresse: e.target.value})} 
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Mandataire - Nom</Label>
                              <Input 
                                value={etatLieuxData.agenceMandataireNom} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, agenceMandataireNom: e.target.value})} 
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Fonction</Label>
                              <Input 
                                value={etatLieuxData.agenceMandataireFonction} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, agenceMandataireFonction: e.target.value})} 
                              />
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>

                  {/* 3️⃣ DESCRIPTION GÉNÉRALE DU LOGEMENT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">3️⃣ Description générale du logement</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de logement *</Label>
                        <Select 
                          value={etatLieuxData.typeLogement} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, typeLogement: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="appartement">Appartement</SelectItem>
                            <SelectItem value="maison">Maison</SelectItem>
                            <SelectItem value="studio">Studio</SelectItem>
                            <SelectItem value="loft">Loft</SelectItem>
                            <SelectItem value="chambre">Chambre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Nombre de pièces *</Label>
                        <Input 
                          type="number"
                          value={etatLieuxData.nombrePieces} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, nombrePieces: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Surface (m²) *</Label>
                        <Input 
                          type="number"
                          value={etatLieuxData.surfaceLogement} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, surfaceLogement: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Étage</Label>
                        <Input 
                          value={etatLieuxData.etage} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, etage: e.target.value})} 
                          placeholder="ex: 2ème, RDC..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Ascenseur ?</Label>
                        <Select 
                          value={etatLieuxData.ascenseur} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, ascenseur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Meublé ?</Label>
                        <Select 
                          value={etatLieuxData.meuble} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, meuble: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Type de chauffage *</Label>
                        <Select 
                          value={etatLieuxData.typeChauffage} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, typeChauffage: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="collectif">Collectif</SelectItem>
                            <SelectItem value="individuel_gaz">Individuel - Gaz</SelectItem>
                            <SelectItem value="individuel_electrique">Individuel - Électrique</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Eau chaude *</Label>
                        <Select 
                          value={etatLieuxData.eauChaude} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, eauChaude: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="collective">Collective</SelectItem>
                            <SelectItem value="individuelle">Individuelle</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Type de ventilation</Label>
                        <Select 
                          value={etatLieuxData.typeVentilation} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, typeVentilation: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="vmc">VMC</SelectItem>
                            <SelectItem value="naturelle">Naturelle</SelectItem>
                            <SelectItem value="aucune">Aucune</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Annexes</Label>
                        <Input 
                          value={etatLieuxData.annexes} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, annexes: e.target.value})} 
                          placeholder="Cave, parking, grenier..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Observations générales</Label>
                        <Textarea 
                          value={etatLieuxData.observationsGenerales} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, observationsGenerales: e.target.value})} 
                          rows={3}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4️⃣ RELEVÉS DE COMPTEURS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">4️⃣ Relevés de compteurs</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Eau froide (m³)</Label>
                        <Input 
                          type="number"
                          step="0.001"
                          value={etatLieuxData.compteurEauFroide} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, compteurEauFroide: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Eau chaude (m³)</Label>
                        <Input 
                          type="number"
                          step="0.001"
                          value={etatLieuxData.compteurEauChaude} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, compteurEauChaude: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Électricité (kWh)</Label>
                        <Input 
                          type="number"
                          step="0.001"
                          value={etatLieuxData.compteurElectricite} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, compteurElectricite: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Gaz (m³)</Label>
                        <Input 
                          type="number"
                          step="0.001"
                          value={etatLieuxData.compteurGaz} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, compteurGaz: e.target.value})} 
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Chauffage collectif (unités)</Label>
                        <Input 
                          type="number"
                          step="0.001"
                          value={etatLieuxData.compteurChauffage} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, compteurChauffage: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* 5️⃣ CLÉS REMISES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">5️⃣ Clés remises</h3>
                    
                    {etatLieuxData.cles.map((cle, index) => (
                      <div key={index} className="p-3 bg-white dark:bg-gray-800 rounded border">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                          <div className="space-y-2">
                            <Label>Type de clé</Label>
                            <Select 
                              value={cle.type} 
                              onValueChange={(value) => {
                                const newCles = [...etatLieuxData.cles];
                                newCles[index].type = value;
                                setEtatLieuxData({...etatLieuxData, cles: newCles});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="entree_immeuble">Entrée immeuble</SelectItem>
                                <SelectItem value="porte_appartement">Porte appartement</SelectItem>
                                <SelectItem value="cave">Cave</SelectItem>
                                <SelectItem value="boite_lettres">Boîte aux lettres</SelectItem>
                                <SelectItem value="parking">Parking</SelectItem>
                                <SelectItem value="portail">Portail</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Quantité</Label>
                            <Input 
                              type="number"
                              min="0"
                              value={cle.quantite} 
                              onChange={(e) => {
                                const newCles = [...etatLieuxData.cles];
                                newCles[index].quantite = e.target.value;
                                setEtatLieuxData({...etatLieuxData, cles: newCles});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro(s)</Label>
                            <Input 
                              value={cle.numero} 
                              onChange={(e) => {
                                const newCles = [...etatLieuxData.cles];
                                newCles[index].numero = e.target.value;
                                setEtatLieuxData({...etatLieuxData, cles: newCles});
                              }}
                              placeholder="ex: 123, A25..."
                            />
                          </div>
                        </div>

                        {etatLieuxData.cles.length > 1 && (
                          <Button 
                            type="button" 
                            variant="destructive" 
                            size="sm"
                            className="mt-2"
                            onClick={() => {
                              const newCles = etatLieuxData.cles.filter((_, i) => i !== index);
                              setEtatLieuxData({...etatLieuxData, cles: newCles});
                            }}
                          >
                            Supprimer cette clé
                          </Button>
                        )}
                      </div>
                    ))}

                    <Button 
                      type="button" 
                      variant="outline"
                      onClick={() => {
                        setEtatLieuxData({
                          ...etatLieuxData, 
                          cles: [...etatLieuxData.cles, {type: '', quantite: '1', numero: ''}]
                        });
                      }}
                    >
                      + Ajouter une clé
                    </Button>
                  </div>

                  {/* 6️⃣ INVENTAIRE PIÈCE PAR PIÈCE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">6️⃣ Inventaire pièce par pièce</h3>
                    <p className="text-sm text-muted-foreground">Description détaillée de chaque pièce du logement</p>
                    
                    {etatLieuxData.pieces.map((piece, index) => (
                      <div key={index} className="p-4 bg-white dark:bg-gray-800 rounded border space-y-4">
                        <div className="flex justify-between items-center">
                          <h4 className="font-semibold text-lg">Pièce #{index + 1}</h4>
                          {etatLieuxData.pieces.length > 1 && (
                            <Button 
                              type="button" 
                              variant="destructive" 
                              size="sm"
                              onClick={() => {
                                const newPieces = etatLieuxData.pieces.filter((_, i) => i !== index);
                                setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom de la pièce *</Label>
                            <Select 
                              value={piece.nomPiece} 
                              onValueChange={(value) => {
                                const newPieces = [...etatLieuxData.pieces];
                                newPieces[index].nomPiece = value;
                                setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="entree">Entrée</SelectItem>
                                <SelectItem value="sejour">Séjour</SelectItem>
                                <SelectItem value="salon">Salon</SelectItem>
                                <SelectItem value="cuisine">Cuisine</SelectItem>
                                <SelectItem value="chambre">Chambre</SelectItem>
                                <SelectItem value="salle_bain">Salle de bain</SelectItem>
                                <SelectItem value="salle_eau">Salle d'eau</SelectItem>
                                <SelectItem value="wc">WC</SelectItem>
                                <SelectItem value="couloir">Couloir</SelectItem>
                                <SelectItem value="dressing">Dressing</SelectItem>
                                <SelectItem value="bureau">Bureau</SelectItem>
                                <SelectItem value="balcon">Balcon</SelectItem>
                                <SelectItem value="terrasse">Terrasse</SelectItem>
                                <SelectItem value="cave">Cave</SelectItem>
                                <SelectItem value="parking">Parking</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Surface (m²)</Label>
                            <Input 
                              type="number"
                              step="0.1"
                              value={piece.surface} 
                              onChange={(e) => {
                                const newPieces = [...etatLieuxData.pieces];
                                newPieces[index].surface = e.target.value;
                                setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                              }}
                            />
                          </div>
                        </div>

                        {/* SOLS */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Sols</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Revêtement</Label>
                              <Select 
                                value={piece.solRevetement} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].solRevetement = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="parquet">Parquet</SelectItem>
                                  <SelectItem value="carrelage">Carrelage</SelectItem>
                                  <SelectItem value="moquette">Moquette</SelectItem>
                                  <SelectItem value="lino">Lino</SelectItem>
                                  <SelectItem value="beton">Béton ciré</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>État</Label>
                              <Select 
                                value={piece.solEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].solEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Observations sols</Label>
                              <Textarea 
                                value={piece.solObservations} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].solObservations = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                                rows={2}
                              />
                            </div>
                          </div>
                        </div>

                        {/* MURS */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Murs</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Revêtement</Label>
                              <Select 
                                value={piece.mursRevetement} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].mursRevetement = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="peinture">Peinture</SelectItem>
                                  <SelectItem value="papier_peint">Papier peint</SelectItem>
                                  <SelectItem value="carrelage">Carrelage</SelectItem>
                                  <SelectItem value="lambris">Lambris</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>État</Label>
                              <Select 
                                value={piece.mursEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].mursEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Observations murs</Label>
                              <Textarea 
                                value={piece.mursObservations} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].mursObservations = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                                rows={2}
                              />
                            </div>
                          </div>
                        </div>

                        {/* PLAFONDS */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Plafonds</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Revêtement</Label>
                              <Select 
                                value={piece.plafondsRevetement} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].plafondsRevetement = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="peinture">Peinture</SelectItem>
                                  <SelectItem value="platre">Plâtre</SelectItem>
                                  <SelectItem value="lambris">Lambris</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>État</Label>
                              <Select 
                                value={piece.plafondsEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].plafondsEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Observations plafonds</Label>
                              <Textarea 
                                value={piece.plafondsObservations} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].plafondsObservations = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                                rows={2}
                              />
                            </div>
                          </div>
                        </div>

                        {/* FENÊTRES */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Fenêtres et vitrages</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Nombre de fenêtres</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.fenetresNombre} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].fenetresNombre = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Type de vitrage</Label>
                              <Select 
                                value={piece.fenetresVitrage} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].fenetresVitrage = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="simple">Simple vitrage</SelectItem>
                                  <SelectItem value="double">Double vitrage</SelectItem>
                                  <SelectItem value="triple">Triple vitrage</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>État fenêtres</Label>
                              <Select 
                                value={piece.fenetresEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].fenetresEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Volets</Label>
                              <Select 
                                value={piece.fenetresVolets} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].fenetresVolets = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="oui_roulants">Oui - Roulants</SelectItem>
                                  <SelectItem value="oui_battants">Oui - Battants</SelectItem>
                                  <SelectItem value="non">Non</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Observations fenêtres</Label>
                              <Textarea 
                                value={piece.fenetresObservations} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].fenetresObservations = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                                rows={2}
                              />
                            </div>
                          </div>
                        </div>

                        {/* PORTES */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Portes</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Nombre de portes</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.portesNombre} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].portesNombre = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>État portes</Label>
                              <Select 
                                value={piece.portesEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].portesEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Observations portes</Label>
                              <Textarea 
                                value={piece.portesObservations} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].portesObservations = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                                rows={2}
                              />
                            </div>
                          </div>
                        </div>

                        {/* ÉCLAIRAGE */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Éclairage et prises</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Points lumineux</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.eclairagePointsLumineux} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].eclairagePointsLumineux = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Interrupteurs</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.eclairageInterrupteurs} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].eclairageInterrupteurs = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Prises électriques</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.eclairagePrises} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].eclairagePrises = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>État électrique</Label>
                              <Select 
                                value={piece.eclairageEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].eclairageEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>
                        </div>

                        {/* CHAUFFAGE */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Chauffage</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Type chauffage</Label>
                              <Select 
                                value={piece.chauffageType} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].chauffageType = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="radiateur">Radiateur</SelectItem>
                                  <SelectItem value="plancher_chauffant">Plancher chauffant</SelectItem>
                                  <SelectItem value="convecteur">Convecteur</SelectItem>
                                  <SelectItem value="aucun">Aucun</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Nombre</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.chauffageNombre} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].chauffageNombre = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>État chauffage</Label>
                              <Select 
                                value={piece.chauffageEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].chauffageEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>
                        </div>

                        {/* ÉQUIPEMENTS CUISINE (si cuisine) */}
                        {(piece.nomPiece === 'cuisine' || piece.nomPiece === 'sejour') && (
                          <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                            <h5 className="font-medium">Équipements cuisine</h5>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Plaque de cuisson</Label>
                                <Select 
                                  value={piece.cuisinePlaque} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisinePlaque = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Hotte</Label>
                                <Select 
                                  value={piece.cuisineHotte} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineHotte = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Four</Label>
                                <Select 
                                  value={piece.cuisineFour} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineFour = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Réfrigérateur</Label>
                                <Select 
                                  value={piece.cuisineFrigo} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineFrigo = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Lave-vaisselle</Label>
                                <Select 
                                  value={piece.cuisineLaveVaisselle} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineLaveVaisselle = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Évier</Label>
                                <Select 
                                  value={piece.cuisineEvier} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineEvier = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="simple">Simple bac</SelectItem>
                                    <SelectItem value="double">Double bac</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2 md:col-span-2">
                                <Label>Meubles cuisine (nombre)</Label>
                                <Input 
                                  type="number"
                                  min="0"
                                  value={piece.cuisineMeubles} 
                                  onChange={(e) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineMeubles = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                />
                              </div>

                              <div className="space-y-2 md:col-span-2">
                                <Label>Observations cuisine</Label>
                                <Textarea 
                                  value={piece.cuisineObservations} 
                                  onChange={(e) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].cuisineObservations = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                  rows={2}
                                />
                              </div>
                            </div>
                          </div>
                        )}

                        {/* ÉQUIPEMENTS SALLE DE BAIN (si sdb) */}
                        {(piece.nomPiece === 'salle_bain' || piece.nomPiece === 'salle_eau') && (
                          <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                            <h5 className="font-medium">Équipements salle de bain</h5>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Baignoire</Label>
                                <Select 
                                  value={piece.sdbBaignoire} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbBaignoire = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Douche</Label>
                                <Select 
                                  value={piece.sdbDouche} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbDouche = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Lavabo</Label>
                                <Select 
                                  value={piece.sdbLavabo} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbLavabo = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Miroir</Label>
                                <Select 
                                  value={piece.sdbMiroir} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbMiroir = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Meubles / Rangements</Label>
                                <Input 
                                  type="number"
                                  min="0"
                                  value={piece.sdbMeubles} 
                                  onChange={(e) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbMeubles = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>État sanitaires</Label>
                                <Select 
                                  value={piece.sdbEtat} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbEtat = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="neuf">Neuf</SelectItem>
                                    <SelectItem value="tres_bon">Très bon</SelectItem>
                                    <SelectItem value="bon">Bon</SelectItem>
                                    <SelectItem value="moyen">Moyen</SelectItem>
                                    <SelectItem value="mauvais">Mauvais</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2 md:col-span-2">
                                <Label>Observations salle de bain</Label>
                                <Textarea 
                                  value={piece.sdbObservations} 
                                  onChange={(e) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].sdbObservations = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                  rows={2}
                                />
                              </div>
                            </div>
                          </div>
                        )}

                        {/* WC */}
                        {piece.nomPiece === 'wc' && (
                          <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                            <h5 className="font-medium">Toilettes</h5>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Type de WC</Label>
                                <Select 
                                  value={piece.wcType} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].wcType = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="suspendu">Suspendu</SelectItem>
                                    <SelectItem value="pose">Au sol</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>État WC</Label>
                                <Select 
                                  value={piece.wcEtat} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].wcEtat = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="neuf">Neuf</SelectItem>
                                    <SelectItem value="tres_bon">Très bon</SelectItem>
                                    <SelectItem value="bon">Bon</SelectItem>
                                    <SelectItem value="moyen">Moyen</SelectItem>
                                    <SelectItem value="mauvais">Mauvais</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Lave-mains</Label>
                                <Select 
                                  value={piece.wcLaveMains} 
                                  onValueChange={(value) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].wcLaveMains = value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Observations WC</Label>
                                <Textarea 
                                  value={piece.wcObservations} 
                                  onChange={(e) => {
                                    const newPieces = [...etatLieuxData.pieces];
                                    newPieces[index].wcObservations = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                  }}
                                  rows={2}
                                />
                              </div>
                            </div>
                          </div>
                        )}

                        {/* RANGEMENTS */}
                        <div className="space-y-3 p-3 bg-blue-50 dark:bg-blue-950 rounded">
                          <h5 className="font-medium">Rangements</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="space-y-2">
                              <Label>Placards</Label>
                              <Input 
                                type="number"
                                min="0"
                                value={piece.rangementsPlacards} 
                                onChange={(e) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].rangementsPlacards = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>État rangements</Label>
                              <Select 
                                value={piece.rangementsEtat} 
                                onValueChange={(value) => {
                                  const newPieces = [...etatLieuxData.pieces];
                                  newPieces[index].rangementsEtat = value;
                                  setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="moyen">Moyen</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>
                        </div>

                        {/* OBSERVATIONS GÉNÉRALES PIÈCE */}
                        <div className="space-y-2">
                          <Label>Observations générales de la pièce</Label>
                          <Textarea 
                            value={piece.observationsGenerales} 
                            onChange={(e) => {
                              const newPieces = [...etatLieuxData.pieces];
                              newPieces[index].observationsGenerales = e.target.value;
                              setEtatLieuxData({...etatLieuxData, pieces: newPieces});
                            }}
                            rows={3}
                            placeholder="Remarques générales, défauts particuliers, éléments à signaler..."
                          />
                        </div>
                      </div>
                    ))}

                    <Button 
                      type="button" 
                      variant="outline"
                      onClick={() => {
                        setEtatLieuxData({
                          ...etatLieuxData, 
                          pieces: [...etatLieuxData.pieces, {
                            nomPiece: '', surface: '', 
                            solRevetement: '', solEtat: '', solObservations: '',
                            mursRevetement: '', mursEtat: '', mursObservations: '',
                            plafondsRevetement: '', plafondsEtat: '', plafondsObservations: '',
                            fenetresNombre: '', fenetresVitrage: '', fenetresEtat: '', fenetresVolets: '', fenetresObservations: '',
                            portesNombre: '', portesEtat: '', portesObservations: '',
                            eclairagePointsLumineux: '', eclairageInterrupteurs: '', eclairagePrises: '', eclairageEtat: '',
                            chauffageType: '', chauffageNombre: '', chauffageEtat: '',
                            cuisinePlaque: '', cuisineHotte: '', cuisineFour: '', cuisineFrigo: '', cuisineLaveVaisselle: '', 
                            cuisineEvier: '', cuisineMeubles: '', cuisineObservations: '',
                            sdbBaignoire: '', sdbDouche: '', sdbLavabo: '', sdbMiroir: '', sdbMeubles: '', sdbEtat: '', sdbObservations: '',
                            wcType: '', wcEtat: '', wcLaveMains: '', wcObservations: '',
                            rangementsPlacards: '', rangementsEtat: '',
                            observationsGenerales: ''
                          }]
                        });
                      }}
                    >
                      + Ajouter une pièce
                    </Button>
                  </div>

                  {/* 7️⃣ INVENTAIRE MOBILIER (si meublé) */}
                  {etatLieuxData.meuble === "oui" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">7️⃣ Inventaire du mobilier (logement meublé)</h3>
                      
                      {etatLieuxData.meubles.map((meuble, index) => (
                        <div key={index} className="p-3 bg-white dark:bg-gray-800 rounded border">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <div className="space-y-2">
                              <Label>Catégorie</Label>
                              <Select 
                                value={meuble.categorie} 
                                onValueChange={(value) => {
                                  const newMeubles = [...etatLieuxData.meubles];
                                  newMeubles[index].categorie = value;
                                  setEtatLieuxData({...etatLieuxData, meubles: newMeubles});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="literie">Literie</SelectItem>
                                  <SelectItem value="table">Table</SelectItem>
                                  <SelectItem value="chaise">Chaise / Fauteuil</SelectItem>
                                  <SelectItem value="rangement">Rangement</SelectItem>
                                  <SelectItem value="electromenager">Électroménager</SelectItem>
                                  <SelectItem value="luminaire">Luminaire</SelectItem>
                                  <SelectItem value="decoration">Décoration</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Description</Label>
                              <Input 
                                value={meuble.description} 
                                onChange={(e) => {
                                  const newMeubles = [...etatLieuxData.meubles];
                                  newMeubles[index].description = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, meubles: newMeubles});
                                }}
                                placeholder="ex: Lit 140x190cm"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Quantité</Label>
                              <Input 
                                type="number"
                                min="1"
                                value={meuble.quantite} 
                                onChange={(e) => {
                                  const newMeubles = [...etatLieuxData.meubles];
                                  newMeubles[index].quantite = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, meubles: newMeubles});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>État</Label>
                              <Select 
                                value={meuble.etat} 
                                onValueChange={(value) => {
                                  const newMeubles = [...etatLieuxData.meubles];
                                  newMeubles[index].etat = value;
                                  setEtatLieuxData({...etatLieuxData, meubles: newMeubles});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="neuf">Neuf</SelectItem>
                                  <SelectItem value="tres_bon">Très bon</SelectItem>
                                  <SelectItem value="bon">Bon</SelectItem>
                                  <SelectItem value="usage">Usage</SelectItem>
                                  <SelectItem value="mauvais">Mauvais</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>

                          {etatLieuxData.meubles.length > 1 && (
                            <Button 
                              type="button" 
                              variant="destructive" 
                              size="sm"
                              className="mt-2"
                              onClick={() => {
                                const newMeubles = etatLieuxData.meubles.filter((_, i) => i !== index);
                                setEtatLieuxData({...etatLieuxData, meubles: newMeubles});
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>
                      ))}

                      <Button 
                        type="button" 
                        variant="outline"
                        onClick={() => {
                          setEtatLieuxData({
                            ...etatLieuxData, 
                            meubles: [...etatLieuxData.meubles, {categorie: '', description: '', quantite: '1', etat: ''}]
                          });
                        }}
                      >
                        + Ajouter un meuble
                      </Button>
                    </div>
                  )}

                  {/* 8️⃣ ANOMALIES ET DÉGRADATIONS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">8️⃣ Anomalies et dégradations constatées</h3>
                    
                    {etatLieuxData.anomalies.map((anomalie, index) => (
                      <div key={index} className="p-3 bg-white dark:bg-gray-800 rounded border">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                          <div className="space-y-2">
                            <Label>Localisation</Label>
                            <Input 
                              value={anomalie.localisation} 
                              onChange={(e) => {
                                const newAnomalies = [...etatLieuxData.anomalies];
                                newAnomalies[index].localisation = e.target.value;
                                setEtatLieuxData({...etatLieuxData, anomalies: newAnomalies});
                              }}
                              placeholder="Ex: Chambre 1, Cuisine..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Type</Label>
                            <Select 
                              value={anomalie.type} 
                              onValueChange={(value) => {
                                const newAnomalies = [...etatLieuxData.anomalies];
                                newAnomalies[index].type = value;
                                setEtatLieuxData({...etatLieuxData, anomalies: newAnomalies});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="fissure">Fissure</SelectItem>
                                <SelectItem value="tache">Tache</SelectItem>
                                <SelectItem value="humidite">Humidité</SelectItem>
                                <SelectItem value="rayure">Rayure</SelectItem>
                                <SelectItem value="trou">Trou</SelectItem>
                                <SelectItem value="cassure">Cassure</SelectItem>
                                <SelectItem value="usure">Usure anormale</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Gravité</Label>
                            <Select 
                              value={anomalie.gravite} 
                              onValueChange={(value) => {
                                const newAnomalies = [...etatLieuxData.anomalies];
                                newAnomalies[index].gravite = value;
                                setEtatLieuxData({...etatLieuxData, anomalies: newAnomalies});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="mineure">Mineure</SelectItem>
                                <SelectItem value="moyenne">Moyenne</SelectItem>
                                <SelectItem value="importante">Importante</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2 md:col-span-3">
                            <Label>Description détaillée</Label>
                            <Textarea 
                              value={anomalie.description} 
                              onChange={(e) => {
                                const newAnomalies = [...etatLieuxData.anomalies];
                                newAnomalies[index].description = e.target.value;
                                setEtatLieuxData({...etatLieuxData, anomalies: newAnomalies});
                              }}
                              rows={2}
                            />
                          </div>
                        </div>

                        {etatLieuxData.anomalies.length > 1 && (
                          <Button 
                            type="button" 
                            variant="destructive" 
                            size="sm"
                            className="mt-2"
                            onClick={() => {
                              const newAnomalies = etatLieuxData.anomalies.filter((_, i) => i !== index);
                              setEtatLieuxData({...etatLieuxData, anomalies: newAnomalies});
                            }}
                          >
                            Supprimer
                          </Button>
                        )}
                      </div>
                    ))}

                    <Button 
                      type="button" 
                      variant="outline"
                      onClick={() => {
                        setEtatLieuxData({
                          ...etatLieuxData, 
                          anomalies: [...etatLieuxData.anomalies, {localisation: '', type: '', gravite: '', description: ''}]
                        });
                      }}
                    >
                      + Ajouter une anomalie
                    </Button>
                  </div>

                  {/* 9️⃣ OBSERVATIONS DES PARTIES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">9️⃣ Observations des parties</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Observations du bailleur</Label>
                        <Textarea 
                          value={etatLieuxData.observationsBailleur} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, observationsBailleur: e.target.value})} 
                          rows={3}
                          placeholder="Remarques particulières du propriétaire..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Observations du locataire</Label>
                        <Textarea 
                          value={etatLieuxData.observationsLocataire} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, observationsLocataire: e.target.value})} 
                          rows={3}
                          placeholder="Remarques particulières du locataire..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Réserves éventuelles</Label>
                        <Textarea 
                          value={etatLieuxData.reserves} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, reserves: e.target.value})} 
                          rows={3}
                          placeholder="Réserves formulées par l'une ou l'autre des parties..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 🔟 PHOTOS ET ANNEXES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🔟 Photos et annexes</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Photos du logement"
                          files={etatLieuxPhotosLogement}
                          onFilesChange={(files) => setEtatLieuxPhotosLogement(files)}
                          accept="image/*"
                          role="avocat"
                        />
                        <p className="text-xs text-muted-foreground">Joindre des photos de chaque pièce et des anomalies constatées</p>
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Photos des compteurs"
                          files={etatLieuxPhotosCompteurs}
                          onFilesChange={(files) => setEtatLieuxPhotosCompteurs(files)}
                          accept="image/*"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Plan du logement"
                          files={etatLieuxPlanLogement}
                          onFilesChange={(files) => setEtatLieuxPlanLogement(files)}
                          accept="image/*,application/pdf"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Diagnostics techniques (DPE, amiante, plomb...)"
                          files={etatLieuxDiagnostics}
                          onFilesChange={(files) => setEtatLieuxDiagnostics(files)}
                          accept="application/pdf,image/*"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nombre total de photos jointes</Label>
                        <Input 
                          type="number"
                          value={etatLieuxData.nombrePhotos} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, nombrePhotos: e.target.value})} 
                          placeholder="Ex: 25"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nombre de pages d'annexes</Label>
                        <Input 
                          type="number"
                          value={etatLieuxData.nombreAnnexes} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, nombreAnnexes: e.target.value})} 
                          placeholder="Ex: 5"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣1️⃣ COMPARATIF ENTRÉE/SORTIE (si sortie) */}
                  {etatLieuxData.typeEtatLieux === "sortie" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">1️⃣1️⃣ Comparatif entrée / sortie</h3>
                      <p className="text-sm text-muted-foreground">Identification des dégradations depuis l'état des lieux d'entrée</p>
                      
                      {etatLieuxData.degradations.map((degradation, index) => (
                        <div key={index} className="p-3 bg-white dark:bg-gray-800 rounded border">
                          <div className="grid grid-cols-1 gap-3">
                            <div className="space-y-2">
                              <Label>Élément dégradé</Label>
                              <Input 
                                value={degradation.element} 
                                onChange={(e) => {
                                  const newDegradations = [...etatLieuxData.degradations];
                                  newDegradations[index].element = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, degradations: newDegradations});
                                }}
                                placeholder="Ex: Mur chambre 1"
                              />
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>État à l'entrée</Label>
                                <Input 
                                  value={degradation.etatEntree} 
                                  onChange={(e) => {
                                    const newDegradations = [...etatLieuxData.degradations];
                                    newDegradations[index].etatEntree = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, degradations: newDegradations});
                                  }}
                                  placeholder="Ex: Bon état, peinture blanche"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>État à la sortie</Label>
                                <Input 
                                  value={degradation.etatSortie} 
                                  onChange={(e) => {
                                    const newDegradations = [...etatLieuxData.degradations];
                                    newDegradations[index].etatSortie = e.target.value;
                                    setEtatLieuxData({...etatLieuxData, degradations: newDegradations});
                                  }}
                                  placeholder="Ex: Trous, rayures"
                                />
                              </div>
                            </div>

                            <div className="space-y-2">
                              <Label>Responsabilité</Label>
                              <Select 
                                value={degradation.responsabilite} 
                                onValueChange={(value) => {
                                  const newDegradations = [...etatLieuxData.degradations];
                                  newDegradations[index].responsabilite = value;
                                  setEtatLieuxData({...etatLieuxData, degradations: newDegradations});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="locataire">Locataire</SelectItem>
                                  <SelectItem value="usure_normale">Usure normale</SelectItem>
                                  <SelectItem value="vetuste">Vétusté</SelectItem>
                                  <SelectItem value="litige">Litige à résoudre</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Coût estimé de réparation (€)</Label>
                              <Input 
                                type="number"
                                step="0.01"
                                value={degradation.coutEstime} 
                                onChange={(e) => {
                                  const newDegradations = [...etatLieuxData.degradations];
                                  newDegradations[index].coutEstime = e.target.value;
                                  setEtatLieuxData({...etatLieuxData, degradations: newDegradations});
                                }}
                              />
                            </div>
                          </div>

                          {etatLieuxData.degradations.length > 1 && (
                            <Button 
                              type="button" 
                              variant="destructive" 
                              size="sm"
                              className="mt-2"
                              onClick={() => {
                                const newDegradations = etatLieuxData.degradations.filter((_, i) => i !== index);
                                setEtatLieuxData({...etatLieuxData, degradations: newDegradations});
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>
                      ))}

                      <Button 
                        type="button" 
                        variant="outline"
                        onClick={() => {
                          setEtatLieuxData({
                            ...etatLieuxData, 
                            degradations: [...etatLieuxData.degradations, {
                              element: '', etatEntree: '', etatSortie: '', responsabilite: '', coutEstime: ''
                            }]
                          });
                        }}
                      >
                        + Ajouter une dégradation
                      </Button>
                    </div>
                  )}

                  {/* 1️⃣2️⃣ RÉCAPITULATIF FINANCIER (si sortie) */}
                  {etatLieuxData.typeEtatLieux === "sortie" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">1️⃣2️⃣ Récapitulatif financier</h3>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Montant du dépôt de garantie versé (€)</Label>
                          <Input 
                            type="number"
                            step="0.01"
                            value={etatLieuxData.depotGarantieVerse} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, depotGarantieVerse: e.target.value})} 
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Total des réparations à la charge du locataire (€)</Label>
                          <Input 
                            type="number"
                            step="0.01"
                            value={etatLieuxData.totalReparations} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, totalReparations: e.target.value})} 
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Montant restitué au locataire (€)</Label>
                          <Input 
                            type="number"
                            step="0.01"
                            value={etatLieuxData.montantRestitue} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, montantRestitue: e.target.value})} 
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Montant retenu (€)</Label>
                          <Input 
                            type="number"
                            step="0.01"
                            value={etatLieuxData.montantRetenu} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, montantRetenu: e.target.value})} 
                          />
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>Modalités de restitution</Label>
                          <Textarea 
                            value={etatLieuxData.modalitesRestitution} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, modalitesRestitution: e.target.value})} 
                            rows={2}
                            placeholder="Ex: Virement sous 2 mois, déduction frais de remise en état..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 1️⃣3️⃣ SIGNATURES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣3️⃣ Signatures et validation</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Bailleur a signé ? *</Label>
                        <Select 
                          value={etatLieuxData.signatureBailleur} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, signatureBailleur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="refuse">A refusé de signer</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Locataire a signé ? *</Label>
                        <Select 
                          value={etatLieuxData.signatureLocataire} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, signatureLocataire: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="refuse">A refusé de signer</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {etatLieuxData.agencePresente === "oui" && (
                        <div className="space-y-2">
                          <Label>Agence a signé ?</Label>
                          <Select 
                            value={etatLieuxData.signatureAgence} 
                            onValueChange={(value) => setEtatLieuxData({...etatLieuxData, signatureAgence: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Nombre d'exemplaires établis *</Label>
                        <Input 
                          type="number"
                          min="2"
                          value={etatLieuxData.nombreExemplaires} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, nombreExemplaires: e.target.value})} 
                          placeholder="Minimum 2"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Observations sur les signatures</Label>
                        <Textarea 
                          value={etatLieuxData.observationsSignatures} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, observationsSignatures: e.target.value})} 
                          rows={2}
                          placeholder="Précisions sur les conditions de signature..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣4️⃣ DOCUMENTS COMPLÉMENTAIRES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣4️⃣ Documents complémentaires</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Contrat de location"
                          files={etatLieuxContratLocation}
                          onFilesChange={(files) => setEtatLieuxContratLocation(files)}
                          accept="application/pdf,image/*"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="État des lieux d'entrée (si état de sortie)"
                          files={etatLieuxEntreeReference}
                          onFilesChange={(files) => setEtatLieuxEntreeReference(files)}
                          accept="application/pdf,image/*"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Devis de réparation"
                          files={etatLieuxDevisReparation}
                          onFilesChange={(files) => setEtatLieuxDevisReparation(files)}
                          accept="application/pdf,image/*"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="Autres documents"
                          files={etatLieuxAutresDocuments}
                          onFilesChange={(files) => setEtatLieuxAutresDocuments(files)}
                          accept="*"
                          role="avocat"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣5️⃣ DÉLAI DE CONTESTATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣5️⃣ ⏱️ Délai de contestation</h3>
                    <p className="text-xs text-blue-600">Mention des délais légaux pour observations complémentaires</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Activer la mention des délais ?</Label>
                        <Select 
                          value={etatLieuxData.mentionDelaiContestationActivee} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, mentionDelaiContestationActivee: value})}
                        >
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, inclure la mention</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {etatLieuxData.mentionDelaiContestationActivee === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Délai pour observations complémentaires (jours)</Label>
                            <Input 
                              type="number"
                              value={etatLieuxData.delaiObservationsComplementaires} 
                              onChange={(e) => setEtatLieuxData({...etatLieuxData, delaiObservationsComplementaires: e.target.value})} 
                              placeholder="10 jours (défaut légal)"
                            />
                            <p className="text-xs text-muted-foreground">Délai légal d'entrée : 10 jours</p>
                          </div>

                          <div className="space-y-2">
                            <Label>Délai pour chauffage collectif (mois)</Label>
                            <Input 
                              type="number"
                              value={etatLieuxData.delaiChauffageCollectif} 
                              onChange={(e) => setEtatLieuxData({...etatLieuxData, delaiChauffageCollectif: e.target.value})} 
                              placeholder="1 mois"
                            />
                            <p className="text-xs text-muted-foreground">Si chauffage collectif actif hors saison de chauffe</p>
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Précisions supplémentaires</Label>
                            <Textarea 
                              value={etatLieuxData.precisionDelaiContestationSupplementaire} 
                              onChange={(e) => setEtatLieuxData({...etatLieuxData, precisionDelaiContestationSupplementaire: e.target.value})} 
                              rows={2}
                              placeholder="Modalités d'envoi des observations, mode de calcul du délai..."
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 1️⃣6️⃣ COMPARAISON ENTRÉE/SORTIE DÉTAILLÉE */}
                  {etatLieuxData.typeEtatLieux === "sortie" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">1️⃣6️⃣ 🔄 Comparaison entrée/sortie détaillée</h3>
                      <p className="text-xs text-blue-600">Référence explicite à l'état des lieux d'entrée et analyse des écarts</p>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Référence de l'état des lieux d'entrée</Label>
                          <Input 
                            value={etatLieuxData.referenceEdlEntree} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, referenceEdlEntree: e.target.value})} 
                            placeholder="N° de document ou référence interne"
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Date de l'état des lieux d'entrée</Label>
                          <Input 
                            type="date"
                            value={etatLieuxData.dateEdlEntree} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, dateEdlEntree: e.target.value})} 
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Comparatif automatique activé ?</Label>
                          <Select 
                            value={etatLieuxData.comparatifAutomatiqueActif} 
                            onValueChange={(value) => setEtatLieuxData({...etatLieuxData, comparatifAutomatiqueActif: value})}
                          >
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non (saisie manuelle)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>Synthèse des écarts constatés</Label>
                          <Textarea 
                            value={etatLieuxData.syntheseEcarts} 
                            onChange={(e) => setEtatLieuxData({...etatLieuxData, syntheseEcarts: e.target.value})} 
                            rows={4}
                            placeholder="Résumé des différences entre l'état d'entrée et de sortie..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 1️⃣7️⃣ USURE NORMALE VS DÉGRADATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣7️⃣ ⚖️ Usure normale vs dégradation</h3>
                    <p className="text-xs text-blue-600">Qualification juridique pour la retenue sur dépôt de garantie</p>
                    
                    {etatLieuxData.qualifications.map((qualification, index) => (
                      <div key={index} className="p-3 border rounded-lg bg-white dark:bg-gray-800 space-y-3">
                        <div className="flex items-center justify-between">
                          <h4 className="font-medium text-sm">Qualification #{index + 1}</h4>
                          {etatLieuxData.qualifications.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              onClick={() => {
                                const newQualifications = etatLieuxData.qualifications.filter((_, i) => i !== index);
                                setEtatLieuxData({...etatLieuxData, qualifications: newQualifications});
                              }}
                            >
                              <Trash2 className="h-4 w-4" />
                            </Button>
                          )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                          <div className="space-y-2">
                            <Label>Élément concerné</Label>
                            <Input 
                              value={qualification.element} 
                              onChange={(e) => {
                                const newQualifications = [...etatLieuxData.qualifications];
                                newQualifications[index].element = e.target.value;
                                setEtatLieuxData({...etatLieuxData, qualifications: newQualifications});
                              }} 
                              placeholder="Ex: Peinture salon, Parquet chambre..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Qualification juridique *</Label>
                            <Select 
                              value={qualification.qualification} 
                              onValueChange={(value) => {
                                const newQualifications = [...etatLieuxData.qualifications];
                                newQualifications[index].qualification = value;
                                setEtatLieuxData({...etatLieuxData, qualifications: newQualifications});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="usure_normale">Usure normale</SelectItem>
                                <SelectItem value="degradation_imputable">Dégradation imputable au locataire</SelectItem>
                                <SelectItem value="vetuste">Vétusté</SelectItem>
                                <SelectItem value="vice_cache">Vice caché</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Justification</Label>
                            <Textarea 
                              value={qualification.justification} 
                              onChange={(e) => {
                                const newQualifications = [...etatLieuxData.qualifications];
                                newQualifications[index].justification = e.target.value;
                                setEtatLieuxData({...etatLieuxData, qualifications: newQualifications});
                              }} 
                              rows={2}
                              placeholder="Arguments juridiques, circonstances, durée d'occupation..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Photos jointes (numéros ou références)</Label>
                            <Input 
                              value={qualification.photos} 
                              onChange={(e) => {
                                const newQualifications = [...etatLieuxData.qualifications];
                                newQualifications[index].photos = e.target.value;
                                setEtatLieuxData({...etatLieuxData, qualifications: newQualifications});
                              }} 
                              placeholder="Ex: Photos 15-18"
                            />
                          </div>
                        </div>
                      </div>
                    ))}

                    <Button
                      type="button"
                      variant="outline"
                      size="sm"
                      onClick={() => {
                        setEtatLieuxData({
                          ...etatLieuxData, 
                          qualifications: [...etatLieuxData.qualifications, {element: '', qualification: '', justification: '', photos: ''}]
                        });
                      }}
                      className="w-full"
                    >
                      <Plus className="h-4 w-4 mr-2" />
                      Ajouter une qualification
                    </Button>
                  </div>

                  {/* 1️⃣8️⃣ GRILLE DE VÉTUSTÉ */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣8️⃣ 📏 Grille de vétusté</h3>
                    <p className="text-xs text-blue-600">Application d'une grille légale ou contractuelle pour le calcul de la vétusté</p>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Type de grille de vétusté appliquée</Label>
                        <Select 
                          value={etatLieuxData.grilleVetuste} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, grilleVetuste: value})}
                        >
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="aucune">Aucune grille appliquée</SelectItem>
                            <SelectItem value="legale">Grille légale de référence</SelectItem>
                            <SelectItem value="contractuelle">Grille contractuelle (bail)</SelectItem>
                            <SelectItem value="personnalisee">Grille personnalisée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {etatLieuxData.grilleVetuste !== "aucune" && (
                        <>
                          <div className="space-y-2">
                            <Label>Référence de la grille utilisée</Label>
                            <Input 
                              value={etatLieuxData.grilleVetusteReference} 
                              onChange={(e) => setEtatLieuxData({...etatLieuxData, grilleVetusteReference: e.target.value})} 
                              placeholder="Ex: Décret n°..., Article du bail, Nom du barème..."
                            />
                          </div>

                          <div className="space-y-3">
                            <h4 className="font-medium text-sm">Équipements avec calcul de vétusté</h4>
                            
                            {etatLieuxData.equipements.map((equipement, index) => (
                              <div key={index} className="p-3 border rounded-lg bg-white dark:bg-gray-800 space-y-3">
                                <div className="flex items-center justify-between">
                                  <h5 className="font-medium text-xs">Équipement #{index + 1}</h5>
                                  {etatLieuxData.equipements.length > 1 && (
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      onClick={() => {
                                        const newEquipements = etatLieuxData.equipements.filter((_, i) => i !== index);
                                        setEtatLieuxData({...etatLieuxData, equipements: newEquipements});
                                      }}
                                    >
                                      <Trash2 className="h-4 w-4" />
                                    </Button>
                                  )}
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                  <div className="space-y-2">
                                    <Label>Nom de l'équipement</Label>
                                    <Input 
                                      value={equipement.nom} 
                                      onChange={(e) => {
                                        const newEquipements = [...etatLieuxData.equipements];
                                        newEquipements[index].nom = e.target.value;
                                        setEtatLieuxData({...etatLieuxData, equipements: newEquipements});
                                      }} 
                                      placeholder="Ex: Chaudière, Peinture salon..."
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Date de mise en service</Label>
                                    <Input 
                                      type="date"
                                      value={equipement.dateMiseEnService} 
                                      onChange={(e) => {
                                        const newEquipements = [...etatLieuxData.equipements];
                                        newEquipements[index].dateMiseEnService = e.target.value;
                                        setEtatLieuxData({...etatLieuxData, equipements: newEquipements});
                                      }} 
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Durée de vie théorique (années)</Label>
                                    <Input 
                                      type="number"
                                      value={equipement.dureVieTheorique} 
                                      onChange={(e) => {
                                        const newEquipements = [...etatLieuxData.equipements];
                                        newEquipements[index].dureVieTheorique = e.target.value;
                                        setEtatLieuxData({...etatLieuxData, equipements: newEquipements});
                                      }} 
                                      placeholder="Ex: 10"
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Coefficient de vétusté (%)</Label>
                                    <Input 
                                      type="number"
                                      value={equipement.coefficientVetuste} 
                                      onChange={(e) => {
                                        const newEquipements = [...etatLieuxData.equipements];
                                        newEquipements[index].coefficientVetuste = e.target.value;
                                        setEtatLieuxData({...etatLieuxData, equipements: newEquipements});
                                      }} 
                                      placeholder="Ex: 50"
                                    />
                                  </div>
                                </div>
                              </div>
                            ))}

                            <Button
                              type="button"
                              variant="outline"
                              size="sm"
                              onClick={() => {
                                setEtatLieuxData({
                                  ...etatLieuxData, 
                                  equipements: [...etatLieuxData.equipements, {nom: '', dateMiseEnService: '', dureVieTheorique: '', coefficientVetuste: ''}]
                                });
                              }}
                              className="w-full"
                            >
                              <Plus className="h-4 w-4 mr-2" />
                              Ajouter un équipement
                            </Button>
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 1️⃣9️⃣ RACCORDEMENT AU DÉPÔT DE GARANTIE */}
                  {etatLieuxData.typeEtatLieux === "sortie" && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">1️⃣9️⃣ 🧾 Raccordement au dépôt de garantie</h3>
                      <p className="text-xs text-blue-600">Gestion des retenues sur le dépôt de garantie</p>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Dégradations retenues sur le dépôt de garantie ?</Label>
                          <Select 
                            value={etatLieuxData.degradationsRetenuesSurDG} 
                            onValueChange={(value) => setEtatLieuxData({...etatLieuxData, degradationsRetenuesSurDG: value})}
                          >
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui, retenue prévue</SelectItem>
                              <SelectItem value="non">Non, restitution intégrale</SelectItem>
                              <SelectItem value="a_determiner">À déterminer</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {etatLieuxData.degradationsRetenuesSurDG === "oui" && (
                          <>
                            <div className="space-y-2">
                              <Label>Estimation provisoire</Label>
                              <Select 
                                value={etatLieuxData.estimationProvisoire} 
                                onValueChange={(value) => setEtatLieuxData({...etatLieuxData, estimationProvisoire: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="forfaitaire">Forfaitaire</SelectItem>
                                  <SelectItem value="devis">Sur devis</SelectItem>
                                  <SelectItem value="accord_parties">Accord amiable des parties</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Devis joints ?</Label>
                              <Select 
                                value={etatLieuxData.devisJoints} 
                                onValueChange={(value) => setEtatLieuxData({...etatLieuxData, devisJoints: value})}
                              >
                                <SelectTrigger><SelectValue /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="oui">Oui</SelectItem>
                                  <SelectItem value="non">Non</SelectItem>
                                  <SelectItem value="a_fournir">À fournir</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Montant estimé des dégradations (€)</Label>
                              <Input 
                                type="number"
                                value={etatLieuxData.montantEstimeDegradations} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, montantEstimeDegradations: e.target.value})} 
                                placeholder="0.00"
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Détail de la retenue sur DG</Label>
                              <Textarea 
                                value={etatLieuxData.detailRetenueDG} 
                                onChange={(e) => setEtatLieuxData({...etatLieuxData, detailRetenueDG: e.target.value})} 
                                rows={3}
                                placeholder="Description détaillée des réparations, application de la vétusté..."
                              />
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 2️⃣0️⃣ HORODATAGE & INTÉGRITÉ */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣0️⃣ 🖥️ Horodatage & intégrité</h3>
                    <p className="text-xs text-blue-600">Sécurisation de la preuve pour une valeur probante renforcée</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Horodatage automatique activé</Label>
                        <Select 
                          value={etatLieuxData.horodatageAutomatique} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, horodatageAutomatique: value})}
                        >
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (recommandé)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {etatLieuxData.horodatageAutomatique === "oui" && (
                        <div className="space-y-2">
                          <Label>Timestamp de création (lecture seule)</Label>
                          <Input 
                            value={etatLieuxData.timestampCreation || new Date().toISOString()} 
                            readOnly
                            className="bg-gray-100"
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Hash d'intégrité (SHA-256)</Label>
                        <Input 
                          value={etatLieuxData.hashIntegrite} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, hashIntegrite: e.target.value})} 
                          placeholder="Généré automatiquement lors de la sauvegarde"
                          className="font-mono text-xs"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Certificat d'intégrité</Label>
                        <Input 
                          value={etatLieuxData.certificatIntegrite} 
                          onChange={(e) => setEtatLieuxData({...etatLieuxData, certificatIntegrite: e.target.value})} 
                          placeholder="URL ou référence du certificat"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Signature électronique</Label>
                        <Select 
                          value={etatLieuxData.signatureElectronique} 
                          onValueChange={(value) => setEtatLieuxData({...etatLieuxData, signatureElectronique: value})}
                        >
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, signatures électroniques</SelectItem>
                            <SelectItem value="non">Non, signatures manuscrites</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {etatLieuxData.signatureElectronique === "oui" && (
                        <div className="space-y-2">
                          <Label>Méthode de signature électronique</Label>
                          <Select 
                            value={etatLieuxData.methodeSignature} 
                            onValueChange={(value) => setEtatLieuxData({...etatLieuxData, methodeSignature: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="simple">Signature électronique simple</SelectItem>
                              <SelectItem value="avancee">Signature électronique avancée</SelectItem>
                              <SelectItem value="qualifiee">Signature électronique qualifiée (eIDAS)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* ========== FORMULAIRE MISE EN DEMEURE ========== */}
            {pendingContractType === "Mise en demeure de payer le loyer / autres obligations" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  
                  {/* 1️⃣ IDENTIFICATION DU DESTINATAIRE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣ Identification du destinataire (locataire ou défaillant)</h3>
                    
                    <div className="space-y-2">
                      <Label>Statut du destinataire *</Label>
                      <Select 
                        value={miseEnDemeureData.destinataireStatut} 
                        onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, destinataireStatut: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="locataire">Locataire (personne physique)</SelectItem>
                          <SelectItem value="commercant_societe">Commerçant / Société</SelectItem>
                          <SelectItem value="garant">Garant</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <ClientSelector
                      clients={clients}
                      selectedClientId={miseEnDemeureData.destinataireClientId}
                      onClientChange={(value) => {
                        if (value === '') {
                          setMiseEnDemeureData({
                            ...miseEnDemeureData,
                            destinataireClientId: "",
                            destinataireNom: "",
                            destinatairePrenom: "",
                            destinataireAdresse: "",
                            destinataireEmail: "",
                            destinataireTelephone: "",
                          });
                        } else {
                          const selectedClient = clients.find(c => c.id === value) as any;
                          if (selectedClient) {
                            setMiseEnDemeureData({
                              ...miseEnDemeureData,
                              destinataireClientId: value,
                              destinataireNom: selectedClient.nom || "",
                              destinatairePrenom: selectedClient.prenom || "",
                              destinataireAdresse: selectedClient.adresse || "",
                              destinataireEmail: selectedClient.email || "",
                              destinataireTelephone: selectedClient.telephone || "",
                            });
                          }
                        }
                      }}
                      label="Sélectionner le client destinataire"
                      placeholder="Choisir un client"
                    />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {miseEnDemeureData.destinataireStatut !== "commercant_societe" && (
                        <>
                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireNom} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireNom: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input 
                              value={miseEnDemeureData.destinatairePrenom} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinatairePrenom: e.target.value})} 
                            />
                          </div>
                        </>
                      )}
                      
                      {miseEnDemeureData.destinataireStatut === "commercant_societe" && (
                        <>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Dénomination sociale *</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireDenomination} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireDenomination: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Forme juridique</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireFormeJuridique} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireFormeJuridique: e.target.value})} 
                              placeholder="Ex: SARL, SAS..."
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>SIREN</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireSiren} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireSiren: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>RCS</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireRcs} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireRcs: e.target.value})} 
                              placeholder="Ex: RCS Paris 123 456 789"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Représentant légal - Nom</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireRepresentantNom} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireRepresentantNom: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Représentant légal - Prénom</Label>
                            <Input 
                              value={miseEnDemeureData.destinataireRepresentantPrenom} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireRepresentantPrenom: e.target.value})} 
                            />
                          </div>
                        </>
                      )}
                      
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète *</Label>
                        <Input 
                          value={miseEnDemeureData.destinataireAdresse} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireAdresse: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input 
                          type="email"
                          value={miseEnDemeureData.destinataireEmail} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireEmail: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input 
                          value={miseEnDemeureData.destinataireTelephone} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, destinataireTelephone: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* 2️⃣ IDENTIFICATION DE L'ÉMETTEUR */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣ Identification de l'émetteur (bailleur / propriétaire)</h3>
                    
                    <ClientSelector
                      clients={clients}
                      selectedClientId={miseEnDemeureData.emetteurClientId}
                      onClientChange={(value) => {
                        if (value === '') {
                          setMiseEnDemeureData({
                            ...miseEnDemeureData,
                            emetteurClientId: "",
                            emetteurNom: "",
                            emetteurPrenom: "",
                            emetteurDenomination: "",
                            emetteurAdresse: "",
                            emetteurEmail: "",
                            emetteurTelephone: "",
                          });
                        } else {
                          const selectedClient = clients.find(c => c.id === value) as any;
                          if (selectedClient) {
                            setMiseEnDemeureData({
                              ...miseEnDemeureData,
                              emetteurClientId: value,
                              emetteurNom: selectedClient.nom || "",
                              emetteurPrenom: selectedClient.prenom || "",
                              emetteurAdresse: selectedClient.adresse || "",
                              emetteurEmail: selectedClient.email || "",
                              emetteurTelephone: selectedClient.telephone || "",
                            });
                          }
                        }
                      }}
                      label="Sélectionner le client émetteur (bailleur)"
                      placeholder="Choisir un client"
                    />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom *</Label>
                        <Input 
                          value={miseEnDemeureData.emetteurNom} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurNom: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom *</Label>
                        <Input 
                          value={miseEnDemeureData.emetteurPrenom} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurPrenom: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Dénomination sociale (si société)</Label>
                        <Input 
                          value={miseEnDemeureData.emetteurDenomination} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurDenomination: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Représentant légal (si société)</Label>
                        <Input 
                          value={miseEnDemeureData.emetteurRepresentantNom} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurRepresentantNom: e.target.value})} 
                          placeholder="Nom Prénom"
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse *</Label>
                        <Input 
                          value={miseEnDemeureData.emetteurAdresse} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurAdresse: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input 
                          type="email"
                          value={miseEnDemeureData.emetteurEmail} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurEmail: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input 
                          value={miseEnDemeureData.emetteurTelephone} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, emetteurTelephone: e.target.value})} 
                        />
                      </div>
                    </div>

                    <div className="space-y-4 mt-4 pt-4 border-t">
                      <Label>Mandataire (agence / administrateur de biens)</Label>
                      <Select 
                        value={miseEnDemeureData.emetteurMandataire} 
                        onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, emetteurMandataire: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>

                      {miseEnDemeureData.emetteurMandataire === "oui" && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom du mandataire *</Label>
                            <Input 
                              value={miseEnDemeureData.mandataireNom} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, mandataireNom: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Type</Label>
                            <Select 
                              value={miseEnDemeureData.mandataireType} 
                              onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, mandataireType: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="agence">Agence immobilière</SelectItem>
                                <SelectItem value="administrateur">Administrateur de biens</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse du mandataire</Label>
                            <Input 
                              value={miseEnDemeureData.mandataireAdresse} 
                              onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, mandataireAdresse: e.target.value})} 
                            />
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 3️⃣ RAPPEL DU CONTRAT DE BAIL */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">3️⃣ Rappel du contrat de bail</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de bail *</Label>
                        <Select 
                          value={miseEnDemeureData.typeBail} 
                          onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, typeBail: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="habitation_vide">Bail d'habitation (vide)</SelectItem>
                            <SelectItem value="habitation_meuble">Bail d'habitation (meublé)</SelectItem>
                            <SelectItem value="commercial">Bail commercial</SelectItem>
                            <SelectItem value="professionnel">Bail professionnel</SelectItem>
                            <SelectItem value="rural">Bail rural</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Date de signature du bail *</Label>
                        <Input 
                          type="date"
                          value={miseEnDemeureData.dateSignature} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, dateSignature: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Durée du bail</Label>
                        <Input 
                          value={miseEnDemeureData.dureeBail} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, dureeBail: e.target.value})} 
                          placeholder="Ex: 3 ans, 9 ans..."
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse du bien loué *</Label>
                        <Input 
                          value={miseEnDemeureData.adresseBien} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, adresseBien: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Montant du loyer mensuel (€) *</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.montantLoyer} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, montantLoyer: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Montant des charges mensuelles (€)</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.montantCharges} 
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, montantCharges: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4️⃣ MANQUEMENTS CONSTATÉS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">4️⃣ Manquements constatés *</h3>
                    <p className="text-sm text-muted-foreground">Sélectionnez un ou plusieurs manquements reprochés au locataire :</p>
                    
                    <div className="space-y-3">
                      {[
                        { value: "impayesLoyers", label: "Impayés de loyers" },
                        { value: "impayesCharges", label: "Impayés de charges" },
                        { value: "defautAssurance", label: "Défaut d'assurance habitation" },
                        { value: "troublesVoisinage", label: "Troubles de voisinage" },
                        { value: "defautEntretien", label: "Défaut d'entretien courant" },
                        { value: "travauxNonAutorises", label: "Travaux non autorisés" },
                        { value: "sousLocation", label: "Sous-location non autorisée" },
                        { value: "degradations", label: "Dégradations" },
                        { value: "nonRespectUsage", label: "Non-respect de l'usage du bien" },
                        { value: "autre", label: "Autre manquement" },
                      ].map(manquement => (
                        <div key={manquement.value} className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id={`manquement-${manquement.value}`}
                            checked={miseEnDemeureData.manquements.includes(manquement.value)}
                            onChange={(e) => {
                              const updated = e.target.checked
                                ? [...miseEnDemeureData.manquements, manquement.value]
                                : miseEnDemeureData.manquements.filter(m => m !== manquement.value);
                              setMiseEnDemeureData({...miseEnDemeureData, manquements: updated});
                            }}
                            className="h-4 w-4"
                          />
                          <label htmlFor={`manquement-${manquement.value}`} className="text-sm cursor-pointer">
                            {manquement.label}
                          </label>
                        </div>
                      ))}
                    </div>

                    {/* Détails des impayés de loyers */}
                    {miseEnDemeureData.manquements.includes("impayesLoyers") && (
                      <div className="space-y-4 mt-4 p-4 bg-white dark:bg-slate-900 rounded border">
                        <h4 className="font-semibold">Détail des loyers impayés</h4>
                        {miseEnDemeureData.impayesLoyers.map((impaye, index) => (
                          <div key={index} className="grid grid-cols-1 md:grid-cols-4 gap-3 p-3 bg-gray-50 dark:bg-gray-800 rounded">
                            <div className="space-y-2">
                              <Label>Mois *</Label>
                              <Input 
                                type="month"
                                value={impaye.mois} 
                                onChange={(e) => {
                                  const updated = [...miseEnDemeureData.impayesLoyers];
                                  updated[index].mois = e.target.value;
                                  setMiseEnDemeureData({...miseEnDemeureData, impayesLoyers: updated});
                                }}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Montant loyer (€) *</Label>
                              <Input 
                                type="number"
                                step="0.01"
                                value={impaye.montantLoyer} 
                                onChange={(e) => {
                                  const updated = [...miseEnDemeureData.impayesLoyers];
                                  updated[index].montantLoyer = e.target.value;
                                  setMiseEnDemeureData({...miseEnDemeureData, impayesLoyers: updated});
                                }}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Charges (€)</Label>
                              <Input 
                                type="number"
                                step="0.01"
                                value={impaye.montantCharges} 
                                onChange={(e) => {
                                  const updated = [...miseEnDemeureData.impayesLoyers];
                                  updated[index].montantCharges = e.target.value;
                                  setMiseEnDemeureData({...miseEnDemeureData, impayesLoyers: updated});
                                }}
                              />
                            </div>
                            <div className="flex items-end">
                              <Button
                                type="button"
                                variant="destructive"
                                size="sm"
                                onClick={() => {
                                  const updated = miseEnDemeureData.impayesLoyers.filter((_, i) => i !== index);
                                  setMiseEnDemeureData({...miseEnDemeureData, impayesLoyers: updated});
                                }}
                              >
                                Supprimer
                              </Button>
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          onClick={() => {
                            setMiseEnDemeureData({
                              ...miseEnDemeureData,
                              impayesLoyers: [...miseEnDemeureData.impayesLoyers, { mois: "", montantLoyer: "", montantCharges: "", montantTotal: "", retardsCumules: "", penalites: "" }]
                            });
                          }}
                        >
                          + Ajouter un mois impayé
                        </Button>
                      </div>
                    )}

                    {/* Autres manquements avec champ de détail */}
                    {(miseEnDemeureData.manquements.includes("troublesVoisinage") ||
                      miseEnDemeureData.manquements.includes("defautEntretien") ||
                      miseEnDemeureData.manquements.includes("travauxNonAutorises") ||
                      miseEnDemeureData.manquements.includes("sousLocation") ||
                      miseEnDemeureData.manquements.includes("degradations") ||
                      miseEnDemeureData.manquements.includes("autre")) && (
                      <div className="space-y-2 mt-4">
                        <Label>Description détaillée des manquements</Label>
                        <Textarea
                          value={miseEnDemeureData.descriptionManquements}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, descriptionManquements: e.target.value})}
                          placeholder="Décrivez précisément les manquements constatés, les dates, les témoignages..."
                          rows={5}
                        />
                      </div>
                    )}
                  </div>

                  {/* 5️⃣ BASES JURIDIQUES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">5️⃣ Bases juridiques (générées automatiquement)</h3>
                    <div className="p-3 bg-white dark:bg-slate-900 rounded border text-sm">
                      {miseEnDemeureData.typeBail === "habitation_vide" && (
                        <p>
                          <strong>Fondements légaux :</strong><br />
                          • Loi n° 89-462 du 6 juillet 1989 (article 7 : clause résolutoire)<br />
                          • Article 1728 du Code civil (paiement du loyer)<br />
                          • Décret n° 87-713 du 26 août 1987 (procédure de résiliation)
                        </p>
                      )}
                      {miseEnDemeureData.typeBail === "habitation_meuble" && (
                        <p>
                          <strong>Fondements légaux :</strong><br />
                          • Loi n° 89-462 du 6 juillet 1989 (article 25-8 : meublé)<br />
                          • Article 1728 du Code civil (paiement du loyer)<br />
                          • Décret n° 2015-981 du 31 juillet 2015
                        </p>
                      )}
                      {miseEnDemeureData.typeBail === "commercial" && (
                        <p>
                          <strong>Fondements légaux :</strong><br />
                          • Code de commerce (articles L145-1 et suivants)<br />
                          • Article 1728 du Code civil (paiement du loyer)<br />
                          • Clause résolutoire contractuelle
                        </p>
                      )}
                      {!miseEnDemeureData.typeBail && (
                        <p className="text-muted-foreground italic">
                          Les références juridiques s'afficheront une fois le type de bail sélectionné.
                        </p>
                      )}
                    </div>
                  </div>

                  {/* 6️⃣ MONTANT TOTAL RÉCLAMÉ */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">6️⃣ Montant total réclamé</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Arriéré de loyers (€)</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.arriereLoy}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, arriereLoy: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Arriéré de charges (€)</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.arriereCharges}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, arriereCharges: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Intérêts de retard (€)</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.interetsRetard}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, interetsRetard: e.target.value})}
                        />
                        <p className="text-xs text-muted-foreground">Selon le taux légal ou conventionnel</p>
                      </div>
                      <div className="space-y-2">
                        <Label>Pénalités / frais (€)</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.fraisAnnexes}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, fraisAnnexes: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label className="font-bold text-lg">TOTAL (€) *</Label>
                        <Input 
                          type="number"
                          step="0.01"
                          value={miseEnDemeureData.totalDu}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, totalDu: e.target.value})}
                          className="font-bold text-lg"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 7️⃣ DÉLAI ACCORDÉ */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">7️⃣ Délai accordé pour régulariser *</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de délai *</Label>
                      <Select 
                        value={miseEnDemeureData.delaiType} 
                        onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, delaiType: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="8_jours">8 jours (clause résolutoire)</SelectItem>
                          <SelectItem value="30_jours">30 jours (usage courant)</SelectItem>
                          <SelectItem value="contractuel">Selon clause contractuelle</SelectItem>
                          <SelectItem value="libre">Délai personnalisé</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {miseEnDemeureData.delaiType === "libre" && (
                      <div className="space-y-2">
                        <Label>Nombre de jours *</Label>
                        <Input 
                          type="number"
                          value={miseEnDemeureData.delaiJours}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, delaiJours: e.target.value})}
                        />
                      </div>
                    )}

                    {miseEnDemeureData.delaiType === "contractuel" && (
                      <div className="space-y-2">
                        <Label>Précision clause contractuelle</Label>
                        <Input 
                          value={miseEnDemeureData.delaiContractuel}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, delaiContractuel: e.target.value})}
                          placeholder="Ex: Délai prévu à l'article 12 du bail..."
                        />
                      </div>
                    )}
                  </div>

                  {/* 8️⃣ CONSÉQUENCES EN CAS DE NON-RÉGULARISATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">8️⃣ Conséquences en cas de non-régularisation</h3>
                    <p className="text-sm text-muted-foreground">Sélectionnez les conséquences qui seront mentionnées :</p>
                    
                    <div className="space-y-3">
                      {[
                        { value: "resiliation", label: "Résiliation du bail" },
                        { value: "expulsion", label: "Procédure d'expulsion" },
                        { value: "actionJustice", label: "Action en justice pour recouvrement" },
                        { value: "clauseResolutoire", label: "Acquisition de la clause résolutoire" },
                        { value: "commandementQuitter", label: "Délivrance d'un commandement de quitter les lieux" },
                        { value: "interetsRetard", label: "Intérêts de retard majorés" },
                        { value: "fraisProcedure", label: "Frais de procédure à votre charge" },
                      ].map(consequence => (
                        <div key={consequence.value} className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id={`consequence-${consequence.value}`}
                            checked={miseEnDemeureData.consequences.includes(consequence.value)}
                            onChange={(e) => {
                              const updated = e.target.checked
                                ? [...miseEnDemeureData.consequences, consequence.value]
                                : miseEnDemeureData.consequences.filter(c => c !== consequence.value);
                              setMiseEnDemeureData({...miseEnDemeureData, consequences: updated});
                            }}
                            className="h-4 w-4"
                          />
                          <label htmlFor={`consequence-${consequence.value}`} className="text-sm cursor-pointer">
                            {consequence.label}
                          </label>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* 9️⃣ FORME D'ENVOI */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">9️⃣ Forme d'envoi de la mise en demeure *</h3>
                    
                    <div className="space-y-2">
                      <Label>Mode d'envoi *</Label>
                      <Select 
                        value={miseEnDemeureData.formeEnvoi} 
                        onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, formeEnvoi: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="lrar">Lettre recommandée avec accusé de réception (LRAR)</SelectItem>
                          <SelectItem value="huissier">Signification par huissier de justice</SelectItem>
                          <SelectItem value="electronique">Envoi électronique recommandé</SelectItem>
                          <SelectItem value="double_garant">Envoi double (locataire + garant)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {(miseEnDemeureData.formeEnvoi === "double_garant" || miseEnDemeureData.destinataireStatut === "garant") && (
                      <div className="space-y-2">
                        <Label>Envoi également au garant</Label>
                        <Select 
                          value={miseEnDemeureData.envoiGarant} 
                          onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, envoiGarant: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    )}
                  </div>

                  {/* 🔟 PIÈCES JUSTIFICATIVES JOINTES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🔟 Pièces justificatives jointes</h3>
                    <p className="text-sm text-muted-foreground">Joignez les documents prouvant vos allégations :</p>
                    
                    <div className="space-y-4">
                      <div>
                        <Label>Copie du bail</Label>
                        <MultiFileUpload
                          files={medCopieBail}
                          setFiles={setMedCopieBail}
                          label=""
                          role="avocat"
                        />
                      </div>

                      {miseEnDemeureData.manquements.includes("impayesLoyers") && (
                        <>
                          <div>
                            <Label>Historique des loyers et paiements</Label>
                            <MultiFileUpload
                              files={medHistoriqueLoyers}
                              setFiles={setMedHistoriqueLoyers}
                              label=""
                              role="avocat"
                            />
                          </div>
                          <div>
                            <Label>Relevés bancaires / chèques impayés</Label>
                            <MultiFileUpload
                              files={medReleves}
                              setFiles={setMedReleves}
                              label=""
                              role="avocat"
                            />
                          </div>
                          <div>
                            <Label>Tableau de calcul des impayés</Label>
                            <MultiFileUpload
                              files={medTableauCalcul}
                              setFiles={setMedTableauCalcul}
                              label=""
                              role="avocat"
                            />
                          </div>
                        </>
                      )}

                      <div>
                        <Label>Mises en demeure précédentes (le cas échéant)</Label>
                        <MultiFileUpload
                          files={medNotificationsPrecedentes}
                          setFiles={setMedNotificationsPrecedentes}
                          label=""
                          role="avocat"
                        />
                      </div>

                      {miseEnDemeureData.manquements.includes("defautAssurance") && (
                        <div>
                          <Label>Attestation d'assurance non fournie</Label>
                          <MultiFileUpload
                            files={medAttestationAssurance}
                            setFiles={setMedAttestationAssurance}
                            label=""
                            role="avocat"
                          />
                        </div>
                      )}

                      {(miseEnDemeureData.manquements.includes("degradations") || 
                        miseEnDemeureData.manquements.includes("defautEntretien")) && (
                        <div>
                          <Label>Photos des dégradations / manque d'entretien</Label>
                          <MultiFileUpload
                            files={medPhotos}
                            setFiles={setMedPhotos}
                            label=""
                            role="avocat"
                          />
                        </div>
                      )}

                      {miseEnDemeureData.manquements.includes("troublesVoisinage") && (
                        <div>
                          <Label>Rapport d'huissier / constat</Label>
                          <MultiFileUpload
                            files={medRapportHuissier}
                            setFiles={setMedRapportHuissier}
                            label=""
                            role="avocat"
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 1️⃣1️⃣ COORDONNÉES DE RÈGLEMENT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣1️⃣ Coordonnées de règlement</h3>
                    <p className="text-sm text-muted-foreground">Indiquez comment le locataire peut régulariser sa situation :</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>IBAN *</Label>
                        <Input 
                          value={miseEnDemeureData.iban}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, iban: e.target.value})}
                          placeholder="FR76 XXXX XXXX XXXX XXXX XXXX XXX"
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse pour le règlement</Label>
                        <Input 
                          value={miseEnDemeureData.adresseReglement}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, adresseReglement: e.target.value})}
                          placeholder="Adresse où envoyer le paiement"
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de paiement acceptées</Label>
                        <Textarea
                          value={miseEnDemeureData.modalitesAcceptees}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, modalitesAcceptees: e.target.value})}
                          placeholder="Ex: Virement bancaire, chèque, espèces (si montant < 1000€)..."
                          rows={3}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Échelancement autorisé ?</Label>
                        <Select 
                          value={miseEnDemeureData.echelancierAutorise} 
                          onValueChange={(value) => setMiseEnDemeureData({...miseEnDemeureData, echelancierAutorise: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {miseEnDemeureData.echelancierAutorise === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Conditions de l'échelancement</Label>
                          <Textarea
                            value={miseEnDemeureData.conditionsEchelancier}
                            onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, conditionsEchelancier: e.target.value})}
                            placeholder="Ex: 3 versements mensuels, premier versement immédiat..."
                            rows={2}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 1️⃣2️⃣ CLAUSE DE TOLÉRANCE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣2️⃣ Clause de tolérance (facultatif)</h3>
                    
                    <div className="flex items-center space-x-2">
                      <input
                        type="checkbox"
                        id="clause-tolerance"
                        checked={miseEnDemeureData.clauseToleranceActive === "oui"}
                        onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, clauseToleranceActive: e.target.checked ? "oui" : "non"})}
                        className="h-4 w-4"
                      />
                      <label htmlFor="clause-tolerance" className="text-sm cursor-pointer">
                        Inclure une clause de tolérance
                      </label>
                    </div>

                    {miseEnDemeureData.clauseToleranceActive === "oui" && (
                      <div className="space-y-2">
                        <Label>Texte de la clause de tolérance</Label>
                        <Textarea
                          value={miseEnDemeureData.clauseToleranceTexte}
                          onChange={(e) => setMiseEnDemeureData({...miseEnDemeureData, clauseToleranceTexte: e.target.value})}
                          placeholder="Ex: La présente mise en demeure ne constitue pas une renonciation aux droits du bailleur et n'emporte aucune tolérance pour l'avenir..."
                          rows={4}
                        />
                        <p className="text-xs text-muted-foreground italic">
                          Cette clause rappelle que les manquements passés ne seront pas tolérés à l'avenir.
                        </p>
                      </div>
                    )}
                  </div>
                  
                </div>
              </>
            )}

            {/* ========== FORMULAIRE PACTE DE CONCUBINAGE ========== */}
            {pendingContractType === "Pacte de concubinage" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  
                  {/* 1️⃣ IDENTIFICATION DES PARTIES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣ Identification des parties</h3>
                    
                    {/* CONCUBIN 1 */}
                    <div className="space-y-4">
                      <h4 className="font-semibold">Concubin 1</h4>
                      
                      <ClientSelector
                        clients={clients}
                        selectedClientId={pacteConcubinageData.concubin1ClientId}
                        onClientChange={(value) => {
                          if (value === '') {
                            setPacteConcubinageData({
                              ...pacteConcubinageData,
                              concubin1ClientId: "",
                              concubin1Nom: "",
                              concubin1Prenom: "",
                            });
                          } else {
                            const selectedClient = clients.find(c => c.id === value) as any;
                            if (selectedClient) {
                              let situationFamiliale = "";
                              
                              // 1. Essayer d'abord etat_civil (champ direct)
                              if (selectedClient.etat_civil) {
                                situationFamiliale = selectedClient.etat_civil;
                                if (situationFamiliale) {
                                  situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                }
                              }
                              // 2. Sinon essayer situation_matrimoniale
                              else if (selectedClient.situation_matrimoniale) {
                                if (typeof selectedClient.situation_matrimoniale === 'object') {
                                  situationFamiliale = selectedClient.situation_matrimoniale.situation_familiale || '';
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                } else if (typeof selectedClient.situation_matrimoniale === 'string') {
                                  situationFamiliale = selectedClient.situation_matrimoniale;
                                }
                              }
                              // 3. Sinon essayer situation_familiale
                              else if (selectedClient.situation_familiale) {
                                if (typeof selectedClient.situation_familiale === 'object') {
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || '';
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  situationFamiliale = selectedClient.situation_familiale;
                                }
                              }
                              
                              setPacteConcubinageData({
                                ...pacteConcubinageData,
                                concubin1ClientId: value,
                                concubin1Nom: selectedClient.nom || "",
                                concubin1Prenom: selectedClient.prenom || "",
                                concubin1DateNaissance: selectedClient.date_naissance || "",
                                concubin1LieuNaissance: selectedClient.lieu_naissance || "",
                                concubin1Nationalite: selectedClient.nationalite || "",
                                concubin1Adresse: selectedClient.adresse || "",
                                concubin1Profession: selectedClient.profession || "",
                              });
                            }
                          }
                        }}
                        label="Sélectionner le concubin 1"
                        placeholder="Choisir un client"
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin1Nom} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1Nom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin1Prenom} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1Prenom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input 
                            type="date"
                            value={pacteConcubinageData.concubin1DateNaissance} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1DateNaissance: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin1LieuNaissance} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1LieuNaissance: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin1Nationalite} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1Nationalite: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input 
                            value={pacteConcubinageData.concubin1Profession} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1Profession: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse actuelle *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin1Adresse} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin1Adresse: e.target.value})} 
                          />
                        </div>
                      </div>
                    </div>

                    {/* CONCUBIN 2 */}
                    <div className="space-y-4">
                      <h4 className="font-semibold">Concubin 2</h4>
                      
                      <ClientSelector
                        clients={clients}
                        selectedClientId={pacteConcubinageData.concubin2ClientId}
                        onClientChange={(value) => {
                          if (value === '') {
                            setPacteConcubinageData({
                              ...pacteConcubinageData,
                              concubin2ClientId: "",
                              concubin2Nom: "",
                              concubin2Prenom: "",
                            });
                          } else {
                            const selectedClient = clients.find(c => c.id === value) as any;
                            if (selectedClient) {
                              let situationFamiliale = "";
                              
                              // 1. Essayer d'abord etat_civil (champ direct)
                              if (selectedClient.etat_civil) {
                                situationFamiliale = selectedClient.etat_civil;
                                if (situationFamiliale) {
                                  situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                }
                              }
                              // 2. Sinon essayer situation_matrimoniale
                              else if (selectedClient.situation_matrimoniale) {
                                if (typeof selectedClient.situation_matrimoniale === 'object') {
                                  situationFamiliale = selectedClient.situation_matrimoniale.situation_familiale || '';
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                } else if (typeof selectedClient.situation_matrimoniale === 'string') {
                                  situationFamiliale = selectedClient.situation_matrimoniale;
                                }
                              }
                              // 3. Sinon essayer situation_familiale
                              else if (selectedClient.situation_familiale) {
                                if (typeof selectedClient.situation_familiale === 'object') {
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || '';
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  situationFamiliale = selectedClient.situation_familiale;
                                }
                              }
                              
                              setPacteConcubinageData({
                                ...pacteConcubinageData,
                                concubin2ClientId: value,
                                concubin2Nom: selectedClient.nom || "",
                                concubin2Prenom: selectedClient.prenom || "",
                                concubin2DateNaissance: selectedClient.date_naissance || "",
                                concubin2LieuNaissance: selectedClient.lieu_naissance || "",
                                concubin2Nationalite: selectedClient.nationalite || "",
                                concubin2Adresse: selectedClient.adresse || "",
                                concubin2Profession: selectedClient.profession || "",
                              });
                            }
                          }
                        }}
                        label="Sélectionner le concubin 2"
                        placeholder="Choisir un client"
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin2Nom} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2Nom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin2Prenom} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2Prenom: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input 
                            type="date"
                            value={pacteConcubinageData.concubin2DateNaissance} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2DateNaissance: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin2LieuNaissance} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2LieuNaissance: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin2Nationalite} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2Nationalite: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input 
                            value={pacteConcubinageData.concubin2Profession} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2Profession: e.target.value})} 
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse actuelle *</Label>
                          <Input 
                            value={pacteConcubinageData.concubin2Adresse} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, concubin2Adresse: e.target.value})} 
                          />
                        </div>
                      </div>
                    </div>

                    {/* ENFANTS */}
                    <div className="space-y-4 mt-4 pt-4 border-t">
                      <h4 className="font-semibold">Enfants (facultatif)</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Enfants communs</Label>
                          <Select 
                            value={pacteConcubinageData.enfantsCommuns} 
                            onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, enfantsCommuns: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {pacteConcubinageData.enfantsCommuns === "oui" && (
                          <div className="space-y-2">
                            <Label>Nombre d'enfants communs</Label>
                            <Input 
                              type="number"
                              value={pacteConcubinageData.nombreEnfantsCommuns} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, nombreEnfantsCommuns: e.target.value})} 
                            />
                          </div>
                        )}
                        <div className="space-y-2 md:col-span-2">
                          <Label>Enfants d'une précédente union</Label>
                          <Textarea
                            value={pacteConcubinageData.enfantsPrecedenteUnion} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, enfantsPrecedenteUnion: e.target.value})}
                            placeholder="Précisez si l'un ou les deux concubins ont des enfants d'une précédente union..."
                            rows={2}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Garde actuelle des enfants</Label>
                          <Input 
                            value={pacteConcubinageData.gardeEnfants} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, gardeEnfants: e.target.value})}
                            placeholder="Ex: Garde alternée, garde exclusive..."
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 2️⃣ OBJET DU PACTE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣ Objet du pacte</h3>
                    
                    <div className="space-y-2">
                      <Label>Définition du concubinage *</Label>
                      <Textarea
                        value={pacteConcubinageData.definitionConcubinage} 
                        onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, definitionConcubinage: e.target.value})}
                        placeholder="Union de fait, stable et continue..."
                        rows={3}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Aspects couverts par le pacte</Label>
                      <div className="space-y-2">
                        {[
                          { value: "residence", label: "Organisation de la résidence commune" },
                          { value: "charges", label: "Répartition des charges quotidiennes" },
                          { value: "biens", label: "Propriété et gestion des biens" },
                          { value: "depenses", label: "Gestion des dépenses importantes" },
                          { value: "prevoyance", label: "Prévoyance et donations" },
                          { value: "dettes", label: "Gestion des dettes" },
                          { value: "separation", label: "Modalités de séparation" },
                        ].map(aspect => (
                          <div key={aspect.value} className="flex items-center space-x-2">
                            <input 
                              type="checkbox"
                              id={`aspect-${aspect.value}`}
                              checked={pacteConcubinageData.aspectsCouvert.includes(aspect.value)}
                              onChange={(e) => {
                                const newAspects = e.target.checked
                                  ? [...pacteConcubinageData.aspectsCouvert, aspect.value]
                                  : pacteConcubinageData.aspectsCouvert.filter(a => a !== aspect.value);
                                setPacteConcubinageData({...pacteConcubinageData, aspectsCouvert: newAspects});
                              }}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor={`aspect-${aspect.value}`} className="font-normal cursor-pointer">{aspect.label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* 3️⃣ RÉSIDENCE COMMUNE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">3️⃣ Adresse de la résidence commune</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète de la résidence *</Label>
                        <Input 
                          value={pacteConcubinageData.adresseResidenceCommune} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, adresseResidenceCommune: e.target.value})} 
                        />
                      </div>
                      
                      <div className="space-y-2">
                        <Label>Nature du logement *</Label>
                        <Select 
                          value={pacteConcubinageData.natureLogement} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, natureLogement: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="location">Location</SelectItem>
                            <SelectItem value="propriete_commune">Propriété commune</SelectItem>
                            <SelectItem value="propriete_concubin1">Propriété du concubin 1</SelectItem>
                            <SelectItem value="propriete_concubin2">Propriété du concubin 2</SelectItem>
                            <SelectItem value="indivision">Indivision</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Titulaire du bail / propriétaire</Label>
                        <Input 
                          value={pacteConcubinageData.titulaireBail} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, titulaireBail: e.target.value})}
                          placeholder="Nom du/des titulaire(s)"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Détails sur le logement</Label>
                        <Textarea
                          value={pacteConcubinageData.detailsLogement} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, detailsLogement: e.target.value})}
                          placeholder="Surface, nombre de pièces, particularités..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4️⃣ RÉPARTITION DES CHARGES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">4️⃣ Répartition des charges quotidiennes</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Mode de répartition *</Label>
                        <Select 
                          value={pacteConcubinageData.modeRepartitionCharges} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, modeRepartitionCharges: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="50-50">Répartition égalitaire (50/50)</SelectItem>
                            <SelectItem value="proportionnelle">Proportionnelle aux revenus</SelectItem>
                            <SelectItem value="personnalisee">Répartition personnalisée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.modeRepartitionCharges === "proportionnelle" && (
                        <div className="grid grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Part concubin 1 (%)</Label>
                            <Input 
                              type="number"
                              value={pacteConcubinageData.partConcubin1Charges} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, partConcubin1Charges: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Part concubin 2 (%)</Label>
                            <Input 
                              type="number"
                              value={pacteConcubinageData.partConcubin2Charges} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, partConcubin2Charges: e.target.value})} 
                            />
                          </div>
                        </div>
                      )}

                      {pacteConcubinageData.modeRepartitionCharges === "personnalisee" && (
                        <div className="space-y-2">
                          <Label>Détails de la répartition personnalisée</Label>
                          <Textarea
                            value={pacteConcubinageData.detailsRepartitionPersonnalisee} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, detailsRepartitionPersonnalisee: e.target.value})}
                            placeholder="Précisez qui paie quoi..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Charges concernées</Label>
                        <div className="space-y-2">
                          {[
                            { value: "loyer", label: "Loyer ou crédit immobilier" },
                            { value: "charges_locatives", label: "Charges locatives" },
                            { value: "electricite_gaz", label: "Électricité et gaz" },
                            { value: "eau", label: "Eau" },
                            { value: "internet_tel", label: "Internet et téléphone" },
                            { value: "courses", label: "Courses alimentaires" },
                            { value: "entretien", label: "Entretien du logement" },
                          ].map(charge => (
                            <div key={charge.value} className="flex items-center space-x-2">
                              <input 
                                type="checkbox"
                                id={`charge-${charge.value}`}
                                checked={pacteConcubinageData.chargesConcernees.includes(charge.value)}
                                onChange={(e) => {
                                  const newCharges = e.target.checked
                                    ? [...pacteConcubinageData.chargesConcernees, charge.value]
                                    : pacteConcubinageData.chargesConcernees.filter(c => c !== charge.value);
                                  setPacteConcubinageData({...pacteConcubinageData, chargesConcernees: newCharges});
                                }}
                                className="rounded border-gray-300"
                              />
                              <Label htmlFor={`charge-${charge.value}`} className="font-normal cursor-pointer">{charge.label}</Label>
                            </div>
                          ))}
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Compte commun</Label>
                        <Select 
                          value={pacteConcubinageData.compteCommun} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, compteCommun: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, compte commun</SelectItem>
                            <SelectItem value="non">Non, comptes séparés</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.compteCommun === "oui" && (
                        <div className="space-y-2">
                          <Label>Détails du compte commun</Label>
                          <Textarea
                            value={pacteConcubinageData.detailsCompteCommun} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, detailsCompteCommun: e.target.value})}
                            placeholder="Banque, titulaires, montant des versements mensuels..."
                            rows={3}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 5️⃣ PROPRIÉTÉ DES BIENS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">5️⃣ Propriété des biens</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Principe général *</Label>
                        <Select 
                          value={pacteConcubinageData.principeBiens} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, principeBiens: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="separation">Chacun reste propriétaire de ses biens</SelectItem>
                            <SelectItem value="communs">Biens acquis en commun</SelectItem>
                            <SelectItem value="mixte">Mixte (selon les cas)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Biens acquis avant la vie commune</Label>
                        <Textarea
                          value={pacteConcubinageData.biensAvantVieCommune} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, biensAvantVieCommune: e.target.value})}
                          placeholder="Listez les biens importants appartenant à chacun avant le début de la vie commune..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Biens acquis pendant la vie commune</Label>
                        <Textarea
                          value={pacteConcubinageData.biensPendantVieCommune} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, biensPendantVieCommune: e.target.value})}
                          placeholder="Précisez la règle pour les biens acquis ensemble (communs, indivision, etc.)..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Inventaire des meubles et biens</Label>
                        <Select 
                          value={pacteConcubinageData.inventaireBiens} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, inventaireBiens: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, inventaire annexé</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Véhicules</Label>
                        <Textarea
                          value={pacteConcubinageData.vehicules} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, vehicules: e.target.value})}
                          placeholder="Précisez les véhicules et leur propriétaire respectif..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 6️⃣ GESTION DES DÉPENSES IMPORTANTES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">6️⃣ Gestion des dépenses importantes</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Définition d'une dépense importante</Label>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Montant seuil (€)</Label>
                            <Input 
                              type="number"
                              value={pacteConcubinageData.seuilDepenseImportante} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, seuilDepenseImportante: e.target.value})}
                              placeholder="Ex: 1000"
                            />
                          </div>
                        </div>
                        <p className="text-xs text-muted-foreground">
                          Au-delà de ce montant, l'accord des deux concubins sera nécessaire
                        </p>
                      </div>

                      <div className="space-y-2">
                        <Label>Modalité d'accord *</Label>
                        <Select 
                          value={pacteConcubinageData.modaliteAccordDepense} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, modaliteAccordDepense: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Accord unanime des deux concubins</SelectItem>
                            <SelectItem value="ecrit">Accord écrit obligatoire</SelectItem>
                            <SelectItem value="oral">Accord oral suffisant</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Types de dépenses concernées</Label>
                        <Textarea
                          value={pacteConcubinageData.typesDepensesImportantes} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, typesDepensesImportantes: e.target.value})}
                          placeholder="Ex: Achat de voiture, travaux, investissements, emprunts..."
                          rows={3}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 7️⃣ OBLIGATIONS RESPECTIVES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">7️⃣ Obligations respectives des concubins</h3>
                    
                    <div className="space-y-2">
                      <Label>Engagements</Label>
                      <div className="space-y-2">
                        {[
                          { value: "vie_commune", label: "Maintenir une vie commune stable et continue" },
                          { value: "contribution", label: "Contribuer aux charges selon les modalités prévues" },
                          { value: "respect", label: "Respect mutuel et assistance morale" },
                          { value: "fidelite", label: "Fidélité" },
                          { value: "transparence", label: "Transparence financière" },
                          { value: "decisions_communes", label: "Décisions communes pour les dépenses importantes" },
                        ].map(obligation => (
                          <div key={obligation.value} className="flex items-center space-x-2">
                            <input 
                              type="checkbox"
                              id={`obligation-${obligation.value}`}
                              checked={pacteConcubinageData.obligationsRespectives.includes(obligation.value)}
                              onChange={(e) => {
                                const newObligations = e.target.checked
                                  ? [...pacteConcubinageData.obligationsRespectives, obligation.value]
                                  : pacteConcubinageData.obligationsRespectives.filter(o => o !== obligation.value);
                                setPacteConcubinageData({...pacteConcubinageData, obligationsRespectives: newObligations});
                              }}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor={`obligation-${obligation.value}`} className="font-normal cursor-pointer">{obligation.label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Autres engagements spécifiques</Label>
                      <Textarea
                        value={pacteConcubinageData.autresEngagements} 
                        onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, autresEngagements: e.target.value})}
                        placeholder="Précisez d'autres engagements particuliers..."
                        rows={3}
                      />
                    </div>
                  </div>

                  {/* 8️⃣ PRÉVOYANCE ET DONATIONS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">8️⃣ Prévoyance et donations</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Testament</Label>
                        <Select 
                          value={pacteConcubinageData.testament} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, testament: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, testament rédigé</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="en_cours">En cours de rédaction</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.testament === "oui" && (
                        <div className="space-y-2">
                          <Label>Détails du testament</Label>
                          <Textarea
                            value={pacteConcubinageData.detailsTestament} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, detailsTestament: e.target.value})}
                            placeholder="Précisez les grandes lignes du testament..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Donation entre concubins</Label>
                        <Select 
                          value={pacteConcubinageData.donation} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, donation: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, donation effectuée</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="envisagee">Envisagée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.donation === "oui" && (
                        <div className="space-y-2">
                          <Label>Détails de la donation</Label>
                          <Textarea
                            value={pacteConcubinageData.detailsDonation} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, detailsDonation: e.target.value})}
                            placeholder="Précisez l'objet de la donation..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Assurance-vie</Label>
                        <Select 
                          value={pacteConcubinageData.assuranceVie} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, assuranceVie: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, bénéficiaire désigné</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="a_modifier">À modifier</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.assuranceVie === "oui" && (
                        <div className="space-y-2">
                          <Label>Détails de l'assurance-vie</Label>
                          <Textarea
                            value={pacteConcubinageData.detailsAssuranceVie} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, detailsAssuranceVie: e.target.value})}
                            placeholder="Précisez l'organisme, le montant, le bénéficiaire..."
                            rows={3}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Autres dispositions de prévoyance</Label>
                        <Textarea
                          value={pacteConcubinageData.autresPrevoyance} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, autresPrevoyance: e.target.value})}
                          placeholder="Précisez d'autres dispositions (ex: prévoyance décès, invalidité...)..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 9️⃣ GESTION DES DETTES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">9️⃣ Gestion des dettes</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Dettes communes *</Label>
                        <Textarea
                          value={pacteConcubinageData.dettesCommunes} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, dettesCommunes: e.target.value})}
                          placeholder="Liste des dettes contractées ensemble (crédit immobilier, prêt voiture...)..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Dettes personnelles</Label>
                        <Textarea
                          value={pacteConcubinageData.dettesPersonnelles} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, dettesPersonnelles: e.target.value})}
                          placeholder="Dettes contractées individuellement par chaque concubin..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Principe de non-solidarité *</Label>
                        <Select 
                          value={pacteConcubinageData.nonSolidariteDettes} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, nonSolidariteDettes: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, pas de solidarité pour dettes personnelles</SelectItem>
                            <SelectItem value="solidarite_limitee">Solidarité limitée (préciser)</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-muted-foreground">
                          Chacun reste responsable de ses dettes personnelles, l'autre n'est pas solidaire
                        </p>
                      </div>

                      {pacteConcubinageData.nonSolidariteDettes === "solidarite_limitee" && (
                        <div className="space-y-2">
                          <Label>Précisions sur la solidarité limitée</Label>
                          <Textarea
                            value={pacteConcubinageData.precisionsSolidarite} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, precisionsSolidarite: e.target.value})}
                            placeholder="Dans quels cas la solidarité s'applique-t-elle ?..."
                            rows={3}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 🔟 SÉPARATION ET RUPTURE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🔟 Modalités de séparation et rupture</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Modalités de rupture *</Label>
                        <Select 
                          value={pacteConcubinageData.modalitesRupture} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, modalitesRupture: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="libre">Rupture libre unilatérale</SelectItem>
                            <SelectItem value="preavis">Rupture avec préavis (préciser durée)</SelectItem>
                            <SelectItem value="accord_mutuel">Accord mutuel nécessaire</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.modalitesRupture === "preavis" && (
                        <div className="space-y-2">
                          <Label>Durée du préavis (en mois)</Label>
                          <Input 
                            type="number"
                            value={pacteConcubinageData.dureePreavissRupture} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, dureePreavissRupture: e.target.value})}
                            placeholder="Ex: 3"
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Répartition des biens en cas de rupture *</Label>
                        <Textarea
                          value={pacteConcubinageData.repartitionBiensRupture} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, repartitionBiensRupture: e.target.value})}
                          placeholder="Chacun reprend ses biens personnels, partage des biens communs à 50/50..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Sort du logement commun</Label>
                        <Textarea
                          value={pacteConcubinageData.sortLogement} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, sortLogement: e.target.value})}
                          placeholder="Qui quitte le logement ? Délai pour quitter ? Indemnité éventuelle ?..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Remboursements et soultes éventuels</Label>
                        <Textarea
                          value={pacteConcubinageData.remboursements} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, remboursements: e.target.value})}
                          placeholder="Précisez les modalités de remboursement en cas de créances entre concubins..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Autres modalités de séparation</Label>
                        <Textarea
                          value={pacteConcubinageData.autresModalitesSeparation} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, autresModalitesSeparation: e.target.value})}
                          placeholder="Autres dispositions particulières en cas de séparation..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣1️⃣ ENFANTS (facultatif) */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣1️⃣ Dispositions relatives aux enfants (facultatif)</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Inclure des dispositions relatives aux enfants ?</Label>
                        <Select 
                          value={pacteConcubinageData.inclureEnfants} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, inclureEnfants: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.inclureEnfants === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Contribution aux dépenses des enfants</Label>
                            <Textarea
                              value={pacteConcubinageData.contributionEnfants} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, contributionEnfants: e.target.value})}
                              placeholder="Ex: Répartition 50/50, proportionnelle aux revenus..."
                              rows={3}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Modalités de garde en cas de séparation</Label>
                            <Textarea
                              value={pacteConcubinageData.gardeEnfantsSeparation} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, gardeEnfantsSeparation: e.target.value})}
                              placeholder="Précisez les modalités envisagées (garde alternée, droits de visite...)..."
                              rows={3}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Pension alimentaire en cas de séparation</Label>
                            <Textarea
                              value={pacteConcubinageData.pensionAlimentaire} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, pensionAlimentaire: e.target.value})}
                              placeholder="Précisez les modalités (montant, indexation...)..."
                              rows={3}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Autres dispositions concernant les enfants</Label>
                            <Textarea
                              value={pacteConcubinageData.autresDispositionsEnfants} 
                              onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, autresDispositionsEnfants: e.target.value})}
                              placeholder="Scolarité, santé, activités extrascolaires..."
                              rows={2}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 1️⃣2️⃣ CONFIDENTIALITÉ */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣2️⃣ Confidentialité et règlement des différends</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Clause de confidentialité *</Label>
                        <Select 
                          value={pacteConcubinageData.confidentialite} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, confidentialite: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, informations confidentielles</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-muted-foreground">
                          Les concubins s'engagent à garder confidentielles les informations personnelles et financières
                        </p>
                      </div>

                      <div className="space-y-2">
                        <Label>Règlement amiable des différends *</Label>
                        <Select 
                          value={pacteConcubinageData.reglementAmiable} 
                          onValueChange={(value) => setPacteConcubinageData({...pacteConcubinageData, reglementAmiable: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, tentative de médiation obligatoire</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="facultatif">Facultatif</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {pacteConcubinageData.reglementAmiable === "oui" && (
                        <div className="space-y-2">
                          <Label>Modalités de médiation</Label>
                          <Textarea
                            value={pacteConcubinageData.modalitesMediation} 
                            onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, modalitesMediation: e.target.value})}
                            placeholder="Précisez les modalités (médiateur, délai, coûts...)..."
                            rows={3}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 1️⃣3️⃣ LOI APPLICABLE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣3️⃣ Loi applicable et juridiction</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Loi applicable *</Label>
                        <Input 
                          value={pacteConcubinageData.loiApplicable} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, loiApplicable: e.target.value})}
                          placeholder="Ex: Droit français"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Tribunal compétent *</Label>
                        <Input 
                          value={pacteConcubinageData.tribunalCompetent} 
                          onChange={(e) => setPacteConcubinageData({...pacteConcubinageData, tribunalCompetent: e.target.value})}
                          placeholder="Ex: Tribunal de grande instance de Paris"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣4️⃣ ANNEXES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣4️⃣ Annexes et justificatifs</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Inventaire des meubles et biens</Label>
                        <MultiFileUpload
                          files={pacteInventaireMeubles}
                          onChange={setPacteInventaireMeubles}
                          label="Joindre l'inventaire détaillé"
                          accept=".pdf,.jpg,.jpeg,.png"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Justificatifs d'acquisitions</Label>
                        <MultiFileUpload
                          files={pacteJustificatifsAcquisitions}
                          onChange={setPacteJustificatifsAcquisitions}
                          label="Factures, actes de propriété, etc."
                          accept=".pdf,.jpg,.jpeg,.png"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Tableau de répartition des charges</Label>
                        <MultiFileUpload
                          files={pacteTableauRepartition}
                          onChange={setPacteTableauRepartition}
                          label="Joindre un tableau récapitulatif"
                          accept=".pdf,.xlsx,.xls"
                          role="avocat"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Attestation de vie commune</Label>
                        <MultiFileUpload
                          files={pacteAttestationVieCommune}
                          onChange={setPacteAttestationVieCommune}
                          label="Attestation sur l'honneur ou justificatifs"
                          accept=".pdf,.jpg,.jpeg,.png"
                          role="avocat"
                        />
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Convention parentale */}
            {pendingContractType === "Convention parentale" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  
                  {/* 1️⃣ IDENTIFICATION DES PARENTS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣ Identification des parents</h3>
                    
                    {/* PARENT 1 */}
                    <div className="space-y-4">
                      <h4 className="font-semibold">Parent 1</h4>
                      
                      <ClientSelector
                        clients={clients}
                        value={conventionParentaleData.parent1ClientId}
                        onClientChange={(value) => {
                          if (value === '') {
                            setConventionParentaleData({
                              ...conventionParentaleData,
                              parent1ClientId: "",
                              parent1Nom: "",
                              parent1Prenom: "",
                              parent1DateNaissance: "",
                              parent1LieuNaissance: "",
                              parent1Nationalite: "",
                              parent1Adresse: "",
                              parent1Profession: "",
                              parent1Telephone: "",
                              parent1Email: "",
                            });
                          } else {
                            const selectedClient = clients.find(c => c.id === value) as any;
                            if (selectedClient) {
                              setConventionParentaleData({
                                ...conventionParentaleData,
                                parent1ClientId: value,
                                parent1Nom: selectedClient.nom || "",
                                parent1Prenom: selectedClient.prenom || "",
                                parent1DateNaissance: selectedClient.date_naissance || "",
                                parent1LieuNaissance: selectedClient.lieu_naissance || "",
                                parent1Nationalite: selectedClient.nationalite || "",
                                parent1Adresse: selectedClient.adresse || "",
                                parent1Profession: selectedClient.profession || "",
                                parent1Telephone: selectedClient.telephone || "",
                                parent1Email: selectedClient.email || "",
                              });
                            }
                          }
                        }}
                        label="Sélectionner le parent 1"
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input value={conventionParentaleData.parent1Nom} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Nom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input value={conventionParentaleData.parent1Prenom} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Prenom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={conventionParentaleData.parent1DateNaissance} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1DateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input value={conventionParentaleData.parent1LieuNaissance} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1LieuNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input value={conventionParentaleData.parent1Nationalite} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Nationalite: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input value={conventionParentaleData.parent1Profession} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Profession: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Input value={conventionParentaleData.parent1Adresse} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Adresse: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone</Label>
                          <Input value={conventionParentaleData.parent1Telephone} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Telephone: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Email</Label>
                          <Input type="email" value={conventionParentaleData.parent1Email} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent1Email: e.target.value})} />
                        </div>
                      </div>
                    </div>

                    {/* PARENT 2 */}
                    <div className="space-y-4">
                      <h4 className="font-semibold">Parent 2</h4>
                      
                      <ClientSelector
                        clients={clients}
                        value={conventionParentaleData.parent2ClientId}
                        onClientChange={(value) => {
                          if (value === '') {
                            setConventionParentaleData({
                              ...conventionParentaleData,
                              parent2ClientId: "",
                              parent2Nom: "",
                              parent2Prenom: "",
                              parent2DateNaissance: "",
                              parent2LieuNaissance: "",
                              parent2Nationalite: "",
                              parent2Adresse: "",
                              parent2Profession: "",
                              parent2Telephone: "",
                              parent2Email: "",
                            });
                          } else {
                            const selectedClient = clients.find(c => c.id === value) as any;
                            if (selectedClient) {
                              setConventionParentaleData({
                                ...conventionParentaleData,
                                parent2ClientId: value,
                                parent2Nom: selectedClient.nom || "",
                                parent2Prenom: selectedClient.prenom || "",
                                parent2DateNaissance: selectedClient.date_naissance || "",
                                parent2LieuNaissance: selectedClient.lieu_naissance || "",
                                parent2Nationalite: selectedClient.nationalite || "",
                                parent2Adresse: selectedClient.adresse || "",
                                parent2Profession: selectedClient.profession || "",
                                parent2Telephone: selectedClient.telephone || "",
                                parent2Email: selectedClient.email || "",
                              });
                            }
                          }
                        }}
                        label="Sélectionner le parent 2"
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input value={conventionParentaleData.parent2Nom} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Nom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input value={conventionParentaleData.parent2Prenom} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Prenom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={conventionParentaleData.parent2DateNaissance} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2DateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input value={conventionParentaleData.parent2LieuNaissance} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2LieuNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input value={conventionParentaleData.parent2Nationalite} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Nationalite: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input value={conventionParentaleData.parent2Profession} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Profession: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Input value={conventionParentaleData.parent2Adresse} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Adresse: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone</Label>
                          <Input value={conventionParentaleData.parent2Telephone} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Telephone: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Email</Label>
                          <Input type="email" value={conventionParentaleData.parent2Email} onChange={(e) => setConventionParentaleData({...conventionParentaleData, parent2Email: e.target.value})} />
                        </div>
                      </div>
                    </div>

                    {/* INFORMATIONS COMPLÉMENTAIRES */}
                    <div className="space-y-4 mt-4 pt-4 border-t">
                      <h4 className="font-semibold">Informations complémentaires</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Parents séparés ?</Label>
                          <Select value={conventionParentaleData.parentsSepares} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, parentsSepares: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Divorce en cours ?</Label>
                          <Select value={conventionParentaleData.divorceEnCours} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, divorceEnCours: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse future après séparation (si applicable)</Label>
                          <Textarea value={conventionParentaleData.adresseFutureApresSepar} onChange={(e) => setConventionParentaleData({...conventionParentaleData, adresseFutureApresSepar: e.target.value})} rows={2} />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 2️⃣ IDENTITÉ DES ENFANTS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣ Identité de l'enfant / des enfants</h3>
                    <div className="space-y-4">
                      <p className="text-sm text-muted-foreground">Renseignez les informations de chaque enfant concerné par cette convention.</p>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom de l'enfant</Label>
                          <Input placeholder="Nom" />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom de l'enfant</Label>
                          <Input placeholder="Prénom" />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance</Label>
                          <Input type="date" />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance</Label>
                          <Input placeholder="Ville" />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité</Label>
                          <Input placeholder="Française" />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéro INE (si applicable)</Label>
                          <Input placeholder="Identifiant national élève" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Établissement scolaire</Label>
                          <Input placeholder="Nom de l'école, collège ou lycée" />
                        </div>
                        <div className="space-y-2">
                          <Label>Classe actuelle</Label>
                          <Input placeholder="Ex: CM2, 5ème" />
                        </div>
                        <div className="space-y-2">
                          <Label>Situation médicale particulière</Label>
                          <Textarea rows={2} placeholder="Allergies, traitement, handicap..." />
                        </div>
                      </div>
                      <Button type="button" variant="outline" size="sm" className="mt-2">
                        + Ajouter un autre enfant
                      </Button>
                    </div>
                  </div>

                  {/* 3️⃣ AUTORITÉ PARENTALE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">3️⃣ Autorité parentale</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type d'autorité parentale *</Label>
                        <Select value={conventionParentaleData.typeAutoriteParentale} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, typeAutoriteParentale: value})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="conjointe">Autorité parentale conjointe (par défaut)</SelectItem>
                            <SelectItem value="exclusive">Autorité parentale exclusive</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {conventionParentaleData.typeAutoriteParentale === "exclusive" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Parent ayant l'autorité exclusive</Label>
                          <Select value={conventionParentaleData.parentAutoriteExclusive} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, parentAutoriteExclusive: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="parent1">Parent 1</SelectItem>
                              <SelectItem value="parent2">Parent 2</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Engagement intérêt supérieur de l'enfant</Label>
                        <p className="text-sm text-muted-foreground">Les deux parents s'engagent à agir dans l'intérêt supérieur de l'enfant et à respecter ses besoins affectifs et matériels.</p>
                      </div>
                    </div>
                  </div>

                  {/* 4️⃣ RÉSIDENCE HABITUELLE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">4️⃣ Résidence habituelle de l'enfant</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Type de résidence *</Label>
                        <Select value={conventionParentaleData.typeResidence} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, typeResidence: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="parent1">Résidence chez Parent 1</SelectItem>
                            <SelectItem value="parent2">Résidence chez Parent 2</SelectItem>
                            <SelectItem value="alternee">Résidence alternée</SelectItem>
                            <SelectItem value="alterneeAmenagee">Résidence alternée aménagée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {(conventionParentaleData.typeResidence === "alternee" || conventionParentaleData.typeResidence === "alterneeAmenagee") && (
                        <>
                          <div className="space-y-2">
                            <Label>Modalité d'alternance</Label>
                            <Select value={conventionParentaleData.modaliteAlternance} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, modaliteAlternance: value})}>
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="1semaine">1 semaine / 1 semaine</SelectItem>
                                <SelectItem value="2-2-3">2 jours / 2 jours / 3 jours</SelectItem>
                                <SelectItem value="impaires-paires">Semaines impaires / paires</SelectItem>
                                <SelectItem value="personnalise">Planning personnalisé</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2">
                            <Label>Planning détaillé</Label>
                            <Textarea value={conventionParentaleData.planningDetaille} onChange={(e) => setConventionParentaleData({...conventionParentaleData, planningDetaille: e.target.value})} rows={3} placeholder="Décrivez le planning..." />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 5️⃣ DROIT DE VISITE ET HÉBERGEMENT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">5️⃣ Droit de visite et d'hébergement (DVH)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de DVH</Label>
                        <Select value={conventionParentaleData.typeDVH} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, typeDVH: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="classique">DVH classique</SelectItem>
                            <SelectItem value="elargi">DVH élargi</SelectItem>
                            <SelectItem value="progressif">DVH progressif (jeunes enfants)</SelectItem>
                            <SelectItem value="personnalise">DVH personnalisé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Horaires (début)</Label>
                        <Input type="time" value={conventionParentaleData.heureDebut} onChange={(e) => setConventionParentaleData({...conventionParentaleData, heureDebut: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Horaires (fin)</Label>
                        <Input type="time" value={conventionParentaleData.heureFin} onChange={(e) => setConventionParentaleData({...conventionParentaleData, heureFin: e.target.value})} />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Lieu d'échange</Label>
                        <Input value={conventionParentaleData.lieuEchange} onChange={(e) => setConventionParentaleData({...conventionParentaleData, lieuEchange: e.target.value})} placeholder="Adresse du lieu d'échange" />
                      </div>
                    </div>
                  </div>

                  {/* 6️⃣ VACANCES SCOLAIRES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">6️⃣ Vacances scolaires</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Vacances de Noël</Label>
                        <Input value={conventionParentaleData.vacancesNoel} onChange={(e) => setConventionParentaleData({...conventionParentaleData, vacancesNoel: e.target.value})} placeholder="Ex: Alternance 1 an / 2" />
                      </div>
                      <div className="space-y-2">
                        <Label>Vacances d'hiver</Label>
                        <Input value={conventionParentaleData.vacancesHiver} onChange={(e) => setConventionParentaleData({...conventionParentaleData, vacancesHiver: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Vacances de printemps</Label>
                        <Input value={conventionParentaleData.vacancesPrintemps} onChange={(e) => setConventionParentaleData({...conventionParentaleData, vacancesPrintemps: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Été (Juillet)</Label>
                        <Input value={conventionParentaleData.vacancesEteJuillet} onChange={(e) => setConventionParentaleData({...conventionParentaleData, vacancesEteJuillet: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Été (Août)</Label>
                        <Input value={conventionParentaleData.vacancesEteAout} onChange={(e) => setConventionParentaleData({...conventionParentaleData, vacancesEteAout: e.target.value})} />
                      </div>
                    </div>
                  </div>

                  {/* 7️⃣ PENSION ALIMENTAIRE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">7️⃣ Pension alimentaire</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Montant mensuel (€)</Label>
                        <Input type="number" value={conventionParentaleData.montantPension} onChange={(e) => setConventionParentaleData({...conventionParentaleData, montantPension: e.target.value})} placeholder="Ex: 300" />
                      </div>
                      <div className="space-y-2">
                        <Label>Barème CAF utilisé</Label>
                        <Select value={conventionParentaleData.baremeCafUtilise} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, baremeCafUtilise: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non (montant convenu librement)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Revenus Parent 1 (€/mois)</Label>
                        <Input type="number" value={conventionParentaleData.revenusParent1} onChange={(e) => setConventionParentaleData({...conventionParentaleData, revenusParent1: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Revenus Parent 2 (€/mois)</Label>
                        <Input type="number" value={conventionParentaleData.revenusParent2} onChange={(e) => setConventionParentaleData({...conventionParentaleData, revenusParent2: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Jour de paiement</Label>
                        <Input type="number" min="1" max="31" value={conventionParentaleData.jourPaiement} onChange={(e) => setConventionParentaleData({...conventionParentaleData, jourPaiement: e.target.value})} placeholder="Ex: 5" />
                      </div>
                      <div className="space-y-2">
                        <Label>Mode de paiement</Label>
                        <Select value={conventionParentaleData.modePaiement} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, modePaiement: value})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="virement">Virement bancaire</SelectItem>
                            <SelectItem value="direct">Versement direct</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Indexation annuelle</Label>
                        <Select value={conventionParentaleData.indexationAnnuelle} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, indexationAnnuelle: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (sur indice INSEE)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Frais médicaux</Label>
                        <Input value={conventionParentaleData.fraisMedicaux} onChange={(e) => setConventionParentaleData({...conventionParentaleData, fraisMedicaux: e.target.value})} placeholder="Ex: Répartition 50/50" />
                      </div>
                      <div className="space-y-2">
                        <Label>Frais scolaires</Label>
                        <Input value={conventionParentaleData.fraisScolaires} onChange={(e) => setConventionParentaleData({...conventionParentaleData, fraisScolaires: e.target.value})} placeholder="Ex: Répartition 50/50" />
                      </div>
                      <div className="space-y-2">
                        <Label>Frais périscolaires (cantine, garderie)</Label>
                        <Input value={conventionParentaleData.fraisPeriscolaires} onChange={(e) => setConventionParentaleData({...conventionParentaleData, fraisPeriscolaires: e.target.value})} placeholder="Ex: Pris en charge par parent résidence" />
                      </div>
                    </div>
                  </div>

                  {/* 8️⃣ FRAIS EXTRAORDINAIRES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">8️⃣ Frais extraordinaires</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Définition des frais extraordinaires</Label>
                        <Textarea value={conventionParentaleData.definitionFraisExtraordinaires} onChange={(e) => setConventionParentaleData({...conventionParentaleData, definitionFraisExtraordinaires: e.target.value})} rows={2} placeholder="Ex: Frais médicaux non remboursés > 100€, orthodontie, lunettes, activités exceptionnelles..." />
                      </div>
                      <div className="space-y-2">
                        <Label>Répartition</Label>
                        <Input value={conventionParentaleData.repartitionFraisExtra} onChange={(e) => setConventionParentaleData({...conventionParentaleData, repartitionFraisExtra: e.target.value})} placeholder="Ex: 50/50" />
                      </div>
                      <div className="space-y-2">
                        <Label>Accord préalable nécessaire</Label>
                        <Select value={conventionParentaleData.accordPrealable} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, accordPrealable: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (sauf urgence)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Délai de paiement (jours)</Label>
                        <Input type="number" value={conventionParentaleData.delaiPaiement} onChange={(e) => setConventionParentaleData({...conventionParentaleData, delaiPaiement: e.target.value})} placeholder="Ex: 30" />
                      </div>
                    </div>
                  </div>

                  {/* 9️⃣ SANTÉ ET ÉDUCATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">9️⃣ Santé et éducation</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Coordonnées pédiatre/médecin traitant</Label>
                        <Input value={conventionParentaleData.coordonneesPediatre} onChange={(e) => setConventionParentaleData({...conventionParentaleData, coordonneesPediatre: e.target.value})} placeholder="Nom, téléphone" />
                      </div>
                      <div className="space-y-2">
                        <Label>Suivi médical</Label>
                        <Input value={conventionParentaleData.suiviMedical} onChange={(e) => setConventionParentaleData({...conventionParentaleData, suiviMedical: e.target.value})} placeholder="Ex: Traitement suivi, allergies" />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Décisions médicales importantes</Label>
                        <Textarea value={conventionParentaleData.decisionsMedicalesImportantes} onChange={(e) => setConventionParentaleData({...conventionParentaleData, decisionsMedicalesImportantes: e.target.value})} rows={2} placeholder="Modalités de prise de décision pour interventions chirurgicales, vaccinations..." />
                      </div>
                      <div className="space-y-2">
                        <Label>Établissement scolaire</Label>
                        <Input value={conventionParentaleData.etablissementScolaire} onChange={(e) => setConventionParentaleData({...conventionParentaleData, etablissementScolaire: e.target.value})} placeholder="Nom de l'école" />
                      </div>
                      <div className="space-y-2">
                        <Label>Activités extra-scolaires</Label>
                        <Input value={conventionParentaleData.activitesExtraScolaires} onChange={(e) => setConventionParentaleData({...conventionParentaleData, activitesExtraScolaires: e.target.value})} placeholder="Sport, musique..." />
                      </div>
                    </div>
                  </div>

                  {/* �� COMMUNICATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">�� Communication entre parents</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Mode de communication</Label>
                        <Select value={conventionParentaleData.modeCommunication} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, modeCommunication: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="email">Email</SelectItem>
                            <SelectItem value="sms">SMS</SelectItem>
                            <SelectItem value="application">Application dédiée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Délais de réponse (heures)</Label>
                        <Input type="number" value={conventionParentaleData.delaisReponse} onChange={(e) => setConventionParentaleData({...conventionParentaleData, delaisReponse: e.target.value})} placeholder="Ex: 48" />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣1️⃣ TRANSPORTS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣1️⃣ Transports et déplacements</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Responsable transport aller</Label>
                        <Select value={conventionParentaleData.responsableTransportAller} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, responsableTransportAller: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="parent1">Parent 1</SelectItem>
                            <SelectItem value="parent2">Parent 2</SelectItem>
                            <SelectItem value="partage">Partagé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Responsable transport retour</Label>
                        <Select value={conventionParentaleData.responsableTransportRetour} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, responsableTransportRetour: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="parent1">Parent 1</SelectItem>
                            <SelectItem value="parent2">Parent 2</SelectItem>
                            <SelectItem value="partage">Partagé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu d'échange</Label>
                        <Input value={conventionParentaleData.lieuEchangeTransport} onChange={(e) => setConventionParentaleData({...conventionParentaleData, lieuEchangeTransport: e.target.value})} placeholder="Adresse précise" />
                      </div>
                      <div className="space-y-2">
                        <Label>Répartition coûts transport</Label>
                        <Input value={conventionParentaleData.repartitionCoutsTransport} onChange={(e) => setConventionParentaleData({...conventionParentaleData, repartitionCoutsTransport: e.target.value})} placeholder="Ex: Chacun ses trajets" />
                      </div>
                      <div className="space-y-2">
                        <Label>Autorisation voyages hors France</Label>
                        <Select value={conventionParentaleData.autorisationVoyageHorsFrance} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, autorisationVoyageHorsFrance: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (avec accord préalable)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣2️⃣ à 1️⃣5️⃣ - Sections compactes */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">Dispositions complémentaires</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>1️⃣2️⃣ Objets personnels - Gestion</Label>
                        <Input value={conventionParentaleData.affairesChequeParent} onChange={(e) => setConventionParentaleData({...conventionParentaleData, affairesChequeParent: e.target.value})} placeholder="Ex: Chaque parent fournit affaires" />
                      </div>
                      <div className="space-y-2">
                        <Label>1️⃣3️⃣ Relations famille élargie</Label>
                        <Select value={conventionParentaleData.droitGrandsParents} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, droitGrandsParents: value})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Droit maintenu</SelectItem>
                            <SelectItem value="non">Limité</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>1️⃣5️⃣ Recours médiation</Label>
                        <Select value={conventionParentaleData.recoursMediation} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, recoursMediation: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, avant saisine JAF</SelectItem>
                            <SelectItem value="non">Non obligatoire</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>1️⃣6️⃣ Homologation JAF</Label>
                        <Select value={conventionParentaleData.souhaitHomologation} onValueChange={(value) => setConventionParentaleData({...conventionParentaleData, souhaitHomologation: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Tribunal compétent</Label>
                        <Input value={conventionParentaleData.tribunalCompetent} onChange={(e) => setConventionParentaleData({...conventionParentaleData, tribunalCompetent: e.target.value})} placeholder="Ex: TJ de Paris" />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣7️⃣ SIGNATURE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣7️⃣ Date et lieu de signature</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Lieu de signature</Label>
                        <Input value={conventionParentaleData.lieuSignature} onChange={(e) => setConventionParentaleData({...conventionParentaleData, lieuSignature: e.target.value})} placeholder="Ex: Paris" />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de signature</Label>
                        <Input type="date" value={conventionParentaleData.dateSignature} onChange={(e) => setConventionParentaleData({...conventionParentaleData, dateSignature: e.target.value})} />
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Reconnaissance de dettes */}
            {pendingContractType === "Reconnaissance de dettes" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  
                  {/* 1️⃣ IDENTIFICATION DU DÉBITEUR */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣ Identification du débiteur (personne qui doit l'argent)</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de personne *</Label>
                      <Select value={reconnaissanceDetteData.debiteurTypePersonne} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurTypePersonne: value})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="physique">Personne physique</SelectItem>
                          <SelectItem value="morale">Personne morale (société)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {reconnaissanceDetteData.debiteurTypePersonne === "physique" ? (
                      <>
                        <ClientSelector
                          clients={clients}
                          value={reconnaissanceDetteData.debiteurClientId}
                          onClientChange={(value) => {
                            if (value === '') {
                              setReconnaissanceDetteData({
                                ...reconnaissanceDetteData,
                                debiteurClientId: "",
                                debiteurNom: "",
                                debiteurPrenom: "",
                                debiteurDateNaissance: "",
                                debiteurLieuNaissance: "",
                                debiteurAdresse: "",
                                debiteurNationalite: "",
                                debiteurProfession: "",
                                debiteurEmail: "",
                                debiteurTelephone: "",
                              });
                            } else {
                              const selectedClient = clients.find(c => c.id === value) as any;
                              if (selectedClient) {
                                setReconnaissanceDetteData({
                                  ...reconnaissanceDetteData,
                                  debiteurClientId: value,
                                  debiteurNom: selectedClient.nom || "",
                                  debiteurPrenom: selectedClient.prenom || "",
                                  debiteurDateNaissance: selectedClient.date_naissance || "",
                                  debiteurLieuNaissance: selectedClient.lieu_naissance || "",
                                  debiteurAdresse: selectedClient.adresse || "",
                                  debiteurNationalite: selectedClient.nationalite || "",
                                  debiteurProfession: selectedClient.profession || "",
                                  debiteurEmail: selectedClient.email || "",
                                  debiteurTelephone: selectedClient.telephone || "",
                                });
                              }
                            }
                          }}
                          label="Sélectionner le débiteur"
                        />
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input value={reconnaissanceDetteData.debiteurNom} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurNom: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input value={reconnaissanceDetteData.debiteurPrenom} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurPrenom: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input type="date" value={reconnaissanceDetteData.debiteurDateNaissance} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurDateNaissance: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input value={reconnaissanceDetteData.debiteurLieuNaissance} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurLieuNaissance: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input value={reconnaissanceDetteData.debiteurNationalite} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurNationalite: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input value={reconnaissanceDetteData.debiteurProfession} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurProfession: e.target.value})} />
                          </div>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète *</Label>
                            <Input value={reconnaissanceDetteData.debiteurAdresse} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurAdresse: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input type="email" value={reconnaissanceDetteData.debiteurEmail} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurEmail: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input value={reconnaissanceDetteData.debiteurTelephone} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurTelephone: e.target.value})} />
                          </div>
                        </div>
                      </>
                    ) : (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Dénomination sociale *</Label>
                          <Input value={reconnaissanceDetteData.debiteurDenomination} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurDenomination: e.target.value})} placeholder="Nom de la société" />
                        </div>
                        <div className="space-y-2">
                          <Label>Forme juridique *</Label>
                          <Input value={reconnaissanceDetteData.debiteurFormeJuridique} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurFormeJuridique: e.target.value})} placeholder="SAS, SARL, SA..." />
                        </div>
                        <div className="space-y-2">
                          <Label>SIREN / RCS</Label>
                          <Input value={reconnaissanceDetteData.debiteurSiren} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurSiren: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Siège social *</Label>
                          <Input value={reconnaissanceDetteData.debiteurSiegeSocial} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurSiegeSocial: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Représentant légal *</Label>
                          <Input value={reconnaissanceDetteData.debiteurRepresentant} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, debiteurRepresentant: e.target.value})} placeholder="Nom du représentant" />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 2️⃣ IDENTIFICATION DU CRÉANCIER */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣ Identification du créancier (personne qui prête)</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de personne *</Label>
                      <Select value={reconnaissanceDetteData.creancierTypePersonne} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierTypePersonne: value})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="physique">Personne physique</SelectItem>
                          <SelectItem value="morale">Personne morale (société)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {reconnaissanceDetteData.creancierTypePersonne === "physique" ? (
                      <>
                        <ClientSelector
                          clients={clients}
                          value={reconnaissanceDetteData.creancierClientId}
                          onClientChange={(value) => {
                            if (value === '') {
                              setReconnaissanceDetteData({
                                ...reconnaissanceDetteData,
                                creancierClientId: "",
                                creancierNom: "",
                                creancierPrenom: "",
                                creancierDateNaissance: "",
                                creancierLieuNaissance: "",
                                creancierAdresse: "",
                                creancierNationalite: "",
                                creancierProfession: "",
                                creancierEmail: "",
                                creancierTelephone: "",
                              });
                            } else {
                              const selectedClient = clients.find(c => c.id === value) as any;
                              if (selectedClient) {
                                setReconnaissanceDetteData({
                                  ...reconnaissanceDetteData,
                                  creancierClientId: value,
                                  creancierNom: selectedClient.nom || "",
                                  creancierPrenom: selectedClient.prenom || "",
                                  creancierDateNaissance: selectedClient.date_naissance || "",
                                  creancierLieuNaissance: selectedClient.lieu_naissance || "",
                                  creancierAdresse: selectedClient.adresse || "",
                                  creancierNationalite: selectedClient.nationalite || "",
                                  creancierProfession: selectedClient.profession || "",
                                  creancierEmail: selectedClient.email || "",
                                  creancierTelephone: selectedClient.telephone || "",
                                });
                              }
                            }
                          }}
                          label="Sélectionner le créancier"
                        />
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input value={reconnaissanceDetteData.creancierNom} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierNom: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input value={reconnaissanceDetteData.creancierPrenom} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierPrenom: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input type="date" value={reconnaissanceDetteData.creancierDateNaissance} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierDateNaissance: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input value={reconnaissanceDetteData.creancierLieuNaissance} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierLieuNaissance: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input value={reconnaissanceDetteData.creancierNationalite} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierNationalite: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input value={reconnaissanceDetteData.creancierProfession} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierProfession: e.target.value})} />
                          </div>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète *</Label>
                            <Input value={reconnaissanceDetteData.creancierAdresse} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierAdresse: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input type="email" value={reconnaissanceDetteData.creancierEmail} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierEmail: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input value={reconnaissanceDetteData.creancierTelephone} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierTelephone: e.target.value})} />
                          </div>
                        </div>
                      </>
                    ) : (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Dénomination sociale *</Label>
                          <Input value={reconnaissanceDetteData.creancierDenomination} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierDenomination: e.target.value})} placeholder="Nom de la société" />
                        </div>
                        <div className="space-y-2">
                          <Label>Forme juridique *</Label>
                          <Input value={reconnaissanceDetteData.creancierFormeJuridique} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierFormeJuridique: e.target.value})} placeholder="SAS, SARL, SA..." />
                        </div>
                        <div className="space-y-2">
                          <Label>RCS</Label>
                          <Input value={reconnaissanceDetteData.creancierRcs} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierRcs: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Représentant légal *</Label>
                          <Input value={reconnaissanceDetteData.creancierRepresentant} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, creancierRepresentant: e.target.value})} placeholder="Nom du représentant" />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 3️⃣ MONTANT EXACT DE LA DETTE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">3️⃣ Montant exact de la dette</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Montant en chiffres * (€)</Label>
                        <Input type="number" step="0.01" value={reconnaissanceDetteData.montantChiffres} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, montantChiffres: e.target.value})} placeholder="Ex: 5000.00" />
                      </div>
                      <div className="space-y-2">
                        <Label>Devise</Label>
                        <Select value={reconnaissanceDetteData.devise} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, devise: value})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="EUR">Euro (€)</SelectItem>
                            <SelectItem value="USD">Dollar ($)</SelectItem>
                            <SelectItem value="GBP">Livre (£)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Montant en lettres * (requis pour preuve)</Label>
                        <Input value={reconnaissanceDetteData.montantLettres} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, montantLettres: e.target.value})} placeholder="Ex: Cinq mille euros" />
                      </div>
                    </div>
                  </div>

                  {/* 4️⃣ ORIGINE DE LA DETTE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">4️⃣ Origine de la dette</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Origine de la dette *</Label>
                        <Select value={reconnaissanceDetteData.origineDette} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, origineDette: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="pret">Prêt d'argent</SelectItem>
                            <SelectItem value="vente">Vente à crédit</SelectItem>
                            <SelectItem value="service">Prestation de service impayée</SelectItem>
                            <SelectItem value="travaux">Travaux effectués</SelectItem>
                            <SelectItem value="loyers">Loyers impayés</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Description détaillée de l'origine</Label>
                        <Textarea value={reconnaissanceDetteData.descriptionOrigine} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, descriptionOrigine: e.target.value})} rows={4} placeholder="Décrivez les circonstances de la naissance de la dette..." />
                      </div>
                    </div>
                  </div>

                  {/* 5️⃣ DATE ET MODALITÉS DE REMISE DES FONDS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">5️⃣ Date et modalités de remise des fonds</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Date de remise des fonds *</Label>
                        <Input type="date" value={reconnaissanceDetteData.dateRemiseFonds} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, dateRemiseFonds: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Moyen de remise</Label>
                        <Select value={reconnaissanceDetteData.moyenRemise} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, moyenRemise: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="virement">Virement bancaire</SelectItem>
                            <SelectItem value="cheque">Chèque</SelectItem>
                            <SelectItem value="especes">Espèces</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>

                  {/* 6️⃣ MODALITÉS DE REMBOURSEMENT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">6️⃣ Modalités de remboursement</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Type de remboursement</Label>
                        <Select value={reconnaissanceDetteData.typeRemboursement} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, typeRemboursement: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="uneFois">En une seule fois</SelectItem>
                            <SelectItem value="echelonne">Échelonné (mensualités)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {reconnaissanceDetteData.typeRemboursement === "uneFois" && (
                        <div className="space-y-2">
                          <Label>Date limite de remboursement</Label>
                          <Input type="date" value={reconnaissanceDetteData.dateLimite} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, dateLimite: e.target.value})} />
                        </div>
                      )}
                      {reconnaissanceDetteData.typeRemboursement === "echelonne" && (
                        <>
                          <div className="space-y-2">
                            <Label>Nombre d'échéances</Label>
                            <Input type="number" value={reconnaissanceDetteData.nombreEcheances} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, nombreEcheances: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Montant de chaque échéance (€)</Label>
                            <Input type="number" value={reconnaissanceDetteData.montantEcheance} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, montantEcheance: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Jour de prélèvement</Label>
                            <Input type="number" min="1" max="31" value={reconnaissanceDetteData.jourPrelevement} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, jourPrelevement: e.target.value})} placeholder="Ex: 5" />
                          </div>
                        </>
                      )}
                      <div className="space-y-2">
                        <Label>Remboursement anticipé autorisé</Label>
                        <Select value={reconnaissanceDetteData.remboursementAnticipe} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, remboursementAnticipe: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, sans pénalité</SelectItem>
                            <SelectItem value="ouiPenalite">Oui, avec pénalité</SelectItem>
                            <SelectItem value="non">Non autorisé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>

                  {/* 7️⃣ INTÉRÊTS */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">7️⃣ Intérêts</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Taux d'intérêt (%)</Label>
                        <Input type="number" step="0.01" value={reconnaissanceDetteData.tauxInteret} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, tauxInteret: e.target.value})} placeholder="Ex: 3.5" />
                      </div>
                      <div className="space-y-2">
                        <Label>Type de taux</Label>
                        <Select value={reconnaissanceDetteData.typeTaux} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, typeTaux: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="fixe">Fixe</SelectItem>
                            <SelectItem value="variable">Variable</SelectItem>
                            <SelectItem value="legal">Taux légal</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Point de départ des intérêts</Label>
                        <Input type="date" value={reconnaissanceDetteData.pointDepartInterets} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, pointDepartInterets: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Capitalisation des intérêts</Label>
                        <Select value={reconnaissanceDetteData.capitalisationInterets} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, capitalisationInterets: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non capitalisés</SelectItem>
                            <SelectItem value="annuelle">Capitalisation annuelle</SelectItem>
                            <SelectItem value="mensuelle">Capitalisation mensuelle</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>

                  {/* 8️⃣ GARANTIES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">8️⃣ Garanties</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Caution solidaire</Label>
                        <Select value={reconnaissanceDetteData.cautionSolidaire} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, cautionSolidaire: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {reconnaissanceDetteData.cautionSolidaire === "oui" && (
                        <div className="space-y-2">
                          <Label>Identité de la caution</Label>
                          <Input value={reconnaissanceDetteData.identiteCaution} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, identiteCaution: e.target.value})} placeholder="Nom, prénom, adresse..." />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Nantissement / Hypothèque</Label>
                        <Textarea value={reconnaissanceDetteData.descriptionGaranties} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, descriptionGaranties: e.target.value})} rows={3} placeholder="Description des garanties réelles..." />
                      </div>
                    </div>
                  </div>

                  {/* 9️⃣ CONSÉQUENCES DU NON-PAIEMENT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">9️⃣ Conséquences du non-paiement</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Exigibilité immédiate en cas de défaut</Label>
                        <Select value={reconnaissanceDetteData.exigibiliteImmediate} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, exigibiliteImmediate: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (déchéance du terme)</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Intérêts de retard (% supplémentaires)</Label>
                        <Input type="number" step="0.01" value={reconnaissanceDetteData.interetsRetard} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, interetsRetard: e.target.value})} placeholder="Ex: 5" />
                      </div>
                      <div className="space-y-2">
                        <Label>Clause pénale (montant forfaitaire €)</Label>
                        <Input type="number" value={reconnaissanceDetteData.clausePenale} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, clausePenale: e.target.value})} />
                      </div>
                    </div>
                  </div>

                  {/* �� à 1️⃣3️⃣ CLAUSES LÉGALES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses légales et formalités</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>�� Reconnaissance expresse</Label>
                        <p className="text-sm text-muted-foreground">Le débiteur reconnaît expressément devoir la somme susmentionnée au créancier.</p>
                      </div>
                      <div className="space-y-2">
                        <Label>1️⃣1️⃣ Renonciation à toute contestation</Label>
                        <Select value={reconnaissanceDetteData.renonciationContestation} onValueChange={(value) => setReconnaissanceDetteData({...reconnaissanceDetteData, renonciationContestation: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui, le débiteur renonce à toute contestation</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>1️⃣2️⃣ Clause d'élection de domicile</Label>
                        <Input value={reconnaissanceDetteData.domicileElu} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, domicileElu: e.target.value})} placeholder="Adresse du domicile élu..." />
                      </div>
                      <div className="space-y-2">
                        <Label>1️⃣3️⃣ Loi applicable</Label>
                        <Input value={reconnaissanceDetteData.loiApplicable} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, loiApplicable: e.target.value})} placeholder="Droit français" />
                      </div>
                      <div className="space-y-2">
                        <Label>Tribunal compétent</Label>
                        <Input value={reconnaissanceDetteData.tribunalCompetent} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunal de Paris" />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣4️⃣ SIGNATURE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣4️⃣ Date et lieu de signature</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Lieu de signature</Label>
                        <Input value={reconnaissanceDetteData.lieuSignature} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, lieuSignature: e.target.value})} placeholder="Ex: Paris" />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de signature</Label>
                        <Input type="date" value={reconnaissanceDetteData.dateSignature} onChange={(e) => setReconnaissanceDetteData({...reconnaissanceDetteData, dateSignature: e.target.value})} />
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Mandat de protection future sous seing privé */}
            {pendingContractType === "Mandat de protection future sous seing privé" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  
                  {/* 1️⃣ MANDANT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣ Identification du Mandant</h3>
                    <div className="space-y-4">
                      <ClientSelector
                        label="Client (Mandant)"
                        value={mandatProtectionSousSeingData.mandantClientId}
                        onClientSelect={(client) => {
                          if (client) {
                            setMandatProtectionSousSeingData({
                              ...mandatProtectionSousSeingData,
                              mandantClientId: client.id,
                              mandantNom: client.nom || '',
                              mandantPrenom: client.prenom || '',
                              mandantDateNaissance: client.date_naissance || '',
                              mandantAdresse: client.adresse || '',
                            });
                          }
                        }}
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom du mandant *</Label>
                          <Input value={mandatProtectionSousSeingData.mandantNom} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantNom: e.target.value})} placeholder="NOM" />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du mandant *</Label>
                          <Input value={mandatProtectionSousSeingData.mandantPrenom} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantPrenom: e.target.value})} placeholder="Prénom" />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={mandatProtectionSousSeingData.mandantDateNaissance} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantDateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance</Label>
                          <Input value={mandatProtectionSousSeingData.mandantLieuNaissance} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantLieuNaissance: e.target.value})} placeholder="Ville, Pays" />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité</Label>
                          <Input value={mandatProtectionSousSeingData.mandantNationalite} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantNationalite: e.target.value})} placeholder="Ex: Française" />
                        </div>
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input value={mandatProtectionSousSeingData.mandantProfession} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantProfession: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Textarea value={mandatProtectionSousSeingData.mandantAdresse} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantAdresse: e.target.value})} placeholder="Numéro, rue, code postal, ville" rows={2} />
                        </div>
                        <div className="space-y-2">
                          <Label>Situation familiale</Label>
                          <Select value={mandatProtectionSousSeingData.mandantSituationFamiliale} onValueChange={(value) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantSituationFamiliale: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="celibataire">Célibataire</SelectItem>
                              <SelectItem value="marie">Marié(e)</SelectItem>
                              <SelectItem value="pacse">Pacsé(e)</SelectItem>
                              <SelectItem value="concubin">Concubin(e)</SelectItem>
                              <SelectItem value="divorce">Divorcé(e)</SelectItem>
                              <SelectItem value="veuf">Veuf/Veuve</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Capacité juridique</Label>
                          <Select value={mandatProtectionSousSeingData.mandantCapaciteJuridique} onValueChange={(value) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantCapaciteJuridique: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="pleine">Pleine capacité juridique</SelectItem>
                              <SelectItem value="reduite">Capacité réduite</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Type d'identité</Label>
                          <Select value={mandatProtectionSousSeingData.mandantTypeIdentite} onValueChange={(value) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantTypeIdentite: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="cni">Carte nationale d'identité</SelectItem>
                              <SelectItem value="passeport">Passeport</SelectItem>
                              <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Numéro d'identité</Label>
                          <Input value={mandatProtectionSousSeingData.mandantNumeroIdentite} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandantNumeroIdentite: e.target.value})} placeholder="Numéro de la pièce d'identité" />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 2️⃣ MANDATAIRE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">2️⃣ Identification du Mandataire</h3>
                    <div className="space-y-4">
                      <ClientSelector
                        label="Client (Mandataire)"
                        value={mandatProtectionSousSeingData.mandataireClientId}
                        onClientSelect={(client) => {
                          if (client) {
                            setMandatProtectionSousSeingData({
                              ...mandatProtectionSousSeingData,
                              mandataireClientId: client.id,
                              mandataireNom: client.nom || '',
                              mandatairePrenom: client.prenom || '',
                              mandataireAdresse: client.adresse || '',
                              mandataireTelephone: client.telephone || '',
                              mandataireEmail: client.email || '',
                            });
                          }
                        }}
                      />
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom du mandataire *</Label>
                          <Input value={mandatProtectionSousSeingData.mandataireNom} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireNom: e.target.value})} placeholder="NOM" />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du mandataire *</Label>
                          <Input value={mandatProtectionSousSeingData.mandatairePrenom} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandatairePrenom: e.target.value})} placeholder="Prénom" />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance</Label>
                          <Input type="date" value={mandatProtectionSousSeingData.mandataireDateNaissance} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireDateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lien avec le mandant</Label>
                          <Input value={mandatProtectionSousSeingData.mandataireLienMandant} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireLienMandant: e.target.value})} placeholder="Ex: Fils, Fille, Époux/se, Ami(e)" />
                        </div>
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input value={mandatProtectionSousSeingData.mandataireProfession} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireProfession: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone</Label>
                          <Input value={mandatProtectionSousSeingData.mandataireTelephone} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireTelephone: e.target.value})} placeholder="+33 6 XX XX XX XX" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Email</Label>
                          <Input type="email" value={mandatProtectionSousSeingData.mandataireEmail} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireEmail: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète</Label>
                          <Textarea value={mandatProtectionSousSeingData.mandataireAdresse} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireAdresse: e.target.value})} placeholder="Numéro, rue, code postal, ville" rows={2} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              checked={mandatProtectionSousSeingData.mandataireAcceptationExpresse === "oui"}
                              onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireAcceptationExpresse: e.target.checked ? "oui" : "non"})}
                              className="w-4 h-4"
                            />
                            <span>Acceptation expresse du mandataire *</span>
                          </Label>
                          <p className="text-xs text-muted-foreground">Le mandataire doit accepter expressément la mission qui lui est confiée</p>
                        </div>
                      </div>

                      {/* Mandataire substitut (facultatif) */}
                      <div className="border-t pt-4 mt-4">
                        <h4 className="font-medium text-sm mb-3 text-muted-foreground">Mandataire substitut (facultatif)</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom du substitut</Label>
                            <Input value={mandatProtectionSousSeingData.mandataireSubstitutNom} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireSubstitutNom: e.target.value})} placeholder="NOM" />
                          </div>
                          <div className="space-y-2">
                            <Label>Prénom du substitut</Label>
                            <Input value={mandatProtectionSousSeingData.mandataireSubstitutPrenom} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireSubstitutPrenom: e.target.value})} placeholder="Prénom" />
                          </div>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse du substitut</Label>
                            <Input value={mandatProtectionSousSeingData.mandataireSubstitutAdresse} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireSubstitutAdresse: e.target.value})} />
                          </div>
                          <div className="space-y-2">
                            <Label>Téléphone du substitut</Label>
                            <Input value={mandatProtectionSousSeingData.mandataireSubstitutTelephone} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandataireSubstitutTelephone: e.target.value})} />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 3️⃣ TYPE DE MANDAT */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">3️⃣ Type de mandat *</h3>
                    <div className="space-y-2">
                      {[
                        { value: "personne", label: "Mandat pour la personne", desc: "Uniquement pouvoirs personnels (santé, logement, vie quotidienne)" },
                        { value: "patrimoine", label: "Mandat pour le patrimoine", desc: "Uniquement pouvoirs patrimoniaux (gestion finances, contrats, biens)" },
                        { value: "global", label: "Mandat global", desc: "Pouvoirs personnels ET patrimoniaux" }
                      ].map(option => (
                        <div key={option.value} className="border p-3 rounded-lg hover:bg-blue-100/50 dark:hover:bg-blue-900/30">
                          <Label className="flex items-start gap-3 cursor-pointer">
                            <input
                              type="radio"
                              name="typeMandat"
                              value={option.value}
                              checked={mandatProtectionSousSeingData.typeMandat === option.value}
                              onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, typeMandat: e.target.value})}
                              className="w-4 h-4 mt-1"
                            />
                            <div>
                              <div className="font-medium">{option.label}</div>
                              <div className="text-xs text-muted-foreground mt-1">{option.desc}</div>
                            </div>
                          </Label>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* 4️⃣ ENTRÉE EN VIGUEUR */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">4️⃣ Conditions d'entrée en vigueur</h3>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Condition déclenchant le mandat</Label>
                        <Input 
                          value={mandatProtectionSousSeingData.entreeVigueurCondition} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, entreeVigueurCondition: e.target.value})} 
                          placeholder="Par défaut: Survenance d'une altération des facultés mentales ou corporelles" 
                        />
                        <p className="text-xs text-muted-foreground">Si vide, la condition par défaut sera utilisée</p>
                      </div>
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          <input
                            type="checkbox"
                            checked={mandatProtectionSousSeingData.certificationMedicaleRequise === "oui"}
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, certificationMedicaleRequise: e.target.checked ? "oui" : "non"})}
                            className="w-4 h-4"
                          />
                          <span>Certification médicale requise pour activer le mandat</span>
                        </Label>
                      </div>
                      {mandatProtectionSousSeingData.certificationMedicaleRequise === "oui" && (
                        <div className="space-y-2">
                          <Label>Médecins habilités à établir le certificat</Label>
                          <Textarea 
                            value={mandatProtectionSousSeingData.medecinsHabilites} 
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, medecinsHabilites: e.target.value})} 
                            placeholder="Noms des médecins désignés pour établir le certificat médical constatant l'altération des facultés"
                            rows={2}
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Date d'effet souhaitée (facultatif)</Label>
                        <Input type="date" value={mandatProtectionSousSeingData.dateEffet} onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, dateEffet: e.target.value})} />
                      </div>
                    </div>
                  </div>

                  {/* 5️⃣ POUVOIRS ADMINISTRATIFS */}
                  {(mandatProtectionSousSeingData.typeMandat === "patrimoine" || mandatProtectionSousSeingData.typeMandat === "global") && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">5️⃣ Pouvoirs pour l'administration du patrimoine</h3>
                      <div className="space-y-3">
                        {[
                          { field: "pouvoirPaiementFactures", label: "Payer factures et dépenses courantes" },
                          { field: "pouvoirGestionCompteCourant", label: "Gérer compte courant et opérations bancaires" },
                          { field: "pouvoirSouscriptionContrats", label: "Souscrire contrats (énergie, télécommunications, etc.)" },
                          { field: "pouvoirGestionAidesSociales", label: "Percevoir et gérer aides sociales" },
                          { field: "pouvoirGestionLoyers", label: "Percevoir loyers et gérer baux" },
                          { field: "pouvoirRenouvellementContrats", label: "Renouveler contrats d'assurance" },
                          { field: "pouvoirPlacementFinancier", label: "Effectuer placements financiers" },
                          { field: "pouvoirDeclarationFiscale", label: "Effectuer déclarations fiscales" },
                          { field: "pouvoirGestionAssurances", label: "Gérer contrats d'assurance" },
                          { field: "pouvoirGestionAdministrative", label: "Représenter auprès des administrations" }
                        ].map(power => (
                          <div key={power.field} className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              id={power.field}
                              checked={mandatProtectionSousSeingData[power.field] === "oui"}
                              onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, [power.field]: e.target.checked ? "oui" : "non"})}
                              className="w-4 h-4"
                            />
                            <Label htmlFor={power.field} className="cursor-pointer">{power.label}</Label>
                          </div>
                        ))}
                      </div>
                      <div className="bg-yellow-50 dark:bg-yellow-950 p-3 rounded-lg mt-4">
                        <p className="text-sm font-medium">⚠️ Actes interdits au mandataire</p>
                        <p className="text-xs text-muted-foreground mt-1">Vente de biens immobiliers, donations, testaments, modification du régime matrimonial (nécessitent autorisation judiciaire)</p>
                      </div>
                    </div>
                  )}

                  {/* 6️⃣ POUVOIRS PERSONNELS */}
                  {(mandatProtectionSousSeingData.typeMandat === "personne" || mandatProtectionSousSeingData.typeMandat === "global") && (
                    <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <h3 className="font-semibold text-lg border-b pb-2">6️⃣ Pouvoirs personnels (santé, vie quotidienne)</h3>
                      <div className="space-y-3">
                        {[
                          { field: "pouvoirRdvMedicaux", label: "Prendre rendez-vous médicaux" },
                          { field: "pouvoirAccesDossiersMedicaux", label: "Accéder aux dossiers médicaux" },
                          { field: "pouvoirChoixEtablissementMedical", label: "Choisir établissement médical" },
                          { field: "pouvoirChoixLogement", label: "Choisir lieu de résidence" },
                          { field: "pouvoirOrganisationQuotidien", label: "Organiser vie quotidienne (aide à domicile, repas)" },
                          { field: "pouvoirRelationsAdministrations", label: "Relations avec administrations publiques" },
                          { field: "pouvoirAidesRsaApa", label: "Demander aides RSA, APA, allocations" },
                          { field: "pouvoirCaisseRetraite", label: "Relations avec caisse de retraite" }
                        ].map(power => (
                          <div key={power.field} className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              id={power.field}
                              checked={mandatProtectionSousSeingData[power.field] === "oui"}
                              onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, [power.field]: e.target.checked ? "oui" : "non"})}
                              className="w-4 h-4"
                            />
                            <Label htmlFor={power.field} className="cursor-pointer">{power.label}</Label>
                          </div>
                        ))}
                      </div>
                    </div>
                  )}

                  {/* 7️⃣ OBLIGATIONS DU MANDATAIRE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">7️⃣ Obligations du mandataire</h3>
                    <div className="bg-green-50 dark:bg-green-950 p-4 rounded-lg space-y-2">
                      <div className="flex items-center gap-2">
                        <input type="checkbox" checked disabled className="w-4 h-4" />
                        <span className="text-sm">Agir dans l'intérêt exclusif du mandant</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" checked disabled className="w-4 h-4" />
                        <span className="text-sm">Loyauté et diligence dans l'exécution du mandat</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" checked disabled className="w-4 h-4" />
                        <span className="text-sm">Établir un compte de gestion annuel</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" checked disabled className="w-4 h-4" />
                        <span className="text-sm">Rendre compte au mandant ou à la personne de confiance</span>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" checked disabled className="w-4 h-4" />
                        <span className="text-sm">Contrôle judiciaire possible en cas de besoin</span>
                      </div>
                      <p className="text-xs text-muted-foreground mt-3">Ces obligations sont obligatoires et automatiques</p>
                    </div>
                  </div>

                  {/* 8️⃣ RÉMUNÉRATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">8️⃣ Rémunération du mandataire</h3>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          <input
                            type="checkbox"
                            checked={mandatProtectionSousSeingData.mandatGratuit === "oui"}
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, mandatGratuit: e.target.checked ? "oui" : "non"})}
                            className="w-4 h-4"
                          />
                          <span>Mandat à titre gratuit</span>
                        </Label>
                      </div>
                      {mandatProtectionSousSeingData.mandatGratuit === "non" && (
                        <div className="space-y-2">
                          <Label>Indemnité annuelle (€)</Label>
                          <Input 
                            type="number" 
                            value={mandatProtectionSousSeingData.indemniteAnnuelle} 
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, indemniteAnnuelle: e.target.value})} 
                            placeholder="Montant annuel"
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Frais remboursables</Label>
                        <Textarea 
                          value={mandatProtectionSousSeingData.fraisRemboursables} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, fraisRemboursables: e.target.value})} 
                          placeholder="Ex: Frais de déplacement, frais postaux, frais administratifs"
                          rows={2}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Modalités de preuve des dépenses</Label>
                        <Input 
                          value={mandatProtectionSousSeingData.modalitesPreuveDepenses} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, modalitesPreuveDepenses: e.target.value})} 
                          placeholder="Ex: Factures, tickets, justificatifs"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 9️⃣ DURÉE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">9️⃣ Durée et fin du mandat</h3>
                    <div className="bg-blue-100 dark:bg-blue-900 p-4 rounded-lg space-y-2">
                      <div className="flex items-start gap-2">
                        <span className="text-2xl">⏳</span>
                        <div>
                          <p className="font-medium text-sm">Durée</p>
                          <p className="text-xs text-muted-foreground">Jusqu'à amélioration de l'état de santé du mandant ou son décès</p>
                        </div>
                      </div>
                      <div className="flex items-start gap-2">
                        <span className="text-2xl">⏸️</span>
                        <div>
                          <p className="font-medium text-sm">Suspension si tutelle/curatelle</p>
                          <p className="text-xs text-muted-foreground">Le mandat est automatiquement suspendu en cas d'ouverture d'une mesure de protection judiciaire</p>
                        </div>
                      </div>
                      <div className="flex items-start gap-2">
                        <span className="text-2xl">❌</span>
                        <div>
                          <p className="font-medium text-sm">Caducité automatique</p>
                          <p className="text-xs text-muted-foreground">En cas de décès du mandant ou du mandataire</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 🔟 CONTRÔLE */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">🔟 Contrôle du mandat</h3>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          <input
                            type="checkbox"
                            checked={mandatProtectionSousSeingData.personneConfianceDesignee === "oui"}
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, personneConfianceDesignee: e.target.checked ? "oui" : "non"})}
                            className="w-4 h-4"
                          />
                          <span>Désigner une personne de confiance pour contrôle</span>
                        </Label>
                      </div>
                      {mandatProtectionSousSeingData.personneConfianceDesignee === "oui" && (
                        <div className="space-y-2">
                          <Label>Nom et coordonnées de la personne de confiance</Label>
                          <Textarea 
                            value={mandatProtectionSousSeingData.personneConfianceNom} 
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, personneConfianceNom: e.target.value})} 
                            placeholder="Nom, prénom, adresse, téléphone"
                            rows={2}
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          <input
                            type="checkbox"
                            checked={mandatProtectionSousSeingData.controleAmiableFamille === "oui"}
                            onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, controleAmiableFamille: e.target.checked ? "oui" : "non"})}
                            className="w-4 h-4"
                          />
                          <span>Contrôle amiable par la famille autorisé</span>
                        </Label>
                      </div>
                      <div className="bg-purple-50 dark:bg-purple-950 p-3 rounded-lg">
                        <p className="text-sm font-medium">⚖️ Saisine du juge des tutelles</p>
                        <p className="text-xs text-muted-foreground mt-1">Possibilité pour le mandant, la famille ou le procureur de saisir le juge en cas de difficulté</p>
                      </div>
                      <div className="bg-purple-50 dark:bg-purple-950 p-3 rounded-lg">
                        <p className="text-sm font-medium">📊 Présentation des comptes annuelle obligatoire</p>
                        <p className="text-xs text-muted-foreground mt-1">Le mandataire doit présenter un compte de gestion chaque année</p>
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣1️⃣ RÉVOCATION */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣1️⃣ Modalités de révocation</h3>
                    <div className="bg-red-50 dark:bg-red-950 p-4 rounded-lg space-y-3">
                      <div>
                        <p className="font-medium text-sm">✅ Révocation par le mandant</p>
                        <p className="text-xs text-muted-foreground">Le mandant peut révoquer le mandat à tout moment s'il a conservé sa capacité</p>
                      </div>
                      <div>
                        <p className="font-medium text-sm">⚖️ Révocation par le juge</p>
                        <p className="text-xs text-muted-foreground">Le juge des tutelles peut révoquer le mandat en cas de manquement grave du mandataire</p>
                      </div>
                      <div>
                        <p className="font-medium text-sm">📤 Démission du mandataire</p>
                        <p className="text-xs text-muted-foreground">Le mandataire peut démissionner sous réserve d'en informer le mandant et le juge</p>
                      </div>
                      <div>
                        <p className="font-medium text-sm">📢 Obligation d'informer</p>
                        <p className="text-xs text-muted-foreground">Toute révocation ou démission doit être notifiée aux parties concernées</p>
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣2️⃣ RÈGLES SPÉCIALES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣2️⃣ Règles spéciales (facultatives)</h3>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Directives anticipées (santé, soins, fin de vie)</Label>
                        <Textarea 
                          value={mandatProtectionSousSeingData.directivesAnticipees} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, directivesAnticipees: e.target.value})} 
                          placeholder="Volontés concernant les soins médicaux, acharnement thérapeutique, dons d'organes..."
                          rows={3}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Clause sur hébergement en institution</Label>
                        <Textarea 
                          value={mandatProtectionSousSeingData.clauseHebergementInstitution} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, clauseHebergementInstitution: e.target.value})} 
                          placeholder="Préférences sur EHPAD, établissement médicalisé, maintien à domicile..."
                          rows={2}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Clause sur gestion des animaux domestiques</Label>
                        <Textarea 
                          value={mandatProtectionSousSeingData.clauseGestionAnimaux} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, clauseGestionAnimaux: e.target.value})} 
                          placeholder="Instructions concernant les animaux de compagnie"
                          rows={2}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Clause sur biens personnels précieux</Label>
                        <Textarea 
                          value={mandatProtectionSousSeingData.clauseBiensPersonnels} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, clauseBiensPersonnels: e.target.value})} 
                          placeholder="Instructions concernant bijoux, œuvres d'art, objets de valeur sentimentale..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣3️⃣ ANNEXES (FICHIERS) */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣3️⃣ Annexes et documents justificatifs</h3>
                    <div className="space-y-4">
                      <div>
                        <Label>Carte d'identité du mandant</Label>
                        <p className="text-xs text-muted-foreground mb-2">Copie recto-verso de la pièce d'identité</p>
                        <MultiFileUpload
                          label="Carte d'identité du mandant"
                          files={mandatCarteIdentiteMandant}
                          onFilesChange={setMandatCarteIdentiteMandant}
                          role="avocat"
                        />
                      </div>
                      <div>
                        <Label>Carte d'identité du mandataire</Label>
                        <p className="text-xs text-muted-foreground mb-2">Copie recto-verso de la pièce d'identité</p>
                        <MultiFileUpload
                          label="Carte d'identité du mandataire"
                          files={mandatCarteIdentiteMandataire}
                          onFilesChange={setMandatCarteIdentiteMandataire}
                          role="avocat"
                        />
                      </div>
                      <div>
                        <Label>Justificatif de domicile</Label>
                        <p className="text-xs text-muted-foreground mb-2">Facture récente (moins de 3 mois)</p>
                        <MultiFileUpload
                          label="Justificatif de domicile"
                          files={mandatJustificatifDomicile}
                          onFilesChange={setMandatJustificatifDomicile}
                          role="avocat"
                        />
                      </div>
                      <div>
                        <Label>Certificat médical (si requis)</Label>
                        <p className="text-xs text-muted-foreground mb-2">Certificat établi par médecin inscrit sur liste du procureur</p>
                        <MultiFileUpload
                          label="Certificat médical (si requis)"
                          files={mandatCertificatMedical}
                          onFilesChange={setMandatCertificatMedical}
                          role="avocat"
                        />
                      </div>
                      <div>
                        <Label>Liste des comptes bancaires</Label>
                        <p className="text-xs text-muted-foreground mb-2">Liste complète des comptes, livrets, placements</p>
                        <MultiFileUpload
                          label="Liste des comptes bancaires"
                          files={mandatListeComptesBancaires}
                          onFilesChange={setMandatListeComptesBancaires}
                          role="avocat"
                        />
                      </div>
                      <div>
                        <Label>Inventaire des biens</Label>
                        <p className="text-xs text-muted-foreground mb-2">Inventaire détaillé du patrimoine (immobilier, mobilier, etc.)</p>
                        <MultiFileUpload
                          label="Inventaire des biens"
                          files={mandatInventaireBiens}
                          onFilesChange={setMandatInventaireBiens}
                          role="avocat"
                        />
                      </div>
                      <div>
                        <Label>Coordonnées des proches</Label>
                        <p className="text-xs text-muted-foreground mb-2">Liste des personnes à contacter (famille, amis, médecins)</p>
                        <MultiFileUpload
                          label="Coordonnées des proches"
                          files={mandatCoordonneesProches}
                          onFilesChange={setMandatCoordonneesProches}
                          role="avocat"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣4️⃣ SIGNATURES */}
                  <div className="space-y-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣4️⃣ Signatures</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Lieu de signature *</Label>
                        <Input 
                          value={mandatProtectionSousSeingData.lieuSignature} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, lieuSignature: e.target.value})} 
                          placeholder="Ville"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de signature *</Label>
                        <Input 
                          type="date" 
                          value={mandatProtectionSousSeingData.dateSignature} 
                          onChange={(e) => setMandatProtectionSousSeingData({...mandatProtectionSousSeingData, dateSignature: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* 1️⃣5️⃣ MENTION MANUSCRITE */}
                  <div className="space-y-4 p-4 bg-green-50 dark:bg-green-950 rounded-lg border-2 border-green-300 dark:border-green-700">
                    <h3 className="font-semibold text-lg border-b pb-2">1️⃣5️⃣ Mention manuscrite (générée automatiquement)</h3>
                    <div className="bg-white dark:bg-gray-800 p-4 rounded-lg border">
                      <p className="text-sm font-mono italic text-center">
                        "Je soussigné(e) {mandatProtectionSousSeingData.mandantNom} {mandatProtectionSousSeingData.mandantPrenom}, établis le présent mandat de protection future et donne pouvoir à {mandatProtectionSousSeingData.mandataireNom} {mandatProtectionSousSeingData.mandatairePrenom} d'agir pour moi dans les conditions prévues ci-dessus."
                      </p>
                    </div>
                    <p className="text-xs text-muted-foreground text-center">
                      ✍️ Cette mention devra être recopiée à la main par le mandant lors de la signature du document final
                    </p>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Convention d'indivision */}
            {pendingContractType === "Convention d'indivision" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1. Informations générales */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 Informations générales sur l'indivision</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de bien *</Label>
                        <Select 
                          value={indivisionData.typeBien} 
                          onValueChange={(value) => setIndivisionData({...indivisionData, typeBien: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="immobilier">Immobilier</SelectItem>
                            <SelectItem value="mobilier">Mobilier</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {indivisionData.typeBien === "autre" && (
                        <div className="space-y-2">
                          <Label>Préciser le type de bien</Label>
                          <Input 
                            value={indivisionData.typeBienAutre} 
                            onChange={(e) => setIndivisionData({...indivisionData, typeBienAutre: e.target.value})} 
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Origine de l'indivision *</Label>
                        <Select 
                          value={indivisionData.origineIndivision} 
                          onValueChange={(value) => setIndivisionData({...indivisionData, origineIndivision: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="succession">Succession</SelectItem>
                            <SelectItem value="achat_commun">Achat en commun</SelectItem>
                            <SelectItem value="investissement">Investissement commun</SelectItem>
                            <SelectItem value="donation">Donation</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {indivisionData.origineIndivision === "autre" && (
                        <div className="space-y-2">
                          <Label>Préciser l'origine</Label>
                          <Input 
                            value={indivisionData.origineIndivisionAutre} 
                            onChange={(e) => setIndivisionData({...indivisionData, origineIndivisionAutre: e.target.value})} 
                          />
                        </div>
                      )}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Objet de la convention</Label>
                        <Textarea 
                          value={indivisionData.objetConvention} 
                          onChange={(e) => setIndivisionData({...indivisionData, objetConvention: e.target.value})} 
                          placeholder="Ex: Gestion du bien, répartition des droits, désignation d'un gérant..."
                          rows={3}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 2. Indivisaires */}
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <h3 className="font-semibold text-lg border-b pb-2 flex-1">👥 Indivisaires</h3>
                      <Button
                        type="button"
                        variant="outline"
                        size="sm"
                        className="text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                        onClick={() => {
                          const newId = Math.max(...indivisionData.indivisaires.map(i => i.id), 0) + 1;
                          setIndivisionData({
                            ...indivisionData,
                            indivisaires: [...indivisionData.indivisaires, {
                              id: newId,
                              isClient: false,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              adresse: "",
                              dateNaissance: "",
                              lieuNaissance: "",
                              nationalite: "",
                              profession: "",
                              statutMatrimonial: "",
                              regimeMatrimonial: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                              email: "",
                              telephone: "",
                              quotePart: "",
                              origineQuotePart: "",
                              origineQuotePartAutre: "",
                            }]
                          });
                        }}
                      >
                        + Ajouter un indivisaire
                      </Button>
                    </div>

                    {indivisionData.indivisaires.map((indivisaire, index) => (
                      <div key={indivisaire.id} className="border rounded-lg p-4 space-y-4 bg-muted/30">
                        <div className="flex items-center justify-between">
                          <h4 className="font-medium">Indivisaire {index + 1}</h4>
                          {indivisionData.indivisaires.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="text-red-600 hover:text-red-700 hover:bg-red-50"
                              onClick={() => {
                                setIndivisionData({
                                  ...indivisionData,
                                  indivisaires: indivisionData.indivisaires.filter(i => i.id !== indivisaire.id)
                                });
                              }}
                            >
                              <Trash2 className="w-4 h-4" />
                            </Button>
                          )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Client ou non */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>Cet indivisaire est-il votre client ? *</Label>
                            <RadioGroup
                              value={indivisaire.isClient ? "oui" : "non"}
                              onValueChange={(value) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {
                                  ...newIndivisaires[idx],
                                  isClient: value === "oui",
                                  clientId: value === "oui" ? newIndivisaires[idx].clientId : "",
                                };
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id={`indiv_${indivisaire.id}_client_oui`} />
                                  <Label htmlFor={`indiv_${indivisaire.id}_client_oui`} className="cursor-pointer">Oui (client)</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id={`indiv_${indivisaire.id}_client_non`} />
                                  <Label htmlFor={`indiv_${indivisaire.id}_client_non`} className="cursor-pointer">Non (autre partie)</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {/* Si c'est un client */}
                          {indivisaire.isClient ? (
                            <>
                              <div className="space-y-2 md:col-span-2">
                                <Label>Sélectionner le client *</Label>
                                <ClientSelector
                                  clients={clients}
                                  selectedClientId={indivisaire.clientId}
                                  onClientChange={async (value) => {
                                    const selectedClient = clients.find(c => c.id === value);
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    if (selectedClient) {
                                      console.log('🔍 Client sélectionné:', selectedClient.nom, selectedClient.prenom);
                                      console.log('📋 situation_matrimoniale:', selectedClient.situation_matrimoniale);
                                      console.log('📋 situation_familiale:', selectedClient.situation_familiale);
                                      console.log('📄 id_doc_path:', selectedClient.id_doc_path);
                                      
                                      // Extraire la situation familiale et le régime matrimonial
                                      // Priorité 1: utiliser situation_matrimoniale directement (c'est le champ principal)
                                      let situationFamiliale = selectedClient.situation_matrimoniale || "";
                                      let regimeMatrimonial = "";
                                      
                                      // Extraire le régime matrimonial de l'objet situation_familiale si c'est un objet
                                      if (selectedClient.situation_familiale) {
                                        if (typeof selectedClient.situation_familiale === 'string') {
                                          if (!situationFamiliale) situationFamiliale = selectedClient.situation_familiale;
                                        } else if (typeof selectedClient.situation_familiale === 'object') {
                                          const sitFam = selectedClient.situation_familiale as any;
                                          regimeMatrimonial = sitFam.regime_matrimonial || "";
                                          // Si pas de situation_matrimoniale, essayer de l'extraire de l'objet
                                          if (!situationFamiliale && sitFam.situation_familiale) {
                                            situationFamiliale = sitFam.situation_familiale;
                                          }
                                        }
                                      }
                                      
                                      console.log('📋 situationFamiliale extraite:', situationFamiliale);
                                      console.log('📋 regimeMatrimonial extrait:', regimeMatrimonial);
                                      
                                      newIndivisaires[idx] = {
                                        ...newIndivisaires[idx],
                                        clientId: value,
                                        isClient: true,
                                        nom: selectedClient.nom || "",
                                        prenom: selectedClient.prenom || "",
                                        adresse: selectedClient.adresse || "",
                                        dateNaissance: selectedClient.date_naissance || "",
                                        lieuNaissance: selectedClient.lieu_naissance || "",
                                        nationalite: selectedClient.nationalite || "",
                                        profession: selectedClient.profession || "",
                                        situationFamiliale: situationFamiliale,
                                        regimeMatrimonial: regimeMatrimonial,
                                        typeIdentite: selectedClient.type_identite || "",
                                        numeroIdentite: selectedClient.numero_identite || "",
                                        email: selectedClient.email || "",
                                        telephone: selectedClient.telephone || "",
                                      };
                                      
                                      // Charger automatiquement la carte d'identité depuis Supabase storage
                                      if (selectedClient.id_doc_path) {
                                        console.log('✅ Début chargement document:', selectedClient.id_doc_path);
                                        try {
                                          const { data, error } = await supabase.storage
                                            .from('documents')
                                            .download(selectedClient.id_doc_path);
                                          
                                          if (data && !error) {
                                            console.log('✅ Document téléchargé avec succès');
                                            const fileName = selectedClient.id_doc_path.split('/').pop() || 'identite.pdf';
                                            const file = new File([data], fileName, { type: data.type });
                                            console.log('📁 Fichier créé:', fileName, 'taille:', file.size);
                                            setIndivisairesIdentiteFiles(prev => {
                                              const newState = {
                                                ...prev,
                                                [indivisaire.id]: [file]
                                              };
                                              console.log('📊 Nouveau state identiteFiles:', newState);
                                              return newState;
                                            });
                                            setIndivisairesIdentiteUrls(prev => ({
                                              ...prev,
                                              [indivisaire.id]: [selectedClient.id_doc_path]
                                            }));
                                          } else {
                                            console.error('❌ Erreur téléchargement:', error);
                                          }
                                        } catch (error) {
                                          console.error('❌ Erreur chargement carte identité:', error);
                                        }
                                      } else {
                                        console.log('⚠️ Pas de id_doc_path, recherche dans client_documents pour client:', selectedClient.id);
                                        // Chercher dans client_documents si pas de id_doc_path
                                        try {
                                          const { data: docs, error: docsError } = await supabase
                                            .from('client_documents')
                                            .select('file_path, file_name, document_type')
                                            .eq('client_id', selectedClient.id)
                                            .eq('document_type', 'piece_identite')
                                            .order('uploaded_at', { ascending: false })
                                            .limit(1);
                                          
                                          if (docsError) {
                                            console.error('❌ Erreur recherche documents:', docsError);
                                          } else if (docs && docs.length > 0) {
                                            const idDoc = docs[0];
                                            console.log('📄 Document pièce identité trouvé:', idDoc.file_name);
                                            
                                            const { data, error } = await supabase.storage
                                              .from('documents')
                                              .download(idDoc.file_path);
                                            
                                            if (data && !error) {
                                              console.log('✅ Document téléchargé avec succès depuis client_documents');
                                              const file = new File([data], idDoc.file_name, { type: data.type });
                                              setIndivisairesIdentiteFiles(prev => ({
                                                ...prev,
                                                [indivisaire.id]: [file]
                                              }));
                                              setIndivisairesIdentiteUrls(prev => ({
                                                ...prev,
                                                [indivisaire.id]: [idDoc.file_path]
                                              }));
                                            } else {
                                              console.error('❌ Erreur téléchargement depuis storage:', error);
                                            }
                                          } else {
                                            console.log('ℹ️ Aucune pièce d\'identité trouvée dans client_documents');
                                          }
                                        } catch (error) {
                                          console.error('❌ Erreur recherche client_documents:', error);
                                        }
                                      }
                                      setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  } else {
                                    newIndivisaires[idx] = {
                                      ...newIndivisaires[idx],
                                      clientId: "",
                                      nom: "",
                                      prenom: "",
                                      dateNaissance: "",
                                      lieuNaissance: "",
                                      adresse: "",
                                      nationalite: "",
                                      profession: "",
                                    };
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }
                                }}
                                label="Lier à un client existant (optionnel)"
                                placeholder="Choisir un client"
                              />

                              {/* Affichage des infos du client */}
                              {indivisaire.clientId && (
                                <div className="md:col-span-2 p-3 bg-green-50 border border-green-200 rounded-lg">
                                  <p className="text-sm font-medium text-green-800">✓ Informations chargées depuis la fiche client</p>
                                  <p className="text-sm text-green-700 mt-1">{indivisaire.nom} {indivisaire.prenom} - {indivisaire.adresse}</p>
                                </div>
                              )}
                            </div>
                          </>
                        ) : (
                            <>
                              {/* Saisie manuelle pour non-client */}
                              <div className="space-y-2">
                                <Label>Nom *</Label>
                                <Input
                                  value={indivisaire.nom}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], nom: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Prénom *</Label>
                                <Input
                                  value={indivisaire.prenom}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], prenom: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2 md:col-span-2">
                                <Label>Adresse *</Label>
                                <Input
                                  value={indivisaire.adresse}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], adresse: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Date de naissance</Label>
                                <Input
                                  type="date"
                                  value={indivisaire.dateNaissance}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], dateNaissance: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Lieu de naissance</Label>
                                <Input
                                  value={indivisaire.lieuNaissance}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], lieuNaissance: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Nationalité</Label>
                                <Input
                                  value={indivisaire.nationalite}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], nationalite: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Profession</Label>
                                <Input
                                  value={indivisaire.profession}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], profession: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Email</Label>
                                <Input
                                  type="email"
                                  value={indivisaire.email}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], email: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Téléphone</Label>
                                <Input
                                  value={indivisaire.telephone}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], telephone: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                            </>
                          )}

                          {/* Situation familiale */}
                          <div className="space-y-2">
                            <Label>Situation familiale</Label>
                            <Input
                              value={indivisaire.situationFamiliale}
                              onChange={(e) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {...newIndivisaires[idx], situationFamiliale: e.target.value};
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                              placeholder="Ex: Célibataire, Marié, Divorcé..."
                            />
                          </div>

                          {indivisaire.situationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => indivisaire.situationFamiliale.toLowerCase().includes(term)) && (
                            <div className="space-y-2">
                              <Label>Régime matrimonial</Label>
                              <Input
                                value={indivisaire.regimeMatrimonial}
                                onChange={(e) => {
                                  const newIndivisaires = [...indivisionData.indivisaires];
                                  const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                  newIndivisaires[idx] = {...newIndivisaires[idx], regimeMatrimonial: e.target.value};
                                  setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                }}
                                placeholder="Ex: Communauté légale, Séparation de biens..."
                              />
                            </div>
                          )}

                          {/* Quote-part */}
                          <div className="space-y-2">
                            <Label>Quote-part (%) *</Label>
                            <Input
                              type="number"
                              min="0"
                              max="100"
                              value={indivisaire.quotePart}
                              onChange={(e) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {...newIndivisaires[idx], quotePart: e.target.value};
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                              placeholder="Ex: 50"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Origine de la quote-part</Label>
                            <Select
                              value={indivisaire.origineQuotePart}
                              onValueChange={(value) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {...newIndivisaires[idx], origineQuotePart: value};
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="heritage">Héritage</SelectItem>
                                <SelectItem value="achat">Achat</SelectItem>
                                <SelectItem value="donation">Donation</SelectItem>
                                <SelectItem value="succession">Succession</SelectItem>
                                <SelectItem value="investissement">Investissement</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {indivisaire.origineQuotePart === "autre" && (
                            <div className="space-y-2">
                              <Label>Préciser l'origine</Label>
                              <Input
                                value={indivisaire.origineQuotePartAutre || ""}
                                onChange={(e) => {
                                  const newIndivisaires = [...indivisionData.indivisaires];
                                  const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                  newIndivisaires[idx] = {...newIndivisaires[idx], origineQuotePartAutre: e.target.value};
                                  setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                }}
                                placeholder="Ex: Partage amiable..."
                              />
                            </div>
                          )}

                          {/* Upload pièces jointes pour cet indivisaire */}
                          {!indivisaire.isClient && (
                            <div className="md:col-span-2">
                              <MultiFileUpload
                                label="📎 Pièce d'identité"
                                files={indivisairesIdentiteFiles[indivisaire.id] || []}
                                onFilesChange={(files) => setIndivisairesIdentiteFiles(prev => ({...prev, [indivisaire.id]: files}))}
                                accept="application/pdf,image/*"
                              />
                            </div>
                          )}

                          {/* Affichage de la carte d'identité chargée depuis le client */}
                          {indivisaire.isClient && indivisairesIdentiteFiles[indivisaire.id]?.length > 0 && (
                            <div className="space-y-2 md:col-span-2">
                              <div className="flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg">
                                <svg className="w-5 h-5 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div className="flex-1">
                                  <p className="text-sm font-medium text-green-800">✓ Pièce d'identité chargée depuis la fiche client</p>
                                  <p className="text-xs text-green-700 mt-1">
                                    {indivisairesIdentiteFiles[indivisaire.id].map((file, idx) => file.name).join(', ')}
                                  </p>
                                </div>
                              </div>
                            </div>
                          )}

                          {/* Upload justificatif de domicile */}
                          <div className="md:col-span-2">
                            <MultiFileUpload
                              label="📎 Justificatif de domicile"
                              files={indivisairesDomicileFiles[indivisaire.id] || []}
                              onFilesChange={(files) => setIndivisairesDomicileFiles(prev => ({...prev, [indivisaire.id]: files}))}
                              accept="application/pdf,image/*"
                            />
                          </div>

                          {/* Upload contrat de mariage si marié */}
                          {indivisaire.statutMatrimonial === "marie" && (
                            <div className="md:col-span-2">
                              <MultiFileUpload
                                label="📎 Contrat de mariage (si applicable)"
                                files={indivisairesContratMariageFiles[indivisaire.id] || []}
                                onFilesChange={(files) => setIndivisairesContratMariageFiles(prev => ({...prev, [indivisaire.id]: files}))}
                                accept="application/pdf"
                              />
                            </div>
                          )}

                          {/* Upload livret de famille si succession */}
                          {indivisionData.origine === "succession" && (
                            <div className="md:col-span-2">
                              <MultiFileUpload
                                label="📎 Livret de famille (si succession)"
                                files={indivisairesLivretFamilleFiles[indivisaire.id] || []}
                                onFilesChange={(files) => setIndivisairesLivretFamilleFiles(prev => ({...prev, [indivisaire.id]: files}))}
                                accept="application/pdf,image/*"
                              />
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 3. Description du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏠 Description du bien indivis</h3>
                    
                    {indivisionData.description.typeBien === "immobilier" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Input
                            value={indivisionData.description.immobilier.adresse}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, adresse: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Nature du bien *</Label>
                          <Select
                            value={indivisionData.description.immobilier.nature}
                            onValueChange={(value) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, nature: value}
                              }
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="maison">Maison</SelectItem>
                              <SelectItem value="appartement">Appartement</SelectItem>
                              <SelectItem value="terrain">Terrain</SelectItem>
                              <SelectItem value="immeuble">Immeuble</SelectItem>
                              <SelectItem value="local_commercial">Local commercial</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Surface (m²)</Label>
                          <Input
                            type="number"
                            value={indivisionData.description.immobilier.surface}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, surface: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Description détaillée</Label>
                          <Textarea
                            rows={3}
                            value={indivisionData.description.immobilier.description}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, description: e.target.value}
                              }
                            })}
                            placeholder="Description du bien..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>État locatif</Label>
                          <Select
                            value={indivisionData.description.immobilier.etatLocatif}
                            onValueChange={(value) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, etatLocatif: value}
                              }
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="libre">Libre</SelectItem>
                              <SelectItem value="loue">Loué</SelectItem>
                              <SelectItem value="occupe">Occupé par un indivisaire</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {indivisionData.description.immobilier.etatLocatif === "loue" && (
                          <div className="space-y-2">
                            <Label>Loyer mensuel (€)</Label>
                            <Input
                              type="number"
                              value={indivisionData.description.immobilier.loyer}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                description: {
                                  ...indivisionData.description,
                                  immobilier: {...indivisionData.description.immobilier, loyer: e.target.value}
                                }
                              })}
                            />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Valeur vénale estimée (€)</Label>
                          <Input
                            type="number"
                            value={indivisionData.description.immobilier.valeurVenale}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, valeurVenale: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Références cadastrales</Label>
                          <Input
                            value={indivisionData.description.immobilier.cadastre}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, cadastre: e.target.value}
                              }
                            })}
                            placeholder="Ex: Section AB n° 123"
                          />
                        </div>

                        {/* Uploads pour bien immobilier */}
                        <MultiFileUpload
                          label="📎 Titre de propriété *"
                          files={indivisionTitreProprietFiles}
                          onFilesChange={setIndivisionTitreProprietFiles}
                          accept="application/pdf"
                        />

                        <MultiFileUpload
                          label="📎 Évaluation du bien"
                          files={indivisionEvaluationFiles}
                          onFilesChange={setIndivisionEvaluationFiles}
                          accept="application/pdf"
                        />

                        <MultiFileUpload
                          label="📎 Plan cadastral"
                          files={indivisionCadastreFiles}
                          onFilesChange={setIndivisionCadastreFiles}
                          accept="application/pdf,image/*"
                        />

                        <MultiFileUpload
                          label="📎 Diagnostics techniques"
                          files={indivisionDiagnosticsFiles}
                          onFilesChange={setIndivisionDiagnosticsFiles}
                          accept="application/pdf"
                        />

                        {indivisionData.description.immobilier.etatLocatif === "loue" && (
                          <MultiFileUpload
                            label="📎 Bail en cours"
                            files={indivisionBailFiles}
                            onFilesChange={setIndivisionBailFiles}
                            accept="application/pdf"
                          />
                        )}
                      </div>
                    )}

                    {indivisionData.description.typeBien === "mobilier" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Description des biens mobiliers *</Label>
                          <Textarea
                            rows={4}
                            value={indivisionData.description.mobilier.description}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                mobilier: {...indivisionData.description.mobilier, description: e.target.value}
                              }
                            })}
                            placeholder="Description détaillée des biens mobiliers..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Valeur estimée (€)</Label>
                          <Input
                            type="number"
                            value={indivisionData.description.mobilier.valeurEstimee}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                mobilier: {...indivisionData.description.mobilier, valeurEstimee: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéros de série / identifiants</Label>
                          <Input
                            value={indivisionData.description.mobilier.numerosIdentification}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                mobilier: {...indivisionData.description.mobilier, numerosIdentification: e.target.value}
                              }
                            })}
                            placeholder="Si applicable"
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 4. Durée de la convention */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⏱️ Durée de la convention</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de durée *</Label>
                        <RadioGroup
                          value={indivisionData.duree.type}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            duree: {...indivisionData.duree, type: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="indeterminee" id="duree_indeterminee" />
                              <Label htmlFor="duree_indeterminee" className="cursor-pointer">Indéterminée</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="determinee" id="duree_determinee" />
                              <Label htmlFor="duree_determinee" className="cursor-pointer">Déterminée (max 5 ans)</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.duree.type === "determinee" && (
                        <div className="space-y-2">
                          <Label>Durée (en années) *</Label>
                          <Input
                            type="number"
                            min="1"
                            max="5"
                            value={indivisionData.duree.annees}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              duree: {...indivisionData.duree, annees: e.target.value}
                            })}
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Conditions de renouvellement</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.duree.conditionsRenouvellement}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            duree: {...indivisionData.duree, conditionsRenouvellement: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Conditions de sortie anticipée</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.duree.conditionsSortie}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            duree: {...indivisionData.duree, conditionsSortie: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 5. Gestion de l'indivision */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⚙️ Gestion de l'indivision</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Gérant désigné</Label>
                        <Input
                          value={indivisionData.gestion.gerant}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, gerant: e.target.value}
                          })}
                          placeholder="Nom du gérant (peut être un indivisaire ou une personne externe)"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Pouvoirs du gérant</Label>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_gestion"
                              checked={indivisionData.gestion.pouvoirs.gestion_courante}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, gestion_courante: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_gestion" className="cursor-pointer">Gestion courante</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_travaux"
                              checked={indivisionData.gestion.pouvoirs.travaux}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, travaux: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_travaux" className="cursor-pointer">Autorisation des travaux</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_representation"
                              checked={indivisionData.gestion.pouvoirs.representation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, representation: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_representation" className="cursor-pointer">Représentation de l'indivision</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_signature"
                              checked={indivisionData.gestion.pouvoirs.signature_actes}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, signature_actes: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_signature" className="cursor-pointer">Signature d'actes au nom de l'indivision</Label>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Type de décisions *</Label>
                        <Select
                          value={indivisionData.gestion.decisions}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, decisions: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Unanimité</SelectItem>
                            <SelectItem value="majorite_2_3">Majorité des 2/3</SelectItem>
                            <SelectItem value="majorite_simple">Majorité simple</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des charges</Label>
                        <Input
                          value={indivisionData.gestion.charges}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, charges: e.target.value}
                          })}
                          placeholder="Ex: Proportionnellement aux quote-parts"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des dépenses exceptionnelles</Label>
                        <Input
                          value={indivisionData.gestion.repartitionDepensesExceptionnelles}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, repartitionDepensesExceptionnelles: e.target.value}
                          })}
                          placeholder="Ex: Gros travaux, sinistres, procédures..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des revenus tirés du bien</Label>
                        <Input
                          value={indivisionData.gestion.repartitionRevenus}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, repartitionRevenus: e.target.value}
                          })}
                          placeholder="Ex: Loyers, indemnités d'occupation, revenus divers..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Compte bancaire dédié</Label>
                        <Input
                          value={indivisionData.gestion.compteBancaire}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, compteBancaire: e.target.value}
                          })}
                          placeholder="Coordonnées du compte (IBAN, nom de la banque...)"
                        />
                      </div>

                      {/* Upload mandat du gérant */}
                      {indivisionData.gestion.gerant && (
                        <div className="md:col-span-2">
                          <MultiFileUpload
                            label="📎 Mandat du gérant"
                            files={indivisionMandatGerantFiles}
                            onFilesChange={setIndivisionMandatGerantFiles}
                            accept="application/pdf"
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 6. Utilisation du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🔑 Utilisation du bien</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Utilisation par les indivisaires</Label>
                        <RadioGroup
                          value={indivisionData.utilisation.utilisationParIndivisaires}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            utilisation: {...indivisionData.utilisation, utilisationParIndivisaires: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="util_oui" />
                              <Label htmlFor="util_oui" className="cursor-pointer">Autorisée</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="util_non" />
                              <Label htmlFor="util_non" className="cursor-pointer">Non autorisée</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.utilisation.utilisationParIndivisaires === "oui" && (
                        <>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Conditions d'utilisation</Label>
                            <Textarea
                              rows={2}
                              value={indivisionData.utilisation.conditionsUtilisation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, conditionsUtilisation: e.target.value}
                              })}
                              placeholder="Préciser les conditions..."
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Indemnité d'occupation (clause centrale)</Label>
                            <RadioGroup
                              value={indivisionData.utilisation.indemniteOccupation}
                              onValueChange={(value) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, indemniteOccupation: value}
                              })}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id="indem_oui" />
                                  <Label htmlFor="indem_oui" className="cursor-pointer">Oui, indemnité obligatoire</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id="indem_non" />
                                  <Label htmlFor="indem_non" className="cursor-pointer">Non, aucune indemnité</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="conditions" id="indem_cond" />
                                  <Label htmlFor="indem_cond" className="cursor-pointer">Selon conditions</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {(indivisionData.utilisation.indemniteOccupation === "oui" || indivisionData.utilisation.indemniteOccupation === "conditions") && (
                            <>
                              <div className="space-y-2">
                                <Label>Montant de l'indemnité d'occupation (€)</Label>
                                <Input
                                  type="number"
                                  value={indivisionData.utilisation.indemniteOccupationMontant}
                                  onChange={(e) => setIndivisionData({
                                    ...indivisionData,
                                    utilisation: {...indivisionData.utilisation, indemniteOccupationMontant: e.target.value}
                                  })}
                                  placeholder="Montant mensuel ou annuel"
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Fréquence de l'indemnité</Label>
                                <Select
                                  value={indivisionData.utilisation.indemniteFrequence}
                                  onValueChange={(value) => setIndivisionData({
                                    ...indivisionData,
                                    utilisation: {...indivisionData.utilisation, indemniteFrequence: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="mensuelle">Mensuelle</SelectItem>
                                    <SelectItem value="trimestrielle">Trimestrielle</SelectItem>
                                    <SelectItem value="annuelle">Annuelle</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </>
                          )}

                          {indivisionData.utilisation.indemniteOccupation === "conditions" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Conditions pour l'indemnité d'occupation</Label>
                              <Textarea
                                rows={2}
                                value={indivisionData.utilisation.indemniteOccupationConditions}
                                onChange={(e) => setIndivisionData({
                                  ...indivisionData,
                                  utilisation: {...indivisionData.utilisation, indemniteOccupationConditions: e.target.value}
                                })}
                                placeholder="Ex: Indemnité due uniquement si occupation exclusive pendant plus de 6 mois..."
                              />
                            </div>
                          )}
                        </>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Location autorisée</Label>
                        <RadioGroup
                          value={indivisionData.utilisation.locationAutorisee}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            utilisation: {...indivisionData.utilisation, locationAutorisee: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="location_oui" />
                              <Label htmlFor="location_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="location_non" />
                              <Label htmlFor="location_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.utilisation.locationAutorisee === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Mandataire pour la location</Label>
                            <Input
                              value={indivisionData.utilisation.mandataireLocation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, mandataireLocation: e.target.value}
                              })}
                              placeholder="Nom du mandataire"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Répartition des loyers</Label>
                            <Input
                              value={indivisionData.utilisation.repartitionLoyers}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, repartitionLoyers: e.target.value}
                              })}
                              placeholder="Ex: Proportionnellement aux quote-parts"
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 7. Travaux et améliorations */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🔨 Travaux et améliorations</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Types de travaux autorisés</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.travaux.typesAutorises}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, typesAutorises: e.target.value}
                          })}
                          placeholder="Préciser les types de travaux..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Décision requise *</Label>
                        <Select
                          value={indivisionData.travaux.decisionRequise}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, decisionRequise: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Unanimité</SelectItem>
                            <SelectItem value="majorite_2_3">Majorité des 2/3</SelectItem>
                            <SelectItem value="majorite_simple">Majorité simple</SelectItem>
                            <SelectItem value="gerant">Décision du gérant</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des coûts</Label>
                        <Input
                          value={indivisionData.travaux.repartitionCouts}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, repartitionCouts: e.target.value}
                          })}
                          placeholder="Ex: Proportionnellement aux quote-parts"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Travaux urgents (procédure)</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.travaux.travauxUrgents}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, travauxUrgents: e.target.value}
                          })}
                          placeholder="Procédure en cas de travaux urgents..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Exigences de documentation</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.travaux.documentation}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, documentation: e.target.value}
                          })}
                          placeholder="Préciser les documents requis (devis, factures, autorisations...)..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 8. Sortie d'un indivisaire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🚪 Sortie d'un indivisaire</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de vente de la part *</Label>
                        <RadioGroup
                          value={indivisionData.sortie.venteLibre}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, venteLibre: value}
                          })}
                        >
                          <div className="flex flex-col gap-2">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="libre" id="vente_libre" />
                              <Label htmlFor="vente_libre" className="cursor-pointer">Vente libre</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="droit_preemption" id="vente_preemption" />
                              <Label htmlFor="vente_preemption" className="cursor-pointer">Droit de préemption des autres indivisaires</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      <div className="space-y-2">
                        <Label>Évaluation de la part *</Label>
                        <Select
                          value={indivisionData.sortie.evaluationPart}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, evaluationPart: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="gerant">Par le gérant</SelectItem>
                            <SelectItem value="accord_indivisaires">Accord des indivisaires</SelectItem>
                            <SelectItem value="expert">Expert indépendant</SelectItem>
                            <SelectItem value="juge">Décision du juge</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Délai de rachat (jours)</Label>
                        <Input
                          type="number"
                          value={indivisionData.sortie.delaiRachat}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, delaiRachat: e.target.value}
                          })}
                          placeholder="Ex: 60"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de paiement</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.sortie.modalitesPaiement}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, modalitesPaiement: e.target.value}
                          })}
                          placeholder="Préciser les conditions de paiement..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 9. Vente du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💰 Vente du bien</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Conditions de mise en vente</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.vente.conditionsMiseEnVente}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, conditionsMiseEnVente: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Décision requise *</Label>
                        <Select
                          value={indivisionData.vente.decisionRequise}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, decisionRequise: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Unanimité</SelectItem>
                            <SelectItem value="majorite_2_3">Majorité des 2/3</SelectItem>
                            <SelectItem value="majorite_simple">Majorité simple</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Mandataire pour la vente</Label>
                        <Input
                          value={indivisionData.vente.mandataire}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, mandataire: e.target.value}
                          })}
                          placeholder="Nom du mandataire"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Répartition du prix de vente</Label>
                        <Input
                          value={indivisionData.vente.repartitionPrix}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, repartitionPrix: e.target.value}
                          })}
                          placeholder="Ex: Proportionnellement aux quote-parts"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Gestion des plus-values</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.vente.gestionPlusValues}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, gestionPlusValues: e.target.value}
                          })}
                          placeholder="Préciser la gestion fiscale et la répartition..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 10. Comptabilité */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📊 Comptabilité</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Tenue d'un registre des dépenses</Label>
                        <RadioGroup
                          value={indivisionData.comptabilite.registreDepenses}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, registreDepenses: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="registre_oui" />
                              <Label htmlFor="registre_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="registre_non" />
                              <Label htmlFor="registre_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Archivage des factures et justificatifs</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.comptabilite.archivageFactures}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, archivageFactures: e.target.value}
                          })}
                          placeholder="Modalités d'archivage..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de remboursement des avances</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.comptabilite.remboursementAvances}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, remboursementAvances: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Rapport annuel de gestion</Label>
                        <RadioGroup
                          value={indivisionData.comptabilite.rapportAnnuel}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, rapportAnnuel: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="rapport_oui" />
                              <Label htmlFor="rapport_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="rapport_non" />
                              <Label htmlFor="rapport_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>
                    </div>
                  </div>

                  {/* 11. Litiges */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⚖️ Règlement des litiges</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Modes de résolution des litiges</Label>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="litige_mediation"
                              checked={indivisionData.litiges.modesResolution.mediation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                litiges: {
                                  ...indivisionData.litiges,
                                  modesResolution: {...indivisionData.litiges.modesResolution, mediation: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="litige_mediation" className="cursor-pointer">Médiation</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="litige_arbitrage"
                              checked={indivisionData.litiges.modesResolution.arbitrage}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                litiges: {
                                  ...indivisionData.litiges,
                                  modesResolution: {...indivisionData.litiges.modesResolution, arbitrage: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="litige_arbitrage" className="cursor-pointer">Arbitrage</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="litige_tribunal"
                              checked={indivisionData.litiges.modesResolution.tribunal}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                litiges: {
                                  ...indivisionData.litiges,
                                  modesResolution: {...indivisionData.litiges.modesResolution, tribunal: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="litige_tribunal" className="cursor-pointer">Tribunal compétent</Label>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Clause de solidarité pour les dettes</Label>
                        <RadioGroup
                          value={indivisionData.litiges.solidariteDettes}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            litiges: {...indivisionData.litiges, solidariteDettes: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="solidarite_oui" />
                              <Label htmlFor="solidarite_oui" className="cursor-pointer">Oui (indivisaires solidaires)</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="solidarite_non" />
                              <Label htmlFor="solidarite_non" className="cursor-pointer">Non (chacun à hauteur de sa quote-part)</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>
                    </div>
                  </div>

                  {/* 12. Assurance du bien indivis */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🛡️ Assurance du bien indivis</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Assurance obligatoire</Label>
                        <RadioGroup
                          value={indivisionData.assurance.assuranceObligatoire}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            assurance: {...indivisionData.assurance, assuranceObligatoire: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="assur_oui" />
                              <Label htmlFor="assur_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="assur_non" />
                              <Label htmlFor="assur_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.assurance.assuranceObligatoire === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Nom de l'assureur</Label>
                            <Input
                              value={indivisionData.assurance.nomAssureur}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, nomAssureur: e.target.value}
                              })}
                              placeholder="Ex: AXA, MAIF, Allianz..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de police d'assurance</Label>
                            <Input
                              value={indivisionData.assurance.numeroPolice}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, numeroPolice: e.target.value}
                              })}
                              placeholder="Numéro de contrat"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Répartition de la prime d'assurance</Label>
                            <Input
                              value={indivisionData.assurance.repartitionPrime}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, repartitionPrime: e.target.value}
                              })}
                              placeholder="Ex: Proportionnellement aux quote-parts"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'échéance</Label>
                            <Input
                              type="date"
                              value={indivisionData.assurance.dateEcheance}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, dateEcheance: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Attestation d'assurance</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="indivision_assurance_upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setIndivisionAssuranceFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="indivision_assurance_upload" className="cursor-pointer">
                                <div className="flex items-center gap-2 text-sm text-muted-foreground">
                                  <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                  </svg>
                                  <div>
                                    <div className="font-medium text-foreground">Cliquez pour joindre l'attestation d'assurance</div>
                                    <div className="text-xs">PDF uniquement</div>
                                  </div>
                                </div>
                              </label>
                              {indivisionAssuranceFiles.length > 0 && (
                                <div className="mt-3 space-y-2">
                                  {indivisionAssuranceFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between p-2 bg-muted rounded">
                                      <span className="text-sm">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setIndivisionAssuranceFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 hover:text-red-800 text-sm"
                                      >
                                        Supprimer
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 13. Procurations et documents complémentaires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📎 Procurations et documents complémentaires</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Procurations (si applicable)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="procurations_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              if (files.length > 0) {
                                setIndivisionProcurationFiles(files);
                                toast.success(`${files.length} fichier(s) ajouté(s)`);
                              }
                              e.target.value = '';
                            }}
                          />
                          <label htmlFor="procurations_upload" className="cursor-pointer flex items-center gap-3">
                            <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                              <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                            </div>
                            <div className="flex-1">
                              <p className="text-sm font-medium">Joindre les procurations</p>
                              <p className="text-xs text-muted-foreground">Si un indivisaire est représenté</p>
                            </div>
                          </label>
                        </div>
                        {indivisionProcurationFiles.length > 0 && (
                          <div className="space-y-2 mt-2">
                            {indivisionProcurationFiles.map((file, idx) => (
                              <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <span className="text-sm flex-1 truncate">{file.name}</span>
                                <Button
                                  type="button"
                                  variant="ghost"
                                  size="sm"
                                  className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                  onClick={() => {
                                    setIndivisionProcurationFiles(indivisionProcurationFiles.filter((_, i) => i !== idx));
                                    toast.success('Fichier supprimé');
                                  }}
                                >
                                  <Trash2 className="w-4 h-4" />
                                </Button>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Mainlevée d'hypothèque */}
            {pendingContractType === "Mainlevée d'hypothèque" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1. Informations générales sur l'hypothèque */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 Informations générales sur l'hypothèque</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de mainlevée *</Label>
                        <Select 
                          value={mainleveeData.typeMainlevee} 
                          onValueChange={(value) => setMainleveeData({...mainleveeData, typeMainlevee: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="totale">Mainlevée totale</SelectItem>
                            <SelectItem value="partielle">Mainlevée partielle</SelectItem>
                            <SelectItem value="renonciation">Renonciation à l'inscription</SelectItem>
                            <SelectItem value="substitution">Substitution</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {mainleveeData.typeMainlevee === "partielle" && (
                        <div className="space-y-2">
                          <Label>Précision sur la mainlevée partielle</Label>
                          <Input
                            value={mainleveeData.precisionPartielle}
                            onChange={(e) => setMainleveeData({...mainleveeData, precisionPartielle: e.target.value})}
                            placeholder="Ex: Sur le lot n°2 uniquement..."
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Nature de l'inscription à radier *</Label>
                        <Select 
                          value={mainleveeData.natureInscription} 
                          onValueChange={(value) => setMainleveeData({...mainleveeData, natureInscription: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="hypotheque_conventionnelle">Hypothèque conventionnelle</SelectItem>
                            <SelectItem value="hypotheque_legale">Hypothèque légale</SelectItem>
                            <SelectItem value="hypotheque_judiciaire">Hypothèque judiciaire</SelectItem>
                            <SelectItem value="privilege_ppd">Privilège de prêteur de deniers (PPD)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro d'inscription hypothécaire *</Label>
                        <Input
                          value={mainleveeData.numeroInscription}
                          onChange={(e) => setMainleveeData({...mainleveeData, numeroInscription: e.target.value})}
                          placeholder="Numéro exact au SPF"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de l'inscription</Label>
                        <Input
                          type="date"
                          value={mainleveeData.dateInscription}
                          onChange={(e) => setMainleveeData({...mainleveeData, dateInscription: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Volume / Numéro d'ordre (ancien format)</Label>
                        <Input
                          value={mainleveeData.volumeNumero}
                          onChange={(e) => setMainleveeData({...mainleveeData, volumeNumero: e.target.value})}
                          placeholder="Volume X, n° Y"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Référence partenaire bancaire</Label>
                        <Input
                          value={mainleveeData.referencePartenaire}
                          onChange={(e) => setMainleveeData({...mainleveeData, referencePartenaire: e.target.value})}
                          placeholder="Facultatif"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 2. Identité du créancier */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏦 Identité du créancier (donneur de mainlevée)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de créancier *</Label>
                        <RadioGroup
                          value={mainleveeData.creancierType}
                          onValueChange={(value) => setMainleveeData({...mainleveeData, creancierType: value})}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="banque" id="creancier_banque" />
                              <Label htmlFor="creancier_banque" className="cursor-pointer">Banque / Établissement financier</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="personne_physique" id="creancier_personne" />
                              <Label htmlFor="creancier_personne" className="cursor-pointer">Personne physique</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {mainleveeData.creancierType === "banque" ? (
                        <>
                          <div className="space-y-2">
                            <Label>Dénomination sociale *</Label>
                            <Input
                              value={mainleveeData.creancierBanque.denominationSociale}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, denominationSociale: e.target.value}
                              })}
                              placeholder="Ex: Société Générale"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Forme juridique</Label>
                            <Input
                              value={mainleveeData.creancierBanque.formeJuridique}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, formeJuridique: e.target.value}
                              })}
                              placeholder="Ex: SA, SAS..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Capital social</Label>
                            <Input
                              value={mainleveeData.creancierBanque.capitalSocial}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, capitalSocial: e.target.value}
                              })}
                              placeholder="Ex: 1 000 000 €"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse du siège *</Label>
                            <Input
                              value={mainleveeData.creancierBanque.adresseSiege}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, adresseSiege: e.target.value}
                              })}
                              placeholder="Adresse complète"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>RCS</Label>
                            <Input
                              value={mainleveeData.creancierBanque.rcs}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, rcs: e.target.value}
                              })}
                              placeholder="Ex: RCS Paris B 123 456 789"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>SIREN</Label>
                            <Input
                              value={mainleveeData.creancierBanque.siren}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, siren: e.target.value}
                              })}
                              placeholder="9 chiffres"
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2 bg-muted/30 p-3 rounded-lg">
                            <h4 className="font-medium text-sm">Représentant habilité</h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Nom du représentant</Label>
                                <Input
                                  value={mainleveeData.creancierBanque.representantNom}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, representantNom: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Prénom du représentant</Label>
                                <Input
                                  value={mainleveeData.creancierBanque.representantPrenom}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, representantPrenom: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Fonction</Label>
                                <Input
                                  value={mainleveeData.creancierBanque.representantFonction}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, representantFonction: e.target.value}
                                  })}
                                  placeholder="Ex: Directeur d'agence"
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Type de pouvoirs</Label>
                                <Select 
                                  value={mainleveeData.creancierBanque.pouvoirsType} 
                                  onValueChange={(value) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, pouvoirsType: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="mandat">Mandat</SelectItem>
                                    <SelectItem value="delegation">Délégation interne</SelectItem>
                                    <SelectItem value="pv">PV désignant les pouvoirs</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>
                          </div>

                          {/* Upload pièces créancier banque */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Pièces justificatives du créancier</Label>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              {/* KBIS */}
                              <div className="space-y-2">
                                <Label className="text-sm">KBIS</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="mainlevee_kbis_upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      setMainleveeCreancierKbisFiles(prev => [...prev, ...files]);
                                    }}
                                  />
                                  <label htmlFor="mainlevee_kbis_upload" className="cursor-pointer text-sm text-muted-foreground">
                                    Cliquez pour joindre le KBIS
                                  </label>
                                  {mainleveeCreancierKbisFiles.length > 0 && (
                                    <div className="mt-2 space-y-1">
                                      {mainleveeCreancierKbisFiles.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                          <span className="truncate">{file.name}</span>
                                          <button
                                            type="button"
                                            onClick={() => setMainleveeCreancierKbisFiles(prev => prev.filter((_, i) => i !== idx))}
                                            className="text-red-600 ml-2"
                                          >
                                            ✕
                                          </button>
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>

                              {/* Mandat du représentant */}
                              <div className="space-y-2">
                                <Label className="text-sm">Mandat / Délégation de pouvoir</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="mainlevee_mandat_upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      setMainleveeCreancierMandatFiles(prev => [...prev, ...files]);
                                    }}
                                  />
                                  <label htmlFor="mainlevee_mandat_upload" className="cursor-pointer text-sm text-muted-foreground">
                                    Cliquez pour joindre le mandat
                                  </label>
                                  {mainleveeCreancierMandatFiles.length > 0 && (
                                    <div className="mt-2 space-y-1">
                                      {mainleveeCreancierMandatFiles.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                          <span className="truncate">{file.name}</span>
                                          <button
                                            type="button"
                                            onClick={() => setMainleveeCreancierMandatFiles(prev => prev.filter((_, i) => i !== idx))}
                                            className="text-red-600 ml-2"
                                          >
                                            ✕
                                          </button>
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>

                              {/* Pièce d'identité représentant */}
                              <div className="space-y-2">
                                <Label className="text-sm">Pièce d'identité du représentant</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="mainlevee_identite_rep_upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      setMainleveeCreancierIdentiteFiles(prev => [...prev, ...files]);
                                    }}
                                  />
                                  <label htmlFor="mainlevee_identite_rep_upload" className="cursor-pointer text-sm text-muted-foreground">
                                    Cliquez pour joindre la pièce d'identité
                                  </label>
                                  {mainleveeCreancierIdentiteFiles.length > 0 && (
                                    <div className="mt-2 space-y-1">
                                      {mainleveeCreancierIdentiteFiles.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                          <span className="truncate">{file.name}</span>
                                          <button
                                            type="button"
                                            onClick={() => setMainleveeCreancierIdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                            className="text-red-600 ml-2"
                                          >
                                            ✕
                                          </button>
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>
                            </div>
                          </div>
                        </>
                      ) : (
                        <>
                          {/* Créancier personne physique */}
                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.nom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, nom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.prenom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, prenom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.adresse}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, adresse: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input
                              type="date"
                              value={mainleveeData.creancierPersonne.dateNaissance}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, dateNaissance: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.lieuNaissance}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, lieuNaissance: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.nationalite}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, nationalite: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.profession}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, profession: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Situation familiale</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.statutMatrimonial}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, statutMatrimonial: e.target.value}
                              })}
                              placeholder="Ex: Célibataire, Marié..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.typeIdentite}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, typeIdentite: e.target.value}
                              })}
                              placeholder="Ex: CNI, Passeport..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de pièce d'identité</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.numeroIdentite}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, numeroIdentite: e.target.value}
                              })}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 3. Débiteurs hypothécaires - À CONTINUER */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👥 Débiteurs hypothécaires (emprunteurs)</h3>
                    <p className="text-sm text-muted-foreground">Les personnes qui avaient contracté le prêt</p>
                    
                    {mainleveeData.debiteurs.map((debiteur, index) => (
                      <div key={debiteur.id} className="p-4 border rounded-lg space-y-4">
                        <div className="flex justify-between items-center">
                          <h4 className="font-medium">Débiteur #{index + 1}</h4>
                          {mainleveeData.debiteurs.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="text-red-600 hover:text-red-700 hover:bg-red-50"
                              onClick={() => {
                                setMainleveeData({
                                  ...mainleveeData,
                                  debiteurs: mainleveeData.debiteurs.filter(d => d.id !== debiteur.id)
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>

                        {/* Sélection client pour ce débiteur - même logique que Convention d'indivision */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Ce débiteur est-il votre client ?</Label>
                            <RadioGroup
                              value={debiteur.isClient ? "client" : "autre"}
                              onValueChange={(value) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], isClient: value === "client"};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="client" id={`deb_client_${debiteur.id}`} />
                                  <Label htmlFor={`deb_client_${debiteur.id}`} className="cursor-pointer">Oui (client)</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="autre" id={`deb_autre_${debiteur.id}`} />
                                  <Label htmlFor={`deb_autre_${debiteur.id}`} className="cursor-pointer">Non (autre partie)</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {debiteur.isClient && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Sélectionner le client *</Label>
                              <Select
                                value={debiteur.clientId}
                                onValueChange={async (value) => {
                                  const selectedClient = clients.find(c => c.id === value);
                                  const newDebiteurs = [...mainleveeData.debiteurs];
                                  const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                  
                                  if (selectedClient) {
                                    let situationFamiliale = selectedClient.situation_matrimoniale || "";
                                    let regimeMatrimonial = "";
                                    
                                    if (selectedClient.situation_familiale) {
                                      if (typeof selectedClient.situation_familiale === 'object') {
                                        const sitFam = selectedClient.situation_familiale as any;
                                        situationFamiliale = selectedClient.situation_matrimoniale || sitFam.situation_familiale || "";
                                        regimeMatrimonial = sitFam.regime_matrimonial || "";
                                      }
                                    }

                                    newDebiteurs[idx] = {
                                      ...newDebiteurs[idx],
                                      clientId: value,
                                      nom: selectedClient.nom || "",
                                      prenom: selectedClient.prenom || "",
                                      adresse: selectedClient.adresse || "",
                                      dateNaissance: selectedClient.date_naissance || "",
                                      lieuNaissance: selectedClient.lieu_naissance || "",
                                      nationalite: selectedClient.nationalite || "",
                                      profession: selectedClient.profession || "",
                                      situationFamiliale: situationFamiliale,
                                      regimeMatrimonial: regimeMatrimonial,
                                      typeIdentite: selectedClient.type_identite || "",
                                      numeroIdentite: selectedClient.numero_identite || "",
                                    };

                                    // Auto-load identité
                                    if (selectedClient.id_doc_path) {
                                      try {
                                        const { data, error } = await supabase.storage
                                          .from('documents')
                                          .download(selectedClient.id_doc_path);
                                        
                                        if (data && !error) {
                                          const fileName = selectedClient.id_doc_path.split('/').pop() || 'identite.pdf';
                                          const file = new File([data], fileName, { type: data.type });
                                          setMainleveeDebiteursIdentiteFiles(prev => ({
                                            ...prev,
                                            [debiteur.id]: [file]
                                          }));
                                        }
                                      } catch (error) {
                                        console.error('Erreur chargement identité:', error);
                                      }
                                    } else {
                                      // Chercher dans client_documents
                                      try {
                                        const { data: docs, error: docsError } = await supabase
                                          .from('client_documents')
                                          .select('file_path, file_name')
                                          .eq('client_id', selectedClient.id)
                                          .eq('document_type', 'piece_identite')
                                          .order('uploaded_at', { ascending: false })
                                          .limit(1);
                                        
                                        if (docs && docs.length > 0) {
                                          const { data, error } = await supabase.storage
                                            .from('documents')
                                            .download(docs[0].file_path);
                                          
                                          if (data && !error) {
                                            const file = new File([data], docs[0].file_name, { type: data.type });
                                            setMainleveeDebiteursIdentiteFiles(prev => ({
                                              ...prev,
                                              [debiteur.id]: [file]
                                            }));
                                          }
                                        }
                                      } catch (error) {
                                        console.error('Erreur recherche client_documents:', error);
                                      }
                                    }
                                  setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              } else {
                                    newDebiteurs[idx] = {
                                      ...newDebiteurs[idx],
                                      clientId: "",
                                      nom: "",
                                      prenom: "",
                                      dateNaissance: "",
                                      lieuNaissance: "",
                                      adresse: "",
                                      nationalite: "",
                                      profession: "",
                                    };
                                    setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                                  }
                                }}
                                label="Sélectionner un client"
                                placeholder="Choisir un client"
                              />

                              {debiteur.clientId && (
                                <div className="mt-2 p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-800">
                                  ✓ Informations chargées depuis la fiche client
                                </div>
                              )}
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Nom</Label>
                            <Input
                              value={debiteur.nom}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], nom: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom</Label>
                            <Input
                              value={debiteur.prenom}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], prenom: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse personnelle</Label>
                            <Input
                              value={debiteur.adresse}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], adresse: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input
                              type="date"
                              value={debiteur.dateNaissance}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], dateNaissance: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={debiteur.lieuNaissance}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], lieuNaissance: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={debiteur.nationalite}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], nationalite: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={debiteur.profession}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], profession: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Situation familiale</Label>
                            <Input
                              value={debiteur.situationFamiliale}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], situationFamiliale: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                              placeholder="Ex: Célibataire, Marié..."
                            />
                          </div>

                          {debiteur.situationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => debiteur.situationFamiliale.toLowerCase().includes(term)) && (
                            <div className="space-y-2">
                              <Label>Régime matrimonial</Label>
                              <Input
                                value={debiteur.regimeMatrimonial}
                                onChange={(e) => {
                                  const newDebiteurs = [...mainleveeData.debiteurs];
                                  const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                  newDebiteurs[idx] = {...newDebiteurs[idx], regimeMatrimonial: e.target.value};
                                  setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                                }}
                                placeholder="Ex: Communauté légale..."
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Input
                              value={debiteur.typeIdentite}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], typeIdentite: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                              placeholder="CNI, Passeport..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de pièce d'identité</Label>
                            <Input
                              value={debiteur.numeroIdentite}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], numeroIdentite: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Qualité dans l'acte</Label>
                            <Select 
                              value={debiteur.qualite} 
                              onValueChange={(value) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], qualite: value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="emprunteur">Emprunteur</SelectItem>
                                <SelectItem value="cofinanceur">Cofinanceur</SelectItem>
                                <SelectItem value="caution_hypothecaire">Caution hypothécaire</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Upload pièces débiteur */}
                          {!debiteur.isClient && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>📎 Pièce d'identité du débiteur</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id={`mainlevee_deb_identite_${debiteur.id}`}
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setMainleveeDebiteursIdentiteFiles(prev => ({
                                      ...prev,
                                      [debiteur.id]: [...(prev[debiteur.id] || []), ...files]
                                    }));
                                  }}
                                />
                                <label htmlFor={`mainlevee_deb_identite_${debiteur.id}`} className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre la pièce d'identité
                                </label>
                              </div>
                            </div>
                          )}

                          {debiteur.isClient && mainleveeDebiteursIdentiteFiles[debiteur.id]?.length > 0 && (
                            <div className="md:col-span-2 p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-800">
                              ✓ Pièce d'identité chargée depuis la fiche client
                            </div>
                          )}

                          {mainleveeDebiteursIdentiteFiles[debiteur.id]?.length > 0 && (
                            <div className="md:col-span-2 space-y-1">
                              {mainleveeDebiteursIdentiteFiles[debiteur.id].map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-2 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => {
                                      setMainleveeDebiteursIdentiteFiles(prev => ({
                                        ...prev,
                                        [debiteur.id]: prev[debiteur.id].filter((_, i) => i !== idx)
                                      }));
                                    }}
                                    className="text-red-600 ml-2"
                                  >
                                    Supprimer
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    ))}

                    <Button
                      type="button"
                      variant="outline"
                      className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                      onClick={() => {
                        const newId = Math.max(...mainleveeData.debiteurs.map(d => d.id), 0) + 1;
                        setMainleveeData({
                          ...mainleveeData,
                          debiteurs: [...mainleveeData.debiteurs, {
                            id: newId,
                            isClient: false,
                            clientId: "",
                            nom: "",
                            prenom: "",
                            adresse: "",
                            dateNaissance: "",
                            lieuNaissance: "",
                            nationalite: "",
                            profession: "",
                            situationFamiliale: "",
                            regimeMatrimonial: "",
                            typeIdentite: "",
                            numeroIdentite: "",
                            qualite: "emprunteur",
                          }]
                        });
                      }}
                    >
                      + Ajouter un débiteur
                    </Button>
                  </div>

                  {/* 4. Acte constitutif de l'hypothèque */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📄 Informations sur l'acte constitutif</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <h4 className="font-medium md:col-span-2">A. Acte d'origine</h4>
                      
                      <div className="space-y-2">
                        <Label>Date de signature de l'acte</Label>
                        <Input
                          type="date"
                          value={mainleveeData.acteOrigine.dateSignature}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, dateSignature: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nature de l'acte</Label>
                        <Select 
                          value={mainleveeData.acteOrigine.natureActe} 
                          onValueChange={(value) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, natureActe: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="acte_notarie">Acte notarié</SelectItem>
                            <SelectItem value="acte_sous_seing_prive">Acte sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Notaire ou auteur de l'acte</Label>
                        <Input
                          value={mainleveeData.acteOrigine.notaireAuteur}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, notaireAuteur: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de publication au SPF</Label>
                        <Input
                          type="date"
                          value={mainleveeData.acteOrigine.datePublication}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, datePublication: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro de publication</Label>
                        <Input
                          value={mainleveeData.acteOrigine.numeroPublication}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, numeroPublication: e.target.value}
                          })}
                        />
                      </div>

                      <h4 className="font-medium md:col-span-2 mt-4">B. Conditions du prêt</h4>

                      <div className="space-y-2">
                        <Label>Montant initial du prêt (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.conditionsPret.montantInitial}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, montantInitial: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Taux d'intérêt</Label>
                        <Input
                          value={mainleveeData.conditionsPret.tauxInteret}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, tauxInteret: e.target.value}
                          })}
                          placeholder="Ex: 1,5%"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Durée du prêt</Label>
                        <Input
                          value={mainleveeData.conditionsPret.dureePret}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, dureePret: e.target.value}
                          })}
                          placeholder="Ex: 20 ans"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro de contrat de prêt</Label>
                        <Input
                          value={mainleveeData.conditionsPret.numeroContrat}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, numeroContrat: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Établissement prêteur</Label>
                        <Input
                          value={mainleveeData.conditionsPret.etablissementPreteur}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, etablissementPreteur: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro de dossier</Label>
                        <Input
                          value={mainleveeData.conditionsPret.numeroDossier}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, numeroDossier: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 5. Bien(s) hypothéqué(s) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏠 Description du/des bien(s) hypothéqué(s)</h3>
                    
                    {mainleveeData.biens.map((bien, index) => (
                      <div key={bien.id} className="p-4 border rounded-lg space-y-4">
                        <div className="flex justify-between items-center">
                          <h4 className="font-medium">Bien #{index + 1}</h4>
                          {mainleveeData.biens.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="text-red-600 hover:text-red-700 hover:bg-red-50"
                              onClick={() => {
                                setMainleveeData({
                                  ...mainleveeData,
                                  biens: mainleveeData.biens.filter(b => b.id !== bien.id)
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète du bien</Label>
                            <Input
                              value={bien.adresse}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], adresse: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Type de bien</Label>
                            <Select 
                              value={bien.typeBien} 
                              onValueChange={(value) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], typeBien: value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="maison">Maison</SelectItem>
                                <SelectItem value="appartement">Appartement</SelectItem>
                                <SelectItem value="terrain">Terrain</SelectItem>
                                <SelectItem value="locaux">Locaux commerciaux</SelectItem>
                                <SelectItem value="dependances">Dépendances</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Description du bien</Label>
                            <Input
                              value={bien.descriptionBien}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], descriptionBien: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                              placeholder="Ex: Villa 5 pièces..."
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Mode de détention du bien *</Label>
                            <Select 
                              value={bien.modeDetention} 
                              onValueChange={(value) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], modeDetention: value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="propriete_exclusive">Propriété exclusive</SelectItem>
                                <SelectItem value="indivision">Indivision</SelectItem>
                                <SelectItem value="communaute_acquets">Communauté réduite aux acquêts</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="autre">Autre régime (préciser)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {bien.modeDetention === "indivision" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Quote-parts en indivision</Label>
                              <Input
                                value={bien.quotepartsIndivision}
                                onChange={(e) => {
                                  const newBiens = [...mainleveeData.biens];
                                  const idx = newBiens.findIndex(b => b.id === bien.id);
                                  newBiens[idx] = {...newBiens[idx], quotepartsIndivision: e.target.value};
                                  setMainleveeData({...mainleveeData, biens: newBiens});
                                }}
                                placeholder="Ex: 1/2, 1/3-2/3, etc."
                              />
                            </div>
                          )}

                          {bien.modeDetention === "autre" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Préciser le régime</Label>
                              <Input
                                value={bien.autreRegime}
                                onChange={(e) => {
                                  const newBiens = [...mainleveeData.biens];
                                  const idx = newBiens.findIndex(b => b.id === bien.id);
                                  newBiens[idx] = {...newBiens[idx], autreRegime: e.target.value};
                                  setMainleveeData({...mainleveeData, biens: newBiens});
                                }}
                                placeholder="Ex: Communauté universelle, participation aux acquêts..."
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Section cadastrale</Label>
                            <Input
                              value={bien.cadastreSection}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], cadastreSection: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de parcelle</Label>
                            <Input
                              value={bien.cadastreParcelle}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], cadastreParcelle: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Contenance (surface)</Label>
                            <Input
                              value={bien.cadastreContenance}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], cadastreContenance: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                              placeholder="Ex: 500 m²"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Est-ce en copropriété ?</Label>
                            <RadioGroup
                              value={bien.estCopropriete}
                              onValueChange={(value) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], estCopropriete: value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id={`copro_oui_${bien.id}`} />
                                  <Label htmlFor={`copro_oui_${bien.id}`} className="cursor-pointer">Oui</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id={`copro_non_${bien.id}`} />
                                  <Label htmlFor={`copro_non_${bien.id}`} className="cursor-pointer">Non</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {bien.estCopropriete === "oui" && (
                            <>
                              <div className="space-y-2">
                                <Label>Numéro de lot</Label>
                                <Input
                                  value={bien.numeroLot}
                                  onChange={(e) => {
                                    const newBiens = [...mainleveeData.biens];
                                    const idx = newBiens.findIndex(b => b.id === bien.id);
                                    newBiens[idx] = {...newBiens[idx], numeroLot: e.target.value};
                                    setMainleveeData({...mainleveeData, biens: newBiens});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Quote-part dans les parties communes</Label>
                                <Input
                                  value={bien.quotePart}
                                  onChange={(e) => {
                                    const newBiens = [...mainleveeData.biens];
                                    const idx = newBiens.findIndex(b => b.id === bien.id);
                                    newBiens[idx] = {...newBiens[idx], quotePart: e.target.value};
                                    setMainleveeData({...mainleveeData, biens: newBiens});
                                  }}
                                  placeholder="Ex: 50/1000"
                                />
                              </div>
                            </>
                          )}
                        </div>
                      </div>
                    ))}

                    <Button
                      type="button"
                      variant="outline"
                      className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                      onClick={() => {
                        const newId = Math.max(...mainleveeData.biens.map(b => b.id), 0) + 1;
                        setMainleveeData({
                          ...mainleveeData,
                          biens: [...mainleveeData.biens, {
                            id: newId,
                            adresse: "",
                            descriptionBien: "",
                            typeBien: "",
                            modeDetention: "",
                            quotepartsIndivision: "",
                            autreRegime: "",
                            cadastreSection: "",
                            cadastreParcelle: "",
                            cadastreContenance: "",
                            estCopropriete: "non",
                            numeroLot: "",
                            quotePart: "",
                          }]
                        });
                      }}
                    >
                      + Ajouter un bien
                    </Button>
                  </div>

                  {/* 6. Déclaration du créancier */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">✅ Déclaration du créancier</h3>
                    <div className="p-4 bg-muted/30 rounded-lg space-y-3">
                      <p className="text-sm text-muted-foreground">Le créancier déclare :</p>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_payee"
                            checked={mainleveeData.declaration.creancePayee}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, creancePayee: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_payee" className="cursor-pointer">Que la créance est intégralement payée</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_aucune_dette"
                            checked={mainleveeData.declaration.aucuneDette}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, aucuneDette: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_aucune_dette" className="cursor-pointer">Qu'il n'existe plus de dette en principal, intérêts, pénalités</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_consent"
                            checked={mainleveeData.declaration.consentMainlevee}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, consentMainlevee: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_consent" className="cursor-pointer">Qu'il consent à la mainlevée totale/partielle</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_renonce"
                            checked={mainleveeData.declaration.renonciation}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, renonciation: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_renonce" className="cursor-pointer">Qu'il renonce à l'inscription hypothécaire</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_radiation"
                            checked={mainleveeData.declaration.demandeRadiation}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, demandeRadiation: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_radiation" className="cursor-pointer">Qu'il demande la radiation au SPF</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 7. Mandat/Procuration */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📝 Mandat ou procuration</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Y a-t-il un mandataire ?</Label>
                        <RadioGroup
                          value={mainleveeData.mandataire.existe}
                          onValueChange={(value) => setMainleveeData({
                            ...mainleveeData,
                            mandataire: {...mainleveeData.mandataire, existe: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="mand_oui" />
                              <Label htmlFor="mand_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="mand_non" />
                              <Label htmlFor="mand_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {mainleveeData.mandataire.existe === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Nom du mandataire</Label>
                            <Input
                              value={mainleveeData.mandataire.nom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                mandataire: {...mainleveeData.mandataire, nom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom du mandataire</Label>
                            <Input
                              value={mainleveeData.mandataire.prenom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                mandataire: {...mainleveeData.mandataire, prenom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Fonction</Label>
                            <Input
                              value={mainleveeData.mandataire.fonction}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                mandataire: {...mainleveeData.mandataire, fonction: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Pouvoirs du mandataire</Label>
                            <div className="space-y-2">
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="pouvoir_signer"
                                  checked={mainleveeData.mandataire.pouvoirSigner}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    mandataire: {...mainleveeData.mandataire, pouvoirSigner: e.target.checked}
                                  })}
                                  className="rounded"
                                />
                                <Label htmlFor="pouvoir_signer" className="cursor-pointer">Signer la mainlevée</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="pouvoir_deposer"
                                  checked={mainleveeData.mandataire.pouvoirDeposer}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    mandataire: {...mainleveeData.mandataire, pouvoirDeposer: e.target.checked}
                                  })}
                                  className="rounded"
                                />
                                <Label htmlFor="pouvoir_deposer" className="cursor-pointer">Déposer au SPF</Label>
                              </div>
                            </div>
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 8. Consentement débiteur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👤 Consentement du débiteur</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Consentement du débiteur requis ?</Label>
                        <RadioGroup
                          value={mainleveeData.consentementDebiteur.requis}
                          onValueChange={(value) => setMainleveeData({
                            ...mainleveeData,
                            consentementDebiteur: {...mainleveeData.consentementDebiteur, requis: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="consent_oui" />
                              <Label htmlFor="consent_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="consent_non" />
                              <Label htmlFor="consent_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {mainleveeData.consentementDebiteur.requis === "oui" && (
                        <>
                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="accord_rad"
                                checked={mainleveeData.consentementDebiteur.accordRadiation}
                                onChange={(e) => setMainleveeData({
                                  ...mainleveeData,
                                  consentementDebiteur: {...mainleveeData.consentementDebiteur, accordRadiation: e.target.checked}
                                })}
                                className="rounded"
                              />
                              <Label htmlFor="accord_rad" className="cursor-pointer">Accord pour la radiation</Label>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Déclarations complémentaires</Label>
                            <Textarea
                              rows={3}
                              value={mainleveeData.consentementDebiteur.declarationsComplementaires}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                consentementDebiteur: {...mainleveeData.consentementDebiteur, declarationsComplementaires: e.target.value}
                              })}
                              placeholder="Ex: Aucune autre inscription liée..."
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 10. Frais et débours */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💰 Frais et débours</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="space-y-2">
                        <Label>Frais de radiation (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.frais.fraisRadiation}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            frais: {...mainleveeData.frais, fraisRadiation: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Honoraires (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.frais.honoraires}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            frais: {...mainleveeData.frais, honoraires: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Timbres fiscaux (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.frais.timbresFiscaux}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            frais: {...mainleveeData.frais, timbresFiscaux: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 11. Pièces justificatives obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📎 Pièces justificatives obligatoires</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Copie acte constitutif */}
                      <div className="space-y-2">
                        <Label>Copie de l'acte constitutif</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="mainlevee_acte_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setMainleveeActeConstitutifFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="mainlevee_acte_upload" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre l'acte constitutif
                          </label>
                          {mainleveeActeConstitutifFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {mainleveeActeConstitutifFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setMainleveeActeConstitutifFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Copie inscription hypothécaire */}
                      <div className="space-y-2">
                        <Label>Copie de l'inscription hypothécaire (SPF)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="mainlevee_inscription_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setMainleveeInscriptionHypothequeFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="mainlevee_inscription_upload" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre l'inscription
                          </label>
                          {mainleveeInscriptionHypothequeFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {mainleveeInscriptionHypothequeFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setMainleveeInscriptionHypothequeFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Attestation remboursement */}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Attestation de remboursement total du prêt</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="mainlevee_attestation_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setMainleveeAttestationRemboursementFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="mainlevee_attestation_upload" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre l'attestation de remboursement
                          </label>
                          {mainleveeAttestationRemboursementFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {mainleveeAttestationRemboursementFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setMainleveeAttestationRemboursementFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Contrat de mariage (régimes matrimoniaux) */}
            {pendingContractType === "Contrat de mariage (régimes matrimoniaux)" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1. Informations générales sur le contrat */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 Informations générales</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de régime matrimonial *</Label>
                        <Select 
                          value={contratMariageData.typeRegime} 
                          onValueChange={(value) => setContratMariageData({...contratMariageData, typeRegime: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                            <SelectItem value="communaute_acquets">Communauté réduite aux acquêts</SelectItem>
                            <SelectItem value="communaute_acquets_amenagee">Communauté réduite aux acquêts aménagée</SelectItem>
                            <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                            <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                            <SelectItem value="autre">Autre aménagement</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {contratMariageData.typeRegime === "autre" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Préciser le régime</Label>
                          <Input
                            value={contratMariageData.autreRegimePrecision}
                            onChange={(e) => setContratMariageData({...contratMariageData, autreRegimePrecision: e.target.value})}
                            placeholder="Ex: Communauté de meubles et acquêts..."
                          />
                        </div>
                      )}

                      {/* Date prévue du mariage */}
                      <div className="space-y-2 md:col-span-2">
                        <Label className="flex items-center gap-2">
                          📅 Date prévue du mariage
                          <span className="text-red-500">*</span>
                        </Label>
                        <Input
                          type="date"
                          value={contratMariageData.dateMariagePrevue}
                          onChange={(e) => setContratMariageData({...contratMariageData, dateMariagePrevue: e.target.value})}
                        />
                        <p className="text-xs text-muted-foreground">Le mariage sera célébré le...</p>
                      </div>

                      {/* Lieu prévu du mariage */}
                      <div className="space-y-4 md:col-span-2 p-4 border rounded-lg bg-muted/30">
                        <h4 className="font-medium flex items-center gap-2">
                          📍 Lieu prévu du mariage
                          <span className="text-red-500">*</span>
                        </h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Mairie</Label>
                            <Input
                              value={contratMariageData.lieuMariage.mairie}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, mairie: e.target.value}
                              })}
                              placeholder="Ex: Mairie du 8ème arrondissement"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Commune</Label>
                            <Input
                              value={contratMariageData.lieuMariage.commune}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, commune: e.target.value}
                              })}
                              placeholder="Ex: Paris"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Département</Label>
                            <Input
                              value={contratMariageData.lieuMariage.departement}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, departement: e.target.value}
                              })}
                              placeholder="Ex: Paris (75)"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Pays</Label>
                            <Input
                              value={contratMariageData.lieuMariage.pays}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, pays: e.target.value}
                              })}
                              placeholder="France"
                            />
                          </div>
                        </div>
                        <p className="text-xs text-muted-foreground">Les futurs époux déclarent vouloir contracter mariage à la mairie de...</p>
                      </div>
                    </div>
                  </div>

                  {/* 2. Choix de la loi applicable (cas internationaux) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🌍 Choix de la loi applicable au régime matrimonial</h3>
                    
                    {contratMariageData.epoux.map((epoux, index) => (
                      <div key={epoux.id} className="p-4 border rounded-lg space-y-4">
                        <h4 className="font-medium">Époux #{index + 1}</h4>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Sélection client */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>Sélectionner un client (optionnel)</Label>
                            <ClientSelector 
                              clients={clients}
                              selectedClientId={epoux.clientId}
                              onClientChange={async (value) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], clientId: value, isClient: !!value};
                                
                                if (value) {
                                  const client = clients.find(c => c.id === value);
                                  if (client) {
                                    newEpoux[index].nom = client.nom || "";
                                    newEpoux[index].prenom = client.prenom || "";
                                    newEpoux[index].adresse = client.adresse || "";
                                    newEpoux[index].dateNaissance = client.date_naissance || "";
                                    newEpoux[index].lieuNaissance = client.lieu_naissance || "";
                                    newEpoux[index].nationalite = client.nationalite || "";
                                    newEpoux[index].profession = client.profession || "";
                                    newEpoux[index].typeIdentite = client.type_identite || "";
                                    newEpoux[index].numeroIdentite = client.numero_identite || "";
                                    
                                    // Auto-remplir la situation familiale
                                    let situationFamiliale = client.situation_matrimoniale || "";
                                    if (!situationFamiliale && client.situation_familiale) {
                                      if (typeof client.situation_familiale === 'string') {
                                        situationFamiliale = client.situation_familiale;
                                      } else if (typeof client.situation_familiale === 'object') {
                                        const sitFam = client.situation_familiale as any;
                                        situationFamiliale = sitFam.situation_familiale || "";
                                      }
                                    }
                                    newEpoux[index].situationFamiliale = situationFamiliale;

                                    // Auto-charger le document d'identité
                                    if (client.id_doc_path) {
                                      try {
                                        const { data: fileData } = await supabase.storage
                                          .from('client_documents')
                                          .download(client.id_doc_path);
                                        if (fileData) {
                                          const file = new File([fileData], `identite_epoux_${index + 1}.pdf`, { type: 'application/pdf' });
                                          if (index === 0) {
                                            setContratMariageEpoux1IdentiteFiles([file]);
                                          } else {
                                            setContratMariageEpoux2IdentiteFiles([file]);
                                          }
                                        }
                                      } catch (err) {
                                        console.error('Erreur chargement document:', err);
                                      }
                                    }
                                  }
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              } else {
                                newEpoux[index] = {
                                  ...newEpoux[index],
                                  clientId: "",
                                  nom: "",
                                  prenom: "",
                                  dateNaissance: "",
                                  lieuNaissance: "",
                                  adresse: "",
                                  nationalite: "",
                                  profession: "",
                                };
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }
                            }}
                            label="Lier à un client (optionnel)"
                            placeholder="Sélectionner un client"
                          />

                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input
                              value={epoux.nom}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], nom: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input
                              value={epoux.prenom}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], prenom: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse</Label>
                            <Input
                              value={epoux.adresse}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], adresse: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input
                              type="date"
                              value={epoux.dateNaissance}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], dateNaissance: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={epoux.lieuNaissance}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], lieuNaissance: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={epoux.nationalite}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], nationalite: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={epoux.profession}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], profession: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Situation familiale</Label>
                            <Select 
                              value={epoux.situationFamiliale} 
                              onValueChange={(value) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], situationFamiliale: value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="celibataire">Célibataire</SelectItem>
                                <SelectItem value="divorce">Divorcé(e)</SelectItem>
                                <SelectItem value="veuf">Veuf/Veuve</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Domicile après mariage (si différent de l'adresse)</Label>
                            <Input
                              value={epoux.domicileApresMariage}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], domicileApresMariage: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Mariage antérieur hors de France ?</Label>
                            <RadioGroup
                              value={epoux.mariageAnterieurtHorsFrance}
                              onValueChange={(value) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], mariageAnterieurtHorsFrance: value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id={`mariage_etr_oui_${index}`} />
                                  <Label htmlFor={`mariage_etr_oui_${index}`} className="cursor-pointer">Oui</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id={`mariage_etr_non_${index}`} />
                                  <Label htmlFor={`mariage_etr_non_${index}`} className="cursor-pointer">Non</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {epoux.mariageAnterieurtHorsFrance === "oui" && (
                            <>
                              <div className="space-y-2">
                                <Label>Date du premier mariage</Label>
                                <Input
                                  type="date"
                                  value={epoux.datePremierMariage}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], datePremierMariage: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Lieu du premier mariage</Label>
                                <Input
                                  value={epoux.lieuPremierMariage}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], lieuPremierMariage: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Régime matrimonial initial</Label>
                                <Input
                                  value={epoux.regimeMatrimonialInitial}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], regimeMatrimonialInitial: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Acte d'état civil étranger</Label>
                                <Input
                                  value={epoux.acteEtatCivilEtranger}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], acteEtatCivilEtranger: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                  placeholder="Nom du fichier ou référence"
                                />
                              </div>
                            </>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}
                  </div>

                  {/* 2bis. Choix de la loi applicable (cas internationaux) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🌍 Choix de la loi applicable au régime matrimonial</h3>
                    <p className="text-sm text-muted-foreground">Pour les couples de nationalités différentes ou résidant à l'étranger</p>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Loi applicable *</Label>
                        <RadioGroup
                          value={contratMariageData.choixLoiApplicable}
                          onValueChange={(value) => setContratMariageData({...contratMariageData, choixLoiApplicable: value})}
                        >
                          <div className="flex flex-col gap-2">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="loi_francaise" id="loi_fr" />
                              <Label htmlFor="loi_fr" className="cursor-pointer">Loi française</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="loi_residence" id="loi_res" />
                              <Label htmlFor="loi_res" className="cursor-pointer">Loi de la résidence habituelle</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="loi_nationalite" id="loi_nat" />
                              <Label htmlFor="loi_nat" className="cursor-pointer">Loi de la nationalité</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="autre" id="loi_autre" />
                              <Label htmlFor="loi_autre" className="cursor-pointer">Autre (préciser)</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {contratMariageData.choixLoiApplicable === "autre" && (
                        <div className="space-y-2">
                          <Label>Préciser la loi applicable</Label>
                          <Input
                            value={contratMariageData.choixLoiApplicableAutre}
                            onChange={(e) => setContratMariageData({...contratMariageData, choixLoiApplicableAutre: e.target.value})}
                            placeholder="Ex: Loi suisse, loi belge..."
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 2ter. Consentement des enfants majeurs - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">✍️ Consentement des enfants majeurs</h3>
                      <p className="text-sm text-muted-foreground">Obligatoire en cas de changement de régime matrimonial</p>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Consentement des enfants majeurs requis ? *</Label>
                          <RadioGroup
                            value={contratMariageData.consentementEnfantsMajeursRequis}
                            onValueChange={(value) => setContratMariageData({...contratMariageData, consentementEnfantsMajeursRequis: value})}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="consent_oui" />
                                <Label htmlFor="consent_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="consent_non" />
                                <Label htmlFor="consent_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.consentementEnfantsMajeursRequis === "oui" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>Joindre le consentement des enfants majeurs (PDF)</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_consent_enfants"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageConsentementEnfantsFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_consent_enfants" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageConsentementEnfantsFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageConsentementEnfantsFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageConsentementEnfantsFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 2quater. Biens communs actuels - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">🏠 Biens communs actuels</h3>
                      <p className="text-sm text-muted-foreground">Nécessaire si vous changez depuis un régime de communauté</p>
                      
                      <div className="space-y-4">
                        {contratMariageData.biensCommuns.map((bien, idx) => (
                          <div key={bien.id} className="grid grid-cols-1 md:grid-cols-3 gap-2 p-3 border rounded">
                            <div className="space-y-2">
                              <Label>Description du bien</Label>
                              <Input
                                placeholder="Ex: Appartement Paris 15e"
                                value={bien.description}
                                onChange={(e) => {
                                  const newBiens = [...contratMariageData.biensCommuns];
                                  newBiens[idx] = {...newBiens[idx], description: e.target.value};
                                  setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                }}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Valeur estimée (€)</Label>
                              <Input
                                type="number"
                                placeholder="250000"
                                value={bien.valeurEstimee}
                                onChange={(e) => {
                                  const newBiens = [...contratMariageData.biensCommuns];
                                  newBiens[idx] = {...newBiens[idx], valeurEstimee: e.target.value};
                                  setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                }}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Répartition envisagée</Label>
                              <Input
                                placeholder="50/50 ou liquidation"
                                value={bien.repartitionEnvisagee}
                                onChange={(e) => {
                                  const newBiens = [...contratMariageData.biensCommuns];
                                  newBiens[idx] = {...newBiens[idx], repartitionEnvisagee: e.target.value};
                                  setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                }}
                              />
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                          onClick={() => {
                            const newId = Math.max(...contratMariageData.biensCommuns.map(b => b.id), 0) + 1;
                            setContratMariageData({
                              ...contratMariageData,
                              biensCommuns: [...contratMariageData.biensCommuns, {
                                id: newId,
                                description: "",
                                valeurEstimee: "",
                                repartitionEnvisagee: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un bien commun
                        </Button>
                      </div>
                    </div>
                  )}

                  {/* 2quinquies. Consentement du juge - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">⚖️ Consentement du juge</h3>
                      <p className="text-sm text-muted-foreground">Requis si vous avez des enfants mineurs et changez de régime</p>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Accord du juge requis ? *</Label>
                          <RadioGroup
                            value={contratMariageData.accordJugeRequis}
                            onValueChange={(value) => setContratMariageData({...contratMariageData, accordJugeRequis: value})}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="juge_oui" />
                                <Label htmlFor="juge_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="juge_non" />
                                <Label htmlFor="juge_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.accordJugeRequis === "oui" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>Joindre la décision / autorisation judiciaire (PDF)</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_decision_juge"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageDecisionJugeFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_decision_juge" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageDecisionJugeFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageDecisionJugeFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageDecisionJugeFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 3. Informations sur les enfants */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👶 Informations sur les enfants</h3>
                    <p className="text-sm text-muted-foreground">Obligatoire pour les changements de régime matrimonial</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nombre d'enfants</Label>
                        <Input
                          type="number"
                          value={contratMariageData.nombreEnfants}
                          onChange={(e) => setContratMariageData({...contratMariageData, nombreEnfants: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Enfants mineurs (mention)</Label>
                        <Input
                          value={contratMariageData.enfantsMineurs}
                          onChange={(e) => setContratMariageData({...contratMariageData, enfantsMineurs: e.target.value})}
                          placeholder="Ex: 2 enfants mineurs"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Information au juge nécessaire ?</Label>
                        <Input
                          value={contratMariageData.informationJugeNecessaire}
                          onChange={(e) => setContratMariageData({...contratMariageData, informationJugeNecessaire: e.target.value})}
                          placeholder="Oui / Non"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Enfants majeurs (si applicable)</Label>
                        {contratMariageData.enfantsMajeurs.map((enfant, idx) => (
                          <div key={enfant.id} className="grid grid-cols-1 md:grid-cols-3 gap-2 p-2 border rounded">
                            <Input
                              placeholder="Nom"
                              value={enfant.nom}
                              onChange={(e) => {
                                const newEnfants = [...contratMariageData.enfantsMajeurs];
                                newEnfants[idx] = {...newEnfants[idx], nom: e.target.value};
                                setContratMariageData({...contratMariageData, enfantsMajeurs: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Prénom"
                              value={enfant.prenom}
                              onChange={(e) => {
                                const newEnfants = [...contratMariageData.enfantsMajeurs];
                                newEnfants[idx] = {...newEnfants[idx], prenom: e.target.value};
                                setContratMariageData({...contratMariageData, enfantsMajeurs: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Accord/Information reçue"
                              value={enfant.accordInformation}
                              onChange={(e) => {
                                const newEnfants = [...contratMariageData.enfantsMajeurs];
                                newEnfants[idx] = {...newEnfants[idx], accordInformation: e.target.value};
                                setContratMariageData({...contratMariageData, enfantsMajeurs: newEnfants});
                              }}
                            />
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                          onClick={() => {
                            const newId = Math.max(...contratMariageData.enfantsMajeurs.map(e => e.id), 0) + 1;
                            setContratMariageData({
                              ...contratMariageData,
                              enfantsMajeurs: [...contratMariageData.enfantsMajeurs, {
                                id: newId,
                                nom: "",
                                prenom: "",
                                adresse: "",
                                accordInformation: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un enfant majeur
                        </Button>
                      </div>
                    </div>
                  </div>

                  {/* 4. Patrimoine des époux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💰 Patrimoine actuel des époux</h3>
                    <p className="text-sm text-muted-foreground">Nécessaire pour participation aux acquêts ou communauté aménagée</p>
                    
                    {/* Époux 1 */}
                    <div className="p-4 border rounded-lg space-y-4">
                      <h4 className="font-medium">Patrimoine Époux 1</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Biens propres (avant mariage)</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux1.biensPropres}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, biensPropres: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Biens acquis pendant mariage</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux1.biensAcquisPendantMariage}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, biensAcquisPendantMariage: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Valeur estimée totale (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux1.valeurEstimee}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, valeurEstimee: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Dettes personnelles (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux1.dettesPersonnelles}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, dettesPersonnelles: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de départ (patrimoine initial)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux1.masseDepart}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, masseDepart: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de fin (patrimoine final)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux1.masseFin}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, masseFin: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>

                    {/* Époux 2 */}
                    <div className="p-4 border rounded-lg space-y-4">
                      <h4 className="font-medium">Patrimoine Époux 2</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Biens propres (avant mariage)</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux2.biensPropres}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, biensPropres: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Biens acquis pendant mariage</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux2.biensAcquisPendantMariage}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, biensAcquisPendantMariage: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Valeur estimée totale (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux2.valeurEstimee}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, valeurEstimee: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Dettes personnelles (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux2.dettesPersonnelles}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, dettesPersonnelles: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de départ (patrimoine initial)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux2.masseDepart}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, masseDepart: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de fin (patrimoine final)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux2.masseFin}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, masseFin: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 4bis. Liquidation du régime matrimonial actuel - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📦 Liquidation du régime matrimonial actuel</h3>
                      <p className="text-sm text-muted-foreground">Obligatoire si vous quittez un régime communautaire</p>
                      
                      <div className="space-y-4">
                        {/* Question principale */}
                        <div className="space-y-2">
                          <Label>Liquidation du régime actuel prévue dans l'acte ? *</Label>
                          <RadioGroup
                            value={contratMariageData.liquidationRegimeActuel}
                            onValueChange={(value) => setContratMariageData({...contratMariageData, liquidationRegimeActuel: value})}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="liquid_oui" />
                                <Label htmlFor="liquid_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="liquid_non" />
                                <Label htmlFor="liquid_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.liquidationRegimeActuel === "oui" && (
                          <>
                            {/* Biens communs existants */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">🏠 Biens communs existants (avant le changement)</h4>
                              <p className="text-xs text-muted-foreground">Lister les biens appartenant aux deux époux en communauté</p>
                              
                              {contratMariageData.biensCommuns.map((bien, idx) => (
                                <div key={bien.id} className="grid grid-cols-1 md:grid-cols-2 gap-3 p-3 border rounded bg-background">
                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Bien #{idx + 1} - Description</Label>
                                    <Input
                                      placeholder="Ex: Appartement 3 pièces Paris 15e"
                                      value={bien.description}
                                      onChange={(e) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], description: e.target.value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Valeur estimée (€)</Label>
                                    <Input
                                      type="number"
                                      placeholder="250000"
                                      value={bien.valeurEstimee}
                                      onChange={(e) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], valeurEstimee: e.target.value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Dettes attachées au bien</Label>
                                    <Input
                                      type="number"
                                      placeholder="150000"
                                      value={bien.dettesAttachees}
                                      onChange={(e) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], dettesAttachees: e.target.value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Affectation prévue</Label>
                                    <Select 
                                      value={bien.affectationPrevue} 
                                      onValueChange={(value) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], affectationPrevue: value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="epoux1">Attribué à Époux 1</SelectItem>
                                        <SelectItem value="epoux2">Attribué à Époux 2</SelectItem>
                                        <SelectItem value="vente">Vente du bien</SelectItem>
                                        <SelectItem value="indivision">Maintien en indivision</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                </div>
                              ))}
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                                onClick={() => {
                                  const newId = Math.max(...contratMariageData.biensCommuns.map(b => b.id), 0) + 1;
                                  setContratMariageData({
                                    ...contratMariageData,
                                    biensCommuns: [...contratMariageData.biensCommuns, {
                                      id: newId,
                                      description: "",
                                      valeurEstimee: "",
                                      dettesAttachees: "",
                                      affectationPrevue: "",
                                      repartitionEnvisagee: "",
                                    }]
                                  });
                                }}
                              >
                                + Ajouter un bien commun
                              </Button>
                            </div>

                            {/* Passif commun */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">💳 Passif commun à répartir</h4>
                              <p className="text-xs text-muted-foreground">Crédits, dettes ménagères, prêts en cours, comptes courants</p>
                              
                              {contratMariageData.passifCommun.map((dette, idx) => (
                                <div key={dette.id} className="grid grid-cols-1 md:grid-cols-3 gap-3 p-3 border rounded bg-background">
                                  <div className="space-y-2">
                                    <Label>Dette #{idx + 1} - Description</Label>
                                    <Input
                                      placeholder="Ex: Crédit auto"
                                      value={dette.description}
                                      onChange={(e) => {
                                        const newDettes = [...contratMariageData.passifCommun];
                                        newDettes[idx] = {...newDettes[idx], description: e.target.value};
                                        setContratMariageData({...contratMariageData, passifCommun: newDettes});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Montant (€)</Label>
                                    <Input
                                      type="number"
                                      placeholder="15000"
                                      value={dette.montant}
                                      onChange={(e) => {
                                        const newDettes = [...contratMariageData.passifCommun];
                                        newDettes[idx] = {...newDettes[idx], montant: e.target.value};
                                        setContratMariageData({...contratMariageData, passifCommun: newDettes});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Mode de répartition</Label>
                                    <Select 
                                      value={dette.modeRepartition} 
                                      onValueChange={(value) => {
                                        const newDettes = [...contratMariageData.passifCommun];
                                        newDettes[idx] = {...newDettes[idx], modeRepartition: value};
                                        setContratMariageData({...contratMariageData, passifCommun: newDettes});
                                      }}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="epoux1">Pris en charge par Époux 1</SelectItem>
                                        <SelectItem value="epoux2">Pris en charge par Époux 2</SelectItem>
                                        <SelectItem value="50_50">Répartition 50/50</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                </div>
                              ))}
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                                onClick={() => {
                                  const newId = Math.max(...contratMariageData.passifCommun.map(d => d.id), 0) + 1;
                                  setContratMariageData({
                                    ...contratMariageData,
                                    passifCommun: [...contratMariageData.passifCommun, {
                                      id: newId,
                                      description: "",
                                      montant: "",
                                      modeRepartition: "",
                                    }]
                                  });
                                }}
                              >
                                + Ajouter une dette
                              </Button>
                            </div>

                            {/* Soulte */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">💰 Soulte éventuelle</h4>
                              <p className="text-xs text-muted-foreground">Si l'un reçoit plus de biens que l'autre</p>
                              
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div className="space-y-2 md:col-span-2">
                                  <Label>Soulte due ?</Label>
                                  <RadioGroup
                                    value={contratMariageData.soulte.soulteDue}
                                    onValueChange={(value) => setContratMariageData({
                                      ...contratMariageData,
                                      soulte: {...contratMariageData.soulte, soulteDue: value}
                                    })}
                                  >
                                    <div className="flex gap-4">
                                      <div className="flex items-center space-x-2">
                                        <RadioGroupItem value="oui" id="soulte_oui" />
                                        <Label htmlFor="soulte_oui" className="cursor-pointer">Oui</Label>
                                      </div>
                                      <div className="flex items-center space-x-2">
                                        <RadioGroupItem value="non" id="soulte_non" />
                                        <Label htmlFor="soulte_non" className="cursor-pointer">Non</Label>
                                      </div>
                                    </div>
                                  </RadioGroup>
                                </div>

                                {contratMariageData.soulte.soulteDue === "oui" && (
                                  <>
                                    <div className="space-y-2">
                                      <Label>Montant de la soulte (€)</Label>
                                      <Input
                                        type="number"
                                        value={contratMariageData.soulte.montantSoulte}
                                        onChange={(e) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, montantSoulte: e.target.value}
                                        })}
                                      />
                                    </div>
                                    <div className="space-y-2">
                                      <Label>Époux débiteur</Label>
                                      <Select 
                                        value={contratMariageData.soulte.epouxDebiteur} 
                                        onValueChange={(value) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, epouxDebiteur: value}
                                        })}
                                      >
                                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                        <SelectContent>
                                          <SelectItem value="epoux1">Époux 1</SelectItem>
                                          <SelectItem value="epoux2">Époux 2</SelectItem>
                                        </SelectContent>
                                      </Select>
                                    </div>
                                    <div className="space-y-2">
                                      <Label>Modalités de paiement</Label>
                                      <RadioGroup
                                        value={contratMariageData.soulte.modalitesPaiement}
                                        onValueChange={(value) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, modalitesPaiement: value}
                                        })}
                                      >
                                        <div className="flex gap-4">
                                          <div className="flex items-center space-x-2">
                                            <RadioGroupItem value="comptant" id="paiement_comptant" />
                                            <Label htmlFor="paiement_comptant" className="cursor-pointer">Comptant</Label>
                                          </div>
                                          <div className="flex items-center space-x-2">
                                            <RadioGroupItem value="echelonne" id="paiement_echelonne" />
                                            <Label htmlFor="paiement_echelonne" className="cursor-pointer">Paiement échelonné</Label>
                                          </div>
                                        </div>
                                      </RadioGroup>
                                    </div>
                                    <div className="space-y-2">
                                      <Label>Date limite de paiement</Label>
                                      <Input
                                        type="date"
                                        value={contratMariageData.soulte.dateLimitePaiement}
                                        onChange={(e) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, dateLimitePaiement: e.target.value}
                                        })}
                                      />
                                    </div>
                                  </>
                                )}
                              </div>
                            </div>

                            {/* Actifs financiers */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">🏦 Actifs financiers communs</h4>
                              <p className="text-xs text-muted-foreground">Comptes bancaires, placements, livrets, assurances-vie si communs</p>
                              
                              {contratMariageData.actifsFinanciers.map((actif, idx) => (
                                <div key={actif.id} className="grid grid-cols-1 md:grid-cols-2 gap-3 p-3 border rounded bg-background">
                                  <div className="space-y-2">
                                    <Label>Nature du compte</Label>
                                    <Input
                                      placeholder="Ex: Compte joint, Livret A"
                                      value={actif.natureCompte}
                                      onChange={(e) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], natureCompte: e.target.value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Établissement bancaire</Label>
                                    <Input
                                      placeholder="Ex: Crédit Agricole"
                                      value={actif.etablissement}
                                      onChange={(e) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], etablissement: e.target.value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Solde (€)</Label>
                                    <Input
                                      type="number"
                                      placeholder="25000"
                                      value={actif.solde}
                                      onChange={(e) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], solde: e.target.value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Mode de partage</Label>
                                    <Select 
                                      value={actif.modePartage} 
                                      onValueChange={(value) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], modePartage: value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="epoux1">Attribué à Époux 1</SelectItem>
                                        <SelectItem value="epoux2">Attribué à Époux 2</SelectItem>
                                        <SelectItem value="personnalise">Répartition personnalisée</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                  {actif.modePartage === "personnalise" && (
                                    <div className="space-y-2 md:col-span-2">
                                      <Label>Préciser la répartition</Label>
                                      <Input
                                        placeholder="Ex: 60% Époux 1, 40% Époux 2"
                                        value={actif.partagePersonnalise}
                                        onChange={(e) => {
                                          const newActifs = [...contratMariageData.actifsFinanciers];
                                          newActifs[idx] = {...newActifs[idx], partagePersonnalise: e.target.value};
                                          setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                        }}
                                      />
                                    </div>
                                  )}
                                </div>
                              ))}
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                                onClick={() => {
                                  const newId = Math.max(...contratMariageData.actifsFinanciers.map(a => a.id), 0) + 1;
                                  setContratMariageData({
                                    ...contratMariageData,
                                    actifsFinanciers: [...contratMariageData.actifsFinanciers, {
                                      id: newId,
                                      natureCompte: "",
                                      etablissement: "",
                                      solde: "",
                                      modePartage: "",
                                      partagePersonnalise: "",
                                    }]
                                  });
                                }}
                              >
                                + Ajouter un actif financier
                              </Button>
                            </div>

                            {/* Observations */}
                            <div className="space-y-2">
                              <Label>📝 Observations complémentaires</Label>
                              <Textarea
                                rows={4}
                                value={contratMariageData.observationsLiquidation}
                                onChange={(e) => setContratMariageData({...contratMariageData, observationsLiquidation: e.target.value})}
                                placeholder="Avantage matrimonial antérieur, biens indivis post-liquidation, modalités particulières..."
                              />
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 5. Clauses selon le régime choisi */}
                  {contratMariageData.typeRegime === "separation_biens" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Séparation de biens</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="admin_exclusive"
                            checked={contratMariageData.clausesSeparation.administrationExclusive}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, administrationExclusive: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="admin_exclusive" className="cursor-pointer">Administration et jouissance exclusives par chaque époux</Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="comptes_sep"
                            checked={contratMariageData.clausesSeparation.comptesSepares}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, comptesSepares: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="comptes_sep" className="cursor-pointer">Comptes bancaires séparés</Label>
                        </div>

                        <div className="space-y-2">
                          <Label>Contribution aux charges du mariage</Label>
                          <Select 
                            value={contratMariageData.clausesSeparation.contributionCharges} 
                            onValueChange={(value) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, contributionCharges: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="proportionnelle">Proportionnelle aux revenus</SelectItem>
                              <SelectItem value="50_50">50/50</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {contratMariageData.clausesSeparation.contributionCharges === "autre" && (
                          <div className="space-y-2">
                            <Label>Préciser</Label>
                            <Input
                              value={contratMariageData.clausesSeparation.contributionChargesAutre}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                clausesSeparation: {...contratMariageData.clausesSeparation, contributionChargesAutre: e.target.value}
                              })}
                            />
                          </div>
                        )}

                        <div className="space-y-2">
                          <Label>Mise en commun éventuelle d'un bien</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesSeparation.miseEnCommunBien}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, miseEnCommunBien: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {contratMariageData.typeRegime === "communaute_acquets_amenagee" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Communauté aménagée</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Définition des biens communs et propres</Label>
                          <Textarea
                            rows={3}
                            value={contratMariageData.clausesCommunauteAmenagee.definitionBiensCommunsPropres}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, definitionBiensCommunsPropres: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Aménagement des biens professionnels</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesCommunauteAmenagee.amenagementBiensProfessionnels}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, amenagementBiensProfessionnels: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Type d'administration</Label>
                          <RadioGroup
                            value={contratMariageData.clausesCommunauteAmenagee.typeAdministration}
                            onValueChange={(value) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, typeAdministration: value}
                            })}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="symetriques" id="admin_sym" />
                                <Label htmlFor="admin_sym" className="cursor-pointer">Pouvoirs symétriques</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="unique" id="admin_uniq" />
                                <Label htmlFor="admin_uniq" className="cursor-pointer">Pouvoir unique pour certains biens</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.clausesCommunauteAmenagee.typeAdministration === "unique" && (
                          <div className="space-y-2">
                            <Label>Détails du pouvoir unique</Label>
                            <Textarea
                              rows={2}
                              value={contratMariageData.clausesCommunauteAmenagee.pouvoirUniqueDetails}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, pouvoirUniqueDetails: e.target.value}
                              })}
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {contratMariageData.typeRegime === "communaute_universelle" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Communauté universelle</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Clause d'attribution intégrale au survivant</Label>
                          <RadioGroup
                            value={contratMariageData.clausesCommunauteUniverselle.attributionIntegraleSurvivant}
                            onValueChange={(value) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteUniverselle: {...contratMariageData.clausesCommunauteUniverselle, attributionIntegraleSurvivant: value}
                            })}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="attrib_oui" />
                                <Label htmlFor="attrib_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="attrib_non" />
                                <Label htmlFor="attrib_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        <div className="space-y-2">
                          <Label>Clause de préciput (le survivant prend un bien avant partage)</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesCommunauteUniverselle.clausesPreciput}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteUniverselle: {...contratMariageData.clausesCommunauteUniverselle, clausesPreciput: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Exclusion de certains biens</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesCommunauteUniverselle.exclusionCertainsBiens}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteUniverselle: {...contratMariageData.clausesCommunauteUniverselle, exclusionCertainsBiens: e.target.value}
                            })}
                            placeholder="Ex: héritages, biens professionnels..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {contratMariageData.typeRegime === "participation_acquets" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Participation aux acquêts</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Définition des patrimoines originels</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.definitionPatrimoinesOriginels}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, definitionPatrimoinesOriginels: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Définition du patrimoine final</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.definitionPatrimoineFinal}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, definitionPatrimoineFinal: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Calcul de la créance de participation</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.calculCreanceParticipation}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, calculCreanceParticipation: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Détermination des biens propres par nature</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.biensPropresParNature}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, biensPropresParNature: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 6. Clauses optionnelles avancées */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⚙️ Clauses optionnelles avancées</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Clause de remploi</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.clauseRemploi}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, clauseRemploi: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause de préciput</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.clausePreciput}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, clausePreciput: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Attribution préférentielle de biens</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.attributionPreferentielle}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, attributionPreferentielle: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Gestion séparée des biens professionnels</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.gestionSepareeBiensProfessionnels}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, gestionSepareeBiensProfessionnels: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Protection du conjoint survivant</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.protectionConjointSurvivant}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, protectionConjointSurvivant: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Donation entre époux (si intégrée)</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.donationEntreEpoux}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, donationEntreEpoux: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 7. Déclarations obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">✅ Déclarations obligatoires des époux</h3>
                    <div className="p-4 bg-muted/30 rounded-lg space-y-3">
                      <p className="text-sm text-muted-foreground">Les époux déclarent :</p>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_identite"
                            checked={contratMariageData.declarations.identite}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, identite: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_identite" className="cursor-pointer">Leur identité</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_capacite"
                            checked={contratMariageData.declarations.capaciteJuridique}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, capaciteJuridique: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_capacite" className="cursor-pointer">Leur capacité juridique</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_situation"
                            checked={contratMariageData.declarations.situationMatrimoniale}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, situationMatrimoniale: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_situation" className="cursor-pointer">Leur situation matrimoniale</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_opposition"
                            checked={contratMariageData.declarations.absenceOpposition}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, absenceOpposition: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_opposition" className="cursor-pointer">L'absence d'opposition au mariage</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_choix"
                            checked={contratMariageData.declarations.choixLibreEclaire}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, choixLibreEclaire: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_choix" className="cursor-pointer">Leur choix libre et éclairé du régime</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_connaissance"
                            checked={contratMariageData.declarations.connaissanceEffetsJuridiques}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, connaissanceEffetsJuridiques: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_connaissance" className="cursor-pointer">Leur connaissance des effets juridiques du régime</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 8. Documents à fournir */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📎 Documents à fournir</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Époux 1 - Identité */}
                      <div className="space-y-2">
                        <Label>Époux 1 - Pièce d'identité</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf,image/*"
                            multiple
                            className="hidden"
                            id="cm_epoux1_identite"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux1IdentiteFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux1_identite" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux1IdentiteFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux1IdentiteFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux1IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Époux 2 - Identité */}
                      <div className="space-y-2">
                        <Label>Époux 2 - Pièce d'identité</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf,image/*"
                            multiple
                            className="hidden"
                            id="cm_epoux2_identite"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux2IdentiteFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux2_identite" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux2IdentiteFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux2IdentiteFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux2IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Actes de naissance */}
                      <div className="space-y-2">
                        <Label>Époux 1 - Acte de naissance (&lt; 3 mois)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="cm_epoux1_naissance"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux1ActeNaissanceFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux1_naissance" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux1ActeNaissanceFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux1ActeNaissanceFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux1ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Époux 2 - Acte de naissance (&lt; 3 mois)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="cm_epoux2_naissance"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux2ActeNaissanceFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux2_naissance" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux2ActeNaissanceFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux2ActeNaissanceFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux2ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Si changement de régime - SUPPRIMÉ */}
                      {false && (
                        <>
                          <div className="space-y-2">
                            <Label>Contrat de mariage initial</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_contrat_initial"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageContratInitialFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_contrat_initial" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageContratInitialFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageContratInitialFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageContratInitialFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Accord enfants majeurs</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_accord_enfants"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageAccordEnfantsFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_accord_enfants" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageAccordEnfantsFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageAccordEnfantsFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageAccordEnfantsFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        </>
                      )}

                      {/* Certificat de publication des bans */}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Certificat de publication des bans</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="cm_certificat_bans"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setContratMariageCertificatBansFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="cm_certificat_bans" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {contratMariageCertificatBansFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {contratMariageCertificatBansFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setContratMariageCertificatBansFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                      {/* Documents optionnels */}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Titres de propriété (si clause sur bien immobilier)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="cm_titres"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageTitresProprieteFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_titres" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageTitresProprieteFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageTitresProprieteFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageTitresProprieteFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour PACS */}
            {pendingContractType === "PACS (convention + enregistrement)" && (
              <>
                <div className="space-y-6">
                  <div className="bg-muted/30 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg mb-4">📋 Convention de PACS</h3>
                    <p className="text-sm text-muted-foreground">
                      Complétez les informations nécessaires pour la rédaction de la convention de PACS.
                    </p>
                  </div>

                  {/* 1. Informations générales */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur le PACS</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Objet du PACS */}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          Objet du PACS
                          <span className="text-red-500">*</span>
                        </Label>
                        <Select value={pacsData.objetPacs} onValueChange={(value) => setPacsData({...pacsData, objetPacs: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="initial">PACS initial</SelectItem>
                            <SelectItem value="modification">Modification de PACS existant</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Régime choisi */}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          Régime choisi
                          <span className="text-red-500">*</span>
                        </Label>
                        <Select value={pacsData.regimePacs} onValueChange={(value) => setPacsData({...pacsData, regimePacs: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="separation">Séparation de biens (régime légal par défaut)</SelectItem>
                            <SelectItem value="indivision">Indivision</SelectItem>
                            <SelectItem value="personnalise">Régime personnalisé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Date prise d'effet */}
                      <div className="space-y-2">
                        <Label>Date de prise d'effet souhaitée</Label>
                        <Input
                          type="date"
                          value={pacsData.datePriseEffetSouhaitee}
                          onChange={(e) => setPacsData({...pacsData, datePriseEffetSouhaitee: e.target.value})}
                        />
                        <p className="text-xs text-muted-foreground">Par défaut : à l'enregistrement</p>
                      </div>
                    </div>

                    {/* Régime personnalisé */}
                    {pacsData.regimePacs === "personnalise" && (
                      <div className="space-y-4 p-4 border rounded-lg bg-muted/30">
                        <h4 className="font-medium">Régime personnalisé</h4>
                        <div className="space-y-2">
                          <Label>Définition des biens communs</Label>
                          <Textarea
                            value={pacsData.regimePersonnalise.definitionBiensCommuns}
                            onChange={(e) => setPacsData({
                              ...pacsData,
                              regimePersonnalise: {...pacsData.regimePersonnalise, definitionBiensCommuns: e.target.value}
                            })}
                            rows={3}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Biens propres</Label>
                          <Textarea
                            value={pacsData.regimePersonnalise.biensPropres}
                            onChange={(e) => setPacsData({
                              ...pacsData,
                              regimePersonnalise: {...pacsData.regimePersonnalise, biensPropres: e.target.value}
                            })}
                            rows={3}
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 2. Adresse commune */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Adresse commune (obligatoire)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label className="flex items-center gap-2">
                          Adresse commune déclarée
                          <span className="text-red-500">*</span>
                        </Label>
                        <Input
                          value={pacsData.adresseCommune}
                          onChange={(e) => setPacsData({...pacsData, adresseCommune: e.target.value})}
                          placeholder="Adresse complète de résidence commune"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de début de résidence commune</Label>
                        <Input
                          type="date"
                          value={pacsData.dateDebutResidenceCommune}
                          onChange={(e) => setPacsData({...pacsData, dateDebutResidenceCommune: e.target.value})}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 3. Déclarations obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Déclarations sur l'honneur (obligatoires)</h3>
                    <div className="space-y-3 p-4 border rounded-lg">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl1"
                          checked={pacsData.declarations.residenceCommune}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            declarations: {...pacsData.declarations, residenceCommune: e.target.checked}
                          })}
                        />
                        <label htmlFor="decl1" className="text-sm">
                          Déclaration de résidence commune <span className="text-red-500">*</span>
                        </label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl2"
                          checked={pacsData.declarations.absenceLienParente}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            declarations: {...pacsData.declarations, absenceLienParente: e.target.checked}
                          })}
                        />
                        <label htmlFor="decl2" className="text-sm">
                          Déclaration d'absence de lien de parenté <span className="text-red-500">*</span>
                        </label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl3"
                          checked={pacsData.declarations.absenceMariageEtPacs}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            declarations: {...pacsData.declarations, absenceMariageEtPacs: e.target.checked}
                          })}
                        />
                        <label htmlFor="decl3" className="text-sm">
                          Déclaration d'absence de mariage et PACS en cours <span className="text-red-500">*</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* 4. Identité des partenaires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète des partenaires</h3>
                    
                    {pacsData.partenaires.map((partenaire, index) => (
                      <div key={partenaire.id} className="p-4 border rounded-lg space-y-4 bg-muted/20">
                        <h4 className="font-medium text-base">Partenaire #{index + 1}</h4>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Sélection client */}
                          <div className="space-y-2 md:col-span-2">
                            <ClientSelector
                              clients={clients}
                              selectedClientId={partenaire.clientId || ""}
                              onClientChange={async (clientId) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index] = {...newPartenaires[index], clientId: clientId, isClient: !!clientId};
                                
                                if (clientId) {
                                  const client = clients.find(c => c.id === clientId);
                                  if (client) {
                                    newPartenaires[index].nom = client.nom || "";
                                    newPartenaires[index].prenom = client.prenom || "";
                                    newPartenaires[index].nomNaissance = client.nom || "";
                                    newPartenaires[index].adresseActuelle = client.adresse || "";
                                    newPartenaires[index].dateNaissance = client.date_naissance || "";
                                    newPartenaires[index].lieuNaissance = client.lieu_naissance || "";
                                    newPartenaires[index].nationalite = client.nationalite || "";
                                    newPartenaires[index].profession = client.profession || "";
                                    newPartenaires[index].telephone = client.telephone || "";
                                    newPartenaires[index].email = client.email || "";
                                    newPartenaires[index].typeIdentite = client.type_identite || "";
                                    newPartenaires[index].numeroIdentite = client.numero_identite || "";
                                    
                                    // Extraire la situation familiale de l'objet JSON
                                    let situationFamiliale = "";
                                    if (typeof client.situation_familiale === 'object' && client.situation_familiale !== null) {
                                      situationFamiliale = client.situation_familiale.situation_familiale || "";
                                    } else if (typeof client.situation_familiale === 'string') {
                                      situationFamiliale = client.situation_familiale;
                                    }
                                    newPartenaires[index].situationFamiliale = situationFamiliale || client.situation_matrimoniale || "";
                                  }
                                  setPacsData({...pacsData, partenaires: newPartenaires});
                                } else {
                                  newPartenaires[index] = {
                                    ...newPartenaires[index],
                                    clientId: "",
                                    nom: "",
                                    prenom: "",
                                    nomNaissance: "",
                                    adresseActuelle: "",
                                    dateNaissance: "",
                                    lieuNaissance: "",
                                    nationalite: "",
                                    profession: "",
                                    telephone: "",
                                    email: "",
                                    typeIdentite: "",
                                    numeroIdentite: "",
                                    situationFamiliale: "",
                                  };
                                  setPacsData({...pacsData, partenaires: newPartenaires});
                                }
                              }}
                              label="Sélectionner un client (optionnel)"
                              placeholder="Choisir un client"
                            />
                          </div>

                          {/* Informations civiles */}
                          <div className="space-y-2">
                            <Label>Nom <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.nom}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].nom = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.prenom}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].prenom = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nom de naissance</Label>
                            <Input
                              value={partenaire.nomNaissance}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].nomNaissance = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance <span className="text-red-500">*</span></Label>
                            <Input
                              type="date"
                              value={partenaire.dateNaissance}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].dateNaissance = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.lieuNaissance}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].lieuNaissance = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.nationalite}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].nationalite = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={partenaire.profession}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].profession = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input
                              value={partenaire.telephone}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].telephone = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input
                              type="email"
                              value={partenaire.email}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].email = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse actuelle <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.adresseActuelle}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].adresseActuelle = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          {/* Situation familiale */}
                          <div className="space-y-2">
                            <Label>Situation familiale actuelle <span className="text-red-500">*</span></Label>
                            <Select 
                              value={partenaire.situationFamiliale}
                              onValueChange={(value) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].situationFamiliale = value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="celibataire">Célibataire</SelectItem>
                                <SelectItem value="divorce">Divorcé(e)</SelectItem>
                                <SelectItem value="veuf">Veuf/Veuve</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Pièce d'identité */}
                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Select 
                              value={partenaire.typeIdentite}
                              onValueChange={(value) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].typeIdentite = value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="CNI">Carte Nationale d'Identité</SelectItem>
                                <SelectItem value="Passeport">Passeport</SelectItem>
                                <SelectItem value="Titre de séjour">Titre de séjour</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de pièce d'identité</Label>
                            <Input
                              value={partenaire.numeroIdentite}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].numeroIdentite = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'émission</Label>
                            <Input
                              type="date"
                              value={partenaire.dateEmissionIdentite}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].dateEmissionIdentite = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Autorité délivrante</Label>
                            <Input
                              value={partenaire.autoriteDelivrante}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].autoriteDelivrante = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                              placeholder="Ex: Préfecture de Paris"
                            />
                          </div>

                          {/* Partenaire étranger */}
                          <div className="space-y-2 md:col-span-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`etranger-${index}`}
                                checked={partenaire.estEtranger}
                                onChange={(e) => {
                                  const newPartenaires = [...pacsData.partenaires];
                                  newPartenaires[index].estEtranger = e.target.checked;
                                  setPacsData({...pacsData, partenaires: newPartenaires});
                                }}
                              />
                              <label htmlFor={`etranger-${index}`} className="text-sm font-medium">
                                Partenaire étranger (nécessite documents supplémentaires)
                              </label>
                            </div>
                          </div>

                          {partenaire.estEtranger && (
                            <div className="md:col-span-2 p-3 bg-yellow-50 border border-yellow-200 rounded space-y-2">
                              <p className="text-sm font-medium text-yellow-800">Documents supplémentaires requis :</p>
                              <div className="space-y-2">
                                <div className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    id={`attestation-${index}`}
                                    checked={partenaire.attestationNonPacsPaysOrigine}
                                    onChange={(e) => {
                                      const newPartenaires = [...pacsData.partenaires];
                                      newPartenaires[index].attestationNonPacsPaysOrigine = e.target.checked;
                                      setPacsData({...pacsData, partenaires: newPartenaires});
                                    }}
                                  />
                                  <label htmlFor={`attestation-${index}`} className="text-sm">Attestation de non-PACS du pays d'origine</label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    id={`coutume-${index}`}
                                    checked={partenaire.certificatCoutumeRequis}
                                    onChange={(e) => {
                                      const newPartenaires = [...pacsData.partenaires];
                                      newPartenaires[index].certificatCoutumeRequis = e.target.checked;
                                      setPacsData({...pacsData, partenaires: newPartenaires});
                                    }}
                                  />
                                  <label htmlFor={`coutume-${index}`} className="text-sm">Certificat de coutume</label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    id={`traduction-${index}`}
                                    checked={partenaire.traductionRequise}
                                    onChange={(e) => {
                                      const newPartenaires = [...pacsData.partenaires];
                                      newPartenaires[index].traductionRequise = e.target.checked;
                                      setPacsData({...pacsData, partenaires: newPartenaires});
                                    }}
                                  />
                                  <label htmlFor={`traduction-${index}`} className="text-sm">Traductions certifiées nécessaires</label>
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 5. Modification de PACS (si applicable) */}
                  {pacsData.objetPacs === "modification" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Référence du PACS initial</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Date du PACS initial</Label>
                          <Input
                            type="date"
                            value={pacsData.pacsInitialDate}
                            onChange={(e) => setPacsData({...pacsData, pacsInitialDate: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Mairie ou notaire d'enregistrement</Label>
                          <Input
                            value={pacsData.pacsInitialMairie}
                            onChange={(e) => setPacsData({...pacsData, pacsInitialMairie: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéro d'enregistrement (si connu)</Label>
                          <Input
                            value={pacsData.pacsInitialNumero}
                            onChange={(e) => setPacsData({...pacsData, pacsInitialNumero: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Clauses modifiées</Label>
                          <Textarea
                            value={pacsData.clausesModifiees}
                            onChange={(e) => setPacsData({...pacsData, clausesModifiees: e.target.value})}
                            rows={4}
                            placeholder="Décrivez les modifications apportées..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 6. Clauses du PACS */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses du PACS</h3>
                    
                    {/* A. Contribution aux charges */}
                    <div className="space-y-3 p-4 border rounded-lg">
                      <h4 className="font-medium">A. Contribution aux charges du ménage (obligatoire)</h4>
                      <div className="space-y-2">
                        <Select 
                          value={pacsData.contributionCharges}
                          onValueChange={(value) => setPacsData({...pacsData, contributionCharges: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="proportionnelle">Proportionnelle aux revenus</SelectItem>
                            <SelectItem value="50_50">50/50</SelectItem>
                            <SelectItem value="autre">Autre (préciser)</SelectItem>
                          </SelectContent>
                        </Select>
                        {pacsData.contributionCharges === "autre" && (
                          <Input
                            value={pacsData.contributionChargesAutre}
                            onChange={(e) => setPacsData({...pacsData, contributionChargesAutre: e.target.value})}
                            placeholder="Précisez la répartition..."
                          />
                        )}
                      </div>
                    </div>

                    {/* B. Clauses facultatives */}
                    <div className="space-y-3 p-4 border rounded-lg bg-muted/20">
                      <h4 className="font-medium">B. Clauses facultatives</h4>
                      
                      <div className="space-y-2">
                        <Label>Gestion des biens personnels</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.gestionBiensPersonnels}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, gestionBiensPersonnels: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Gestion d'un bien commun</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.gestionBienCommun}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, gestionBienCommun: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Usage d'un bien indivis</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.usageBienIndivis}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, usageBienIndivis: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition de dépenses spécifiques</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.repartitionDepensesSpecifiques}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, repartitionDepensesSpecifiques: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause d'occupation du logement en cas de séparation</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clauseOccupationLogementSeparation}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clauseOccupationLogementSeparation: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause de reprise de bien en cas de décès</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clauseRepriseBienDeces}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clauseRepriseBienDeces: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause d'abandon de créance entre partenaires</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clauseAbandonCreance}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clauseAbandonCreance: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Modalités d'utilisation d'un compte bancaire commun</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.modalitesCompteBancaireCommun}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, modalitesCompteBancaireCommun: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clauses financières personnalisées</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clausesFinancieresPersonnalisees}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clausesFinancieresPersonnalisees: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clauses de solidarité sur certaines dettes</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clausesSolidariteDettes}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clausesSolidariteDettes: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 7. Enfants en commun */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Enfant(s) en commun (optionnel)</h3>
                    <div className="space-y-2">
                      <Label>Avez-vous un ou plusieurs enfants en commun ?</Label>
                      <Select 
                        value={pacsData.enfantEnCommun}
                        onValueChange={(value) => setPacsData({...pacsData, enfantEnCommun: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {pacsData.enfantEnCommun === "oui" && (
                      <div className="space-y-4">
                        {pacsData.enfants.map((enfant, idx) => (
                          <div key={enfant.id} className="p-4 border rounded-lg space-y-3 bg-muted/10">
                            <div className="flex justify-between items-center">
                              <h5 className="font-medium">Enfant #{idx + 1}</h5>
                              {idx > 0 && (
                                <button
                                  type="button"
                                  onClick={() => {
                                    const newEnfants = pacsData.enfants.filter((_, i) => i !== idx);
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                  className="text-red-600 text-sm"
                                >
                                  Supprimer
                                </button>
                              )}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Nom</Label>
                                <Input
                                  value={enfant.nom}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].nom = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Prénom</Label>
                                <Input
                                  value={enfant.prenom}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].prenom = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Date de naissance</Label>
                                <Input
                                  type="date"
                                  value={enfant.dateNaissance}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].dateNaissance = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Autorité parentale</Label>
                                <Input
                                  value={enfant.autoriteParentale}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].autoriteParentale = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                  placeholder="Conjointe / Exclusive / Autre"
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          onClick={() => {
                            setPacsData({
                              ...pacsData,
                              enfants: [...pacsData.enfants, {
                                id: pacsData.enfants.length + 1,
                                nom: "",
                                prenom: "",
                                dateNaissance: "",
                                autoriteParentale: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un enfant
                        </Button>
                      </div>
                    )}
                  </div>

                  {/* 8. Biens préexistants */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Biens déjà acquis ensemble</h3>
                    <div className="space-y-2">
                      <Label>Avez-vous déjà des biens acquis ensemble ?</Label>
                      <Select 
                        value={pacsData.biensPreexistants}
                        onValueChange={(value) => setPacsData({...pacsData, biensPreexistants: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {pacsData.biensPreexistants === "oui" && (
                      <div className="space-y-4">
                        {pacsData.biensListe.map((bien, idx) => (
                          <div key={bien.id} className="p-4 border rounded-lg space-y-3 bg-muted/10">
                            <div className="flex justify-between items-center">
                              <h5 className="font-medium">Bien #{idx + 1}</h5>
                              {idx > 0 && (
                                <button
                                  type="button"
                                  onClick={() => {
                                    const newBiens = pacsData.biensListe.filter((_, i) => i !== idx);
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  className="text-red-600 text-sm"
                                >
                                  Supprimer
                                </button>
                              )}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2 md:col-span-2">
                                <Label>Description du bien</Label>
                                <Textarea
                                  value={bien.description}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].description = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  rows={2}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Quote-part partenaire 1</Label>
                                <Input
                                  value={bien.quotePart1}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].quotePart1 = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  placeholder="Ex: 50%"
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Quote-part partenaire 2</Label>
                                <Input
                                  value={bien.quotePart2}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].quotePart2 = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  placeholder="Ex: 50%"
                                />
                              </div>
                              <div className="space-y-2 md:col-span-2">
                                <Label>Indivision</Label>
                                <Input
                                  value={bien.indivision}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].indivision = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  placeholder="Modalités d'indivision..."
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          onClick={() => {
                            setPacsData({
                              ...pacsData,
                              biensListe: [...pacsData.biensListe, {
                                id: pacsData.biensListe.length + 1,
                                description: "",
                                quotePart1: "",
                                quotePart2: "",
                                indivision: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un bien
                        </Button>
                      </div>
                    )}
                  </div>

                  {/* 9. Droit applicable */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Droit applicable</h3>
                    <div className="space-y-2">
                      <Label>Droit applicable au PACS</Label>
                      <Select 
                        value={pacsData.droitApplicable}
                        onValueChange={(value) => setPacsData({...pacsData, droitApplicable: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="francais">Droit français</SelectItem>
                          <SelectItem value="autre">Autre droit (préciser)</SelectItem>
                        </SelectContent>
                      </Select>
                      {pacsData.droitApplicable === "autre" && (
                        <Input
                          value={pacsData.droitApplicableAutre}
                          onChange={(e) => setPacsData({...pacsData, droitApplicableAutre: e.target.value})}
                          placeholder="Précisez le droit applicable..."
                        />
                      )}
                    </div>
                  </div>

                  {/* 10. Pièces justificatives */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Pièces justificatives (obligatoires pour l'enregistrement)</h3>
                    
                    <div className="bg-blue-50 border border-gray-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        📌 <strong>Documents obligatoires pour chaque partenaire :</strong> pièce d'identité, justificatif de domicile, acte de naissance intégral, 
                        + jugement de divorce (si divorcé) ou acte de décès (si veuf)
                      </p>
                    </div>

                    {/* Documents Partenaire 1 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Partenaire 1</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité P1 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p1_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile P1 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p1_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte naissance P1 */}
                        <div className="space-y-2">
                          <Label>Acte de naissance intégral <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p1_naissance"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1ActeNaissanceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_naissance" className="cursor-pointer text-sm text-muted-foreground">
                              &lt; 3 mois (France) ou &lt; 6 mois (étranger)
                            </label>
                            {pacsPartenaire1ActeNaissanceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1ActeNaissanceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Jugement divorce P1 */}
                        <div className="space-y-2">
                          <Label>Jugement de divorce (si applicable)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p1_divorce"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1DivorceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_divorce" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1DivorceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1DivorceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1DivorceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte décès P1 */}
                        <div className="space-y-2">
                          <Label>Acte de décès conjoint précédent (si veuf/ve)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p1_deces"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1DecesFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_deces" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1DecesFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1DecesFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1DecesFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Documents étranger P1 */}
                        {pacsData.partenaires[0]?.estEtranger && (
                          <>
                            <div className="space-y-2">
                              <Label>Certificat de coutume</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p1_coutume"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire1CertificatCoutumeFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p1_coutume" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire1CertificatCoutumeFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire1CertificatCoutumeFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire1CertificatCoutumeFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2">
                              <Label>Certificat de non-PACS du pays d'origine</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p1_nonpacs"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire1CertificatNonPacsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p1_nonpacs" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire1CertificatNonPacsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire1CertificatNonPacsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire1CertificatNonPacsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Traductions certifiées</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p1_traductions"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire1TraductionsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p1_traductions" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire1TraductionsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire1TraductionsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire1TraductionsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>
                          </>
                        )}
                      </div>
                    </div>

                    {/* Documents Partenaire 2 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Partenaire 2</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité P2 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p2_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile P2 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p2_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte naissance P2 */}
                        <div className="space-y-2">
                          <Label>Acte de naissance intégral <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p2_naissance"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2ActeNaissanceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_naissance" className="cursor-pointer text-sm text-muted-foreground">
                              &lt; 3 mois (France) ou &lt; 6 mois (étranger)
                            </label>
                            {pacsPartenaire2ActeNaissanceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2ActeNaissanceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Jugement divorce P2 */}
                        <div className="space-y-2">
                          <Label>Jugement de divorce (si applicable)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p2_divorce"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2DivorceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_divorce" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2DivorceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2DivorceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2DivorceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte décès P2 */}
                        <div className="space-y-2">
                          <Label>Acte de décès conjoint précédent (si veuf/ve)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p2_deces"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2DecesFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_deces" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2DecesFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2DecesFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2DecesFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Documents étranger P2 */}
                        {pacsData.partenaires[1]?.estEtranger && (
                          <>
                            <div className="space-y-2">
                              <Label>Certificat de coutume</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p2_coutume"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire2CertificatCoutumeFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p2_coutume" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire2CertificatCoutumeFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire2CertificatCoutumeFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire2CertificatCoutumeFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2">
                              <Label>Certificat de non-PACS du pays d'origine</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p2_nonpacs"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire2CertificatNonPacsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p2_nonpacs" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire2CertificatNonPacsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire2CertificatNonPacsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire2CertificatNonPacsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Traductions certifiées</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p2_traductions"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire2TraductionsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p2_traductions" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire2TraductionsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire2TraductionsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire2TraductionsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Donation entre époux */}
            {pendingContractType === "Donation entre époux" && (
              <>
                <div className="space-y-6">
                  <div className="bg-muted/30 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg mb-4">📜 Donation entre époux</h3>
                    <p className="text-sm text-muted-foreground">
                      Complétez les informations nécessaires pour la rédaction de la donation entre époux.
                    </p>
                  </div>

                  {/* 1. Informations générales sur la donation */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur la donation</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Type de donation */}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          Type de donation choisie <span className="text-red-500">*</span>
                        </Label>
                        <Select 
                          value={donationEntreEpouxData.typeDonation}
                          onValueChange={(value) => setDonationEntreEpouxData({...donationEntreEpouxData, typeDonation: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="au_dernier_vivant">Donation entre époux au dernier vivant (effets au décès)</SelectItem>
                            <SelectItem value="biens_presents">Donation de biens présents (effets immédiats – très réglementée)</SelectItem>
                            <SelectItem value="mixte">Donation mixte (rare)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Date prévue de signature */}
                      <div className="space-y-2">
                        <Label>Date prévue de signature de l'acte</Label>
                        <Input
                          type="date"
                          value={donationEntreEpouxData.datePrevueSignature}
                          onChange={(e) => setDonationEntreEpouxData({...donationEntreEpouxData, datePrevueSignature: e.target.value})}
                        />
                      </div>

                      {/* Objet de la donation */}
                      <div className="space-y-2 md:col-span-2">
                        <Label className="flex items-center gap-2">
                          Objet de la donation <span className="text-red-500">*</span>
                        </Label>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                          {[
                            { value: "protection_conjoint", label: "Protection du conjoint survivant" },
                            { value: "transmission_bien", label: "Transmission d'un bien particulier" },
                            { value: "partage_inegal", label: "Partage inégal" },
                            { value: "renforcement_droits", label: "Renforcement des droits successoraux" }
                          ].map(obj => (
                            <div key={obj.value} className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`objet_${obj.value}`}
                                checked={donationEntreEpouxData.objetDonation.includes(obj.value)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      objetDonation: [...donationEntreEpouxData.objetDonation, obj.value]
                                    });
                                  } else {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      objetDonation: donationEntreEpouxData.objetDonation.filter(o => o !== obj.value)
                                    });
                                  }
                                }}
                              />
                              <label htmlFor={`objet_${obj.value}`} className="text-sm cursor-pointer">
                                {obj.label}
                              </label>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 2. Identité complète des époux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète des époux</h3>
                    
                    {donationEntreEpouxData.epoux.map((epoux, index) => (
                      <div key={epoux.id} className="p-4 border rounded-lg space-y-4 bg-muted/20">
                        <h4 className="font-medium text-base">Époux #{index + 1}</h4>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Sélection client */}
                          <div className="space-y-2 md:col-span-2">
                            <ClientSelector
                              clients={clients}
                              selectedClientId={epoux.clientId || ""}
                              onClientChange={async (clientId) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index] = {...newEpoux[index], clientId: clientId, isClient: !!clientId};
                                
                                if (clientId) {
                                  const client = clients.find(c => c.id === clientId);
                                  if (client) {
                                    newEpoux[index].nom = client.nom || "";
                                    newEpoux[index].prenom = client.prenom || "";
                                    newEpoux[index].nomNaissance = client.nom || "";
                                    newEpoux[index].adresseComplete = client.adresse || "";
                                    newEpoux[index].dateNaissance = client.date_naissance || "";
                                    newEpoux[index].lieuNaissance = client.lieu_naissance || "";
                                    newEpoux[index].nationalite = client.nationalite || "";
                                    newEpoux[index].profession = client.profession || "";
                                    newEpoux[index].telephone = client.telephone || "";
                                    newEpoux[index].email = client.email || "";
                                    newEpoux[index].typeIdentite = client.type_identite || "";
                                    newEpoux[index].numeroIdentite = client.numero_identite || "";
                                    
                                    // Extraire la situation familiale et régime matrimonial
                                    let situationFamiliale = "";
                                    let regimeMatrimonial = "";
                                    
                                    // Essayer d'abord situation_matrimoniale
                                    if (client.situation_matrimoniale) {
                                      if (typeof client.situation_matrimoniale === 'object' && client.situation_matrimoniale !== null) {
                                        situationFamiliale = client.situation_matrimoniale.situation_familiale || "";
                                        regimeMatrimonial = client.situation_matrimoniale.regime_matrimonial || "";
                                      } else if (typeof client.situation_matrimoniale === 'string') {
                                        situationFamiliale = client.situation_matrimoniale;
                                      }
                                    }
                                    
                                    // Si pas trouvé, essayer situation_familiale
                                    if (!situationFamiliale && client.situation_familiale) {
                                      if (typeof client.situation_familiale === 'object' && client.situation_familiale !== null) {
                                        situationFamiliale = client.situation_familiale.situation_familiale || "";
                                        regimeMatrimonial = client.situation_familiale.regime_matrimonial || "";
                                      } else if (typeof client.situation_familiale === 'string') {
                                        situationFamiliale = client.situation_familiale;
                                      }
                                    }
                                    
                                    // Si pas trouvé dans les objets, essayer le champ direct
                                    if (!regimeMatrimonial && client.regime_matrimonial) {
                                      regimeMatrimonial = client.regime_matrimonial;
                                    }
                                    
                                    newEpoux[index].situationMatrimoniale = situationFamiliale || "marie";
                                    newEpoux[index].regimeMatrimonial = regimeMatrimonial || "";
                                    newEpoux[index].dateMariage = client.date_mariage || "";
                                  }
                                  setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                                } else {
                                  newEpoux[index] = {
                                    ...newEpoux[index],
                                    clientId: "",
                                    nom: "",
                                    prenom: "",
                                    nomNaissance: "",
                                    adresseComplete: "",
                                    dateNaissance: "",
                                    lieuNaissance: "",
                                    nationalite: "",
                                    profession: "",
                                    telephone: "",
                                    email: "",
                                    typeIdentite: "",
                                    numeroIdentite: "",
                                    situationMatrimoniale: "",
                                    regimeMatrimonial: "",
                                    dateMariage: "",
                                  };
                                  setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                                }
                              }}
                              label="Sélectionner un client (optionnel)"
                              placeholder="Choisir un client"
                            />
                          </div>

                          {/* Informations civiles */}
                          <div className="space-y-2">
                            <Label>Nom <span className="text-red-500">*</span></Label>
                            <Input
                              value={epoux.nom}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].nom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom <span className="text-red-500">*</span></Label>
                            <Input
                              value={epoux.prenom}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].prenom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nom de naissance</Label>
                            <Input
                              value={epoux.nomNaissance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].nomNaissance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance <span className="text-red-500">*</span></Label>
                            <Input
                              type="date"
                              value={epoux.dateNaissance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].dateNaissance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={epoux.lieuNaissance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].lieuNaissance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={epoux.nationalite}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].nationalite = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={epoux.profession}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].profession = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète <span className="text-red-500">*</span></Label>
                            <Input
                              value={epoux.adresseComplete}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].adresseComplete = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input
                              value={epoux.telephone}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].telephone = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input
                              type="email"
                              value={epoux.email}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].email = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          {/* Régime matrimonial */}
                          <div className="space-y-2">
                            <Label>Régime matrimonial <span className="text-red-500">*</span></Label>
                            <Select 
                              value={epoux.regimeMatrimonial}
                              onValueChange={(value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].regimeMatrimonial = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                                <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                                <SelectItem value="autre">Autre (préciser)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {epoux.regimeMatrimonial === "autre" && (
                            <div className="space-y-2">
                              <Label>Préciser le régime</Label>
                              <Input
                                value={epoux.regimeMatrimonialAutre}
                                onChange={(e) => {
                                  const newEpoux = [...donationEntreEpouxData.epoux];
                                  newEpoux[index].regimeMatrimonialAutre = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                                }}
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Date du mariage <span className="text-red-500">*</span></Label>
                            <Input
                              type="date"
                              value={epoux.dateMariage}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].dateMariage = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu du mariage</Label>
                            <Input
                              value={epoux.lieuMariage}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].lieuMariage = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Existence d'un contrat de mariage</Label>
                            <Select 
                              value={epoux.existenceContratMariage}
                              onValueChange={(value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].existenceContratMariage = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui (joindre copie)</SelectItem>
                                <SelectItem value="non">Non</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Pièce d'identité */}
                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Select 
                              value={epoux.typeIdentite}
                              onValueChange={(value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].typeIdentite = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="CNI">Carte Nationale d'Identité</SelectItem>
                                <SelectItem value="Passeport">Passeport</SelectItem>
                                <SelectItem value="Titre de séjour">Titre de séjour</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro d'identité</Label>
                            <Input
                              value={epoux.numeroIdentite}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].numeroIdentite = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Autorité de délivrance</Label>
                            <Input
                              value={epoux.autoriteDelivrance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].autoriteDelivrance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'expiration</Label>
                            <Input
                              type="date"
                              value={epoux.dateExpiration}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].dateExpiration = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 3. Enfants et héritiers potentiels */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Enfants et héritiers potentiels</h3>
                    
                    <div className="bg-blue-50 border border-gray-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        ℹ️ Ces informations sont obligatoires pour déterminer les limites juridiques de la donation (réserve héréditaire)
                      </p>
                    </div>

                    {/* A. Enfants communs */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">A. Enfants communs</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.enfantsCommuns.map(e => e.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              enfantsCommuns: [...donationEntreEpouxData.enfantsCommuns, { id: newId, nom: "", prenom: "", dateNaissance: "" }]
                            });
                          }}
                        >
                          + Ajouter enfant commun
                        </Button>
                      </div>

                      {donationEntreEpouxData.enfantsCommuns.map((enfant, index) => (
                        <div key={enfant.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <Input
                              placeholder="Nom"
                              value={enfant.nom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsCommuns];
                                newEnfants[index].nom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsCommuns: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Prénom"
                              value={enfant.prenom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsCommuns];
                                newEnfants[index].prenom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsCommuns: newEnfants});
                              }}
                            />
                            <div className="flex gap-2">
                              <Input
                                type="date"
                                placeholder="Date de naissance"
                                value={enfant.dateNaissance}
                                onChange={(e) => {
                                  const newEnfants = [...donationEntreEpouxData.enfantsCommuns];
                                  newEnfants[index].dateNaissance = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, enfantsCommuns: newEnfants});
                                }}
                              />
                              {donationEntreEpouxData.enfantsCommuns.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      enfantsCommuns: donationEntreEpouxData.enfantsCommuns.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* B. Enfants non communs */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">B. Enfants non communs (importante limitation de quotité disponible)</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.enfantsNonCommuns.map(e => e.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              enfantsNonCommuns: [...donationEntreEpouxData.enfantsNonCommuns, { id: newId, epoux: "1", nom: "", prenom: "", dateNaissance: "" }]
                            });
                          }}
                        >
                          + Ajouter enfant non commun
                        </Button>
                      </div>

                      {donationEntreEpouxData.enfantsNonCommuns.map((enfant, index) => (
                        <div key={enfant.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Select
                              value={enfant.epoux}
                              onValueChange={(value) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                newEnfants[index].epoux = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Époux..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="1">Époux 1</SelectItem>
                                <SelectItem value="2">Époux 2</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Nom"
                              value={enfant.nom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                newEnfants[index].nom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Prénom"
                              value={enfant.prenom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                newEnfants[index].prenom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                              }}
                            />
                            <div className="flex gap-2">
                              <Input
                                type="date"
                                placeholder="Date de naissance"
                                value={enfant.dateNaissance}
                                onChange={(e) => {
                                  const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                  newEnfants[index].dateNaissance = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                                }}
                              />
                              {donationEntreEpouxData.enfantsNonCommuns.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      enfantsNonCommuns: donationEntreEpouxData.enfantsNonCommuns.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* C. Parents vivants */}
                    <div className="space-y-3">
                      <Label className="font-medium">C. Présence d'autres héritiers réservataires</Label>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Parents du défunt (époux 1) vivants ?</Label>
                          <Select 
                            value={donationEntreEpouxData.parentsVivants.epoux1}
                            onValueChange={(value) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              parentsVivants: {...donationEntreEpouxData.parentsVivants, epoux1: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Parents du défunt (époux 2) vivants ?</Label>
                          <Select 
                            value={donationEntreEpouxData.parentsVivants.epoux2}
                            onValueChange={(value) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              parentsVivants: {...donationEntreEpouxData.parentsVivants, epoux2: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                    </div>

                    {/* D. Autres héritiers */}
                    <div className="space-y-2">
                      <Label>D. Autres héritiers (frères/sœurs, etc.)</Label>
                      <textarea
                        className="w-full min-h-[80px] p-2 border rounded-md"
                        value={donationEntreEpouxData.autresHeritiers}
                        onChange={(e) => setDonationEntreEpouxData({...donationEntreEpouxData, autresHeritiers: e.target.value})}
                        placeholder="Préciser les autres héritiers potentiels..."
                      />
                    </div>
                  </div>

                  {/* 4. Patrimoine des époux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Patrimoine des époux</h3>
                    
                    <div className="bg-blue-50 border border-gray-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        ℹ️ Indispensable pour savoir ce qui peut être donné selon le régime matrimonial
                      </p>
                    </div>

                    {/* A. Biens propres époux 1 */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">A. Biens propres Époux 1</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.biensPropresEpoux1.map(b => b.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              biensPropresEpoux1: [...donationEntreEpouxData.biensPropresEpoux1, { id: newId, type: "", description: "", valeur: "", origine: "" }]
                            });
                          }}
                        >
                          + Ajouter bien
                        </Button>
                      </div>

                      {donationEntreEpouxData.biensPropresEpoux1.map((bien, index) => (
                        <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Select
                              value={bien.type}
                              onValueChange={(value) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                newBiens[index].type = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Type..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="immobilier">Immobilier</SelectItem>
                                <SelectItem value="meuble">Meuble</SelectItem>
                                <SelectItem value="financier">Financier</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Description"
                              value={bien.description}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                newBiens[index].description = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                              }}
                            />
                            <Input
                              placeholder="Valeur (€)"
                              value={bien.valeur}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                newBiens[index].valeur = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                              }}
                            />
                            <div className="flex gap-2">
                              <Select
                                value={bien.origine}
                                onValueChange={(value) => {
                                  const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                  newBiens[index].origine = value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Origine..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="heritage">Héritage</SelectItem>
                                  <SelectItem value="donation">Donation</SelectItem>
                                  <SelectItem value="achat">Achat</SelectItem>
                                </SelectContent>
                              </Select>
                              {donationEntreEpouxData.biensPropresEpoux1.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      biensPropresEpoux1: donationEntreEpouxData.biensPropresEpoux1.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* B. Biens propres époux 2 */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">B. Biens propres Époux 2</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.biensPropresEpoux2.map(b => b.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              biensPropresEpoux2: [...donationEntreEpouxData.biensPropresEpoux2, { id: newId, type: "", description: "", valeur: "", origine: "" }]
                            });
                          }}
                        >
                          + Ajouter bien
                        </Button>
                      </div>

                      {donationEntreEpouxData.biensPropresEpoux2.map((bien, index) => (
                        <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Select
                              value={bien.type}
                              onValueChange={(value) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                newBiens[index].type = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Type..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="immobilier">Immobilier</SelectItem>
                                <SelectItem value="meuble">Meuble</SelectItem>
                                <SelectItem value="financier">Financier</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Description"
                              value={bien.description}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                newBiens[index].description = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                              }}
                            />
                            <Input
                              placeholder="Valeur (€)"
                              value={bien.valeur}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                newBiens[index].valeur = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                              }}
                            />
                            <div className="flex gap-2">
                              <Select
                                value={bien.origine}
                                onValueChange={(value) => {
                                  const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                  newBiens[index].origine = value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Origine..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="heritage">Héritage</SelectItem>
                                  <SelectItem value="donation">Donation</SelectItem>
                                  <SelectItem value="achat">Achat</SelectItem>
                                </SelectContent>
                              </Select>
                              {donationEntreEpouxData.biensPropresEpoux2.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      biensPropresEpoux2: donationEntreEpouxData.biensPropresEpoux2.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* C. Biens communs */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">C. Biens communs (si régime communautaire)</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.biensCommuns.map(b => b.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              biensCommuns: [...donationEntreEpouxData.biensCommuns, { id: newId, description: "", valeur: "", partEpoux1: "50", partEpoux2: "50" }]
                            });
                          }}
                        >
                          + Ajouter bien commun
                        </Button>
                      </div>

                      {donationEntreEpouxData.biensCommuns.map((bien, index) => (
                        <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Input
                              placeholder="Description"
                              className="md:col-span-2"
                              value={bien.description}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensCommuns];
                                newBiens[index].description = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                              }}
                            />
                            <Input
                              placeholder="Valeur (€)"
                              value={bien.valeur}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensCommuns];
                                newBiens[index].valeur = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                              }}
                            />
                            <div className="flex gap-2 items-center">
                              <Input
                                placeholder="Part E1 %"
                                value={bien.partEpoux1}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.biensCommuns];
                                  newBiens[index].partEpoux1 = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                                }}
                              />
                              <span className="text-sm">/</span>
                              <Input
                                placeholder="Part E2 %"
                                value={bien.partEpoux2}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.biensCommuns];
                                  newBiens[index].partEpoux2 = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                                }}
                              />
                              {donationEntreEpouxData.biensCommuns.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      biensCommuns: donationEntreEpouxData.biensCommuns.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* D. Droits particuliers */}
                    <div className="space-y-3">
                      <Label className="font-medium">D. Droits éventuels sur des biens</Label>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nue-propriété / usufruit</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.nueProprieteBiens}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, nueProprieteBiens: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Usufruit sur biens</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.usufruitBiens}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, usufruitBiens: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Biens indivis</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.biensIndivis}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, biensIndivis: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Biens grevés d'hypothèques</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.biensHypotheques}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, biensHypotheques: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 5. Clauses de donation - Donation au dernier vivant */}
                  {(donationEntreEpouxData.typeDonation === "au_dernier_vivant" || donationEntreEpouxData.typeDonation === "mixte") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Clauses de donation au dernier vivant</h3>
                      
                      {/* Options successorales */}
                      <div className="space-y-3">
                        <Label className="font-medium">Options successorales offertes au conjoint survivant</Label>
                        <div className="grid grid-cols-1 gap-2">
                          {[
                            { value: "pleine_propriete_quotite", label: "Pleine propriété de la quotité disponible" },
                            { value: "usufruit_universel", label: "Usufruit universel de la succession" },
                            { value: "quart_pleine_3quarts_usufruit", label: "1/4 en pleine propriété + 3/4 en usufruit" },
                            { value: "choix_multiple", label: "Choix entre plusieurs options au décès" },
                            { value: "attribution_biens_specifiques", label: "Attribution de biens spécifiques" }
                          ].map(opt => (
                            <div key={opt.value} className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`opt_${opt.value}`}
                                checked={donationEntreEpouxData.donationDernierVivant.optionsSuccessorales.includes(opt.value)}
                                onChange={(e) => {
                                  const current = donationEntreEpouxData.donationDernierVivant.optionsSuccessorales;
                                  const newOpts = e.target.checked 
                                    ? [...current, opt.value]
                                    : current.filter(o => o !== opt.value);
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationDernierVivant: {...donationEntreEpouxData.donationDernierVivant, optionsSuccessorales: newOpts}
                                  });
                                }}
                              />
                              <label htmlFor={`opt_${opt.value}`} className="text-sm cursor-pointer">{opt.label}</label>
                            </div>
                          ))}
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.optionsSuccessorales.includes("attribution_biens_specifiques") && (
                          <div className="space-y-2 mt-3">
                            <Label>Préciser les biens spécifiques</Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={donationEntreEpouxData.donationDernierVivant.biensSpecifiques}
                              onChange={(e) => setDonationEntreEpouxData({
                                ...donationEntreEpouxData,
                                donationDernierVivant: {...donationEntreEpouxData.donationDernierVivant, biensSpecifiques: e.target.value}
                              })}
                              placeholder="Ex: logement familial situé à..."
                            />
                          </div>
                        )}
                      </div>

                      {/* Clause d'attribution préférentielle */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="attr_pref_active"
                            checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationDernierVivant: {
                                ...donationEntreEpouxData.donationDernierVivant,
                                attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="attr_pref_active" className="font-medium cursor-pointer">Clause d'attribution préférentielle</Label>
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.active && (
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3 ml-6">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_logement"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.logementFamilial}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, logementFamilial: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_logement" className="text-sm cursor-pointer">Logement familial</label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_mobilier"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.mobilier}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, mobilier: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_mobilier" className="text-sm cursor-pointer">Mobilier</label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_professionnel"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.bienProfessionnel}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, bienProfessionnel: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_professionnel" className="text-sm cursor-pointer">Bien professionnel</label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_vehicule"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.vehicule}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, vehicule: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_vehicule" className="text-sm cursor-pointer">Véhicule</label>
                            </div>
                            <div className="space-y-2 md:col-span-2">
                              <Label>Autres biens</Label>
                              <Input
                                placeholder="Préciser..."
                                value={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.autresBiens}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, autresBiens: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Clause de préciput */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="preciput_active"
                            checked={donationEntreEpouxData.donationDernierVivant.clausePreciput.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationDernierVivant: {
                                ...donationEntreEpouxData.donationDernierVivant,
                                clausePreciput: {...donationEntreEpouxData.donationDernierVivant.clausePreciput, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="preciput_active" className="font-medium cursor-pointer">Clause de préciput (prendre un bien avant tout partage)</Label>
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.clausePreciput.active && (
                          <div className="space-y-3 ml-6">
                            <div className="space-y-2">
                              <Label>Description du bien</Label>
                              <textarea
                                className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                                value={donationEntreEpouxData.donationDernierVivant.clausePreciput.descriptionBien}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clausePreciput: {...donationEntreEpouxData.donationDernierVivant.clausePreciput, descriptionBien: e.target.value}
                                  }
                                })}
                                placeholder="Décrire le bien concerné..."
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Effet</Label>
                              <Select
                                value={donationEntreEpouxData.donationDernierVivant.clausePreciput.effet}
                                onValueChange={(value) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clausePreciput: {...donationEntreEpouxData.donationDernierVivant.clausePreciput, effet: value}
                                  }
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="hors_part">Hors part successorale</SelectItem>
                                  <SelectItem value="valorise_part">Valorisé dans la part</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Clause de cantonnement */}
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="cantonnement"
                          checked={donationEntreEpouxData.donationDernierVivant.clauseCantonnement}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            donationDernierVivant: {...donationEntreEpouxData.donationDernierVivant, clauseCantonnement: e.target.checked}
                          })}
                        />
                        <label htmlFor="cantonnement" className="text-sm cursor-pointer">
                          Clause de cantonnement (permet au survivant de renoncer à une partie pour optimiser la fiscalité)
                        </label>
                      </div>

                      {/* Clause d'exclusion */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="exclusion_active"
                            checked={donationEntreEpouxData.donationDernierVivant.clauseExclusion.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationDernierVivant: {
                                ...donationEntreEpouxData.donationDernierVivant,
                                clauseExclusion: {...donationEntreEpouxData.donationDernierVivant.clauseExclusion, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="exclusion_active" className="font-medium cursor-pointer">Clause d'exclusion / exception</Label>
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.clauseExclusion.active && (
                          <div className="space-y-3 ml-6">
                            <div className="space-y-2">
                              <Label>Biens exclus du champ de la donation</Label>
                              <textarea
                                className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                                value={donationEntreEpouxData.donationDernierVivant.clauseExclusion.biensExclus}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clauseExclusion: {...donationEntreEpouxData.donationDernierVivant.clauseExclusion, biensExclus: e.target.value}
                                  }
                                })}
                                placeholder="Liste des biens exclus..."
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Cas particuliers (biens professionnels, héritages...)</Label>
                              <textarea
                                className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                                value={donationEntreEpouxData.donationDernierVivant.clauseExclusion.casParticuliers}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clauseExclusion: {...donationEntreEpouxData.donationDernierVivant.clauseExclusion, casParticuliers: e.target.value}
                                  }
                                })}
                                placeholder="Précisions..."
                              />
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 6. Clauses de donation - Donation de biens présents */}
                  {(donationEntreEpouxData.typeDonation === "biens_presents" || donationEntreEpouxData.typeDonation === "mixte") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Clauses de donation de biens présents</h3>
                      
                      <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                        <p className="text-sm text-orange-800">
                          ⚠️ Prend effet immédiatement - Plus rare et très encadrée juridiquement
                        </p>
                      </div>

                      {/* Biens donnés */}
                      <div className="space-y-3">
                        <div className="flex items-center justify-between">
                          <Label className="font-medium">Biens donnés immédiatement</Label>
                          <Button
                            type="button"
                            size="sm"
                            variant="outline"
                            onClick={() => {
                              const newId = Math.max(...donationEntreEpouxData.donationBiensPresents.biensDonnes.map(b => b.id), 0) + 1;
                              setDonationEntreEpouxData({
                                ...donationEntreEpouxData,
                                donationBiensPresents: {
                                  ...donationEntreEpouxData.donationBiensPresents,
                                  biensDonnes: [...donationEntreEpouxData.donationBiensPresents.biensDonnes, { id: newId, nature: "", description: "", valeur: "", regimePropriete: "" }]
                                }
                              });
                            }}
                          >
                            + Ajouter bien
                          </Button>
                        </div>

                        {donationEntreEpouxData.donationBiensPresents.biensDonnes.map((bien, index) => (
                          <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                              <Select
                                value={bien.nature}
                                onValueChange={(value) => {
                                  const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                  newBiens[index].nature = value;
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                  });
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Nature..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="immobilier">Immobilier</SelectItem>
                                  <SelectItem value="financier">Financier</SelectItem>
                                  <SelectItem value="meuble">Meuble</SelectItem>
                                  <SelectItem value="entreprise">Entreprise</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                              <Input
                                placeholder="Description complète"
                                value={bien.description}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                  newBiens[index].description = e.target.value;
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                  });
                                }}
                              />
                              <Input
                                placeholder="Valeur (€)"
                                value={bien.valeur}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                  newBiens[index].valeur = e.target.value;
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                  });
                                }}
                              />
                              <div className="flex gap-2">
                                <Select
                                  value={bien.regimePropriete}
                                  onValueChange={(value) => {
                                    const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                    newBiens[index].regimePropriete = value;
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                    });
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Régime..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="propre">Propre</SelectItem>
                                    <SelectItem value="commun">Commun</SelectItem>
                                    <SelectItem value="indivis">Indivis</SelectItem>
                                  </SelectContent>
                                </Select>
                                {donationEntreEpouxData.donationBiensPresents.biensDonnes.length > 1 && (
                                  <Button
                                    type="button"
                                    size="sm"
                                    variant="destructive"
                                    onClick={() => {
                                      setDonationEntreEpouxData({
                                        ...donationEntreEpouxData,
                                        donationBiensPresents: {
                                          ...donationEntreEpouxData.donationBiensPresents,
                                          biensDonnes: donationEntreEpouxData.donationBiensPresents.biensDonnes.filter((_, i) => i !== index)
                                        }
                                      });
                                    }}
                                  >
                                    ✕
                                  </Button>
                                )}
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>

                      {/* Irrévocabilité */}
                      <div className="space-y-2">
                        <Label>Déclaration d'irrévocabilité</Label>
                        <Select
                          value={donationEntreEpouxData.donationBiensPresents.irrevocabilite}
                          onValueChange={(value) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, irrevocabilite: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (donation irrévocable)</SelectItem>
                            <SelectItem value="non">Non (sauf clauses spécifiques)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Clause de retour */}
                      <div className="space-y-2">
                        <Label>Clause de retour en cas de prédécès</Label>
                        <Select
                          value={donationEntreEpouxData.donationBiensPresents.clauseRetourPredeces}
                          onValueChange={(value) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, clauseRetourPredeces: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (retour automatique)</SelectItem>
                            <SelectItem value="non">Non (pas de retour)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Réserve d'usufruit */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="usufruit_active"
                            checked={donationEntreEpouxData.donationBiensPresents.reserveUsufruit.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationBiensPresents: {
                                ...donationEntreEpouxData.donationBiensPresents,
                                reserveUsufruit: {...donationEntreEpouxData.donationBiensPresents.reserveUsufruit, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="usufruit_active" className="font-medium cursor-pointer">Réserve d'usufruit</Label>
                        </div>
                        {donationEntreEpouxData.donationBiensPresents.reserveUsufruit.active && (
                          <div className="space-y-2 ml-6">
                            <Label>Conditions</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationEntreEpouxData.donationBiensPresents.reserveUsufruit.conditions}
                              onChange={(e) => setDonationEntreEpouxData({
                                ...donationEntreEpouxData,
                                donationBiensPresents: {
                                  ...donationEntreEpouxData.donationBiensPresents,
                                  reserveUsufruit: {...donationEntreEpouxData.donationBiensPresents.reserveUsufruit, conditions: e.target.value}
                                }
                              })}
                              placeholder="Préciser les conditions de l'usufruit réservé..."
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 7. Clauses communes aux deux types de donation */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses communes</h3>
                    
                    <div className="space-y-3">
                      <div className="space-y-2">
                        <Label>Administration et gestion</Label>
                        <textarea
                          className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                          value={donationEntreEpouxData.clausesCommunes.administrationGestion}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, administrationGestion: e.target.value}
                          })}
                          placeholder="Qui gère les biens ? Usufruit, nue-propriété, pleine propriété..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Condition suspensive ou résolutoire (très rare mais nécessaire dans certains cas)</Label>
                        <textarea
                          className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                          value={donationEntreEpouxData.clausesCommunes.conditionSuspensiveResolutoire}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, conditionSuspensiveResolutoire: e.target.value}
                          })}
                          placeholder="Préciser la condition..."
                        />
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptation_beneficiaire"
                          checked={donationEntreEpouxData.clausesCommunes.acceptationBeneficiaire}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, acceptationBeneficiaire: e.target.checked}
                          })}
                        />
                        <label htmlFor="acceptation_beneficiaire" className="text-sm cursor-pointer">
                          Acceptation claire et non équivoque de l'époux bénéficiaire <span className="text-red-500">*</span> (obligatoire pour la validité)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="renonciation_droits"
                          checked={donationEntreEpouxData.clausesCommunes.renonciationDroitsSuccessorauxStandards}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, renonciationDroitsSuccessorauxStandards: e.target.checked}
                          })}
                        />
                        <label htmlFor="renonciation_droits" className="text-sm cursor-pointer">
                          Renonciation aux droits successoraux standards
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="non_revocation"
                          checked={donationEntreEpouxData.clausesCommunes.clauseNonRevocation}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, clauseNonRevocation: e.target.checked}
                          })}
                        />
                        <label htmlFor="non_revocation" className="text-sm cursor-pointer">
                          Clause de non-révocation (selon type de donation)
                        </label>
                      </div>

                      {/* Révocabilité - Section complète obligatoire */}
                      <div className="space-y-3 pt-3 mt-3 border-t-2 border-gray-200 bg-blue-50/30 p-4 rounded-lg">
                        <h4 className="font-medium text-base text-blue-900">🔄 Régime de révocabilité de la donation</h4>
                        <p className="text-xs text-gray-700">
                          La donation entre époux est toujours révocable par défaut, sauf clause contraire explicite.
                        </p>
                        
                        <div className="space-y-2">
                          <Label>Révocabilité <span className="text-red-500">*</span></Label>
                          <Select
                            value={donationEntreEpouxData.clausesCommunes.revocabilite}
                            onValueChange={(value) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              clausesCommunes: {...donationEntreEpouxData.clausesCommunes, revocabilite: value}
                            })}
                          >
                            <SelectTrigger className="w-full">
                              <SelectValue placeholder="Sélectionner" />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="revocable">Donation révocable (règle légale par défaut)</SelectItem>
                              <SelectItem value="irrevocable">Donation irrévocable (exceptionnelle – nécessite accord explicite)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {donationEntreEpouxData.clausesCommunes.revocabilite === "revocable" && (
                          <div className="space-y-2 bg-white p-3 rounded border">
                            <Label className="text-sm font-medium">Motifs de révocation possibles</Label>
                            <div className="space-y-2">
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_survenance"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("survenance_enfants")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "survenance_enfants"]
                                      : current.filter(m => m !== "survenance_enfants");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_survenance" className="text-sm cursor-pointer">
                                  Survenance d'enfants
                                </label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_ingratitude"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("ingratitude")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "ingratitude"]
                                      : current.filter(m => m !== "ingratitude");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_ingratitude" className="text-sm cursor-pointer">
                                  Ingratitude
                                </label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_non_execution"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("non_execution")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "non_execution"]
                                      : current.filter(m => m !== "non_execution");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_non_execution" className="text-sm cursor-pointer">
                                  Non-exécution des obligations
                                </label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_revocation_libre"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("revocation_libre")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "revocation_libre"]
                                      : current.filter(m => m !== "revocation_libre");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_revocation_libre" className="text-sm cursor-pointer">
                                  Révocation libre (selon option)
                                </label>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Signature par mandataire */}
                      <div className="space-y-3 pt-3 mt-3 border-t-2 border-purple-200 bg-purple-50/30 p-4 rounded-lg">
                        <h4 className="font-medium text-base text-purple-900">👤 Signature par mandataire</h4>
                        <p className="text-xs text-purple-700">
                          Si l'un des époux ne peut pas signer physiquement (hospitalisation, impossibilité de déplacement).
                        </p>
                        
                        <Label>Signature par mandataire ?</Label>
                        <Select
                          value={donationEntreEpouxData.clausesCommunes.signatureMandataire}
                          onValueChange={(value) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, signatureMandataire: value}
                          })}
                        >
                          <SelectTrigger className="w-full">
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui (hospitalisation, impossibilité)</SelectItem>
                          </SelectContent>
                        </Select>

                        {donationEntreEpouxData.clausesCommunes.signatureMandataire === "oui" && (
                          <div className="space-y-4 bg-muted/30 p-4 rounded-lg">
                            <div className="space-y-3">
                              <h4 className="font-medium text-sm">Mandataire pour Époux 1</h4>
                              <div className="grid grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label className="text-xs">Nom du mandataire</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux1.nom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux1: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux1, nom: e.target.value}
                                      }
                                    })}
                                    placeholder="Nom"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label className="text-xs">Prénom</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux1.prenom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux1: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux1, prenom: e.target.value}
                                      }
                                    })}
                                    placeholder="Prénom"
                                  />
                                </div>
                              </div>
                              <div className="space-y-2">
                                <Label className="text-xs">Type de procuration <span className="text-red-500">*</span></Label>
                                <Select
                                  value={donationEntreEpouxData.clausesCommunes.mandataireEpoux1.typeProcuration}
                                  onValueChange={(value) => setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    clausesCommunes: {
                                      ...donationEntreEpouxData.clausesCommunes,
                                      mandataireEpoux1: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux1, typeProcuration: value}
                                    }
                                  })}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="sous_seing_prive">Procuration sous seing privé</SelectItem>
                                    <SelectItem value="acte_notarie">Acte notarié</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>

                            <div className="space-y-3">
                              <h4 className="font-medium text-sm">Mandataire pour Époux 2</h4>
                              <div className="grid grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label className="text-xs">Nom du mandataire</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux2.nom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux2: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux2, nom: e.target.value}
                                      }
                                    })}
                                    placeholder="Nom"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label className="text-xs">Prénom</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux2.prenom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux2: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux2, prenom: e.target.value}
                                      }
                                    })}
                                    placeholder="Prénom"
                                  />
                                </div>
                              </div>
                              <div className="space-y-2">
                                <Label className="text-xs">Type de procuration <span className="text-red-500">*</span></Label>
                                <Select
                                  value={donationEntreEpouxData.clausesCommunes.mandataireEpoux2.typeProcuration}
                                  onValueChange={(value) => setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    clausesCommunes: {
                                      ...donationEntreEpouxData.clausesCommunes,
                                      mandataireEpoux2: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux2, typeProcuration: value}
                                    }
                                  })}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="sous_seing_prive">Procuration sous seing privé</SelectItem>
                                    <SelectItem value="acte_notarie">Acte notarié</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Information sur les effets successoraux (OBLIGATOIRE) */}
                      <div className="p-4 bg-amber-50 border-2 border-amber-300 rounded-lg space-y-3 mt-4">
                        <h4 className="font-medium text-sm text-amber-900">⚖️ Information sur les effets successoraux</h4>
                        <p className="text-xs text-amber-800">
                          Les époux doivent être informés des limites légales de la donation, notamment en présence d'enfants non communs, 
                          de la réserve héréditaire, et des cas de réduction possibles.
                        </p>
                        <div className="flex items-start space-x-2">
                          <input
                            type="checkbox"
                            id="information_effets"
                            checked={donationEntreEpouxData.clausesCommunes.informationEffetsSuccessoraux}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              clausesCommunes: {...donationEntreEpouxData.clausesCommunes, informationEffetsSuccessoraux: e.target.checked}
                            })}
                            className="mt-1"
                          />
                          <label htmlFor="information_effets" className="text-sm cursor-pointer">
                            <span className="text-red-500 font-bold">*</span> Les époux reconnaissent avoir été pleinement informés des effets successoraux 
                            de cette donation, des limites légales, de la réserve des enfants non communs, et de l'impact sur la succession 
                            <span className="block mt-1 text-xs text-amber-700 font-medium">(Déclaration obligatoire)</span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 8. Documents à joindre / à collecter */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Documents à joindre / à collecter</h3>
                    
                    <div className="bg-blue-50 border border-gray-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        📌 <strong>Documents obligatoires :</strong> pièces d'identité, livret de famille, acte de mariage, contrat de mariage (si existant), justificatifs de domicile
                      </p>
                    </div>

                    {/* Documents Époux 1 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Époux 1</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité E1 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e1_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Livret famille E1 */}
                        <div className="space-y-2">
                          <Label>Livret de famille <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e1_livret"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1LivretFamilleFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_livret" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1LivretFamilleFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1LivretFamilleFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1LivretFamilleFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte mariage E1 */}
                        <div className="space-y-2">
                          <Label>Acte de mariage <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_e1_mariage"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1ActeMariageFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_mariage" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1ActeMariageFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1ActeMariageFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1ActeMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Contrat mariage E1 */}
                        {donationEntreEpouxData.epoux[0].existenceContratMariage === "oui" && (
                          <div className="space-y-2">
                            <Label>Contrat de mariage</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="donation_e1_contrat"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setDonationEpoux1ContratMariageFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="donation_e1_contrat" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {donationEpoux1ContratMariageFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {donationEpoux1ContratMariageFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setDonationEpoux1ContratMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* Justificatif domicile E1 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e1_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents Époux 2 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Époux 2</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité E2 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e2_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Livret famille E2 */}
                        <div className="space-y-2">
                          <Label>Livret de famille <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e2_livret"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2LivretFamilleFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_livret" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2LivretFamilleFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2LivretFamilleFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2LivretFamilleFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte mariage E2 */}
                        <div className="space-y-2">
                          <Label>Acte de mariage <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_e2_mariage"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2ActeMariageFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_mariage" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2ActeMariageFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2ActeMariageFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2ActeMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Contrat mariage E2 */}
                        {donationEntreEpouxData.epoux[1].existenceContratMariage === "oui" && (
                          <div className="space-y-2">
                            <Label>Contrat de mariage</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="donation_e2_contrat"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setDonationEpoux2ContratMariageFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="donation_e2_contrat" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {donationEpoux2ContratMariageFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {donationEpoux2ContratMariageFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setDonationEpoux2ContratMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* Justificatif domicile E2 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e2_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents pour biens immobiliers / financiers */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents pour les biens</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Titres propriété */}
                        <div className="space-y-2">
                          <Label>Titres de propriété (biens immobiliers)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_titres"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationTitresProprieteBiensFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_titres" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationTitresProprieteBiensFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationTitresProprieteBiensFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationTitresProprieteBiensFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Estimations */}
                        <div className="space-y-2">
                          <Label>Estimations / évaluations</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_estimation"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEstimationBiensFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_estimation" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEstimationBiensFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEstimationBiensFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEstimationBiensFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Hypothèques */}
                        <div className="space-y-2">
                          <Label>Hypothèques</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_hypotheques"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationHypothequesFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_hypotheques" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationHypothequesFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationHypothequesFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationHypothequesFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Situation locative */}
                        <div className="space-y-2">
                          <Label>Situation locative</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_locative"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSituationLocativeFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_locative" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSituationLocativeFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSituationLocativeFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSituationLocativeFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* RIB */}
                        <div className="space-y-2">
                          <Label>RIB (si donation financière)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_rib"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationRIBFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_rib" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationRIBFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationRIBFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationRIBFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Carte grise */}
                        <div className="space-y-2">
                          <Label>Carte grise véhicule</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_carte_grise"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationCarteGriseFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_carte_grise" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationCarteGriseFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationCarteGriseFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationCarteGriseFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Autres documents */}
                        <div className="space-y-2">
                          <Label>Autres documents</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_autres"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationAutresDocumentsFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_autres" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationAutresDocumentsFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationAutresDocumentsFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationAutresDocumentsFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents procuration (si mandataire) */}
                    {donationEntreEpouxData.clausesCommunes.signatureMandataire === "oui" && (
                      <div className="p-4 border-2 border-amber-300 bg-amber-50 rounded-lg space-y-4">
                        <h4 className="font-medium text-base text-amber-900">📄 Procurations</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Procuration Époux 1 */}
                          {donationEntreEpouxData.clausesCommunes.mandataireEpoux1.nom && (
                            <div className="space-y-2">
                              <Label>Procuration Époux 1 <span className="text-red-500">*</span></Label>
                              <div className="border-2 border-dashed border-amber-400 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="donation_procuration_e1"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setDonationEpoux1IdentiteFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="donation_procuration_e1" className="cursor-pointer text-sm text-amber-800">
                                  Cliquez pour joindre la procuration
                                </label>
                              </div>
                            </div>
                          )}
                          {/* Procuration Époux 2 */}
                          {donationEntreEpouxData.clausesCommunes.mandataireEpoux2.nom && (
                            <div className="space-y-2">
                              <Label>Procuration Époux 2 <span className="text-red-500">*</span></Label>
                              <div className="border-2 border-dashed border-amber-400 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="donation_procuration_e2"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setDonationEpoux2IdentiteFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="donation_procuration_e2" className="cursor-pointer text-sm text-amber-800">
                                  Cliquez pour joindre la procuration
                                </label>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    )}
                  </div>

                </div>
              </>
            )}

            {/* Formulaire Donation Simple */}
            {pendingContractType === "Donation simple (parent → enfant, etc.)" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* 1. Type de donation */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Type de donation</h3>
                    
                    <div className="space-y-3">
                      <Label>Type de donation <span className="text-red-500">*</span></Label>
                      <Select
                        value={donationSimpleData.typeDonation}
                        onValueChange={(value) => setDonationSimpleData({...donationSimpleData, typeDonation: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="biens_meubles">Donation simple de biens meubles</SelectItem>
                          <SelectItem value="biens_immobiliers">Donation simple de biens immobiliers</SelectItem>
                          <SelectItem value="sommes_argent">Donation de sommes d'argent</SelectItem>
                          <SelectItem value="nue_propriete">Donation de nue-propriété</SelectItem>
                          <SelectItem value="usufruit">Donation d'usufruit temporaire / viager</SelectItem>
                          <SelectItem value="parts_sociales">Donation de parts sociales / actions</SelectItem>
                          <SelectItem value="manuelle">Donation manuelle (argent, bijoux, voiture, mobilier…)</SelectItem>
                          <SelectItem value="mixte">Donation mixte (plusieurs biens)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_avec_charges"
                          checked={donationSimpleData.donationAvecCharges}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationAvecCharges: e.target.checked})}
                        />
                        <label htmlFor="donation_avec_charges" className="text-sm cursor-pointer">
                          Donation avec charges
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_reserve_usufruit"
                          checked={donationSimpleData.donationAvecReserveUsufruit}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationAvecReserveUsufruit: e.target.checked})}
                        />
                        <label htmlFor="donation_reserve_usufruit" className="text-sm cursor-pointer">
                          Donation avec réserve d'usufruit
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_droit_retour"
                          checked={donationSimpleData.donationAvecDroitRetour}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationAvecDroitRetour: e.target.checked})}
                        />
                        <label htmlFor="donation_droit_retour" className="text-sm cursor-pointer">
                          Donation avec droit de retour conventionnel
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_effet_immediat"
                          checked={donationSimpleData.donationEffetImmediat}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationEffetImmediat: e.target.checked})}
                          disabled
                        />
                        <label htmlFor="donation_effet_immediat" className="text-sm cursor-pointer text-muted-foreground">
                          Donation à effet immédiat (toujours le cas)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_presente_irrevocable"
                          checked={donationSimpleData.donationPresenteIrrevocable}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationPresenteIrrevocable: e.target.checked})}
                          disabled
                        />
                        <label htmlFor="donation_presente_irrevocable" className="text-sm cursor-pointer text-muted-foreground">
                          Donation présente et irrévocable (principe légal)
                        </label>
                      </div>
                    </div>

                    {donationSimpleData.donationAvecCharges && (
                      <div className="space-y-2">
                        <Label>Description des charges</Label>
                        <textarea
                          className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                          value={donationSimpleData.descriptionCharges}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, descriptionCharges: e.target.value})}
                          placeholder="Somme à payer, obligation, entretien..."
                        />
                      </div>
                    )}
                  </div>

                  {/* 2. Identité du donateur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du donateur</h3>
                    
                    <ClientSelector
                      clients={clients}
                      selectedClientId={donationSimpleData.donateur.clientId || ""}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            // Extraire situation familiale
                            let situationFam = "";
                            // D'abord vérifier si c'est directement une string dans situation_familiale
                            if (typeof client.situation_familiale === "string") {
                              situationFam = client.situation_familiale;
                            }
                            // Sinon vérifier situation_matrimoniale
                            else if (typeof client.situation_matrimoniale === "string") {
                              situationFam = client.situation_matrimoniale;
                            }
                            // Sinon si c'est un objet, extraire les données
                            else if (client.situation_familiale && typeof client.situation_familiale === "object") {
                              const sitFam = client.situation_familiale;
                              situationFam = sitFam.situation_matrimoniale || sitFam.situation_familiale || sitFam.etat_civil || "";
                            }
                            
                            // Extraire régime matrimonial si marié
                            let regimeMat = "";
                            if (client.situation_familiale && typeof client.situation_familiale === "object") {
                              regimeMat = client.situation_familiale.regime_matrimonial || "";
                            }
                            
                            console.log('Client sélectionné:', client);
                            console.log('Situation familiale extraite:', situationFam);
                            console.log('Régime matrimonial extrait:', regimeMat);
                            
                            setDonationSimpleData({
                              ...donationSimpleData,
                              donateur: {
                                ...donationSimpleData.donateur,
                                isClient: true,
                                clientId: clientId,
                                nom: client.nom || "",
                                prenom: client.prenom || "",
                                nomNaissance: client.nom || "",
                                adresseComplete: client.adresse || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                profession: client.profession || "",
                                situationFamiliale: situationFam,
                                regimeMatrimonial: regimeMat,
                              }
                            });
                          }
                        }
                      }}
                      label="Lier à un client (optionnel)"
                      placeholder="Sélectionner un client"
                    />
                  </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.nom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.prenom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={donationSimpleData.donateur.nomNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={donationSimpleData.donateur.dateNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={donationSimpleData.donateur.lieuNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={donationSimpleData.donateur.nationalite}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={donationSimpleData.donateur.profession}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Situation familiale <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.situationFamiliale}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, situationFamiliale: e.target.value}
                          })}
                          className="bg-muted/30"
                        />
                      </div>

                      {(donationSimpleData.donateur.situationFamiliale === "marie" || donationSimpleData.donateur.situationFamiliale === "Marié" || donationSimpleData.donateur.situationFamiliale === "marié" || donationSimpleData.donateur.situationFamiliale === "mariée" || donationSimpleData.donateur.situationFamiliale === "Mariée") && (
                        <div className="space-y-2">
                          <Label>Régime matrimonial</Label>
                          <Input
                            value={donationSimpleData.donateur.regimeMatrimonial}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donateur: {...donationSimpleData.donateur, regimeMatrimonial: e.target.value}
                            })}
                            className="bg-muted/30"
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.adresseComplete}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, adresseComplete: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={donationSimpleData.donateur.telephone}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={donationSimpleData.donateur.email}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, email: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Situation fiscale (utile pour seuils d'abattement)</Label>
                        <Input
                          value={donationSimpleData.donateur.situationFiscale}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, situationFiscale: e.target.value}
                          })}
                          placeholder="Ex: Imposable / Non imposable / Montant revenus..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 3. Identité du donataire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du donataire</h3>
                    <p className="text-sm text-muted-foreground">Personne qui reçoit la donation</p>
                    
                    <ClientSelector
                      clients={clients}
                      selectedClientId={donationSimpleData.donataire.clientId || ""}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setDonationSimpleData({
                              ...donationSimpleData,
                              donataire: {
                                ...donationSimpleData.donataire,
                                isClient: true,
                                clientId: clientId,
                                nom: client.nom || "",
                                prenom: client.prenom || "",
                                nomNaissance: client.nom || "",
                                adresseComplete: client.adresse || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                profession: client.profession || "",
                              }
                            });
                          }
                        }
                      }}
                      label="Lier à un client (optionnel)"
                      placeholder="Sélectionner un client"
                    />

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donataire.nom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donataire.prenom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={donationSimpleData.donataire.nomNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={donationSimpleData.donataire.dateNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={donationSimpleData.donataire.lieuNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={donationSimpleData.donataire.nationalite}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={donationSimpleData.donataire.profession}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lien avec le donateur <span className="text-red-500">*</span> (important fiscalement)</Label>
                        <Select
                          value={donationSimpleData.donataire.lienDonateur}
                          onValueChange={(value) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, lienDonateur: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="enfant">Enfant</SelectItem>
                            <SelectItem value="parent">Parent</SelectItem>
                            <SelectItem value="frere_soeur">Frère / Sœur</SelectItem>
                            <SelectItem value="neveu_niece">Neveu / Nièce</SelectItem>
                            <SelectItem value="cousin">Cousin</SelectItem>
                            <SelectItem value="ami">Ami</SelectItem>
                            <SelectItem value="conjoint_pacse">Conjoint pacsé</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {donationSimpleData.donataire.lienDonateur === "autre" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Précisez le lien <span className="text-red-500">*</span></Label>
                          <Input
                            value={donationSimpleData.donataire.lienDonateurAutrePrecision}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donataire: {...donationSimpleData.donataire, lienDonateurAutrePrecision: e.target.value}
                            })}
                            placeholder="Ex: beau-fils, concubin, petit-neveu, etc."
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donataire.adresseComplete}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, adresseComplete: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={donationSimpleData.donataire.telephone}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={donationSimpleData.donataire.email}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4. Enfants / héritiers du donateur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Enfants / héritiers du donateur</h3>
                    <p className="text-sm text-muted-foreground">Obligatoire pour vérifier qu'on n'empiète pas sur la réserve héréditaire</p>
                    
                    <div className="space-y-3">
                      <div className="space-y-2">
                        <Label>Nombre d'enfants</Label>
                        <Input
                          type="number"
                          value={donationSimpleData.nombreEnfants}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, nombreEnfants: e.target.value})}
                          placeholder="0"
                        />
                      </div>

                      {donationSimpleData.nombreEnfants && parseInt(donationSimpleData.nombreEnfants) > 0 && (
                        <div className="space-y-3">
                          <Label>Identité des enfants</Label>
                          {donationSimpleData.enfants.map((enfant, idx) => (
                            <div key={enfant.id} className="p-3 border rounded-lg space-y-2 bg-muted/10">
                              <div className="flex justify-between items-center">
                                <span className="text-sm font-medium">Enfant #{idx + 1}</span>
                                {donationSimpleData.enfants.length > 1 && (
                                  <button
                                    type="button"
                                    onClick={() => {
                                      const newEnfants = donationSimpleData.enfants.filter((_, i) => i !== idx);
                                      setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                    }}
                                    className="text-red-600 text-xs"
                                  >
                                    Supprimer
                                  </button>
                                )}
                              </div>
                              <div className="grid grid-cols-3 gap-2">
                                <Input
                                  placeholder="Nom"
                                  value={enfant.nom}
                                  onChange={(e) => {
                                    const newEnfants = [...donationSimpleData.enfants];
                                    newEnfants[idx].nom = e.target.value;
                                    setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                  }}
                                />
                                <Input
                                  placeholder="Prénom"
                                  value={enfant.prenom}
                                  onChange={(e) => {
                                    const newEnfants = [...donationSimpleData.enfants];
                                    newEnfants[idx].prenom = e.target.value;
                                    setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                  }}
                                />
                                <Input
                                  type="date"
                                  placeholder="Date naissance"
                                  value={enfant.dateNaissance}
                                  onChange={(e) => {
                                    const newEnfants = [...donationSimpleData.enfants];
                                    newEnfants[idx].dateNaissance = e.target.value;
                                    setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                            </div>
                          ))}
                          <button
                            type="button"
                            onClick={() => {
                              setDonationSimpleData({
                                ...donationSimpleData,
                                enfants: [...donationSimpleData.enfants, {
                                  id: Date.now(),
                                  nom: "",
                                  prenom: "",
                                  dateNaissance: "",
                                }]
                              });
                            }}
                            className="text-sm text-gray-700 hover:underline"
                          >
                            + Ajouter un enfant
                          </button>
                        </div>
                      )}

                      <div className="space-y-2 p-3 bg-blue-50 border border-gray-200 rounded-lg">
                        <Label className="text-sm font-medium">Type de donation (impact sur succession)</Label>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="hors_part"
                            checked={donationSimpleData.donationHorsPartSuccessorale}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donationHorsPartSuccessorale: e.target.checked,
                              donationAvancementPart: e.target.checked ? false : donationSimpleData.donationAvancementPart
                            })}
                          />
                          <label htmlFor="hors_part" className="text-sm cursor-pointer">
                            Donation hors part successorale (non rapportable)
                          </label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="avancement_part"
                            checked={donationSimpleData.donationAvancementPart}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donationAvancementPart: e.target.checked,
                              donationHorsPartSuccessorale: e.target.checked ? false : donationSimpleData.donationHorsPartSuccessorale
                            })}
                          />
                          <label htmlFor="avancement_part" className="text-sm cursor-pointer">
                            Donation en avancement de part successorale (rapportable)
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 5. Description complète du ou des biens donnés */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Description complète du ou des biens donnés</h3>
                    
                    {/* A. Bien immobilier */}
                    {donationSimpleData.typeDonation === "biens_immobiliers" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">🏠 Bien immobilier</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète <span className="text-red-500">*</span></Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.adresseComplete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, adresseComplete: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nature du bien</Label>
                            <Select
                              value={donationSimpleData.bienImmobilier.natureBien}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, natureBien: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="maison">Maison</SelectItem>
                                <SelectItem value="appartement">Appartement</SelectItem>
                                <SelectItem value="terrain">Terrain</SelectItem>
                                <SelectItem value="dependances">Dépendances</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Situation locative</Label>
                            <Select
                              value={donationSimpleData.bienImmobilier.situationLocative}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, situationLocative: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="libre">Libre</SelectItem>
                                <SelectItem value="loue">Loué</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Section cadastrale</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.sectionCadastrale}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, sectionCadastrale: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro cadastral</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.numeroCadastral}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, numeroCadastral: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Contenance</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.contenance}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, contenance: e.target.value}
                              })}
                              placeholder="Ex: 500m²"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur vénale <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.bienImmobilier.valeurVenale}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, valeurVenale: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Description détaillée</Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.bienImmobilier.descriptionDetaille}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, descriptionDetaille: e.target.value}
                              })}
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="existence_hypotheques"
                              checked={donationSimpleData.bienImmobilier.existenceHypotheques}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, existenceHypotheques: e.target.checked}
                              })}
                            />
                            <label htmlFor="existence_hypotheques" className="text-sm cursor-pointer">
                              Existence d'hypothèques
                            </label>
                          </div>

                          {donationSimpleData.bienImmobilier.existenceHypotheques && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Montant des hypothèques</Label>
                              <Input
                                type="number"
                                value={donationSimpleData.bienImmobilier.montantHypotheques}
                                onChange={(e) => setDonationSimpleData({
                                  ...donationSimpleData,
                                  bienImmobilier: {...donationSimpleData.bienImmobilier, montantHypotheques: e.target.value}
                                })}
                                placeholder="€"
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Répartition usufruit</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.repartitionUsufruit}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, repartitionUsufruit: e.target.value}
                              })}
                              placeholder="Ex: 40%"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Répartition nue-propriété</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.repartitionNuePropriete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, repartitionNuePropriete: e.target.value}
                              })}
                              placeholder="Ex: 60%"
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* B. Bien mobilier corporel */}
                    {donationSimpleData.typeDonation === "biens_meubles" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">🚗 Bien mobilier corporel</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Description précise du bien <span className="text-red-500">*</span></Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.bienMobilier.descriptionPrecise}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, descriptionPrecise: e.target.value}
                              })}
                              placeholder="Voiture, bijoux, œuvre d'art, mobilier, matériel..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de série (si véhicule ou matériel)</Label>
                            <Input
                              value={donationSimpleData.bienMobilier.numeroSerie}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, numeroSerie: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur estimée <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.bienMobilier.valeurEstimee}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, valeurEstimee: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="facture_existante"
                              checked={donationSimpleData.bienMobilier.factureExistante}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, factureExistante: e.target.checked}
                              })}
                            />
                            <label htmlFor="facture_existante" className="text-sm cursor-pointer">
                              Facture existante
                            </label>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* C. Somme d'argent */}
                    {donationSimpleData.typeDonation === "sommes_argent" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">💰 Somme d'argent</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Montant exact <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.sommesArgent.montantExact}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, montantExact: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Provenance du fonds</Label>
                            <Input
                              value={donationSimpleData.sommesArgent.provenanceFonds}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, provenanceFonds: e.target.value}
                              })}
                              placeholder="Ex: Épargne, vente bien, héritage..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Modalité <span className="text-red-500">*</span></Label>
                            <Select
                              value={donationSimpleData.sommesArgent.modalite}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, modalite: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="virement">Virement</SelectItem>
                                <SelectItem value="cheque">Chèque</SelectItem>
                                <SelectItem value="especes">Espèces</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Date du transfert</Label>
                            <Input
                              type="date"
                              value={donationSimpleData.sommesArgent.dateTransfert}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, dateTransfert: e.target.value}
                              })}
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* D. Parts sociales / actions */}
                    {donationSimpleData.typeDonation === "parts_sociales" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">📈 Parts sociales / Actions</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Type de société <span className="text-red-500">*</span></Label>
                            <Input
                              value={donationSimpleData.partsSociales.typeSociete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, typeSociete: e.target.value}
                              })}
                              placeholder="Ex: SARL, SAS, SA..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nombre de parts/actions <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.partsSociales.nombreParts}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, nombreParts: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur unitaire <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.partsSociales.valeurUnitaire}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, valeurUnitaire: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Pourcentage du capital</Label>
                            <Input
                              type="number"
                              value={donationSimpleData.partsSociales.pourcentageCapital}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, pourcentageCapital: e.target.value}
                              })}
                              placeholder="%"
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="agrement_obligatoire"
                              checked={donationSimpleData.partsSociales.agrementObligatoire}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, agrementObligatoire: e.target.checked}
                              })}
                            />
                            <label htmlFor="agrement_obligatoire" className="text-sm cursor-pointer">
                              Agrément obligatoire
                            </label>
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Clauses spécifiques (inaliénabilité...)</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.partsSociales.clausesSpecifiques}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, clausesSpecifiques: e.target.value}
                              })}
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* E. Nue-propriété / Usufruit */}
                    {(donationSimpleData.typeDonation === "nue_propriete" || donationSimpleData.typeDonation === "usufruit") && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">🔓 Nue-propriété / Usufruit</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Valeur de la nue-propriété <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.nueProprieteUsufruit.valeurNuePropriete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, valeurNuePropriete: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur de l'usufruit <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.nueProprieteUsufruit.valeurUsufruit}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, valeurUsufruit: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Durée</Label>
                            <Select
                              value={donationSimpleData.nueProprieteUsufruit.duree}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, duree: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="temporaire">Temporaire</SelectItem>
                                <SelectItem value="viager">Viager</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Répartition des charges</Label>
                            <Input
                              value={donationSimpleData.nueProprieteUsufruit.repartitionCharges}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, repartitionCharges: e.target.value}
                              })}
                              placeholder="Ex: Charges courantes / grosses réparations..."
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="usufruit_simultane"
                              checked={donationSimpleData.nueProprieteUsufruit.usufruitSimultaneConjoint}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, usufruitSimultaneConjoint: e.target.checked}
                              })}
                            />
                            <label htmlFor="usufruit_simultane" className="text-sm cursor-pointer">
                              Usufruit simultané du conjoint (rare)
                            </label>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 6. Clauses optionnelles */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses optionnelles de donation</h3>
                    
                    {/* A. Réserve d'usufruit */}
                    <div className="p-3 border rounded-lg space-y-3 bg-blue-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="reserve_usufruit"
                          checked={donationSimpleData.clausesOptionnelles.reserveUsufruit}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, reserveUsufruit: e.target.checked}
                          })}
                        />
                        <label htmlFor="reserve_usufruit" className="font-medium cursor-pointer">
                          A. Réserve d'usufruit
                        </label>
                      </div>
                      {donationSimpleData.clausesOptionnelles.reserveUsufruit && (
                        <div className="space-y-2 ml-6">
                          <div className="space-y-2">
                            <Label>Étendue de l'usufruit</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.etendueUsufruit}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, etendueUsufruit: e.target.value}
                              })}
                            />
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="droit_usage_habitation"
                              checked={donationSimpleData.clausesOptionnelles.droitUsageHabitation}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, droitUsageHabitation: e.target.checked}
                              })}
                            />
                            <label htmlFor="droit_usage_habitation" className="text-sm cursor-pointer">
                              Droit d'usage / habitation
                            </label>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* B. Droit de retour conventionnel */}
                    <div className="p-3 border rounded-lg space-y-3 bg-green-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="droit_retour_clause"
                          checked={donationSimpleData.clausesOptionnelles.droitRetour}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, droitRetour: e.target.checked}
                          })}
                        />
                        <label htmlFor="droit_retour_clause" className="font-medium cursor-pointer">
                          B. Droit de retour conventionnel
                        </label>
                      </div>
                      <p className="text-xs text-muted-foreground ml-6">
                        Permet au donateur de récupérer le bien si le donataire décède avant lui
                      </p>
                      {donationSimpleData.clausesOptionnelles.droitRetour && (
                        <div className="space-y-2 ml-6">
                          <Label>Étendue du droit de retour</Label>
                          <Select
                            value={donationSimpleData.clausesOptionnelles.etendueRetour}
                            onValueChange={(value) => setDonationSimpleData({
                              ...donationSimpleData,
                              clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, etendueRetour: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="totalite">Sur totalité du bien</SelectItem>
                              <SelectItem value="part_recue">Sur part reçue seulement</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>

                    {/* C. Charge imposée */}
                    <div className="p-3 border rounded-lg space-y-3 bg-orange-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="charge_imposee"
                          checked={donationSimpleData.clausesOptionnelles.chargeImposee}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, chargeImposee: e.target.checked}
                          })}
                        />
                        <label htmlFor="charge_imposee" className="font-medium cursor-pointer">
                          C. Charge imposée au donataire
                        </label>
                      </div>
                      {donationSimpleData.clausesOptionnelles.chargeImposee && (
                        <div className="space-y-2 ml-6">
                          <div className="space-y-2">
                            <Label>Description complète de la charge</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.descriptionCharge}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, descriptionCharge: e.target.value}
                              })}
                              placeholder="Ex: Payer des frais, entretenir un bien, laisser l'usage au donateur..."
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Montant ou nature</Label>
                            <Input
                              value={donationSimpleData.clausesOptionnelles.montantNatureCharge}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, montantNatureCharge: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Conditions d'exécution</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.conditionsExecution}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, conditionsExecution: e.target.value}
                              })}
                            />
                          </div>
                        </div>
                      )}
                    </div>

                    {/* D. Affectation particulière */}
                    <div className="p-3 border rounded-lg space-y-2 bg-purple-50/30">
                      <label className="font-medium">D. Affectation particulière</label>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="usage_professionnel"
                          checked={donationSimpleData.clausesOptionnelles.usageProfessionnel}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, usageProfessionnel: e.target.checked}
                          })}
                        />
                        <label htmlFor="usage_professionnel" className="text-sm cursor-pointer">
                          Bien donné pour usage professionnel
                        </label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="exclusion_communaute"
                          checked={donationSimpleData.clausesOptionnelles.exclusionCommunaute}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, exclusionCommunaute: e.target.checked}
                          })}
                        />
                        <label htmlFor="exclusion_communaute" className="text-sm cursor-pointer">
                          Exclusion de la communauté en cas de mariage du donataire
                        </label>
                      </div>
                    </div>

                    {/* E. Donation rapportable */}
                    <div className="p-3 border rounded-lg space-y-2 bg-teal-50/30">
                      <label className="font-medium">E. Donation rapportable ou non</label>
                      <Select
                        value={donationSimpleData.clausesOptionnelles.donationRapportable}
                        onValueChange={(value) => setDonationSimpleData({
                          ...donationSimpleData,
                          clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, donationRapportable: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="avancement_hoirie">Donation en avancement d'hoirie (rapportable)</SelectItem>
                          <SelectItem value="hors_part">Donation hors part successorale (non rapportable)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {/* F. Clause d'inaliénabilité */}
                    <div className="p-3 border rounded-lg space-y-3 bg-red-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="clause_inalienabilite"
                          checked={donationSimpleData.clausesOptionnelles.clauseInalienabilite}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, clauseInalienabilite: e.target.checked}
                          })}
                        />
                        <label htmlFor="clause_inalienabilite" className="font-medium cursor-pointer">
                          F. Clause d'inaliénabilité (rare et encadrée)
                        </label>
                      </div>
                      {donationSimpleData.clausesOptionnelles.clauseInalienabilite && (
                        <div className="space-y-2 ml-6">
                          <div className="space-y-2">
                            <Label>Durée</Label>
                            <Input
                              value={donationSimpleData.clausesOptionnelles.dureeInalienabilite}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, dureeInalienabilite: e.target.value}
                              })}
                              placeholder="Ex: 10 ans"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Motif légitime <span className="text-red-500">*</span></Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.motifLegitime}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, motifLegitime: e.target.value}
                              })}
                              placeholder="Requis par la loi"
                            />
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="autorisation_requise"
                              checked={donationSimpleData.clausesOptionnelles.autorisationRequise}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, autorisationRequise: e.target.checked}
                              })}
                            />
                            <label htmlFor="autorisation_requise" className="text-sm cursor-pointer">
                              Autorisation du donateur requise pour vendre
                            </label>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 7. Acceptation du donataire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Acceptation du donataire</h3>
                    <p className="text-sm text-muted-foreground">La donation n'existe légalement que si l'acceptation est expresse</p>
                    
                    <div className="p-4 border rounded-lg space-y-4 bg-blue-50/30">
                      <div className="space-y-3">
                        <Label className="font-medium">Le donataire accepte-t-il la donation dans cet acte ?</Label>
                        <div className="flex items-center space-x-4">
                          <div className="flex items-center space-x-2">
                            <input
                              type="radio"
                              id="acceptation_dans_acte"
                              checked={donationSimpleData.acceptationDonataire.dansActe === true}
                              onChange={() => setDonationSimpleData({
                                ...donationSimpleData,
                                acceptationDonataire: {...donationSimpleData.acceptationDonataire, dansActe: true}
                              })}
                            />
                            <label htmlFor="acceptation_dans_acte" className="text-sm cursor-pointer">Oui, dans cet acte</label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="radio"
                              id="acceptation_acte_separe"
                              checked={donationSimpleData.acceptationDonataire.dansActe === false}
                              onChange={() => setDonationSimpleData({
                                ...donationSimpleData,
                                acceptationDonataire: {...donationSimpleData.acceptationDonataire, dansActe: false}
                              })}
                            />
                            <label htmlFor="acceptation_acte_separe" className="text-sm cursor-pointer">Non, acceptation dans un acte séparé</label>
                          </div>
                        </div>
                      </div>

                      {!donationSimpleData.acceptationDonataire.dansActe && (
                        <div className="space-y-3 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                          <p className="text-sm font-medium text-amber-800">⚠️ Informations sur l'acte d'acceptation séparé</p>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Date de l'acte d'acceptation <span className="text-red-500">*</span></Label>
                              <Input
                                type="date"
                                value={donationSimpleData.acceptationDonataire.dateAcceptation}
                                onChange={(e) => setDonationSimpleData({
                                  ...donationSimpleData,
                                  acceptationDonataire: {...donationSimpleData.acceptationDonataire, dateAcceptation: e.target.value}
                                })}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Lieu de signature <span className="text-red-500">*</span></Label>
                              <Input
                                value={donationSimpleData.acceptationDonataire.lieuAcceptation}
                                onChange={(e) => setDonationSimpleData({
                                  ...donationSimpleData,
                                  acceptationDonataire: {...donationSimpleData.acceptationDonataire, lieuAcceptation: e.target.value}
                                })}
                                placeholder="Ville"
                              />
                            </div>
                          </div>
                          <p className="text-xs text-amber-700">📎 N'oubliez pas de joindre l'acte d'acceptation dans la section Documents</p>
                        </div>
                      )}

                      {donationSimpleData.acceptationDonataire.dansActe && (
                        <div className="p-3 bg-green-50 border border-green-200 rounded-lg">
                          <p className="text-sm text-green-800">✓ L'acceptation sera formalisée dans l'acte de donation lui-même</p>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 8. Modalités de remise du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Modalités de remise / transfert du bien</h3>
                    <p className="text-sm text-muted-foreground">Le Code civil exige de préciser quand et comment le donataire reçoit réellement la chose</p>
                    
                    <div className="p-4 border rounded-lg space-y-4 bg-purple-50/30">
                      <div className="space-y-2">
                        <Label>Mode de remise <span className="text-red-500">*</span></Label>
                        <Select
                          value={donationSimpleData.modalitesRemise.modeRemise}
                          onValueChange={(value) => setDonationSimpleData({
                            ...donationSimpleData,
                            modalitesRemise: {...donationSimpleData.modalitesRemise, modeRemise: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="immediate">Remise matérielle immédiate</SelectItem>
                            <SelectItem value="differee">Remise différée</SelectItem>
                            <SelectItem value="don_manuel_deja_realise">Don manuel déjà réalisé (donation postérieure)</SelectItem>
                            <SelectItem value="symbolique">Remise symbolique (clé, document, certificat...)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Lieu de remise</Label>
                          <Input
                            value={donationSimpleData.modalitesRemise.lieuRemise}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              modalitesRemise: {...donationSimpleData.modalitesRemise, lieuRemise: e.target.value}
                            })}
                            placeholder="Adresse ou lieu"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Date prévue de remise</Label>
                          <Input
                            type="date"
                            value={donationSimpleData.modalitesRemise.dateRemise}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              modalitesRemise: {...donationSimpleData.modalitesRemise, dateRemise: e.target.value}
                            })}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Personne responsable de la remise</Label>
                        <Input
                          value={donationSimpleData.modalitesRemise.personneResponsable}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            modalitesRemise: {...donationSimpleData.modalitesRemise, personneResponsable: e.target.value}
                          })}
                          placeholder="Nom de la personne"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Document remis avec le bien</Label>
                        <Select
                          value={donationSimpleData.modalitesRemise.documentRemis}
                          onValueChange={(value) => setDonationSimpleData({
                            ...donationSimpleData,
                            modalitesRemise: {...donationSimpleData.modalitesRemise, documentRemis: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="carte_grise">Carte grise</SelectItem>
                            <SelectItem value="certificat">Certificat</SelectItem>
                            <SelectItem value="facture">Facture</SelectItem>
                            <SelectItem value="cle">Clé</SelectItem>
                            <SelectItem value="titre_propriete">Titre de propriété</SelectItem>
                            <SelectItem value="autre">Autre document</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="p-3 bg-blue-50 border border-gray-200 rounded-lg">
                        <p className="text-xs text-blue-800">
                          💡 <strong>Exemple de clause générée :</strong><br/>
                          "La propriété est transférée immédiatement, et la remise matérielle du bien interviendra le [date] à [lieu], avec remise de [document]."
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* 9. Mentions légales obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Mentions légales obligatoires</h3>
                    <p className="text-sm text-muted-foreground">L'acte doit impérativement contenir :</p>
                    
                    <div className="space-y-2 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptation_expresse"
                          checked={donationSimpleData.mentionsLegales.acceptationExpresse}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, acceptationExpresse: e.target.checked}
                          })}
                        />
                        <label htmlFor="acceptation_expresse" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Acceptation expresse du donataire (obligatoire)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="consentement_eclaire"
                          checked={donationSimpleData.mentionsLegales.consentementEclaire}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, consentementEclaire: e.target.checked}
                          })}
                        />
                        <label htmlFor="consentement_eclaire" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Consentement éclairé du donateur (obligatoire)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="caractere_present"
                          checked={donationSimpleData.mentionsLegales.caracterePresentIrrevocable}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, caracterePresentIrrevocable: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="caractere_present" className="text-sm cursor-pointer text-muted-foreground">
                          Caractère présent et irrévocable de la donation
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_reserve"
                          checked={donationSimpleData.mentionsLegales.mentionReserveHereditaire}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, mentionReserveHereditaire: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="mention_reserve" className="text-sm cursor-pointer text-muted-foreground">
                          Mention du non-respect possible de la réserve héréditaire
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modalites_transfert"
                          checked={donationSimpleData.mentionsLegales.modalitesTransfertPropriete}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, modalitesTransfertPropriete: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="modalites_transfert" className="text-sm cursor-pointer text-muted-foreground">
                          Modalités de transfert de propriété
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="rappel_articles"
                          checked={donationSimpleData.mentionsLegales.rappelArticlesCodeCivil}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, rappelArticlesCodeCivil: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="rappel_articles" className="text-sm cursor-pointer text-muted-foreground">
                          Rappel des articles du Code civil
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="obligations_fiscales"
                          checked={donationSimpleData.mentionsLegales.obligationsFiscales}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, obligationsFiscales: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="obligations_fiscales" className="text-sm cursor-pointer text-muted-foreground">
                          Obligations fiscales (déclaration de don manuel ou IFI)
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* 10. Documents obligatoires à collecter */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Documents obligatoires à collecter</h3>
                    
                    {/* Documents donateur */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Pour le donateur</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Carte identité donateur */}
                        <div className="space-y-2">
                          <Label>Carte d'identité <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donateur_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonateurIdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donateur_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonateurIdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonateurIdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonateurIdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Livret famille */}
                        <div className="space-y-2">
                          <Label>Livret de famille</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donateur_livret"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonateurLivretFamilleFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donateur_livret" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonateurLivretFamilleFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonateurLivretFamilleFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonateurLivretFamilleFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile donateur */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donateur_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonateurDomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donateur_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonateurDomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonateurDomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonateurDomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents donataire */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Pour le donataire</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce identité donataire */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donataire_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonatairePieceIdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donataire_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonatairePieceIdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonatairePieceIdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonatairePieceIdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile donataire */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donataire_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonataireDomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donataire_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonataireDomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonataireDomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonataireDomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents selon type de bien */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents selon le type de bien</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Titre propriété */}
                        {donationSimpleData.typeDonation === "biens_immobiliers" && (
                          <div className="space-y-2">
                            <Label>Titre de propriété</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="donation_simple_titre_propriete"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setDonationSimpleTitreProprieteFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="donation_simple_titre_propriete" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {donationSimpleTitreProprieteFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {donationSimpleTitreProprieteFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setDonationSimpleTitreProprieteFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* Évaluation bien */}
                        <div className="space-y-2">
                          <Label>Évaluation du bien</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_simple_evaluation"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleEvaluationBienFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_evaluation" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleEvaluationBienFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleEvaluationBienFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleEvaluationBienFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Autres documents */}
                        <div className="space-y-2 md:col-span-2">
                          <Label>Autres documents</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_autres"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleAutresDocumentsFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_autres" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre (statuts société, RIB, diagnostics, etc.)
                            </label>
                            {donationSimpleAutresDocumentsFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleAutresDocumentsFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleAutresDocumentsFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire Avenants au contrat de travail */}
            {pendingContractType === "Avenants au contrat de travail" && (
              <>
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">💼 Avenants au contrat de travail</h3>
                
                {/* EMPLOYEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🏢 Identité de l'employeur</h4>
                  
                  {/* ClientSelector pour l'employeur */}
                  <ClientSelector 
                    clients={clients}
                    selectedClientId={avenantContratTravailClientIdEmployeur}
                    onClientChange={(clientId) => {
                      setAvenantContratTravailClientIdEmployeur(clientId);
                      if (clientId) {
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            employeur: {
                              ...avenantContratTravailData.employeur,
                              raisonSociale: `${client.prenom} ${client.nom}`,
                              adresseSiege: client.adresse || "",
                            }
                          });
                        }
                      } else {
                        // Reset pour saisie manuelle
                        setAvenantContratTravailData({
                          ...avenantContratTravailData,
                          employeur: {
                            raisonSociale: "",
                            formeJuridique: "",
                            siret: "",
                            codeAPE: "",
                            adresseSiege: "",
                            representantLegal: "",
                            qualiteRepresentant: "",
                          }
                        });
                      }
                    }}
                    label="Sélectionner l'employeur dans vos clients"
                    placeholder="Choisir un client"
                  />

                  {/* Afficher les infos si client sélectionné */}
                  {avenantContratTravailClientIdEmployeur && clients.find(c => c.id === avenantContratTravailClientIdEmployeur) && (
                    <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                      <p><strong>Nom:</strong> {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.nom} {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.prenom}</p>
                      {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.adresse && (
                        <p><strong>Adresse:</strong> {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.adresse}</p>
                      )}
                      {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.telephone && (
                        <p><strong>Téléphone:</strong> {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.telephone}</p>
                      )}
                      {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.email && (
                        <p><strong>Email:</strong> {clients.find(c => c.id === avenantContratTravailClientIdEmployeur)?.email}</p>
                      )}
                    </div>
                  )}

                  {/* Formulaire de saisie manuelle ou complémentaire */}
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Raison sociale</Label><Input value={avenantContratTravailData.employeur.raisonSociale} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, raisonSociale: e.target.value}})} /></div>
                    <div><Label>Forme juridique *</Label><Select value={avenantContratTravailData.employeur.formeJuridique} onValueChange={(value) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, formeJuridique: value}})}><SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger><SelectContent><SelectItem value="SARL">SARL</SelectItem><SelectItem value="SAS">SAS</SelectItem><SelectItem value="SA">SA</SelectItem><SelectItem value="SCI">SCI</SelectItem><SelectItem value="EURL">EURL</SelectItem><SelectItem value="SASU">SASU</SelectItem><SelectItem value="Association">Association</SelectItem><SelectItem value="Autre">Autre</SelectItem></SelectContent></Select></div>
                    <div><Label>SIRET *</Label><Input value={avenantContratTravailData.employeur.siret} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, siret: e.target.value}})} placeholder="123 456 789 00012" /></div>
                    <div><Label>Code APE</Label><Input value={avenantContratTravailData.employeur.codeAPE} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, codeAPE: e.target.value}})} placeholder="1234Z" /></div>
                    <div className="md:col-span-2"><Label>Adresse du siège social</Label><Input value={avenantContratTravailData.employeur.adresseSiege} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, adresseSiege: e.target.value}})} /></div>
                    <div><Label>Représentant légal *</Label><Input value={avenantContratTravailData.employeur.representantLegal} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, representantLegal: e.target.value}})} placeholder="Nom et prénom" /></div>
                    <div><Label>Qualité du représentant</Label><Input value={avenantContratTravailData.employeur.qualiteRepresentant} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, employeur: {...avenantContratTravailData.employeur, qualiteRepresentant: e.target.value}})} placeholder="Ex: Gérant, Président..." /></div>
                  </div>
                </div>

                {/* SALARIÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">👤 Identité du salarié</h4>
                  
                  {/* ClientSelector pour le salarié */}
                  <ClientSelector 
                    clients={clients}
                    selectedClientId={avenantContratTravailClientIdSalarie}
                    onClientChange={(clientId) => {
                      setAvenantContratTravailClientIdSalarie(clientId);
                      if (clientId) {
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            salarie: {
                              nom: client.nom || "",
                              prenom: client.prenom || "",
                              dateNaissance: client.date_naissance || "",
                              numeroSecu: "",
                              adresse: client.adresse || "",
                            }
                          });
                        }
                      } else {
                        // Reset pour saisie manuelle
                        setAvenantContratTravailData({
                          ...avenantContratTravailData,
                          salarie: {
                            nom: "",
                            prenom: "",
                            dateNaissance: "",
                            numeroSecu: "",
                            adresse: "",
                          }
                        });
                      }
                    }}
                    label="Sélectionner le salarié dans vos clients"
                    placeholder="Choisir un client"
                  />

                  {/* Afficher les infos si client sélectionné */}
                  {avenantContratTravailClientIdSalarie && clients.find(c => c.id === avenantContratTravailClientIdSalarie) && (
                    <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                      <p><strong>Nom complet:</strong> {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.nom} {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.prenom}</p>
                      {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.date_naissance && (
                        <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                      )}
                      {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.adresse && (
                        <p><strong>Adresse:</strong> {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.adresse}</p>
                      )}
                      {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.telephone && (
                        <p><strong>Téléphone:</strong> {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.telephone}</p>
                      )}
                      {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.email && (
                        <p><strong>Email:</strong> {clients.find(c => c.id === avenantContratTravailClientIdSalarie)?.email}</p>
                      )}
                    </div>
                  )}

                  {/* Formulaire de saisie manuelle ou complémentaire */}
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom</Label><Input value={avenantContratTravailData.salarie.nom} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, salarie: {...avenantContratTravailData.salarie, nom: e.target.value}})} /></div>
                    <div><Label>Prénom *</Label><Input value={avenantContratTravailData.salarie.prenom} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, salarie: {...avenantContratTravailData.salarie, prenom: e.target.value}})} /></div>
                    <div><Label>Date de naissance</Label><Input type="date" value={avenantContratTravailData.salarie.dateNaissance} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, salarie: {...avenantContratTravailData.salarie, dateNaissance: e.target.value}})} /></div>
                    <div><Label>Numéro de sécurité sociale</Label><Input value={avenantContratTravailData.salarie.numeroSecu} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, salarie: {...avenantContratTravailData.salarie, numeroSecu: e.target.value}})} placeholder="1 23 45 67 890 123 45" /></div>
                    <div className="md:col-span-2"><Label>Adresse personnelle</Label><Input value={avenantContratTravailData.salarie.adresse} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, salarie: {...avenantContratTravailData.salarie, adresse: e.target.value}})} /></div>
                  </div>
                </div>

                {/* CONTRAT INITIAL */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📄 Référence du contrat initial</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Date du contrat initial</Label><Input type="date" value={avenantContratTravailData.contratInitial.dateContrat} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, contratInitial: {...avenantContratTravailData.contratInitial, dateContrat: e.target.value}})} /></div>
                    <div><Label>Type de contrat initial</Label><Select value={avenantContratTravailData.contratInitial.typeContrat} onValueChange={(value) => setAvenantContratTravailData({...avenantContratTravailData, contratInitial: {...avenantContratTravailData.contratInitial, typeContrat: value}})}><SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger><SelectContent><SelectItem value="CDI">CDI</SelectItem><SelectItem value="CDD">CDD</SelectItem><SelectItem value="CTT">CTT (intérim)</SelectItem><SelectItem value="Alternance">Alternance</SelectItem></SelectContent></Select></div>
                    <div className="md:col-span-2"><Label>Poste initial</Label><Input value={avenantContratTravailData.contratInitial.posteInitial} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, contratInitial: {...avenantContratTravailData.contratInitial, posteInitial: e.target.value}})} placeholder="Intitulé du poste d'origine" /></div>
                  </div>
                </div>

                {/* DATE D'EFFET DE L'AVENANT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📅 Date d'effet de l'avenant</h4>
                  <div className="space-y-4">
                    <div className="flex items-center space-x-2">
                      <input
                        type="radio"
                        id="effet_immediat"
                        checked={avenantContratTravailData.effectImmediat}
                        onChange={(e) => setAvenantContratTravailData({
                          ...avenantContratTravailData,
                          effectImmediat: e.target.checked,
                          dateEffetDifferee: e.target.checked ? "" : avenantContratTravailData.dateEffetDifferee
                        })}
                      />
                      <Label htmlFor="effet_immediat" className="cursor-pointer font-medium">Effet immédiat (à la signature)</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input
                        type="radio"
                        id="effet_differe"
                        checked={!avenantContratTravailData.effectImmediat}
                        onChange={(e) => setAvenantContratTravailData({
                          ...avenantContratTravailData,
                          effectImmediat: !e.target.checked
                        })}
                      />
                      <Label htmlFor="effet_differe" className="cursor-pointer font-medium">Effet différé (date précise)</Label>
                    </div>
                    
                    {!avenantContratTravailData.effectImmediat && (
                      <div className="ml-6">
                        <Label>Date d'entrée en vigueur</Label>
                        <Input
                          type="date"
                          value={avenantContratTravailData.dateEffetDifferee}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            dateEffetDifferee: e.target.value
                          })}
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* MODIFICATIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✏️ Objet de l'avenant</h4>
                  <p className="text-sm text-gray-600">Sélectionnez le(s) élément(s) modifié(s) par cet avenant</p>
                    
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modif_remuneration"
                          checked={avenantContratTravailData.modifications.remuneration.actif}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            modifications: {
                              ...avenantContratTravailData.modifications,
                              remuneration: {...avenantContratTravailData.modifications.remuneration, actif: e.target.checked}
                            }
                          })}
                        />
                        <Label htmlFor="modif_remuneration" className="cursor-pointer">Modification de la rémunération</Label>
                      </div>

                      {avenantContratTravailData.modifications.remuneration.actif && (
                        <div className="ml-6 p-4 border rounded-lg space-y-3 bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Ancien salaire brut mensuel</Label>
                              <Input
                                value={avenantContratTravailData.modifications.remuneration.ancienSalaire}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    remuneration: {...avenantContratTravailData.modifications.remuneration, ancienSalaire: e.target.value}
                                  }
                                })}
                                placeholder="Ex: 2500 €"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Nouveau salaire brut mensuel</Label>
                              <Input
                                value={avenantContratTravailData.modifications.remuneration.nouveauSalaire}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    remuneration: {...avenantContratTravailData.modifications.remuneration, nouveauSalaire: e.target.value}
                                  }
                                })}
                                placeholder="Ex: 2800 €"
                              />
                            </div>
                            
                            <div className="md:col-span-2 space-y-2">
                              <Label>Éléments modifiés (fixe / variable / primes)</Label>
                              <Textarea
                                rows={3}
                                value={avenantContratTravailData.modifications.remuneration.elementsModifies}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    remuneration: {...avenantContratTravailData.modifications.remuneration, elementsModifies: e.target.value}
                                  }
                                })}
                                placeholder="Précisez si modification du salaire fixe, variable, primes, avantages en nature..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date d'effet</Label>
                              <Input
                                type="date"
                                value={avenantContratTravailData.modifications.remuneration.dateEffet}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    remuneration: {...avenantContratTravailData.modifications.remuneration, dateEffet: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modif_temps_travail"
                          checked={avenantContratTravailData.modifications.tempsTravail.actif}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            modifications: {
                              ...avenantContratTravailData.modifications,
                              tempsTravail: {...avenantContratTravailData.modifications.tempsTravail, actif: e.target.checked}
                            }
                          })}
                        />
                        <Label htmlFor="modif_temps_travail" className="cursor-pointer">Modification du temps de travail</Label>
                      </div>

                      {avenantContratTravailData.modifications.tempsTravail.actif && (
                        <div className="ml-6 p-4 border rounded-lg space-y-3 bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Ancienne durée hebdomadaire</Label>
                              <Input
                                value={avenantContratTravailData.modifications.tempsTravail.ancienneDuree}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    tempsTravail: {...avenantContratTravailData.modifications.tempsTravail, ancienneDuree: e.target.value}
                                  }
                                })}
                                placeholder="Ex: 35h"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Nouvelle durée hebdomadaire</Label>
                              <Input
                                value={avenantContratTravailData.modifications.tempsTravail.nouvelleDuree}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    tempsTravail: {...avenantContratTravailData.modifications.tempsTravail, nouvelleDuree: e.target.value}
                                  }
                                })}
                                placeholder="Ex: 28h"
                              />
                            </div>
                            
                            <div className="md:col-span-2 space-y-2">
                              <Label>Répartition horaire</Label>
                              <Textarea
                                rows={3}
                                value={avenantContratTravailData.modifications.tempsTravail.repartitionHoraire}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    tempsTravail: {...avenantContratTravailData.modifications.tempsTravail, repartitionHoraire: e.target.value}
                                  }
                                })}
                                placeholder="Ex: Lundi au jeudi 9h-17h, vendredi 9h-12h / Horaires variables / Planning tournant..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date d'effet</Label>
                              <Input
                                type="date"
                                value={avenantContratTravailData.modifications.tempsTravail.dateEffet}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    tempsTravail: {...avenantContratTravailData.modifications.tempsTravail, dateEffet: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modif_fonctions"
                          checked={avenantContratTravailData.modifications.fonctions.actif}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            modifications: {
                              ...avenantContratTravailData.modifications,
                              fonctions: {...avenantContratTravailData.modifications.fonctions, actif: e.target.checked}
                            }
                          })}
                        />
                        <Label htmlFor="modif_fonctions" className="cursor-pointer">Modification des fonctions</Label>
                      </div>

                      {avenantContratTravailData.modifications.fonctions.actif && (
                        <div className="ml-6 p-4 border rounded-lg space-y-3 bg-muted/10">
                          <div className="grid grid-cols-1 gap-4">
                            <div className="space-y-2">
                              <Label>Ancien poste</Label>
                              <Input
                                value={avenantContratTravailData.modifications.fonctions.ancienPoste}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    fonctions: {...avenantContratTravailData.modifications.fonctions, ancienPoste: e.target.value}
                                  }
                                })}
                                placeholder="Ex: Assistant commercial"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Nouveau poste</Label>
                              <Input
                                value={avenantContratTravailData.modifications.fonctions.nouveauPoste}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    fonctions: {...avenantContratTravailData.modifications.fonctions, nouveauPoste: e.target.value}
                                  }
                                })}
                                placeholder="Ex: Responsable commercial"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Nouvelles missions</Label>
                              <Textarea
                                value={avenantContratTravailData.modifications.fonctions.nouvellesMissions}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    fonctions: {...avenantContratTravailData.modifications.fonctions, nouvellesMissions: e.target.value}
                                  }
                                })}
                                placeholder="Description des nouvelles missions..."
                                rows={4}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date d'effet</Label>
                              <Input
                                type="date"
                                value={avenantContratTravailData.modifications.fonctions.dateEffet}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    fonctions: {...avenantContratTravailData.modifications.fonctions, dateEffet: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modif_lieu_travail"
                          checked={avenantContratTravailData.modifications.lieuTravail.actif}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            modifications: {
                              ...avenantContratTravailData.modifications,
                              lieuTravail: {...avenantContratTravailData.modifications.lieuTravail, actif: e.target.checked}
                            }
                          })}
                        />
                        <Label htmlFor="modif_lieu_travail" className="cursor-pointer">Modification du lieu de travail</Label>
                      </div>

                      {avenantContratTravailData.modifications.lieuTravail.actif && (
                        <div className="ml-6 p-4 border rounded-lg space-y-3 bg-muted/10">
                          <div className="grid grid-cols-1 gap-4">
                            <div className="space-y-2">
                              <Label>Ancien lieu</Label>
                              <Input
                                value={avenantContratTravailData.modifications.lieuTravail.ancienLieu}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    lieuTravail: {...avenantContratTravailData.modifications.lieuTravail, ancienLieu: e.target.value}
                                  }
                                })}
                                placeholder="Adresse actuelle"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Nouveau lieu</Label>
                              <Input
                                value={avenantContratTravailData.modifications.lieuTravail.nouveauLieu}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    lieuTravail: {...avenantContratTravailData.modifications.lieuTravail, nouveauLieu: e.target.value}
                                  }
                                })}
                                placeholder="Nouvelle adresse"
                              />
                            </div>
                            
                            <div className="space-y-2">
                              <Label>Clause de mobilité existante ?</Label>
                              <Textarea
                                rows={2}
                                value={avenantContratTravailData.modifications.lieuTravail.clauseMobilite}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    lieuTravail: {...avenantContratTravailData.modifications.lieuTravail, clauseMobilite: e.target.value}
                                  }
                                })}
                                placeholder="Si une clause de mobilité est prévue dans le contrat initial, précisez-la ici..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date d'effet</Label>
                              <Input
                                type="date"
                                value={avenantContratTravailData.modifications.lieuTravail.dateEffet}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    lieuTravail: {...avenantContratTravailData.modifications.lieuTravail, dateEffet: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modif_classification"
                          checked={avenantContratTravailData.modifications.classification.actif}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            modifications: {
                              ...avenantContratTravailData.modifications,
                              classification: {...avenantContratTravailData.modifications.classification, actif: e.target.checked}
                            }
                          })}
                        />
                        <Label htmlFor="modif_classification" className="cursor-pointer">Modification de la classification (coefficient, niveau)</Label>
                      </div>

                      {avenantContratTravailData.modifications.classification.actif && (
                        <div className="ml-6 p-4 border rounded-lg space-y-3 bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Ancien coefficient</Label>
                              <Input
                                value={avenantContratTravailData.modifications.classification.ancienCoefficient}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    classification: {...avenantContratTravailData.modifications.classification, ancienCoefficient: e.target.value}
                                  }
                                })}
                                placeholder="Ex: 150"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Nouveau coefficient</Label>
                              <Input
                                value={avenantContratTravailData.modifications.classification.nouveauCoefficient}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    classification: {...avenantContratTravailData.modifications.classification, nouveauCoefficient: e.target.value}
                                  }
                                })}
                                placeholder="Ex: 180"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date d'effet</Label>
                              <Input
                                type="date"
                                value={avenantContratTravailData.modifications.classification.dateEffet}
                                onChange={(e) => setAvenantContratTravailData({
                                  ...avenantContratTravailData,
                                  modifications: {
                                    ...avenantContratTravailData.modifications,
                                    classification: {...avenantContratTravailData.modifications.classification, dateEffet: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modif_autre"
                          checked={avenantContratTravailData.modifications.autre.actif}
                          onChange={(e) => setAvenantContratTravailData({
                            ...avenantContratTravailData,
                            modifications: {
                              ...avenantContratTravailData.modifications,
                              autre: {...avenantContratTravailData.modifications.autre, actif: e.target.checked}
                            }
                          })}
                        />
                        <Label htmlFor="modif_autre" className="cursor-pointer">Autre modification</Label>
                      </div>

                      {avenantContratTravailData.modifications.autre.actif && (
                        <div className="ml-6 p-4 border rounded-lg space-y-3 bg-muted/10">
                          <div className="space-y-2">
                            <Label>Description de la modification</Label>
                            <Textarea
                              value={avenantContratTravailData.modifications.autre.description}
                              onChange={(e) => setAvenantContratTravailData({
                                ...avenantContratTravailData,
                                modifications: {
                                  ...avenantContratTravailData.modifications,
                                  autre: {...avenantContratTravailData.modifications.autre, description: e.target.value}
                                }
                              })}
                              placeholder="Décrivez la modification..."
                              rows={4}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'effet</Label>
                            <Input
                              type="date"
                              value={avenantContratTravailData.modifications.autre.dateEffet}
                              onChange={(e) => setAvenantContratTravailData({
                                ...avenantContratTravailData,
                                modifications: {
                                  ...avenantContratTravailData.modifications,
                                  autre: {...avenantContratTravailData.modifications.autre, dateEffet: e.target.value}
                                }
                              })}
                            />
                          </div>
                        </div>
                      )}
                    </div>
                </div>

                {/* CLAUSES MAINTENUES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📋 Clauses maintenues</h4>
                  <p className="text-sm text-gray-600">Toutes les autres clauses du contrat initial restent inchangées</p>
                  <div><Label>Précisions sur les clauses maintenues (optionnel)</Label><Textarea value={avenantContratTravailData.clausesMaintenues} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, clausesMaintenues: e.target.value})} placeholder="Ex: Convention collective, période d'essai, clause de non-concurrence..." rows={4} /></div>
                </div>

                {/* DOCUMENTS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📎 Documents à joindre</h4>
                  <h5 className="font-medium text-gray-700 mt-4">Pièces justificatives</h5>
                    <SingleFileUpload 
                      label="Copie du contrat initial" 
                      files={avenantContratInitialFiles} 
                      onFilesChange={setAvenantContratInitialFiles} 
                      role="avocat" 
                      accept="application/pdf"
                    />
                    
                    <SingleFileUpload 
                      label="Avenants précédents (si existants)" 
                      files={avenantPrecedentsFiles} 
                      onFilesChange={setAvenantPrecedentsFiles} 
                      role="avocat"
                      accept="application/pdf"
                    />
                    
                    <SingleFileUpload 
                      label="Justificatifs (diplômes, certificats...)" 
                      files={avenantJustificatifsFiles} 
                      onFilesChange={setAvenantJustificatifsFiles} 
                      role="avocat"
                      accept="application/pdf,image/*"
                    />
                    
                    <SingleFileUpload 
                      label="Autres documents" 
                      files={avenantAutresDocumentsFiles} 
                      onFilesChange={setAvenantAutresDocumentsFiles} 
                      role="avocat"
                      accept="application/pdf,image/*"
                    />
                </div>

                {/* CONSENTEMENT DU SALARIÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✅ Consentement exprès du salarié</h4>
                  <div className="flex items-center space-x-3 p-4 bg-white rounded-lg border border-blue-300">
                    <input
                      type="checkbox"
                      id="consentement_expres"
                      checked={avenantContratTravailData.consentementExpres}
                      onChange={(e) => setAvenantContratTravailData({
                        ...avenantContratTravailData,
                        consentementExpres: e.target.checked
                      })}
                      className="h-5 w-5"
                    />
                    <Label htmlFor="consentement_expres" className="cursor-pointer font-medium text-base">
                      Le salarié accepte expressément et sans réserve les modifications apportées par le présent avenant
                    </Label>
                  </div>
                </div>

                {/* DATE ET LIEU DE SIGNATURE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✍️ Signature</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Ville de signature</Label><Input value={avenantContratTravailData.villeSignature} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, villeSignature: e.target.value})} placeholder="Ex: Paris" /></div>
                    <div><Label>Date de signature</Label><Input type="date" value={avenantContratTravailData.dateLieuSignature} onChange={(e) => setAvenantContratTravailData({...avenantContratTravailData, dateLieuSignature: e.target.value})} /></div>
                  </div>
                </div>

              </>
            )}

            {/* Formulaire Accords de confidentialité employé */}
            {pendingContractType === "Accords de confidentialité employé" && (
              <>
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🔒 Accord de confidentialité employé</h3>
                
                {/* EMPLOYEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🏢 Identité de l'employeur</h4>
                  
                  <ClientSelector 
                    clients={clients}
                    selectedClientId={accordConfidClientIdEmployeur}
                    onClientChange={(clientId) => {
                      setAccordConfidClientIdEmployeur(clientId);
                      if (clientId) {
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setAccordConfidentialiteData({
                            ...accordConfidentialiteData,
                            employeur: {
                              ...accordConfidentialiteData.employeur,
                              denominationSociale: `${client.prenom} ${client.nom}`,
                              adresse: client.adresse || "",
                            }
                          });
                        }
                      }
                    }}
                    label="Sélectionner l'employeur dans vos clients"
                    placeholder="Choisir un client"
                  />

                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Dénomination sociale</Label><Input value={accordConfidentialiteData.employeur.denominationSociale} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, denominationSociale: e.target.value}})} /></div>
                    <div><Label>Forme juridique</Label><Select value={accordConfidentialiteData.employeur.formeJuridique} onValueChange={(value) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, formeJuridique: value}})}><SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger><SelectContent><SelectItem value="SARL">SARL</SelectItem><SelectItem value="SAS">SAS</SelectItem><SelectItem value="SA">SA</SelectItem><SelectItem value="SCI">SCI</SelectItem><SelectItem value="EURL">EURL</SelectItem><SelectItem value="SASU">SASU</SelectItem><SelectItem value="Association">Association</SelectItem><SelectItem value="Autre">Autre</SelectItem></SelectContent></Select></div>
                    <div className="md:col-span-2"><Label>Adresse</Label><Input value={accordConfidentialiteData.employeur.adresse} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, adresse: e.target.value}})} /></div>
                    <div><Label>SIRET</Label><Input value={accordConfidentialiteData.employeur.siret} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, siret: e.target.value}})} placeholder="123 456 789 00012" /></div>
                    <div><Label>Convention collective</Label><Input value={accordConfidentialiteData.employeur.conventionCollective} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, conventionCollective: e.target.value}})} placeholder="Ex: Convention collective nationale..." /></div>
                    <div><Label>Représentant légal</Label><Input value={accordConfidentialiteData.employeur.representantLegal} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, representantLegal: e.target.value}})} placeholder="Nom et prénom" /></div>
                    <div><Label>Fonction du représentant</Label><Input value={accordConfidentialiteData.employeur.fonctionRepresentant} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employeur: {...accordConfidentialiteData.employeur, fonctionRepresentant: e.target.value}})} placeholder="Ex: Gérant, Président..." /></div>
                  </div>
                </div>

                {/* EMPLOYÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">👤 Identité de l'employé</h4>
                  
                  <ClientSelector 
                    clients={clients}
                    selectedClientId={accordConfidClientIdEmploye}
                    onClientChange={(clientId) => {
                      setAccordConfidClientIdEmploye(clientId);
                      if (clientId) {
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setAccordConfidentialiteData({
                            ...accordConfidentialiteData,
                            employe: {
                              nom: client.nom || "",
                              prenom: client.prenom || "",
                              adresse: client.adresse || "",
                              dateNaissance: client.date_naissance || "",
                              posteOccupe: "",
                              serviceAffectation: "",
                              dateEntree: "",
                              typeContrat: "",
                            }
                          });
                        }
                      }
                    }}
                    label="Sélectionner l'employé dans vos clients"
                    placeholder="Choisir un client"
                  />

                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom</Label><Input value={accordConfidentialiteData.employe.nom} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, nom: e.target.value}})} /></div>
                    <div><Label>Prénom</Label><Input value={accordConfidentialiteData.employe.prenom} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, prenom: e.target.value}})} /></div>
                    <div className="md:col-span-2"><Label>Adresse</Label><Input value={accordConfidentialiteData.employe.adresse} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, adresse: e.target.value}})} /></div>
                    <div><Label>Date de naissance</Label><Input type="date" value={accordConfidentialiteData.employe.dateNaissance} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, dateNaissance: e.target.value}})} /></div>
                    <div><Label>Poste occupé</Label><Input value={accordConfidentialiteData.employe.posteOccupe} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, posteOccupe: e.target.value}})} placeholder="Ex: Développeur, Commercial..." /></div>
                    <div><Label>Service d'affectation</Label><Input value={accordConfidentialiteData.employe.serviceAffectation} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, serviceAffectation: e.target.value}})} placeholder="Ex: DSI, Marketing..." /></div>
                    <div><Label>Date d'entrée dans l'entreprise</Label><Input type="date" value={accordConfidentialiteData.employe.dateEntree} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, dateEntree: e.target.value}})} /></div>
                    <div><Label>Type de contrat</Label><Select value={accordConfidentialiteData.employe.typeContrat} onValueChange={(value) => setAccordConfidentialiteData({...accordConfidentialiteData, employe: {...accordConfidentialiteData.employe, typeContrat: value}})}><SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger><SelectContent><SelectItem value="CDI">CDI</SelectItem><SelectItem value="CDD">CDD</SelectItem><SelectItem value="Alternance">Alternance</SelectItem><SelectItem value="Stage">Stage</SelectItem></SelectContent></Select></div>
                  </div>
                </div>

                {/* CONTEXTE DE L'ACCORD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📋 Contexte de l'accord</h4>
                  <p className="text-sm text-gray-600">Raison de cet engagement de confidentialité</p>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="acces_infos_sensibles" checked={accordConfidentialiteData.contexte.accesInfosSensibles} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, contexte: {...accordConfidentialiteData.contexte, accesInfosSensibles: e.target.checked}})} />
                      <Label htmlFor="acces_infos_sensibles" className="cursor-pointer">Accès à des informations sensibles</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secret_pro" checked={accordConfidentialiteData.contexte.secretProfessionnel} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, contexte: {...accordConfidentialiteData.contexte, secretProfessionnel: e.target.checked}})} />
                      <Label htmlFor="secret_pro" className="cursor-pointer">Secret professionnel</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_clients" checked={accordConfidentialiteData.contexte.donneesClients} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, contexte: {...accordConfidentialiteData.contexte, donneesClients: e.target.checked}})} />
                      <Label htmlFor="donnees_clients" className="cursor-pointer">Données clients</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="savoir_faire" checked={accordConfidentialiteData.contexte.savoirFaire} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, contexte: {...accordConfidentialiteData.contexte, savoirFaire: e.target.checked}})} />
                      <Label htmlFor="savoir_faire" className="cursor-pointer">Savoir-faire propriétaire</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="projets_dev" checked={accordConfidentialiteData.contexte.projetsDeveloppement} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, contexte: {...accordConfidentialiteData.contexte, projetsDeveloppement: e.target.checked}})} />
                      <Label htmlFor="projets_dev" className="cursor-pointer">Projets de développement</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="strat_commerciale" checked={accordConfidentialiteData.contexte.strategieCommerciale} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, contexte: {...accordConfidentialiteData.contexte, strategieCommerciale: e.target.checked}})} />
                      <Label htmlFor="strat_commerciale" className="cursor-pointer">Stratégie commerciale</Label>
                    </div>
                  </div>
                </div>

                {/* DÉFINITION DES INFORMATIONS CONFIDENTIELLES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🔐 Définition des informations confidentielles</h4>
                  <p className="text-sm text-gray-600">Cochez toutes les catégories concernées</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_donnees_clients" checked={accordConfidentialiteData.definitionsInfosConfidentielles.donneesClients} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, donneesClients: e.target.checked}})} />
                      <Label htmlFor="def_donnees_clients" className="cursor-pointer">Données clients</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_donnees_fournisseurs" checked={accordConfidentialiteData.definitionsInfosConfidentielles.donneesFournisseurs} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, donneesFournisseurs: e.target.checked}})} />
                      <Label htmlFor="def_donnees_fournisseurs" className="cursor-pointer">Données fournisseurs</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_infos_financieres" checked={accordConfidentialiteData.definitionsInfosConfidentielles.infosFinancieres} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, infosFinancieres: e.target.checked}})} />
                      <Label htmlFor="def_infos_financieres" className="cursor-pointer">Informations financières</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_savoir_faire" checked={accordConfidentialiteData.definitionsInfosConfidentielles.savoirFaireTechnique} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, savoirFaireTechnique: e.target.checked}})} />
                      <Label htmlFor="def_savoir_faire" className="cursor-pointer">Savoir-faire technique</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_projets_rd" checked={accordConfidentialiteData.definitionsInfosConfidentielles.projetsRD} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, projetsRD: e.target.checked}})} />
                      <Label htmlFor="def_projets_rd" className="cursor-pointer">Projets R&D</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_code_source" checked={accordConfidentialiteData.definitionsInfosConfidentielles.codeSource} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, codeSource: e.target.checked}})} />
                      <Label htmlFor="def_code_source" className="cursor-pointer">Code source</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_documents_internes" checked={accordConfidentialiteData.definitionsInfosConfidentielles.documentsInternes} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, documentsInternes: e.target.checked}})} />
                      <Label htmlFor="def_documents_internes" className="cursor-pointer">Documents internes</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_methodes_travail" checked={accordConfidentialiteData.definitionsInfosConfidentielles.methodesTravail} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, methodesTravail: e.target.checked}})} />
                      <Label htmlFor="def_methodes_travail" className="cursor-pointer">Méthodes de travail</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_strategies_comm" checked={accordConfidentialiteData.definitionsInfosConfidentielles.strategiesCommerciales} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, strategiesCommerciales: e.target.checked}})} />
                      <Label htmlFor="def_strategies_comm" className="cursor-pointer">Stratégies commerciales</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_tarifs" checked={accordConfidentialiteData.definitionsInfosConfidentielles.tarifsNegocies} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, tarifsNegocies: e.target.checked}})} />
                      <Label htmlFor="def_tarifs" className="cursor-pointer">Tarifs négociés</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_contrats" checked={accordConfidentialiteData.definitionsInfosConfidentielles.contrats} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, contrats: e.target.checked}})} />
                      <Label htmlFor="def_contrats" className="cursor-pointer">Contrats</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_donnees_rh" checked={accordConfidentialiteData.definitionsInfosConfidentielles.donneesRH} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, donneesRH: e.target.checked}})} />
                      <Label htmlFor="def_donnees_rh" className="cursor-pointer">Données RH</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_organigrammes" checked={accordConfidentialiteData.definitionsInfosConfidentielles.organigrammes} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, organigrammes: e.target.checked}})} />
                      <Label htmlFor="def_organigrammes" className="cursor-pointer">Organigrammes</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_rapports_activite" checked={accordConfidentialiteData.definitionsInfosConfidentielles.rapportsActivite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, rapportsActivite: e.target.checked}})} />
                      <Label htmlFor="def_rapports_activite" className="cursor-pointer">Rapports d'activité</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_brevets" checked={accordConfidentialiteData.definitionsInfosConfidentielles.brevetsPropriete} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, brevetsPropriete: e.target.checked}})} />
                      <Label htmlFor="def_brevets" className="cursor-pointer">Brevets et propriété intellectuelle</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="def_etudes_marche" checked={accordConfidentialiteData.definitionsInfosConfidentielles.etudesMarche} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, definitionsInfosConfidentielles: {...accordConfidentialiteData.definitionsInfosConfidentielles, etudesMarche: e.target.checked}})} />
                      <Label htmlFor="def_etudes_marche" className="cursor-pointer">Études de marché</Label>
                    </div>
                  </div>
                </div>

                {/* EXCLUSIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🚫 Exclusions des informations confidentielles</h4>
                  <p className="text-sm text-gray-600">Ces informations ne sont PAS couvertes par l'obligation de confidentialité</p>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="excl_domaine_public" checked={accordConfidentialiteData.exclusions.domainePublic} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, exclusions: {...accordConfidentialiteData.exclusions, domainePublic: e.target.checked}})} />
                      <Label htmlFor="excl_domaine_public" className="cursor-pointer">Informations dans le domaine public</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="excl_connues_avant" checked={accordConfidentialiteData.exclusions.connuesAvant} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, exclusions: {...accordConfidentialiteData.exclusions, connuesAvant: e.target.checked}})} />
                      <Label htmlFor="excl_connues_avant" className="cursor-pointer">Informations connues avant la signature</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="excl_divulguees_tiers" checked={accordConfidentialiteData.exclusions.divulgueesParTiers} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, exclusions: {...accordConfidentialiteData.exclusions, divulgueesParTiers: e.target.checked}})} />
                      <Label htmlFor="excl_divulguees_tiers" className="cursor-pointer">Informations divulguées légalement par un tiers</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="excl_obligation_legale" checked={accordConfidentialiteData.exclusions.obligationLegale} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, exclusions: {...accordConfidentialiteData.exclusions, obligationLegale: e.target.checked}})} />
                      <Label htmlFor="excl_obligation_legale" className="cursor-pointer">Divulgation en raison d'une obligation légale</Label>
                    </div>
                  </div>
                </div>

                {/* OBLIGATIONS DU SALARIÉ PENDANT LE CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✅ Obligations du salarié pendant le contrat de travail</h4>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_secret_absolu" checked={accordConfidentialiteData.obligationsPendant.secretAbsolu} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, secretAbsolu: e.target.checked}})} />
                      <Label htmlFor="oblig_secret_absolu" className="cursor-pointer">Secret absolu sur toute info confidentielle</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_divulgation_necessaire" checked={accordConfidentialiteData.obligationsPendant.divulgationNecessaireUniquement} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, divulgationNecessaireUniquement: e.target.checked}})} />
                      <Label htmlFor="oblig_divulgation_necessaire" className="cursor-pointer">Divulgation uniquement si nécessaire à la mission</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_mesures_securite" checked={accordConfidentialiteData.obligationsPendant.mesuresSecurite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, mesuresSecurite: e.target.checked}})} />
                      <Label htmlFor="oblig_mesures_securite" className="cursor-pointer">Mise en place de mesures de sécurité</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_copie_interdite" checked={accordConfidentialiteData.obligationsPendant.copieInterdite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, copieInterdite: e.target.checked}})} />
                      <Label htmlFor="oblig_copie_interdite" className="cursor-pointer">Interdiction de copier des infos sans autorisation</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_support_perso" checked={accordConfidentialiteData.obligationsPendant.supportPersonnelInterdit} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, supportPersonnelInterdit: e.target.checked}})} />
                      <Label htmlFor="oblig_support_perso" className="cursor-pointer">Interdiction d'utiliser un support personnel</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_mail_pro" checked={accordConfidentialiteData.obligationsPendant.mailProUniquement} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, mailProUniquement: e.target.checked}})} />
                      <Label htmlFor="oblig_mail_pro" className="cursor-pointer">Utilisation email professionnel uniquement</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_reseaux_sociaux" checked={accordConfidentialiteData.obligationsPendant.reseauxSociauxInterdits} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, reseauxSociauxInterdits: e.target.checked}})} />
                      <Label htmlFor="oblig_reseaux_sociaux" className="cursor-pointer">Interdiction de partage sur réseaux sociaux</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="oblig_alerte_violation" checked={accordConfidentialiteData.obligationsPendant.alerteViolation} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsPendant: {...accordConfidentialiteData.obligationsPendant, alerteViolation: e.target.checked}})} />
                      <Label htmlFor="oblig_alerte_violation" className="cursor-pointer">Alerte immédiate en cas de violation</Label>
                    </div>
                  </div>
                </div>

                {/* OBLIGATIONS DU SALARIÉ APRÈS LE CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">⏱️ Obligations du salarié après le contrat de travail</h4>
                  
                  <div className="space-y-3">
                    <div><Label>Durée après le contrat</Label><Select value={accordConfidentialiteData.obligationsApres.dureeConfidentialite} onValueChange={(value) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsApres: {...accordConfidentialiteData.obligationsApres, dureeConfidentialite: value}})}><SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger><SelectContent><SelectItem value="1_an">1 an</SelectItem><SelectItem value="3_ans">3 ans</SelectItem><SelectItem value="5_ans">5 ans</SelectItem><SelectItem value="10_ans">10 ans</SelectItem><SelectItem value="illimitee">Durée illimitée (secret des affaires)</SelectItem></SelectContent></Select></div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="apres_maintien_confid" checked={accordConfidentialiteData.obligationsApres.maintienConfidentialite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsApres: {...accordConfidentialiteData.obligationsApres, maintienConfidentialite: e.target.checked}})} />
                      <Label htmlFor="apres_maintien_confid" className="cursor-pointer">Maintien de la confidentialité</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="apres_restitution_docs" checked={accordConfidentialiteData.obligationsApres.restitutionDocuments} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsApres: {...accordConfidentialiteData.obligationsApres, restitutionDocuments: e.target.checked}})} />
                      <Label htmlFor="apres_restitution_docs" className="cursor-pointer">Restitution de tous les documents</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="apres_destruction_copies" checked={accordConfidentialiteData.obligationsApres.destructionCopies} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsApres: {...accordConfidentialiteData.obligationsApres, destructionCopies: e.target.checked}})} />
                      <Label htmlFor="apres_destruction_copies" className="cursor-pointer">Destruction de toutes les copies</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="apres_interdiction_usage" checked={accordConfidentialiteData.obligationsApres.interdictionUsage} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsApres: {...accordConfidentialiteData.obligationsApres, interdictionUsage: e.target.checked}})} />
                      <Label htmlFor="apres_interdiction_usage" className="cursor-pointer">Interdiction d'usage à des fins personnelles</Label>
                    </div>
                  </div>
                </div>

                {/* INTERDICTIONS SPÉCIFIQUES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🚫 Interdictions spécifiques</h4>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="inter_concurrents" checked={accordConfidentialiteData.interdictions.divulgationConcurrents} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, interdictions: {...accordConfidentialiteData.interdictions, divulgationConcurrents: e.target.checked}})} />
                      <Label htmlFor="inter_concurrents" className="cursor-pointer">Divulgation à des concurrents</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="inter_usage_perso" checked={accordConfidentialiteData.interdictions.usagePersonnel} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, interdictions: {...accordConfidentialiteData.interdictions, usagePersonnel: e.target.checked}})} />
                      <Label htmlFor="inter_usage_perso" className="cursor-pointer">Usage personnel des informations</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="inter_publication" checked={accordConfidentialiteData.interdictions.publication} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, interdictions: {...accordConfidentialiteData.interdictions, publication: e.target.checked}})} />
                      <Label htmlFor="inter_publication" className="cursor-pointer">Publication ou diffusion publique</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="inter_repro_non_auto" checked={accordConfidentialiteData.interdictions.reproductionNonAutorisee} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, interdictions: {...accordConfidentialiteData.interdictions, reproductionNonAutorisee: e.target.checked}})} />
                      <Label htmlFor="inter_repro_non_auto" className="cursor-pointer">Reproduction non autorisée</Label>
                    </div>
                  </div>
                </div>

                {/* OBLIGATIONS DE L'EMPLOYEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🏢 Obligations de l'employeur</h4>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="empl_identification_docs" checked={accordConfidentialiteData.obligationsEmployeur.identificationDocuments} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsEmployeur: {...accordConfidentialiteData.obligationsEmployeur, identificationDocuments: e.target.checked}})} />
                      <Label htmlFor="empl_identification_docs" className="cursor-pointer">Identification claire des documents confidentiels</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="empl_formation" checked={accordConfidentialiteData.obligationsEmployeur.formationSecurite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsEmployeur: {...accordConfidentialiteData.obligationsEmployeur, formationSecurite: e.target.checked}})} />
                      <Label htmlFor="empl_formation" className="cursor-pointer">Formation à la sécurité informatique</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="empl_acces_limite" checked={accordConfidentialiteData.obligationsEmployeur.accesLimite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, obligationsEmployeur: {...accordConfidentialiteData.obligationsEmployeur, accesLimite: e.target.checked}})} />
                      <Label htmlFor="empl_acces_limite" className="cursor-pointer">Accès limité selon le besoin</Label>
                    </div>
                  </div>
                </div>

                {/* SÉCURITÉ INFORMATIQUE COMPLÈTE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🔒 Sécurité informatique</h4>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secu_charte_info" checked={accordConfidentialiteData.securiteInformatique.charteInformatique} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, charteInformatique: e.target.checked}})} />
                      <Label htmlFor="secu_charte_info" className="cursor-pointer">Charte informatique à respecter</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secu_mdp_fort" checked={accordConfidentialiteData.securiteInformatique.motDePasseFort} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, motDePasseFort: e.target.checked}})} />
                      <Label htmlFor="secu_mdp_fort" className="cursor-pointer">Mot de passe fort obligatoire</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secu_cle_usb_interdite" checked={accordConfidentialiteData.securiteInformatique.cleUSBInterdite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, cleUSBInterdite: e.target.checked}})} />
                      <Label htmlFor="secu_cle_usb_interdite" className="cursor-pointer">Clés USB personnelles interdites</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secu_cloud_perso_interdit" checked={accordConfidentialiteData.securiteInformatique.cloudPersonnelInterdit} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, cloudPersonnelInterdit: e.target.checked}})} />
                      <Label htmlFor="secu_cloud_perso_interdit" className="cursor-pointer">Stockage cloud personnel interdit</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secu_chiffrement" checked={accordConfidentialiteData.securiteInformatique.chiffrementObligatoire} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, chiffrementObligatoire: e.target.checked}})} />
                      <Label htmlFor="secu_chiffrement" className="cursor-pointer">Chiffrement des données obligatoire</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="secu_antivirus" checked={accordConfidentialiteData.securiteInformatique.antivirusMajours} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, antivirusMajours: e.target.checked}})} />
                      <Label htmlFor="secu_antivirus" className="cursor-pointer">Antivirus à jour obligatoire</Label>
                    </div>
                    
                    <h5 className="font-medium text-gray-700 mt-4">Télétravail (si applicable)</h5>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="vpn_obligatoire" checked={accordConfidentialiteData.securiteInformatique.teletravailVPN} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, teletravailVPN: e.target.checked}})} />
                      <Label htmlFor="vpn_obligatoire" className="cursor-pointer">VPN obligatoire</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="acces_chiffre" checked={accordConfidentialiteData.securiteInformatique.teletravailAccesChiffre} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, teletravailAccesChiffre: e.target.checked}})} />
                      <Label htmlFor="acces_chiffre" className="cursor-pointer">Accès chiffré</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="materiel_securise" checked={accordConfidentialiteData.securiteInformatique.teletravailMaterielSecurise} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, securiteInformatique: {...accordConfidentialiteData.securiteInformatique, teletravailMaterielSecurise: e.target.checked}})} />
                      <Label htmlFor="materiel_securise" className="cursor-pointer">Matériel sécurisé</Label>
                    </div>
                  </div>
                </div>

                {/* RESTITUTION DES DOCUMENTS ET SUPPORTS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📦 Restitution des documents et supports (à la fin du contrat)</h4>
                  <p className="text-sm text-gray-600">Éléments à restituer obligatoirement</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_documents_papier" checked={accordConfidentialiteData.restitution.documentsPapier} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, documentsPapier: e.target.checked}})} />
                      <Label htmlFor="rest_documents_papier" className="cursor-pointer">Tous documents papier</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_fichiers_num" checked={accordConfidentialiteData.restitution.fichiersNumeriques} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, fichiersNumeriques: e.target.checked}})} />
                      <Label htmlFor="rest_fichiers_num" className="cursor-pointer">Fichiers numériques</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_ordinateur" checked={accordConfidentialiteData.restitution.ordinateur} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, ordinateur: e.target.checked}})} />
                      <Label htmlFor="rest_ordinateur" className="cursor-pointer">Ordinateur portable</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_telephone" checked={accordConfidentialiteData.restitution.telephone} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, telephone: e.target.checked}})} />
                      <Label htmlFor="rest_telephone" className="cursor-pointer">Téléphone professionnel</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_cles_usb" checked={accordConfidentialiteData.restitution.clesUSB} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, clesUSB: e.target.checked}})} />
                      <Label htmlFor="rest_cles_usb" className="cursor-pointer">Clés USB</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_disques_durs" checked={accordConfidentialiteData.restitution.disquesDurs} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, disquesDurs: e.target.checked}})} />
                      <Label htmlFor="rest_disques_durs" className="cursor-pointer">Disques durs externes</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_badges" checked={accordConfidentialiteData.restitution.badges} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, badges: e.target.checked}})} />
                      <Label htmlFor="rest_badges" className="cursor-pointer">Badges et cartes d'accès</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_cles" checked={accordConfidentialiteData.restitution.cles} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, cles: e.target.checked}})} />
                      <Label htmlFor="rest_cles" className="cursor-pointer">Clés des locaux</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_manuels" checked={accordConfidentialiteData.restitution.manuels} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, manuels: e.target.checked}})} />
                      <Label htmlFor="rest_manuels" className="cursor-pointer">Manuels et documentation</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="rest_copies" checked={accordConfidentialiteData.restitution.toutesLesCopies} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, restitution: {...accordConfidentialiteData.restitution, toutesLesCopies: e.target.checked}})} />
                      <Label htmlFor="rest_copies" className="cursor-pointer">Toutes les copies (même personnelles)</Label>
                    </div>
                  </div>
                </div>

                {/* RGPD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🛡️ Protection des données personnelles (RGPD)</h4>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="formation_rgpd" checked={accordConfidentialiteData.rgpd.formationRGPD} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, rgpd: {...accordConfidentialiteData.rgpd, formationRGPD: e.target.checked}})} />
                      <Label htmlFor="formation_rgpd" className="cursor-pointer">Formation RGPD dispensée</Label>
                    </div>
                    
                    <div><Label>Délégué à la protection des données (DPO)</Label><Input value={accordConfidentialiteData.rgpd.mentionDPO} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, rgpd: {...accordConfidentialiteData.rgpd, mentionDPO: e.target.value}})} placeholder="Nom et contact du DPO" /></div>
                  </div>
                </div>

                {/* RESPONSABILITÉ ET SANCTIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">⚖️ Responsabilité et sanctions</h4>
                  
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_penalite" checked={accordConfidentialiteData.responsabilite.clausePenalite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, responsabilite: {...accordConfidentialiteData.responsabilite, clausePenalite: e.target.checked}})} />
                      <Label htmlFor="clause_penalite" className="cursor-pointer">Clause de pénalité financière</Label>
                    </div>
                    
                    {accordConfidentialiteData.responsabilite.clausePenalite && (
                      <div className="ml-6"><Label>Montant forfaitaire de la pénalité</Label><Input value={accordConfidentialiteData.responsabilite.montantPenalite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, responsabilite: {...accordConfidentialiteData.responsabilite, montantPenalite: e.target.value}})} placeholder="Ex: 5000 €" /></div>
                    )}
                  </div>
                </div>

                {/* COMPATIBILITÉ AUTRES CLAUSES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📋 Compatibilité avec d'autres clauses du contrat</h4>
                  <p className="text-sm text-gray-600">Indiquez si d'autres clauses existent déjà dans le contrat de travail</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_confid_existante" checked={accordConfidentialiteData.compatibilite.clauseConfidentialiteExistante} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, compatibilite: {...accordConfidentialiteData.compatibilite, clauseConfidentialiteExistante: e.target.checked}})} />
                      <Label htmlFor="clause_confid_existante" className="cursor-pointer">Clause de confidentialité existante</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_non_concurrence" checked={accordConfidentialiteData.compatibilite.clauseNonConcurrence} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, compatibilite: {...accordConfidentialiteData.compatibilite, clauseNonConcurrence: e.target.checked}})} />
                      <Label htmlFor="clause_non_concurrence" className="cursor-pointer">Clause de non-concurrence</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_exclusivite" checked={accordConfidentialiteData.compatibilite.clauseExclusivite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, compatibilite: {...accordConfidentialiteData.compatibilite, clauseExclusivite: e.target.checked}})} />
                      <Label htmlFor="clause_exclusivite" className="cursor-pointer">Clause d'exclusivité</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_dedit" checked={accordConfidentialiteData.compatibilite.clauseDeditFormation} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, compatibilite: {...accordConfidentialiteData.compatibilite, clauseDeditFormation: e.target.checked}})} />
                      <Label htmlFor="clause_dedit" className="cursor-pointer">Clause de dédit-formation</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_objectifs" checked={accordConfidentialiteData.compatibilite.clauseObjectifs} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, compatibilite: {...accordConfidentialiteData.compatibilite, clauseObjectifs: e.target.checked}})} />
                      <Label htmlFor="clause_objectifs" className="cursor-pointer">Clause d'objectifs</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="accord_teletravail" checked={accordConfidentialiteData.compatibilite.accordTeletravail} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, compatibilite: {...accordConfidentialiteData.compatibilite, accordTeletravail: e.target.checked}})} />
                      <Label htmlFor="accord_teletravail" className="cursor-pointer">Accord de télétravail</Label>
                    </div>
                  </div>
                </div>

                {/* DROIT APPLICABLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">⚖️ Droit applicable et litiges</h4>
                  
                  <div className="space-y-3">
                    <div><Label>Tribunal compétent</Label><Select value={accordConfidentialiteData.droitApplicable.tribunalCompetent} onValueChange={(value) => setAccordConfidentialiteData({...accordConfidentialiteData, droitApplicable: {...accordConfidentialiteData.droitApplicable, tribunalCompetent: value}})}><SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger><SelectContent><SelectItem value="tribunal_judiciaire">Tribunal judiciaire</SelectItem><SelectItem value="prudhommes">Conseil de prud'hommes</SelectItem></SelectContent></Select></div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="clause_mediation" checked={accordConfidentialiteData.droitApplicable.clauseMediation} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, droitApplicable: {...accordConfidentialiteData.droitApplicable, clauseMediation: e.target.checked}})} />
                      <Label htmlFor="clause_mediation" className="cursor-pointer">Clause de médiation préalable</Label>
                    </div>
                  </div>
                </div>

                {/* ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📎 Annexes jointes</h4>
                  <p className="text-sm text-gray-600">Indiquez les documents annexés à l'accord</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_charte_info" checked={accordConfidentialiteData.annexes.charteInformatique} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, charteInformatique: e.target.checked}})} />
                      <Label htmlFor="annexe_charte_info" className="cursor-pointer">Charte informatique</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_politique_confid" checked={accordConfidentialiteData.annexes.politiqueConfidentialite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, politiqueConfidentialite: e.target.checked}})} />
                      <Label htmlFor="annexe_politique_confid" className="cursor-pointer">Politique de confidentialité interne</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_cyber" checked={accordConfidentialiteData.annexes.politiqueCybersecurite} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, politiqueCybersecurite: e.target.checked}})} />
                      <Label htmlFor="annexe_cyber" className="cursor-pointer">Politique cybersécurité</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_fiche_poste" checked={accordConfidentialiteData.annexes.fichePoste} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, fichePoste: e.target.checked}})} />
                      <Label htmlFor="annexe_fiche_poste" className="cursor-pointer">Fiche de poste</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_reglement" checked={accordConfidentialiteData.annexes.reglementInterieur} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, reglementInterieur: e.target.checked}})} />
                      <Label htmlFor="annexe_reglement" className="cursor-pointer">Règlement intérieur</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_teletravail" checked={accordConfidentialiteData.annexes.charteTeletravail} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, charteTeletravail: e.target.checked}})} />
                      <Label htmlFor="annexe_teletravail" className="cursor-pointer">Charte télétravail</Label>
                    </div>
                    
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_rgpd" checked={accordConfidentialiteData.annexes.engagementRGPD} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, annexes: {...accordConfidentialiteData.annexes, engagementRGPD: e.target.checked}})} />
                      <Label htmlFor="annexe_rgpd" className="cursor-pointer">Engagement RGPD</Label>
                    </div>
                  </div>
                </div>

                {/* DOCUMENTS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📎 Pièces justificatives à joindre</h4>
                  
                  <h5 className="font-medium text-gray-700 mt-4">Employeur</h5>
                  <SingleFileUpload 
                    label="Kbis" 
                    files={accordConfidEmployeurKbisFiles} 
                    onFilesChange={setAccordConfidEmployeurKbisFiles} 
                    role="avocat" 
                    accept="application/pdf"
                  />
                  
                  <SingleFileUpload 
                    label="Charte informatique" 
                    files={accordConfidCharteInformatiqueFiles} 
                    onFilesChange={setAccordConfidCharteInformatiqueFiles} 
                    role="avocat"
                    accept="application/pdf"
                  />
                  
                  <SingleFileUpload 
                    label="Politique interne applicable" 
                    files={accordConfidPolitiqueInterneFiles} 
                    onFilesChange={setAccordConfidPolitiqueInterneFiles} 
                    role="avocat"
                    accept="application/pdf"
                  />
                  
                  <h5 className="font-medium text-gray-700 mt-4">Employé</h5>
                  <SingleFileUpload 
                    label="Pièce d'identité (optionnelle)" 
                    files={accordConfidEmployeIdentiteFiles} 
                    onFilesChange={setAccordConfidEmployeIdentiteFiles} 
                    role="avocat"
                    accept="application/pdf,image/*"
                  />
                </div>

                {/* SIGNATURE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✍️ Signature</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Ville de signature</Label><Input value={accordConfidentialiteData.villeSignature} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, villeSignature: e.target.value})} placeholder="Ex: Paris" /></div>
                    <div><Label>Date de signature</Label><Input type="date" value={accordConfidentialiteData.dateLieuSignature} onChange={(e) => setAccordConfidentialiteData({...accordConfidentialiteData, dateLieuSignature: e.target.value})} /></div>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire Politique RGPD interne */}
            {pendingContractType === "Politique RGPD interne (annexes)" && (
              <>
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🛡️ Politique RGPD Interne</h3>
                
                {/* 1. IDENTIFICATION DE L'ORGANISATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🏢 Identification de l'organisation</h4>
                  
                  <ClientSelector 
                    clients={clients}
                    selectedClientId={politiqueRGPDClientId}
                    onClientChange={(clientId) => {
                      setPolitiqueRGPDClientId(clientId);
                      if (clientId) {
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setPolitiqueRGPDData({
                            ...politiqueRGPDData,
                            organisation: {
                              ...politiqueRGPDData.organisation,
                              denominationSociale: `${client.prenom} ${client.nom}`,
                              adresseSiege: client.adresse || "",
                            }
                          });
                        }
                      }
                    }}
                    label="Sélectionner l'organisation dans vos clients"
                    placeholder="Choisir un client"
                  />

                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Dénomination sociale</Label><Input value={politiqueRGPDData.organisation.denominationSociale} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, denominationSociale: e.target.value}})} /></div>
                    <div><Label>SIRET</Label><Input value={politiqueRGPDData.organisation.siret} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, siret: e.target.value}})} placeholder="123 456 789 00012" /></div>
                    <div className="md:col-span-2"><Label>Adresse siège</Label><Input value={politiqueRGPDData.organisation.adresseSiege} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, adresseSiege: e.target.value}})} /></div>
                    <div><Label>Secteur d'activité</Label><Input value={politiqueRGPDData.organisation.secteurActivite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, secteurActivite: e.target.value}})} placeholder="Ex: Services juridiques" /></div>
                    <div><Label>Taille (effectifs)</Label><Input value={politiqueRGPDData.organisation.tailleEffectifs} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, tailleEffectifs: e.target.value}})} placeholder="Ex: 10-50 salariés" /></div>
                    <div><Label>Représentant légal</Label><Input value={politiqueRGPDData.organisation.representantLegal} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, representantLegal: e.target.value}})} placeholder="Nom et prénom" /></div>
                    <div><Label>Contact général RGPD</Label><Input value={politiqueRGPDData.organisation.contactGeneralRGPD} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, organisation: {...politiqueRGPDData.organisation, contactGeneralRGPD: e.target.value}})} placeholder="email@entreprise.fr" /></div>
                  </div>
                </div>

                {/* 2. DPO */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">👤 DPO (Délégué à la Protection des Données)</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom / Fonction</Label><Input value={politiqueRGPDData.dpo.nom} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dpo: {...politiqueRGPDData.dpo, nom: e.target.value}})} placeholder="Ex: Jean Dupont - DPO" /></div>
                    <div><Label>Fonction</Label><Input value={politiqueRGPDData.dpo.fonction} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dpo: {...politiqueRGPDData.dpo, fonction: e.target.value}})} placeholder="Ex: Délégué à la Protection des Données" /></div>
                    <div><Label>Email dédié</Label><Input type="email" value={politiqueRGPDData.dpo.emailDedie} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dpo: {...politiqueRGPDData.dpo, emailDedie: e.target.value}})} placeholder="dpo@entreprise.fr" /></div>
                    <div><Label>Téléphone</Label><Input value={politiqueRGPDData.dpo.telephone} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dpo: {...politiqueRGPDData.dpo, telephone: e.target.value}})} placeholder="01 23 45 67 89" /></div>
                  </div>
                  
                  <div className="flex items-center space-x-2">
                    <input type="checkbox" id="designation_cnil" checked={politiqueRGPDData.dpo.designationCNIL} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dpo: {...politiqueRGPDData.dpo, designationCNIL: e.target.checked}})} />
                    <Label htmlFor="designation_cnil" className="cursor-pointer">Désignation CNIL effectuée</Label>
                  </div>
                </div>

                {/* 3. OBJET DE LA POLITIQUE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🎯 Objet de la politique RGPD</h4>
                  
                  <div><Label>Objectifs de conformité</Label><Textarea value={politiqueRGPDData.objet.objectifsConformite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, objectifsConformite: e.target.value}})} placeholder="Décrire les objectifs de conformité RGPD..." rows={3} /></div>
                  
                  <div className="flex items-center space-x-2">
                    <input type="checkbox" id="application_interne" checked={politiqueRGPDData.objet.applicationInterne} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, applicationInterne: e.target.checked}})} />
                    <Label htmlFor="application_interne" className="cursor-pointer font-semibold">Application interne obligatoire</Label>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">Champ d'application :</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="champ_salaries" checked={politiqueRGPDData.objet.champApplicationSalaries} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, champApplicationSalaries: e.target.checked}})} />
                      <Label htmlFor="champ_salaries" className="cursor-pointer">Salariés</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="champ_admin" checked={politiqueRGPDData.objet.champApplicationAdministrateurs} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, champApplicationAdministrateurs: e.target.checked}})} />
                      <Label htmlFor="champ_admin" className="cursor-pointer">Administrateurs</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="champ_presta" checked={politiqueRGPDData.objet.champApplicationPrestataires} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, champApplicationPrestataires: e.target.checked}})} />
                      <Label htmlFor="champ_presta" className="cursor-pointer">Prestataires</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="champ_stagiaires" checked={politiqueRGPDData.objet.champApplicationStagiaires} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, champApplicationStagiaires: e.target.checked}})} />
                      <Label htmlFor="champ_stagiaires" className="cursor-pointer">Stagiaires</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="champ_soustraitants" checked={politiqueRGPDData.objet.champApplicationSousTraitants} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, objet: {...politiqueRGPDData.objet, champApplicationSousTraitants: e.target.checked}})} />
                      <Label htmlFor="champ_soustraitants" className="cursor-pointer">Sous-traitants</Label>
                    </div>
                  </div>
                </div>

                {/* 4. PRINCIPES FONDAMENTAUX */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">⚖️ Principes fondamentaux du RGPD</h4>
                  <p className="text-sm text-gray-600">Ces principes sont obligatoires pour la validité juridique de la politique</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_liceite" checked={politiqueRGPDData.principes.liceite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, liceite: e.target.checked}})} />
                      <Label htmlFor="principe_liceite" className="cursor-pointer">Licéité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_transparence" checked={politiqueRGPDData.principes.transparence} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, transparence: e.target.checked}})} />
                      <Label htmlFor="principe_transparence" className="cursor-pointer">Transparence</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_minimisation" checked={politiqueRGPDData.principes.minimisation} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, minimisation: e.target.checked}})} />
                      <Label htmlFor="principe_minimisation" className="cursor-pointer">Minimisation des données</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_exactitude" checked={politiqueRGPDData.principes.exactitude} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, exactitude: e.target.checked}})} />
                      <Label htmlFor="principe_exactitude" className="cursor-pointer">Exactitude</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_limit_finalites" checked={politiqueRGPDData.principes.limitationFinalites} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, limitationFinalites: e.target.checked}})} />
                      <Label htmlFor="principe_limit_finalites" className="cursor-pointer">Limitation des finalités</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_limit_conservation" checked={politiqueRGPDData.principes.limitationConservation} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, limitationConservation: e.target.checked}})} />
                      <Label htmlFor="principe_limit_conservation" className="cursor-pointer">Limitation de la conservation</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_integrite" checked={politiqueRGPDData.principes.integriteConfidentialite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, integriteConfidentialite: e.target.checked}})} />
                      <Label htmlFor="principe_integrite" className="cursor-pointer">Intégrité & confidentialité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="principe_responsabilite" checked={politiqueRGPDData.principes.responsabilite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, principes: {...politiqueRGPDData.principes, responsabilite: e.target.checked}})} />
                      <Label htmlFor="principe_responsabilite" className="cursor-pointer">Responsabilité (accountability)</Label>
                    </div>
                  </div>
                </div>

                {/* 5. TYPES DE DONNÉES TRAITÉES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📊 Types de données traitées par l'organisation</h4>
                  
                  <h5 className="font-medium text-gray-700 mt-4">A. Données des clients</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_clients_identite" checked={politiqueRGPDData.typesDonnees.clientsIdentite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, clientsIdentite: e.target.checked}})} />
                      <Label htmlFor="donnees_clients_identite" className="cursor-pointer">Identité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_clients_coordonnees" checked={politiqueRGPDData.typesDonnees.clientsCoordonnees} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, clientsCoordonnees: e.target.checked}})} />
                      <Label htmlFor="donnees_clients_coordonnees" className="cursor-pointer">Coordonnées</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_clients_contrats" checked={politiqueRGPDData.typesDonnees.clientsDocumentsContractuels} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, clientsDocumentsContractuels: e.target.checked}})} />
                      <Label htmlFor="donnees_clients_contrats" className="cursor-pointer">Documents contractuels</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_clients_kyc" checked={politiqueRGPDData.typesDonnees.clientsVerificationIdentite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, clientsVerificationIdentite: e.target.checked}})} />
                      <Label htmlFor="donnees_clients_kyc" className="cursor-pointer">Vérification identité (KYC)</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_clients_suivi" checked={politiqueRGPDData.typesDonnees.clientsSuiviDemandes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, clientsSuiviDemandes: e.target.checked}})} />
                      <Label htmlFor="donnees_clients_suivi" className="cursor-pointer">Suivi demandes/dossiers</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">B. Données des employés</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_employes_identite" checked={politiqueRGPDData.typesDonnees.employesIdentite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, employesIdentite: e.target.checked}})} />
                      <Label htmlFor="donnees_employes_identite" className="cursor-pointer">Identité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_employes_rh" checked={politiqueRGPDData.typesDonnees.employesDossierRH} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, employesDossierRH: e.target.checked}})} />
                      <Label htmlFor="donnees_employes_rh" className="cursor-pointer">Dossier RH</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_employes_paie" checked={politiqueRGPDData.typesDonnees.employesPaie} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, employesPaie: e.target.checked}})} />
                      <Label htmlFor="donnees_employes_paie" className="cursor-pointer">Paie</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_employes_eval" checked={politiqueRGPDData.typesDonnees.employesEvaluations} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, employesEvaluations: e.target.checked}})} />
                      <Label htmlFor="donnees_employes_eval" className="cursor-pointer">Évaluations</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_employes_absences" checked={politiqueRGPDData.typesDonnees.employesAbsences} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, employesAbsences: e.target.checked}})} />
                      <Label htmlFor="donnees_employes_absences" className="cursor-pointer">Absences/arrêts maladie</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_employes_formations" checked={politiqueRGPDData.typesDonnees.employesFormations} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, employesFormations: e.target.checked}})} />
                      <Label htmlFor="donnees_employes_formations" className="cursor-pointer">Formations</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">C. Données des prospects</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_prospects_comm" checked={politiqueRGPDData.typesDonnees.prospectsInfosCommerciales} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, prospectsInfosCommerciales: e.target.checked}})} />
                      <Label htmlFor="donnees_prospects_comm" className="cursor-pointer">Informations commerciales</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_prospects_histo" checked={politiqueRGPDData.typesDonnees.prospectsHistoriqueProspection} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, prospectsHistoriqueProspection: e.target.checked}})} />
                      <Label htmlFor="donnees_prospects_histo" className="cursor-pointer">Historique de prospection</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">D. Données des partenaires/fournisseurs</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_part_contrats" checked={politiqueRGPDData.typesDonnees.partenairesFournisseursInfosContractuelles} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, partenairesFournisseursInfosContractuelles: e.target.checked}})} />
                      <Label htmlFor="donnees_part_contrats" className="cursor-pointer">Informations contractuelles</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_part_paiements" checked={politiqueRGPDData.typesDonnees.partenairesFournisseursPaiements} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, partenairesFournisseursPaiements: e.target.checked}})} />
                      <Label htmlFor="donnees_part_paiements" className="cursor-pointer">Paiements</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_part_contacts" checked={politiqueRGPDData.typesDonnees.partenairesFournisseursContactsInternes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, partenairesFournisseursContactsInternes: e.target.checked}})} />
                      <Label htmlFor="donnees_part_contacts" className="cursor-pointer">Contacts internes</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">E. Données techniques</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_tech_ip" checked={politiqueRGPDData.typesDonnees.techniquesIP} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, techniquesIP: e.target.checked}})} />
                      <Label htmlFor="donnees_tech_ip" className="cursor-pointer">Adresses IP</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_tech_logs" checked={politiqueRGPDData.typesDonnees.techniquesLogs} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, techniquesLogs: e.target.checked}})} />
                      <Label htmlFor="donnees_tech_logs" className="cursor-pointer">Logs</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_tech_cookies" checked={politiqueRGPDData.typesDonnees.techniquesCookies} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, techniquesCookies: e.target.checked}})} />
                      <Label htmlFor="donnees_tech_cookies" className="cursor-pointer">Cookies</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="donnees_tech_outils" checked={politiqueRGPDData.typesDonnees.techniquesOutilsInternes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, typesDonnees: {...politiqueRGPDData.typesDonnees, techniquesOutilsInternes: e.target.checked}})} />
                      <Label htmlFor="donnees_tech_outils" className="cursor-pointer">Outils internes</Label>
                    </div>
                  </div>
                </div>

                {/* 6. FINALITÉS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🎯 Finalités des traitements</h4>
                  <p className="text-sm text-gray-600">Chaque traitement doit avoir une finalité définie</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_rh" checked={politiqueRGPDData.finalites.gestionRH} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, gestionRH: e.target.checked}})} />
                      <Label htmlFor="finalite_rh" className="cursor-pointer">Gestion RH</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_paies" checked={politiqueRGPDData.finalites.gestionPaies} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, gestionPaies: e.target.checked}})} />
                      <Label htmlFor="finalite_paies" className="cursor-pointer">Gestion des paies</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_client" checked={politiqueRGPDData.finalites.suiviClient} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, suiviClient: e.target.checked}})} />
                      <Label htmlFor="finalite_client" className="cursor-pointer">Suivi client</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_site" checked={politiqueRGPDData.finalites.gestionSiteWeb} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, gestionSiteWeb: e.target.checked}})} />
                      <Label htmlFor="finalite_site" className="cursor-pointer">Gestion du site web</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_facturation" checked={politiqueRGPDData.finalites.facturation} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, facturation: e.target.checked}})} />
                      <Label htmlFor="finalite_facturation" className="cursor-pointer">Facturation</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_contrats" checked={politiqueRGPDData.finalites.contrats} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, contrats: e.target.checked}})} />
                      <Label htmlFor="finalite_contrats" className="cursor-pointer">Contrats</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_marketing" checked={politiqueRGPDData.finalites.marketingProspection} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, marketingProspection: e.target.checked}})} />
                      <Label htmlFor="finalite_marketing" className="cursor-pointer">Marketing/prospection</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_secu" checked={politiqueRGPDData.finalites.securiteInformatique} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, securiteInformatique: e.target.checked}})} />
                      <Label htmlFor="finalite_secu" className="cursor-pointer">Sécurité informatique</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="finalite_acces" checked={politiqueRGPDData.finalites.gestionAccesInternes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, gestionAccesInternes: e.target.checked}})} />
                      <Label htmlFor="finalite_acces" className="cursor-pointer">Gestion des accès internes</Label>
                    </div>
                  </div>
                  
                  <div><Label>Autres finalités personnalisées</Label><Textarea value={politiqueRGPDData.finalites.autresFinalites} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, finalites: {...politiqueRGPDData.finalites, autresFinalites: e.target.value}})} placeholder="Indiquer d'autres finalités spécifiques..." rows={2} /></div>
                </div>

                {/* 7. BASES LÉGALES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">⚖️ Bases légales</h4>
                  <p className="text-sm text-gray-600">Obligatoire pour chaque traitement</p>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="base_contrat" checked={politiqueRGPDData.basesLegales.executionContrat} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, basesLegales: {...politiqueRGPDData.basesLegales, executionContrat: e.target.checked}})} />
                      <Label htmlFor="base_contrat" className="cursor-pointer">Exécution du contrat</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="base_consentement" checked={politiqueRGPDData.basesLegales.consentement} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, basesLegales: {...politiqueRGPDData.basesLegales, consentement: e.target.checked}})} />
                      <Label htmlFor="base_consentement" className="cursor-pointer">Consentement</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="base_obligation" checked={politiqueRGPDData.basesLegales.obligationLegale} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, basesLegales: {...politiqueRGPDData.basesLegales, obligationLegale: e.target.checked}})} />
                      <Label htmlFor="base_obligation" className="cursor-pointer">Obligation légale</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="base_interet" checked={politiqueRGPDData.basesLegales.interetLegitime} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, basesLegales: {...politiqueRGPDData.basesLegales, interetLegitime: e.target.checked}})} />
                      <Label htmlFor="base_interet" className="cursor-pointer">Intérêt légitime</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="base_mission" checked={politiqueRGPDData.basesLegales.missionInteretPublic} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, basesLegales: {...politiqueRGPDData.basesLegales, missionInteretPublic: e.target.checked}})} />
                      <Label htmlFor="base_mission" className="cursor-pointer">Mission d'intérêt public</Label>
                    </div>
                  </div>
                </div>

                {/* 8. DURÉES DE CONSERVATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">⏱️ Durées de conservation (OBLIGATOIRE)</h4>
                  
                  <h5 className="font-medium text-gray-700">Clients</h5>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Données contractuelles</Label><Input value={politiqueRGPDData.dureesConservation.clientsDonneesContractuelles} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, clientsDonneesContractuelles: e.target.value}})} placeholder="Ex: 5 ans" /></div>
                    <div><Label>Factures</Label><Input value={politiqueRGPDData.dureesConservation.clientsFactures} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, clientsFactures: e.target.value}})} placeholder="Ex: 10 ans" /></div>
                    <div className="md:col-span-2"><Label>Dossiers</Label><Input value={politiqueRGPDData.dureesConservation.clientsDossiers} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, clientsDossiers: e.target.value}})} placeholder="Ex: durée relation + 5 ans" /></div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">Employés</h5>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Dossier RH</Label><Input value={politiqueRGPDData.dureesConservation.employesDossierRH} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, employesDossierRH: e.target.value}})} placeholder="Ex: 5 ans" /></div>
                    <div><Label>Paie</Label><Input value={politiqueRGPDData.dureesConservation.employesPaie} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, employesPaie: e.target.value}})} placeholder="Ex: 5 ans" /></div>
                    <div><Label>Candidatures non retenues</Label><Input value={politiqueRGPDData.dureesConservation.employesCandidaturesNonRetenues} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, employesCandidaturesNonRetenues: e.target.value}})} placeholder="Ex: 2 ans" /></div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">Autres</h5>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Prospects</Label><Input value={politiqueRGPDData.dureesConservation.prospects} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, prospects: e.target.value}})} placeholder="Ex: 3 ans après dernier contact" /></div>
                    <div><Label>Logs techniques</Label><Input value={politiqueRGPDData.dureesConservation.logsTechniques} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, logsTechniques: e.target.value}})} placeholder="Ex: 1 an" /></div>
                    <div><Label>Vidéosurveillance (si applicable)</Label><Input value={politiqueRGPDData.dureesConservation.videosurveillance} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, videosurveillance: e.target.value}})} placeholder="Ex: 30 jours" /></div>
                  </div>
                  
                  <div><Label>Autres durées spécifiques</Label><Textarea value={politiqueRGPDData.dureesConservation.autresDurees} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dureesConservation: {...politiqueRGPDData.dureesConservation, autresDurees: e.target.value}})} placeholder="Préciser d'autres durées..." rows={2} /></div>
                </div>

                {/* 9. CATÉGORIES DE DESTINATAIRES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">👥 Catégories de destinataires</h4>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_salaries" checked={politiqueRGPDData.destinataires.salariesHabilites} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, salariesHabilites: e.target.checked}})} />
                      <Label htmlFor="dest_salaries" className="cursor-pointer">Salariés habilités</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_rh" checked={politiqueRGPDData.destinataires.departementRH} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, departementRH: e.target.checked}})} />
                      <Label htmlFor="dest_rh" className="cursor-pointer">Département RH</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_service_client" checked={politiqueRGPDData.destinataires.serviceClient} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, serviceClient: e.target.checked}})} />
                      <Label htmlFor="dest_service_client" className="cursor-pointer">Service client</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_soustraitants" checked={politiqueRGPDData.destinataires.sousTraitants} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, sousTraitants: e.target.checked}})} />
                      <Label htmlFor="dest_soustraitants" className="cursor-pointer">Sous-traitants</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_hebergeurs" checked={politiqueRGPDData.destinataires.hebergeurs} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, hebergeurs: e.target.checked}})} />
                      <Label htmlFor="dest_hebergeurs" className="cursor-pointer">Hébergeurs</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_presta_tech" checked={politiqueRGPDData.destinataires.prestatairiesTechniques} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, prestatairiesTechniques: e.target.checked}})} />
                      <Label htmlFor="dest_presta_tech" className="cursor-pointer">Prestataires techniques</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="dest_autorites" checked={politiqueRGPDData.destinataires.autoritesPubliques} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, autoritesPubliques: e.target.checked}})} />
                      <Label htmlFor="dest_autorites" className="cursor-pointer">Autorités publiques (URSSAF, fisc, etc.)</Label>
                    </div>
                  </div>
                  
                  <div><Label>Autres destinataires</Label><Textarea value={politiqueRGPDData.destinataires.autresDestinataires} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, destinataires: {...politiqueRGPDData.destinataires, autresDestinataires: e.target.value}})} placeholder="Préciser d'autres destinataires..." rows={2} /></div>
                </div>

                {/* 11. TRANSFERTS HORS UE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🌍 Transferts hors Union Européenne</h4>
                  
                  <div className="flex items-center space-x-2">
                    <input type="checkbox" id="transferts_hors_ue" checked={politiqueRGPDData.transfertsHorsUE.presenceTransferts} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, transfertsHorsUE: {...politiqueRGPDData.transfertsHorsUE, presenceTransferts: e.target.checked}})} />
                    <Label htmlFor="transferts_hors_ue" className="cursor-pointer font-semibold">Présence de transferts hors UE</Label>
                  </div>
                  
                  {politiqueRGPDData.transfertsHorsUE.presenceTransferts && (
                    <div className="space-y-4 ml-6">
                      <div><Label>Pays concernés</Label><Input value={politiqueRGPDData.transfertsHorsUE.paysConcernes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, transfertsHorsUE: {...politiqueRGPDData.transfertsHorsUE, paysConcernes: e.target.value}})} placeholder="Ex: États-Unis, Royaume-Uni" /></div>
                      
                      <div className="flex items-center space-x-2">
                        <input type="checkbox" id="scc" checked={politiqueRGPDData.transfertsHorsUE.clausesContractuellesTypes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, transfertsHorsUE: {...politiqueRGPDData.transfertsHorsUE, clausesContractuellesTypes: e.target.checked}})} />
                        <Label htmlFor="scc" className="cursor-pointer">Clauses contractuelles types (SCC)</Label>
                      </div>
                      
                      <div><Label>Niveau d'adéquation</Label><Input value={politiqueRGPDData.transfertsHorsUE.niveauAdequation} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, transfertsHorsUE: {...politiqueRGPDData.transfertsHorsUE, niveauAdequation: e.target.value}})} placeholder="Ex: Suisse, Japon" /></div>
                      
                      <div><Label>Garanties supplémentaires</Label><Textarea value={politiqueRGPDData.transfertsHorsUE.garantiesSupplementaires} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, transfertsHorsUE: {...politiqueRGPDData.transfertsHorsUE, garantiesSupplementaires: e.target.value}})} placeholder="Décrire les garanties..." rows={2} /></div>
                    </div>
                  )}
                </div>

                {/* 12. MESURES TECHNIQUES ET ORGANISATIONNELLES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🔒 Mesures techniques & organisationnelles</h4>
                  
                  <h5 className="font-medium text-gray-700">Mesures techniques</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_chiffrement" checked={politiqueRGPDData.mesures.techniqueChiffrement} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueChiffrement: e.target.checked}})} />
                      <Label htmlFor="mesure_chiffrement" className="cursor-pointer">Chiffrement</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_serveurs" checked={politiqueRGPDData.mesures.techniqueSecurisationServeurs} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueSecurisationServeurs: e.target.checked}})} />
                      <Label htmlFor="mesure_serveurs" className="cursor-pointer">Sécurisation serveurs</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_mdp" checked={politiqueRGPDData.mesures.techniqueMotsDePasseComplexes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueMotsDePasseComplexes: e.target.checked}})} />
                      <Label htmlFor="mesure_mdp" className="cursor-pointer">Mots de passe complexes</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_2fa" checked={politiqueRGPDData.mesures.techniqueDoubleAuthentification} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueDoubleAuthentification: e.target.checked}})} />
                      <Label htmlFor="mesure_2fa" className="cursor-pointer">Double authentification</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_sauvegardes" checked={politiqueRGPDData.mesures.techniqueSauvegardes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueSauvegardes: e.target.checked}})} />
                      <Label htmlFor="mesure_sauvegardes" className="cursor-pointer">Sauvegardes</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_acces" checked={politiqueRGPDData.mesures.techniqueGestionAcces} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueGestionAcces: e.target.checked}})} />
                      <Label htmlFor="mesure_acces" className="cursor-pointer">Gestion des accès</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_vpn" checked={politiqueRGPDData.mesures.techniqueVPNPareFeu} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueVPNPareFeu: e.target.checked}})} />
                      <Label htmlFor="mesure_vpn" className="cursor-pointer">VPN / pare-feu</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mesure_journalisation" checked={politiqueRGPDData.mesures.techniqueJournalisationActions} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, techniqueJournalisationActions: e.target.checked}})} />
                      <Label htmlFor="mesure_journalisation" className="cursor-pointer">Journalisation des actions</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">Mesures organisationnelles</h5>
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="orga_formation" checked={politiqueRGPDData.mesures.orgaFormationEmployes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, orgaFormationEmployes: e.target.checked}})} />
                      <Label htmlFor="orga_formation" className="cursor-pointer">Formation des employés</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="orga_politique_acces" checked={politiqueRGPDData.mesures.orgaPolitiqueAccesParRole} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, orgaPolitiqueAccesParRole: e.target.checked}})} />
                      <Label htmlFor="orga_politique_acces" className="cursor-pointer">Politique d'accès par rôle</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="orga_controle" checked={politiqueRGPDData.mesures.orgaControleSousTraitants} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, orgaControleSousTraitants: e.target.checked}})} />
                      <Label htmlFor="orga_controle" className="cursor-pointer">Contrôle des sous-traitants</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="orga_confid" checked={politiqueRGPDData.mesures.orgaConfidentialiteRenforcee} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, orgaConfidentialiteRenforcee: e.target.checked}})} />
                      <Label htmlFor="orga_confid" className="cursor-pointer">Confidentialité renforcée</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="orga_processus_fuite" checked={politiqueRGPDData.mesures.orgaProcessusFuite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mesures: {...politiqueRGPDData.mesures, orgaProcessusFuite: e.target.checked}})} />
                      <Label htmlFor="orga_processus_fuite" className="cursor-pointer">Processus internes en cas de fuite</Label>
                    </div>
                  </div>
                </div>

                {/* 13. DROITS DES PERSONNES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✋ Droits des personnes</h4>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_acces" checked={politiqueRGPDData.droitsPersonnes.droitAcces} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitAcces: e.target.checked}})} />
                      <Label htmlFor="droit_acces" className="cursor-pointer">Droit d'accès</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_rectif" checked={politiqueRGPDData.droitsPersonnes.droitRectification} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitRectification: e.target.checked}})} />
                      <Label htmlFor="droit_rectif" className="cursor-pointer">Droit de rectification</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_effacement" checked={politiqueRGPDData.droitsPersonnes.droitEffacement} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitEffacement: e.target.checked}})} />
                      <Label htmlFor="droit_effacement" className="cursor-pointer">Droit d'effacement</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_limitation" checked={politiqueRGPDData.droitsPersonnes.droitLimitation} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitLimitation: e.target.checked}})} />
                      <Label htmlFor="droit_limitation" className="cursor-pointer">Droit à la limitation</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_opposition" checked={politiqueRGPDData.droitsPersonnes.droitOpposition} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitOpposition: e.target.checked}})} />
                      <Label htmlFor="droit_opposition" className="cursor-pointer">Droit d'opposition</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_portabilite" checked={politiqueRGPDData.droitsPersonnes.droitPortabilite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitPortabilite: e.target.checked}})} />
                      <Label htmlFor="droit_portabilite" className="cursor-pointer">Droit à la portabilité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_retrait" checked={politiqueRGPDData.droitsPersonnes.droitRetraitConsentement} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitRetraitConsentement: e.target.checked}})} />
                      <Label htmlFor="droit_retrait" className="cursor-pointer">Droit au retrait du consentement</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="droit_postmortem" checked={politiqueRGPDData.droitsPersonnes.droitDirectivesPostMortem} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, droitDirectivesPostMortem: e.target.checked}})} />
                      <Label htmlFor="droit_postmortem" className="cursor-pointer">Droit de définir des directives post-mortem</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-gray-700 mt-4">Modalités</h5>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Email contact</Label><Input type="email" value={politiqueRGPDData.droitsPersonnes.emailContact} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, emailContact: e.target.value}})} placeholder="droits@entreprise.fr" /></div>
                    <div><Label>Délai légal</Label><Input value={politiqueRGPDData.droitsPersonnes.delaiLegal} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, delaiLegal: e.target.value}})} placeholder="1 mois" /></div>
                    <div className="md:col-span-2"><Label>Processus interne</Label><Textarea value={politiqueRGPDData.droitsPersonnes.processusInterne} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, droitsPersonnes: {...politiqueRGPDData.droitsPersonnes, processusInterne: e.target.value}})} placeholder="Décrire le processus de traitement des demandes..." rows={3} /></div>
                  </div>
                </div>

                {/* 14. PROCÉDURE VIOLATION DE DONNÉES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🚨 Procédure de gestion des violations de données</h4>
                  
                  <div><Label>Étapes internes en cas de fuite</Label><Textarea value={politiqueRGPDData.procedureViolation.etapesInternes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, procedureViolation: {...politiqueRGPDData.procedureViolation, etapesInternes: e.target.value}})} placeholder="Décrire les étapes..." rows={3} /></div>
                  
                  <div><Label>Notification CNIL</Label><Input value={politiqueRGPDData.procedureViolation.notificationCNIL} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, procedureViolation: {...politiqueRGPDData.procedureViolation, notificationCNIL: e.target.value}})} placeholder="< 72h" /></div>
                  
                  <div className="space-y-2">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="proc_information" checked={politiqueRGPDData.procedureViolation.informationPersonnesConcernees} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, procedureViolation: {...politiqueRGPDData.procedureViolation, informationPersonnesConcernees: e.target.checked}})} />
                      <Label htmlFor="proc_information" className="cursor-pointer">Information des personnes concernées</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="proc_documentation" checked={politiqueRGPDData.procedureViolation.documentationInterne} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, procedureViolation: {...politiqueRGPDData.procedureViolation, documentationInterne: e.target.checked}})} />
                      <Label htmlFor="proc_documentation" className="cursor-pointer">Documentation interne</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="proc_analyse" checked={politiqueRGPDData.procedureViolation.analyseRisque} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, procedureViolation: {...politiqueRGPDData.procedureViolation, analyseRisque: e.target.checked}})} />
                      <Label htmlFor="proc_analyse" className="cursor-pointer">Analyse du risque</Label>
                    </div>
                  </div>
                  
                  <div><Label>Actions correctives</Label><Textarea value={politiqueRGPDData.procedureViolation.actionsCorrectives} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, procedureViolation: {...politiqueRGPDData.procedureViolation, actionsCorrectives: e.target.value}})} placeholder="Décrire les actions correctives..." rows={2} /></div>
                </div>

                {/* 15. POLITIQUE COOKIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🍪 Politique cookies (annexe)</h4>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="cookies_techniques" checked={politiqueRGPDData.politiqueCookies.cookiesTechniques} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, cookiesTechniques: e.target.checked}})} />
                      <Label htmlFor="cookies_techniques" className="cursor-pointer">Cookies techniques/essentiels</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="cookies_stats" checked={politiqueRGPDData.politiqueCookies.cookiesStatistiques} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, cookiesStatistiques: e.target.checked}})} />
                      <Label htmlFor="cookies_stats" className="cursor-pointer">Cookies statistiques</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="cookies_audience" checked={politiqueRGPDData.politiqueCookies.cookiesMesureAudience} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, cookiesMesureAudience: e.target.checked}})} />
                      <Label htmlFor="cookies_audience" className="cursor-pointer">Cookies mesure d'audience</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="cookies_marketing" checked={politiqueRGPDData.politiqueCookies.cookiesMarketing} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, cookiesMarketing: e.target.checked}})} />
                      <Label htmlFor="cookies_marketing" className="cursor-pointer">Cookies marketing</Label>
                    </div>
                  </div>
                  
                  <div><Label>Durées de conservation des cookies</Label><Input value={politiqueRGPDData.politiqueCookies.dureesConservationCookies} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, dureesConservationCookies: e.target.value}})} placeholder="Ex: 13 mois max pour les cookies non essentiels" /></div>
                  
                  <div className="space-y-2">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="bandeau_consentement" checked={politiqueRGPDData.politiqueCookies.bandeauConsentement} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, bandeauConsentement: e.target.checked}})} />
                      <Label htmlFor="bandeau_consentement" className="cursor-pointer">Bandeau de consentement obligatoire</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="gestion_refus" checked={politiqueRGPDData.politiqueCookies.gestionRefus} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, politiqueCookies: {...politiqueRGPDData.politiqueCookies, gestionRefus: e.target.checked}})} />
                      <Label htmlFor="gestion_refus" className="cursor-pointer">Gestion du refus</Label>
                    </div>
                  </div>
                </div>

                {/* 16. MENTIONS INTERNES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📋 Mentions internes obligatoires</h4>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mention_confid" checked={politiqueRGPDData.mentionsInternes.obligationConfidentialite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mentionsInternes: {...politiqueRGPDData.mentionsInternes, obligationConfidentialite: e.target.checked}})} />
                      <Label htmlFor="mention_confid" className="cursor-pointer">Obligation de confidentialité pour tous les employés</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mention_charte" checked={politiqueRGPDData.mentionsInternes.charteInformatique} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mentionsInternes: {...politiqueRGPDData.mentionsInternes, charteInformatique: e.target.checked}})} />
                      <Label htmlFor="mention_charte" className="cursor-pointer">Charte informatique interne</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mention_outils" checked={politiqueRGPDData.mentionsInternes.interdictionOutilsNonAutorises} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mentionsInternes: {...politiqueRGPDData.mentionsInternes, interdictionOutilsNonAutorises: e.target.checked}})} />
                      <Label htmlFor="mention_outils" className="cursor-pointer">Interdiction d'utiliser des outils non autorisés</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mention_cyber" checked={politiqueRGPDData.mentionsInternes.bonnesPratiquesCybersecurite} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mentionsInternes: {...politiqueRGPDData.mentionsInternes, bonnesPratiquesCybersecurite: e.target.checked}})} />
                      <Label htmlFor="mention_cyber" className="cursor-pointer">Bonnes pratiques cybersécurité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mention_byod" checked={politiqueRGPDData.mentionsInternes.gestionBYOD} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mentionsInternes: {...politiqueRGPDData.mentionsInternes, gestionBYOD: e.target.checked}})} />
                      <Label htmlFor="mention_byod" className="cursor-pointer">Gestion du BYOD (Bring Your Own Device)</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="mention_sortie" checked={politiqueRGPDData.mentionsInternes.proceduresSortieEmploye} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, mentionsInternes: {...politiqueRGPDData.mentionsInternes, proceduresSortieEmploye: e.target.checked}})} />
                      <Label htmlFor="mention_sortie" className="cursor-pointer">Procédures de sortie d'un employé (désactivation accès)</Label>
                    </div>
                  </div>
                </div>

                {/* 17. ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📎 Annexes obligatoires à générer</h4>
                  
                  <div className="grid md:grid-cols-2 gap-3">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_registre" checked={politiqueRGPDData.annexes.registreTraitements} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, registreTraitements: e.target.checked}})} />
                      <Label htmlFor="annexe_registre" className="cursor-pointer">Registre des traitements (format CNIL)</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_soustraitants" checked={politiqueRGPDData.annexes.listeSousTraitants} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, listeSousTraitants: e.target.checked}})} />
                      <Label htmlFor="annexe_soustraitants" className="cursor-pointer">Liste des sous-traitants</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_cookies" checked={politiqueRGPDData.annexes.politiqueCookiesAnnexe} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, politiqueCookiesAnnexe: e.target.checked}})} />
                      <Label htmlFor="annexe_cookies" className="cursor-pointer">Politique cookies</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_charte_info" checked={politiqueRGPDData.annexes.charteInformatiqueAnnexe} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, charteInformatiqueAnnexe: e.target.checked}})} />
                      <Label htmlFor="annexe_charte_info" className="cursor-pointer">Charte informatique</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_modele_droits" checked={politiqueRGPDData.annexes.modeleGestionDroitsRGPD} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, modeleGestionDroitsRGPD: e.target.checked}})} />
                      <Label htmlFor="annexe_modele_droits" className="cursor-pointer">Modèle de gestion des droits RGPD</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_proc_violation" checked={politiqueRGPDData.annexes.procedureViolationDonnees} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, procedureViolationDonnees: e.target.checked}})} />
                      <Label htmlFor="annexe_proc_violation" className="cursor-pointer">Procédure violation de données</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_fiche_sensib" checked={politiqueRGPDData.annexes.ficheSensibilisationEmployes} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, ficheSensibilisationEmployes: e.target.checked}})} />
                      <Label htmlFor="annexe_fiche_sensib" className="cursor-pointer">Fiche sensibilisation employés</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" id="annexe_proc_conservation" checked={politiqueRGPDData.annexes.procedureConservationSuppression} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, annexes: {...politiqueRGPDData.annexes, procedureConservationSuppression: e.target.checked}})} />
                      <Label htmlFor="annexe_proc_conservation" className="cursor-pointer">Procédure conservation/suppression des données</Label>
                    </div>
                  </div>
                </div>

                {/* PIÈCES JUSTIFICATIVES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📎 Pièces justificatives à joindre</h4>
                  
                  <SingleFileUpload 
                    label="Preuve de désignation DPO (si applicable)" 
                    files={politiqueRGPDPreuveDesignationDPOFiles} 
                    onFilesChange={setPolitiqueRGPDPreuveDesignationDPOFiles} 
                    role="avocat"
                    accept="application/pdf"
                  />
                  
                  <SingleFileUpload 
                    label="Contrats de sous-traitance" 
                    files={politiqueRGPDContratsSousTraitanceFiles} 
                    onFilesChange={setPolitiqueRGPDContratsSousTraitanceFiles} 
                    role="avocat"
                    accept="application/pdf"
                  />
                  
                  <SingleFileUpload 
                    label="Attestations de sécurité des prestataires" 
                    files={politiqueRGPDAttestationsSecuriteFiles} 
                    onFilesChange={setPolitiqueRGPDAttestationsSecuriteFiles} 
                    role="avocat"
                    accept="application/pdf"
                  />
                  
                  <SingleFileUpload 
                    label="Documentations internes" 
                    files={politiqueRGPDDocumentationsInternesFiles} 
                    onFilesChange={setPolitiqueRGPDDocumentationsInternesFiles} 
                    role="avocat"
                    accept="application/pdf"
                  />
                </div>

                {/* SIGNATURE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">✍️ Date et lieu d'élaboration</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Ville d'élaboration</Label><Input value={politiqueRGPDData.villeElaboration} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, villeElaboration: e.target.value})} placeholder="Ex: Paris" /></div>
                    <div><Label>Date d'élaboration</Label><Input type="date" value={politiqueRGPDData.dateElaboration} onChange={(e) => setPolitiqueRGPDData({...politiqueRGPDData, dateElaboration: e.target.value})} /></div>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire Testament */}
            {pendingContractType === "Testament authentique ou mystique" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Sélecteur de type de testament */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Quel type de testament souhaitez-vous rédiger ?</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de testament <span className="text-red-500">*</span></Label>
                      <Select
                        value={testamentData.typeTestament || undefined}
                        onValueChange={(value) => setTestamentData({...testamentData, typeTestament: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le type de testament..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="authentique">Testament authentique (dicté au notaire)</SelectItem>
                          <SelectItem value="mystique">Testament mystique (cacheté et remis au notaire)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  {/* Testament authentique - STRUCTURE COMPLÈTE */}
                  {testamentData.typeTestament === "authentique" && (
                    <div className="space-y-6">
                      
                      {/* Informations générales */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur le testament</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-gray-50/50 border-gray-300">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Type de testament <span className="text-red-500">*</span></Label>
                              <Input value="Testament authentique (dicté au notaire)" disabled className="bg-gray-100" />
                            </div>

                            <div className="space-y-2">
                              <Label>Caractère du testament <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentAuthentique.caractere || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, caractere: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="initial">Testament initial</SelectItem>
                                  <SelectItem value="modificatif">Testament modificatif</SelectItem>
                                  <SelectItem value="revocatoire">Testament révocatoire</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Date souhaitée de rédaction</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentAuthentique.dateSouhaitee}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, dateSouhaitee: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Langue comprise par le testateur <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.langueTestateur || undefined}
                                onValueChange={(value) => setTestamentData({...testamentData, langueTestateur: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="francais">Français</SelectItem>
                                  <SelectItem value="anglais">Anglais</SelectItem>
                                  <SelectItem value="espagnol">Espagnol</SelectItem>
                                  <SelectItem value="italien">Italien</SelectItem>
                                  <SelectItem value="allemand">Allemand</SelectItem>
                                  <SelectItem value="portugais">Portugais</SelectItem>
                                  <SelectItem value="arabe">Arabe</SelectItem>
                                  <SelectItem value="autre">Autre langue</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            {testamentData.langueTestateur === "autre" && (
                              <div className="space-y-2 md:col-span-2">
                                <Label>Préciser la langue <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.autreLangue}
                                  onChange={(e) => setTestamentData({...testamentData, autreLangue: e.target.value})}
                                  placeholder="Ex: Mandarin, Russe, etc."
                                />
                              </div>
                            )}
                          </div>

                          {/* Testament antérieur */}
                          <div className="border-t pt-4 space-y-3">
                            <h4 className="font-medium">Testament antérieur existant ?</h4>
                            <div className="flex items-center space-x-4">
                              <label className="flex items-center space-x-2 cursor-pointer">
                                <input
                                  type="radio"
                                  name="testamentAnterieur"
                                  checked={testamentData.testamentAnterieur === true}
                                  onChange={() => setTestamentData({...testamentData, testamentAnterieur: true})}
                                  className="w-4 h-4"
                                />
                                <span>Oui</span>
                              </label>
                              <label className="flex items-center space-x-2 cursor-pointer">
                                <input
                                  type="radio"
                                  name="testamentAnterieur"
                                  checked={testamentData.testamentAnterieur === false}
                                  onChange={() => setTestamentData({...testamentData, testamentAnterieur: false})}
                                  className="w-4 h-4"
                                />
                                <span>Non</span>
                              </label>
                            </div>

                            {testamentData.testamentAnterieur && (
                              <div className="ml-6 p-3 bg-yellow-50 rounded-lg border border-yellow-300 space-y-3">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                  <div className="space-y-2">
                                    <Label>Date du précédent testament</Label>
                                    <Input
                                      type="date"
                                      value={testamentData.testamentAnterieurDate}
                                      onChange={(e) => setTestamentData({...testamentData, testamentAnterieurDate: e.target.value})}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Type du précédent testament</Label>
                                    <Select
                                      value={testamentData.testamentAnterieurType || undefined}
                                      onValueChange={(value) => setTestamentData({...testamentData, testamentAnterieurType: value})}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="authentique">Testament authentique</SelectItem>
                                        <SelectItem value="mystique">Testament mystique</SelectItem>
                                        <SelectItem value="olographe">Testament olographe</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Notaire dépositaire (si connu)</Label>
                                    <Input
                                      value={testamentData.testamentAnterieurNotaire}
                                      onChange={(e) => setTestamentData({...testamentData, testamentAnterieurNotaire: e.target.value})}
                                      placeholder="Nom et adresse du notaire"
                                    />
                                  </div>
                                </div>
                              </div>
                            )}
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="interprete"
                              checked={testamentData.interpreteNecessaire}
                              onChange={(e) => setTestamentData({...testamentData, interpreteNecessaire: e.target.checked})}
                            />
                            <label htmlFor="interprete" className="text-sm cursor-pointer font-medium">
                              Recours à un interprète nécessaire
                            </label>
                          </div>

                          {testamentData.interpreteNecessaire && (
                            <div className="ml-6 p-3 bg-white rounded-lg space-y-3 border border-purple-300">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-2">
                                  <Label>Nom de l'interprète <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteNom}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteNom: e.target.value})}
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Langue traduite <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteLangueTraduite}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteLangueTraduite: e.target.value})}
                                    placeholder="Ex: Arabe vers Français"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Attestation de fidélité <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteAttestationFidelite}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteAttestationFidelite: e.target.value})}
                                    placeholder="Référence attestation assermentée"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Signature de l'interprète <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteSignature}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteSignature: e.target.value})}
                                    placeholder="Mention de signature"
                                  />
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Identité testateur */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Identité complète du testateur</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-white border-blue-300">
                          <div className="space-y-2">
                            <Label>Sélectionner un client (optionnel)</Label>
                            <Select
                              value={testamentData.clientId || undefined}
                              onValueChange={(value) => setTestamentData({...testamentData, clientId: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                              <SelectContent>
                                {/* Ici on mappera les clients réels */}
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testateurNom}
                                onChange={(e) => setTestamentData({...testamentData, testateurNom: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Prénom <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testateurPrenom}
                                onChange={(e) => setTestamentData({...testamentData, testateurPrenom: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Nom de naissance</Label>
                              <Input
                                value={testamentData.testateurNomNaissance}
                                onChange={(e) => setTestamentData({...testamentData, testateurNomNaissance: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Date de naissance <span className="text-red-500">*</span></Label>
                              <Input
                                type="date"
                                value={testamentData.testateurDateNaissance}
                                onChange={(e) => setTestamentData({...testamentData, testateurDateNaissance: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Lieu de naissance</Label>
                              <Input
                                value={testamentData.testateurLieuNaissance}
                                onChange={(e) => setTestamentData({...testamentData, testateurLieuNaissance: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Nationalité</Label>
                              <Input
                                value={testamentData.testateurNationalite}
                                onChange={(e) => setTestamentData({...testamentData, testateurNationalite: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Profession</Label>
                              <Input
                                value={testamentData.testateurProfession}
                                onChange={(e) => setTestamentData({...testamentData, testateurProfession: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Situation familiale <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testateurSituationFamiliale || undefined}
                                onValueChange={(value) => setTestamentData({...testamentData, testateurSituationFamiliale: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="celibataire">Célibataire</SelectItem>
                                  <SelectItem value="marie">Marié(e)</SelectItem>
                                  <SelectItem value="pacse">Pacsé(e)</SelectItem>
                                  <SelectItem value="concubinage">Concubinage</SelectItem>
                                  <SelectItem value="divorce">Divorcé(e)</SelectItem>
                                  <SelectItem value="veuf">Veuf(ve)</SelectItem>
                                  <SelectItem value="separe">Séparé(e)</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse complète <span className="text-red-500">*</span></Label>
                            <Input
                              value={testamentData.testateurAdresse}
                              onChange={(e) => setTestamentData({...testamentData, testateurAdresse: e.target.value})}
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Téléphone</Label>
                              <Input
                                value={testamentData.testateurTelephone}
                                onChange={(e) => setTestamentData({...testamentData, testateurTelephone: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Email</Label>
                              <Input
                                type="email"
                                value={testamentData.testateurEmail}
                                onChange={(e) => setTestamentData({...testamentData, testateurEmail: e.target.value})}
                              />
                            </div>
                          </div>

                          {/* Pièce d'identité */}
                          <div className="border-t pt-3 space-y-3">
                            <h4 className="font-medium">Pièce d'identité</h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Type</Label>
                                <Select
                                  value={testamentData.testateurPieceType || undefined}
                                  onValueChange={(value) => setTestamentData({...testamentData, testateurPieceType: value})}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="cni">Carte Nationale d'Identité</SelectItem>
                                    <SelectItem value="passeport">Passeport</SelectItem>
                                    <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                              <div className="space-y-2">
                                <Label>Numéro</Label>
                                <Input
                                  value={testamentData.testateurPieceNumero}
                                  onChange={(e) => setTestamentData({...testamentData, testateurPieceNumero: e.target.value})}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Autorité de délivrance</Label>
                                <Input
                                  value={testamentData.testateurPieceAutorite}
                                  onChange={(e) => setTestamentData({...testamentData, testateurPieceAutorite: e.target.value})}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Date d'expiration</Label>
                                <Input
                                  type="date"
                                  value={testamentData.testateurPieceExpiration}
                                  onChange={(e) => setTestamentData({...testamentData, testateurPieceExpiration: e.target.value})}
                                />
                              </div>
                            </div>
                          </div>

                          {/* Capacité juridique */}
                          <div className="border-t pt-3 space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="capacite_juridique"
                                checked={testamentData.capaciteJuridiqueConfirmee}
                                onChange={(e) => setTestamentData({...testamentData, capaciteJuridiqueConfirmee: e.target.checked})}
                              />
                              <label htmlFor="capacite_juridique" className="text-sm cursor-pointer font-medium">
                                <span className="text-red-500">*</span> Capacité juridique confirmée
                              </label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="sous_protection"
                                checked={testamentData.sousTutelleCuratelle}
                                onChange={(e) => setTestamentData({...testamentData, sousTutelleCuratelle: e.target.checked})}
                              />
                              <label htmlFor="sous_protection" className="text-sm cursor-pointer">
                                Sous tutelle / curatelle
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Héritiers réservataires */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Héritiers réservataires (personnes protégées par la loi)</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-green-50/50 border-green-300">
                          
                          {/* Enfants */}
                          <div className="space-y-3">
                            <h4 className="font-medium">Enfants du testateur</h4>
                            {testamentData.heritiersReservataires.enfants.map((enfant, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                  <Input
                                    placeholder="Nom"
                                    value={enfant.nom}
                                    onChange={(e) => {
                                      const newEnfants = [...testamentData.heritiersReservataires.enfants];
                                      newEnfants[index].nom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                      });
                                    }}
                                  />
                                  <Input
                                    placeholder="Prénom"
                                    value={enfant.prenom}
                                    onChange={(e) => {
                                      const newEnfants = [...testamentData.heritiersReservataires.enfants];
                                      newEnfants[index].prenom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                      });
                                    }}
                                  />
                                  <Input
                                    type="date"
                                    placeholder="Date de naissance"
                                    value={enfant.dateNaissance}
                                    onChange={(e) => {
                                      const newEnfants = [...testamentData.heritiersReservataires.enfants];
                                      newEnfants[index].dateNaissance = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                      });
                                    }}
                                  />
                                </div>
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newEnfants = testamentData.heritiersReservataires.enfants.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  heritiersReservataires: {
                                    ...testamentData.heritiersReservataires,
                                    enfants: [...testamentData.heritiersReservataires.enfants, {nom: "", prenom: "", dateNaissance: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un enfant
                            </Button>
                          </div>

                          {/* Descendants */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Descendants (petits-enfants, arrière-petits-enfants...)</h4>
                            {testamentData.heritiersReservataires.descendants.map((desc, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                  <Input
                                    placeholder="Nom"
                                    value={desc.nom}
                                    onChange={(e) => {
                                      const newDesc = [...testamentData.heritiersReservataires.descendants];
                                      newDesc[index].nom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                      });
                                    }}
                                  />
                                  <Input
                                    placeholder="Prénom"
                                    value={desc.prenom}
                                    onChange={(e) => {
                                      const newDesc = [...testamentData.heritiersReservataires.descendants];
                                      newDesc[index].prenom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                      });
                                    }}
                                  />
                                  <Input
                                    placeholder="Lien (ex: petit-fils de...)"
                                    value={desc.lien}
                                    onChange={(e) => {
                                      const newDesc = [...testamentData.heritiersReservataires.descendants];
                                      newDesc[index].lien = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                      });
                                    }}
                                  />
                                </div>
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newDesc = testamentData.heritiersReservataires.descendants.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  heritiersReservataires: {
                                    ...testamentData.heritiersReservataires,
                                    descendants: [...testamentData.heritiersReservataires.descendants, {nom: "", prenom: "", lien: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un descendant
                            </Button>
                          </div>

                          {/* Parents */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Parents du testateur (père et mère)</h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Nom et prénom du père</Label>
                                <Input
                                  value={testamentData.heritiersReservataires.nomPrenomPere}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, nomPrenomPere: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Nom et prénom de la mère</Label>
                                <Input
                                  value={testamentData.heritiersReservataires.nomPrenomMere}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, nomPrenomMere: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Père vivant ?</Label>
                                <Select
                                  value={testamentData.heritiersReservataires.pereVivant}
                                  onValueChange={(value) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, pereVivant: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                    <SelectItem value="inconnu">Inconnu</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                              <div className="space-y-2">
                                <Label>Mère vivante ?</Label>
                                <Select
                                  value={testamentData.heritiersReservataires.mereVivante}
                                  onValueChange={(value) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, mereVivante: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                    <SelectItem value="inconnu">Inconnu</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Légataires */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Légataires (bénéficiaires du testament)</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-purple-50/50 border-purple-300">
                          <p className="text-sm text-gray-600">Personnes ou entités désignées pour recevoir des biens</p>
                          
                          {testamentData.legataires.map((legataire, index) => (
                            <div key={index} className="p-3 bg-white rounded-lg border space-y-3">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <Input
                                  placeholder="Nom / Dénomination"
                                  value={legataire.nom}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].nom = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                                <Input
                                  placeholder="Prénom (si personne physique)"
                                  value={legataire.prenom}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].prenom = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                                <Input
                                  placeholder="Lien avec le testateur"
                                  value={legataire.lien}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].lien = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                                <Input
                                  placeholder="Adresse complète"
                                  value={legataire.adresse}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].adresse = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                              </div>
                              <Button
                                type="button"
                                variant="destructive"
                                size="sm"
                                onClick={() => {
                                  const newLegataires = testamentData.legataires.filter((_, i) => i !== index);
                                  setTestamentData({...testamentData, legataires: newLegataires});
                                }}
                              >
                                Supprimer
                              </Button>
                            </div>
                          ))}
                          
                          <Button
                            type="button"
                            onClick={() => {
                              setTestamentData({
                                ...testamentData,
                                legataires: [...testamentData.legataires, {nom: "", prenom: "", lien: "", adresse: ""}]
                              });
                            }}
                            className="bg-orange-500 hover:bg-orange-600"
                          >
                            + Ajouter un légataire
                          </Button>
                        </div>
                      </div>

                      {/* Dispositions testamentaires */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Dispositions testamentaires</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-yellow-50/50 border-yellow-300">
                          
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="legs_universel"
                              checked={testamentData.dispositions.legsUniversel}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, legsUniversel: e.target.checked}
                              })}
                            />
                            <label htmlFor="legs_universel" className="text-sm cursor-pointer font-medium">
                              Legs universel (totalité du patrimoine)
                            </label>
                          </div>

                          {testamentData.dispositions.legsUniversel && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du legs universel..."
                                value={testamentData.dispositions.detailsLegsUniversel}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsLegsUniversel: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="legs_titre_universel"
                              checked={testamentData.dispositions.legsTitreUniversel}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, legsTitreUniversel: e.target.checked}
                              })}
                            />
                            <label htmlFor="legs_titre_universel" className="text-sm cursor-pointer font-medium">
                              Legs à titre universel (quote-part ou catégorie de biens)
                            </label>
                          </div>

                          {testamentData.dispositions.legsTitreUniversel && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du legs à titre universel..."
                                value={testamentData.dispositions.detailsLegsTitreUniversel}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsLegsTitreUniversel: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="legs_particuliers"
                                checked={testamentData.dispositions.legsParticuliers}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, legsParticuliers: e.target.checked}
                                })}
                              />
                              <label htmlFor="legs_particuliers" className="text-sm cursor-pointer font-medium">
                                Legs particuliers (biens déterminés)
                              </label>
                            </div>

                            {testamentData.dispositions.legsParticuliers && (
                              <div className="ml-6 space-y-3">
                                {testamentData.dispositions.listeLegsParticuliers.map((legs, index) => (
                                  <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                    <Input
                                      placeholder="Description du bien"
                                      value={legs.description}
                                      onChange={(e) => {
                                        const newLegs = [...testamentData.dispositions.listeLegsParticuliers];
                                        newLegs[index].description = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          dispositions: {...testamentData.dispositions, listeLegsParticuliers: newLegs}
                                        });
                                      }}
                                    />
                                    <Input
                                      placeholder="Bénéficiaire"
                                      value={legs.beneficiaire}
                                      onChange={(e) => {
                                        const newLegs = [...testamentData.dispositions.listeLegsParticuliers];
                                        newLegs[index].beneficiaire = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          dispositions: {...testamentData.dispositions, listeLegsParticuliers: newLegs}
                                        });
                                      }}
                                    />
                                    <Button
                                      type="button"
                                      variant="destructive"
                                      size="sm"
                                      onClick={() => {
                                        const newLegs = testamentData.dispositions.listeLegsParticuliers.filter((_, i) => i !== index);
                                        setTestamentData({
                                          ...testamentData,
                                          dispositions: {...testamentData.dispositions, listeLegsParticuliers: newLegs}
                                        });
                                      }}
                                    >
                                      Supprimer
                                    </Button>
                                  </div>
                                ))}
                                <Button
                                  type="button"
                                  onClick={() => {
                                    setTestamentData({
                                      ...testamentData,
                                      dispositions: {
                                        ...testamentData.dispositions,
                                        listeLegsParticuliers: [...testamentData.dispositions.listeLegsParticuliers, {description: "", beneficiaire: ""}]
                                      }
                                    });
                                  }}
                                  className="bg-orange-500 hover:bg-orange-600"
                                >
                                  + Ajouter un legs particulier
                                </Button>
                              </div>
                            )}
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="charges_conditions"
                              checked={testamentData.dispositions.chargesConditions}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, chargesConditions: e.target.checked}
                              })}
                            />
                            <label htmlFor="charges_conditions" className="text-sm cursor-pointer font-medium">
                              Charges et conditions
                            </label>
                          </div>

                          {testamentData.dispositions.chargesConditions && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails des charges et conditions..."
                                value={testamentData.dispositions.detailsChargesConditions}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsChargesConditions: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="demembrement"
                              checked={testamentData.dispositions.demembrement}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, demembrement: e.target.checked}
                              })}
                            />
                            <label htmlFor="demembrement" className="text-sm cursor-pointer font-medium">
                              Démembrement de propriété (usufruit / nue-propriété)
                            </label>
                          </div>

                          {testamentData.dispositions.demembrement && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du démembrement..."
                                value={testamentData.dispositions.detailsDemembrement}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsDemembrement: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="droit_retour"
                              checked={testamentData.dispositions.droitRetour}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, droitRetour: e.target.checked}
                              })}
                            />
                            <label htmlFor="droit_retour" className="text-sm cursor-pointer font-medium">
                              Clause de droit de retour
                            </label>
                          </div>

                          {testamentData.dispositions.droitRetour && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du droit de retour..."
                                value={testamentData.dispositions.detailsDroitRetour}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsDroitRetour: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="exheredation"
                              checked={testamentData.dispositions.exheredation}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, exheredation: e.target.checked}
                              })}
                            />
                            <label htmlFor="exheredation" className="text-sm cursor-pointer font-medium">
                              Exhérédation (dans la limite de la quotité disponible)
                            </label>
                          </div>

                          {testamentData.dispositions.exheredation && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails de l'exhérédation..."
                                value={testamentData.dispositions.detailsExheredation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsExheredation: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="executeur_testamentaire"
                              checked={testamentData.dispositions.executeurTestamentaire}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, executeurTestamentaire: e.target.checked}
                              })}
                            />
                            <label htmlFor="executeur_testamentaire" className="text-sm cursor-pointer font-medium">
                              Désignation d'un exécuteur testamentaire
                            </label>
                          </div>

                          {testamentData.dispositions.executeurTestamentaire && (
                            <div className="ml-6 p-3 bg-white rounded-lg space-y-2">
                              <Input
                                placeholder="Nom et prénom de l'exécuteur"
                                value={testamentData.dispositions.nomExecuteur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, nomExecuteur: e.target.value}
                                })}
                              />
                              <Input
                                placeholder="Adresse de l'exécuteur"
                                value={testamentData.dispositions.adresseExecuteur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, adresseExecuteur: e.target.value}
                                })}
                              />
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Patrimoine */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Description du patrimoine du testateur</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-orange-50/50 border-orange-300">
                          
                          {/* Biens immobiliers */}
                          <div className="space-y-3">
                            <h4 className="font-medium">Biens immobiliers</h4>
                            {testamentData.patrimoine.immobiliers.map((bien, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Adresse du bien"
                                  value={bien.adresse}
                                  onChange={(e) => {
                                    const newBiens = [...testamentData.patrimoine.immobiliers];
                                    newBiens[index].adresse = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Type (maison, appartement, terrain...)"
                                  value={bien.type}
                                  onChange={(e) => {
                                    const newBiens = [...testamentData.patrimoine.immobiliers];
                                    newBiens[index].type = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Valeur estimée (€)"
                                  value={bien.valeur}
                                  onChange={(e) => {
                                    const newBiens = [...testamentData.patrimoine.immobiliers];
                                    newBiens[index].valeur = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newBiens = testamentData.patrimoine.immobiliers.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    immobiliers: [...testamentData.patrimoine.immobiliers, {adresse: "", type: "", valeur: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un bien immobilier
                            </Button>
                          </div>

                          {/* Avoirs financiers */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Avoirs financiers (comptes, placements)</h4>
                            {testamentData.patrimoine.avoirsFinanciers.map((avoir, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Type (compte courant, livret, assurance-vie...)"
                                  value={avoir.type}
                                  onChange={(e) => {
                                    const newAvoirs = [...testamentData.patrimoine.avoirsFinanciers];
                                    newAvoirs[index].type = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Établissement"
                                  value={avoir.etablissement}
                                  onChange={(e) => {
                                    const newAvoirs = [...testamentData.patrimoine.avoirsFinanciers];
                                    newAvoirs[index].etablissement = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Montant estimé (€)"
                                  value={avoir.montant}
                                  onChange={(e) => {
                                    const newAvoirs = [...testamentData.patrimoine.avoirsFinanciers];
                                    newAvoirs[index].montant = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newAvoirs = testamentData.patrimoine.avoirsFinanciers.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    avoirsFinanciers: [...testamentData.patrimoine.avoirsFinanciers, {type: "", etablissement: "", montant: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un avoir financier
                            </Button>
                          </div>

                          {/* Biens meubles */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Biens meubles (véhicules, œuvres d'art, bijoux...)</h4>
                            {testamentData.patrimoine.biensMeubles.map((meuble, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Description"
                                  value={meuble.description}
                                  onChange={(e) => {
                                    const newMeubles = [...testamentData.patrimoine.biensMeubles];
                                    newMeubles[index].description = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, biensMeubles: newMeubles}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Valeur estimée (€)"
                                  value={meuble.valeur}
                                  onChange={(e) => {
                                    const newMeubles = [...testamentData.patrimoine.biensMeubles];
                                    newMeubles[index].valeur = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, biensMeubles: newMeubles}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newMeubles = testamentData.patrimoine.biensMeubles.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, biensMeubles: newMeubles}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    biensMeubles: [...testamentData.patrimoine.biensMeubles, {description: "", valeur: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un bien meuble
                            </Button>
                          </div>

                          {/* Parts sociales */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Parts sociales / actions</h4>
                            {testamentData.patrimoine.partsSociales.map((parts, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Société"
                                  value={parts.societe}
                                  onChange={(e) => {
                                    const newParts = [...testamentData.patrimoine.partsSociales];
                                    newParts[index].societe = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Nombre de parts/actions"
                                  value={parts.nombre}
                                  onChange={(e) => {
                                    const newParts = [...testamentData.patrimoine.partsSociales];
                                    newParts[index].nombre = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Valeur estimée (€)"
                                  value={parts.valeur}
                                  onChange={(e) => {
                                    const newParts = [...testamentData.patrimoine.partsSociales];
                                    newParts[index].valeur = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newParts = testamentData.patrimoine.partsSociales.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    partsSociales: [...testamentData.patrimoine.partsSociales, {societe: "", nombre: "", valeur: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter des parts sociales
                            </Button>
                          </div>
                        </div>
                      </div>

                      {/* Régime matrimonial détaillé */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Régime matrimonial du testateur</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-purple-50/50 border-purple-300">
                          <p className="text-sm text-gray-600">Informations sur le régime matrimonial (utile pour l'automatisation et le contrôle notarial)</p>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nature du régime matrimonial</Label>
                              <Select
                                value={testamentData.regimeMatrimonial.nature || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, nature: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="legal">Régime légal (communauté réduite aux acquêts)</SelectItem>
                                  <SelectItem value="separation">Séparation de biens</SelectItem>
                                  <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                                  <SelectItem value="participation">Participation aux acquêts</SelectItem>
                                  <SelectItem value="autre">Autre régime</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Date du contrat de mariage</Label>
                              <Input
                                type="date"
                                value={testamentData.regimeMatrimonial.contratMariage}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, contratMariage: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Notaire ayant reçu le contrat</Label>
                              <Input
                                value={testamentData.regimeMatrimonial.notaireContrat}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, notaireContrat: e.target.value}
                                })}
                                placeholder="Nom et office du notaire"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Biens propres (description sommaire)</Label>
                              <textarea
                                className="w-full p-2 border rounded-md"
                                rows={2}
                                value={testamentData.regimeMatrimonial.biensPropres}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, biensPropres: e.target.value}
                                })}
                                placeholder="Ex: Biens acquis avant mariage, donations, successions..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Biens communs (description sommaire)</Label>
                              <textarea
                                className="w-full p-2 border rounded-md"
                                rows={2}
                                value={testamentData.regimeMatrimonial.biensCommuns}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, biensCommuns: e.target.value}
                                })}
                                placeholder="Ex: Résidence principale, comptes joints..."
                              />
                            </div>
                          </div>

                          <div className="border-t pt-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="preciput"
                                checked={testamentData.regimeMatrimonial.preciput}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, preciput: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="preciput" className="cursor-pointer">Clause de préciput présente dans le contrat</Label>
                            </div>

                            {testamentData.regimeMatrimonial.preciput && (
                              <div className="ml-6 mt-3">
                                <Label>Détails du préciput</Label>
                                <textarea
                                  className="w-full p-2 border rounded-md mt-2"
                                  rows={2}
                                  value={testamentData.regimeMatrimonial.detailsPreciput}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    regimeMatrimonial: {...testamentData.regimeMatrimonial, detailsPreciput: e.target.value}
                                  })}
                                  placeholder="Préciser les biens concernés par le préciput..."
                                />
                              </div>
                            )}
                          </div>
                        </div>
                      </div>

                      {/* Formalités spécifiques */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Formalités spécifiques - Testament authentique</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-white border-blue-300">
                        {/* Notaire */}
                        <div className="space-y-3">
                          <h4 className="font-medium">Notaire instrumentaire</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom du notaire <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentAuthentique.notaireNom}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, notaireNom: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Office notarial <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentAuthentique.notaireOffice}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, notaireOffice: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Adresse complète de l'office</Label>
                              <Input
                                value={testamentData.testamentAuthentique.notaireAdresse}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, notaireAdresse: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Modalités réception - DOIT ÊTRE EN PREMIER */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                          <h4 className="font-medium">Mode de réception du testament <span className="text-red-500">*</span></h4>
                          <p className="text-sm text-gray-600 mb-2">Choisissez la modalité de réception (ce choix conditionne le reste du formulaire)</p>
                          <div className="space-y-2">
                            <Label>Testament reçu par <span className="text-red-500">*</span></Label>
                            <Select
                              value={testamentData.testamentAuthentique.modaliteReception || undefined}
                              onValueChange={(value) => setTestamentData({
                                ...testamentData,
                                testamentAuthentique: {...testamentData.testamentAuthentique, modaliteReception: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner le mode de réception..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="1notaire_2temoins">1 notaire + 2 témoins</SelectItem>
                                <SelectItem value="2notaires">2 notaires (sans témoins)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                            <div className="space-y-2">
                              <Label>Lieu de réception <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentAuthentique.lieuReception}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, lieuReception: e.target.value}
                                })}
                                placeholder="Ex: Office notarial, domicile du testateur..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de réception</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentAuthentique.dateReception}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, dateReception: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Témoins (conditionnels selon modalité) */}
                        {testamentData.testamentAuthentique.modaliteReception === "1notaire_2temoins" && (
                          <div className="space-y-3">
                            <div className="flex justify-between items-center">
                              <h4 className="font-medium">Témoins (2 témoins obligatoires) <span className="text-red-500">*</span></h4>
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                onClick={() => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {
                                    ...testamentData.testamentAuthentique,
                                    temoins: [...testamentData.testamentAuthentique.temoins, {
                                      nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", nationalite: "", 
                                      profession: "", adresse: "", lienAvecTestateur: "",
                                      nonHeritier: false, nonLegataire: false, nonConjoint: false, 
                                      nonParentJusque4eDegre: false, capaciteJuridique: false, 
                                      comprendLangue: false, agitLibrement: false, signature: false
                                    }]
                                  }
                                })}
                              >
                                + Ajouter un témoin
                              </Button>
                            </div>

                            {testamentData.testamentAuthentique.temoins.map((temoin, idx) => (
                              <div key={idx} className="p-4 bg-white rounded-lg space-y-3 border-2 border-gray-200">
                                <div className="flex justify-between">
                                  <h5 className="text-sm font-medium">Témoin {idx + 1}</h5>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    onClick={() => {
                                      const newTemoins = testamentData.testamentAuthentique.temoins.filter((_, i) => i !== idx);
                                      setTestamentData({
                                        ...testamentData,
                                        testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                      });
                                    }}
                                  >
                                    🗑️
                                  </Button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                  <div className="space-y-2">
                                    <Label>Nom <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.nom}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].nom = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Prénom <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.prenom}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].prenom = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Date de naissance <span className="text-red-500">*</span></Label>
                                    <Input
                                      type="date"
                                      value={temoin.dateNaissance}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].dateNaissance = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Lieu de naissance</Label>
                                    <Input
                                      value={temoin.lieuNaissance}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].lieuNaissance = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Nationalité <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.nationalite}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].nationalite = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                      placeholder="Ex: Française"
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Profession</Label>
                                    <Input
                                      value={temoin.profession}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].profession = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Lien avec le testateur <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.lienAvecTestateur}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].lienAvecTestateur = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                      placeholder="Ex: Aucun lien"
                                    />
                                  </div>

                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Adresse complète <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.adresse}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].adresse = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>
                                </div>

                                {/* Déclarations légales (CONDITIONS DE VALIDITÉ) */}
                                <div className="mt-3 p-3 bg-red-50 rounded-lg border border-red-200">
                                  <p className="text-sm font-medium mb-2 text-red-700">Déclarations légales - CONDITIONS DE VALIDITÉ <span className="text-red-500">*</span></p>
                                  <div className="space-y-2">
                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_nonHeritier`}
                                        checked={temoin.nonHeritier}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].nonHeritier = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_nonHeritier`} className="cursor-pointer text-sm">Le témoin n'est ni héritier ni légataire</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_nonConjoint`}
                                        checked={temoin.nonConjoint}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].nonConjoint = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_nonConjoint`} className="cursor-pointer text-sm">Le témoin n'est ni conjoint, ni parent jusqu'au 4ᵉ degré</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_capacite`}
                                        checked={temoin.capaciteJuridique}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].capaciteJuridique = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_capacite`} className="cursor-pointer text-sm">Le témoin a la capacité juridique</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_langue`}
                                        checked={temoin.comprendLangue}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].comprendLangue = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_langue`} className="cursor-pointer text-sm">Le témoin comprend la langue utilisée</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_libre`}
                                        checked={temoin.agitLibrement}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].agitLibrement = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_libre`} className="cursor-pointer text-sm">Le témoin agit librement et sans contrainte</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_signature`}
                                        checked={temoin.signature}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].signature = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_signature`} className="cursor-pointer text-sm">Signature du témoin</Label>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Second notaire (conditionnel si modalité = 2 notaires) */}
                        {testamentData.testamentAuthentique.modaliteReception === "2notaires" && (
                          <div className="space-y-3 p-3 bg-blue-100 rounded-lg border border-blue-300">
                            <h4 className="font-medium">Second notaire <span className="text-red-500">*</span></h4>
                            <p className="text-sm text-gray-600">Obligatoire pour la modalité "2 notaires"</p>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Nom du 2ᵉ notaire <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentAuthentique.secondNotaireNom}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, secondNotaireNom: e.target.value}
                                  })}
                                  placeholder="M./Mme Nom Prénom"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Office notarial <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentAuthentique.secondNotaireOffice}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, secondNotaireOffice: e.target.value}
                                  })}
                                  placeholder="Nom de l'office"
                                />
                              </div>

                              <div className="space-y-2 md:col-span-2">
                                <Label>Adresse de l'office</Label>
                                <Input
                                  value={testamentData.testamentAuthentique.secondNotaireAdresse}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, secondNotaireAdresse: e.target.value}
                                  })}
                                  placeholder="Adresse complète"
                                />
                              </div>
                            </div>
                          </div>
                        )}

                        {/* Formalités légales */}
                        <div className="space-y-3 p-3 bg-red-50 rounded-lg border border-red-300">
                          <h4 className="font-medium">Formalités légales <span className="text-red-500">*</span></h4>
                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="dicte"
                                checked={testamentData.testamentAuthentique.formaliteDicte}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, formaliteDicte: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="dicte" className="cursor-pointer">Testament dicté par le testateur au notaire</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="relu"
                                checked={testamentData.testamentAuthentique.formaliteRelu}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, formaliteRelu: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="relu" className="cursor-pointer">Lecture intégrale par le notaire au testateur</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="approbation"
                                checked={testamentData.testamentAuthentique.declarationApprobation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, declarationApprobation: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="approbation" className="cursor-pointer">Déclaration d'approbation expresse du testateur</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="signe"
                                checked={testamentData.testamentAuthentique.formaliteSigne}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, formaliteSigne: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="signe" className="cursor-pointer">Signatures : testateur + notaire(s) + témoins (le cas échéant)</Label>
                            </div>

                            <div className="flex items-center space-x-2 ml-6">
                              <input
                                type="checkbox"
                                id="impossibilite"
                                checked={testamentData.testamentAuthentique.impossibiliteSigner}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, impossibiliteSigner: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="impossibilite" className="cursor-pointer text-sm">Impossibilité de signer (mention requise)</Label>
                            </div>

                            {testamentData.testamentAuthentique.impossibiliteSigner && (
                              <div className="ml-6 space-y-2">
                                <Label>Motif de l'impossibilité <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentAuthentique.motifImpossibilite}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, motifImpossibilite: e.target.value}
                                  })}
                                  placeholder="Ex: Impossibilité physique, handicap..."
                                />
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Inscription FCDDV */}
                        <div className="space-y-3 p-3 bg-green-50 rounded-lg border border-green-300">
                          <h4 className="font-medium">Inscription au FCDDV</h4>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="fcddv"
                              checked={testamentData.testamentAuthentique.inscriptionFCDDV}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentAuthentique: {...testamentData.testamentAuthentique, inscriptionFCDDV: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="fcddv" className="cursor-pointer">Procéder à l'inscription au FCDDV</Label>
                          </div>

                          {testamentData.testamentAuthentique.inscriptionFCDDV && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Date d'inscription</Label>
                                <Input
                                  type="date"
                                  value={testamentData.testamentAuthentique.dateInscriptionFCDDV}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, dateInscriptionFCDDV: e.target.value}
                                  })}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Notaire dépositaire</Label>
                                <Input
                                  value={testamentData.testamentAuthentique.notaireDepositaire}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, notaireDepositaire: e.target.value}
                                  })}
                                  placeholder="Nom du notaire dépositaire"
                                />
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>

                    {/* Mentions légales */}
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Mentions légales et rappels</h3>
                      <div className="p-4 border-2 rounded-lg space-y-3 bg-red-50/50 border-red-300">
                        
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="rappel_reserve"
                            checked={testamentData.mentionsLegales.rappelReserveHereditaire}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, rappelReserveHereditaire: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="rappel_reserve" className="cursor-pointer font-medium">
                            <span className="text-red-500">*</span> Rappel de la réserve héréditaire (art. 912-916 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="rappel_quotite"
                            checked={testamentData.mentionsLegales.rappelQuotiteDisponible}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, rappelQuotiteDisponible: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="rappel_quotite" className="cursor-pointer font-medium">
                            <span className="text-red-500">*</span> Rappel de la quotité disponible
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="testament_revocable"
                            checked={testamentData.mentionsLegales.testamentRevocable}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, testamentRevocable: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="testament_revocable" className="cursor-pointer font-medium">
                            <span className="text-red-500">*</span> Testament révocable à tout moment (art. 895 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="indignite"
                            checked={testamentData.mentionsLegales.casIndignite}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, casIndignite: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="indignite" className="cursor-pointer">
                            Mention des cas d'indignité successorale (art. 726-728 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="capacite_legataires"
                            checked={testamentData.mentionsLegales.verificationCapaciteLegataires}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, verificationCapaciteLegataires: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="capacite_legataires" className="cursor-pointer">
                            Vérification capacité des légataires à recevoir
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="droits_reduction"
                            checked={testamentData.mentionsLegales.droitsReduction}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, droitsReduction: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="droits_reduction" className="cursor-pointer">
                            Mention des droits de réduction (art. 920-930 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="regime_fiscal"
                            checked={testamentData.mentionsLegales.regimeFiscalSuccessions}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, regimeFiscalSuccessions: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="regime_fiscal" className="cursor-pointer">
                            Information sur le régime fiscal des successions
                          </Label>
                        </div>
                      </div>
                    </div>

                    {/* Documents obligatoires */}
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Documents obligatoires à collecter</h3>
                      <div className="p-4 border-2 rounded-lg space-y-5 bg-indigo-50/50 border-indigo-300">
                        
                        {/* Documents du testateur */}
                        <div className="space-y-3">
                          <h4 className="font-medium text-indigo-900">Documents du testateur</h4>
                          <div className="space-y-2">
                            <Label>Pièce d'identité du testateur (CNI, passeport)</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("pieceIdentiteTestateur")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.pieceIdentiteTestateur ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.pieceIdentiteTestateur ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.pieceIdentiteTestateur ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.pieceIdentiteTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.pieceIdentiteTestateur || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Livret de famille</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("livretFamilleTestateur")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.livretFamilleTestateur ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.livretFamilleTestateur ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.livretFamilleTestateur ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.livretFamilleTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.livretFamilleTestateur || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Certificat de capacité juridique / jugement tutelle-curatelle (si applicable)</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("certificatCapaciteTestateur")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.certificatCapaciteTestateur ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.certificatCapaciteTestateur ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.certificatCapaciteTestateur ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.certificatCapaciteTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.certificatCapaciteTestateur || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>
                        </div>

                        {/* Documents des témoins */}
                        <div className="space-y-3 border-t pt-4">
                          <h4 className="font-medium text-indigo-900">Documents des témoins</h4>
                          <div className="space-y-2">
                            <Label>Pièces d'identité des témoins</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("piecesIdentiteTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.piecesIdentiteTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.piecesIdentiteTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.piecesIdentiteTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.piecesIdentiteTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.piecesIdentiteTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Justificatifs de domicile des témoins</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("justificatifsDomicileTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.justificatifsDomicileTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.justificatifsDomicileTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.justificatifsDomicileTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.justificatifsDomicileTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.justificatifsDomicileTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Attestations sur l'honneur capacité témoins</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("attestationsCapaciteTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.attestationsCapaciteTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.attestationsCapaciteTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.attestationsCapaciteTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.attestationsCapaciteTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.attestationsCapaciteTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Casiers judiciaires des témoins (extrait n°3)</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("casiersJudiciairesTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.casiersJudiciairesTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.casiersJudiciairesTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.casiersJudiciairesTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.casiersJudiciairesTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.casiersJudiciairesTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>
                        </div>

                        {/* Documents patrimoniaux */}
                        <div className="space-y-3 border-t pt-4">
                          <h4 className="font-medium text-indigo-900">Documents patrimoniaux</h4>
                          <div className="space-y-2">
                            <Label>Titres de propriété immobiliers</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("titresPropriete")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.titresPropriete ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.titresPropriete ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.titresPropriete ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.titresPropriete ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.titresPropriete || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Relevés bancaires et comptes</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("relevesBancaires")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.relevesBancaires ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.relevesBancaires ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.relevesBancaires ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.relevesBancaires ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.relevesBancaires || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Contrat de mariage / régime matrimonial</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("contratMariage")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.contratMariage ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.contratMariage ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.contratMariage ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.contratMariage ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.contratMariage || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Autres justificatifs patrimoniaux</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("autresJustificatifs")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.autresJustificatifs ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.autresJustificatifs ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.autresJustificatifs ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.autresJustificatifs ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.autresJustificatifs || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  )}

                  {/* 9. Testament mystique spécifique */}
                  {testamentData.typeTestament === "mystique" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Formalités spécifiques - Testament mystique</h3>
                      
                      <div className="p-4 border-2 rounded-lg space-y-4 bg-purple-50/50 border-purple-300">
                        
                        {/* Testament antérieur (même section que pour authentique) */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                          <h4 className="font-medium">Testament antérieur existant ?</h4>
                          <p className="text-sm text-gray-600">Bonne pratique notariale (non obligatoire)</p>
                          <div className="flex items-center space-x-4">
                            <label className="flex items-center space-x-2 cursor-pointer">
                              <input
                                type="radio"
                                name="testamentAnterieurMystique"
                                checked={testamentData.testamentAnterieur === true}
                                onChange={() => setTestamentData({...testamentData, testamentAnterieur: true})}
                                className="w-4 h-4"
                              />
                              <span>Oui</span>
                            </label>
                            <label className="flex items-center space-x-2 cursor-pointer">
                              <input
                                type="radio"
                                name="testamentAnterieurMystique"
                                checked={testamentData.testamentAnterieur === false}
                                onChange={() => setTestamentData({...testamentData, testamentAnterieur: false})}
                                className="w-4 h-4"
                              />
                              <span>Non</span>
                            </label>
                          </div>

                          {testamentData.testamentAnterieur && (
                            <div className="ml-6 p-3 bg-white rounded-lg border border-yellow-300 space-y-3">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-2">
                                  <Label>Date du précédent testament</Label>
                                  <Input
                                    type="date"
                                    value={testamentData.testamentAnterieurDate}
                                    onChange={(e) => setTestamentData({...testamentData, testamentAnterieurDate: e.target.value})}
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Type du précédent testament</Label>
                                  <Select
                                    value={testamentData.testamentAnterieurType || undefined}
                                    onValueChange={(value) => setTestamentData({...testamentData, testamentAnterieurType: value})}
                                  >
                                    <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                    <SelectContent>
                                      <SelectItem value="authentique">Testament authentique</SelectItem>
                                      <SelectItem value="mystique">Testament mystique</SelectItem>
                                      <SelectItem value="olographe">Testament olographe</SelectItem>
                                    </SelectContent>
                                  </Select>
                                </div>
                                <div className="space-y-2 md:col-span-2">
                                  <Label>Notaire dépositaire (si connu)</Label>
                                  <Input
                                    value={testamentData.testamentAnterieurNotaire}
                                    onChange={(e) => setTestamentData({...testamentData, testamentAnterieurNotaire: e.target.value})}
                                    placeholder="Nom et adresse du notaire"
                                  />
                                </div>
                              </div>
                            </div>
                          )}
                        </div>

                        {/* Rédaction */}
                        <div className="space-y-3 p-3 bg-white rounded-lg border border-purple-200">
                          <h4 className="font-medium">Mode de rédaction du testament <span className="text-red-500">*</span></h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Rédigé par <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentMystique.redactionPar || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, redactionPar: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="testateur">Le testateur lui-même</SelectItem>
                                  <SelectItem value="tiers">Un tiers</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            {testamentData.testamentMystique.redactionPar === "tiers" && (
                              <div className="space-y-2">
                                <Label>Nom du rédacteur <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentMystique.nomRedacteur}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, nomRedacteur: e.target.value}
                                  })}
                                  placeholder="Nom et prénom du rédacteur"
                                />
                              </div>
                            )}

                            <div className="space-y-2">
                              <Label>Type d'écriture <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentMystique.typeEcriture || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, typeEcriture: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="manuscrit">Manuscrit (à la main)</SelectItem>
                                  <SelectItem value="dactylographie">Dactylographié</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Langue du testament <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentMystique.langueTestament || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, langueTestament: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="francais">Français</SelectItem>
                                  <SelectItem value="autre">Autre langue</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Nombre de pages</Label>
                              <Input
                                type="number"
                                value={testamentData.testamentMystique.nombrePages}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, nombrePages: e.target.value}
                                })}
                                placeholder="Nombre de pages"
                              />
                            </div>
                          </div>
                        </div>

                        {/* Présentation sous pli fermé */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                          <h4 className="font-medium">Présentation sous pli fermé et scellé <span className="text-red-500">*</span></h4>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="cachete"
                              checked={testamentData.testamentMystique.cachete}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, cachete: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="cachete" className="cursor-pointer">Pli fermé, cacheté et scellé</Label>
                          </div>

                          <div className="space-y-2">
                            <Label>Description du scellé <span className="text-red-500">*</span></Label>
                            <Input
                              value={testamentData.testamentMystique.descriptionScelle}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, descriptionScelle: e.target.value}
                              })}
                              placeholder="Ex: Enveloppe cachetée avec cire rouge..."
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Lieu de présentation <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentMystique.lieuPresentation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, lieuPresentation: e.target.value}
                                })}
                                placeholder="Ex: Office notarial..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de présentation</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentMystique.datePresentation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, datePresentation: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Notaire */}
                        <div className="space-y-3 p-3 bg-white rounded-lg border border-purple-200">
                          <h4 className="font-medium">Notaire récepteur <span className="text-red-500">*</span></h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom du notaire <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentMystique.notaireNom}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, notaireNom: e.target.value}
                                })}
                                placeholder="M./Mme Nom Prénom"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Office notarial <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentMystique.notaireOffice}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, notaireOffice: e.target.value}
                                })}
                                placeholder="Nom de l'office"
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Adresse de l'office</Label>
                              <Input
                                value={testamentData.testamentMystique.notaireAdresse}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, notaireAdresse: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Témoins (2 obligatoires) */}
                        <div className="space-y-3 p-3 bg-white rounded-lg border border-purple-200">
                          <div className="flex justify-between items-center">
                            <h4 className="font-medium">Témoins (2 témoins obligatoires) <span className="text-red-500">*</span></h4>
                            <Button
                              type="button"
                              size="sm"
                              className="bg-orange-600 hover:bg-orange-700 text-white"
                              onClick={() => setTestamentData({
                                ...testamentData,
                                testamentMystique: {
                                  ...testamentData.testamentMystique,
                                  temoins: [...testamentData.testamentMystique.temoins, {
                                    nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", nationalite: "",
                                    profession: "", adresse: "", lienAvecTestateur: "",
                                    nonHeritier: false, nonLegataire: false, nonConjoint: false,
                                    nonParentJusque4eDegre: false, capaciteJuridique: false,
                                    comprendLangue: false, agitLibrement: false, signature: false
                                  }]
                                }
                              })}
                            >
                              + Ajouter un témoin
                            </Button>
                          </div>

                          {testamentData.testamentMystique.temoins.map((temoin, idx) => (
                            <div key={idx} className="p-4 bg-purple-50 rounded-lg space-y-3 border-2 border-purple-300">
                              <div className="flex justify-between">
                                <h5 className="text-sm font-medium">Témoin {idx + 1}</h5>
                                <Button
                                  type="button"
                                  variant="ghost"
                                  size="sm"
                                  onClick={() => {
                                    const newTemoins = testamentData.testamentMystique.temoins.filter((_, i) => i !== idx);
                                    setTestamentData({
                                      ...testamentData,
                                      testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                    });
                                  }}
                                >
                                  🗑️
                                </Button>
                              </div>

                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label>Nom <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.nom}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].nom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Prénom <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.prenom}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].prenom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Date de naissance <span className="text-red-500">*</span></Label>
                                  <Input
                                    type="date"
                                    value={temoin.dateNaissance}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].dateNaissance = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Lieu de naissance</Label>
                                  <Input
                                    value={temoin.lieuNaissance}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].lieuNaissance = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Nationalité <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.nationalite}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].nationalite = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                    placeholder="Ex: Française"
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Profession</Label>
                                  <Input
                                    value={temoin.profession}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].profession = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Lien avec le testateur <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.lienAvecTestateur}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].lienAvecTestateur = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                    placeholder="Ex: Aucun lien"
                                  />
                                </div>

                                <div className="space-y-2 md:col-span-2">
                                  <Label>Adresse complète <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.adresse}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].adresse = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>
                              </div>

                              {/* Déclarations légales */}
                              <div className="mt-3 p-3 bg-red-50 rounded-lg border border-red-200">
                                <p className="text-sm font-medium mb-2 text-red-700">Déclarations légales - CONDITIONS DE VALIDITÉ <span className="text-red-500">*</span></p>
                                <div className="space-y-2">
                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_nonHeritier`}
                                      checked={temoin.nonHeritier}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].nonHeritier = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_nonHeritier`} className="cursor-pointer text-sm">Le témoin n'est ni héritier ni légataire</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_nonConjoint`}
                                      checked={temoin.nonConjoint}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].nonConjoint = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_nonConjoint`} className="cursor-pointer text-sm">Le témoin n'est ni conjoint, ni parent jusqu'au 4ᵉ degré</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_capacite`}
                                      checked={temoin.capaciteJuridique}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].capaciteJuridique = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_capacite`} className="cursor-pointer text-sm">Le témoin a la capacité juridique</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_langue`}
                                      checked={temoin.comprendLangue}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].comprendLangue = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_langue`} className="cursor-pointer text-sm">Le témoin comprend la langue utilisée</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_libre`}
                                      checked={temoin.agitLibrement}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].agitLibrement = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_libre`} className="cursor-pointer text-sm">Le témoin agit librement et sans contrainte</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_signature`}
                                      checked={temoin.signature}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].signature = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_signature`} className="cursor-pointer text-sm">Signature du témoin</Label>
                                  </div>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>

                        {/* Déclarations obligatoires art. 976 C. civ. */}
                        <div className="space-y-3 p-3 bg-red-50 rounded-lg border-2 border-red-400">
                          <h4 className="font-medium text-red-700">🔴 Déclarations obligatoires (art. 976 C. civ.) <span className="text-red-500">*</span></h4>
                          <p className="text-sm text-red-600 mb-3">Sans ces déclarations → Risque de nullité du testament</p>
                          
                          <div className="space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="testateurSaitLireEcrire"
                                checked={testamentData.testamentMystique.testateurSaitLireEcrire}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, testateurSaitLireEcrire: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="testateurSaitLireEcrire" className="cursor-pointer font-medium text-red-700">
                                <span className="text-red-500">*</span> Le testateur déclare savoir lire et écrire (OBLIGATOIRE)
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="testateurReconnaitTestament"
                                checked={testamentData.testamentMystique.testateurReconnaitTestament}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, testateurReconnaitTestament: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="testateurReconnaitTestament" className="cursor-pointer font-medium text-red-700">
                                <span className="text-red-500">*</span> Le testateur reconnaît que le testament contenu dans le pli est bien le sien
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="pliNonOuvert"
                                checked={testamentData.testamentMystique.pliNonOuvert}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, pliNonOuvert: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="pliNonOuvert" className="cursor-pointer font-medium text-red-700">
                                <span className="text-red-500">*</span> Le pli n'a pas été ouvert par le notaire (le notaire ne connaît pas le contenu)
                              </Label>
                            </div>
                          </div>
                        </div>

                        {/* Conditions légales témoins (sécurisation) */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-400">
                          <h4 className="font-medium text-yellow-800">🟡 Conditions légales des témoins (ultra-sécurisant)</h4>
                          <p className="text-sm text-yellow-700 mb-3">Recommandé pour sécurisation maximale</p>
                          
                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="temoinsMajeurs"
                                checked={testamentData.testamentMystique.temoinsMajeurs}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, temoinsMajeurs: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="temoinsMajeurs" className="cursor-pointer">☐ Témoins majeurs</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="temoinsNonHeritiersLegataires"
                                checked={testamentData.testamentMystique.temoinsNonHeritiersLegataires}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, temoinsNonHeritiersLegataires: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="temoinsNonHeritiersLegataires" className="cursor-pointer">☐ Témoins non héritiers, non légataires</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="temoinsSaventLireEcrire"
                                checked={testamentData.testamentMystique.temoinsSaventLireEcrire}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, temoinsSaventLireEcrire: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="temoinsSaventLireEcrire" className="cursor-pointer">☐ Témoins sachant lire et écrire</Label>
                            </div>
                          </div>
                        </div>

                        {/* Acte de suscription */}
                        <div className="space-y-3 p-3 bg-blue-50 rounded-lg border border-blue-300">
                          <h4 className="font-medium">Acte de suscription <span className="text-red-500">*</span></h4>
                          <div className="flex items-center space-x-2 mb-3">
                            <input
                              type="checkbox"
                              id="declarationContenu"
                              checked={testamentData.testamentMystique.declarationContenuTestament}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, declarationContenuTestament: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="declarationContenu" className="cursor-pointer">Déclaration que le pli contient le testament</Label>
                          </div>

                          <div className="space-y-2">
                            <Label>Texte de la suscription</Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={testamentData.testamentMystique.suscription}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, suscription: e.target.value}
                              })}
                              placeholder="Texte de l'acte de suscription..."
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Lieu de suscription</Label>
                              <Input
                                value={testamentData.testamentMystique.lieuSuscription}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, lieuSuscription: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de suscription</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentMystique.dateSuscription}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, dateSuscription: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Inscription FCDDV */}
                        <div className="space-y-3 p-3 bg-green-50 rounded-lg border border-green-300">
                          <h4 className="font-medium">Inscription au FCDDV</h4>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="fcddv_mystique"
                              checked={testamentData.testamentMystique.inscriptionFCDDV}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, inscriptionFCDDV: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="fcddv_mystique" className="cursor-pointer">Procéder à l'inscription au FCDDV</Label>
                          </div>

                          {testamentData.testamentMystique.inscriptionFCDDV && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Date d'inscription</Label>
                                <Input
                                  type="date"
                                  value={testamentData.testamentMystique.dateInscriptionFCDDV}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, dateInscriptionFCDDV: e.target.value}
                                  })}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Notaire dépositaire</Label>
                                <Input
                                  value={testamentData.testamentMystique.notaireDepositaire}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, notaireDepositaire: e.target.value}
                                  })}
                                  placeholder="Nom du notaire dépositaire"
                                />
                              </div>
                            </div>
                          )}
                        </div>

                        {/* Présence simultanée et Signatures */}
                        <div className="space-y-3 p-3 bg-orange-50 rounded-lg border border-orange-300">
                          <h4 className="font-medium">Présence simultanée et Signatures <span className="text-red-500">*</span></h4>
                          
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="presenceSimultanee"
                              checked={testamentData.testamentMystique.presenceSimultanee}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, presenceSimultanee: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="presenceSimultanee" className="cursor-pointer text-red-700 font-medium">Présence simultanée du testateur, du notaire et des témoins lors de la suscription</Label>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="signatureTestateur"
                                checked={testamentData.testamentMystique.signatureTestateur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, signatureTestateur: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="signatureTestateur" className="cursor-pointer">Signature du testateur</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="signatureNotaire"
                                checked={testamentData.testamentMystique.signatureNotaire}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, signatureNotaire: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="signatureNotaire" className="cursor-pointer">Signature du notaire</Label>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="impossibiliteSignerTestateur"
                                checked={testamentData.testamentMystique.impossibiliteSignerTestateur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, impossibiliteSignerTestateur: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="impossibiliteSignerTestateur" className="cursor-pointer">Impossibilité de signer pour le testateur</Label>
                            </div>

                            {testamentData.testamentMystique.impossibiliteSignerTestateur && (
                              <div className="ml-6">
                                <Label>Motif de l'impossibilité <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentMystique.motifImpossibiliteSignature}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, motifImpossibiliteSignature: e.target.value}
                                  })}
                                  placeholder="Ex: Handicap physique, maladie..."
                                />
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 10. Mentions légales obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Mentions légales et rappels</h3>
                    
                    <div className="p-4 border rounded-lg space-y-3 bg-gray-50/50">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_reserve"
                          checked={testamentData.mentionsLegales.rappelReserveHereditaire}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, rappelReserveHereditaire: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_reserve" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Rappel de la réserve héréditaire (art. 912-916 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_quotite"
                          checked={testamentData.mentionsLegales.rappelQuotiteDisponible}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, rappelQuotiteDisponible: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_quotite" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Rappel de la quotité disponible
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_revocabilite"
                          checked={testamentData.mentionsLegales.revocabilite}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, revocabilite: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_revocabilite" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Testament révocable à tout moment (art. 895 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_indignite"
                          checked={testamentData.mentionsLegales.indigniteSuccessorale}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, indigniteSuccessorale: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_indignite" className="text-sm cursor-pointer">
                          Mention des cas d'indignité successorale (art. 726-728 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_capacite"
                          checked={testamentData.mentionsLegales.capaciteLegataires}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, capaciteLegataires: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_capacite" className="text-sm cursor-pointer">
                          Vérification capacité des légataires à recevoir
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_reduction"
                          checked={testamentData.mentionsLegales.droitsReduction}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, droitsReduction: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_reduction" className="text-sm cursor-pointer">
                          Mention des droits de réduction (art. 920-930 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_fiscal"
                          checked={testamentData.mentionsLegales.regimeFiscal}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, regimeFiscal: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_fiscal" className="text-sm cursor-pointer">
                          Information sur le régime fiscal des successions
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* 11. Documents à collecter */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Documents obligatoires à collecter</h3>
                    
                    {/* Testateur */}
                    <div className="space-y-3 p-4 border rounded-lg bg-blue-50/30">
                      <h4 className="font-medium">Documents du testateur</h4>
                      
                      <MultiFileUpload
                        label="Pièce d'identité du testateur (CNI, passeport)"
                        files={testamentIdentiteTestateur}
                        onFilesChange={setTestamentIdentiteTestateur}
                      />

                      <MultiFileUpload
                        label="Livret de famille"
                        files={testamentLivretFamille}
                        onFilesChange={setTestamentLivretFamille}
                      />

                      <MultiFileUpload
                        label="Certificat de capacité juridique / jugement tutelle-curatelle (si applicable)"
                        files={testamentCapaciteJuridique}
                        onFilesChange={setTestamentCapaciteJuridique}
                      />
                    </div>

                    {/* Témoins */}
                    <div className="space-y-3 p-4 border rounded-lg bg-purple-50/30">
                      <h4 className="font-medium">Documents des témoins</h4>
                      
                      <MultiFileUpload
                        label="Pièces d'identité des témoins"
                        files={testamentIdentiteTemoins}
                        onFilesChange={setTestamentIdentiteTemoins}
                      />

                      <MultiFileUpload
                        label="Justificatifs de domicile des témoins"
                        files={testamentDomicileTemoins}
                        onFilesChange={setTestamentDomicileTemoins}
                      />

                      <MultiFileUpload
                        label="Attestations sur l'honneur capacité témoins"
                        files={testamentAttestationsTemoins}
                        onFilesChange={setTestamentAttestationsTemoins}
                      />

                      <MultiFileUpload
                        label="Casiers judiciaires des témoins (extrait n°3)"
                        files={testamentCasiersTemoins}
                        onFilesChange={setTestamentCasiersTemoins}
                      />
                    </div>

                    {/* Patrimoine */}
                    <div className="space-y-3 p-4 border rounded-lg bg-orange-50/30">
                      <h4 className="font-medium">Documents patrimoniaux</h4>
                      
                      <MultiFileUpload
                        label="Titres de propriété immobiliers"
                        files={testamentTitresPropriete}
                        onFilesChange={setTestamentTitresPropriete}
                      />

                      <MultiFileUpload
                        label="Relevés bancaires et comptes"
                        files={testamentRelevesBancaires}
                        onFilesChange={setTestamentRelevesBancaires}
                      />

                      <MultiFileUpload
                        label="Contrat de mariage / régime matrimonial"
                        files={testamentContratMariage}
                        onFilesChange={setTestamentContratMariage}
                      />

                      <MultiFileUpload
                        label="Autres justificatifs patrimoniaux"
                        files={testamentAutresJustificatifs}
                        onFilesChange={setTestamentAutresJustificatifs}
                      />
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire Changement de Régime Matrimonial */}
            {pendingContractType === "Changement de régime matrimonial" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Section 1: Informations générales */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur l'opération</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de modification souhaitée <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.typeModification || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, typeModification: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le type..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="separation_biens">Passage à la séparation de biens</SelectItem>
                          <SelectItem value="communaute_reduite">Passage à la communauté réduite aux acquêts</SelectItem>
                          <SelectItem value="communaute_universelle">Passage à la communauté universelle</SelectItem>
                          <SelectItem value="participation_acquets">Passage à la participation aux acquêts</SelectItem>
                          <SelectItem value="modification_actuel">Modification / aménagement du régime actuel</SelectItem>
                          <SelectItem value="ajout_clauses">Clauses ajoutées au régime actuel</SelectItem>
                          <SelectItem value="adoption_contrat">Adoption d'un contrat de mariage pour la première fois</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Régime matrimonial actuel <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.regimeActuel || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, regimeActuel: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le régime actuel..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                          <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                          <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                          <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                          <SelectItem value="autre">Autre</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {changementRegimeData.regimeActuel === "autre" && (
                      <div className="space-y-2">
                        <Label>Préciser le régime actuel</Label>
                        <Input
                          value={changementRegimeData.regimeActuelAutre}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, regimeActuelAutre: e.target.value})}
                          placeholder="Précisez..."
                        />
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Date du mariage <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={changementRegimeData.dateMariage}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, dateMariage: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu du mariage <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.lieuMariage}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, lieuMariage: e.target.value})}
                          placeholder="Ville, pays..."
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="contratMariageInitial"
                          checked={changementRegimeData.contratMariageInitial}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, contratMariageInitial: e.target.checked})}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="contratMariageInitial">Existence d'un contrat de mariage initial (joindre copie si oui)</Label>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Nouveau régime matrimonial souhaité <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.nouveauRegimeSouhaite || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, nouveauRegimeSouhaite: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le nouveau régime..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="communaute_reduite">Communauté réduite aux acquêts</SelectItem>
                          <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                          <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                          <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Date d'effet souhaitée</Label>
                      <Input
                        type="date"
                        value={changementRegimeData.dateEffetSouhaitee}
                        onChange={(e) => setChangementRegimeData({...changementRegimeData, dateEffetSouhaitee: e.target.value})}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Motif principal du changement <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.motifChangement || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, motifChangement: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le motif..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="protection_conjoint">Protection du conjoint</SelectItem>
                          <SelectItem value="activite_professionnelle">Activité professionnelle</SelectItem>
                          <SelectItem value="anticipation_successorale">Anticipation successorale</SelectItem>
                          <SelectItem value="simplification_patrimoniale">Simplification patrimoniale</SelectItem>
                          <SelectItem value="autre">Autre</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {changementRegimeData.motifChangement === "autre" && (
                      <div className="space-y-2">
                        <Label>Préciser le motif</Label>
                        <Input
                          value={changementRegimeData.motifChangementAutre}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, motifChangementAutre: e.target.value})}
                          placeholder="Précisez le motif du changement..."
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 1bis: Présence d'enfants */}
                  <div className="space-y-4 p-4 border rounded-lg bg-yellow-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Présence d'enfants</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsCommuns"
                            checked={changementRegimeData.presenceEnfants.enfantsCommuns}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsCommuns: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsCommuns">Enfants communs</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsAutreUnion"
                            checked={changementRegimeData.presenceEnfants.enfantsAutreUnion}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsAutreUnion: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsAutreUnion">Enfants d'une autre union</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsMineurs"
                            checked={changementRegimeData.presenceEnfants.enfantsMineurs}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsMineurs: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsMineurs">Présence d'enfants mineurs</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsMajeursInformes"
                            checked={changementRegimeData.presenceEnfants.enfantsMajeursInformes}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsMajeursInformes: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsMajeursInformes">Enfants majeurs informés</Label>
                        </div>
                      </div>
                    </div>

                    {changementRegimeData.presenceEnfants.enfantsCommuns && (
                      <div className="space-y-2">
                        <Label>Nombre d'enfants communs</Label>
                        <Input
                          type="number"
                          min="0"
                          value={changementRegimeData.presenceEnfants.nombreEnfantsCommuns}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            presenceEnfants: {...changementRegimeData.presenceEnfants, nombreEnfantsCommuns: e.target.value}
                          })}
                        />
                      </div>
                    )}

                    {changementRegimeData.presenceEnfants.enfantsAutreUnion && (
                      <div className="space-y-2">
                        <Label>Nombre d'enfants d'une autre union</Label>
                        <Input
                          type="number"
                          min="0"
                          value={changementRegimeData.presenceEnfants.nombreEnfantsAutreUnion}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            presenceEnfants: {...changementRegimeData.presenceEnfants, nombreEnfantsAutreUnion: e.target.value}
                          })}
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 1ter: Opposition possible des tiers */}
                  <div className="space-y-4 p-4 border rounded-lg bg-red-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Opposition possible des tiers</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="creanciersConnus"
                            checked={changementRegimeData.oppositionTiers.creanciersConnus}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              oppositionTiers: {...changementRegimeData.oppositionTiers, creanciersConnus: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="creanciersConnus">Créanciers connus</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="risqueOpposition"
                            checked={changementRegimeData.oppositionTiers.risqueOpposition}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              oppositionTiers: {...changementRegimeData.oppositionTiers, risqueOpposition: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="risqueOpposition">Risque d'opposition identifié</Label>
                        </div>
                      </div>
                    </div>

                    {changementRegimeData.oppositionTiers.creanciersConnus && (
                      <div className="space-y-2">
                        <Label>Détails des créanciers connus</Label>
                        <textarea
                          value={changementRegimeData.oppositionTiers.detailsCreanciers}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            oppositionTiers: {...changementRegimeData.oppositionTiers, detailsCreanciers: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Liste des créanciers et montants dus..."
                        />
                      </div>
                    )}

                    {changementRegimeData.oppositionTiers.risqueOpposition && (
                      <div className="space-y-2">
                        <Label>Nature du risque d'opposition</Label>
                        <textarea
                          value={changementRegimeData.oppositionTiers.natureRisque}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            oppositionTiers: {...changementRegimeData.oppositionTiers, natureRisque: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Précisez la nature et les raisons du risque..."
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 1quater: Liquidation du régime matrimonial */}
                  <div className="space-y-4 p-4 border rounded-lg bg-orange-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Liquidation du régime matrimonial précédent</h3>
                    
                    <div className="space-y-2">
                      <Label>Liquidation nécessaire ? <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.liquidationRegime.necessaire || undefined}
                        onValueChange={(value) => setChangementRegimeData({
                          ...changementRegimeData,
                          liquidationRegime: {...changementRegimeData.liquidationRegime, necessaire: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui - Liquidation nécessaire</SelectItem>
                          <SelectItem value="non">Non - Pas de liquidation</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {changementRegimeData.liquidationRegime.necessaire === "non" && (
                      <div className="space-y-2">
                        <Label>Justification de l'absence de liquidation</Label>
                        <textarea
                          value={changementRegimeData.liquidationRegime.justificationAbsence}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            liquidationRegime: {...changementRegimeData.liquidationRegime, justificationAbsence: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Expliquez pourquoi aucune liquidation n'est nécessaire..."
                        />
                      </div>
                    )}

                    {changementRegimeData.liquidationRegime.necessaire === "oui" && (
                      <>
                        <div className="space-y-2">
                          <Label>Répartition des biens communs</Label>
                          <Select
                            value={changementRegimeData.liquidationRegime.repartitionBiens || undefined}
                            onValueChange={(value) => setChangementRegimeData({
                              ...changementRegimeData,
                              liquidationRegime: {...changementRegimeData.liquidationRegime, repartitionBiens: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="50-50">50/50 (par moitié)</SelectItem>
                              <SelectItem value="autre">Autre répartition</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {changementRegimeData.liquidationRegime.repartitionBiens === "autre" && (
                          <div className="space-y-2">
                            <Label>Préciser la répartition</Label>
                            <Input
                              value={changementRegimeData.liquidationRegime.autreRepartition}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                liquidationRegime: {...changementRegimeData.liquidationRegime, autreRepartition: e.target.value}
                              })}
                              placeholder="Ex: 60/40, ou selon accord..."
                            />
                          </div>
                        )}

                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="recompensesCreances"
                              checked={changementRegimeData.liquidationRegime.recompensesCreances}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                liquidationRegime: {...changementRegimeData.liquidationRegime, recompensesCreances: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="recompensesCreances">Existence de récompenses ou créances entre époux</Label>
                          </div>
                        </div>

                        {changementRegimeData.liquidationRegime.recompensesCreances && (
                          <div className="space-y-2">
                            <Label>Détails des récompenses / créances</Label>
                            <textarea
                              value={changementRegimeData.liquidationRegime.detailsRecompenses}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                liquidationRegime: {...changementRegimeData.liquidationRegime, detailsRecompenses: e.target.value}
                              })}
                              className="w-full min-h-[100px] p-2 border rounded-md"
                              placeholder="Liste des récompenses dues par chaque époux, créances, montants..."
                            />
                          </div>
                        )}
                      </>
                    )}
                  </div>

                  {/* Section 1quinquies: Homologation judiciaire */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Homologation judiciaire</h3>
                    
                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="homologationRequise"
                          checked={changementRegimeData.homologation.requise}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            homologation: {...changementRegimeData.homologation, requise: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="homologationRequise">Homologation judiciaire requise</Label>
                      </div>
                    </div>

                    {changementRegimeData.homologation.requise && (
                      <>
                        <div className="space-y-2">
                          <Label>Motif de l'homologation <span className="text-red-500">*</span></Label>
                          <Select
                            value={changementRegimeData.homologation.motif || undefined}
                            onValueChange={(value) => setChangementRegimeData({
                              ...changementRegimeData,
                              homologation: {...changementRegimeData.homologation, motif: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner le motif..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="enfants_mineurs">Présence d'enfants mineurs</SelectItem>
                              <SelectItem value="opposition_tiers">Opposition d'un tiers</SelectItem>
                              <SelectItem value="protection_epoux">Protection d'un époux</SelectItem>
                              <SelectItem value="autre">Autre motif</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {changementRegimeData.homologation.motif === "autre" && (
                          <div className="space-y-2">
                            <Label>Préciser le motif</Label>
                            <textarea
                              value={changementRegimeData.homologation.autreMotif}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                homologation: {...changementRegimeData.homologation, autreMotif: e.target.value}
                              })}
                              className="w-full min-h-[80px] p-2 border rounded-md"
                              placeholder="Précisez le motif de l'homologation judiciaire..."
                            />
                          </div>
                        )}

                        <div className="space-y-2">
                          <Label>Tribunal compétent</Label>
                          <Input
                            value={changementRegimeData.homologation.tribunalCompetent}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              homologation: {...changementRegimeData.homologation, tribunalCompetent: e.target.value}
                            })}
                            placeholder="Ex: TJ de Paris..."
                          />
                        </div>
                      </>
                    )}
                  </div>

                  {/* Section 1sexies: Clauses spécifiques */}
                  <div className="space-y-4 p-4 border rounded-lg bg-indigo-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses spécifiques à prévoir</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="clauseAttributionIntegrale"
                            checked={changementRegimeData.clausesSpecifiques.attributionIntegrale}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, attributionIntegrale: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="clauseAttributionIntegrale">Clause d'attribution intégrale</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="clausePreciput"
                            checked={changementRegimeData.clausesSpecifiques.preciput}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, preciput: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="clausePreciput">Clause de préciput</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="exclusionBiens"
                            checked={changementRegimeData.clausesSpecifiques.exclusionBiens}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, exclusionBiens: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="exclusionBiens">Exclusion de certains biens</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="amenagements"
                            checked={changementRegimeData.clausesSpecifiques.amenagements}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, amenagements: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="amenagements">Aménagements particuliers</Label>
                        </div>
                      </div>
                    </div>

                    {changementRegimeData.clausesSpecifiques.attributionIntegrale && (
                      <div className="space-y-2">
                        <Label>Détails de la clause d'attribution intégrale</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.detailsAttribution}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, detailsAttribution: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Précisez les modalités de l'attribution intégrale..."
                        />
                      </div>
                    )}

                    {changementRegimeData.clausesSpecifiques.preciput && (
                      <div className="space-y-2">
                        <Label>Détails de la clause de préciput</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.detailsPreciput}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, detailsPreciput: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Biens concernés par le préciput..."
                        />
                      </div>
                    )}

                    {changementRegimeData.clausesSpecifiques.exclusionBiens && (
                      <div className="space-y-2">
                        <Label>Biens exclus du nouveau régime</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.biensExclus}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, biensExclus: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Liste des biens à exclure et raisons..."
                        />
                      </div>
                    )}

                    {changementRegimeData.clausesSpecifiques.amenagements && (
                      <div className="space-y-2">
                        <Label>Description des aménagements particuliers</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.detailsAmenagements}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, detailsAmenagements: e.target.value}
                          })}
                          className="w-full min-h-[100px] p-2 border rounded-md"
                          placeholder="Décrivez les aménagements particuliers souhaités..."
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 2: Époux 1 */}
                  <div className="space-y-4 p-4 border rounded-lg bg-blue-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète de l'époux 1</h3>
                    
                    <ClientSelector
                      clients={clients}
                      selectedClientId={changementRegimeData.epoux1.clientId || ""}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setChangementRegimeData({
                              ...changementRegimeData,
                              epoux1: {
                                ...changementRegimeData.epoux1,
                                clientId: clientId,
                                nom: client.nom,
                                prenom: client.prenom,
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                adresse: client.adresse || "",
                                profession: client.profession || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                typeIdentite: client.type_identite || "",
                                numeroIdentite: client.numero_identite || "",
                              }
                            });
                          }
                        } else {
                          setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {
                              ...changementRegimeData.epoux1,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              dateNaissance: "",
                              lieuNaissance: "",
                              nationalite: "",
                              adresse: "",
                              profession: "",
                              telephone: "",
                              email: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                            }
                          });
                        }
                      }}
                      label="Sélectionner le client (Époux 1)"
                      placeholder="Sélectionner un client..."
                    />

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux1.nom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux1.prenom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux1.nomNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={changementRegimeData.epoux1.dateNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux1.lieuNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={changementRegimeData.epoux1.nationalite}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse actuelle</Label>
                        <Input
                          value={changementRegimeData.epoux1.adresse}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, adresse: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={changementRegimeData.epoux1.profession}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={changementRegimeData.epoux1.telephone}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={changementRegimeData.epoux1.email}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="epoux1Tutelle"
                          checked={changementRegimeData.epoux1.sousTutelleCuratelle}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, sousTutelleCuratelle: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="epoux1Tutelle">Sous tutelle ou curatelle (joindre jugement si oui)</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 3: Époux 2 */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète de l'époux 2</h3>
                    
                    <ClientSelector
                      clients={clients}
                      selectedClientId={changementRegimeData.epoux2.clientId || ""}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setChangementRegimeData({
                              ...changementRegimeData,
                              epoux2: {
                                ...changementRegimeData.epoux2,
                                clientId: clientId,
                                nom: client.nom,
                                prenom: client.prenom,
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                adresse: client.adresse || "",
                                profession: client.profession || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                typeIdentite: client.type_identite || "",
                                numeroIdentite: client.numero_identite || "",
                              }
                            });
                          }
                        } else {
                          setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {
                              ...changementRegimeData.epoux2,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              dateNaissance: "",
                              lieuNaissance: "",
                              nationalite: "",
                              adresse: "",
                              profession: "",
                              telephone: "",
                              email: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                            }
                          });
                        }
                      }}
                      label="Sélectionner le client (Époux 2)"
                      placeholder="Sélectionner un client..."
                    />

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux2.nom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux2.prenom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux2.nomNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={changementRegimeData.epoux2.dateNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux2.lieuNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={changementRegimeData.epoux2.nationalite}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse actuelle</Label>
                        <Input
                          value={changementRegimeData.epoux2.adresse}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, adresse: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={changementRegimeData.epoux2.profession}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={changementRegimeData.epoux2.telephone}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={changementRegimeData.epoux2.email}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="epoux2Tutelle"
                          checked={changementRegimeData.epoux2.sousTutelleCuratelle}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, sousTutelleCuratelle: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="epoux2Tutelle">Sous tutelle ou curatelle (joindre jugement si oui)</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 4: Documents à collecter */}
                  <div className="space-y-4 p-4 border rounded-lg bg-green-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Pièces justificatives à collecter</h3>
                    
                    <div className="space-y-4">
                      <MultiFileUpload
                        label="Pièce d'identité époux 1 (CNI, passeport)"
                        files={changementRegimeEpouxIdentite1}
                        onFilesChange={setChangementRegimeEpouxIdentite1}
                      />

                      <MultiFileUpload
                        label="Pièce d'identité époux 2 (CNI, passeport)"
                        files={changementRegimeEpouxIdentite2}
                        onFilesChange={setChangementRegimeEpouxIdentite2}
                      />

                      <MultiFileUpload
                        label="Livret de famille"
                        files={changementRegimeLivretFamille}
                        onFilesChange={setChangementRegimeLivretFamille}
                      />

                      <MultiFileUpload
                        label="Acte de mariage"
                        files={changementRegimeActeMariage}
                        onFilesChange={setChangementRegimeActeMariage}
                      />

                      {changementRegimeData.contratMariageInitial && (
                        <MultiFileUpload
                          label="Contrat de mariage initial"
                          files={changementRegimeContratMariageInitial}
                          onFilesChange={setChangementRegimeContratMariageInitial}
                        />
                      )}

                      <MultiFileUpload
                        label="Titres de propriété (biens immobiliers)"
                        files={changementRegimeTitresPropriete}
                        onFilesChange={setChangementRegimeTitresPropriete}
                      />

                      <MultiFileUpload
                        label="Relevés de comptes bancaires"
                        files={changementRegimeRelevesComptes}
                        onFilesChange={setChangementRegimeRelevesComptes}
                      />

                      <MultiFileUpload
                        label="Statuts de sociétés / Pactes d'associés"
                        files={changementRegimeStatutsSocietes}
                        onFilesChange={setChangementRegimeStatutsSocietes}
                      />

                      <MultiFileUpload
                        label="Actes de prêts en cours"
                        files={changementRegimeActesPrets}
                        onFilesChange={setChangementRegimeActesPrets}
                      />

                      <MultiFileUpload
                        label="Valeurs estimées des biens"
                        files={changementRegimeEstimationsBiens}
                        onFilesChange={setChangementRegimeEstimationsBiens}
                      />

                      {(changementRegimeData.epoux1.sousTutelleCuratelle || changementRegimeData.epoux2.sousTutelleCuratelle) && (
                        <MultiFileUpload
                          label="Jugement de tutelle/curatelle"
                          files={changementRegimeJugementTutelle}
                          onFilesChange={setChangementRegimeJugementTutelle}
                        />
                      )}

                      <div className="p-3 bg-blue-50 border border-gray-200 rounded-lg mt-4">
                        <p className="text-sm text-blue-800">
                          💡 <strong>Astuce :</strong> Vous pouvez sélectionner plusieurs fichiers à la fois pour chaque catégorie. Les fichiers apparaîtront sous le bouton et pourront être supprimés individuellement.
                        </p>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire Déclaration de Succession */}
            {pendingContractType === "Déclaration de succession" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Section 1: Informations générales sur la succession */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur la succession</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Date du décès <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={successionData.dateDeces}
                          onChange={(e) => setSuccessionData({...successionData, dateDeces: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu du décès <span className="text-red-500">*</span></Label>
                        <Input
                          value={successionData.lieuDeces}
                          onChange={(e) => setSuccessionData({...successionData, lieuDeces: e.target.value})}
                          placeholder="Ville, pays..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Commune du dernier domicile <span className="text-red-500">*</span></Label>
                        <Input
                          value={successionData.communeDernierDomicile}
                          onChange={(e) => setSuccessionData({...successionData, communeDernierDomicile: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro d'acte de décès</Label>
                        <Input
                          value={successionData.numeroActeDeces}
                          onChange={(e) => setSuccessionData({...successionData, numeroActeDeces: e.target.value})}
                        />
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decesEtranger"
                            checked={successionData.decesEtranger}
                            onChange={(e) => setSuccessionData({...successionData, decesEtranger: e.target.checked})}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="decesEtranger">Décès à l'étranger (délai 12 mois)</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="declarationDans6Mois"
                            checked={successionData.declarationDans6Mois}
                            onChange={(e) => setSuccessionData({...successionData, declarationDans6Mois: e.target.checked})}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="declarationDans6Mois">Déclaration dans les 6 mois</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Section 2: Identité complète du défunt */}
                  <div className="space-y-4 p-4 border rounded-lg bg-gray-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du défunt</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={successionData.defunt.nom}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={successionData.defunt.prenom}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={successionData.defunt.nomNaissance}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={successionData.defunt.dateNaissance}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={successionData.defunt.lieuNaissance}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={successionData.defunt.nationalite}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={successionData.defunt.profession}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète</Label>
                        <Input
                          value={successionData.defunt.adresse}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, adresse: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Situation matrimoniale <span className="text-red-500">*</span></Label>
                        <Select
                          value={successionData.defunt.situationMatrimoniale || undefined}
                          onValueChange={(value) => setSuccessionData({
                            ...successionData,
                            defunt: {...successionData.defunt, situationMatrimoniale: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="celibataire">Célibataire</SelectItem>
                            <SelectItem value="marie">Marié</SelectItem>
                            <SelectItem value="divorce">Divorcé</SelectItem>
                            <SelectItem value="veuf">Veuf</SelectItem>
                            <SelectItem value="pacse">PACSé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {(successionData.defunt.situationMatrimoniale === "marie" || successionData.defunt.situationMatrimoniale === "divorce") && (
                        <div className="space-y-2">
                          <Label>Régime matrimonial</Label>
                          <Select
                            value={successionData.defunt.regimeMatrimonial || undefined}
                            onValueChange={(value) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, regimeMatrimonial: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                              <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="contratMariageExiste"
                            checked={successionData.defunt.contratMariageExiste}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, contratMariageExiste: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="contratMariageExiste">Existence d'un contrat de mariage</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="testamentExiste"
                            checked={successionData.defunt.testamentExiste}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, testamentExiste: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="testamentExiste">Existence d'un testament</Label>
                        </div>
                      </div>

                      {successionData.defunt.testamentExiste && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Type de testament</Label>
                          <Select
                            value={successionData.defunt.typeTestament || undefined}
                            onValueChange={(value) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, typeTestament: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="olographe">Olographe</SelectItem>
                              <SelectItem value="authentique">Authentique</SelectItem>
                              <SelectItem value="mystique">Mystique</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="donationsAnterieuresExistent"
                            checked={successionData.defunt.donationsAnterieuresExistent}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, donationsAnterieuresExistent: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="donationsAnterieuresExistent">Donations antérieures</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="mandatProtectionFuture"
                            checked={successionData.defunt.mandatProtectionFuture}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, mandatProtectionFuture: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="mandatProtectionFuture">Mandat de protection future</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="pacteSuccessoral"
                            checked={successionData.defunt.pacteSuccessoral}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              defunt: {...successionData.defunt, pacteSuccessoral: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="pacteSuccessoral">Pacte successoral</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Section 3: Pièces justificatives essentielles */}
                  <div className="space-y-4 p-4 border rounded-lg bg-blue-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Pièces justificatives à fournir</h3>
                    
                    <div className="space-y-4">
                      <MultiFileUpload
                        label="Acte de décès"
                        files={successionActeDeces}
                        onFilesChange={setSuccessionActeDeces}
                        required
                      />

                      <MultiFileUpload
                        label="Livret de famille"
                        files={successionLivretFamille}
                        onFilesChange={setSuccessionLivretFamille}
                      />

                      {successionData.defunt.contratMariageExiste && (
                        <MultiFileUpload
                          label="Contrat de mariage"
                          files={successionContratMariage}
                          onFilesChange={setSuccessionContratMariage}
                        />
                      )}

                      {successionData.defunt.testamentExiste && (
                        <MultiFileUpload
                          label="Testament"
                          files={successionTestament}
                          onFilesChange={setSuccessionTestament}
                        />
                      )}

                      <MultiFileUpload
                        label="Titres de propriété (biens immobiliers)"
                        files={successionTitresPropriete}
                        onFilesChange={setSuccessionTitresPropriete}
                      />

                      <MultiFileUpload
                        label="Avis d'imposition / Relevé fiscal IFI"
                        files={successionAvisImposition}
                        onFilesChange={setSuccessionAvisImposition}
                      />

                      <MultiFileUpload
                        label="Relevés bancaires / Comptes-titres"
                        files={successionRelevesBancaires}
                        onFilesChange={setSuccessionRelevesBancaires}
                      />

                      <MultiFileUpload
                        label="Contrats d'assurance-vie"
                        files={successionAssuranceVie}
                        onFilesChange={setSuccessionAssuranceVie}
                      />

                      <MultiFileUpload
                        label="Statuts de sociétés / Bilans"
                        files={successionStatutsSocietes}
                        onFilesChange={setSuccessionStatutsSocietes}
                      />

                      <MultiFileUpload
                        label="Justificatifs des dettes"
                        files={successionJustifsDettes}
                        onFilesChange={setSuccessionJustifsDettes}
                      />

                      <MultiFileUpload
                        label="Facture pompes funèbres"
                        files={successionFactureFuneraires}
                        onFilesChange={setSuccessionFactureFuneraires}
                      />
                    </div>

                    <div className="p-3 bg-orange-50 border border-orange-200 rounded-lg mt-4">
                      <p className="text-sm text-orange-800">
                        💡 <strong>Astuce :</strong> Vous pouvez sélectionner plusieurs fichiers à la fois pour chaque catégorie. Les fichiers apparaîtront sous le bouton et pourront être supprimés individuellement.
                      </p>
                    </div>
                  </div>

                  {/* Section 4: Informations sur les héritiers */}
                  <div className="space-y-4 p-4 border rounded-lg bg-green-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations sur les héritiers</h3>
                    
                    <div className="space-y-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="conjointSurvivant"
                          checked={successionData.heritiers.conjointSurvivant}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            heritiers: {...successionData.heritiers, conjointSurvivant: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="conjointSurvivant">Conjoint survivant</Label>
                      </div>

                      {successionData.heritiers.conjointSurvivant && (
                        <div className="ml-6 p-4 border rounded bg-white space-y-3">
                          <h4 className="font-medium text-sm">Identité du conjoint survivant</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <Input
                              placeholder="Nom"
                              value={successionData.heritiers.conjointIdentite.nom}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                heritiers: {
                                  ...successionData.heritiers,
                                  conjointIdentite: {...successionData.heritiers.conjointIdentite, nom: e.target.value}
                                }
                              })}
                            />
                            <Input
                              placeholder="Prénom"
                              value={successionData.heritiers.conjointIdentite.prenom}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                heritiers: {
                                  ...successionData.heritiers,
                                  conjointIdentite: {...successionData.heritiers.conjointIdentite, prenom: e.target.value}
                                }
                              })}
                            />
                            <Input
                              type="date"
                              placeholder="Date de naissance"
                              value={successionData.heritiers.conjointIdentite.dateNaissance}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                heritiers: {
                                  ...successionData.heritiers,
                                  conjointIdentite: {...successionData.heritiers.conjointIdentite, dateNaissance: e.target.value}
                                }
                              })}
                            />
                            <Input
                              placeholder="Téléphone"
                              value={successionData.heritiers.conjointIdentite.telephone}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                heritiers: {
                                  ...successionData.heritiers,
                                  conjointIdentite: {...successionData.heritiers.conjointIdentite, telephone: e.target.value}
                                }
                              })}
                            />
                            <Input
                              placeholder="Email"
                              value={successionData.heritiers.conjointIdentite.email}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                heritiers: {
                                  ...successionData.heritiers,
                                  conjointIdentite: {...successionData.heritiers.conjointIdentite, email: e.target.value}
                                }
                              })}
                            />
                            <Input
                              placeholder="Adresse complète"
                              className="md:col-span-2"
                              value={successionData.heritiers.conjointIdentite.adresse}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                heritiers: {
                                  ...successionData.heritiers,
                                  conjointIdentite: {...successionData.heritiers.conjointIdentite, adresse: e.target.value}
                                }
                              })}
                            />
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="enfantsExistent"
                          checked={successionData.heritiers.enfantsExistent}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            heritiers: {...successionData.heritiers, enfantsExistent: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="enfantsExistent">Enfants</Label>
                      </div>

                      {successionData.heritiers.enfantsExistent && (
                        <div className="ml-6 space-y-3">
                          <Input
                            placeholder="Nombre d'enfants"
                            type="number"
                            value={successionData.heritiers.nombreEnfants}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              heritiers: {...successionData.heritiers, nombreEnfants: e.target.value}
                            })}
                            className="w-32"
                          />
                          <p className="text-sm text-gray-600">Les identités complètes des enfants seront renseignées ultérieurement si nécessaire</p>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="autresHeritiersExistent"
                          checked={successionData.heritiers.autresHeritiersExistent}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            heritiers: {...successionData.heritiers, autresHeritiersExistent: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="autresHeritiersExistent">Autres héritiers (parents, frères/sœurs, neveux/nièces)</Label>
                      </div>

                      {successionData.heritiers.autresHeritiersExistent && (
                        <div className="ml-6">
                          <p className="text-sm text-gray-600">Les identités et degrés de parenté seront précisés ultérieurement</p>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="heritierMineurOuProtege"
                          checked={successionData.heritiers.heritierMineurOuProtege}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            heritiers: {...successionData.heritiers, heritierMineurOuProtege: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="heritierMineurOuProtege">Héritier(s) mineur(s) ou majeur protégé</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="renonciation"
                          checked={successionData.heritiers.renonciation}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            heritiers: {...successionData.heritiers, renonciation: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="renonciation">Existence d'un renonçant</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptationConcurrenceActifNet"
                          checked={successionData.heritiers.acceptationConcurrenceActifNet}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            heritiers: {...successionData.heritiers, acceptationConcurrenceActifNet: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="acceptationConcurrenceActifNet">Acceptation à concurrence de l'actif net</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 5: Régime matrimonial (liquidation) */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Régime matrimonial (liquidation)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Régime matrimonial exact</Label>
                        <Select
                          value={successionData.regimeMatrimonialLiquidation.regimeExact}
                          onValueChange={(value) => setSuccessionData({
                            ...successionData,
                            regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, regimeExact: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                            <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                            <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                            <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Date de mariage</Label>
                        <Input
                          type="date"
                          value={successionData.regimeMatrimonialLiquidation.dateMariage}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, dateMariage: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date d'effet du régime / contrat</Label>
                        <Input
                          type="date"
                          value={successionData.regimeMatrimonialLiquidation.dateEffetRegime}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, dateEffetRegime: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="clausesParticulieres"
                          checked={successionData.regimeMatrimonialLiquidation.clausesParticulieres}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, clausesParticulieres: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="clausesParticulieres">Clauses particulières</Label>
                      </div>

                      {successionData.regimeMatrimonialLiquidation.clausesParticulieres && (
                        <div className="ml-6 space-y-3">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="preciput"
                              checked={successionData.regimeMatrimonialLiquidation.preciput}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, preciput: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="preciput">Préciput</Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="attributionIntegrale"
                              checked={successionData.regimeMatrimonialLiquidation.attributionIntegrale}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, attributionIntegrale: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="attributionIntegrale">Attribution intégrale</Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="avantagesMatrimoniaux"
                              checked={successionData.regimeMatrimonialLiquidation.avantagesMatrimoniaux}
                              onChange={(e) => setSuccessionData({
                                ...successionData,
                                regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, avantagesMatrimoniaux: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="avantagesMatrimoniaux">Avantages matrimoniaux</Label>
                          </div>

                          <Input
                            placeholder="Détails des clauses particulières"
                            value={successionData.regimeMatrimonialLiquidation.detailsClausesParticulieres}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, detailsClausesParticulieres: e.target.value}
                            })}
                          />
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="precedenteLiquidation"
                          checked={successionData.regimeMatrimonialLiquidation.precedenteLiquidation}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, precedenteLiquidation: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="precedenteLiquidation">Existence d'une précédente liquidation</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="changementRegime"
                          checked={successionData.regimeMatrimonialLiquidation.changementRegime}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            regimeMatrimonialLiquidation: {...successionData.regimeMatrimonialLiquidation, changementRegime: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="changementRegime">Changement de régime antérieur</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 6: Fiscalité / Résidence / Délais */}
                  <div className="space-y-4 p-4 border rounded-lg bg-yellow-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Fiscalité / Résidence / Délais</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Résidence fiscale du défunt</Label>
                        <Select
                          value={successionData.fiscaliteResidence.residenceFiscale}
                          onValueChange={(value) => setSuccessionData({
                            ...successionData,
                            fiscaliteResidence: {...successionData.fiscaliteResidence, residenceFiscale: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="France">France</SelectItem>
                            <SelectItem value="Autre">Autre pays</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {successionData.fiscaliteResidence.residenceFiscale === "Autre" && (
                        <div className="space-y-2">
                          <Label>Pays de résidence</Label>
                          <Input
                            value={successionData.fiscaliteResidence.autrePays}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              fiscaliteResidence: {...successionData.fiscaliteResidence, autrePays: e.target.value}
                            })}
                          />
                        </div>
                      )}

                      {successionData.decesEtranger && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Pays du décès (si à l'étranger)</Label>
                          <Input
                            value={successionData.fiscaliteResidence.decesEtrangerPays}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              fiscaliteResidence: {...successionData.fiscaliteResidence, decesEtrangerPays: e.target.value}
                            })}
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="existenceIFI"
                            checked={successionData.fiscaliteResidence.existenceIFI}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              fiscaliteResidence: {...successionData.fiscaliteResidence, existenceIFI: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="existenceIFI">Existence d'un IFI (Impôt sur la Fortune Immobilière)</Label>
                        </div>

                        {successionData.fiscaliteResidence.existenceIFI && (
                          <Input
                            placeholder="Détails IFI"
                            value={successionData.fiscaliteResidence.detailsIFI}
                            onChange={(e) => setSuccessionData({
                              ...successionData,
                              fiscaliteResidence: {...successionData.fiscaliteResidence, detailsIFI: e.target.value}
                            })}
                            className="ml-6"
                          />
                        )}
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Coordonnées du Service des Impôts (SIP) - Facultatif</Label>
                        <Input
                          value={successionData.fiscaliteResidence.sipCoordonnees}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            fiscaliteResidence: {...successionData.fiscaliteResidence, sipCoordonnees: e.target.value}
                          })}
                          placeholder="Adresse, téléphone..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* Section 7: Mandats / Représentation */}
                  <div className="space-y-4 p-4 border rounded-lg bg-indigo-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Mandats / Représentation</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Héritier référent (personne qui mandate le notaire)</Label>
                        <Input
                          value={successionData.mandatsRepresentation.heritierReferentNom}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            mandatsRepresentation: {...successionData.mandatsRepresentation, heritierReferentNom: e.target.value}
                          })}
                          placeholder="Nom et prénom"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Rôle</Label>
                        <Input
                          value={successionData.mandatsRepresentation.heritierReferentRole}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            mandatsRepresentation: {...successionData.mandatsRepresentation, heritierReferentRole: e.target.value}
                          })}
                          placeholder="Conjoint, enfant..."
                        />
                      </div>
                    </div>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="procurationsExistent"
                          checked={successionData.mandatsRepresentation.procurationsExistent}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            mandatsRepresentation: {...successionData.mandatsRepresentation, procurationsExistent: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="procurationsExistent">Procurations existantes</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="executeurTestamentaire"
                          checked={successionData.mandatsRepresentation.executeurTestamentaire}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            mandatsRepresentation: {...successionData.mandatsRepresentation, executeurTestamentaire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="executeurTestamentaire">Exécuteur testamentaire</Label>
                      </div>

                      {successionData.mandatsRepresentation.executeurTestamentaire && (
                        <Input
                          placeholder="Identité de l'exécuteur testamentaire"
                          value={successionData.mandatsRepresentation.executeurIdentite}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            mandatsRepresentation: {...successionData.mandatsRepresentation, executeurIdentite: e.target.value}
                          })}
                          className="ml-6"
                        />
                      )}
                    </div>
                  </div>

                  {/* Section 8: Points juridiques sensibles */}
                  <div className="space-y-4 p-4 border rounded-lg bg-red-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Points juridiques sensibles</h3>
                    
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="successionInternationale"
                          checked={successionData.pointsJuridiquesSensibles.successionInternationale}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            pointsJuridiquesSensibles: {...successionData.pointsJuridiquesSensibles, successionInternationale: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="successionInternationale">Succession internationale (biens/héritiers à l'étranger)</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="indivisionConflictuelle"
                          checked={successionData.pointsJuridiquesSensibles.indivisionConflictuelle}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            pointsJuridiquesSensibles: {...successionData.pointsJuridiquesSensibles, indivisionConflictuelle: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="indivisionConflictuelle">Indivision conflictuelle / contentieux prévisible</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="heritierIntrouvable"
                          checked={successionData.pointsJuridiquesSensibles.heritierIntrouvable}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            pointsJuridiquesSensibles: {...successionData.pointsJuridiquesSensibles, heritierIntrouvable: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="heritierIntrouvable">Présence d'un héritier introuvable</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptationBeneficeInventaire"
                          checked={successionData.pointsJuridiquesSensibles.acceptationBeneficeInventaire}
                          onChange={(e) => setSuccessionData({
                            ...successionData,
                            pointsJuridiquesSensibles: {...successionData.pointsJuridiquesSensibles, acceptationBeneficeInventaire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="acceptationBeneficeInventaire">Acceptation sous bénéfice d'inventaire envisagée</Label>
                      </div>
                    </div>
                  </div>

                  <div className="p-3 bg-blue-50 border border-gray-200 rounded-lg">
                    <p className="text-sm text-blue-800">
                      ℹ️ <strong>Note :</strong> Les sections détaillées sur les donations antérieures, le patrimoine immobilier complet, les comptes bancaires, les assurances-vie, les entreprises, les véhicules, et le passif détaillé seront complétées par le notaire lors de l'instruction du dossier avec l'ensemble des pièces justificatives.
                    </p>
                  </div>

                </div>
              </>
            )}

            {pendingContractType === "Acte de notoriété" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Section 1: Type d'acte */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">1. Type d'acte de notoriété</h3>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-3">
                        <input
                          type="radio"
                          id="typeSuccession"
                          name="typeActe"
                          value="succession"
                          checked={acteNotorieteData.typeActe === "succession"}
                          onChange={(e) => setActeNotorieteData({...acteNotorieteData, typeActe: e.target.value})}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="typeSuccession">Acte de notoriété pour succession (établir la dévolution successorale)</Label>
                      </div>
                      <div className="flex items-center space-x-3">
                        <input
                          type="radio"
                          id="typeFiliation"
                          name="typeActe"
                          value="filiation"
                          checked={acteNotorieteData.typeActe === "filiation"}
                          onChange={(e) => setActeNotorieteData({...acteNotorieteData, typeActe: e.target.value})}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="typeFiliation">Acte de notoriété pour établir une filiation</Label>
                      </div>
                      <div className="flex items-center space-x-3">
                        <input
                          type="radio"
                          id="typeReconstitution"
                          name="typeActe"
                          value="reconstitution"
                          checked={acteNotorieteData.typeActe === "reconstitution"}
                          onChange={(e) => setActeNotorieteData({...acteNotorieteData, typeActe: e.target.value})}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="typeReconstitution">Acte de notoriété pour reconstitution d'acte d'état civil</Label>
                      </div>
                      <div className="flex items-center space-x-3">
                        <input
                          type="radio"
                          id="typeQualite"
                          name="typeActe"
                          value="qualiteHereditaire"
                          checked={acteNotorieteData.typeActe === "qualiteHereditaire"}
                          onChange={(e) => setActeNotorieteData({...acteNotorieteData, typeActe: e.target.value})}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="typeQualite">Acte de notoriété pour constater la qualité d'héritier</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 2: Informations sur le défunt */}
                  {(acteNotorieteData.typeActe === "succession" || acteNotorieteData.typeActe === "qualiteHereditaire") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">2. Informations sur le défunt</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <Label htmlFor="defuntNom">Nom</Label>
                          <Input
                            id="defuntNom"
                            value={acteNotorieteData.defunt.nom}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, nom: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntPrenom">Prénom(s)</Label>
                          <Input
                            id="defuntPrenom"
                            value={acteNotorieteData.defunt.prenom}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, prenom: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntDateNaissance">Date de naissance</Label>
                          <Input
                            id="defuntDateNaissance"
                            type="date"
                            value={acteNotorieteData.defunt.dateNaissance}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, dateNaissance: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntLieuNaissance">Lieu de naissance</Label>
                          <Input
                            id="defuntLieuNaissance"
                            value={acteNotorieteData.defunt.lieuNaissance}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, lieuNaissance: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntDateDeces">Date de décès</Label>
                          <Input
                            id="defuntDateDeces"
                            type="date"
                            value={acteNotorieteData.defunt.dateDeces}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, dateDeces: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntLieuDeces">Lieu de décès</Label>
                          <Input
                            id="defuntLieuDeces"
                            value={acteNotorieteData.defunt.lieuDeces}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, lieuDeces: e.target.value}
                            })}
                          />
                        </div>
                        <div className="md:col-span-2">
                          <Label htmlFor="defuntDernierDomicile">Dernier domicile</Label>
                          <Input
                            id="defuntDernierDomicile"
                            value={acteNotorieteData.defunt.dernierDomicile}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, dernierDomicile: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntNationalite">Nationalité</Label>
                          <Input
                            id="defuntNationalite"
                            value={acteNotorieteData.defunt.nationalite}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, nationalite: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntProfession">Profession</Label>
                          <Input
                            id="defuntProfession"
                            value={acteNotorieteData.defunt.profession}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, profession: e.target.value}
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="defuntSituationMatrimoniale">Situation matrimoniale</Label>
                          <select
                            id="defuntSituationMatrimoniale"
                            value={acteNotorieteData.defunt.situationMatrimoniale}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, situationMatrimoniale: e.target.value}
                            })}
                            className="w-full px-3 py-2 border rounded-md"
                          >
                            <option value="">-- Sélectionner --</option>
                            <option value="celibataire">Célibataire</option>
                            <option value="marie">Marié(e)</option>
                            <option value="pacse">Pacsé(e)</option>
                            <option value="divorce">Divorcé(e)</option>
                            <option value="veuf">Veuf/Veuve</option>
                          </select>
                        </div>
                        {(acteNotorieteData.defunt.situationMatrimoniale === "marie" || acteNotorieteData.defunt.situationMatrimoniale === "veuf") && (
                          <>
                            <div>
                              <Label htmlFor="defuntDateMariage">Date de mariage</Label>
                              <Input
                                id="defuntDateMariage"
                                type="date"
                                value={acteNotorieteData.defunt.dateMariage}
                                onChange={(e) => setActeNotorieteData({
                                  ...acteNotorieteData,
                                  defunt: {...acteNotorieteData.defunt, dateMariage: e.target.value}
                                })}
                              />
                            </div>
                            <div>
                              <Label htmlFor="defuntRegimeMatrimonial">Régime matrimonial</Label>
                              <Input
                                id="defuntRegimeMatrimonial"
                                value={acteNotorieteData.defunt.regimeMatrimonial}
                                onChange={(e) => setActeNotorieteData({
                                  ...acteNotorieteData,
                                  defunt: {...acteNotorieteData.defunt, regimeMatrimonial: e.target.value}
                                })}
                              />
                            </div>
                          </>
                        )}
                      </div>
                      
                      <div className="space-y-3 mt-4">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="defuntTestamentExiste"
                            checked={acteNotorieteData.defunt.testamentExiste}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, testamentExiste: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="defuntTestamentExiste">Testament existant</Label>
                        </div>

                        {acteNotorieteData.defunt.testamentExiste && (
                          <div>
                            <Label htmlFor="defuntTestamentDetails">Détails du testament</Label>
                            <Textarea
                              id="defuntTestamentDetails"
                              value={acteNotorieteData.defunt.testamentDetails}
                              onChange={(e) => setActeNotorieteData({
                                ...acteNotorieteData,
                                defunt: {...acteNotorieteData.defunt, testamentDetails: e.target.value}
                              })}
                              rows={3}
                            />
                          </div>
                        )}

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="defuntDonationsAnterieures"
                            checked={acteNotorieteData.defunt.donationsAnterieures}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              defunt: {...acteNotorieteData.defunt, donationsAnterieures: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="defuntDonationsAnterieures">Donations antérieures</Label>
                        </div>

                        {acteNotorieteData.defunt.donationsAnterieures && (
                          <div>
                            <Label htmlFor="defuntDonationsDetails">Détails des donations</Label>
                            <Textarea
                              id="defuntDonationsDetails"
                              value={acteNotorieteData.defunt.donationsDetails}
                              onChange={(e) => setActeNotorieteData({
                                ...acteNotorieteData,
                                defunt: {...acteNotorieteData.defunt, donationsDetails: e.target.value}
                              })}
                              rows={3}
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* Section 3: Héritiers */}
                  {(acteNotorieteData.typeActe === "succession" || acteNotorieteData.typeActe === "qualiteHereditaire") && (
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <h3 className="font-semibold text-lg border-b pb-2 flex-1">3. Héritiers</h3>
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          onClick={() => {
                            const newId = Date.now();
                            setActeNotorieteData({
                              ...acteNotorieteData,
                              heritiers: [...acteNotorieteData.heritiers, {
                                id: newId,
                                clientId: "",
                                nom: "", prenom: "", dateNaissance: "", lieuNaissance: "",
                                adresse: "", nationalite: "", profession: "",
                                lienParente: "", degre: "", branche: "",
                                representantDe: "", representeQui: "",
                                majeurOuMineur: "majeur", regime: "",
                                optionSuccessorale: "acceptePurSimple"
                              }]
                            });
                            setActeNotorieteHeritierFiles({
                              ...acteNotorieteHeritierFiles,
                              [newId]: []
                            });
                          }}
                          className="ml-2"
                        >
                          + Ajouter un héritier
                        </Button>
                      </div>

                      {acteNotorieteData.heritiers.map((heritier, index) => (
                        <div key={heritier.id} className="p-4 border rounded-lg space-y-4 bg-gray-50">
                          <div className="flex justify-between items-center">
                            <h4 className="font-medium">Héritier {index + 1}</h4>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newHeritiers = acteNotorieteData.heritiers.filter(h => h.id !== heritier.id);
                                setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                const newFiles = {...acteNotorieteHeritierFiles};
                                delete newFiles[heritier.id];
                                setActeNotorieteHeritierFiles(newFiles);
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          {/* Sélection client ou saisie manuelle */}
                          <div className="mb-4">
                            <Label htmlFor={`heritier_client_${heritier.id}`}>Choisir un client existant (optionnel)</Label>
                            <select
                              id={`heritier_client_${heritier.id}`}
                              value={heritier.clientId || ""}
                              onChange={(e) => {
                                const clientId = e.target.value;
                                const newHeritiers = [...acteNotorieteData.heritiers];
                                
                                if (clientId) {
                                  const selectedClient = clients.find(c => c.id === clientId);
                                  if (selectedClient) {
                                    newHeritiers[index] = {
                                      ...heritier,
                                      clientId: clientId,
                                      nom: selectedClient.nom || "",
                                      prenom: selectedClient.prenom || "",
                                      dateNaissance: selectedClient.date_naissance || "",
                                      lieuNaissance: selectedClient.lieu_naissance || "",
                                      adresse: selectedClient.adresse || "",
                                      nationalite: selectedClient.nationalite || "",
                                      profession: selectedClient.profession || "",
                                    };
                                  }
                                } else {
                                  newHeritiers[index] = {...heritier, clientId: ""};
                                }
                                
                                setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                              }}
                              className="w-full px-3 py-2 border rounded-md"
                            >
                              <option value="">-- Saisie manuelle --</option>
                              {clients.map((client) => (
                                <option key={client.id} value={client.id}>
                                  {client.prenom} {client.nom}
                                </option>
                              ))}
                            </select>
                          </div>

                          {/* Informations civiles */}
                          <div>
                            <h5 className="font-medium text-sm mb-2">Informations civiles</h5>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div>
                                <Label htmlFor={`heritier_nom_${heritier.id}`}>Nom</Label>
                                <Input
                                  id={`heritier_nom_${heritier.id}`}
                                  value={heritier.nom}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, nom: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_prenom_${heritier.id}`}>Prénom(s)</Label>
                                <Input
                                  id={`heritier_prenom_${heritier.id}`}
                                  value={heritier.prenom}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, prenom: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_dateNaissance_${heritier.id}`}>Date de naissance</Label>
                                <Input
                                  id={`heritier_dateNaissance_${heritier.id}`}
                                  type="date"
                                  value={heritier.dateNaissance}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, dateNaissance: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_lieuNaissance_${heritier.id}`}>Lieu de naissance</Label>
                                <Input
                                  id={`heritier_lieuNaissance_${heritier.id}`}
                                  value={heritier.lieuNaissance}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, lieuNaissance: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                              <div className="md:col-span-2">
                                <Label htmlFor={`heritier_adresse_${heritier.id}`}>Adresse</Label>
                                <Input
                                  id={`heritier_adresse_${heritier.id}`}
                                  value={heritier.adresse}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, adresse: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_nationalite_${heritier.id}`}>Nationalité</Label>
                                <Input
                                  id={`heritier_nationalite_${heritier.id}`}
                                  value={heritier.nationalite}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, nationalite: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_profession_${heritier.id}`}>Profession</Label>
                                <Input
                                  id={`heritier_profession_${heritier.id}`}
                                  value={heritier.profession}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, profession: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                />
                              </div>
                            </div>
                          </div>

                          {/* Lien de parenté */}
                          <div>
                            <h5 className="font-medium text-sm mb-2">Lien de parenté</h5>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                              <div>
                                <Label htmlFor={`heritier_lienParente_${heritier.id}`}>Lien</Label>
                                <Input
                                  id={`heritier_lienParente_${heritier.id}`}
                                  value={heritier.lienParente}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, lienParente: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                  placeholder="Ex: Fils, Fille, Conjoint..."
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_degre_${heritier.id}`}>Degré</Label>
                                <Input
                                  id={`heritier_degre_${heritier.id}`}
                                  value={heritier.degre}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, degre: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                  placeholder="1er, 2e..."
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_branche_${heritier.id}`}>Branche</Label>
                                <Input
                                  id={`heritier_branche_${heritier.id}`}
                                  value={heritier.branche}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, branche: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                  placeholder="Paternelle, Maternelle..."
                                />
                              </div>
                            </div>
                          </div>

                          {/* Représentation */}
                          <div>
                            <h5 className="font-medium text-sm mb-2">Représentation (si applicable)</h5>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div>
                                <Label htmlFor={`heritier_representantDe_${heritier.id}`}>Représentant de</Label>
                                <Input
                                  id={`heritier_representantDe_${heritier.id}`}
                                  value={heritier.representantDe}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, representantDe: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                  placeholder="Nom du représenté"
                                />
                              </div>
                              <div>
                                <Label htmlFor={`heritier_representeQui_${heritier.id}`}>Représente qui</Label>
                                <Input
                                  id={`heritier_representeQui_${heritier.id}`}
                                  value={heritier.representeQui}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, representeQui: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                  placeholder="Lien avec le représenté"
                                />
                              </div>
                            </div>
                          </div>

                          {/* Capacité */}
                          <div>
                            <h5 className="font-medium text-sm mb-2">Capacité</h5>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div>
                                <Label htmlFor={`heritier_majeurOuMineur_${heritier.id}`}>Statut</Label>
                                <select
                                  id={`heritier_majeurOuMineur_${heritier.id}`}
                                  value={heritier.majeurOuMineur}
                                  onChange={(e) => {
                                    const newHeritiers = [...acteNotorieteData.heritiers];
                                    newHeritiers[index] = {...heritier, majeurOuMineur: e.target.value};
                                    setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                  }}
                                  className="w-full px-3 py-2 border rounded-md"
                                >
                                  <option value="majeur">Majeur</option>
                                  <option value="mineur">Mineur</option>
                                  <option value="protege">Majeur protégé</option>
                                </select>
                              </div>
                              {heritier.majeurOuMineur !== "majeur" && (
                                <div>
                                  <Label htmlFor={`heritier_regime_${heritier.id}`}>Régime de protection</Label>
                                  <Input
                                    id={`heritier_regime_${heritier.id}`}
                                    value={heritier.regime}
                                    onChange={(e) => {
                                      const newHeritiers = [...acteNotorieteData.heritiers];
                                      newHeritiers[index] = {...heritier, regime: e.target.value};
                                      setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                                    }}
                                    placeholder="Tutelle, curatelle..."
                                  />
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Option successorale */}
                          <div>
                            <h5 className="font-medium text-sm mb-2">Option successorale</h5>
                            <select
                              id={`heritier_option_${heritier.id}`}
                              value={heritier.optionSuccessorale}
                              onChange={(e) => {
                                const newHeritiers = [...acteNotorieteData.heritiers];
                                newHeritiers[index] = {...heritier, optionSuccessorale: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, heritiers: newHeritiers});
                              }}
                              className="w-full px-3 py-2 border rounded-md"
                            >
                              <option value="acceptePurSimple">Accepte pur et simple</option>
                              <option value="accepteBeneficeInventaire">Accepte à concurrence de l'actif net (bénéfice d'inventaire)</option>
                              <option value="renonce">Renonce</option>
                            </select>
                          </div>

                          {/* Documents de l'héritier */}
                          <div>
                            <h5 className="font-medium text-sm mb-2">Documents justificatifs de l'héritier</h5>
                            <MultiFileUpload
                              label="Pièces d'identité, actes de naissance, justificatifs de domicile"
                              files={acteNotorieteHeritierFiles[heritier.id] || []}
                              onFilesChange={(newFiles) => {
                                setActeNotorieteHeritierFiles({
                                  ...acteNotorieteHeritierFiles,
                                  [heritier.id]: newFiles
                                });
                              }}
                            />
                          </div>
                        </div>
                      ))}

                      {acteNotorieteData.heritiers.length === 0 && (
                        <p className="text-sm text-gray-500 italic">Aucun héritier ajouté. Cliquez sur "Ajouter un héritier" pour commencer.</p>
                      )}
                    </div>
                  )}

                  {/* Section 4: Conjoint survivant */}
                  {(acteNotorieteData.typeActe === "succession" || acteNotorieteData.typeActe === "qualiteHereditaire") && 
                   (acteNotorieteData.defunt.situationMatrimoniale === "marie" || acteNotorieteData.defunt.situationMatrimoniale === "veuf") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">4. Conjoint survivant</h3>
                      <div className="space-y-3">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="conjointDonationsRecues"
                            checked={acteNotorieteData.conjointSurvivant.donationsRecues}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              conjointSurvivant: {...acteNotorieteData.conjointSurvivant, donationsRecues: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="conjointDonationsRecues">Donations reçues du défunt</Label>
                        </div>

                        {acteNotorieteData.conjointSurvivant.donationsRecues && (
                          <div>
                            <Label htmlFor="conjointDonationsDetails">Détails des donations</Label>
                            <Textarea
                              id="conjointDonationsDetails"
                              value={acteNotorieteData.conjointSurvivant.donationsDetails}
                              onChange={(e) => setActeNotorieteData({
                                ...acteNotorieteData,
                                conjointSurvivant: {...acteNotorieteData.conjointSurvivant, donationsDetails: e.target.value}
                              })}
                              rows={2}
                            />
                          </div>
                        )}

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="conjointElectionDroits"
                            checked={acteNotorieteData.conjointSurvivant.electionDroits}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              conjointSurvivant: {...acteNotorieteData.conjointSurvivant, electionDroits: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="conjointElectionDroits">Élection de droits (usufruit / pleine propriété)</Label>
                        </div>

                        {acteNotorieteData.conjointSurvivant.electionDroits && (
                          <div>
                            <Label htmlFor="conjointElectionDetails">Choix du conjoint</Label>
                            <Textarea
                              id="conjointElectionDetails"
                              value={acteNotorieteData.conjointSurvivant.electionDetails}
                              onChange={(e) => setActeNotorieteData({
                                ...acteNotorieteData,
                                conjointSurvivant: {...acteNotorieteData.conjointSurvivant, electionDetails: e.target.value}
                              })}
                              rows={2}
                            />
                          </div>
                        )}

                        <div>
                          <Label htmlFor="conjointDroitsSuccession">Droits dans la succession</Label>
                          <Textarea
                            id="conjointDroitsSuccession"
                            value={acteNotorieteData.conjointSurvivant.droitsSuccession}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              conjointSurvivant: {...acteNotorieteData.conjointSurvivant, droitsSuccession: e.target.value}
                            })}
                            rows={2}
                            placeholder="Décrire les droits du conjoint..."
                          />
                        </div>

                        <div>
                          <Label htmlFor="conjointContratMariage">Contrat de mariage (si applicable)</Label>
                          <Input
                            id="conjointContratMariage"
                            value={acteNotorieteData.conjointSurvivant.contratMariage}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              conjointSurvivant: {...acteNotorieteData.conjointSurvivant, contratMariage: e.target.value}
                            })}
                            placeholder="Détails du contrat..."
                          />
                        </div>

                        <div>
                          <Label htmlFor="conjointClausesParticulieres">Clauses particulières</Label>
                          <Textarea
                            id="conjointClausesParticulieres"
                            value={acteNotorieteData.conjointSurvivant.clausesParticulieres}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              conjointSurvivant: {...acteNotorieteData.conjointSurvivant, clausesParticulieres: e.target.value}
                            })}
                            rows={2}
                            placeholder="Clauses spécifiques..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Section 5: Témoins */}
                  <div className="space-y-4">
                    <div className="flex justify-between items-center">
                      <h3 className="font-semibold text-lg border-b pb-2 flex-1">5. Témoins (minimum 2)</h3>
                      <Button
                        type="button"
                        size="sm"
                        onClick={() => {
                          const newId = Date.now();
                          setActeNotorieteData({
                            ...acteNotorieteData,
                            temoins: [...acteNotorieteData.temoins, {
                              id: newId,
                              nom: "", prenom: "", dateNaissance: "", lieuNaissance: "",
                              adresse: "", nationalite: "", profession: "",
                              lienDefunt: ""
                            }]
                          });
                          setActeNotorieteTemoinFiles({
                            ...acteNotorieteTemoinFiles,
                            [newId]: []
                          });
                        }}
                        className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                      >
                        + Ajouter un témoin
                      </Button>
                    </div>

                    {acteNotorieteData.temoins.map((temoin, index) => (
                      <div key={temoin.id} className="p-4 border rounded-lg space-y-4 bg-blue-50">
                        <div className="flex justify-between items-center">
                          <h4 className="font-medium">Témoin {index + 1}</h4>
                          <Button
                            type="button"
                            variant="destructive"
                            size="sm"
                            onClick={() => {
                              const newTemoins = acteNotorieteData.temoins.filter(t => t.id !== temoin.id);
                              setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              const newFiles = {...acteNotorieteTemoinFiles};
                              delete newFiles[temoin.id];
                              setActeNotorieteTemoinFiles(newFiles);
                            }}
                            disabled={acteNotorieteData.temoins.length <= 2}
                          >
                            Supprimer
                          </Button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                          <div>
                            <Label htmlFor={`temoin_nom_${temoin.id}`}>Nom</Label>
                            <Input
                              id={`temoin_nom_${temoin.id}`}
                              value={temoin.nom}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, nom: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div>
                            <Label htmlFor={`temoin_prenom_${temoin.id}`}>Prénom(s)</Label>
                            <Input
                              id={`temoin_prenom_${temoin.id}`}
                              value={temoin.prenom}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, prenom: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div>
                            <Label htmlFor={`temoin_dateNaissance_${temoin.id}`}>Date de naissance</Label>
                            <Input
                              id={`temoin_dateNaissance_${temoin.id}`}
                              type="date"
                              value={temoin.dateNaissance}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, dateNaissance: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div>
                            <Label htmlFor={`temoin_lieuNaissance_${temoin.id}`}>Lieu de naissance</Label>
                            <Input
                              id={`temoin_lieuNaissance_${temoin.id}`}
                              value={temoin.lieuNaissance}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, lieuNaissance: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div className="md:col-span-2">
                            <Label htmlFor={`temoin_adresse_${temoin.id}`}>Adresse</Label>
                            <Input
                              id={`temoin_adresse_${temoin.id}`}
                              value={temoin.adresse}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, adresse: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div>
                            <Label htmlFor={`temoin_nationalite_${temoin.id}`}>Nationalité</Label>
                            <Input
                              id={`temoin_nationalite_${temoin.id}`}
                              value={temoin.nationalite}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, nationalite: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div>
                            <Label htmlFor={`temoin_profession_${temoin.id}`}>Profession</Label>
                            <Input
                              id={`temoin_profession_${temoin.id}`}
                              value={temoin.profession}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, profession: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                            />
                          </div>
                          <div className="md:col-span-2">
                            <Label htmlFor={`temoin_lienDefunt_${temoin.id}`}>Lien avec le défunt</Label>
                            <Input
                              id={`temoin_lienDefunt_${temoin.id}`}
                              value={temoin.lienDefunt}
                              onChange={(e) => {
                                const newTemoins = [...acteNotorieteData.temoins];
                                newTemoins[index] = {...temoin, lienDefunt: e.target.value};
                                setActeNotorieteData({...acteNotorieteData, temoins: newTemoins});
                              }}
                              placeholder="Ex: Ami proche, voisin, collègue..."
                            />
                          </div>
                        </div>

                        <div>
                          <Label>Documents du témoin</Label>
                          <MultiFileUpload
                            label="Pièce d'identité, justificatif de domicile"
                            files={acteNotorieteTemoinFiles[temoin.id] || []}
                            onFilesChange={(newFiles) => {
                              setActeNotorieteTemoinFiles({
                                ...acteNotorieteTemoinFiles,
                                [temoin.id]: newFiles
                              });
                            }}
                          />
                        </div>
                      </div>
                    ))}

                    {acteNotorieteData.temoins.length < 2 && (
                      <p className="text-sm text-orange-600 font-medium">⚠️ Au moins 2 témoins sont requis pour établir l'acte de notoriété.</p>
                    )}
                  </div>

                  {/* Section 6: Preuves de la filiation */}
                  {acteNotorieteData.typeActe === "filiation" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">6. Preuves de la filiation</h3>
                      <div className="space-y-3">
                        <MultiFileUpload
                          label="Photos de famille"
                          files={acteNotorietePreuvePhotos}
                          onFilesChange={setActeNotorietePreuvePhotos}
                        />

                        <MultiFileUpload
                          label="Certificats médicaux"
                          files={acteNotorietePreuveCertificats}
                          onFilesChange={setActeNotorietePreuveCertificats}
                        />

                        <MultiFileUpload
                          label="Documents scolaires"
                          files={acteNotorietePreuveDocumentsScolaires}
                          onFilesChange={setActeNotorietePreuveDocumentsScolaires}
                        />

                        <MultiFileUpload
                          label="Correspondances"
                          files={acteNotorietePreuveCorrespondances}
                          onFilesChange={setActeNotorietePreuveCorrespondances}
                        />

                        <MultiFileUpload
                          label="Autres preuves"
                          files={acteNotorietePreuveAutres}
                          onFilesChange={setActeNotorietePreuveAutres}
                        />
                      </div>
                    </div>
                  )}

                  {/* Section 7: Contenu de l'acte */}
                  {(acteNotorieteData.typeActe === "succession" || acteNotorieteData.typeActe === "qualiteHereditaire") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">7. Contenu de l'acte</h3>
                      <div className="space-y-3">
                        <div>
                          <Label htmlFor="contenuDeclarations">Déclarations des témoins</Label>
                          <Textarea
                            id="contenuDeclarations"
                            value={acteNotorieteData.contenuActe.declarationsTemoins}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              contenuActe: {...acteNotorieteData.contenuActe, declarationsTemoins: e.target.value}
                            })}
                            rows={3}
                            placeholder="Résumé des déclarations faites par les témoins..."
                          />
                        </div>

                        <div>
                          <Label htmlFor="contenuOrdre">Ordre successoral</Label>
                          <Textarea
                            id="contenuOrdre"
                            value={acteNotorieteData.contenuActe.ordreSuccessoral}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              contenuActe: {...acteNotorieteData.contenuActe, ordreSuccessoral: e.target.value}
                            })}
                            rows={3}
                            placeholder="Ordre des héritiers selon la loi..."
                          />
                        </div>

                        <div>
                          <Label htmlFor="contenuParts">Parts héréditaires</Label>
                          <Textarea
                            id="contenuParts"
                            value={acteNotorieteData.contenuActe.partsHereditaires}
                            onChange={(e) => setActeNotorieteData({
                              ...acteNotorieteData,
                              contenuActe: {...acteNotorieteData.contenuActe, partsHereditaires: e.target.value}
                            })}
                            rows={3}
                            placeholder="Répartition des parts entre les héritiers..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* Section 8: Formalités */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">8. Formalités</h3>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="formaliteFCDDV"
                          checked={acteNotorieteData.formalites.fichierCentralDesDispositionsDernieresVolontes}
                          onChange={(e) => setActeNotorieteData({
                            ...acteNotorieteData,
                            formalites: {...acteNotorieteData.formalites, fichierCentralDesDispositionsDernieresVolontes: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="formaliteFCDDV">Consultation du Fichier Central des Dispositions de Dernières Volontés (FCDDV)</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="formaliteReception"
                          checked={acteNotorieteData.formalites.receptionActeNotaire}
                          onChange={(e) => setActeNotorieteData({
                            ...acteNotorieteData,
                            formalites: {...acteNotorieteData.formalites, receptionActeNotaire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="formaliteReception">Réception de l'acte par le notaire</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="formaliteAuthentification"
                          checked={acteNotorieteData.formalites.authentificationSignatures}
                          onChange={(e) => setActeNotorieteData({
                            ...acteNotorieteData,
                            formalites: {...acteNotorieteData.formalites, authentificationSignatures: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="formaliteAuthentification">Authentification des signatures</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="formaliteTransmission"
                          checked={acteNotorieteData.formalites.transmissionCopiesHeritiers}
                          onChange={(e) => setActeNotorieteData({
                            ...acteNotorieteData,
                            formalites: {...acteNotorieteData.formalites, transmissionCopiesHeritiers: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="formaliteTransmission">Transmission de copies aux héritiers</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="formaliteInscription"
                          checked={acteNotorieteData.formalites.inscriptionRegistres}
                          onChange={(e) => setActeNotorieteData({
                            ...acteNotorieteData,
                            formalites: {...acteNotorieteData.formalites, inscriptionRegistres: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="formaliteInscription">Inscription dans les registres</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 9: Pièces justificatives */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">9. Pièces justificatives</h3>
                    
                    <div className="space-y-3">
                      <h4 className="font-medium text-sm">Documents relatifs au défunt</h4>
                      
                      <MultiFileUpload
                        label="Acte de décès"
                        files={acteNotorieteDefuntActeDeces}
                        onFilesChange={setActeNotorieteDefuntActeDeces}
                      />

                      <MultiFileUpload
                        label="Acte de naissance du défunt"
                        files={acteNotorieteDefuntActeNaissance}
                        onFilesChange={setActeNotorieteDefuntActeNaissance}
                      />

                      <MultiFileUpload
                        label="Livret de famille du défunt"
                        files={acteNotorieteDefuntLivretFamille}
                        onFilesChange={setActeNotorieteDefuntLivretFamille}
                      />

                      <MultiFileUpload
                        label="Acte de mariage du défunt"
                        files={acteNotorieteDefuntActeMariage}
                        onFilesChange={setActeNotorieteDefuntActeMariage}
                      />

                      <MultiFileUpload
                        label="Contrat de mariage"
                        files={acteNotorieteDefuntContratMariage}
                        onFilesChange={setActeNotorieteDefuntContratMariage}
                      />

                      <MultiFileUpload
                        label="Jugement de divorce"
                        files={acteNotorieteDefuntJugementDivorce}
                        onFilesChange={setActeNotorieteDefuntJugementDivorce}
                      />

                      <MultiFileUpload
                        label="Testament(s)"
                        files={acteNotorieteDefuntTestament}
                        onFilesChange={setActeNotorieteDefuntTestament}
                      />

                      <MultiFileUpload
                        label="Donations antérieures"
                        files={acteNotorieteDefuntDonations}
                        onFilesChange={setActeNotorieteDefuntDonations}
                      />

                      <MultiFileUpload
                        label="Justificatif de domicile du défunt"
                        files={acteNotorieteDefuntJustifDomicile}
                        onFilesChange={setActeNotorieteDefuntJustifDomicile}
                      />

                      <MultiFileUpload
                        label="Pièce d'identité du défunt"
                        files={acteNotorieteDefuntPieceIdentite}
                        onFilesChange={setActeNotorieteDefuntPieceIdentite}
                      />
                    </div>

                    <div className="space-y-3 mt-6">
                      <h4 className="font-medium text-sm">Documents relatifs aux héritiers (collectifs)</h4>
                      
                      <MultiFileUpload
                        label="Actes de naissance des héritiers"
                        files={acteNotorieteHeritiersActesNaissance}
                        onFilesChange={setActeNotorieteHeritiersActesNaissance}
                      />

                      <MultiFileUpload
                        label="Pièces d'identité des héritiers"
                        files={acteNotorieteHeritiersPiecesIdentite}
                        onFilesChange={setActeNotorieteHeritiersPiecesIdentite}
                      />

                      <MultiFileUpload
                        label="Justificatifs de domicile des héritiers"
                        files={acteNotorieteHeritiersJustifsDomicile}
                        onFilesChange={setActeNotorieteHeritiersJustifsDomicile}
                      />

                      <MultiFileUpload
                        label="Livrets de famille des héritiers"
                        files={acteNotorieteHeritiersLivretsFamille}
                        onFilesChange={setActeNotorieteHeritiersLivretsFamille}
                      />

                      <MultiFileUpload
                        label="Actes de notoriété antérieurs"
                        files={acteNotorieteHeritiersActesNotoriete}
                        onFilesChange={setActeNotorieteHeritiersActesNotoriete}
                      />

                      <MultiFileUpload
                        label="Certificats d'hérédité"
                        files={acteNotorieteHeritiersCertificatsHeredite}
                        onFilesChange={setActeNotorieteHeritiersCertificatsHeredite}
                      />

                      <MultiFileUpload
                        label="Documents de tutelle/curatelle (si applicable)"
                        files={acteNotorieteHeritiersTutelleCuratelle}
                        onFilesChange={setActeNotorieteHeritiersTutelleCuratelle}
                      />
                    </div>

                    <div className="space-y-3 mt-6">
                      <h4 className="font-medium text-sm">Documents relatifs aux témoins (collectifs)</h4>
                      
                      <MultiFileUpload
                        label="Pièces d'identité des témoins"
                        files={acteNotorieteTemoinsPiecesIdentite}
                        onFilesChange={setActeNotorieteTemoinsPiecesIdentite}
                      />

                      <MultiFileUpload
                        label="Justificatifs de domicile des témoins"
                        files={acteNotorieteTemoinsJustifsDomicile}
                        onFilesChange={setActeNotorieteTemoinsJustifsDomicile}
                      />
                    </div>

                    <div className="space-y-3 mt-6">
                      <h4 className="font-medium text-sm">Autres documents</h4>
                      
                      <MultiFileUpload
                        label="Attestations diverses"
                        files={acteNotorieteAutresAttestations}
                        onFilesChange={setActeNotorieteAutresAttestations}
                      />

                      <MultiFileUpload
                        label="Certificats médicaux"
                        files={acteNotorieteAutresCertificatsMedicaux}
                        onFilesChange={setActeNotorieteAutresCertificatsMedicaux}
                      />

                      <MultiFileUpload
                        label="Correspondances"
                        files={acteNotorieteAutresCorrespondances}
                        onFilesChange={setActeNotorieteAutresCorrespondances}
                      />

                      <MultiFileUpload
                        label="Autres documents"
                        files={acteNotorieteAutresDocuments}
                        onFilesChange={setActeNotorieteAutresDocuments}
                      />
                    </div>
                  </div>

                  <div className="p-3 bg-blue-50 border border-gray-200 rounded-lg">
                    <p className="text-sm text-blue-800">
                      ℹ️ <strong>Note :</strong> L'acte de notoriété est un document officiel établi par un notaire qui certifie la qualité d'héritier ou établit une filiation. Il est requis pour débloquer les comptes bancaires, transférer les biens immobiliers, et effectuer toutes les démarches successorales. Assurez-vous de fournir tous les documents nécessaires pour faciliter le traitement par le notaire.
                    </p>
                  </div>

                </div>
              </>
            )}

            {pendingContractType === "Partage successoral" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Section 1: Informations sur la succession */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">1. Informations sur la succession</h3>
                    
                    {/* A. Identité du défunt */}
                    <div className="space-y-4">
                      <h4 className="font-medium text-md">A. Identité du défunt</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <Label htmlFor="partageDefuntNom">Nom</Label>
                          <Input
                            id="partageDefuntNom"
                            value={partageSuccessoralData.succession.defunt.nom}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, nom: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntPrenom">Prénom</Label>
                          <Input
                            id="partageDefuntPrenom"
                            value={partageSuccessoralData.succession.defunt.prenom}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, prenom: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntNomNaissance">Nom de naissance</Label>
                          <Input
                            id="partageDefuntNomNaissance"
                            value={partageSuccessoralData.succession.defunt.nomNaissance}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, nomNaissance: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntDateNaissance">Date de naissance</Label>
                          <Input
                            id="partageDefuntDateNaissance"
                            type="date"
                            value={partageSuccessoralData.succession.defunt.dateNaissance}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, dateNaissance: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntLieuNaissance">Lieu de naissance</Label>
                          <Input
                            id="partageDefuntLieuNaissance"
                            value={partageSuccessoralData.succession.defunt.lieuNaissance}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, lieuNaissance: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntDateDeces">Date du décès</Label>
                          <Input
                            id="partageDefuntDateDeces"
                            type="date"
                            value={partageSuccessoralData.succession.defunt.dateDeces}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, dateDeces: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntLieuDeces">Lieu du décès</Label>
                          <Input
                            id="partageDefuntLieuDeces"
                            value={partageSuccessoralData.succession.defunt.lieuDeces}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, lieuDeces: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntNationalite">Nationalité</Label>
                          <Input
                            id="partageDefuntNationalite"
                            value={partageSuccessoralData.succession.defunt.nationalite}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, nationalite: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntProfession">Profession</Label>
                          <Input
                            id="partageDefuntProfession"
                            value={partageSuccessoralData.succession.defunt.profession}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, profession: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="md:col-span-2">
                          <Label htmlFor="partageDefuntAdresse">Adresse au jour du décès</Label>
                          <Input
                            id="partageDefuntAdresse"
                            value={partageSuccessoralData.succession.defunt.adresseAuDeces}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, adresseAuDeces: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntSituationMatrimoniale">Situation matrimoniale</Label>
                          <Input
                            id="partageDefuntSituationMatrimoniale"
                            value={partageSuccessoralData.succession.defunt.situationMatrimoniale}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, situationMatrimoniale: e.target.value}
                              }
                            })}
                            placeholder="Célibataire, Marié(e), Pacsé(e), Divorcé(e), Veuf/Veuve"
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageDefuntRegime">Régime matrimonial</Label>
                          <Input
                            id="partageDefuntRegime"
                            value={partageSuccessoralData.succession.defunt.regimeMatrimonial}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, regimeMatrimonial: e.target.value}
                              }
                            })}
                            placeholder="Communauté, séparation de biens..."
                          />
                        </div>
                      </div>
                      
                      <div className="space-y-3 mt-4">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="partageDefuntTestaments"
                            checked={partageSuccessoralData.succession.defunt.testamentsExistants}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, testamentsExistants: e.target.checked}
                              }
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="partageDefuntTestaments">Testaments existants</Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="partageDefuntDonationsEntreEpoux"
                            checked={partageSuccessoralData.succession.defunt.donationsEntreEpoux}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, donationsEntreEpoux: e.target.checked}
                              }
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="partageDefuntDonationsEntreEpoux">Donations entre époux</Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="partageDefuntDonationsAnterieures"
                            checked={partageSuccessoralData.succession.defunt.donationsAnterieures}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                defunt: {...partageSuccessoralData.succession.defunt, donationsAnterieures: e.target.checked}
                              }
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="partageDefuntDonationsAnterieures">Donations antérieures aux héritiers</Label>
                        </div>
                      </div>
                    </div>

                    {/* B. Notaire */}
                    <div className="space-y-4 mt-6">
                      <h4 className="font-medium text-md">B. Notaire chargé de la succession</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                          <Label htmlFor="partageNotaireNom">Nom</Label>
                          <Input
                            id="partageNotaireNom"
                            value={partageSuccessoralData.succession.notaire.nom}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                notaire: {...partageSuccessoralData.succession.notaire, nom: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageNotaireEtude">Étude</Label>
                          <Input
                            id="partageNotaireEtude"
                            value={partageSuccessoralData.succession.notaire.etude}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                notaire: {...partageSuccessoralData.succession.notaire, etude: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="md:col-span-2">
                          <Label htmlFor="partageNotaireAdresse">Adresse</Label>
                          <Input
                            id="partageNotaireAdresse"
                            value={partageSuccessoralData.succession.notaire.adresse}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                notaire: {...partageSuccessoralData.succession.notaire, adresse: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageNotaireTelephone">Téléphone</Label>
                          <Input
                            id="partageNotaireTelephone"
                            value={partageSuccessoralData.succession.notaire.telephone}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                notaire: {...partageSuccessoralData.succession.notaire, telephone: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="partageNotaireEmail">Email</Label>
                          <Input
                            id="partageNotaireEmail"
                            type="email"
                            value={partageSuccessoralData.succession.notaire.email}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              succession: {
                                ...partageSuccessoralData.succession,
                                notaire: {...partageSuccessoralData.succession.notaire, email: e.target.value}
                              }
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Section 2: Héritiers / Légataires */}
                  <div className="space-y-4">
                    <div className="flex justify-between items-center">
                      <h3 className="font-semibold text-lg border-b pb-2 flex-1">2. Héritiers / Légataires</h3>
                      <Button
                        type="button"
                        size="sm"
                        onClick={() => {
                          const newId = Date.now();
                          setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            heritiers: [...partageSuccessoralData.heritiers, {
                              id: newId,
                              clientId: "",
                              nom: "", prenom: "", nomNaissance: "", adresse: "",
                              dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "",
                              telephone: "", email: "", lienDefunt: "",
                              heritierReservataire: false, legataireUniversel: false,
                              legataireATitreUniversel: false, legataireParticulier: false,
                              heritierParRepresentation: false, representeQui: "",
                              acceptationRenonciation: "", majeurMineur: "majeur",
                              sousTutelleCuratelle: false, typeProtection: "", tuteurNom: "",
                              quotePart: ""
                            }]
                          });
                          setPartageHeritierFiles({
                            ...partageHeritierFiles,
                            [newId]: []
                          });
                        }}
                        className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                      >
                        + Ajouter un héritier
                      </Button>
                    </div>

                    {partageSuccessoralData.heritiers.map((heritier, index) => (
                      <div key={heritier.id} className="p-4 border rounded-lg space-y-4 bg-gray-50">
                        <div className="flex justify-between items-center">
                          <h4 className="font-medium">Héritier {index + 1}</h4>
                          <Button
                            type="button"
                            variant="destructive"
                            size="sm"
                            onClick={() => {
                              const newHeritiers = partageSuccessoralData.heritiers.filter(h => h.id !== heritier.id);
                              setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                              const newFiles = {...partageHeritierFiles};
                              delete newFiles[heritier.id];
                              setPartageHeritierFiles(newFiles);
                            }}
                          >
                            Supprimer
                          </Button>
                        </div>

                        {/* Sélection client ou saisie manuelle */}
                        <div className="mb-4">
                          <Label htmlFor={`heritier_client_${heritier.id}`}>Choisir un client existant (optionnel)</Label>
                          <select
                            id={`heritier_client_${heritier.id}`}
                            value={heritier.clientId || ""}
                            onChange={(e) => {
                              const clientId = e.target.value;
                              const newHeritiers = [...partageSuccessoralData.heritiers];
                              
                              if (clientId) {
                                const selectedClient = clients.find(c => c.id === clientId);
                                if (selectedClient) {
                                  newHeritiers[index] = {
                                    ...heritier,
                                    clientId: clientId,
                                    nom: selectedClient.nom || "",
                                    prenom: selectedClient.prenom || "",
                                    nomNaissance: selectedClient.nom_naissance || "",
                                    dateNaissance: selectedClient.date_naissance || "",
                                    lieuNaissance: selectedClient.lieu_naissance || "",
                                    nationalite: selectedClient.nationalite || "",
                                    profession: selectedClient.profession || "",
                                    adresse: selectedClient.adresse || "",
                                    telephone: selectedClient.telephone || "",
                                    email: selectedClient.email || "",
                                  };
                                }
                              } else {
                                newHeritiers[index] = {...heritier, clientId: ""};
                              }
                              
                              setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                            }}
                            className="w-full px-3 py-2 border rounded-md"
                          >
                            <option value="">-- Saisie manuelle --</option>
                            {clients.map((client) => (
                              <option key={client.id} value={client.id}>
                                {client.prenom} {client.nom}
                              </option>
                            ))}
                          </select>
                        </div>

                        {/* Informations d'état civil */}
                        <div>
                          <h5 className="font-medium text-sm mb-2">A. Informations d'état civil</h5>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`heritier_nom_${heritier.id}`}>Nom</Label>
                              <Input
                                id={`heritier_nom_${heritier.id}`}
                                value={heritier.nom}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, nom: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_prenom_${heritier.id}`}>Prénom</Label>
                              <Input
                                id={`heritier_prenom_${heritier.id}`}
                                value={heritier.prenom}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, prenom: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_nomNaissance_${heritier.id}`}>Nom de naissance</Label>
                              <Input
                                id={`heritier_nomNaissance_${heritier.id}`}
                                value={heritier.nomNaissance}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, nomNaissance: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_dateNaissance_${heritier.id}`}>Date de naissance</Label>
                              <Input
                                id={`heritier_dateNaissance_${heritier.id}`}
                                type="date"
                                value={heritier.dateNaissance}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, dateNaissance: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_lieuNaissance_${heritier.id}`}>Lieu de naissance</Label>
                              <Input
                                id={`heritier_lieuNaissance_${heritier.id}`}
                                value={heritier.lieuNaissance}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, lieuNaissance: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_nationalite_${heritier.id}`}>Nationalité</Label>
                              <Input
                                id={`heritier_nationalite_${heritier.id}`}
                                value={heritier.nationalite}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, nationalite: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_profession_${heritier.id}`}>Profession</Label>
                              <Input
                                id={`heritier_profession_${heritier.id}`}
                                value={heritier.profession}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, profession: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_telephone_${heritier.id}`}>Téléphone</Label>
                              <Input
                                id={`heritier_telephone_${heritier.id}`}
                                value={heritier.telephone}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, telephone: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_email_${heritier.id}`}>Email</Label>
                              <Input
                                id={`heritier_email_${heritier.id}`}
                                type="email"
                                value={heritier.email}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, email: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`heritier_adresse_${heritier.id}`}>Adresse</Label>
                              <Input
                                id={`heritier_adresse_${heritier.id}`}
                                value={heritier.adresse}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, adresse: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`heritier_lienDefunt_${heritier.id}`}>Lien avec le défunt</Label>
                              <Input
                                id={`heritier_lienDefunt_${heritier.id}`}
                                value={heritier.lienDefunt}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, lienDefunt: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                placeholder="Ex: Fils, Fille, Conjoint..."
                              />
                            </div>
                          </div>
                        </div>

                        {/* Situation juridique */}
                        <div>
                          <h5 className="font-medium text-sm mb-2">B. Situation juridique</h5>
                          <div className="space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`heritier_reservataire_${heritier.id}`}
                                checked={heritier.heritierReservataire}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, heritierReservataire: e.target.checked};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`heritier_reservataire_${heritier.id}`}>Héritier réservataire</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`heritier_legataireUniversel_${heritier.id}`}
                                checked={heritier.legataireUniversel}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, legataireUniversel: e.target.checked};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`heritier_legataireUniversel_${heritier.id}`}>Légataire universel</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`heritier_legataireATitreUniversel_${heritier.id}`}
                                checked={heritier.legataireATitreUniversel}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, legataireATitreUniversel: e.target.checked};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`heritier_legataireATitreUniversel_${heritier.id}`}>Légataire à titre universel</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`heritier_legataireParticulier_${heritier.id}`}
                                checked={heritier.legataireParticulier}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, legataireParticulier: e.target.checked};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`heritier_legataireParticulier_${heritier.id}`}>Légataire particulier</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`heritier_representation_${heritier.id}`}
                                checked={heritier.heritierParRepresentation}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, heritierParRepresentation: e.target.checked};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`heritier_representation_${heritier.id}`}>Héritier par représentation</Label>
                            </div>

                            {heritier.heritierParRepresentation && (
                              <div>
                                <Label htmlFor={`heritier_representeQui_${heritier.id}`}>Représente qui</Label>
                                <Input
                                  id={`heritier_representeQui_${heritier.id}`}
                                  value={heritier.representeQui}
                                  onChange={(e) => {
                                    const newHeritiers = [...partageSuccessoralData.heritiers];
                                    newHeritiers[index] = {...heritier, representeQui: e.target.value};
                                    setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                  }}
                                  placeholder="Nom du représenté"
                                />
                              </div>
                            )}

                            <div>
                              <Label htmlFor={`heritier_acceptation_${heritier.id}`}>Acceptation / Renonciation</Label>
                              <select
                                id={`heritier_acceptation_${heritier.id}`}
                                value={heritier.acceptationRenonciation}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, acceptationRenonciation: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-full px-3 py-2 border rounded-md"
                              >
                                <option value="">-- Sélectionner --</option>
                                <option value="accepte">Accepte</option>
                                <option value="renonce">Renonce</option>
                                <option value="benefice_inventaire">À concurrence de l'actif net (bénéfice d'inventaire)</option>
                              </select>
                            </div>

                            <div>
                              <Label htmlFor={`heritier_majeurMineur_${heritier.id}`}>Majeur / Mineur</Label>
                              <select
                                id={`heritier_majeurMineur_${heritier.id}`}
                                value={heritier.majeurMineur}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, majeurMineur: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-full px-3 py-2 border rounded-md"
                              >
                                <option value="majeur">Majeur</option>
                                <option value="mineur">Mineur</option>
                              </select>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`heritier_tutelleCuratelle_${heritier.id}`}
                                checked={heritier.sousTutelleCuratelle}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, sousTutelleCuratelle: e.target.checked};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`heritier_tutelleCuratelle_${heritier.id}`}>Sous tutelle / curatelle</Label>
                            </div>

                            {heritier.sousTutelleCuratelle && (
                              <>
                                <div>
                                  <Label htmlFor={`heritier_typeProtection_${heritier.id}`}>Type de protection</Label>
                                  <Input
                                    id={`heritier_typeProtection_${heritier.id}`}
                                    value={heritier.typeProtection}
                                    onChange={(e) => {
                                      const newHeritiers = [...partageSuccessoralData.heritiers];
                                      newHeritiers[index] = {...heritier, typeProtection: e.target.value};
                                      setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                    }}
                                    placeholder="Tutelle, curatelle..."
                                  />
                                </div>
                                <div>
                                  <Label htmlFor={`heritier_tuteur_${heritier.id}`}>Nom du tuteur/curateur</Label>
                                  <Input
                                    id={`heritier_tuteur_${heritier.id}`}
                                    value={heritier.tuteurNom}
                                    onChange={(e) => {
                                      const newHeritiers = [...partageSuccessoralData.heritiers];
                                      newHeritiers[index] = {...heritier, tuteurNom: e.target.value};
                                      setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                    }}
                                  />
                                </div>
                              </>
                            )}

                            <div>
                              <Label htmlFor={`heritier_quotePart_${heritier.id}`}>Quote-part</Label>
                              <Input
                                id={`heritier_quotePart_${heritier.id}`}
                                value={heritier.quotePart}
                                onChange={(e) => {
                                  const newHeritiers = [...partageSuccessoralData.heritiers];
                                  newHeritiers[index] = {...heritier, quotePart: e.target.value};
                                  setPartageSuccessoralData({...partageSuccessoralData, heritiers: newHeritiers});
                                }}
                                placeholder="Ex: 1/2, 1/3, 1/4..."
                              />
                            </div>
                          </div>
                        </div>

                        {/* Documents héritier */}
                        <div>
                          <h5 className="font-medium text-sm mb-2">Documents de l'héritier</h5>
                          <MultiFileUpload
                            label="Acte de naissance, pièce d'identité, justificatifs..."
                            files={partageHeritierFiles[heritier.id] || []}
                            onFilesChange={(newFiles) => {
                              setPartageHeritierFiles({
                                ...partageHeritierFiles,
                                [heritier.id]: newFiles
                              });
                            }}
                          />
                        </div>
                      </div>
                    ))}

                    {partageSuccessoralData.heritiers.length === 0 && (
                      <p className="text-sm text-gray-500 italic">Aucun héritier ajouté. Cliquez sur "Ajouter un héritier" pour commencer.</p>
                    )}
                  </div>

                  {/* Section 3: Inventaire complet de l'actif successoral */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">3. Inventaire complet de l'actif successoral</h3>
                    
                    {/* A. Biens immobiliers */}
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">A. Biens immobiliers</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            const newId = Date.now();
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensImmobiliers: [...partageSuccessoralData.actif.biensImmobiliers, {
                                  id: newId,
                                  adresse: "", description: "", designationCadastrale: "",
                                  valeurVenale: "", origineBien: "", quotePartDefunt: "",
                                  etatLocatif: "", loyer: "", hypotheques: "",
                                  copropriete: false, lots: "", chargesCopro: ""
                                }]
                              }
                            });
                            setPartageBienImmobilierFiles({
                              ...partageBienImmobilierFiles,
                              [newId]: []
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter un bien
                        </Button>
                      </div>

                      {partageSuccessoralData.actif.biensImmobiliers.map((bien, index) => (
                        <div key={bien.id} className="p-4 border rounded-lg space-y-3 bg-blue-50">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Bien immobilier {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newBiens = partageSuccessoralData.actif.biensImmobiliers.filter(b => b.id !== bien.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                });
                                const newFiles = {...partageBienImmobilierFiles};
                                delete newFiles[bien.id];
                                setPartageBienImmobilierFiles(newFiles);
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="md:col-span-2">
                              <Label htmlFor={`bien_adresse_${bien.id}`}>Adresse</Label>
                              <Input
                                id={`bien_adresse_${bien.id}`}
                                value={bien.adresse}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, adresse: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`bien_description_${bien.id}`}>Description complète</Label>
                              <Textarea
                                id={`bien_description_${bien.id}`}
                                value={bien.description}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, description: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                                rows={2}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`bien_cadastre_${bien.id}`}>Désignation cadastrale</Label>
                              <Input
                                id={`bien_cadastre_${bien.id}`}
                                value={bien.designationCadastrale}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, designationCadastrale: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`bien_valeur_${bien.id}`}>Valeur vénale (€)</Label>
                              <Input
                                id={`bien_valeur_${bien.id}`}
                                type="number"
                                value={bien.valeurVenale}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, valeurVenale: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`bien_origine_${bien.id}`}>Origine du bien</Label>
                              <select
                                id={`bien_origine_${bien.id}`}
                                value={bien.origineBien}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, origineBien: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                                className="w-full px-3 py-2 border rounded-md"
                              >
                                <option value="">-- Sélectionner --</option>
                                <option value="propre">Propre du défunt</option>
                                <option value="commun">Commun</option>
                                <option value="indivis">Indivis</option>
                              </select>
                            </div>
                            <div>
                              <Label htmlFor={`bien_quotePart_${bien.id}`}>Quote-part du défunt</Label>
                              <Input
                                id={`bien_quotePart_${bien.id}`}
                                value={bien.quotePartDefunt}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, quotePartDefunt: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                                placeholder="Ex: 100%, 50%, 1/3..."
                              />
                            </div>
                            <div>
                              <Label htmlFor={`bien_etatLocatif_${bien.id}`}>État locatif</Label>
                              <Input
                                id={`bien_etatLocatif_${bien.id}`}
                                value={bien.etatLocatif}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, etatLocatif: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                                placeholder="Loué, vacant..."
                              />
                            </div>
                            <div>
                              <Label htmlFor={`bien_loyer_${bien.id}`}>Loyer (€/mois)</Label>
                              <Input
                                id={`bien_loyer_${bien.id}`}
                                type="number"
                                value={bien.loyer}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, loyer: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`bien_hypotheques_${bien.id}`}>Hypothèques</Label>
                              <Textarea
                                id={`bien_hypotheques_${bien.id}`}
                                value={bien.hypotheques}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, hypotheques: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                                rows={2}
                              />
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`bien_copropriete_${bien.id}`}
                                checked={bien.copropriete}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                  newBiens[index] = {...bien, copropriete: e.target.checked};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                  });
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`bien_copropriete_${bien.id}`}>Copropriété</Label>
                            </div>

                            {bien.copropriete && (
                              <>
                                <div>
                                  <Label htmlFor={`bien_lots_${bien.id}`}>Lots</Label>
                                  <Input
                                    id={`bien_lots_${bien.id}`}
                                    value={bien.lots}
                                    onChange={(e) => {
                                      const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                      newBiens[index] = {...bien, lots: e.target.value};
                                      setPartageSuccessoralData({
                                        ...partageSuccessoralData,
                                        actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                      });
                                    }}
                                  />
                                </div>
                                <div>
                                  <Label htmlFor={`bien_charges_${bien.id}`}>Charges (€/an)</Label>
                                  <Input
                                    id={`bien_charges_${bien.id}`}
                                    type="number"
                                    value={bien.chargesCopro}
                                    onChange={(e) => {
                                      const newBiens = [...partageSuccessoralData.actif.biensImmobiliers];
                                      newBiens[index] = {...bien, chargesCopro: e.target.value};
                                      setPartageSuccessoralData({
                                        ...partageSuccessoralData,
                                        actif: {...partageSuccessoralData.actif, biensImmobiliers: newBiens}
                                      });
                                    }}
                                  />
                                </div>
                              </>
                            )}
                          </div>

                          <div>
                            <Label>Documents du bien (titres, diagnostics...)</Label>
                            <MultiFileUpload
                              label="Titre de propriété, diagnostics, expertises..."
                              files={partageBienImmobilierFiles[bien.id] || []}
                              onFilesChange={(newFiles) => {
                                setPartageBienImmobilierFiles({
                                  ...partageBienImmobilierFiles,
                                  [bien.id]: newFiles
                                });
                              }}
                            />
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* B. Biens meubles corporels */}
                    <div className="space-y-4 mt-6">
                      <h4 className="font-medium text-md">B. Biens meubles corporels</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="mobilierForfait"
                            checked={partageSuccessoralData.actif.biensMeubles.mobilierForfait5Pct}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensMeubles: {...partageSuccessoralData.actif.biensMeubles, mobilierForfait5Pct: e.target.checked}
                              }
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="mobilierForfait">Mobilier (forfait 5%)</Label>
                        </div>

                        {!partageSuccessoralData.actif.biensMeubles.mobilierForfait5Pct && (
                          <div>
                            <Label htmlFor="mobilierValeur">Valeur réelle du mobilier (€)</Label>
                            <Input
                              id="mobilierValeur"
                              type="number"
                              value={partageSuccessoralData.actif.biensMeubles.mobilierValeurReelle}
                              onChange={(e) => setPartageSuccessoralData({
                                ...partageSuccessoralData,
                                actif: {
                                  ...partageSuccessoralData.actif,
                                  biensMeubles: {...partageSuccessoralData.actif.biensMeubles, mobilierValeurReelle: e.target.value}
                                }
                              })}
                            />
                          </div>
                        )}

                        <div className="md:col-span-2">
                          <Label htmlFor="vehicules">Véhicules</Label>
                          <Textarea
                            id="vehicules"
                            value={partageSuccessoralData.actif.biensMeubles.vehicules}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensMeubles: {...partageSuccessoralData.actif.biensMeubles, vehicules: e.target.value}
                              }
                            })}
                            rows={2}
                            placeholder="Marque, modèle, immatriculation, valeur..."
                          />
                        </div>

                        <div>
                          <Label htmlFor="bijoux">Bijoux</Label>
                          <Textarea
                            id="bijoux"
                            value={partageSuccessoralData.actif.biensMeubles.bijoux}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensMeubles: {...partageSuccessoralData.actif.biensMeubles, bijoux: e.target.value}
                              }
                            })}
                            rows={2}
                          />
                        </div>

                        <div>
                          <Label htmlFor="oeuvresArt">Œuvres d'art</Label>
                          <Textarea
                            id="oeuvresArt"
                            value={partageSuccessoralData.actif.biensMeubles.oeuvresArt}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensMeubles: {...partageSuccessoralData.actif.biensMeubles, oeuvresArt: e.target.value}
                              }
                            })}
                            rows={2}
                          />
                        </div>

                        <div>
                          <Label htmlFor="collections">Collections</Label>
                          <Textarea
                            id="collections"
                            value={partageSuccessoralData.actif.biensMeubles.collections}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensMeubles: {...partageSuccessoralData.actif.biensMeubles, collections: e.target.value}
                              }
                            })}
                            rows={2}
                          />
                        </div>

                        <div>
                          <Label htmlFor="materielPro">Matériel professionnel</Label>
                          <Textarea
                            id="materielPro"
                            value={partageSuccessoralData.actif.biensMeubles.materielProfessionnel}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensMeubles: {...partageSuccessoralData.actif.biensMeubles, materielProfessionnel: e.target.value}
                              }
                            })}
                            rows={2}
                          />
                        </div>
                      </div>
                    </div>

                    {/* C. Comptes bancaires et placements */}
                    <div className="space-y-4 mt-6">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">C. Comptes bancaires et placements</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                comptesBancaires: [...partageSuccessoralData.actif.comptesBancaires, {
                                  id: Date.now(),
                                  banque: "", typeCompte: "", numeroCompte: "",
                                  soldeAuDeces: "", interetsCourus: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter un compte
                        </Button>
                      </div>

                      {partageSuccessoralData.actif.comptesBancaires.map((compte, index) => (
                        <div key={compte.id} className="p-4 border rounded-lg space-y-3 bg-green-50">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Compte {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newComptes = partageSuccessoralData.actif.comptesBancaires.filter(c => c.id !== compte.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  actif: {...partageSuccessoralData.actif, comptesBancaires: newComptes}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`compte_banque_${compte.id}`}>Banque</Label>
                              <Input
                                id={`compte_banque_${compte.id}`}
                                value={compte.banque}
                                onChange={(e) => {
                                  const newComptes = [...partageSuccessoralData.actif.comptesBancaires];
                                  newComptes[index] = {...compte, banque: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, comptesBancaires: newComptes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`compte_type_${compte.id}`}>Type de compte</Label>
                              <Input
                                id={`compte_type_${compte.id}`}
                                value={compte.typeCompte}
                                onChange={(e) => {
                                  const newComptes = [...partageSuccessoralData.actif.comptesBancaires];
                                  newComptes[index] = {...compte, typeCompte: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, comptesBancaires: newComptes}
                                  });
                                }}
                                placeholder="Courant, Livret A, PEL, LDD..."
                              />
                            </div>
                            <div>
                              <Label htmlFor={`compte_numero_${compte.id}`}>N° de compte</Label>
                              <Input
                                id={`compte_numero_${compte.id}`}
                                value={compte.numeroCompte}
                                onChange={(e) => {
                                  const newComptes = [...partageSuccessoralData.actif.comptesBancaires];
                                  newComptes[index] = {...compte, numeroCompte: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, comptesBancaires: newComptes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`compte_solde_${compte.id}`}>Solde au décès (€)</Label>
                              <Input
                                id={`compte_solde_${compte.id}`}
                                type="number"
                                value={compte.soldeAuDeces}
                                onChange={(e) => {
                                  const newComptes = [...partageSuccessoralData.actif.comptesBancaires];
                                  newComptes[index] = {...compte, soldeAuDeces: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, comptesBancaires: newComptes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`compte_interets_${compte.id}`}>Intérêts courus (€)</Label>
                              <Input
                                id={`compte_interets_${compte.id}`}
                                type="number"
                                value={compte.interetsCourus}
                                onChange={(e) => {
                                  const newComptes = [...partageSuccessoralData.actif.comptesBancaires];
                                  newComptes[index] = {...compte, interetsCourus: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, comptesBancaires: newComptes}
                                  });
                                }}
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* D. Assurance-vie */}
                    <div className="space-y-4 mt-6">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">D. Assurance-vie / Contrats de capitalisation</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                assurancesVie: [...partageSuccessoralData.actif.assurancesVie, {
                                  id: Date.now(),
                                  compagnie: "", numeroContrat: "", beneficiaires: "",
                                  capitalVerse: "", primesAvant70Ans: "", primesApres70Ans: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter un contrat
                        </Button>
                      </div>

                      <p className="text-sm text-gray-600 italic">
                        ℹ️ Les assurances-vie ne rentrent pas dans le partage, mais doivent être mentionnées
                      </p>

                      {partageSuccessoralData.actif.assurancesVie.map((assurance, index) => (
                        <div key={assurance.id} className="p-4 border rounded-lg space-y-3 bg-yellow-50">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Contrat {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newAssurances = partageSuccessoralData.actif.assurancesVie.filter(a => a.id !== assurance.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`assurance_compagnie_${assurance.id}`}>Compagnie</Label>
                              <Input
                                id={`assurance_compagnie_${assurance.id}`}
                                value={assurance.compagnie}
                                onChange={(e) => {
                                  const newAssurances = [...partageSuccessoralData.actif.assurancesVie];
                                  newAssurances[index] = {...assurance, compagnie: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`assurance_numero_${assurance.id}`}>N° de contrat</Label>
                              <Input
                                id={`assurance_numero_${assurance.id}`}
                                value={assurance.numeroContrat}
                                onChange={(e) => {
                                  const newAssurances = [...partageSuccessoralData.actif.assurancesVie];
                                  newAssurances[index] = {...assurance, numeroContrat: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`assurance_beneficiaires_${assurance.id}`}>Bénéficiaires</Label>
                              <Input
                                id={`assurance_beneficiaires_${assurance.id}`}
                                value={assurance.beneficiaires}
                                onChange={(e) => {
                                  const newAssurances = [...partageSuccessoralData.actif.assurancesVie];
                                  newAssurances[index] = {...assurance, beneficiaires: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`assurance_capital_${assurance.id}`}>Capital versé (€)</Label>
                              <Input
                                id={`assurance_capital_${assurance.id}`}
                                type="number"
                                value={assurance.capitalVerse}
                                onChange={(e) => {
                                  const newAssurances = [...partageSuccessoralData.actif.assurancesVie];
                                  newAssurances[index] = {...assurance, capitalVerse: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`assurance_primesAvant70_${assurance.id}`}>Primes avant 70 ans (€)</Label>
                              <Input
                                id={`assurance_primesAvant70_${assurance.id}`}
                                type="number"
                                value={assurance.primesAvant70Ans}
                                onChange={(e) => {
                                  const newAssurances = [...partageSuccessoralData.actif.assurancesVie];
                                  newAssurances[index] = {...assurance, primesAvant70Ans: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`assurance_primesApres70_${assurance.id}`}>Primes après 70 ans (€)</Label>
                              <Input
                                id={`assurance_primesApres70_${assurance.id}`}
                                type="number"
                                value={assurance.primesApres70Ans}
                                onChange={(e) => {
                                  const newAssurances = [...partageSuccessoralData.actif.assurancesVie];
                                  newAssurances[index] = {...assurance, primesApres70Ans: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, assurancesVie: newAssurances}
                                  });
                                }}
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* E. Parts sociales / Entreprises */}
                    <div className="space-y-4 mt-6">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">E. Parts sociales / Entreprises</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                partsSociales: [...partageSuccessoralData.actif.partsSociales, {
                                  id: Date.now(),
                                  nature: "", nomEntite: "", nombreParts: "",
                                  valeurEstimee: "", droitsAttaches: "", pacteDutreil: false
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter une entité
                        </Button>
                      </div>

                      {partageSuccessoralData.actif.partsSociales.map((parts, index) => (
                        <div key={parts.id} className="p-4 border rounded-lg space-y-3 bg-purple-50">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Entité {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newParts = partageSuccessoralData.actif.partsSociales.filter(p => p.id !== parts.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`parts_nature_${parts.id}`}>Nature</Label>
                              <select
                                id={`parts_nature_${parts.id}`}
                                value={parts.nature}
                                onChange={(e) => {
                                  const newParts = [...partageSuccessoralData.actif.partsSociales];
                                  newParts[index] = {...parts, nature: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                  });
                                }}
                                className="w-full px-3 py-2 border rounded-md"
                              >
                                <option value="">-- Sélectionner --</option>
                                <option value="SARL">SARL</option>
                                <option value="SAS">SAS</option>
                                <option value="SCI">SCI</option>
                                <option value="EI">Entreprise Individuelle</option>
                                <option value="exploitation_agricole">Exploitation agricole</option>
                              </select>
                            </div>
                            <div>
                              <Label htmlFor={`parts_nom_${parts.id}`}>Nom de l'entité</Label>
                              <Input
                                id={`parts_nom_${parts.id}`}
                                value={parts.nomEntite}
                                onChange={(e) => {
                                  const newParts = [...partageSuccessoralData.actif.partsSociales];
                                  newParts[index] = {...parts, nomEntite: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`parts_nombre_${parts.id}`}>Nombre de parts</Label>
                              <Input
                                id={`parts_nombre_${parts.id}`}
                                type="number"
                                value={parts.nombreParts}
                                onChange={(e) => {
                                  const newParts = [...partageSuccessoralData.actif.partsSociales];
                                  newParts[index] = {...parts, nombreParts: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`parts_valeur_${parts.id}`}>Valeur estimée (€)</Label>
                              <Input
                                id={`parts_valeur_${parts.id}`}
                                type="number"
                                value={parts.valeurEstimee}
                                onChange={(e) => {
                                  const newParts = [...partageSuccessoralData.actif.partsSociales];
                                  newParts[index] = {...parts, valeurEstimee: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`parts_droits_${parts.id}`}>Droits attachés</Label>
                              <Textarea
                                id={`parts_droits_${parts.id}`}
                                value={parts.droitsAttaches}
                                onChange={(e) => {
                                  const newParts = [...partageSuccessoralData.actif.partsSociales];
                                  newParts[index] = {...parts, droitsAttaches: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                  });
                                }}
                                rows={2}
                              />
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`parts_dutreil_${parts.id}`}
                                checked={parts.pacteDutreil}
                                onChange={(e) => {
                                  const newParts = [...partageSuccessoralData.actif.partsSociales];
                                  newParts[index] = {...parts, pacteDutreil: e.target.checked};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, partsSociales: newParts}
                                  });
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`parts_dutreil_${parts.id}`}>Pacte Dutreil</Label>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* F. Biens à l'étranger */}
                    <div className="space-y-4 mt-6">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">F. Biens à l'étranger</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                biensEtranger: [...partageSuccessoralData.actif.biensEtranger, {
                                  id: Date.now(),
                                  pays: "", adresse: "", valeur: "", regimeFiscal: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter un bien
                        </Button>
                      </div>

                      {partageSuccessoralData.actif.biensEtranger.map((bien, index) => (
                        <div key={bien.id} className="p-4 border rounded-lg space-y-3 bg-red-50">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Bien à l'étranger {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newBiens = partageSuccessoralData.actif.biensEtranger.filter(b => b.id !== bien.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  actif: {...partageSuccessoralData.actif, biensEtranger: newBiens}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`bienEtranger_pays_${bien.id}`}>Pays</Label>
                              <Input
                                id={`bienEtranger_pays_${bien.id}`}
                                value={bien.pays}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensEtranger];
                                  newBiens[index] = {...bien, pays: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensEtranger: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`bienEtranger_valeur_${bien.id}`}>Valeur (€)</Label>
                              <Input
                                id={`bienEtranger_valeur_${bien.id}`}
                                type="number"
                                value={bien.valeur}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensEtranger];
                                  newBiens[index] = {...bien, valeur: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensEtranger: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`bienEtranger_adresse_${bien.id}`}>Adresse</Label>
                              <Input
                                id={`bienEtranger_adresse_${bien.id}`}
                                value={bien.adresse}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensEtranger];
                                  newBiens[index] = {...bien, adresse: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensEtranger: newBiens}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`bienEtranger_regime_${bien.id}`}>Régime fiscal / Convention</Label>
                              <Textarea
                                id={`bienEtranger_regime_${bien.id}`}
                                value={bien.regimeFiscal}
                                onChange={(e) => {
                                  const newBiens = [...partageSuccessoralData.actif.biensEtranger];
                                  newBiens[index] = {...bien, regimeFiscal: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, biensEtranger: newBiens}
                                  });
                                }}
                                rows={2}
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* G. Usufruit / Nue-propriété */}
                    <div className="space-y-4 mt-6">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">G. Usufruit / Nue-propriété</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              actif: {
                                ...partageSuccessoralData.actif,
                                usufruitNuePropriete: [...partageSuccessoralData.actif.usufruitNuePropriete, {
                                  id: Date.now(),
                                  bienConcerne: "", valeurUsufruit: "",
                                  valeurNuePropriete: "", baremeFiscal: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter un démembrement
                        </Button>
                      </div>

                      {partageSuccessoralData.actif.usufruitNuePropriete.map((demembrement, index) => (
                        <div key={demembrement.id} className="p-4 border rounded-lg space-y-3 bg-indigo-50">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Démembrement {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newDemembrement = partageSuccessoralData.actif.usufruitNuePropriete.filter(d => d.id !== demembrement.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  actif: {...partageSuccessoralData.actif, usufruitNuePropriete: newDemembrement}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div className="md:col-span-2">
                              <Label htmlFor={`demembrement_bien_${demembrement.id}`}>Bien concerné</Label>
                              <Input
                                id={`demembrement_bien_${demembrement.id}`}
                                value={demembrement.bienConcerne}
                                onChange={(e) => {
                                  const newDemembrement = [...partageSuccessoralData.actif.usufruitNuePropriete];
                                  newDemembrement[index] = {...demembrement, bienConcerne: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, usufruitNuePropriete: newDemembrement}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`demembrement_usufruit_${demembrement.id}`}>Valeur usufruit (€)</Label>
                              <Input
                                id={`demembrement_usufruit_${demembrement.id}`}
                                type="number"
                                value={demembrement.valeurUsufruit}
                                onChange={(e) => {
                                  const newDemembrement = [...partageSuccessoralData.actif.usufruitNuePropriete];
                                  newDemembrement[index] = {...demembrement, valeurUsufruit: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, usufruitNuePropriete: newDemembrement}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`demembrement_nuePropriete_${demembrement.id}`}>Valeur nue-propriété (€)</Label>
                              <Input
                                id={`demembrement_nuePropriete_${demembrement.id}`}
                                type="number"
                                value={demembrement.valeurNuePropriete}
                                onChange={(e) => {
                                  const newDemembrement = [...partageSuccessoralData.actif.usufruitNuePropriete];
                                  newDemembrement[index] = {...demembrement, valeurNuePropriete: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, usufruitNuePropriete: newDemembrement}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`demembrement_bareme_${demembrement.id}`}>Barème fiscal selon âge</Label>
                              <Input
                                id={`demembrement_bareme_${demembrement.id}`}
                                value={demembrement.baremeFiscal}
                                onChange={(e) => {
                                  const newDemembrement = [...partageSuccessoralData.actif.usufruitNuePropriete];
                                  newDemembrement[index] = {...demembrement, baremeFiscal: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    actif: {...partageSuccessoralData.actif, usufruitNuePropriete: newDemembrement}
                                  });
                                }}
                                placeholder="Ex: 40% / 60% (selon âge)"
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                  </div>

                  {/* SECTION 4 : PASSIF SUCCESSORAL */}
                  <div className="mt-8 p-6 border rounded-lg bg-orange-50">
                    <h3 className="text-lg font-semibold mb-4">4. Passif successoral</h3>

                    {/* Dettes */}
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">Dettes du défunt</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              passif: {
                                ...partageSuccessoralData.passif,
                                dettes: [...partageSuccessoralData.passif.dettes, {
                                  id: Date.now(),
                                  nature: "", creancier: "", montant: "", dateExigibilite: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter une dette
                        </Button>
                      </div>

                      {partageSuccessoralData.passif.dettes.map((dette, index) => (
                        <div key={dette.id} className="p-4 border rounded-lg space-y-3 bg-white">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Dette {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newDettes = partageSuccessoralData.passif.dettes.filter(d => d.id !== dette.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  passif: {...partageSuccessoralData.passif, dettes: newDettes}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`dette_nature_${dette.id}`}>Nature de la dette</Label>
                              <Input
                                id={`dette_nature_${dette.id}`}
                                value={dette.nature}
                                onChange={(e) => {
                                  const newDettes = [...partageSuccessoralData.passif.dettes];
                                  newDettes[index] = {...dette, nature: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    passif: {...partageSuccessoralData.passif, dettes: newDettes}
                                  });
                                }}
                                placeholder="Ex: Prêt immobilier, crédit à la consommation"
                              />
                            </div>
                            <div>
                              <Label htmlFor={`dette_creancier_${dette.id}`}>Créancier</Label>
                              <Input
                                id={`dette_creancier_${dette.id}`}
                                value={dette.creancier}
                                onChange={(e) => {
                                  const newDettes = [...partageSuccessoralData.passif.dettes];
                                  newDettes[index] = {...dette, creancier: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    passif: {...partageSuccessoralData.passif, dettes: newDettes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`dette_montant_${dette.id}`}>Montant (€)</Label>
                              <Input
                                id={`dette_montant_${dette.id}`}
                                type="number"
                                value={dette.montant}
                                onChange={(e) => {
                                  const newDettes = [...partageSuccessoralData.passif.dettes];
                                  newDettes[index] = {...dette, montant: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    passif: {...partageSuccessoralData.passif, dettes: newDettes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`dette_date_${dette.id}`}>Date d'exigibilité</Label>
                              <Input
                                id={`dette_date_${dette.id}`}
                                type="date"
                                value={dette.dateExigibilite}
                                onChange={(e) => {
                                  const newDettes = [...partageSuccessoralData.passif.dettes];
                                  newDettes[index] = {...dette, dateExigibilite: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    passif: {...partageSuccessoralData.passif, dettes: newDettes}
                                  });
                                }}
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Frais funéraires */}
                    <div className="mt-4">
                      <Label htmlFor="fraisFuneraires">Frais funéraires (€)</Label>
                      <Input
                        id="fraisFuneraires"
                        type="number"
                        value={partageSuccessoralData.passif.fraisFuneraires}
                        onChange={(e) => setPartageSuccessoralData({
                          ...partageSuccessoralData,
                          passif: {...partageSuccessoralData.passif, fraisFuneraires: e.target.value}
                        })}
                      />
                    </div>

                    {/* Frais dernière maladie */}
                    <div className="mt-4">
                      <Label htmlFor="fraisDerniereMaladie">Frais de dernière maladie (€)</Label>
                      <Input
                        id="fraisDerniereMaladie"
                        type="number"
                        value={partageSuccessoralData.passif.fraisDerniereMaladie}
                        onChange={(e) => setPartageSuccessoralData({
                          ...partageSuccessoralData,
                          passif: {...partageSuccessoralData.passif, fraisDerniereMaladie: e.target.value}
                        })}
                      />
                    </div>

                    {/* Impôts */}
                    <div className="mt-4 space-y-3">
                      <h4 className="font-medium text-md">Impôts et taxes</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                          <Label htmlFor="impotsRevenus">Impôts sur les revenus (€)</Label>
                          <Input
                            id="impotsRevenus"
                            type="number"
                            value={partageSuccessoralData.passif.impots.revenus}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              passif: {
                                ...partageSuccessoralData.passif,
                                impots: {...partageSuccessoralData.passif.impots, revenus: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="impotsFonciers">Impôts fonciers (€)</Label>
                          <Input
                            id="impotsFonciers"
                            type="number"
                            value={partageSuccessoralData.passif.impots.fonciers}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              passif: {
                                ...partageSuccessoralData.passif,
                                impots: {...partageSuccessoralData.passif.impots, fonciers: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="taxeHabitation">Taxe d'habitation (€)</Label>
                          <Input
                            id="taxeHabitation"
                            type="number"
                            value={partageSuccessoralData.passif.impots.habitation}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              passif: {
                                ...partageSuccessoralData.passif,
                                impots: {...partageSuccessoralData.passif.impots, habitation: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div>
                          <Label htmlFor="autresImpots">Autres impôts (€)</Label>
                          <Input
                            id="autresImpots"
                            type="number"
                            value={partageSuccessoralData.passif.impots.autres}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              passif: {
                                ...partageSuccessoralData.passif,
                                impots: {...partageSuccessoralData.passif.impots, autres: e.target.value}
                              }
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 5 : TYPE DE PARTAGE ET CRÉATION DES LOTS */}
                  <div className="mt-8 p-6 border rounded-lg bg-teal-50">
                    <h3 className="text-lg font-semibold mb-4">5. Type de partage et création des lots</h3>

                    {/* Type de partage */}
                    <div className="mb-6">
                      <Label className="text-md font-medium mb-2 block">Type de partage</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="partage_amiable"
                            name="typePartage"
                            value="amiable"
                            checked={partageSuccessoralData.partage.typePartage === "amiable"}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {...partageSuccessoralData.partage, typePartage: e.target.value}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="partage_amiable">Amiable</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="partage_judiciaire"
                            name="typePartage"
                            value="judiciaire"
                            checked={partageSuccessoralData.partage.typePartage === "judiciaire"}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {...partageSuccessoralData.partage, typePartage: e.target.value}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="partage_judiciaire">Judiciaire</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="partage_attribution_integrale"
                            name="typePartage"
                            value="attribution_integrale"
                            checked={partageSuccessoralData.partage.typePartage === "attribution_integrale"}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {...partageSuccessoralData.partage, typePartage: e.target.value}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="partage_attribution_integrale">Attribution intégrale à un héritier</Label>
                        </div>
                      </div>
                    </div>

                    {/* Lots */}
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">Composition des lots</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {
                                ...partageSuccessoralData.partage,
                                lots: [...partageSuccessoralData.partage.lots, {
                                  id: Date.now(),
                                  numero: partageSuccessoralData.partage.lots.length + 1,
                                  heritierAttributaire: "",
                                  biensInclus: "",
                                  valeurTotale: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter un lot
                        </Button>
                      </div>

                      {partageSuccessoralData.partage.lots.map((lot, index) => (
                        <div key={lot.id} className="p-4 border rounded-lg space-y-3 bg-white">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Lot {lot.numero}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newLots = partageSuccessoralData.partage.lots.filter(l => l.id !== lot.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  partage: {...partageSuccessoralData.partage, lots: newLots}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`lot_heritier_${lot.id}`}>Héritier attributaire</Label>
                              <Input
                                id={`lot_heritier_${lot.id}`}
                                value={lot.heritierAttributaire}
                                onChange={(e) => {
                                  const newLots = [...partageSuccessoralData.partage.lots];
                                  newLots[index] = {...lot, heritierAttributaire: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, lots: newLots}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`lot_valeur_${lot.id}`}>Valeur totale (€)</Label>
                              <Input
                                id={`lot_valeur_${lot.id}`}
                                type="number"
                                value={lot.valeurTotale}
                                onChange={(e) => {
                                  const newLots = [...partageSuccessoralData.partage.lots];
                                  newLots[index] = {...lot, valeurTotale: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, lots: newLots}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`lot_biens_${lot.id}`}>Biens inclus</Label>
                              <Textarea
                                id={`lot_biens_${lot.id}`}
                                value={lot.biensInclus}
                                onChange={(e) => {
                                  const newLots = [...partageSuccessoralData.partage.lots];
                                  newLots[index] = {...lot, biensInclus: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, lots: newLots}
                                  });
                                }}
                                rows={3}
                                placeholder="Détaillez les biens composant ce lot"
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Attributions préférentielles */}
                    <div className="mt-6 space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">Attributions préférentielles</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {
                                ...partageSuccessoralData.partage,
                                attributionsPreferentielles: [...partageSuccessoralData.partage.attributionsPreferentielles, {
                                  id: Date.now(),
                                  heritier: "",
                                  bien: "",
                                  justification: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter une attribution
                        </Button>
                      </div>

                      {partageSuccessoralData.partage.attributionsPreferentielles.map((attribution, index) => (
                        <div key={attribution.id} className="p-4 border rounded-lg space-y-3 bg-white">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Attribution {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newAttrib = partageSuccessoralData.partage.attributionsPreferentielles.filter(a => a.id !== attribution.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  partage: {...partageSuccessoralData.partage, attributionsPreferentielles: newAttrib}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`attrib_heritier_${attribution.id}`}>Héritier</Label>
                              <Input
                                id={`attrib_heritier_${attribution.id}`}
                                value={attribution.heritier}
                                onChange={(e) => {
                                  const newAttrib = [...partageSuccessoralData.partage.attributionsPreferentielles];
                                  newAttrib[index] = {...attribution, heritier: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, attributionsPreferentielles: newAttrib}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`attrib_bien_${attribution.id}`}>Bien concerné</Label>
                              <Input
                                id={`attrib_bien_${attribution.id}`}
                                value={attribution.bien}
                                onChange={(e) => {
                                  const newAttrib = [...partageSuccessoralData.partage.attributionsPreferentielles];
                                  newAttrib[index] = {...attribution, bien: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, attributionsPreferentielles: newAttrib}
                                  });
                                }}
                              />
                            </div>
                            <div className="md:col-span-2">
                              <Label htmlFor={`attrib_justif_${attribution.id}`}>Justification</Label>
                              <Textarea
                                id={`attrib_justif_${attribution.id}`}
                                value={attribution.justification}
                                onChange={(e) => {
                                  const newAttrib = [...partageSuccessoralData.partage.attributionsPreferentielles];
                                  newAttrib[index] = {...attribution, justification: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, attributionsPreferentielles: newAttrib}
                                  });
                                }}
                                rows={2}
                                placeholder="Ex: Logement familial, exploitation agricole"
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Donations à rapporter */}
                    <div className="mt-6 space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">Donations antérieures à rapporter</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {
                                ...partageSuccessoralData.partage,
                                donationsARapporter: [...partageSuccessoralData.partage.donationsARapporter, {
                                  id: Date.now(),
                                  donataire: "",
                                  dateDonation: "",
                                  nature: "",
                                  valeur: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter une donation
                        </Button>
                      </div>

                      {partageSuccessoralData.partage.donationsARapporter.map((donation, index) => (
                        <div key={donation.id} className="p-4 border rounded-lg space-y-3 bg-white">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Donation {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newDonations = partageSuccessoralData.partage.donationsARapporter.filter(d => d.id !== donation.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  partage: {...partageSuccessoralData.partage, donationsARapporter: newDonations}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`donation_donataire_${donation.id}`}>Donataire</Label>
                              <Input
                                id={`donation_donataire_${donation.id}`}
                                value={donation.donataire}
                                onChange={(e) => {
                                  const newDonations = [...partageSuccessoralData.partage.donationsARapporter];
                                  newDonations[index] = {...donation, donataire: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, donationsARapporter: newDonations}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`donation_date_${donation.id}`}>Date de la donation</Label>
                              <Input
                                id={`donation_date_${donation.id}`}
                                type="date"
                                value={donation.dateDonation}
                                onChange={(e) => {
                                  const newDonations = [...partageSuccessoralData.partage.donationsARapporter];
                                  newDonations[index] = {...donation, dateDonation: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, donationsARapporter: newDonations}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`donation_nature_${donation.id}`}>Nature du bien</Label>
                              <Input
                                id={`donation_nature_${donation.id}`}
                                value={donation.nature}
                                onChange={(e) => {
                                  const newDonations = [...partageSuccessoralData.partage.donationsARapporter];
                                  newDonations[index] = {...donation, nature: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, donationsARapporter: newDonations}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`donation_valeur_${donation.id}`}>Valeur à rapporter (€)</Label>
                              <Input
                                id={`donation_valeur_${donation.id}`}
                                type="number"
                                value={donation.valeur}
                                onChange={(e) => {
                                  const newDonations = [...partageSuccessoralData.partage.donationsARapporter];
                                  newDonations[index] = {...donation, valeur: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, donationsARapporter: newDonations}
                                  });
                                }}
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* Soultes */}
                    <div className="mt-6 space-y-4">
                      <div className="flex justify-between items-center">
                        <h4 className="font-medium text-md flex-1">Soultes et compensations</h4>
                        <Button
                          type="button"
                          size="sm"
                          onClick={() => {
                            setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              partage: {
                                ...partageSuccessoralData.partage,
                                soultes: [...partageSuccessoralData.partage.soultes, {
                                  id: Date.now(),
                                  debiteur: "",
                                  creancier: "",
                                  montant: "",
                                  modalitesPaiement: ""
                                }]
                              }
                            });
                          }}
                          className={`ml-2 ${role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white'}`}
                        >
                          + Ajouter une soulte
                        </Button>
                      </div>

                      {partageSuccessoralData.partage.soultes.map((soulte, index) => (
                        <div key={soulte.id} className="p-4 border rounded-lg space-y-3 bg-white">
                          <div className="flex justify-between items-center">
                            <h5 className="font-medium">Soulte {index + 1}</h5>
                            <Button
                              type="button"
                              variant="destructive"
                              size="sm"
                              onClick={() => {
                                const newSoultes = partageSuccessoralData.partage.soultes.filter(s => s.id !== soulte.id);
                                setPartageSuccessoralData({
                                  ...partageSuccessoralData,
                                  partage: {...partageSuccessoralData.partage, soultes: newSoultes}
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                              <Label htmlFor={`soulte_debiteur_${soulte.id}`}>Débiteur</Label>
                              <Input
                                id={`soulte_debiteur_${soulte.id}`}
                                value={soulte.debiteur}
                                onChange={(e) => {
                                  const newSoultes = [...partageSuccessoralData.partage.soultes];
                                  newSoultes[index] = {...soulte, debiteur: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, soultes: newSoultes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`soulte_creancier_${soulte.id}`}>Créancier</Label>
                              <Input
                                id={`soulte_creancier_${soulte.id}`}
                                value={soulte.creancier}
                                onChange={(e) => {
                                  const newSoultes = [...partageSuccessoralData.partage.soultes];
                                  newSoultes[index] = {...soulte, creancier: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, soultes: newSoultes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`soulte_montant_${soulte.id}`}>Montant (€)</Label>
                              <Input
                                id={`soulte_montant_${soulte.id}`}
                                type="number"
                                value={soulte.montant}
                                onChange={(e) => {
                                  const newSoultes = [...partageSuccessoralData.partage.soultes];
                                  newSoultes[index] = {...soulte, montant: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, soultes: newSoultes}
                                  });
                                }}
                              />
                            </div>
                            <div>
                              <Label htmlFor={`soulte_modalites_${soulte.id}`}>Modalités de paiement</Label>
                              <Input
                                id={`soulte_modalites_${soulte.id}`}
                                value={soulte.modalitesPaiement}
                                onChange={(e) => {
                                  const newSoultes = [...partageSuccessoralData.partage.soultes];
                                  newSoultes[index] = {...soulte, modalitesPaiement: e.target.value};
                                  setPartageSuccessoralData({
                                    ...partageSuccessoralData,
                                    partage: {...partageSuccessoralData.partage, soultes: newSoultes}
                                  });
                                }}
                                placeholder="Ex: Comptant, échéancier"
                              />
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  {/* SECTION 6 : DÉCLARATIONS ET CLAUSES */}
                  <div className="mt-8 p-6 border rounded-lg bg-pink-50">
                    <h3 className="text-lg font-semibold mb-4">6. Déclarations et clauses particulières</h3>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="declarationNonOmission"
                          checked={partageSuccessoralData.declarations.nonOmissionBiens}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, nonOmissionBiens: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="declarationNonOmission">Déclaration de non-omission de biens</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="accordUnanimeTousParts"
                          checked={partageSuccessoralData.declarations.accordUnanimeTousParts}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, accordUnanimeTousParts: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="accordUnanimeTousParts">Accord unanime de toutes les parties</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="renoncationRecours"
                          checked={partageSuccessoralData.declarations.renoncationRecours}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, renoncationRecours: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="renoncationRecours">Renonciation à tout recours</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="garantieEviction"
                          checked={partageSuccessoralData.declarations.garantieEviction}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, garantieEviction: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="garantieEviction">Garantie d'éviction</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="maintenIndivision"
                          checked={partageSuccessoralData.declarations.maintenIndivision}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, maintenIndivision: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="maintenIndivision">Maintien en indivision de certains biens</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="egaliteEnValeur"
                          checked={partageSuccessoralData.declarations.egaliteEnValeur}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, egaliteEnValeur: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="egaliteEnValeur">Égalité en valeur des lots</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="reserveHereditaire"
                          checked={partageSuccessoralData.declarations.reserveHereditaire}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, reserveHereditaire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="reserveHereditaire">Respect de la réserve héréditaire</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="quotiteDisponible"
                          checked={partageSuccessoralData.declarations.quotiteDisponible}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, quotiteDisponible: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="quotiteDisponible">Respect de la quotité disponible</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="prixValeurs"
                          checked={partageSuccessoralData.declarations.prixValeurs}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, prixValeurs: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="prixValeurs">Les prix et valeurs sont sincères</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="evaluationAmiable"
                          checked={partageSuccessoralData.declarations.evaluationAmiable}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, evaluationAmiable: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="evaluationAmiable">Évaluation amiable des biens</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="expertiseJudiciaire"
                          checked={partageSuccessoralData.declarations.expertiseJudiciaire}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, expertiseJudiciaire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="expertiseJudiciaire">Expertise judiciaire réalisée</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="tirageSortLots"
                          checked={partageSuccessoralData.declarations.tirageSortLots}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, tirageSortLots: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="tirageSortLots">Tirage au sort des lots</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="choixAmiableLots"
                          checked={partageSuccessoralData.declarations.choixAmiableLots}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, choixAmiableLots: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="choixAmiableLots">Choix amiable des lots</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="paiementSoulteComptant"
                          checked={partageSuccessoralData.declarations.paiementSoulteComptant}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, paiementSoulteComptant: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="paiementSoulteComptant">Paiement des soultes comptant</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="echelonnementSoultes"
                          checked={partageSuccessoralData.declarations.echelonnementSoultes}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, echelonnementSoultes: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="echelonnementSoultes">Échelonnement du paiement des soultes</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="clauseIndivisionResiduelle"
                          checked={partageSuccessoralData.declarations.clauseIndivisionResiduelle}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            declarations: {...partageSuccessoralData.declarations, clauseIndivisionResiduelle: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="clauseIndivisionResiduelle">Clause d'indivision résiduelle</Label>
                      </div>

                      {partageSuccessoralData.declarations.clauseIndivisionResiduelle && (
                        <div className="ml-6 mt-2">
                          <Label htmlFor="biensIndivisionResiduelle">Biens concernés par l'indivision résiduelle</Label>
                          <Textarea
                            id="biensIndivisionResiduelle"
                            value={partageSuccessoralData.declarations.biensIndivisionResiduelle}
                            onChange={(e) => setPartageSuccessoralData({
                              ...partageSuccessoralData,
                              declarations: {...partageSuccessoralData.declarations, biensIndivisionResiduelle: e.target.value}
                            })}
                            rows={3}
                            placeholder="Détaillez les biens qui resteront en indivision"
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* SECTION 7 : FORMALITÉS */}
                  <div className="mt-8 p-6 border rounded-lg bg-cyan-50">
                    <h3 className="text-lg font-semibold mb-4">7. Formalités et obligations</h3>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="declarationSuccession"
                          checked={partageSuccessoralData.formalites.declarationSuccession}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, declarationSuccession: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="declarationSuccession">Déclaration de succession déposée</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="paiementDroitsSuccession"
                          checked={partageSuccessoralData.formalites.paiementDroitsSuccession}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, paiementDroitsSuccession: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="paiementDroitsSuccession">Droits de succession acquittés</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="publicationConservation"
                          checked={partageSuccessoralData.formalites.publicationConservation}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, publicationConservation: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="publicationConservation">Publication à la conservation des hypothèques</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mentionActesDeces"
                          checked={partageSuccessoralData.formalites.mentionActesDeces}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, mentionActesDeces: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="mentionActesDeces">Mention sur les actes de décès</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="notificationCoheritiers"
                          checked={partageSuccessoralData.formalites.notificationCoheritiers}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, notificationCoheritiers: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="notificationCoheritiers">Notification aux cohéritiers</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="attestationPropriete"
                          checked={partageSuccessoralData.formalites.attestationPropriete}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, attestationPropriete: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="attestationPropriete">Attestation de propriété établie</Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="certificatInscriptionPrivileges"
                          checked={partageSuccessoralData.formalites.certificatInscriptionPrivileges}
                          onChange={(e) => setPartageSuccessoralData({
                            ...partageSuccessoralData,
                            formalites: {...partageSuccessoralData.formalites, certificatInscriptionPrivileges: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="certificatInscriptionPrivileges">Certificat d'inscription de privilèges et hypothèques</Label>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 8 : PIÈCES JUSTIFICATIVES */}
                  <div className="mt-8 p-6 border rounded-lg bg-amber-50">
                    <h3 className="text-lg font-semibold mb-4">8. Pièces justificatives</h3>

                    <div className="space-y-6">
                      {/* Documents défunt */}
                      <div>
                        <Label className="text-md font-medium mb-2 block">Documents relatifs au défunt</Label>
                        <div className="space-y-2">
                          <div>
                            <Label>Acte de décès</Label>
                            <MultiFileUpload
                              files={partageDefuntActeDeces}
                              onChange={setPartageDefuntActeDeces}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Livret de famille</Label>
                            <MultiFileUpload
                              files={partageDefuntLivretFamille}
                              onChange={setPartageDefuntLivretFamille}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Contrat de mariage / PACS</Label>
                            <MultiFileUpload
                              files={partageDefuntContratMariage}
                              onChange={setPartageDefuntContratMariage}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Testaments</Label>
                            <MultiFileUpload
                              files={partageDefuntTestaments}
                              onChange={setPartageDefuntTestaments}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Donations entre époux</Label>
                            <MultiFileUpload
                              files={partageDefuntDonationsEntreEpoux}
                              onChange={setPartageDefuntDonationsEntreEpoux}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Donations antérieures</Label>
                            <MultiFileUpload
                              files={partageDefuntDonationsAnterieures}
                              onChange={setPartageDefuntDonationsAnterieures}
                              label=""
                            />
                          </div>
                        </div>
                      </div>

                      {/* Documents biens */}
                      <div>
                        <Label className="text-md font-medium mb-2 block">Documents relatifs aux biens</Label>
                        <div className="space-y-2">
                          <div>
                            <Label>Titres de propriété</Label>
                            <MultiFileUpload
                              files={partageDefuntTitresPropriete}
                              onChange={setPartageDefuntTitresPropriete}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Relevés bancaires</Label>
                            <MultiFileUpload
                              files={partageDefuntRelevesBancaires}
                              onChange={setPartageDefuntRelevesBancaires}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Bilans entreprises / parts sociales</Label>
                            <MultiFileUpload
                              files={partageDefuntBilansEntreprises}
                              onChange={setPartageDefuntBilansEntreprises}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Inventaire mobilier</Label>
                            <MultiFileUpload
                              files={partageDefuntInventaireMobilier}
                              onChange={setPartageDefuntInventaireMobilier}
                              label=""
                            />
                          </div>
                        </div>
                      </div>

                      {/* Autres documents */}
                      <div>
                        <Label className="text-md font-medium mb-2 block">Autres documents</Label>
                        <div className="space-y-2">
                          <div>
                            <Label>Diagnostics immobiliers</Label>
                            <MultiFileUpload
                              files={partageAutresDiagnostics}
                              onChange={setPartageAutresDiagnostics}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Évaluations / expertises</Label>
                            <MultiFileUpload
                              files={partageAutresEvaluations}
                              onChange={setPartageAutresEvaluations}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Statuts de sociétés</Label>
                            <MultiFileUpload
                              files={partageAutresStatutsSocietes}
                              onChange={setPartageAutresStatutsSocietes}
                              label=""
                            />
                          </div>
                          <div>
                            <Label>Autres documents</Label>
                            <MultiFileUpload
                              files={partageAutresDocuments}
                              onChange={setPartageAutresDocuments}
                              label=""
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Procuration authentique */}
            {pendingContractType === "Procuration authentique" && (
              <>
                <div className="space-y-6">
                  {/* Type de procuration */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Type de procuration (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Sélectionnez le type de procuration *</Label>
                      <Select 
                        value={procurationData.typeProcuration} 
                        onValueChange={(value) => setProcurationData({...procurationData, typeProcuration: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="generale">☐ Procuration générale</SelectItem>
                          <SelectItem value="speciale">☐ Procuration spéciale</SelectItem>
                          <SelectItem value="immobiliere">☐ Procuration immobilière</SelectItem>
                          <SelectItem value="bancaire">☐ Procuration bancaire</SelectItem>
                          <SelectItem value="fiscale">☐ Procuration fiscale</SelectItem>
                          <SelectItem value="ssp">☐ Procuration pour signature d'acte sous seing privé</SelectItem>
                          <SelectItem value="internationale">☐ Procuration internationale</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    {["speciale", "immobiliere", "bancaire", "fiscale"].includes(procurationData.typeProcuration) && (
                      <div className="space-y-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <Label>Acte(s) précisément visé(s) (OBLIGATOIRE) *</Label>
                        <Textarea 
                          value={procurationData.actesVises} 
                          onChange={(e) => setProcurationData({...procurationData, actesVises: e.target.value})} 
                          rows={3}
                          placeholder="Décrivez précisément le ou les actes pour lesquels cette procuration est donnée..."
                          className="border-yellow-300"
                        />
                      </div>
                    )}
                  </div>

                  {/* Identité du mandant */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du MANDANT (OBLIGATOIRE)</h3>
                    
                    <div className="space-y-2">
                      <Label>Sélectionner un client existant (optionnel)</Label>
                      <Select
                        value={procurationData.mandant.clientId}
                        onValueChange={(value) => {
                          const selectedClient = clients.find(c => c.id === value) as any;
                          if (selectedClient) {
                            // Extraire la situation familiale
                            let situationFamiliale = "";
                            if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
                              situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
                            } else if (typeof selectedClient.situation_familiale === 'string') {
                              situationFamiliale = selectedClient.situation_familiale;
                            }

                            setProcurationData({
                              ...procurationData,
                              mandant: { 
                                ...procurationData.mandant, 
                                clientId: value, 
                                isClient: true,
                                nom: selectedClient.nom || "",
                                prenom: selectedClient.prenom || "",
                                dateNaissance: selectedClient.date_naissance || "",
                                lieuNaissance: selectedClient.lieu_naissance || "",
                                nationalite: selectedClient.nationalite || "",
                                profession: selectedClient.profession || "",
                                adresseComplete: selectedClient.adresse || "",
                                telephone: selectedClient.telephone || "",
                                email: selectedClient.email || "",
                                situationMatrimoniale: situationFamiliale || selectedClient.situation_matrimoniale || "",
                                typeIdentite: selectedClient.type_identite || "",
                                numeroIdentite: selectedClient.numero_identite || "",
                                dateEmissionIdentite: selectedClient.date_expiration_identite || "",
                              }
                            });

                            // Charger le document d'identité
                            if (selectedClient.id_doc_path) {
                              supabase.storage
                                .from('documents')
                                .createSignedUrl(selectedClient.id_doc_path, 3600)
                                .then(({ data, error }) => {
                                  if (!error && data?.signedUrl) {
                                    setProcurationMandantIdentiteUrl(data.signedUrl);
                                  }
                                });
                            } else {
                              // Chercher dans client_documents
                              supabase
                                .from('client_documents')
                                .select('file_path')
                                .eq('client_id', selectedClient.id)
                                .eq('document_type', 'piece_identite')
                                .order('uploaded_at', { ascending: false })
                                .limit(1)
                                .then(({ data: docs }) => {
                                  if (docs && docs.length > 0) {
                                    supabase.storage
                                      .from('documents')
                                      .createSignedUrl(docs[0].file_path, 3600)
                                      .then(({ data, error }) => {
                                        if (!error && data?.signedUrl) {
                                          setProcurationMandantIdentiteUrl(data.signedUrl);
                                        }
                                      });
                                  }
                                });
                            }
                          }
                        }}
                      >
                        <SelectTrigger>
                          <SelectValue placeholder="Choisir un client..." />
                        </SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.nom} {client.prenom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom *</Label>
                        <Input value={procurationData.mandant.nom} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, nom: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom *</Label>
                        <Input value={procurationData.mandant.prenom} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, prenom: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input value={procurationData.mandant.nomNaissance} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, nomNaissance: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de naissance *</Label>
                        <Input type="date" value={procurationData.mandant.dateNaissance} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, dateNaissance: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input value={procurationData.mandant.lieuNaissance} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, lieuNaissance: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input value={procurationData.mandant.nationalite} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, nationalite: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input value={procurationData.mandant.profession} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, profession: e.target.value}})} />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Adresse complète *</Label>
                      <Textarea value={procurationData.mandant.adresseComplete} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, adresseComplete: e.target.value}})} rows={2} />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input value={procurationData.mandant.telephone} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, telephone: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input type="email" value={procurationData.mandant.email} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, email: e.target.value}})} />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Situation matrimoniale</Label>
                      <Input 
                        value={procurationData.mandant.situationMatrimoniale} 
                        onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, situationMatrimoniale: e.target.value}})}
                        placeholder="Renseignée automatiquement si client sélectionné"
                      />
                    </div>

                    {(procurationData.mandant.situationMatrimoniale === "marie" || procurationData.mandant.situationMatrimoniale === "pacse") && (
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="space-y-2">
                          <Label>Régime matrimonial</Label>
                          <Input value={procurationData.mandant.regimeMatrimonial} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, regimeMatrimonial: e.target.value}})} placeholder="Ex: Communauté légale" />
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du conjoint</Label>
                          <Input value={procurationData.mandant.conjointNom} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, conjointNom: e.target.value}})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du conjoint</Label>
                          <Input value={procurationData.mandant.conjointPrenom} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, conjointPrenom: e.target.value}})} />
                        </div>
                      </div>
                    )}

                    <div className="space-y-2">
                      <Label>Capacité juridique</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="majeur_capable"
                            value="majeur_capable"
                            checked={procurationData.mandant.capaciteJuridique === "majeur_capable"}
                            onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, capaciteJuridique: e.target.value}})}
                          />
                          <Label htmlFor="majeur_capable" className="cursor-pointer font-normal">☐ Majeur capable</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="sous_protection"
                            value="sous_protection"
                            checked={procurationData.mandant.capaciteJuridique === "sous_protection"}
                            onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, capaciteJuridique: e.target.value}})}
                          />
                          <Label htmlFor="sous_protection" className="cursor-pointer font-normal">☐ Sous mesure de protection</Label>
                        </div>
                      </div>
                    </div>

                    {procurationData.mandant.capaciteJuridique === "sous_protection" && (
                      <div className="space-y-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <div className="space-y-2">
                          <Label>Type de mesure *</Label>
                          <Select value={procurationData.mandant.typeMesureProtection} onValueChange={(value) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, typeMesureProtection: value}})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="tutelle">Tutelle</SelectItem>
                              <SelectItem value="curatelle">Curatelle</SelectItem>
                              <SelectItem value="sauvegarde">Sauvegarde de justice</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="autorisation"
                            checked={procurationData.mandant.autorisationJointe}
                            onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, autorisationJointe: e.target.checked}})}
                            className="rounded"
                          />
                          <Label htmlFor="autorisation" className="cursor-pointer font-normal">Autorisation jointe (PDF)</Label>
                        </div>
                        <div className="text-sm text-yellow-700">
                          ⚠️ Joindre le jugement de protection et l'autorisation du juge/curateur
                        </div>
                      </div>
                    )}

                    <div className="space-y-2">
                      <Label className="font-semibold">Pièce d'identité du mandant (OBLIGATOIRE)</Label>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de pièce *</Label>
                        <Select value={procurationData.mandant.typeIdentite} onValueChange={(value) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, typeIdentite: value}})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CNI">Carte Nationale d'Identité (CNI)</SelectItem>
                            <SelectItem value="Passeport">Passeport</SelectItem>
                            <SelectItem value="Titre de séjour">Titre de séjour</SelectItem>
                            <SelectItem value="Permis de conduire">Permis de conduire</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Numéro *</Label>
                        <Input value={procurationData.mandant.numeroIdentite} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, numeroIdentite: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date d'émission</Label>
                        <Input type="date" value={procurationData.mandant.dateEmissionIdentite} onChange={(e) => setProcurationData({...procurationData, mandant: {...procurationData.mandant, dateEmissionIdentite: e.target.value}})} />
                      </div>
                    </div>

                    {/* Pièce d'identité du mandant */}
                    {procurationData.mandant.clientId ? (
                      <div className="space-y-2">
                        <Label>📎 Pièce d'identité du mandant</Label>
                        {procurationMandantIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(procurationMandantIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    ) : (
                      <div className="space-y-2">
                        <Label>📎 Pièce d'identité du mandant</Label>
                        <button
                          type="button"
                          onClick={() => {
                            const input = document.createElement('input');
                            input.type = 'file';
                            input.accept = '.pdf,.jpg,.jpeg,.png';
                            input.onchange = (e: any) => {
                              console.log('Upload fichier mandant:', e.target.files?.[0]);
                              // TODO: Gérer l'upload et stocker le nom du fichier
                            };
                            input.click();
                          }}
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                        >
                          <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                          </svg>
                          <span className="text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                      </div>
                    )}
                  </div>

                  {/* Identité du mandataire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du MANDATAIRE (OBLIGATOIRE)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom *</Label>
                        <Input value={procurationData.mandataire.nom} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, nom: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom *</Label>
                        <Input value={procurationData.mandataire.prenom} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, prenom: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input value={procurationData.mandataire.nomNaissance} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, nomNaissance: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de naissance</Label>
                        <Input type="date" value={procurationData.mandataire.dateNaissance} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, dateNaissance: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input value={procurationData.mandataire.lieuNaissance} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, lieuNaissance: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input value={procurationData.mandataire.nationalite} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, nationalite: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input value={procurationData.mandataire.profession} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, profession: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input value={procurationData.mandataire.telephone} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, telephone: e.target.value}})} />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Adresse complète *</Label>
                      <Textarea value={procurationData.mandataire.adresseComplete} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, adresseComplete: e.target.value}})} rows={2} />
                    </div>

                    <div className="space-y-2">
                      <Label>Email (optionnel mais recommandé)</Label>
                      <Input type="email" value={procurationData.mandataire.email} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, email: e.target.value}})} />
                    </div>

                    <div className="space-y-2">
                      <Label>Lien avec le mandant</Label>
                      <Select value={procurationData.mandataire.lienMandant} onValueChange={(value) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, lienMandant: value}})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="conjoint">Conjoint</SelectItem>
                          <SelectItem value="parent">Parent</SelectItem>
                          <SelectItem value="enfant">Enfant</SelectItem>
                          <SelectItem value="ami">Ami</SelectItem>
                          <SelectItem value="avocat">Avocat</SelectItem>
                          <SelectItem value="notaire">Notaire</SelectItem>
                          <SelectItem value="tiers_professionnel">Tiers professionnel</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label className="font-semibold">Pièce d'identité du mandataire (OBLIGATOIRE)</Label>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de pièce *</Label>
                        <Select value={procurationData.mandataire.typeIdentite} onValueChange={(value) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, typeIdentite: value}})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CNI">Carte Nationale d'Identité (CNI)</SelectItem>
                            <SelectItem value="Passeport">Passeport</SelectItem>
                            <SelectItem value="Titre de séjour">Titre de séjour</SelectItem>
                            <SelectItem value="Permis de conduire">Permis de conduire</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Numéro *</Label>
                        <Input value={procurationData.mandataire.numeroIdentite} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, numeroIdentite: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date d'émission</Label>
                        <Input type="date" value={procurationData.mandataire.dateEmissionIdentite} onChange={(e) => setProcurationData({...procurationData, mandataire: {...procurationData.mandataire, dateEmissionIdentite: e.target.value}})} />
                      </div>
                    </div>

                    {/* Pièce d'identité du mandataire */}
                    <div className="space-y-2">
                      <Label>📎 Copie de la pièce</Label>
                      {procurationMandataireIdentiteFile ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée : {procurationMandataireIdentiteFile.name}</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => {
                              const url = URL.createObjectURL(procurationMandataireIdentiteFile);
                              window.open(url, '_blank');
                            }}
                          >
                            <Eye className="w-4 h-4" />
                          </Button>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-red-600 hover:bg-red-700 text-white"
                            onClick={() => setProcurationMandataireIdentiteFile(null)}
                          >
                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </Button>
                        </div>
                      ) : (
                        <button
                          type="button"
                          onClick={() => {
                            const input = document.createElement('input');
                            input.type = 'file';
                            input.accept = '.pdf,.jpg,.jpeg,.png';
                            input.onchange = (e: any) => {
                              const file = e.target.files?.[0];
                              if (file) {
                                setProcurationMandataireIdentiteFile(file);
                              }
                            };
                            input.click();
                          }}
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                        >
                          <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                          </svg>
                          <span className="text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                      )}
                    </div>
                  </div>

                  {/* Objet précis de la procuration */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">OBJET PRÉCIS DE LA PROCURATION (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Description précise et détaillée de l'objet *</Label>
                      <Textarea 
                        value={procurationData.objet.descriptionPrecise} 
                        onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, descriptionPrecise: e.target.value}})} 
                        rows={4}
                        placeholder="Décrivez précisément l'objet de la procuration..."
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Liste exhaustive des actes autorisés *</Label>
                      <Textarea 
                        value={procurationData.objet.listeActesAutorises} 
                        onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, listeActesAutorises: e.target.value}})} 
                        rows={3}
                        placeholder="Listez tous les actes pour lesquels la procuration est donnée..."
                      />
                    </div>
                    
                    <div className="space-y-2 p-4 bg-gray-50 border rounded-lg">
                      <Label className="font-semibold">Facultés du mandataire</Label>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="faculte_signer"
                          checked={procurationData.objet.faculteSignerActes}
                          onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, faculteSignerActes: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="faculte_signer" className="cursor-pointer font-normal">Faculté de signer tous actes nécessaires à l'exécution</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="faculte_recevoir"
                          checked={procurationData.objet.faculteRecevoirSommes}
                          onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, faculteRecevoirSommes: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="faculte_recevoir" className="cursor-pointer font-normal">Faculté de recevoir sommes / donner quittance</Label>
                      </div>
                    </div>

                    {/* Cas particulier : Procuration immobilière */}
                    {procurationData.typeProcuration === "immobiliere" && (
                      <div className="space-y-4 p-4 bg-blue-50 border border-gray-200 rounded-lg">
                        <Label className="font-semibold text-blue-900">➡️ Procuration immobilière - Précisions</Label>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_vente"
                              checked={procurationData.objet.immobilierVente}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierVente: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_vente" className="cursor-pointer font-normal">Vente</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_achat"
                              checked={procurationData.objet.immobilierAchat}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierAchat: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_achat" className="cursor-pointer font-normal">Achat</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_hypotheque"
                              checked={procurationData.objet.immobilierHypotheque}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierHypotheque: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_hypotheque" className="cursor-pointer font-normal">Hypothèque</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_mainlevee"
                              checked={procurationData.objet.immobilierMainlevee}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierMainlevee: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_mainlevee" className="cursor-pointer font-normal">Mainlevée</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_avant_contrats"
                              checked={procurationData.objet.immobilierSignatureAvantContrats}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierSignatureAvantContrats: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_avant_contrats" className="cursor-pointer font-normal">Signature de tous avant-contrats et actes définitifs</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_conditions"
                              checked={procurationData.objet.immobilierAcceptationConditions}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierAcceptationConditions: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_conditions" className="cursor-pointer font-normal">Acceptation / renonciation aux conditions suspensives</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="immo_percevoir"
                              checked={procurationData.objet.immobilierPercevoirPrix}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, immobilierPercevoirPrix: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="immo_percevoir" className="cursor-pointer font-normal">Faculté de percevoir le prix</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="faculte_substituer"
                              checked={procurationData.objet.faculteSubstituer}
                              onChange={(e) => setProcurationData({...procurationData, objet: {...procurationData.objet, faculteSubstituer: e.target.checked}})}
                              className="rounded"
                            />
                            <Label htmlFor="faculte_substituer" className="cursor-pointer font-normal">Faculté de substituer</Label>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* ÉTENDUE DES POUVOIRS ET LIMITES */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">ÉTENDUE DES POUVOIRS ET LIMITES (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Étendue des pouvoirs *</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="etendue_large"
                            value="tres_large"
                            checked={procurationData.etendue.typeEtendue === "tres_large"}
                            onChange={(e) => setProcurationData({...procurationData, etendue: {...procurationData.etendue, typeEtendue: e.target.value}})}
                          />
                          <Label htmlFor="etendue_large" className="cursor-pointer font-normal">☐ Très large</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="etendue_limitee"
                            value="limitee"
                            checked={procurationData.etendue.typeEtendue === "limitee"}
                            onChange={(e) => setProcurationData({...procurationData, etendue: {...procurationData.etendue, typeEtendue: e.target.value}})}
                          />
                          <Label htmlFor="etendue_limitee" className="cursor-pointer font-normal">☐ Limitée (préciser)</Label>
                        </div>
                      </div>
                    </div>

                    {procurationData.etendue.typeEtendue === "limitee" && (
                      <div className="space-y-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <Label>Précisions sur les limites *</Label>
                        <Textarea 
                          value={procurationData.etendue.precisionsLimitees} 
                          onChange={(e) => setProcurationData({...procurationData, etendue: {...procurationData.etendue, precisionsLimitees: e.target.value}})} 
                          rows={2}
                          placeholder="Précisez les limites de la procuration..."
                        />
                      </div>
                    )}

                    <div className="space-y-2">
                      <Label>Actes expressément exclus (champ texte)</Label>
                      <Textarea 
                        value={procurationData.etendue.actesExclus} 
                        onChange={(e) => setProcurationData({...procurationData, etendue: {...procurationData.etendue, actesExclus: e.target.value}})} 
                        rows={2}
                        placeholder="Listez les actes explicitement exclus de la procuration..."
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Subdélégation</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="subdel_autorisee"
                            value="autorisee"
                            checked={procurationData.etendue.subdelegation === "autorisee"}
                            onChange={(e) => setProcurationData({...procurationData, etendue: {...procurationData.etendue, subdelegation: e.target.value}})}
                          />
                          <Label htmlFor="subdel_autorisee" className="cursor-pointer font-normal">☐ Autorisée</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="subdel_interdite"
                            value="interdite"
                            checked={procurationData.etendue.subdelegation === "interdite"}
                            onChange={(e) => setProcurationData({...procurationData, etendue: {...procurationData.etendue, subdelegation: e.target.value}})}
                          />
                          <Label htmlFor="subdel_interdite" className="cursor-pointer font-normal">☐ Interdite</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* DURÉE - RÉVOCATION */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">DURÉE - RÉVOCATION (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Durée *</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="duree_indeterminee"
                            value="indeterminee"
                            checked={procurationData.duree.type === "indeterminee"}
                            onChange={(e) => setProcurationData({...procurationData, duree: {...procurationData.duree, type: e.target.value}})}
                          />
                          <Label htmlFor="duree_indeterminee" className="cursor-pointer font-normal">☐ Durée indéterminée</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="duree_determinee"
                            value="determinee"
                            checked={procurationData.duree.type === "determinee"}
                            onChange={(e) => setProcurationData({...procurationData, duree: {...procurationData.duree, type: e.target.value}})}
                          />
                          <Label htmlFor="duree_determinee" className="cursor-pointer font-normal">☐ Durée déterminée (date de fin)</Label>
                        </div>
                      </div>
                    </div>
                    
                    {procurationData.duree.type === "determinee" && (
                      <div className="space-y-2">
                        <Label>Date de fin *</Label>
                        <Input type="date" value={procurationData.duree.dateFin} onChange={(e) => setProcurationData({...procurationData, duree: {...procurationData.duree, dateFin: e.target.value}})} />
                      </div>
                    )}

                    <div className="space-y-2">
                      <Label>Révocable à tout moment</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="revocable_oui"
                            checked={procurationData.duree.revocable === true}
                            onChange={() => setProcurationData({...procurationData, duree: {...procurationData.duree, revocable: true}})}
                          />
                          <Label htmlFor="revocable_oui" className="cursor-pointer font-normal">☐ Oui</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="revocable_non"
                            checked={procurationData.duree.revocable === false}
                            onChange={() => setProcurationData({...procurationData, duree: {...procurationData.duree, revocable: false}})}
                          />
                          <Label htmlFor="revocable_non" className="cursor-pointer font-normal">☐ Non (rare mais possible)</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* ACCEPTATION DU MANDATAIRE */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">ACCEPTATION DU MANDATAIRE (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Type d'acceptation *</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="accept_expresse"
                            value="expresse"
                            checked={procurationData.acceptation.type === "expresse"}
                            onChange={(e) => setProcurationData({...procurationData, acceptation: {...procurationData.acceptation, type: e.target.value}})}
                          />
                          <Label htmlFor="accept_expresse" className="cursor-pointer font-normal">☐ Acceptation expresse</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="accept_tacite"
                            value="tacite"
                            checked={procurationData.acceptation.type === "tacite"}
                            onChange={(e) => setProcurationData({...procurationData, acceptation: {...procurationData.acceptation, type: e.target.value}})}
                          />
                          <Label htmlFor="accept_tacite" className="cursor-pointer font-normal">☐ Acceptation tacite</Label>
                        </div>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Acceptation réalisée le jour de l'acte</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="accept_jour_oui"
                            checked={procurationData.acceptation.acceptationJourActe === true}
                            onChange={() => setProcurationData({...procurationData, acceptation: {...procurationData.acceptation, acceptationJourActe: true}})}
                          />
                          <Label htmlFor="accept_jour_oui" className="cursor-pointer font-normal">☐ Oui</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="accept_jour_non"
                            checked={procurationData.acceptation.acceptationJourActe === false}
                            onChange={() => setProcurationData({...procurationData, acceptation: {...procurationData.acceptation, acceptationJourActe: false}})}
                          />
                          <Label htmlFor="accept_jour_non" className="cursor-pointer font-normal">☐ Non (acceptation ultérieure)</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* DÉCLARATIONS ESSENTIELLES DU MANDANT */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">DÉCLARATIONS ESSENTIELLES DU MANDANT (OBLIGATOIRE)</h3>
                    <div className="p-4 bg-gray-50 border rounded-lg space-y-2">
                      <Label className="font-semibold">Cases à cocher :</Label>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl_libre"
                          checked={procurationData.declarations.agitLibrement}
                          onChange={(e) => setProcurationData({...procurationData, declarations: {...procurationData.declarations, agitLibrement: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="decl_libre" className="cursor-pointer font-normal">☐ Déclare agir librement, sans contrainte</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl_capacite"
                          checked={procurationData.declarations.pleineCapacite}
                          onChange={(e) => setProcurationData({...procurationData, declarations: {...procurationData.declarations, pleineCapacite: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="decl_capacite" className="cursor-pointer font-normal">☐ Déclare avoir pleine capacité juridique</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl_comprend"
                          checked={procurationData.declarations.comprendPortee}
                          onChange={(e) => setProcurationData({...procurationData, declarations: {...procurationData.declarations, comprendPortee: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="decl_comprend" className="cursor-pointer font-normal">☐ Déclare comprendre la portée de la procuration</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl_consent"
                          checked={procurationData.declarations.consentLibre}
                          onChange={(e) => setProcurationData({...procurationData, declarations: {...procurationData.declarations, consentLibre: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="decl_consent" className="cursor-pointer font-normal">☐ Déclare consentir librement et de manière éclairée</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl_irrevocable"
                          checked={procurationData.declarations.pouvoirIrrevocable}
                          onChange={(e) => setProcurationData({...procurationData, declarations: {...procurationData.declarations, pouvoirIrrevocable: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="decl_irrevocable" className="cursor-pointer font-normal">☐ Déclare donner pouvoir irrévocable pendant la durée prévue (si applicable)</Label>
                      </div>
                    </div>
                  </div>

                  {/* LANGUE - COMPRÉHENSION */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">LANGUE - COMPRÉHENSION (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Langue comprise par le mandant *</Label>
                      <Input 
                        value={procurationData.langue.langueComprise} 
                        onChange={(e) => setProcurationData({...procurationData, langue: {...procurationData.langue, langueComprise: e.target.value}})} 
                        placeholder="Ex: Français, Anglais, Espagnol..."
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Recours à un interprète</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="interprete_non"
                            checked={procurationData.langue.interpreteNecessaire === false}
                            onChange={() => setProcurationData({...procurationData, langue: {...procurationData.langue, interpreteNecessaire: false}})}
                          />
                          <Label htmlFor="interprete_non" className="cursor-pointer font-normal">☐ Non</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="interprete_oui"
                            checked={procurationData.langue.interpreteNecessaire === true}
                            onChange={() => setProcurationData({...procurationData, langue: {...procurationData.langue, interpreteNecessaire: true}})}
                          />
                          <Label htmlFor="interprete_oui" className="cursor-pointer font-normal">☐ Oui (identité de l'interprète)</Label>
                        </div>
                      </div>
                    </div>

                    {procurationData.langue.interpreteNecessaire && (
                      <div className="space-y-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <Label>Identité de l'interprète *</Label>
                        <Textarea 
                          value={procurationData.langue.interpreteIdentite} 
                          onChange={(e) => setProcurationData({...procurationData, langue: {...procurationData.langue, interpreteIdentite: e.target.value}})} 
                          rows={2}
                          placeholder="Nom, prénom, qualifications de l'interprète..."
                        />
                      </div>
                    )}
                  </div>

                  {/* 🔟 COMPARUTION - SIGNATURE */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🔟 COMPARUTION - SIGNATURE (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <Label>Comparution du mandant *</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="comp_presence"
                            value="presence"
                            checked={procurationData.comparution.typeComparution === "presence"}
                            onChange={(e) => setProcurationData({...procurationData, comparution: {...procurationData.comparution, typeComparution: e.target.value}})}
                          />
                          <Label htmlFor="comp_presence" className="cursor-pointer font-normal">☐ En présence du notaire</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="comp_distance"
                            value="distance"
                            checked={procurationData.comparution.typeComparution === "distance"}
                            onChange={(e) => setProcurationData({...procurationData, comparution: {...procurationData.comparution, typeComparution: e.target.value}})}
                          />
                          <Label htmlFor="comp_distance" className="cursor-pointer font-normal">☐ À distance (visioconférence sécurisée)</Label>
                        </div>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="lecture"
                          checked={procurationData.comparution.lectureFaite}
                          onChange={(e) => setProcurationData({...procurationData, comparution: {...procurationData.comparution, lectureFaite: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="lecture" className="cursor-pointer font-normal">Lecture de l'acte faite par le notaire</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="consentement"
                          checked={procurationData.comparution.consentementRecueilli}
                          onChange={(e) => setProcurationData({...procurationData, comparution: {...procurationData.comparution, consentementRecueilli: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="consentement" className="cursor-pointer font-normal">Consentement recueilli</Label>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Signature *</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="sign_presentiel"
                            value="presentiel"
                            checked={procurationData.comparution.typeSignature === "presentiel"}
                            onChange={(e) => setProcurationData({...procurationData, comparution: {...procurationData.comparution, typeSignature: e.target.value}})}
                          />
                          <Label htmlFor="sign_presentiel" className="cursor-pointer font-normal">☐ En présentiel</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="radio"
                            id="sign_distance"
                            value="distance"
                            checked={procurationData.comparution.typeSignature === "distance"}
                            onChange={(e) => setProcurationData({...procurationData, comparution: {...procurationData.comparution, typeSignature: e.target.value}})}
                          />
                          <Label htmlFor="sign_distance" className="cursor-pointer font-normal">☐ À distance via système sécurisé de l'office</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* MENTIONS NOTARIALES */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">MENTIONS NOTARIALES (OBLIGATOIRE)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom du notaire instrumentaire *</Label>
                        <Input value={procurationData.mentionsNotariales.nomNotaire} onChange={(e) => setProcurationData({...procurationData, mentionsNotariales: {...procurationData.mentionsNotariales, nomNotaire: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Ville de l'office *</Label>
                        <Input value={procurationData.mentionsNotariales.villeOffice} onChange={(e) => setProcurationData({...procurationData, mentionsNotariales: {...procurationData.mentionsNotariales, villeOffice: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de réception de l'acte *</Label>
                        <Input type="date" value={procurationData.mentionsNotariales.dateReception} onChange={(e) => setProcurationData({...procurationData, mentionsNotariales: {...procurationData.mentionsNotariales, dateReception: e.target.value}})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de réception *</Label>
                        <Input value={procurationData.mentionsNotariales.lieuReception} onChange={(e) => setProcurationData({...procurationData, mentionsNotariales: {...procurationData.mentionsNotariales, lieuReception: e.target.value}})} placeholder="Ex: Étude notariale, domicile..." />
                      </div>
                    </div>

                    <div className="flex items-center space-x-2">
                      <input
                        type="checkbox"
                        id="acte_minute"
                        checked={procurationData.mentionsNotariales.acteRecuMinute}
                        onChange={(e) => setProcurationData({...procurationData, mentionsNotariales: {...procurationData.mentionsNotariales, acteRecuMinute: e.target.checked}})}
                        className="rounded"
                      />
                      <Label htmlFor="acte_minute" className="cursor-pointer font-normal">Acte reçu en minute</Label>
                    </div>
                  </div>

                  {/* CONSERVATION - COPIES */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">CONSERVATION - COPIES (OBLIGATOIRE)</h3>
                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="minute"
                          checked={procurationData.conservation.minuteConservee}
                          onChange={(e) => setProcurationData({...procurationData, conservation: {...procurationData.conservation, minuteConservee: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="minute" className="cursor-pointer font-normal">Minute conservée par le notaire</Label>
                      </div>
                      
                      <Label className="font-semibold mt-4 block">Délivrance :</Label>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="copies_simples"
                          checked={procurationData.conservation.copiesSimples}
                          onChange={(e) => setProcurationData({...procurationData, conservation: {...procurationData.conservation, copiesSimples: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="copies_simples" className="cursor-pointer font-normal">☐ Copies simples</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="copies_certifiees"
                          checked={procurationData.conservation.copiesCertifiees}
                          onChange={(e) => setProcurationData({...procurationData, conservation: {...procurationData.conservation, copiesCertifiees: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="copies_certifiees" className="cursor-pointer font-normal">☐ Copies certifiées conformes</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="copies_executoires"
                          checked={procurationData.conservation.copiesExecutoires}
                          onChange={(e) => setProcurationData({...procurationData, conservation: {...procurationData.conservation, copiesExecutoires: e.target.checked}})}
                          className="rounded"
                        />
                        <Label htmlFor="copies_executoires" className="cursor-pointer font-normal">☐ Copies exécutoires</Label>
                      </div>
                    </div>
                  </div>

                  {/* Note informative */}
                  <div className="p-4 bg-green-50 border border-green-200 rounded-lg">
                    <p className="text-sm text-green-700">
                      <strong>✅ Checklist complète :</strong> Tous les champs obligatoires pour une procuration authentique sont présents dans ce formulaire conforme aux exigences notariales.
                    </p>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire spécifique pour Mandat de protection future */}
            {pendingContractType === "Mandat de protection future" && (
              <>
                <div className="space-y-6">
                  {/* SECTION 1: TYPE DE MANDAT */}
                  <div className="space-y-4 p-4 border rounded-lg bg-orange-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Type de mandat</h3>
                    
                    <div className="space-y-2">
                      <Label className="text-sm font-medium">Sélectionnez le(s) type(s) de mandat <span className="text-red-500">*</span></Label>
                      <div className="space-y-2">
                        {[
                          { value: "mandat_soi_meme", label: "Mandat pour soi-même" },
                          { value: "mandat_autrui", label: "Mandat pour autrui (ex. enfant handicapé)" },
                          { value: "sous_seing_prive", label: "Sous seing privé" },
                          { value: "acte_authentique", label: "Acte authentique (notarié)" },
                          { value: "mandat_mixte", label: "Mandat mixte (partie sous seing privé / partie notariée)" },
                        ].map(option => (
                          <div key={option.value} className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id={`type-${option.value}`}
                              checked={mandatProtectionData.typeMandat.includes(option.value)}
                              onChange={(e) => {
                                const newTypes = e.target.checked
                                  ? [...mandatProtectionData.typeMandat, option.value]
                                  : mandatProtectionData.typeMandat.filter(t => t !== option.value);
                                setMandatProtectionData({...mandatProtectionData, typeMandat: newTypes});
                              }}
                              className="w-4 h-4"
                            />
                            <Label htmlFor={`type-${option.value}`} className="cursor-pointer">{option.label}</Label>
                          </div>
                        ))}
                      </div>
                      <p className="text-xs text-gray-500 mt-2">
                        Le type de mandat détermine les pouvoirs permis.
                      </p>

                      {/* Précisions pour mandat pour autrui */}
                      {mandatProtectionData.typeMandat.includes("mandat_autrui") && (
                        <div className="space-y-4 mt-4 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                          <p className="text-sm text-orange-800 font-medium">
                            ⚠️ Mandat pour autrui : uniquement possible pour un enfant mineur ou un enfant majeur handicapé
                          </p>
                          <div className="space-y-2">
                            <Label>Lien juridique avec la personne protégée <span className="text-red-500">*</span></Label>
                            <Input 
                              value={mandatProtectionData.mandatAutrui.lienJuridique}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandatAutrui: {...mandatProtectionData.mandatAutrui, lienJuridique: e.target.value}
                              })}
                              placeholder="Ex: Parent, Tuteur légal..."
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Justification légale <span className="text-red-500">*</span></Label>
                            <Textarea 
                              value={mandatProtectionData.mandatAutrui.justificationLegale}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandatAutrui: {...mandatProtectionData.mandatAutrui, justificationLegale: e.target.value}
                              })}
                              placeholder="Précisez: handicap, vulnérabilité, reconnaissance MDPH, etc."
                              rows={2}
                            />
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* SECTION 2: IDENTITÉ DU MANDANT */}
                  <div className="space-y-4 p-4 border rounded-lg bg-blue-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du MANDANT (OBLIGATOIRE)</h3>
                    
                    {/* Sélection client existant */}
                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mandant-is-client-mandat"
                          checked={mandatProtectionData.mandant.isClient}
                          onChange={(e) => {
                            setMandatProtectionData({
                              ...mandatProtectionData,
                              mandant: {...mandatProtectionData.mandant, isClient: e.target.checked, clientId: ""}
                            });
                          }}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="mandant-is-client-mandat" className="cursor-pointer">
                          Le mandant est un client existant
                        </Label>
                      </div>

                      {mandatProtectionData.mandant.isClient && (
                        <Select
                          value={mandatProtectionData.mandant.clientId}
                          onValueChange={(val) => {
                            setMandatProtectionData({
                              ...mandatProtectionData,
                              mandant: {...mandatProtectionData.mandant, clientId: val}
                            });
                            // Auto-fill depuis le client sélectionné
                            const selectedClient = clients.find(c => c.id === val);
                            if (selectedClient) {
                              setMandatProtectionData(prev => ({
                                ...prev,
                                mandant: {
                                  ...prev.mandant,
                                  clientId: val,
                                  nom: selectedClient.nom || "",
                                  prenom: selectedClient.prenom || "",
                                  nomNaissance: selectedClient.nom_naissance || "",
                                  dateNaissance: selectedClient.date_naissance || "",
                                  lieuNaissance: selectedClient.lieu_naissance || "",
                                  nationalite: selectedClient.nationalite || "",
                                  profession: selectedClient.profession || "",
                                  adresseComplete: selectedClient.adresse || "",
                                  telephone: selectedClient.telephone || "",
                                  email: selectedClient.email || "",
                                  typeIdentite: selectedClient.type_identite || "",
                                  numeroIdentite: selectedClient.numero_identite || "",
                                }
                              }));
                            }
                          }}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner un client" />
                          </SelectTrigger>
                          <SelectContent>
                            {clients.map(c => (
                              <SelectItem key={c.id} value={c.id}>
                                {c.prenom} {c.nom}
                              </SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      )}

                      {/* Upload pièce d'identité mandant */}
                      {mandatProtectionData.mandant.clientId && (
                        <div className="space-y-2">
                          <Label>📎 Copie de la pièce d'identité</Label>
                          {mandatProtectionMandantIdentiteUrl ? (
                            <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                              <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                              </svg>
                              <span className="text-sm flex-1 text-green-700">Pièce d'identité du client disponible</span>
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                className="bg-green-600 hover:bg-green-700 text-white"
                                onClick={() => window.open(mandatProtectionMandantIdentiteUrl, '_blank')}
                              >
                                <Eye className="w-4 h-4" />
                              </Button>
                            </div>
                          ) : (
                            <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-300 rounded-lg">
                              <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                              </svg>
                              <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité associée à ce client</span>
                            </div>
                          )}
                        </div>
                      )}

                      {!mandatProtectionData.mandant.isClient && (
                        <div className="space-y-2">
                          <Label>📎 Copie de la pièce d'identité</Label>
                          {mandatProtectionMandantIdentiteUrl ? (
                            <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                              <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                              </svg>
                              <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée</span>
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                className="bg-green-600 hover:bg-green-700 text-white"
                                onClick={() => window.open(mandatProtectionMandantIdentiteUrl, '_blank')}
                              >
                                <Eye className="w-4 h-4" />
                              </Button>
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                className="bg-red-600 hover:bg-red-700 text-white"
                                onClick={() => setMandatProtectionMandantIdentiteUrl(null)}
                              >
                                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                              </Button>
                            </div>
                          ) : (
                            <button
                              type="button"
                              onClick={() => {
                                const input = document.createElement('input');
                                input.type = 'file';
                                input.accept = '.pdf,.jpg,.jpeg,.png';
                                input.onchange = (e: any) => {
                                  const file = e.target.files?.[0];
                                  if (file) {
                                    const url = URL.createObjectURL(file);
                                    setMandatProtectionMandantIdentiteUrl(url);
                                  }
                                };
                                input.click();
                              }}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                            >
                              <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                              </svg>
                              <span className="text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                            </button>
                          )}
                        </div>
                      )}
                    </div>

                    {/* Champs d'identité */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input 
                          value={mandatProtectionData.mandant.nom}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, nom: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input 
                          value={mandatProtectionData.mandant.prenom}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, prenom: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input 
                          value={mandatProtectionData.mandant.nomNaissance}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, nomNaissance: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input 
                          type="date"
                          value={mandatProtectionData.mandant.dateNaissance}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, dateNaissance: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input 
                          value={mandatProtectionData.mandant.lieuNaissance}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input 
                          value={mandatProtectionData.mandant.nationalite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, nationalite: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input 
                          value={mandatProtectionData.mandant.profession}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, profession: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Adresse complète <span className="text-red-500">*</span></Label>
                      <Textarea 
                        value={mandatProtectionData.mandant.adresseComplete}
                        onChange={(e) => setMandatProtectionData({
                          ...mandatProtectionData,
                          mandant: {...mandatProtectionData.mandant, adresseComplete: e.target.value}
                        })}
                        rows={2}
                      />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input 
                          value={mandatProtectionData.mandant.telephone}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, telephone: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input 
                          type="email"
                          value={mandatProtectionData.mandant.email}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Situation familiale</Label>
                        <Input
                          value={mandatProtectionData.mandant.situationMatrimoniale}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, situationMatrimoniale: e.target.value}
                          })}
                          placeholder="Renseignée automatiquement si client sélectionné"
                        />
                      </div>
                      {(mandatProtectionData.mandant.situationMatrimoniale === "marie" || mandatProtectionData.mandant.situationMatrimoniale === "pacse") && (
                        <div className="space-y-2">
                          <Label>Régime matrimonial</Label>
                          <Input 
                            value={mandatProtectionData.mandant.regimeMatrimonial}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              mandant: {...mandatProtectionData.mandant, regimeMatrimonial: e.target.value}
                            })}
                            placeholder="Ex: Communauté réduite aux acquêts"
                          />
                        </div>
                      )}
                    </div>

                    {(mandatProtectionData.mandant.situationMatrimoniale === "marie" || mandatProtectionData.mandant.situationMatrimoniale === "pacse") && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nom du conjoint</Label>
                          <Input 
                            value={mandatProtectionData.mandant.conjointNom}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              mandant: {...mandatProtectionData.mandant, conjointNom: e.target.value}
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du conjoint</Label>
                          <Input 
                            value={mandatProtectionData.mandant.conjointPrenom}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              mandant: {...mandatProtectionData.mandant, conjointPrenom: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    )}

                    <div className="space-y-2">
                      <Label>Capacité juridique actuelle <span className="text-red-500">*</span></Label>
                      <Select
                        value={mandatProtectionData.mandant.capaciteJuridique}
                        onValueChange={(val) => setMandatProtectionData({
                          ...mandatProtectionData,
                          mandant: {...mandatProtectionData.mandant, capaciteJuridique: val}
                        })}
                      >
                        <SelectTrigger>
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="majeur_capable">Majeur capable</SelectItem>
                          <SelectItem value="sauvegarde_justice">Sauvegarde de justice (mandat impossible)</SelectItem>
                          <SelectItem value="curatelle">Curatelle (mandat limité)</SelectItem>
                          <SelectItem value="tutelle">Tutelle (mandat impossible)</SelectItem>
                        </SelectContent>
                      </Select>
                      {mandatProtectionData.mandant.capaciteJuridique === "sauvegarde_justice" && (
                        <p className="text-xs text-red-600 mt-1">⚠️ Un mandant sous sauvegarde de justice ne peut pas établir de mandat de protection future</p>
                      )}
                      {mandatProtectionData.mandant.capaciteJuridique === "tutelle" && (
                        <p className="text-xs text-red-600 mt-1">⚠️ Un mandant sous tutelle ne peut pas établir de mandat de protection future</p>
                      )}
                      {mandatProtectionData.mandant.capaciteJuridique === "curatelle" && (
                        <p className="text-xs text-orange-600 mt-1">⚠️ Mandat possible mais avec pouvoirs limités</p>
                      )}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="space-y-2">
                        <Label>Type de pièce d'identité</Label>
                        <Select
                          value={mandatProtectionData.mandant.typeIdentite}
                          onValueChange={(val) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, typeIdentite: val}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CNI">Carte nationale d'identité</SelectItem>
                            <SelectItem value="passeport">Passeport</SelectItem>
                            <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Numéro de pièce</Label>
                        <Input 
                          value={mandatProtectionData.mandant.numeroIdentite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, numeroIdentite: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date d'expiration</Label>
                        <Input 
                          type="date"
                          value={mandatProtectionData.mandant.dateExpirationIdentite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandant: {...mandatProtectionData.mandant, dateExpirationIdentite: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* SECTION 3: MANDATAIRE PRINCIPAL */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du MANDATAIRE PRINCIPAL (OBLIGATOIRE)</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input 
                          value={mandatProtectionData.mandatairePrincipal.nom}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, nom: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input 
                          value={mandatProtectionData.mandatairePrincipal.prenom}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, prenom: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de naissance</Label>
                        <Input 
                          type="date"
                          value={mandatProtectionData.mandatairePrincipal.dateNaissance}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, dateNaissance: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input 
                          value={mandatProtectionData.mandatairePrincipal.lieuNaissance}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Adresse complète <span className="text-red-500">*</span></Label>
                      <Textarea 
                        value={mandatProtectionData.mandatairePrincipal.adresseComplete}
                        onChange={(e) => setMandatProtectionData({
                          ...mandatProtectionData,
                          mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, adresseComplete: e.target.value}
                        })}
                        rows={2}
                      />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input 
                          value={mandatProtectionData.mandatairePrincipal.profession}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, profession: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Lien avec le mandant</Label>
                        <Select
                          value={mandatProtectionData.mandatairePrincipal.lienMandant}
                          onValueChange={(val) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, lienMandant: val}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="conjoint">Conjoint</SelectItem>
                            <SelectItem value="enfant">Enfant</SelectItem>
                            <SelectItem value="parent">Parent</SelectItem>
                            <SelectItem value="ami">Ami</SelectItem>
                            <SelectItem value="tiers_professionnel">Tiers professionnel</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input 
                          value={mandatProtectionData.mandatairePrincipal.telephone}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, telephone: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input 
                          type="email"
                          value={mandatProtectionData.mandatairePrincipal.email}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    {/* Pièce d'identité du mandataire */}
                    <div className="space-y-2">
                      <Label>📎 Copie de la pièce</Label>
                      {mandatProtectionMandataireIdentiteFile ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée : {mandatProtectionMandataireIdentiteFile.name}</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => {
                              const url = URL.createObjectURL(mandatProtectionMandataireIdentiteFile);
                              window.open(url, '_blank');
                            }}
                          >
                            <Eye className="w-4 h-4" />
                          </Button>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-red-600 hover:bg-red-700 text-white"
                            onClick={() => setMandatProtectionMandataireIdentiteFile(null)}
                          >
                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                          </Button>
                        </div>
                      ) : (
                        <button
                          type="button"
                          onClick={() => {
                            const input = document.createElement('input');
                            input.type = 'file';
                            input.accept = '.pdf,.jpg,.jpeg,.png';
                            input.onchange = (e: any) => {
                              const file = e.target.files?.[0];
                              if (file) {
                                setMandatProtectionMandataireIdentiteFile(file);
                              }
                            };
                            input.click();
                          }}
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                        >
                          <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                          </svg>
                          <span className="text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                      )}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="space-y-2">
                        <Label>Type de pièce d'identité</Label>
                        <Select
                          value={mandatProtectionData.mandatairePrincipal.typeIdentite}
                          onValueChange={(val) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, typeIdentite: val}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CNI">Carte nationale d'identité</SelectItem>
                            <SelectItem value="passeport">Passeport</SelectItem>
                            <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Numéro de pièce</Label>
                        <Input 
                          value={mandatProtectionData.mandatairePrincipal.numeroIdentite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, numeroIdentite: e.target.value}
                          })}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date d'expiration</Label>
                        <Input 
                          type="date"
                          value={mandatProtectionData.mandatairePrincipal.dateExpirationIdentite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, dateExpirationIdentite: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-3">
                      <p className="text-sm font-medium text-gray-700">Déclarations du mandataire :</p>
                      
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="absenceIncapaciteLegale"
                          checked={mandatProtectionData.mandatairePrincipal.absenceIncapaciteLegale}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, absenceIncapaciteLegale: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="absenceIncapaciteLegale" className="cursor-pointer">
                          N'est pas frappé d'une incapacité légale
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="absenceDecheanceAutorite"
                          checked={mandatProtectionData.mandatairePrincipal.absenceDecheanceAutorite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, absenceDecheanceAutorite: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="absenceDecheanceAutorite" className="cursor-pointer">
                          N'est pas déchu de l'autorité parentale
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="absenceInterdictionGestion"
                          checked={mandatProtectionData.mandatairePrincipal.absenceInterdictionGestion}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, absenceInterdictionGestion: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="absenceInterdictionGestion" className="cursor-pointer">
                          N'est pas interdit de gestion
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="absenceMesureProtection"
                          checked={mandatProtectionData.mandatairePrincipal.absenceMesureProtection}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, absenceMesureProtection: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="absenceMesureProtection" className="cursor-pointer">
                          N'est pas placé sous mesure de protection
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptationEcrite"
                          checked={mandatProtectionData.mandatairePrincipal.acceptationEcrite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            mandatairePrincipal: {...mandatProtectionData.mandatairePrincipal, acceptationEcrite: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="acceptationEcrite" className="cursor-pointer font-medium">
                          Acceptation écrite du mandat <span className="text-red-500">*</span>
                        </Label>
                      </div>

                      <p className="text-xs text-red-600 mt-2">
                        ⚠️ Un juge peut invalider le mandat si le mandataire ne remplit pas ces conditions
                      </p>
                    </div>
                  </div>

                  {/* SECTION 4: MANDATAIRE SUBSTITUT */}
                  <div className="space-y-4 p-4 border rounded-lg bg-yellow-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Mandataire substitut (optionnel)</h3>
                    
                    <div className="flex items-center space-x-2">
                      <input
                        type="checkbox"
                        id="mandataireSubstitutExiste"
                        checked={mandatProtectionData.mandataireSubstitut.existe}
                        onChange={(e) => setMandatProtectionData({
                          ...mandatProtectionData,
                          mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, existe: e.target.checked}
                        })}
                        className="w-4 h-4"
                      />
                      <Label htmlFor="mandataireSubstitutExiste" className="cursor-pointer">
                        Prévoir un mandataire substitut (remplaçant si le principal ne peut pas agir)
                      </Label>
                    </div>

                    {mandatProtectionData.mandataireSubstitut.existe && (
                      <div className="space-y-4 pl-6 border-l-2 border-yellow-300">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom</Label>
                            <Input 
                              value={mandatProtectionData.mandataireSubstitut.nom}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, nom: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Prénom</Label>
                            <Input 
                              value={mandatProtectionData.mandataireSubstitut.prenom}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, prenom: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input 
                              type="date"
                              value={mandatProtectionData.mandataireSubstitut.dateNaissance}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, dateNaissance: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input 
                              value={mandatProtectionData.mandataireSubstitut.lieuNaissance}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, lieuNaissance: e.target.value}
                              })}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <Label>Adresse complète</Label>
                          <Textarea 
                            value={mandatProtectionData.mandataireSubstitut.adresseComplete}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, adresseComplete: e.target.value}
                            })}
                            rows={2}
                          />
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input 
                              value={mandatProtectionData.mandataireSubstitut.profession}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, profession: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Lien avec le mandant</Label>
                            <Select
                              value={mandatProtectionData.mandataireSubstitut.lienMandant}
                              onValueChange={(val) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, lienMandant: val}
                              })}
                            >
                              <SelectTrigger>
                                <SelectValue placeholder="Sélectionner" />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="conjoint">Conjoint</SelectItem>
                                <SelectItem value="enfant">Enfant</SelectItem>
                                <SelectItem value="parent">Parent</SelectItem>
                                <SelectItem value="ami">Ami</SelectItem>
                                <SelectItem value="tiers_professionnel">Tiers professionnel</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input 
                              value={mandatProtectionData.mandataireSubstitut.telephone}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, telephone: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input 
                              type="email"
                              value={mandatProtectionData.mandataireSubstitut.email}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, email: e.target.value}
                              })}
                            />
                          </div>
                        </div>

                        <div className="space-y-2">
                          <Label>Conditions d'entrée en fonction</Label>
                          <Textarea 
                            value={mandatProtectionData.mandataireSubstitut.conditionsEntree}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, conditionsEntree: e.target.value}
                            })}
                            placeholder="Ex: En cas de décès, incapacité, refus du mandataire principal..."
                            rows={2}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Étendue des pouvoirs du substitut</Label>
                          <Textarea 
                            value={mandatProtectionData.mandataireSubstitut.etenduePouvoirs}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              mandataireSubstitut: {...mandatProtectionData.mandataireSubstitut, etenduePouvoirs: e.target.value}
                            })}
                            placeholder="Précisez les pouvoirs identiques ou différents du mandataire principal..."
                            rows={2}
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* SECTION 5: POUVOIRS SUR LA PERSONNE */}
                  <div className="space-y-4 p-4 border rounded-lg bg-green-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">A. Pouvoirs sur la personne du mandant</h3>
                    
                    <p className="text-sm text-gray-600">
                      Sélectionnez les actes que le mandataire pourra accomplir pour la protection de la personne :
                    </p>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="representationActesCourants"
                          checked={mandatProtectionData.pouvoirsPersonne.representationActesCourants}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, representationActesCourants: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="representationActesCourants" className="cursor-pointer">
                          Représenter pour les actes de la vie courante
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="choixEtablissement"
                          checked={mandatProtectionData.pouvoirsPersonne.choixEtablissement}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, choixEtablissement: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="choixEtablissement" className="cursor-pointer">
                          Choisir l'établissement d'hébergement
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="demarchesSociales"
                          checked={mandatProtectionData.pouvoirsPersonne.demarchesSociales}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, demarchesSociales: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="demarchesSociales" className="cursor-pointer">
                          Représenter dans les démarches sociales
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="organisationSoins"
                          checked={mandatProtectionData.pouvoirsPersonne.organisationSoins}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, organisationSoins: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="organisationSoins" className="cursor-pointer">
                          Organiser et payer les soins
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="gestionMedecins"
                          checked={mandatProtectionData.pouvoirsPersonne.gestionMedecins}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, gestionMedecins: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="gestionMedecins" className="cursor-pointer">
                          Gérer les relations avec les médecins (dans le cadre légal)
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="gestionQuotidien"
                          checked={mandatProtectionData.pouvoirsPersonne.gestionQuotidien}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, gestionQuotidien: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="gestionQuotidien" className="cursor-pointer">
                          Gérer le quotidien : transports, loisirs, sécurité
                        </Label>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Précisions / Autres pouvoirs sur la personne</Label>
                      <Textarea 
                        value={mandatProtectionData.pouvoirsPersonne.precisionsAutres}
                        onChange={(e) => setMandatProtectionData({
                          ...mandatProtectionData,
                          pouvoirsPersonne: {...mandatProtectionData.pouvoirsPersonne, precisionsAutres: e.target.value}
                        })}
                        rows={2}
                        placeholder="Précisez d'autres pouvoirs..."
                      />
                    </div>

                    <div className="p-3 bg-red-50 border border-red-200 rounded-lg">
                      <p className="text-xs text-red-700">
                        <strong>⚠️ Le mandataire ne peut JAMAIS :</strong> consentir au mariage, au divorce, à des actes médicaux graves sans autorisation, ou disposer du corps du mandant.
                      </p>
                    </div>
                  </div>

                  {/* SECTION 5B: POUVOIRS SUR LE PATRIMOINE - ADMINISTRATION */}
                  <div className="space-y-4 p-4 border rounded-lg bg-blue-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">B. Pouvoirs sur le patrimoine - Actes d'administration</h3>
                    
                    <p className="text-sm text-gray-600">
                      Ces actes sont généralement autorisés dans un mandat :
                    </p>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="gestionComptes"
                          checked={mandatProtectionData.pouvoirsAdministration.gestionComptes}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsAdministration: {...mandatProtectionData.pouvoirsAdministration, gestionComptes: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="gestionComptes" className="cursor-pointer">
                          Gérer les comptes bancaires
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="encaissementRevenus"
                          checked={mandatProtectionData.pouvoirsAdministration.encaissementRevenus}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsAdministration: {...mandatProtectionData.pouvoirsAdministration, encaissementRevenus: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="encaissementRevenus" className="cursor-pointer">
                          Encaisser les revenus
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="paiementDepenses"
                          checked={mandatProtectionData.pouvoirsAdministration.paiementDepenses}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsAdministration: {...mandatProtectionData.pouvoirsAdministration, paiementDepenses: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="paiementDepenses" className="cursor-pointer">
                          Payer les dépenses courantes
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="renouvellementBail"
                          checked={mandatProtectionData.pouvoirsAdministration.renouvellementBail}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsAdministration: {...mandatProtectionData.pouvoirsAdministration, renouvellementBail: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="renouvellementBail" className="cursor-pointer">
                          Renouveler un bail
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="souscriptionAssurances"
                          checked={mandatProtectionData.pouvoirsAdministration.souscriptionAssurances}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsAdministration: {...mandatProtectionData.pouvoirsAdministration, souscriptionAssurances: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="souscriptionAssurances" className="cursor-pointer">
                          Souscrire assurance habitation / santé
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="entretienBiens"
                          checked={mandatProtectionData.pouvoirsAdministration.entretienBiens}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsAdministration: {...mandatProtectionData.pouvoirsAdministration, entretienBiens: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="entretienBiens" className="cursor-pointer">
                          Faire l'entretien courant des biens
                        </Label>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 5C: POUVOIRS SUR LE PATRIMOINE - DISPOSITION */}
                  <div className="space-y-4 p-4 border rounded-lg bg-orange-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">C. Pouvoirs sur le patrimoine - Actes de disposition</h3>
                    
                    <div className="p-3 bg-orange-100 border border-orange-300 rounded-lg mb-4">
                      <p className="text-xs text-orange-800">
                        <strong>⚠️ Important :</strong> Ces actes ne sont autorisés que dans un mandat notarié. Sélectionnez uniquement si le mandat est authentique.
                      </p>
                    </div>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="venteImmobilier"
                          checked={mandatProtectionData.pouvoirsDisposition.venteImmobilier}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, venteImmobilier: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="venteImmobilier" className="cursor-pointer">
                          Vendre un bien immobilier
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="achatImmobilier"
                          checked={mandatProtectionData.pouvoirsDisposition.achatImmobilier}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, achatImmobilier: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="achatImmobilier" className="cursor-pointer">
                          Acheter un bien
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donationMobilier"
                          checked={mandatProtectionData.pouvoirsDisposition.donationMobilier}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, donationMobilier: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="donationMobilier" className="cursor-pointer">
                          Donner un bien mobilier
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="gestionTitres"
                          checked={mandatProtectionData.pouvoirsDisposition.gestionTitres}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, gestionTitres: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="gestionTitres" className="cursor-pointer">
                          Gérer un portefeuille titres
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="resiliationBail"
                          checked={mandatProtectionData.pouvoirsDisposition.resiliationBail}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, resiliationBail: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="resiliationBail" className="cursor-pointer">
                          Résilier un bail
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="reglementDettes"
                          checked={mandatProtectionData.pouvoirsDisposition.reglementDettes}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, reglementDettes: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="reglementDettes" className="cursor-pointer">
                          Régler des dettes importantes
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptationSuccession"
                          checked={mandatProtectionData.pouvoirsDisposition.acceptationSuccession}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, acceptationSuccession: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="acceptationSuccession" className="cursor-pointer">
                          Accepter une succession
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="renonciationSuccession"
                          checked={mandatProtectionData.pouvoirsDisposition.renonciationSuccession}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, renonciationSuccession: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="renonciationSuccession" className="cursor-pointer">
                          Renoncer à une succession (nécessite clause spéciale)
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donations"
                          checked={mandatProtectionData.pouvoirsDisposition.donations}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, donations: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="donations" className="cursor-pointer">
                          Faire des donations
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modificationsSuccessorales"
                          checked={mandatProtectionData.pouvoirsDisposition.modificationsSuccessorales}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, modificationsSuccessorales: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="modificationsSuccessorales" className="cursor-pointer">
                          Effectuer des modifications successorales
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="actesGratuits"
                          checked={mandatProtectionData.pouvoirsDisposition.actesGratuits}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, actesGratuits: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="actesGratuits" className="cursor-pointer">
                          Actes à titre gratuit importants
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modificationContratMariage"
                          checked={mandatProtectionData.pouvoirsDisposition.modificationContratMariage}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            pouvoirsDisposition: {...mandatProtectionData.pouvoirsDisposition, modificationContratMariage: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="modificationContratMariage" className="cursor-pointer">
                          Modifications de contrat de mariage
                        </Label>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 6: LISTE DES BIENS */}
                  <div className="space-y-4 p-4 border rounded-lg bg-indigo-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Liste des biens du mandant (patrimoine)</h3>
                    
                    <p className="text-sm text-gray-600">
                      Indispensable pour déterminer l'étendue du mandat :
                    </p>

                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Biens immobiliers</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.biensImmobiliers}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, biensImmobiliers: e.target.value}
                          })}
                          placeholder="Adresses, titres, valeurs estimées..."
                          rows={3}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Comptes bancaires</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.comptesBancaires}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, comptesBancaires: e.target.value}
                          })}
                          placeholder="Banques, numéros de comptes, montants approximatifs..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Contrats d'assurance-vie</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.assurancesVie}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, assurancesVie: e.target.value}
                          })}
                          placeholder="Compagnies, numéros de contrats, capitaux..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Livrets, PEL, PEA</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.livretsEpargne}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, livretsEpargne: e.target.value}
                          })}
                          placeholder="Types d'épargne et montants..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Biens mobiliers</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.biensMobiliers}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, biensMobiliers: e.target.value}
                          })}
                          placeholder="Voitures, œuvres d'art, bijoux, meubles de valeur..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Parts sociales / Valeurs mobilières</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.partsSociales}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, partsSociales: e.target.value}
                          })}
                          placeholder="Actions, obligations, SCPI, parts de société..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Revenus réguliers</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.revenusReguliers}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, revenusReguliers: e.target.value}
                          })}
                          placeholder="Salaires, pensions, retraites, loyers perçus..."
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Dettes existantes</Label>
                        <Textarea 
                          value={mandatProtectionData.biensPatrimoine.dettesExistantes}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            biensPatrimoine: {...mandatProtectionData.biensPatrimoine, dettesExistantes: e.target.value}
                          })}
                          placeholder="Crédits, emprunts, dettes fiscales..."
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* SECTION 7: LIMITES DU MANDAT */}
                  <div className="space-y-4 p-4 border rounded-lg bg-red-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Limites du mandat (si nécessaire)</h3>
                    
                    <div className="space-y-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="interdictionVenteCertainsBiens"
                          checked={mandatProtectionData.limites.interdictionVenteCertainsBiens}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            limites: {...mandatProtectionData.limites, interdictionVenteCertainsBiens: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="interdictionVenteCertainsBiens" className="cursor-pointer">
                          Interdiction de vendre certains biens
                        </Label>
                      </div>

                      {mandatProtectionData.limites.interdictionVenteCertainsBiens && (
                        <div className="space-y-2 pl-6">
                          <Label>Biens concernés</Label>
                          <Textarea 
                            value={mandatProtectionData.limites.biensConcernes}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              limites: {...mandatProtectionData.limites, biensConcernes: e.target.value}
                            })}
                            placeholder="Précisez les biens qui ne peuvent pas être vendus..."
                            rows={2}
                          />
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="interdictionDeplacement"
                          checked={mandatProtectionData.limites.interdictionDeplacement}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            limites: {...mandatProtectionData.limites, interdictionDeplacement: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="interdictionDeplacement" className="cursor-pointer">
                          Interdiction de déplacer le mandant sans accord familial
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="interdictionModificationContrats"
                          checked={mandatProtectionData.limites.interdictionModificationContrats}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            limites: {...mandatProtectionData.limites, interdictionModificationContrats: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="interdictionModificationContrats" className="cursor-pointer">
                          Interdiction de modifier certains contrats
                        </Label>
                      </div>

                      <div className="space-y-2">
                        <Label>Montant maximum pour les actes</Label>
                        <Input 
                          type="number"
                          value={mandatProtectionData.limites.montantMaximum}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            limites: {...mandatProtectionData.limites, montantMaximum: e.target.value}
                          })}
                          placeholder="Ex: 10000"
                        />
                        <p className="text-xs text-gray-500">Montant au-delà duquel le mandataire ne peut pas agir seul</p>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="obligationComptesReguliers"
                          checked={mandatProtectionData.limites.obligationComptesReguliers}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            limites: {...mandatProtectionData.limites, obligationComptesReguliers: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="obligationComptesReguliers" className="cursor-pointer">
                          Obligation de rendre des comptes réguliers
                        </Label>
                      </div>

                      {mandatProtectionData.limites.obligationComptesReguliers && (
                        <div className="space-y-2 pl-6">
                          <Label>Périodicité</Label>
                          <Select
                            value={mandatProtectionData.limites.periodiciteComptes}
                            onValueChange={(val) => setMandatProtectionData({
                              ...mandatProtectionData,
                              limites: {...mandatProtectionData.limites, periodiciteComptes: val}
                            })}
                          >
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner" />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="mensuel">Mensuel</SelectItem>
                              <SelectItem value="trimestriel">Trimestriel</SelectItem>
                              <SelectItem value="semestriel">Semestriel</SelectItem>
                              <SelectItem value="annuel">Annuel</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* SECTION 8: CONTRÔLE DU MANDATAIRE */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Contrôle du mandataire</h3>
                    
                    <div className="space-y-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="obligationCompteGestion"
                          checked={mandatProtectionData.controle.obligationCompteGestion}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            controle: {...mandatProtectionData.controle, obligationCompteGestion: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="obligationCompteGestion" className="cursor-pointer">
                          Obligation de tenir un compte de gestion
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="controlePersonne"
                          checked={mandatProtectionData.controle.controlePersonne}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            controle: {...mandatProtectionData.controle, controlePersonne: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="controlePersonne" className="cursor-pointer">
                          Contrôle par une personne désignée
                        </Label>
                      </div>

                      {mandatProtectionData.controle.controlePersonne && (
                        <div className="space-y-4 pl-6 border-l-2 border-purple-300">
                          <div className="space-y-2">
                            <Label>Identité complète du contrôleur</Label>
                            <Textarea 
                              value={mandatProtectionData.controle.controleIdentite}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                controle: {...mandatProtectionData.controle, controleIdentite: e.target.value}
                              })}
                              placeholder="Nom, prénom, adresse, lien avec le mandant..."
                              rows={2}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Étendue du contrôle / Pouvoirs du contrôleur</Label>
                            <Textarea 
                              value={mandatProtectionData.controle.controlePouvoirs}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                controle: {...mandatProtectionData.controle, controlePouvoirs: e.target.value}
                              })}
                              placeholder="Définissez ce que le contrôleur peut vérifier, demander, etc..."
                              rows={2}
                            />
                          </div>
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="controleNotaire"
                          checked={mandatProtectionData.controle.controleNotaire}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            controle: {...mandatProtectionData.controle, controleNotaire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="controleNotaire" className="cursor-pointer">
                          Contrôle par un notaire
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="controleExpertComptable"
                          checked={mandatProtectionData.controle.controleExpertComptable}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            controle: {...mandatProtectionData.controle, controleExpertComptable: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="controleExpertComptable" className="cursor-pointer">
                          Contrôle par un expert-comptable
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="compteRenduAnnuel"
                          checked={mandatProtectionData.controle.compteRenduAnnuel}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            controle: {...mandatProtectionData.controle, compteRenduAnnuel: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="compteRenduAnnuel" className="cursor-pointer">
                          Compte rendu annuel obligatoire
                        </Label>
                      </div>

                      <div className="space-y-2">
                        <Label>Périodicité du contrôle</Label>
                        <Select
                          value={mandatProtectionData.controle.periodicite}
                          onValueChange={(val) => setMandatProtectionData({
                            ...mandatProtectionData,
                            controle: {...mandatProtectionData.controle, periodicite: val}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="mensuel">Mensuel</SelectItem>
                            <SelectItem value="trimestriel">Trimestriel</SelectItem>
                            <SelectItem value="semestriel">Semestriel</SelectItem>
                            <SelectItem value="annuel">Annuel</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 9: CONDITIONS DE MISE EN ŒUVRE */}
                  <div className="space-y-4 p-4 border rounded-lg bg-yellow-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Conditions de mise en œuvre du mandat</h3>
                    
                    <p className="text-sm text-gray-600 mb-4">
                      Le mandat ne prend effet qu'en cas d'incapacité du mandant.
                    </p>

                    <div className="space-y-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="certificatMedical"
                          checked={mandatProtectionData.miseEnOeuvre.certificatMedical}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            miseEnOeuvre: {...mandatProtectionData.miseEnOeuvre, certificatMedical: e.target.checked}
                          })}
                          className="w-4 h-4"
                          disabled
                        />
                        <Label htmlFor="certificatMedical" className="cursor-not-allowed opacity-70">
                          Certificat médical circonstancié (OBLIGATOIRE)
                        </Label>
                      </div>

                      <div className="space-y-2">
                        <Label>Médecin inscrit sur la liste du procureur</Label>
                        <Input 
                          value={mandatProtectionData.miseEnOeuvre.medecinListe}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            miseEnOeuvre: {...mandatProtectionData.miseEnOeuvre, medecinListe: e.target.value}
                          })}
                          placeholder="Nom du médecin"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de constat de l'incapacité</Label>
                        <Input 
                          type="date"
                          value={mandatProtectionData.miseEnOeuvre.dateConstat}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            miseEnOeuvre: {...mandatProtectionData.miseEnOeuvre, dateConstat: e.target.value}
                          })}
                        />
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="depotGreffe"
                          checked={mandatProtectionData.miseEnOeuvre.depotGreffe}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            miseEnOeuvre: {...mandatProtectionData.miseEnOeuvre, depotGreffe: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="depotGreffe" className="cursor-pointer">
                          Présentation du mandat au greffe du tribunal judiciaire compétent lors de la mise en œuvre
                        </Label>
                      </div>

                      <div className="p-3 bg-orange-100 border border-orange-300 rounded-lg">
                        <p className="text-xs text-orange-800">
                          <strong>⚠️ Important :</strong> Le mandat n'est pas déposé au greffe lors de sa signature, mais présenté lors de sa mise en œuvre effective.
                        </p>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="notificationMandataire"
                          checked={mandatProtectionData.miseEnOeuvre.notificationMandataire}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            miseEnOeuvre: {...mandatProtectionData.miseEnOeuvre, notificationMandataire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="notificationMandataire" className="cursor-pointer">
                          Notification au mandataire
                        </Label>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 10: FIN DU MANDAT */}
                  <div className="space-y-4 p-4 border rounded-lg bg-red-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">🔟 Fin du mandat</h3>
                    
                    <p className="text-sm text-gray-600 mb-4">
                      Sélectionnez les événements qui mettent fin au mandat :
                    </p>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="finRetourFacultes"
                          checked={mandatProtectionData.finMandat.finRetourFacultes}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            finMandat: {...mandatProtectionData.finMandat, finRetourFacultes: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="finRetourFacultes" className="cursor-pointer">
                          Fin au retour des facultés du mandant
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="revocationMandant"
                          checked={mandatProtectionData.finMandat.revocationMandant}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            finMandat: {...mandatProtectionData.finMandat, revocationMandant: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="revocationMandant" className="cursor-pointer">
                          Révocation par le mandant tant qu'il est capable
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="destitutionJuge"
                          checked={mandatProtectionData.finMandat.destitutionJuge}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            finMandat: {...mandatProtectionData.finMandat, destitutionJuge: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="destitutionJuge" className="cursor-pointer">
                          Destitution du mandataire par le juge
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decesMandant"
                          checked={mandatProtectionData.finMandat.decesMandant}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            finMandat: {...mandatProtectionData.finMandat, decesMandant: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="decesMandant" className="cursor-pointer">
                          Décès du mandant
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="remplacementSubstitut"
                          checked={mandatProtectionData.finMandat.remplacementSubstitut}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            finMandat: {...mandatProtectionData.finMandat, remplacementSubstitut: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="remplacementSubstitut" className="cursor-pointer">
                          Remplacement par le mandataire substitut
                        </Label>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 11: DÉCLARATIONS OBLIGATOIRES */}
                  <div className="space-y-4 p-4 border rounded-lg bg-orange-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Déclarations obligatoires du mandant</h3>
                    
                    <p className="text-sm text-red-600 mb-4">
                      <strong>⚠️ Ces déclarations sont OBLIGATOIRES pour la validité du mandat :</strong>
                    </p>

                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="volonteLibre"
                          checked={mandatProtectionData.declarations.volonteLibre}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            declarations: {...mandatProtectionData.declarations, volonteLibre: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="volonteLibre" className="cursor-pointer font-medium">
                          Déclaration de volonté libre et éclairée <span className="text-red-500">*</span>
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="consentementSansPression"
                          checked={mandatProtectionData.declarations.consentementSansPression}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            declarations: {...mandatProtectionData.declarations, consentementSansPression: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="consentementSansPression" className="cursor-pointer font-medium">
                          Consentement sans pression <span className="text-red-500">*</span>
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="explicationComprise"
                          checked={mandatProtectionData.declarations.explicationComprise}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            declarations: {...mandatProtectionData.declarations, explicationComprise: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="explicationComprise" className="cursor-pointer font-medium">
                          Explication comprise des conséquences juridiques <span className="text-red-500">*</span>
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptationActesDisposition"
                          checked={mandatProtectionData.declarations.acceptationActesDisposition}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            declarations: {...mandatProtectionData.declarations, acceptationActesDisposition: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="acceptationActesDisposition" className="cursor-pointer font-medium">
                          Acceptation ou refus de certains actes de disposition <span className="text-red-500">*</span>
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptationMandataire"
                          checked={mandatProtectionData.declarations.acceptationMandataire}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            declarations: {...mandatProtectionData.declarations, acceptationMandataire: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="acceptationMandataire" className="cursor-pointer font-medium">
                          Acceptation du mandataire désigné <span className="text-red-500">*</span>
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="droitRevocation"
                          checked={mandatProtectionData.declarations.droitRevocation}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            declarations: {...mandatProtectionData.declarations, droitRevocation: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="droitRevocation" className="cursor-pointer font-medium">
                          Mention que le mandant peut révoquer tant qu'il est lucide <span className="text-red-500">*</span>
                        </Label>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 12: FORME DU MANDAT */}
                  <div className="space-y-4 p-4 border rounded-lg bg-blue-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Forme du mandat</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Type d'acte <span className="text-red-500">*</span></Label>
                        <Select
                          value={mandatProtectionData.forme.typeActe}
                          onValueChange={(val) => setMandatProtectionData({
                            ...mandatProtectionData,
                            forme: {...mandatProtectionData.forme, typeActe: val}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="notarie">Mandat notarié (authentique)</SelectItem>
                            <SelectItem value="sous_seing_prive">Mandat sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {mandatProtectionData.forme.typeActe === "notarie" && (
                        <div className="p-3 bg-blue-100 border border-blue-300 rounded-lg">
                          <p className="text-xs text-blue-800">
                            <strong>✅ Mandat notarié :</strong> Permet les actes de disposition lourds (vente d'immeubles, etc.). Doit être signé devant notaire.
                          </p>
                        </div>
                      )}

                      {mandatProtectionData.forme.typeActe === "sous_seing_prive" && (
                        <div className="p-3 bg-orange-100 border border-orange-300 rounded-lg">
                          <p className="text-xs text-orange-800">
                            <strong>⚠️ Mandat sous seing privé :</strong> Pouvoirs plus limités. Ne permet pas les actes de disposition importants.
                          </p>
                        </div>
                      )}

                      {mandatProtectionData.forme.typeActe === "notarie" && (
                        <>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom du notaire</Label>
                              <Input 
                                value={mandatProtectionData.forme.nomNotaire}
                                onChange={(e) => setMandatProtectionData({
                                  ...mandatProtectionData,
                                  forme: {...mandatProtectionData.forme, nomNotaire: e.target.value}
                                })}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Ville de l'office notarial</Label>
                              <Input 
                                value={mandatProtectionData.forme.villeOffice}
                                onChange={(e) => setMandatProtectionData({
                                  ...mandatProtectionData,
                                  forme: {...mandatProtectionData.forme, villeOffice: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </>
                      )}

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Date de signature <span className="text-red-500">*</span></Label>
                          <Input 
                            type="date"
                            value={mandatProtectionData.forme.dateSignature}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              forme: {...mandatProtectionData.forme, dateSignature: e.target.value}
                            })}
                          />
                          <p className="text-xs text-gray-500">
                            Date de signature de l'acte
                          </p>
                        </div>
                        <div className="space-y-2">
                          <Label>Date de prise d'effet</Label>
                          <Input 
                            type="date"
                            value={mandatProtectionData.forme.datePriseEffet}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              forme: {...mandatProtectionData.forme, datePriseEffet: e.target.value}
                            })}
                          />
                          <p className="text-xs text-gray-500">
                            Date effective de mise en œuvre (si différente)
                          </p>
                        </div>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Lieu de signature</Label>
                          <Input 
                            value={mandatProtectionData.forme.lieuSignature}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              forme: {...mandatProtectionData.forme, lieuSignature: e.target.value}
                            })}
                          />
                        </div>
                      </div>

                      <div className="p-3 bg-blue-100 border border-blue-300 rounded-lg">
                        <p className="text-xs text-blue-800">
                          <strong>ℹ️ Information :</strong> La date de signature est la date de rédaction du mandat. La date de prise d'effet est la date à laquelle le mandat entre en vigueur (généralement constatée par le médecin ou le juge).
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* SECTION 13: JURIDICTION ET CONSERVATION */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Juridiction et conservation</h3>
                    
                    <div className="space-y-4">
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Tribunal judiciaire compétent <span className="text-red-500">*</span></Label>
                          <Input 
                            value={mandatProtectionData.juridictionConservation.tribunalCompetent}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              juridictionConservation: {...mandatProtectionData.juridictionConservation, tribunalCompetent: e.target.value}
                            })}
                            placeholder="Ex: Tribunal judiciaire de Paris"
                          />
                          <p className="text-xs text-gray-500">
                            Généralement le tribunal du domicile du mandant
                          </p>
                        </div>
                        <div className="space-y-2">
                          <Label>Ville de la juridiction <span className="text-red-500">*</span></Label>
                          <Input 
                            value={mandatProtectionData.juridictionConservation.villeJuridiction}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              juridictionConservation: {...mandatProtectionData.juridictionConservation, villeJuridiction: e.target.value}
                            })}
                            placeholder="Ex: Paris"
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de conservation du mandat <span className="text-red-500">*</span></Label>
                        <Select
                          value={mandatProtectionData.juridictionConservation.lieuConservation}
                          onValueChange={(val) => setMandatProtectionData({
                            ...mandatProtectionData,
                            juridictionConservation: {...mandatProtectionData.juridictionConservation, lieuConservation: val}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="notaire">Chez le notaire</SelectItem>
                            <SelectItem value="mandant">Chez le mandant</SelectItem>
                            <SelectItem value="tiers">Chez un tiers de confiance</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {mandatProtectionData.juridictionConservation.lieuConservation === "tiers" && (
                        <div className="space-y-2">
                          <Label>Précisions sur le lieu de conservation</Label>
                          <textarea 
                            value={mandatProtectionData.juridictionConservation.precisionsConservation}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              juridictionConservation: {...mandatProtectionData.juridictionConservation, precisionsConservation: e.target.value}
                            })}
                            placeholder="Identité et adresse du tiers conservant le mandat"
                            className="w-full min-h-[60px] p-2 border rounded-md"
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* SECTION 14: FRAIS ET RÉMUNÉRATION */}
                  <div className="space-y-4 p-4 border rounded-lg bg-amber-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Frais et rémunération</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Rémunération du mandataire <span className="text-red-500">*</span></Label>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="radio"
                              id="remunerationGratuit"
                              checked={mandatProtectionData.remuneration.typeRemuneration === "gratuit"}
                              onChange={() => setMandatProtectionData({
                                ...mandatProtectionData,
                                remuneration: {...mandatProtectionData.remuneration, typeRemuneration: "gratuit"}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="remunerationGratuit" className="cursor-pointer">
                              Mandat gratuit
                            </Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="radio"
                              id="remunerationRemunere"
                              checked={mandatProtectionData.remuneration.typeRemuneration === "remunere"}
                              onChange={() => setMandatProtectionData({
                                ...mandatProtectionData,
                                remuneration: {...mandatProtectionData.remuneration, typeRemuneration: "remunere"}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="remunerationRemunere" className="cursor-pointer">
                              Mandat rémunéré
                            </Label>
                          </div>
                        </div>
                      </div>

                      {mandatProtectionData.remuneration.typeRemuneration === "remunere" && (
                        <div className="space-y-2">
                          <Label>Modalités de rémunération <span className="text-red-500">*</span></Label>
                          <textarea 
                            value={mandatProtectionData.remuneration.modalitesRemuneration}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              remuneration: {...mandatProtectionData.remuneration, modalitesRemuneration: e.target.value}
                            })}
                            placeholder="Montant, périodicité, conditions de versement..."
                            className="w-full min-h-[80px] p-2 border rounded-md"
                          />
                        </div>
                      )}

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="remboursementFrais"
                          checked={mandatProtectionData.remuneration.remboursementFrais}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            remuneration: {...mandatProtectionData.remuneration, remboursementFrais: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="remboursementFrais" className="cursor-pointer">
                          Remboursement des frais exposés par le mandataire
                        </Label>
                      </div>

                      {mandatProtectionData.remuneration.remboursementFrais && (
                        <div className="space-y-2">
                          <Label>Précisions sur le remboursement des frais</Label>
                          <textarea 
                            value={mandatProtectionData.remuneration.precisionsRemboursement}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              remuneration: {...mandatProtectionData.remuneration, precisionsRemboursement: e.target.value}
                            })}
                            placeholder="Nature des frais remboursables, justificatifs requis, plafond éventuel..."
                            className="w-full min-h-[60px] p-2 border rounded-md"
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* SECTION 15: CLAUSES SPÉCIALES */}
                  <div className="space-y-4 p-4 border rounded-lg bg-indigo-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses spéciales</h3>
                    
                    <div className="space-y-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="prioriteFamiliale"
                          checked={mandatProtectionData.clausesSpeciales.prioriteFamiliale}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, prioriteFamiliale: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="prioriteFamiliale" className="cursor-pointer">
                          Priorité au maintien dans l'environnement familial
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="obligationInformationFamille"
                          checked={mandatProtectionData.clausesSpeciales.obligationInformationFamille}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, obligationInformationFamille: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="obligationInformationFamille" className="cursor-pointer">
                          Obligation d'information régulière de la famille
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="ordreSubstitution"
                          checked={mandatProtectionData.clausesSpeciales.ordreSubstitution}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, ordreSubstitution: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="ordreSubstitution" className="cursor-pointer">
                          Ordre de substitution des mandataires en cas d'empêchement
                        </Label>
                      </div>

                      <div className="p-4 bg-red-50 border border-red-300 rounded-lg space-y-3">
                        <p className="text-sm font-semibold text-red-800">⚖️ Clauses légales fondamentales</p>
                        
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="obligationInteretExclusif"
                            checked={mandatProtectionData.clausesSpeciales.obligationInteretExclusif}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              clausesSpeciales: {...mandatProtectionData.clausesSpeciales, obligationInteretExclusif: e.target.checked}
                            })}
                            className="w-4 h-4"
                            disabled
                          />
                          <Label htmlFor="obligationInteretExclusif" className="cursor-not-allowed opacity-70 font-medium">
                            Obligation d'agir dans l'intérêt exclusif du mandant <span className="text-red-500">*</span>
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="responsabiliteCivile"
                            checked={mandatProtectionData.clausesSpeciales.responsabiliteCivile}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              clausesSpeciales: {...mandatProtectionData.clausesSpeciales, responsabiliteCivile: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="responsabiliteCivile" className="cursor-pointer">
                            Responsabilité civile en cas de faute ou négligence
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="assuranceRC"
                            checked={mandatProtectionData.clausesSpeciales.responsabiliteCivile}
                            onChange={(e) => setMandatProtectionData({
                              ...mandatProtectionData,
                              clausesSpeciales: {...mandatProtectionData.clausesSpeciales, responsabiliteCivile: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="assuranceRC" className="cursor-pointer">
                            Souscription d'une assurance responsabilité civile professionnelle
                          </Label>
                        </div>

                        <p className="text-xs text-red-600 mt-2">
                          ⚠️ Ces clauses protègent juridiquement le mandant et sont souvent exigées par le greffe
                        </p>
                      </div>

                      <div className="space-y-3 p-4 bg-orange-50 border border-orange-300 rounded-lg">
                        <p className="text-sm font-semibold text-orange-800">🎁 Donations et actes à titre gratuit</p>
                        
                        <div className="space-y-2">
                          <Label>Autorisation des donations <span className="text-red-500">*</span></Label>
                          <Select
                            value={mandatProtectionData.clausesSpeciales.donationsAutorisees}
                            onValueChange={(val) => setMandatProtectionData({
                              ...mandatProtectionData,
                              clausesSpeciales: {...mandatProtectionData.clausesSpeciales, donationsAutorisees: val}
                            })}
                          >
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner" />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="interdites">❌ Donations strictement interdites</SelectItem>
                              <SelectItem value="presentsUsage">✅ Présents d'usage autorisés uniquement</SelectItem>
                              <SelectItem value="limitees">⚠️ Donations limitées (avec conditions)</SelectItem>
                              <SelectItem value="autorisees">✅ Donations autorisées</SelectItem>
                            </SelectContent>
                          </Select>
                          <p className="text-xs text-gray-500">
                            Clause expresse exigée par la loi (source fréquente de contentieux)
                          </p>
                        </div>

                        {(mandatProtectionData.clausesSpeciales.donationsAutorisees === "presentsUsage" || 
                          mandatProtectionData.clausesSpeciales.donationsAutorisees === "limitees" || 
                          mandatProtectionData.clausesSpeciales.donationsAutorisees === "autorisees") && (
                          <div className="space-y-2">
                            <Label>Bénéficiaires autorisés</Label>
                            <textarea 
                              value={mandatProtectionData.clausesSpeciales.beneficiairesAutorises}
                              onChange={(e) => setMandatProtectionData({
                                ...mandatProtectionData,
                                clausesSpeciales: {...mandatProtectionData.clausesSpeciales, beneficiairesAutorises: e.target.value}
                              })}
                              placeholder="Ex: Descendants directs, petits-enfants, œuvres caritatives spécifiques..."
                              className="w-full min-h-[60px] p-2 border rounded-md"
                            />
                          </div>
                        )}

                        {mandatProtectionData.clausesSpeciales.donationsAutorisees === "limitees" && (
                          <div className="p-2 bg-orange-100 border border-orange-400 rounded">
                            <p className="text-xs text-orange-800">
                              💡 Précisez les montants maximaux, fréquence, occasions autorisées (anniversaires, fêtes...)
                            </p>
                          </div>
                        )}
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="comptesRendusPeriodicite"
                          checked={mandatProtectionData.clausesSpeciales.comptesRendusPeriodicite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, comptesRendusPeriodicite: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="comptesRendusPeriodicite" className="cursor-pointer">
                          Périodicité des comptes rendus de gestion
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="accordsAutoriteProtection"
                          checked={mandatProtectionData.clausesSpeciales.accordsAutoriteProtection}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, accordsAutoriteProtection: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="accordsAutoriteProtection" className="cursor-pointer">
                          Nécessité d'accords préalables pour certains actes (juge, famille)
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="interdictionsSpecifiques"
                          checked={mandatProtectionData.clausesSpeciales.interdictionsSpecifiques}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, interdictionsSpecifiques: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="interdictionsSpecifiques" className="cursor-pointer">
                          Interdictions spécifiques (ex: vente de la résidence principale)
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="revocabilite"
                          checked={mandatProtectionData.clausesSpeciales.revocabilite}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, revocabilite: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="revocabilite" className="cursor-pointer">
                          Modalités de révocation du mandat
                        </Label>
                      </div>

                      <div className="space-y-2">
                        <Label>Autres clauses particulières</Label>
                        <textarea 
                          value={mandatProtectionData.clausesSpeciales.autresClausesParticulieres}
                          onChange={(e) => setMandatProtectionData({
                            ...mandatProtectionData,
                            clausesSpeciales: {...mandatProtectionData.clausesSpeciales, autresClausesParticulieres: e.target.value}
                          })}
                          placeholder="Toute autre clause jugée utile par le mandant..."
                          className="w-full min-h-[100px] p-2 border rounded-md"
                        />
                      </div>

                      <div className="p-3 bg-blue-100 border border-blue-300 rounded-lg">
                        <p className="text-xs text-blue-800">
                          <strong>💡 Conseil :</strong> Les clauses spéciales permettent d'adapter le mandat aux souhaits du mandant. Elles doivent respecter l'ordre public et les bonnes mœurs.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire Attestation de propriété immobilière */}
            {pendingContractType === "Attestation de propriété immobilière" && (
              <div className="space-y-6">
                {/* Section 1 : Informations sur le défunt */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Informations sur le défunt</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input 
                          value={attestationData.defunt.nom}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, nom: e.target.value}
                          })}
                          placeholder="Nom de famille"
                          required
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input 
                          value={attestationData.defunt.prenom}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, prenom: e.target.value}
                          })}
                          placeholder="Prénom"
                          required
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance (si différent)</Label>
                        <Input 
                          value={attestationData.defunt.nomNaissance}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, nomNaissance: e.target.value}
                          })}
                          placeholder="Nom de jeune fille"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Sexe</Label>
                        <Select 
                          value={attestationData.defunt.sexe}
                          onValueChange={(value) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, sexe: value}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="masculin">Masculin</SelectItem>
                            <SelectItem value="feminin">Féminin</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance</Label>
                        <Input 
                          type="date"
                          value={attestationData.defunt.dateNaissance}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input 
                          value={attestationData.defunt.lieuNaissance}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, lieuNaissance: e.target.value}
                          })}
                          placeholder="Ville, département, pays"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input 
                          value={attestationData.defunt.nationalite}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, nationalite: e.target.value}
                          })}
                          placeholder="Française"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input 
                          value={attestationData.defunt.profession}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, profession: e.target.value}
                          })}
                          placeholder="Profession exercée"
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Dernière adresse complète du défunt</Label>
                      <textarea 
                        value={attestationData.defunt.adresseDecesComplete}
                        onChange={(e) => setAttestationData({
                          ...attestationData,
                          defunt: {...attestationData.defunt, adresseDecesComplete: e.target.value}
                        })}
                        placeholder="Numéro, rue, code postal, ville"
                        className="w-full min-h-[60px] p-2 border rounded-md"
                      />
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Date de décès <span className="text-red-500">*</span></Label>
                        <Input 
                          type="date"
                          value={attestationData.defunt.dateDeces}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, dateDeces: e.target.value}
                          })}
                          required
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de décès</Label>
                        <Input 
                          value={attestationData.defunt.lieuDeces}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, lieuDeces: e.target.value}
                          })}
                          placeholder="Ville du décès"
                        />
                      </div>
                    </div>

                    <div className="space-y-4 p-4 bg-red-50 rounded-lg border border-red-200">
                      <h4 className="font-medium text-red-700">🏛️ Dernier domicile fiscal <span className="text-red-500">*</span></h4>
                      
                      <div className="space-y-2">
                        <Label>Commune du dernier domicile fiscal <span className="text-red-500">*</span></Label>
                        <Input 
                          value={attestationData.defunt.domicileFiscalCommune || ""}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, domicileFiscalCommune: e.target.value}
                          })}
                          placeholder="Commune"
                          required
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Pays <span className="text-red-500">*</span></Label>
                        <Input 
                          value={attestationData.defunt.domicileFiscalPays || ""}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, domicileFiscalPays: e.target.value}
                          })}
                          placeholder="France"
                          required
                        />
                      </div>

                      <div className="p-3 bg-red-100 border border-red-300 rounded">
                        <p className="text-xs text-red-800">
                          ⚠️ <strong>Obligatoire</strong> pour déterminer la loi successorale, la compétence fiscale et la déclaration de succession
                        </p>
                      </div>
                    </div>

                    <div className="space-y-4 p-4 bg-white rounded-lg border">
                      <h4 className="font-medium text-gray-700">💍 Situation matrimoniale</h4>
                      
                      <div className="space-y-2">
                        <Label>Situation matrimoniale du défunt</Label>
                        <Select 
                          value={attestationData.defunt.situationMatrimoniale}
                          onValueChange={(value) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, situationMatrimoniale: value}
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="celibataire">Célibataire</SelectItem>
                            <SelectItem value="marie">Marié(e)</SelectItem>
                            <SelectItem value="pacse">Pacsé(e)</SelectItem>
                            <SelectItem value="divorce">Divorcé(e)</SelectItem>
                            <SelectItem value="veuf">Veuf/Veuve</SelectItem>
                            <SelectItem value="concubinage">Concubinage</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {(attestationData.defunt.situationMatrimoniale === "marie" || 
                        attestationData.defunt.situationMatrimoniale === "divorce" ||
                        attestationData.defunt.situationMatrimoniale === "veuf") && (
                        <div className="space-y-4">
                          <div className="space-y-2">
                            <Label>Régime matrimonial applicable <span className="text-red-500">*</span></Label>
                            <Select 
                              value={attestationData.defunt.regimeMatrimonial}
                              onValueChange={(value) => setAttestationData({
                                ...attestationData,
                                defunt: {...attestationData.defunt, regimeMatrimonial: value}
                              })}
                            >
                              <SelectTrigger>
                                <SelectValue placeholder="Sélectionner" />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale (réduite aux acquêts)</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                                <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                                <SelectItem value="autre">Autre (préciser)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {attestationData.defunt.regimeMatrimonial === "autre" && (
                            <div className="space-y-2">
                              <Label>Préciser le régime</Label>
                              <Input 
                                value={attestationData.defunt.regimeMatrimonialAutre || ""}
                                onChange={(e) => setAttestationData({
                                  ...attestationData,
                                  defunt: {...attestationData.defunt, regimeMatrimonialAutre: e.target.value}
                                })}
                                placeholder="Détails du régime matrimonial"
                              />
                            </div>
                          )}

                          {attestationData.defunt.existenceContratMariage && (
                            <>
                              <div className="space-y-2">
                                <Label>Date du contrat de mariage</Label>
                                <Input 
                                  type="date"
                                  value={attestationData.defunt.dateContratMariage || ""}
                                  onChange={(e) => setAttestationData({
                                    ...attestationData,
                                    defunt: {...attestationData.defunt, dateContratMariage: e.target.value}
                                  })}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Notaire rédacteur du contrat</Label>
                                <Input 
                                  value={attestationData.defunt.notaireContratMariage || ""}
                                  onChange={(e) => setAttestationData({
                                    ...attestationData,
                                    defunt: {...attestationData.defunt, notaireContratMariage: e.target.value}
                                  })}
                                  placeholder="Nom et office du notaire"
                                />
                              </div>
                            </>
                          )}

                          <div className="p-3 bg-orange-100 border border-orange-300 rounded">
                            <p className="text-xs text-orange-800">
                              ⚠️ <strong>Essentiel</strong> pour déterminer les droits du conjoint survivant
                            </p>
                          </div>
                        </div>
                      )}
                    </div>

                    <div className="space-y-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                      <h4 className="font-medium text-amber-800">📄 Documents et dispositions du défunt</h4>
                      
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="existenceContratMariage"
                          checked={attestationData.defunt.existenceContratMariage}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, existenceContratMariage: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="existenceContratMariage" className="cursor-pointer">
                          Existence d'un contrat de mariage
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="existencePacs"
                          checked={attestationData.defunt.existencePacs}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, existencePacs: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="existencePacs" className="cursor-pointer">
                          Existence d'un PACS
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="existenceTestament"
                          checked={attestationData.defunt.existenceTestament}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, existenceTestament: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="existenceTestament" className="cursor-pointer">
                          Existence d'un testament
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="existenceDonationsEntreEpoux"
                          checked={attestationData.defunt.existenceDonationsEntreEpoux}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, existenceDonationsEntreEpoux: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="existenceDonationsEntreEpoux" className="cursor-pointer">
                          Donations entre époux
                        </Label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="existenceDonationsAnterieures"
                          checked={attestationData.defunt.existenceDonationsAnterieures}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            defunt: {...attestationData.defunt, existenceDonationsAnterieures: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="existenceDonationsAnterieures" className="cursor-pointer">
                          Donations antérieures au décès
                        </Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 2 : Héritiers */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Héritiers et succession</h3>
                    <div className="space-y-6">
                      {attestationData.heritiers.map((heritier, index) => (
                        <div key={heritier.id} className="p-4 bg-white rounded-lg border border-green-300 space-y-4">
                          <div className="flex justify-between items-center">
                            <h4 className="font-medium text-green-700">Héritier #{index + 1}</h4>
                            {attestationData.heritiers.length > 1 && (
                              <Button
                                type="button"
                                variant="destructive"
                                size="sm"
                                onClick={() => {
                                  setAttestationData({
                                    ...attestationData,
                                    heritiers: attestationData.heritiers.filter(h => h.id !== heritier.id)
                                  });
                                }}
                              >
                                Supprimer
                              </Button>
                            )}
                          </div>

                          <div className="space-y-2">
                            <Label>👤 Sélectionner un client existant (optionnel)</Label>
                            <Select 
                              value={heritier.clientId || "none"}
                              onValueChange={(value) => {
                                const updated = [...attestationData.heritiers];
                                if (value === "none") {
                                  // Réinitialiser aux valeurs vides pour saisie manuelle
                                  updated[index] = {...heritier, clientId: ""};
                                } else {
                                  // Remplir avec les données du client
                                  const selectedClient = clients.find(c => c.id === value);
                                  if (selectedClient) {
                                    // Calculer le statut d'âge si date de naissance disponible
                                    let statutAge = "";
                                    if (selectedClient.date_naissance) {
                                      const birthDate = new Date(selectedClient.date_naissance);
                                      const today = new Date();
                                      let age = today.getFullYear() - birthDate.getFullYear();
                                      const monthDiff = today.getMonth() - birthDate.getMonth();
                                      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                                        age--;
                                      }
                                      statutAge = age >= 18 ? "majeur" : "mineur";
                                    }
                                    updated[index] = {
                                      ...heritier,
                                      clientId: value,
                                      nom: selectedClient.nom,
                                      prenom: selectedClient.prenom,
                                      dateNaissance: selectedClient.date_naissance || "",
                                      lieuNaissance: selectedClient.lieu_naissance || "",
                                      adresseComplete: selectedClient.adresse || "",
                                      email: selectedClient.email || "",
                                      telephone: selectedClient.telephone || "",
                                      nationalite: selectedClient.nationalite || "",
                                      profession: selectedClient.profession || "",
                                      statutAge,
                                    };
                                  }
                                }
                                setAttestationData({...attestationData, heritiers: updated});
                              }}
                            >
                              <SelectTrigger>
                                <SelectValue placeholder="Aucun client sélectionné (saisie manuelle)" />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="none">❌ Aucun (saisie manuelle)</SelectItem>
                                {clients.map((client) => (
                                  <SelectItem key={client.id} value={client.id}>
                                    👤 {client.prenom} {client.nom}
                                  </SelectItem>
                                ))}
                              </SelectContent>
                            </Select>
                            {heritier.clientId && heritier.clientId !== "" && (
                              <p className="text-xs text-green-600 flex items-center gap-1">
                                ✅ Client sélectionné - Les champs sont pré-remplis
                              </p>
                            )}
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom <span className="text-red-500">*</span></Label>
                              <Input 
                                value={heritier.nom}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, nom: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="Nom"
                                required
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Prénom <span className="text-red-500">*</span></Label>
                              <Input 
                                value={heritier.prenom}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, prenom: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="Prénom"
                                required
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de naissance</Label>
                              <Input 
                                type="date"
                                value={heritier.dateNaissance}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  // Calculer l'âge automatiquement
                                  const birthDate = new Date(e.target.value);
                                  const today = new Date();
                                  let age = today.getFullYear() - birthDate.getFullYear();
                                  const monthDiff = today.getMonth() - birthDate.getMonth();
                                  if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                                    age--;
                                  }
                                  const statutAge = age >= 18 ? "majeur" : "mineur";
                                  updated[index] = {...heritier, dateNaissance: e.target.value, statutAge};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Lieu de naissance</Label>
                              <Input 
                                value={heritier.lieuNaissance}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, lieuNaissance: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="Ville, pays"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Lien de parenté avec le défunt</Label>
                              <Select 
                                value={heritier.lienParente}
                                onValueChange={(value) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, lienParente: value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                              >
                                <SelectTrigger>
                                  <SelectValue placeholder="Sélectionner" />
                                </SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="conjoint">Conjoint survivant</SelectItem>
                                  <SelectItem value="enfant">Enfant</SelectItem>
                                  <SelectItem value="petit-enfant">Petit-enfant</SelectItem>
                                  <SelectItem value="parent">Parent (père/mère)</SelectItem>
                                  <SelectItem value="frere_soeur">Frère/Sœur</SelectItem>
                                  <SelectItem value="neveu_niece">Neveu/Nièce</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Type d'acceptation de la succession</Label>
                              <Select 
                                value={heritier.typeAcceptation}
                                onValueChange={(value) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, typeAcceptation: value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                              >
                                <SelectTrigger>
                                  <SelectValue placeholder="Sélectionner" />
                                </SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="pure_simple">Acceptation pure et simple</SelectItem>
                                  <SelectItem value="concurrence_actif">À concurrence de l'actif net</SelectItem>
                                  <SelectItem value="renonciation">Renonciation</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Statut (âge) - Calculé automatiquement</Label>
                              <div className="p-3 bg-gray-100 rounded-md border">
                                {heritier.dateNaissance ? (
                                  <div className="flex items-center gap-2">
                                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                      heritier.statutAge === "majeur" 
                                        ? "bg-green-100 text-green-800" 
                                        : "bg-orange-100 text-orange-800"
                                    }`}>
                                      {heritier.statutAge === "majeur" ? "✅ Majeur" : "⚠️ Mineur"}
                                    </span>
                                    <span className="text-sm text-gray-600">
                                      (né(e) le {new Date(heritier.dateNaissance).toLocaleDateString('fr-FR')})
                                    </span>
                                  </div>
                                ) : (
                                  <span className="text-sm text-gray-500 italic">
                                    Saisissez la date de naissance pour calculer le statut
                                  </span>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2">
                              <Label>Nationalité</Label>
                              <Input 
                                value={heritier.nationalite}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, nationalite: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="Française"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Profession</Label>
                              <Input 
                                value={heritier.profession}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, profession: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="Profession"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Email</Label>
                              <Input 
                                type="email"
                                value={heritier.email}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, email: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="email@exemple.fr"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Téléphone</Label>
                              <Input 
                                value={heritier.telephone}
                                onChange={(e) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, telephone: e.target.value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                                placeholder="06 12 34 56 78"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Protection juridique éventuelle</Label>
                              <Select 
                                value={heritier.protectionJuridique}
                                onValueChange={(value) => {
                                  const updated = [...attestationData.heritiers];
                                  updated[index] = {...heritier, protectionJuridique: value};
                                  setAttestationData({...attestationData, heritiers: updated});
                                }}
                              >
                                <SelectTrigger>
                                  <SelectValue placeholder="Aucune" />
                                </SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="aucune">Aucune</SelectItem>
                                  <SelectItem value="tutelle">Sous tutelle</SelectItem>
                                  <SelectItem value="curatelle">Sous curatelle</SelectItem>
                                  <SelectItem value="sauvegarde_justice">Sauvegarde de justice</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse complète</Label>
                            <textarea 
                              value={heritier.adresseComplete}
                              onChange={(e) => {
                                const updated = [...attestationData.heritiers];
                                updated[index] = {...heritier, adresseComplete: e.target.value};
                                setAttestationData({...attestationData, heritiers: updated});
                              }}
                              placeholder="Numéro, rue, code postal, ville"
                              className="w-full min-h-[60px] p-2 border rounded-md"
                            />
                          </div>
                        </div>
                      ))}

                      <Button
                        type="button"
                        variant="outline"
                        className="w-full border-green-300 text-green-700 hover:bg-green-50"
                        onClick={() => {
                          const newId = Math.max(...attestationData.heritiers.map(h => h.id)) + 1;
                          setAttestationData({
                            ...attestationData,
                            heritiers: [...attestationData.heritiers, {
                              id: newId, nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", 
                              lienParente: "", adresseComplete: "", email: "", telephone: "", 
                              nationalite: "", profession: "", typeAcceptation: "", statutAge: "", 
                              protectionJuridique: "",
                            }]
                          });
                        }}
                      >
                        + Ajouter un héritier
                      </Button>
                    </div>

                    {/* Conjoint survivant */}
                    <div className="mt-6 p-4 bg-purple-50 rounded-lg border border-purple-200 space-y-4">
                      <h4 className="font-medium text-purple-800">💑 Conjoint survivant (si applicable)</h4>
                      
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="conjointExiste"
                          checked={attestationData.conjointSurvivant.existe}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            conjointSurvivant: {...attestationData.conjointSurvivant, existe: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="conjointExiste" className="cursor-pointer">
                          Le défunt laisse un conjoint survivant
                        </Label>
                      </div>

                      {attestationData.conjointSurvivant.existe && (
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Nom du conjoint</Label>
                            <Input 
                              value={attestationData.conjointSurvivant.nom}
                              onChange={(e) => setAttestationData({
                                ...attestationData,
                                conjointSurvivant: {...attestationData.conjointSurvivant, nom: e.target.value}
                              })}
                              placeholder="Nom"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom du conjoint</Label>
                            <Input 
                              value={attestationData.conjointSurvivant.prenom}
                              onChange={(e) => setAttestationData({
                                ...attestationData,
                                conjointSurvivant: {...attestationData.conjointSurvivant, prenom: e.target.value}
                              })}
                              placeholder="Prénom"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Régime matrimonial</Label>
                            <Input 
                              value={attestationData.conjointSurvivant.regimeMatrimonial}
                              onChange={(e) => setAttestationData({
                                ...attestationData,
                                conjointSurvivant: {...attestationData.conjointSurvivant, regimeMatrimonial: e.target.value}
                              })}
                              placeholder="Ex: Communauté réduite aux acquêts"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Droits du conjoint</Label>
                            <Input 
                              value={attestationData.conjointSurvivant.droitsConjoint}
                              onChange={(e) => setAttestationData({
                                ...attestationData,
                                conjointSurvivant: {...attestationData.conjointSurvivant, droitsConjoint: e.target.value}
                              })}
                              placeholder="Ex: Usufruit, 1/4 en pleine propriété"
                            />
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* Section 3 : Biens immobiliers */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Biens immobiliers concernés</h3>
                    <div className="space-y-6">
                      {attestationData.biens.map((bien, index) => (
                        <div key={bien.id} className="p-4 bg-white rounded-lg border border-blue-300 space-y-4">
                          <div className="flex justify-between items-center">
                            <h4 className="font-medium text-gray-700">Bien immobilier #{index + 1}</h4>
                            {attestationData.biens.length > 1 && (
                              <Button
                                type="button"
                                variant="destructive"
                                size="sm"
                                onClick={() => {
                                  setAttestationData({
                                    ...attestationData,
                                    biens: attestationData.biens.filter(b => b.id !== bien.id)
                                  });
                                }}
                              >
                                Supprimer ce bien
                              </Button>
                            )}
                          </div>

                          {/* Identité cadastrale */}
                          <div className="p-3 bg-gray-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-gray-700">📍 Identité et localisation</h5>
                            
                            <div className="space-y-2">
                              <Label>Adresse complète du bien <span className="text-red-500">*</span></Label>
                              <textarea 
                                value={bien.adresseComplete}
                                onChange={(e) => {
                                  const updated = [...attestationData.biens];
                                  updated[index] = {...bien, adresseComplete: e.target.value};
                                  setAttestationData({...attestationData, biens: updated});
                                }}
                                placeholder="Numéro, rue, code postal, ville"
                                className="w-full min-h-[60px] p-2 border rounded-md"
                                required
                              />
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Code postal</Label>
                                <Input 
                                  value={bien.codePostal}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, codePostal: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="75001"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Commune</Label>
                                <Input 
                                  value={bien.commune}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, commune: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Paris"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Section cadastrale</Label>
                                <Input 
                                  value={bien.cadastreSection}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, cadastreSection: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="AB"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Numéro de parcelle</Label>
                                <Input 
                                  value={bien.cadastreNumero}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, cadastreNumero: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="123"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Contenance cadastrale</Label>
                                <Input 
                                  value={bien.cadastreContenance}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, cadastreContenance: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="500 m²"
                                />
                              </div>
                            </div>
                          </div>

                          {/* Description du bien */}
                          <div className="p-3 bg-amber-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-amber-700">🏘️ Description du bien</h5>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Type de bien</Label>
                                <Select 
                                  value={bien.typeBien}
                                  onValueChange={(value) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, typeBien: value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="appartement">Appartement</SelectItem>
                                    <SelectItem value="maison">Maison</SelectItem>
                                    <SelectItem value="terrain">Terrain</SelectItem>
                                    <SelectItem value="immeuble">Immeuble</SelectItem>
                                    <SelectItem value="local_commercial">Local commercial</SelectItem>
                                    <SelectItem value="parking">Parking/Garage</SelectItem>
                                    <SelectItem value="autre">Autre</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Surface habitable</Label>
                                <Input 
                                  value={bien.surfaceHabitable}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, surfaceHabitable: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="80 m²"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Nombre de pièces</Label>
                                <Input 
                                  value={bien.nombrePieces}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, nombrePieces: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="3"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Dépendances</Label>
                                <Input 
                                  value={bien.dependances}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, dependances: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Cave, garage..."
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Annexes</Label>
                                <Input 
                                  value={bien.annexes}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, annexes: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Jardin, terrasse..."
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Équipements</Label>
                                <Input 
                                  value={bien.equipements}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, equipements: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Chauffage, ascenseur..."
                                />
                              </div>
                            </div>
                          </div>

                          {/* Situation locative */}
                          <div className="p-3 bg-green-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-green-700">🏘️ Situation locative</h5>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Le bien est-il loué ?</Label>
                                <Select 
                                  value={bien.situationLocative}
                                  onValueChange={(value) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, situationLocative: value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="libre">Libre d'occupation</SelectItem>
                                    <SelectItem value="loue">Loué</SelectItem>
                                    <SelectItem value="occupe_heritier">Occupé par un héritier</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              {bien.situationLocative === "loue" && (
                                <div className="space-y-2">
                                  <Label>Montant du loyer mensuel</Label>
                                  <Input 
                                    value={bien.montantLoyer}
                                    onChange={(e) => {
                                      const updated = [...attestationData.biens];
                                      updated[index] = {...bien, montantLoyer: e.target.value};
                                      setAttestationData({...attestationData, biens: updated});
                                    }}
                                    placeholder="1200 €"
                                  />
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Origine de propriété */}
                          <div className="p-3 bg-purple-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-purple-700">📜 Origine de propriété <span className="text-red-500">*</span></h5>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Date d'acquisition par le défunt</Label>
                                <Input 
                                  type="date"
                                  value={bien.dateAcquisition}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, dateAcquisition: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Nature de l'acquisition</Label>
                                <Select 
                                  value={bien.natureAcquisition}
                                  onValueChange={(value) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, natureAcquisition: value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="achat">Achat</SelectItem>
                                    <SelectItem value="donation">Donation</SelectItem>
                                    <SelectItem value="succession">Succession</SelectItem>
                                    <SelectItem value="construction">Construction</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>

                              <div className="space-y-2">
                                <Label>Notaire rédacteur de l'acte <span className="text-red-500">*</span></Label>
                                <Input 
                                  value={bien.notaireAcquisition || ""}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, notaireAcquisition: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Maître X, office notarial de..."
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Date de publication SPF <span className="text-red-500">*</span></Label>
                                <Input 
                                  type="date"
                                  value={bien.datePublicationSPF || ""}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, datePublicationSPF: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Volume SPF <span className="text-red-500">*</span></Label>
                                <Input 
                                  value={bien.volumeSPF || ""}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, volumeSPF: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Ex: 2024-15"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Numéro SPF <span className="text-red-500">*</span></Label>
                                <Input 
                                  value={bien.numeroSPF || ""}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, numeroSPF: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Ex: 42"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Répartition des droits</Label>
                                <Input 
                                  value={bien.repartitionDroits}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, repartitionDroits: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Ex: Pleine propriété"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Quote-part du défunt</Label>
                                <Input 
                                  value={bien.quotePart}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, quotePart: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="100% ou 1/2, 1/3..."
                                />
                              </div>
                            </div>

                            <div className="p-3 bg-purple-100 border border-purple-300 rounded mt-3">
                              <p className="text-xs text-purple-800">
                                ⚠️ <strong>Références SPF obligatoires</strong> - Le Service de la Publicité Foncière refusera l'attestation sans ces informations
                              </p>
                            </div>
                          </div>

                          {/* Legs particuliers */}
                          <div className="p-3 bg-amber-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-amber-700">📋 Legs particuliers</h5>
                            
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`legsParticuliers-${index}`}
                                checked={bien.existenceLegsParticuliers || false}
                                onChange={(e) => {
                                  const updated = [...attestationData.biens];
                                  updated[index] = {...bien, existenceLegsParticuliers: e.target.checked};
                                  setAttestationData({...attestationData, biens: updated});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`legsParticuliers-${index}`} className="cursor-pointer">
                                Existence de legs particuliers portant sur ce bien
                              </Label>
                            </div>

                            {bien.existenceLegsParticuliers && (
                              <div className="space-y-2 mt-2">
                                <Label>Préciser les legs</Label>
                                <textarea 
                                  value={bien.precisionLegs || ""}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, precisionLegs: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Nature et bénéficiaires des legs..."
                                  className="w-full min-h-[60px] p-2 border rounded-md"
                                />
                              </div>
                            )}
                          </div>

                          {/* Servitudes */}
                          <div className="p-3 bg-orange-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-orange-700">⚖️ Servitudes</h5>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Servitudes actives (au bénéfice du bien)</Label>
                                <textarea 
                                  value={bien.servitudesActives}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, servitudesActives: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Ex: Droit de passage..."
                                  className="w-full min-h-[60px] p-2 border rounded-md"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Servitudes passives (à la charge du bien)</Label>
                                <textarea 
                                  value={bien.servitudesPassives}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, servitudesPassives: e.target.value};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  placeholder="Ex: Servitude de vue..."
                                  className="w-full min-h-[60px] p-2 border rounded-md"
                                />
                              </div>
                            </div>
                          </div>

                          {/* Charges et hypothèques */}
                          <div className="p-3 bg-red-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-red-700">💰 Charges, prêts et hypothèques</h5>
                            
                            <div className="space-y-4">
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id={`pretEnCours-${index}`}
                                  checked={bien.pretEnCours}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, pretEnCours: e.target.checked};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  className="w-4 h-4"
                                />
                                <Label htmlFor={`pretEnCours-${index}`} className="cursor-pointer">
                                  Prêt immobilier en cours
                                </Label>
                              </div>

                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id={`hypothequeInscrite-${index}`}
                                  checked={bien.hypothequeInscrite}
                                  onChange={(e) => {
                                    const updated = [...attestationData.biens];
                                    updated[index] = {...bien, hypothequeInscrite: e.target.checked};
                                    setAttestationData({...attestationData, biens: updated});
                                  }}
                                  className="w-4 h-4"
                                />
                                <Label htmlFor={`hypothequeInscrite-${index}`} className="cursor-pointer">
                                  Hypothèque inscrite
                                </Label>
                              </div>

                              {bien.hypothequeInscrite && (
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                                  <div className="space-y-2">
                                    <Label>Type d'hypothèque</Label>
                                    <Input 
                                      value={bien.typeHypotheque}
                                      onChange={(e) => {
                                        const updated = [...attestationData.biens];
                                        updated[index] = {...bien, typeHypotheque: e.target.value};
                                        setAttestationData({...attestationData, biens: updated});
                                      }}
                                      placeholder="Conventionnelle, légale..."
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Montant résiduel</Label>
                                    <Input 
                                      value={bien.montantResiduel}
                                      onChange={(e) => {
                                        const updated = [...attestationData.biens];
                                        updated[index] = {...bien, montantResiduel: e.target.value};
                                        setAttestationData({...attestationData, biens: updated});
                                      }}
                                      placeholder="50 000 €"
                                    />
                                  </div>

                                  <div className="flex items-center space-x-2 mt-6">
                                    <input
                                      type="checkbox"
                                      id={`necessitMainlevee-${index}`}
                                      checked={bien.necessitMainlevee}
                                      onChange={(e) => {
                                        const updated = [...attestationData.biens];
                                        updated[index] = {...bien, necessitMainlevee: e.target.checked};
                                        setAttestationData({...attestationData, biens: updated});
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`necessitMainlevee-${index}`} className="cursor-pointer">
                                      Nécessite mainlevée
                                    </Label>
                                  </div>
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Copropriété */}
                          <div className="p-3 bg-indigo-50 rounded space-y-3">
                            <h5 className="font-medium text-sm text-indigo-700">🏢 Copropriété</h5>
                            
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`estCopropriete-${index}`}
                                checked={bien.estCopropriete}
                                onChange={(e) => {
                                  const updated = [...attestationData.biens];
                                  updated[index] = {...bien, estCopropriete: e.target.checked};
                                  setAttestationData({...attestationData, biens: updated});
                                }}
                                className="w-4 h-4"
                              />
                              <Label htmlFor={`estCopropriete-${index}`} className="cursor-pointer">
                                Le bien est en copropriété
                              </Label>
                            </div>

                            {bien.estCopropriete && (
                              <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-2">
                                <div className="space-y-2">
                                  <Label>Numéro de lot</Label>
                                  <Input 
                                    value={bien.numeroLot}
                                    onChange={(e) => {
                                      const updated = [...attestationData.biens];
                                      updated[index] = {...bien, numeroLot: e.target.value};
                                      setAttestationData({...attestationData, biens: updated});
                                    }}
                                    placeholder="Ex: 42"
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Quote-part parties communes</Label>
                                  <Input 
                                    value={bien.quotepartCommunes}
                                    onChange={(e) => {
                                      const updated = [...attestationData.biens];
                                      updated[index] = {...bien, quotepartCommunes: e.target.value};
                                      setAttestationData({...attestationData, biens: updated});
                                    }}
                                    placeholder="Ex: 125/10000"
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Charges annuelles</Label>
                                  <Input 
                                    value={bien.chargesAnnuelles}
                                    onChange={(e) => {
                                      const updated = [...attestationData.biens];
                                      updated[index] = {...bien, chargesAnnuelles: e.target.value};
                                      setAttestationData({...attestationData, biens: updated});
                                    }}
                                    placeholder="1500 €"
                                  />
                                </div>
                              </div>
                            )}
                          </div>
                        </div>
                      ))}

                      <Button
                        type="button"
                        variant="outline"
                        className="w-full border-blue-300 text-gray-700 hover:bg-blue-50"
                        onClick={() => {
                          const newId = Math.max(...attestationData.biens.map(b => b.id)) + 1;
                          setAttestationData({
                            ...attestationData,
                            biens: [...attestationData.biens, {
                              id: newId, adresseComplete: "", codePostal: "", commune: "", cadastreSection: "", 
                              cadastreNumero: "", cadastreContenance: "", typeBien: "", surfaceHabitable: "", 
                              nombrePieces: "", dependances: "", annexes: "", equipements: "", situationLocative: "", 
                              montantLoyer: "", dateAcquisition: "", natureAcquisition: "", repartitionDroits: "", 
                              quotePart: "", servitudesActives: "", servitudesPassives: "", pretEnCours: false, 
                              hypothequeInscrite: false, typeHypotheque: "", montantResiduel: "", 
                              necessitMainlevee: false, estCopropriete: false, numeroLot: "", quotepartCommunes: "", 
                              chargesAnnuelles: "",
                            }]
                          });
                        }}
                      >
                        + Ajouter un bien immobilier
                      </Button>
                    </div>
                  </div>

                  {/* Section 4 : Répartition des droits */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Répartition des droits sur les biens</h3>

                    <div className="p-4 bg-red-100 border-2 border-red-400 rounded-lg mb-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="indivisionSuccessorale"
                          checked={attestationData.indivisionSuccessorale || false}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            indivisionSuccessorale: e.target.checked
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="indivisionSuccessorale" className="cursor-pointer font-semibold text-red-800">
                          Les biens sont entrés en indivision successorale entre les héritiers susnommés à compter du décès <span className="text-red-500">*</span>
                        </Label>
                      </div>
                      <p className="text-xs text-red-700 mt-2 ml-6">
                        ⚠️ <strong>Mention obligatoire</strong> dans l'attestation de propriété immobilière
                      </p>
                    </div>

                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Droits du conjoint survivant (si applicable)</Label>
                        <textarea 
                          value={attestationData.repartitionDroits.conjoint}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            repartitionDroits: {...attestationData.repartitionDroits, conjoint: e.target.value}
                          })}
                          placeholder="Ex: Usufruit sur la totalité, 1/4 en pleine propriété..."
                          className="w-full min-h-[80px] p-2 border rounded-md"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition entre les héritiers</Label>
                        <textarea 
                          value={attestationData.repartitionDroits.heritiers}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            repartitionDroits: {...attestationData.repartitionDroits, heritiers: e.target.value}
                          })}
                          placeholder="Ex: Chaque enfant 1/3 en nue-propriété, parts égales..."
                          className="w-full min-h-[100px] p-2 border rounded-md"
                        />
                      </div>

                      <div className="p-3 bg-yellow-100 border border-yellow-300 rounded">
                        <p className="text-xs text-yellow-800">
                          💡 Indiquez précisément les quotes-parts de chaque héritier et la nature des droits (pleine propriété, usufruit, nue-propriété)
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* Section 5 : Destination du bien */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Destination du bien</h3>

                    <div className="space-y-2">
                      <Label>Que souhaitent faire les héritiers du bien ?</Label>
                      <Select 
                        value={attestationData.destinationBien}
                        onValueChange={(value) => setAttestationData({
                          ...attestationData,
                          destinationBien: value
                        })}
                      >
                        <SelectTrigger>
                          <SelectValue placeholder="Sélectionner" />
                        </SelectTrigger>
                        <SelectContent>
                          <SelectItem value="conservation_indivision">Conservation en indivision</SelectItem>
                          <SelectItem value="vente">Vente du bien</SelectItem>
                          <SelectItem value="partage">Partage entre héritiers</SelectItem>
                          <SelectItem value="attribution_heritier">Attribution à un héritier</SelectItem>
                          <SelectItem value="donation">Donation</SelectItem>
                          <SelectItem value="indecis">Pas encore décidé</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  {/* Section 6 : Déclarations légales */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Déclarations obligatoires</h3>

                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Loi successorale applicable</Label>
                        <Input 
                          value={attestationData.loiSuccessoraleApplicable}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            loiSuccessoraleApplicable: e.target.value
                          })}
                          placeholder="Loi française, loi du dernier domicile..."
                        />
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="confirmationAbsenceAutresHeritiers"
                          checked={attestationData.confirmationAbsenceAutresHeritiers}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            confirmationAbsenceAutresHeritiers: e.target.checked
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="confirmationAbsenceAutresHeritiers" className="cursor-pointer">
                          Déclaration sur l'honneur : absence d'autres héritiers
                        </Label>
                      </div>

                      <div className="p-4 bg-blue-50 border-2 border-blue-300 rounded-lg mt-4">
                        <h4 className="font-semibold text-blue-800 mb-3">💶 Déclaration fiscale</h4>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="declarationFiscale"
                            checked={attestationData.declarationFiscaleHonneur || false}
                            onChange={(e) => setAttestationData({
                              ...attestationData,
                              declarationFiscaleHonneur: e.target.checked
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="declarationFiscale" className="cursor-pointer">
                            Les héritiers déclarent sur l'honneur que les informations fiscales communiquées sont exactes et correspondent à la valeur réelle des biens
                          </Label>
                        </div>
                        <p className="text-xs text-gray-700 mt-2 ml-6">
                          Cette déclaration engage la responsabilité fiscale des héritiers
                        </p>
                      </div>

                      <div className="p-3 bg-red-100 border border-red-300 rounded">
                        <p className="text-xs text-red-800">
                          ⚠️ <strong>Important :</strong> Ces déclarations engagent la responsabilité des héritiers signataires
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* Section 7 : Évaluation du bien */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Évaluation du bien</h3>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Valeur vénale estimée</Label>
                        <Input 
                          value={attestationData.valeurVenale}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            valeurVenale: e.target.value
                          })}
                          placeholder="250 000 €"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Méthode d'estimation</Label>
                        <Select 
                          value={attestationData.methodeEstimation}
                          onValueChange={(value) => setAttestationData({
                            ...attestationData,
                            methodeEstimation: value
                          })}
                        >
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="comparaison">Méthode par comparaison</SelectItem>
                            <SelectItem value="expertise">Expertise professionnelle</SelectItem>
                            <SelectItem value="avis_valeur">Avis de valeur (agence)</SelectItem>
                            <SelectItem value="valeur_locative">Valeur locative capitalisée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Valeur déclarée pour le fisc</Label>
                        <Input 
                          value={attestationData.valeurDeclareeFiscale}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            valeurDeclareeFiscale: e.target.value
                          })}
                          placeholder="245 000 €"
                        />
                      </div>
                    </div>

                    <div className="p-3 bg-teal-100 border border-teal-300 rounded">
                      <p className="text-xs text-teal-800">
                        💡 La valeur vénale doit correspondre au prix de vente potentiel au jour du décès
                      </p>
                    </div>
                  </div>

                  {/* Section 8 : Formalités de publicité foncière */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Formalités de publicité foncière (SPF)</h3>

                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Bureau du Service de la Publicité Foncière compétent</Label>
                        <Input 
                          value={attestationData.bureauSPF}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            bureauSPF: e.target.value
                          })}
                          placeholder="Ex: SPF de Paris 1er"
                        />
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="fichesPreparees"
                          checked={attestationData.fichesPreparees}
                          onChange={(e) => setAttestationData({
                            ...attestationData,
                            fichesPreparees: e.target.checked
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="fichesPreparees" className="cursor-pointer">
                          Fiches immobilières préparées pour inscription
                        </Label>
                      </div>

                      <div className="p-3 bg-indigo-100 border border-indigo-300 rounded">
                        <p className="text-xs text-indigo-800">
                          📌 L'attestation doit être publiée au SPF dans les 6 mois du décès (ou dans l'année si testament)
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* Section 9 : Récapitulatif des pièces justificatives */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Pièces justificatives à fournir</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Acte de décès */}
                      <div>
                        <p className="text-xs text-gray-500 mb-2">Copie intégrale récente</p>
                        <MultiFileUpload
                          label="📄 Acte de décès"
                          required
                          files={attestationActeDecesFiles}
                          onFilesChange={setAttestationActeDecesFiles}
                          accept="application/pdf,image/*"
                        />
                      </div>

                      {/* Pièces d'identité héritiers */}
                      <div>
                        <p className="text-xs text-gray-500 mb-2">CNI ou passeport valide de tous les héritiers</p>
                        <MultiFileUpload
                          label="🪪 Pièces d'identité héritiers"
                          required
                          files={attestationIdentiteHeritiers}
                          onFilesChange={setAttestationIdentiteHeritiers}
                          accept="application/pdf,image/*"
                        />
                      </div>

                      {/* Titre de propriété */}
                      <div>
                        <p className="text-xs text-gray-500 mb-2">Acte notarié d'acquisition</p>
                        <MultiFileUpload
                          label="🏠 Titre de propriété"
                          required
                          files={attestationTitrePropriete}
                          onFilesChange={setAttestationTitrePropriete}
                          accept="application/pdf,image/*"
                        />
                      </div>

                      {/* Livret de famille */}
                      <div>
                        <p className="text-xs text-gray-500 mb-2">À jour</p>
                        <MultiFileUpload
                          label="👨‍👩‍👧‍👦 Livret de famille"
                          required
                          files={attestationLivretFamille}
                          onFilesChange={setAttestationLivretFamille}
                          accept="application/pdf,image/*"
                        />
                      </div>

                      {/* Testament (conditionnel) */}
                      {attestationData.defunt.existenceTestament && (
                        <div>
                          <p className="text-xs text-amber-600 mb-2">Copie authentique ou dépôt chez notaire</p>
                          <MultiFileUpload
                            label="📜 Testament"
                            required
                            files={attestationTestament}
                            onFilesChange={setAttestationTestament}
                            accept="application/pdf,image/*"
                          />
                        </div>
                      )}

                      {/* Contrat de mariage (conditionnel) */}
                      {attestationData.defunt.existenceContratMariage && (
                        <div>
                          <p className="text-xs text-purple-600 mb-2">Copie authentique</p>
                          <MultiFileUpload
                            label="💍 Contrat de mariage"
                            required
                            files={attestationContratMariage}
                            onFilesChange={setAttestationContratMariage}
                            accept="application/pdf,image/*"
                          />
                        </div>
                      )}

                      {/* Règlement copropriété (conditionnel) */}
                      {attestationData.biens.some(b => b.estCopropriete) && (
                        <div>
                          <p className="text-xs text-gray-700 mb-2">+ dernier PV d'assemblée générale</p>
                          <MultiFileUpload
                            label="🏢 Règlement de copropriété"
                            files={attestationCopropriete}
                            onFilesChange={setAttestationCopropriete}
                            accept="application/pdf,image/*"
                          />
                        </div>
                      )}

                      {/* Baux (conditionnel) */}
                      {attestationData.biens.some(b => b.situationLocative === "loue") && (
                        <div>
                          <p className="text-xs text-green-600 mb-2">Copies des contrats de location</p>
                          <MultiFileUpload
                            label="📄 Baux en cours"
                            files={attestationBaux}
                            onFilesChange={setAttestationBaux}
                            accept="application/pdf,image/*"
                          />
                        </div>
                      )}

                      {/* État hypothécaire (conditionnel) */}
                      {attestationData.biens.some(b => b.hypothequeInscrite) && (
                        <div>
                          <p className="text-xs text-red-600 mb-2">Moins de 3 mois</p>
                          <MultiFileUpload
                            label="💰 État hypothécaire"
                            required
                            files={attestationHypotheque}
                            onFilesChange={setAttestationHypotheque}
                            accept="application/pdf,image/*"
                          />
                        </div>
                      )}

                      {/* Justificatifs de domicile */}
                      <div>
                        <p className="text-xs text-gray-500 mb-2">Moins de 3 mois pour chaque héritier</p>
                        <MultiFileUpload
                          label="📋 Justificatifs de domicile"
                          required
                          files={attestationJustifDomicile}
                          onFilesChange={setAttestationJustifDomicile}
                          accept="application/pdf,image/*"
                        />
                      </div>
                    </div>

                    <div className="p-4 bg-blue-100 border border-blue-300 rounded-lg mt-4">
                      <p className="text-sm font-semibold text-blue-800 mb-2">📌 Documents à préparer :</p>
                      <ul className="text-xs text-gray-700 space-y-1 list-disc list-inside">
                        <li>Extrait cadastral et plan de masse</li>
                        <li>Taxe foncière (dernier avis)</li>
                        <li>Diagnostic de performance énergétique (DPE) si vente prévue</li>
                        <li>Attestation assurance habitation</li>
                        <li>Relevé d'identité bancaire pour succession</li>
                      </ul>
                    </div>
                  </div>

                  {/* Section 10 : Notes et observations */}
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Notes et observations complémentaires</h3>

                    <div className="space-y-2">
                      <Label>Informations complémentaires</Label>
                      <textarea 
                        value={attestationData.regimeMatrimonial}
                        onChange={(e) => setAttestationData({
                          ...attestationData,
                          regimeMatrimonial: e.target.value
                        })}
                        placeholder="Toute information utile : particularités de la succession, difficultés rencontrées, héritiers injoignables, litiges potentiels..."
                        className="w-full min-h-[150px] p-3 border rounded-md"
                      />
                    </div>

                  </div>
                </div>
            )}

            {/* Formulaire Quitus / Reconnaissance de dette */}
            {pendingContractType === "Quitus / reconnaissance de dette" && (
              <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                
                {/* Section 1 : Type d'acte à générer */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Type d'acte à générer</h3>
                  <div className="space-y-3">
                    <Label>Type d'acte <span className="text-red-500">*</span></Label>
                    <Select
                      value={quitusDetteData.typeActe}
                      onValueChange={(value) => setQuitusDetteData({...quitusDetteData, typeActe: value})}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Sélectionner le type d'acte" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="reconnaissance_dette">☐ Reconnaissance de dette (dette NON réglée)</SelectItem>
                        <SelectItem value="reconnaissance_dette_modalites">☐ Reconnaissance de dette + modalités de remboursement</SelectItem>
                        <SelectItem value="quitus">☐ Quitus (dette totalement réglée)</SelectItem>
                        <SelectItem value="quitus_partiel">☐ Quitus partiel</SelectItem>
                        <SelectItem value="remise_dette">☐ Remise de dette (abandon total ou partiel)</SelectItem>
                        <SelectItem value="solde_tout_compte">☐ Solde de tout compte entre particuliers</SelectItem>
                        <SelectItem value="attestation_reglement">☐ Attestation de règlement d'une somme due</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* Section 2 : Identité complète du créancier */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Identité complète du CRÉANCIER (celui qui prête)</h3>
                  <div className="space-y-2">
                    <Label>Le créancier est-il votre client ?</Label>
                    <RadioGroup
                      value={quitusDetteData.creancier.isClient ? "client" : "autre"}
                      onValueChange={(value) => {
                        setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, isClient: value === "client"}
                        });
                      }}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="client" id="creancier_client" />
                        <Label htmlFor="creancier_client" className="cursor-pointer">Oui, c'est un de mes clients</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="autre" id="creancier_autre" />
                        <Label htmlFor="creancier_autre" className="cursor-pointer">Non, saisie manuelle</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {quitusDetteData.creancier.isClient && (
                    <ClientSelector
                      clients={clients}
                      selectedClientId={quitusDetteData.creancier.clientId}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const selectedClient = clients.find(c => c.id === clientId);
                          if (selectedClient) {
                            // Extraire la situation familiale de l'objet JSON
                            let situationFamiliale = "";
                            if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
                              situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
                            } else if (typeof selectedClient.situation_familiale === 'string') {
                              situationFamiliale = selectedClient.situation_familiale;
                            }
                            
                            setQuitusDetteData({
                              ...quitusDetteData,
                              creancier: {
                                ...quitusDetteData.creancier,
                                clientId: clientId,
                                nom: selectedClient.nom,
                                prenom: selectedClient.prenom,
                                dateNaissance: selectedClient.date_naissance || "",
                                lieuNaissance: selectedClient.lieu_naissance || "",
                                nationalite: selectedClient.nationalite || "",
                                profession: selectedClient.profession || "",
                                adresseComplete: selectedClient.adresse || "",
                                telephone: selectedClient.telephone || "",
                                email: selectedClient.email || "",
                                typeIdentite: selectedClient.type_identite || "",
                                numeroIdentite: selectedClient.numero_identite || "",
                                situationMatrimoniale: situationFamiliale || selectedClient.situation_matrimoniale || "",
                              }
                            });
                          }
                        } else {
                          setQuitusDetteData({
                            ...quitusDetteData,
                            creancier: {
                              ...quitusDetteData.creancier,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              dateNaissance: "",
                              lieuNaissance: "",
                              nationalite: "",
                              profession: "",
                              adresseComplete: "",
                              telephone: "",
                              email: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                              situationMatrimoniale: "",
                            }
                          });
                        }
                      }}
                      label="Sélectionner le client créancier"
                      placeholder="Choisir un client..."
                    />
                  )}

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom <span className="text-red-500">*</span></Label>
                      <Input
                        value={quitusDetteData.creancier.nom}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, nom: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Prénom <span className="text-red-500">*</span></Label>
                      <Input
                        value={quitusDetteData.creancier.prenom}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, prenom: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Nom de naissance</Label>
                      <Input
                        value={quitusDetteData.creancier.nomNaissance}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, nomNaissance: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Date de naissance</Label>
                      <Input
                        type="date"
                        value={quitusDetteData.creancier.dateNaissance}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, dateNaissance: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Lieu de naissance</Label>
                      <Input
                        value={quitusDetteData.creancier.lieuNaissance}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, lieuNaissance: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Nationalité</Label>
                      <Input
                        value={quitusDetteData.creancier.nationalite}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, nationalite: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Profession</Label>
                      <Input
                        value={quitusDetteData.creancier.profession}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, profession: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Situation matrimoniale</Label>
                      <Input
                        value={quitusDetteData.creancier.situationMatrimoniale}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, situationMatrimoniale: e.target.value}
                        })}
                        placeholder="Renseignée automatiquement si client sélectionné"
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse complète <span className="text-red-500">*</span></Label>
                      <Input
                        value={quitusDetteData.creancier.adresseComplete}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, adresseComplete: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Téléphone</Label>
                      <Input
                        value={quitusDetteData.creancier.telephone}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, telephone: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Email</Label>
                      <Input
                        type="email"
                        value={quitusDetteData.creancier.email}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, email: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Type de pièce d'identité</Label>
                      <Select
                        value={quitusDetteData.creancier.typeIdentite}
                        onValueChange={(value) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, typeIdentite: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="CNI">Carte Nationale d'Identité</SelectItem>
                          <SelectItem value="Passeport">Passeport</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Numéro de pièce d'identité</Label>
                      <Input
                        value={quitusDetteData.creancier.numeroIdentite}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, numeroIdentite: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>RIB (si remboursement prévu par virement)</Label>
                      <Input
                        value={quitusDetteData.creancier.rib}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          creancier: {...quitusDetteData.creancier, rib: e.target.value}
                        })}
                        placeholder="FR76..."
                      />
                    </div>
                  </div>

                  <div className="space-y-2">
                    <MultiFileUpload
                      label="📄 Pièce d'identité du créancier"
                      required
                      files={quitusCreancierIdentiteFiles}
                      onFilesChange={setQuitusCreancierIdentiteFiles}
                      accept="application/pdf,image/*"
                    />
                  </div>

                  <div className="space-y-2">
                    <MultiFileUpload
                      label="📋 Justificatif de domicile du créancier"
                      files={quitusJustifDomicileCreancierFiles}
                      onFilesChange={setQuitusJustifDomicileCreancierFiles}
                      accept="application/pdf,image/*"
                    />
                  </div>
                </div>

                {/* Section 3 : Identité complète du débiteur */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Identité complète du DÉBITEUR (celui qui emprunte)</h3>
                  <div className="space-y-2">
                    <Label>Le débiteur est-il votre client ?</Label>
                    <RadioGroup
                      value={quitusDetteData.debiteur.isClient ? "client" : "autre"}
                      onValueChange={(value) => {
                        setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, isClient: value === "client"}
                        });
                      }}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="client" id="debiteur_client" />
                        <Label htmlFor="debiteur_client" className="cursor-pointer">Oui, c'est un de mes clients</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="autre" id="debiteur_autre" />
                        <Label htmlFor="debiteur_autre" className="cursor-pointer">Non, saisie manuelle</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {quitusDetteData.debiteur.isClient && (
                    <ClientSelector
                      clients={clients}
                      selectedClientId={quitusDetteData.debiteur.clientId}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const selectedClient = clients.find(c => c.id === clientId);
                          if (selectedClient) {
                            // Extraire la situation familiale de l'objet JSON
                            let situationFamiliale = "";
                            if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
                              situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
                            } else if (typeof selectedClient.situation_familiale === 'string') {
                              situationFamiliale = selectedClient.situation_familiale;
                            }
                            
                            setQuitusDetteData({
                              ...quitusDetteData,
                              debiteur: {
                                ...quitusDetteData.debiteur,
                                clientId: clientId,
                                nom: selectedClient.nom,
                                prenom: selectedClient.prenom,
                                dateNaissance: selectedClient.date_naissance || "",
                                lieuNaissance: selectedClient.lieu_naissance || "",
                                nationalite: selectedClient.nationalite || "",
                                profession: selectedClient.profession || "",
                                adresseComplete: selectedClient.adresse || "",
                                telephone: selectedClient.telephone || "",
                                email: selectedClient.email || "",
                                typeIdentite: selectedClient.type_identite || "",
                                numeroIdentite: selectedClient.numero_identite || "",
                                situationMatrimoniale: situationFamiliale || selectedClient.situation_matrimoniale || "",
                              }
                            });
                          }
                        } else {
                          setQuitusDetteData({
                            ...quitusDetteData,
                            debiteur: {
                              ...quitusDetteData.debiteur,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              dateNaissance: "",
                              lieuNaissance: "",
                              nationalite: "",
                              profession: "",
                              adresseComplete: "",
                              telephone: "",
                              email: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                              situationMatrimoniale: "",
                            }
                          });
                        }
                      }}
                      label="Sélectionner le client débiteur"
                      placeholder="Choisir un client..."
                    />
                  )}

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom <span className="text-red-500">*</span></Label>
                      <Input
                        value={quitusDetteData.debiteur.nom}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, nom: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Prénom <span className="text-red-500">*</span></Label>
                      <Input
                        value={quitusDetteData.debiteur.prenom}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, prenom: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Nom de naissance</Label>
                      <Input
                        value={quitusDetteData.debiteur.nomNaissance}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, nomNaissance: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Date de naissance</Label>
                      <Input
                        type="date"
                        value={quitusDetteData.debiteur.dateNaissance}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, dateNaissance: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Lieu de naissance</Label>
                      <Input
                        value={quitusDetteData.debiteur.lieuNaissance}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, lieuNaissance: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Nationalité</Label>
                      <Input
                        value={quitusDetteData.debiteur.nationalite}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, nationalite: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Profession</Label>
                      <Input
                        value={quitusDetteData.debiteur.profession}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, profession: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Situation matrimoniale</Label>
                      <Input
                        value={quitusDetteData.debiteur.situationMatrimoniale}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, situationMatrimoniale: e.target.value}
                        })}
                        placeholder="Renseignée automatiquement si client sélectionné"
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse complète <span className="text-red-500">*</span></Label>
                      <Input
                        value={quitusDetteData.debiteur.adresseComplete}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, adresseComplete: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Téléphone</Label>
                      <Input
                        value={quitusDetteData.debiteur.telephone}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, telephone: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Email</Label>
                      <Input
                        type="email"
                        value={quitusDetteData.debiteur.email}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, email: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label>Type de pièce d'identité</Label>
                      <Select
                        value={quitusDetteData.debiteur.typeIdentite}
                        onValueChange={(value) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, typeIdentite: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="CNI">Carte Nationale d'Identité</SelectItem>
                          <SelectItem value="Passeport">Passeport</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Numéro de pièce d'identité</Label>
                      <Input
                        value={quitusDetteData.debiteur.numeroIdentite}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, numeroIdentite: e.target.value}
                        })}
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>RIB (si prélèvements ou paiements programmés)</Label>
                      <Input
                        value={quitusDetteData.debiteur.rib}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          debiteur: {...quitusDetteData.debiteur, rib: e.target.value}
                        })}
                        placeholder="FR76..."
                      />
                    </div>
                  </div>

                  <div className="space-y-2">
                    <MultiFileUpload
                      label="📄 Pièce d'identité du débiteur"
                      required
                      files={quitusDebiteurIdentiteFiles}
                      onFilesChange={setQuitusDebiteurIdentiteFiles}
                      accept="application/pdf,image/*"
                    />
                  </div>

                  <div className="space-y-2">
                    <MultiFileUpload
                      label="📋 Justificatif de domicile du débiteur"
                      files={quitusJustifDomicileDebiteurFiles}
                      onFilesChange={setQuitusJustifDomicileDebiteurFiles}
                      accept="application/pdf,image/*"
                    />
                  </div>
                </div>

                {/* Section 4 : Objet de la dette */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Objet de la dette</h3>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nature de la dette <span className="text-red-500">*</span></Label>
                      <Select
                        value={quitusDetteData.objetDette.natureDette}
                        onValueChange={(value) => setQuitusDetteData({
                          ...quitusDetteData,
                          objetDette: {...quitusDetteData.objetDette, natureDette: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="pret_argent">Prêt d'argent</SelectItem>
                          <SelectItem value="avance_fonds">Avance de fonds</SelectItem>
                          <SelectItem value="aide_exceptionnelle">Aide exceptionnelle</SelectItem>
                          <SelectItem value="remboursement_depenses">Remboursement de dépenses</SelectItem>
                          <SelectItem value="participation_projet">Participation dans un projet</SelectItem>
                          <SelectItem value="dette_commerciale">Dette commerciale informelle</SelectItem>
                          <SelectItem value="dette_familiale">Dette familiale</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Date de naissance de la dette <span className="text-red-500">*</span></Label>
                      <Input
                        type="date"
                        value={quitusDetteData.objetDette.dateNaissanceDette}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          objetDette: {...quitusDetteData.objetDette, dateNaissanceDette: e.target.value}
                        })}
                      />
                    </div>
                    
                    <div className="space-y-2 md:col-span-2">
                      <Label>Circonstances de la dette <span className="text-red-500">*</span></Label>
                      <textarea
                        value={quitusDetteData.objetDette.circonstancesDette}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          objetDette: {...quitusDetteData.objetDette, circonstancesDette: e.target.value}
                        })}
                        className="w-full min-h-[100px] p-3 border rounded-md"
                        placeholder="Décrivez les circonstances précises : pourquoi, comment, dans quel contexte..."
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Preuve écrite existante ?</Label>
                      <RadioGroup
                        value={quitusDetteData.objetDette.preuveEcriteExiste ? "oui" : "non"}
                        onValueChange={(value) => setQuitusDetteData({
                          ...quitusDetteData,
                          objetDette: {...quitusDetteData.objetDette, preuveEcriteExiste: value === "oui"}
                        })}
                      >
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="oui" id="preuve_oui" />
                          <Label htmlFor="preuve_oui" className="cursor-pointer">Oui</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="non" id="preuve_non" />
                          <Label htmlFor="preuve_non" className="cursor-pointer">Non</Label>
                        </div>
                      </RadioGroup>
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Témoins éventuels</Label>
                      <Input
                        value={quitusDetteData.objetDette.temoinsEventuels}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          objetDette: {...quitusDetteData.objetDette, temoinsEventuels: e.target.value}
                        })}
                        placeholder="Nom(s) et coordonnées des témoins"
                      />
                    </div>
                  </div>

                  {quitusDetteData.objetDette.preuveEcriteExiste && (
                    <div className="space-y-2">
                      <MultiFileUpload
                        label="📄 Preuve écrite de la dette"
                        files={quitusPreuveDetteFiles}
                        onFilesChange={setQuitusPreuveDetteFiles}
                        accept="application/pdf,image/*"
                      />
                    </div>
                  )}
                </div>

                {/* Section 5 : Montant de la dette */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Montant de la dette</h3>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Montant total exact (en euros) <span className="text-red-500">*</span></Label>
                      <Input
                        type="number"
                        step="0.01"
                        value={quitusDetteData.montant.montantTotal}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          montant: {...quitusDetteData.montant, montantTotal: e.target.value}
                        })}
                        placeholder="0.00"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Devise</Label>
                      <Select
                        value={quitusDetteData.montant.devise}
                        onValueChange={(value) => setQuitusDetteData({
                          ...quitusDetteData,
                          montant: {...quitusDetteData.montant, devise: value}
                        })}
                      >
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="EUR">EUR (€)</SelectItem>
                          <SelectItem value="USD">USD ($)</SelectItem>
                          <SelectItem value="GBP">GBP (£)</SelectItem>
                          <SelectItem value="CHF">CHF</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Somme déjà remboursée</Label>
                      <Input
                        type="number"
                        step="0.01"
                        value={quitusDetteData.montant.sommeDejaRemboursee}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          montant: {...quitusDetteData.montant, sommeDejaRemboursee: e.target.value}
                        })}
                        placeholder="0.00"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Somme restant due</Label>
                      <Input
                        type="number"
                        step="0.01"
                        value={quitusDetteData.montant.sommeRestantDue}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          montant: {...quitusDetteData.montant, sommeRestantDue: e.target.value}
                        })}
                        placeholder="0.00"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Montant reconnu par le débiteur</Label>
                      <Input
                        type="number"
                        step="0.01"
                        value={quitusDetteData.montant.montantReconnuDebiteur}
                        onChange={(e) => setQuitusDetteData({
                          ...quitusDetteData,
                          montant: {...quitusDetteData.montant, montantReconnuDebiteur: e.target.value}
                        })}
                        placeholder="0.00"
                      />
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Modalité du prêt <span className="text-red-500">*</span></Label>
                      <Select
                        value={quitusDetteData.montant.modalitePret}
                        onValueChange={(value) => setQuitusDetteData({
                          ...quitusDetteData,
                          montant: {...quitusDetteData.montant, modalitePret: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="transfert_bancaire">Transfert bancaire</SelectItem>
                          <SelectItem value="cheque">Remise de chèque</SelectItem>
                          <SelectItem value="especes">Espèces</SelectItem>
                          <SelectItem value="virement">Virement entre comptes</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <MultiFileUpload
                      label="💰 Preuve du transfert d'argent"
                      files={quitusPreuveTransfertFiles}
                      onFilesChange={setQuitusPreuveTransfertFiles}
                      accept="application/pdf,image/*"
                    />
                  </div>

                  <div className="p-3 bg-yellow-100 border border-yellow-300 rounded">
                    <p className="text-xs text-yellow-800">
                      💡 Calcul automatique : Somme restant due = Montant total - Somme déjà remboursée
                    </p>
                  </div>

                  {/* Date d'exigibilité si quitus partiel ou solde restant dû */}
                  {(quitusDetteData.typeActe === "quitus_partiel" || parseFloat(quitusDetteData.montant.sommeRestantDue) > 0) && (
                    <div className="p-4 bg-red-100 border-2 border-red-300 rounded-lg mt-4">
                      <div className="space-y-2">
                        <Label htmlFor="date_exigibilite_solde" className="font-medium text-red-900">
                          🔴 Date d'exigibilité du solde restant dû <span className="text-red-600">*</span>
                        </Label>
                        <Input
                          id="date_exigibilite_solde"
                          type="date"
                          value={quitusDetteData.montant.dateExigibiliteSolde}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            montant: {...quitusDetteData.montant, dateExigibiliteSolde: e.target.value}
                          })}
                        />
                        <p className="text-xs text-red-800">
                          ⚠️ <strong>Indispensable</strong> si la dette n'est pas totalement éteinte. Fixe la date à laquelle le solde devient exigible.
                        </p>
                      </div>
                    </div>
                  )}
                </div>

                {/* Section 6 : Conditions de remboursement */}
                {(quitusDetteData.typeActe === "reconnaissance_dette" || quitusDetteData.typeActe === "reconnaissance_dette_modalites") && (
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Conditions de remboursement</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Modalité de remboursement <span className="text-red-500">*</span></Label>
                        <Select
                          value={quitusDetteData.remboursement.modalite}
                          onValueChange={(value) => setQuitusDetteData({
                            ...quitusDetteData,
                            remboursement: {...quitusDetteData.remboursement, modalite: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="une_fois">☐ En une seule fois</SelectItem>
                            <SelectItem value="plusieurs_echeances">☐ En plusieurs échéances</SelectItem>
                            <SelectItem value="libre">☐ Remboursement libre sans échéances</SelectItem>
                            <SelectItem value="premiere_demande">☐ Remboursement à la première demande</SelectItem>
                            <SelectItem value="conditionnel">☐ Remboursement conditionnel</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {quitusDetteData.remboursement.modalite === "conditionnel" && (
                        <div className="space-y-2">
                          <Label>Condition du remboursement</Label>
                          <Input
                            value={quitusDetteData.remboursement.conditionRemboursement}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              remboursement: {...quitusDetteData.remboursement, conditionRemboursement: e.target.value}
                            })}
                            placeholder="Ex: vente d'un bien, obtention d'un crédit, etc."
                          />
                        </div>
                      )}

                      {quitusDetteData.remboursement.modalite === "plusieurs_echeances" && (
                        <div className="space-y-4">
                          <div className="flex items-center justify-between">
                            <Label className="font-medium">Échéancier de remboursement</Label>
                            <Button
                              type="button"
                              size="sm"
                              variant="outline"
                              onClick={() => {
                                const newEcheance = {
                                  id: quitusDetteData.remboursement.echeances.length + 1,
                                  date: "",
                                  montant: "",
                                  moyenPaiement: "",
                                  consequencesRetard: ""
                                };
                                setQuitusDetteData({
                                  ...quitusDetteData,
                                  remboursement: {
                                    ...quitusDetteData.remboursement,
                                    echeances: [...quitusDetteData.remboursement.echeances, newEcheance]
                                  }
                                });
                              }}
                            >
                              + Ajouter une échéance
                            </Button>
                          </div>

                          {quitusDetteData.remboursement.echeances.map((echeance, index) => (
                            <div key={echeance.id} className="p-4 border rounded-lg bg-white space-y-3">
                              <div className="flex justify-between items-center">
                                <h4 className="font-medium">Échéance #{index + 1}</h4>
                                {quitusDetteData.remboursement.echeances.length > 1 && (
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    onClick={() => {
                                      setQuitusDetteData({
                                        ...quitusDetteData,
                                        remboursement: {
                                          ...quitusDetteData.remboursement,
                                          echeances: quitusDetteData.remboursement.echeances.filter(e => e.id !== echeance.id)
                                        }
                                      });
                                    }}
                                  >
                                    Supprimer
                                  </Button>
                                )}
                              </div>
                              
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label>Date</Label>
                                  <Input
                                    type="date"
                                    value={echeance.date}
                                    onChange={(e) => {
                                      const updated = [...quitusDetteData.remboursement.echeances];
                                      updated[index] = {...echeance, date: e.target.value};
                                      setQuitusDetteData({
                                        ...quitusDetteData,
                                        remboursement: {...quitusDetteData.remboursement, echeances: updated}
                                      });
                                    }}
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Montant (€)</Label>
                                  <Input
                                    type="number"
                                    step="0.01"
                                    value={echeance.montant}
                                    onChange={(e) => {
                                      const updated = [...quitusDetteData.remboursement.echeances];
                                      updated[index] = {...echeance, montant: e.target.value};
                                      setQuitusDetteData({
                                        ...quitusDetteData,
                                        remboursement: {...quitusDetteData.remboursement, echeances: updated}
                                      });
                                    }}
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Moyen de paiement</Label>
                                  <Input
                                    value={echeance.moyenPaiement}
                                    onChange={(e) => {
                                      const updated = [...quitusDetteData.remboursement.echeances];
                                      updated[index] = {...echeance, moyenPaiement: e.target.value};
                                      setQuitusDetteData({
                                        ...quitusDetteData,
                                        remboursement: {...quitusDetteData.remboursement, echeances: updated}
                                      });
                                    }}
                                    placeholder="Virement, chèque, espèces..."
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Conséquences en cas de retard</Label>
                                  <Input
                                    value={echeance.consequencesRetard}
                                    onChange={(e) => {
                                      const updated = [...quitusDetteData.remboursement.echeances];
                                      updated[index] = {...echeance, consequencesRetard: e.target.value};
                                      setQuitusDetteData({
                                        ...quitusDetteData,
                                        remboursement: {...quitusDetteData.remboursement, echeances: updated}
                                      });
                                    }}
                                    placeholder="Pénalités, intérêts de retard..."
                                  />
                                </div>
                              </div>
                            </div>
                          ))}

                          <div className="space-y-2">
                            <MultiFileUpload
                              label="📋 Échéancier signé"
                              files={quitusEcheancierFiles}
                              onFilesChange={setQuitusEcheancierFiles}
                              accept="application/pdf,image/*"
                            />
                          </div>
                        </div>
                      )}

                      {/* Intérêts */}
                      <div className="space-y-3 p-4 border rounded-lg">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="avec_interets"
                            checked={quitusDetteData.remboursement.avecInterets}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              remboursement: {...quitusDetteData.remboursement, avecInterets: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="avec_interets" className="cursor-pointer font-medium">
                            Avec intérêts
                          </Label>
                        </div>

                        {quitusDetteData.remboursement.avecInterets && (
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
                            <div className="space-y-2">
                              <Label>Taux d'intérêt (%)</Label>
                              <Input
                                type="number"
                                step="0.01"
                                value={quitusDetteData.remboursement.tauxInteret}
                                onChange={(e) => setQuitusDetteData({
                                  ...quitusDetteData,
                                  remboursement: {...quitusDetteData.remboursement, tauxInteret: e.target.value}
                                })}
                                placeholder="Ex: 3.5"
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Taux usuraire applicable</Label>
                              <Input
                                value={quitusDetteData.remboursement.tauxUsuraire}
                                onChange={(e) => setQuitusDetteData({
                                  ...quitusDetteData,
                                  remboursement: {...quitusDetteData.remboursement, tauxUsuraire: e.target.value}
                                })}
                                placeholder="À vérifier selon la loi"
                              />
                            </div>
                            <div className="space-y-2 flex items-end">
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="capitalisation"
                                  checked={quitusDetteData.remboursement.capitalisationInterets}
                                  onChange={(e) => setQuitusDetteData({
                                    ...quitusDetteData,
                                    remboursement: {...quitusDetteData.remboursement, capitalisationInterets: e.target.checked}
                                  })}
                                  className="rounded"
                                />
                                <Label htmlFor="capitalisation" className="cursor-pointer">
                                  Capitalisation des intérêts
                                </Label>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Clause pénale */}
                      <div className="space-y-3 p-4 border rounded-lg">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="clause_penale"
                            checked={quitusDetteData.remboursement.clausePenale}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              remboursement: {...quitusDetteData.remboursement, clausePenale: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="clause_penale" className="cursor-pointer font-medium">
                            Clause pénale en cas d'impayé
                          </Label>
                        </div>

                        {quitusDetteData.remboursement.clausePenale && (
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
                            <div className="space-y-2">
                              <Label>Montant de la pénalité (€)</Label>
                              <Input
                                type="number"
                                step="0.01"
                                value={quitusDetteData.remboursement.montantPenalite}
                                onChange={(e) => setQuitusDetteData({
                                  ...quitusDetteData,
                                  remboursement: {...quitusDetteData.remboursement, montantPenalite: e.target.value}
                                })}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Pourcentage appliqué (%)</Label>
                              <Input
                                type="number"
                                step="0.01"
                                value={quitusDetteData.remboursement.pourcentagePenalite}
                                onChange={(e) => setQuitusDetteData({
                                  ...quitusDetteData,
                                  remboursement: {...quitusDetteData.remboursement, pourcentagePenalite: e.target.value}
                                })}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Délai de grâce (jours)</Label>
                              <Input
                                value={quitusDetteData.remboursement.delaiGrace}
                                onChange={(e) => setQuitusDetteData({
                                  ...quitusDetteData,
                                  remboursement: {...quitusDetteData.remboursement, delaiGrace: e.target.value}
                                })}
                                placeholder="Ex: 15 jours"
                              />
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                )}

                {/* Section 7 : Sûretés et garanties */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Sûretés et garanties (optionnelles)</h3>
                  
                  <div className="space-y-4">
                    {/* Caution personnelle */}
                    <div className="p-4 border rounded-lg space-y-3">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="caution_personnelle"
                          checked={quitusDetteData.suretes.cautionPersonnelle}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            suretes: {...quitusDetteData.suretes, cautionPersonnelle: e.target.checked}
                          })}
                          className="rounded"
                        />
                        <Label htmlFor="caution_personnelle" className="cursor-pointer font-medium">
                          ☐ Caution personnelle
                        </Label>
                      </div>

                      {quitusDetteData.suretes.cautionPersonnelle && (
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-3">
                          <div className="space-y-2">
                            <Label>Identité du cautionnaire</Label>
                            <Input
                              value={quitusDetteData.suretes.cautionIdentite}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                suretes: {...quitusDetteData.suretes, cautionIdentite: e.target.value}
                              })}
                              placeholder="Nom complet"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Montant garanti (€)</Label>
                            <Input
                              type="number"
                              step="0.01"
                              value={quitusDetteData.suretes.cautionMontant}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                suretes: {...quitusDetteData.suretes, cautionMontant: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Durée du cautionnement</Label>
                            <Input
                              value={quitusDetteData.suretes.cautionDuree}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                suretes: {...quitusDetteData.suretes, cautionDuree: e.target.value}
                              })}
                              placeholder="Ex: 24 mois"
                            />
                          </div>
                        </div>
                      )}

                      {quitusDetteData.suretes.cautionPersonnelle && (
                        <div className="space-y-2">
                          <MultiFileUpload
                            label="📄 Pièce d'identité de la caution"
                            files={quitusCautionIdentiteFiles}
                            onFilesChange={setQuitusCautionIdentiteFiles}
                            accept="application/pdf,image/*"
                          />
                        </div>
                      )}
                    </div>

                    {/* Autres sûretés */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="garantie_salaire"
                          checked={quitusDetteData.suretes.garantieSalaire}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            suretes: {...quitusDetteData.suretes, garantieSalaire: e.target.checked}
                          })}
                          className="rounded"
                        />
                        <Label htmlFor="garantie_salaire" className="cursor-pointer">
                          ☐ Garantie sur salaire (engagement moral)
                        </Label>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="gage_mobilier"
                            checked={quitusDetteData.suretes.gageMobilier}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, gageMobilier: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="gage_mobilier" className="cursor-pointer">
                            ☐ Gage / nantissement d'un bien mobilier
                          </Label>
                        </div>
                        {quitusDetteData.suretes.gageMobilier && (
                          <Input
                            value={quitusDetteData.suretes.gageDescription}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, gageDescription: e.target.value}
                            })}
                            placeholder="Description du bien"
                            className="mt-2"
                          />
                        )}
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="nantissement_titres"
                            checked={quitusDetteData.suretes.nantissementTitres}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, nantissementTitres: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="nantissement_titres" className="cursor-pointer">
                            ☐ Nantissement de compte-titres
                          </Label>
                        </div>
                        {quitusDetteData.suretes.nantissementTitres && (
                          <Input
                            value={quitusDetteData.suretes.nantissementDetails}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, nantissementDetails: e.target.value}
                            })}
                            placeholder="Détails du compte-titres"
                            className="mt-2"
                          />
                        )}
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="hypotheque"
                            checked={quitusDetteData.suretes.hypotheque}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, hypotheque: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="hypotheque" className="cursor-pointer">
                            ☐ Hypothèque (rare pour particuliers)
                          </Label>
                        </div>
                        {quitusDetteData.suretes.hypotheque && (
                          <Input
                            value={quitusDetteData.suretes.hypothequeDetails}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, hypothequeDetails: e.target.value}
                            })}
                            placeholder="Détails de l'hypothèque"
                            className="mt-2"
                          />
                        )}
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="depot_garantie"
                            checked={quitusDetteData.suretes.depotGarantie}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, depotGarantie: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="depot_garantie" className="cursor-pointer">
                            ☐ Dépôt de garantie / somme bloquée
                          </Label>
                        </div>
                        {quitusDetteData.suretes.depotGarantie && (
                          <Input
                            type="number"
                            step="0.01"
                            value={quitusDetteData.suretes.depotMontant}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, depotMontant: e.target.value}
                            })}
                            placeholder="Montant (€)"
                            className="mt-2"
                          />
                        )}
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="acte_authentique"
                            checked={quitusDetteData.suretes.acteAuthentique}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, acteAuthentique: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="acte_authentique" className="cursor-pointer">
                            ☐ Reconnaissance de dette authentique (devant notaire)
                          </Label>
                        </div>
                        {quitusDetteData.suretes.acteAuthentique && (
                          <Input
                            value={quitusDetteData.suretes.notaireNom}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              suretes: {...quitusDetteData.suretes, notaireNom: e.target.value}
                            })}
                            placeholder="Nom du notaire"
                            className="mt-2"
                          />
                        )}
                      </div>
                    </div>
                  </div>
                </div>

                {/* Section 8 : Remise de dette */}
                {quitusDetteData.typeActe === "remise_dette" && (
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Remise de dette (abandon de créance)</h3>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Type de remise</Label>
                        <RadioGroup
                          value={quitusDetteData.remiseDette.remiseTotale ? "totale" : "partielle"}
                          onValueChange={(value) => setQuitusDetteData({
                            ...quitusDetteData,
                            remiseDette: {
                              ...quitusDetteData.remiseDette,
                              remiseTotale: value === "totale",
                              remisePartielle: value === "partielle"
                            }
                          })}
                        >
                          <div className="flex items-center space-x-2">
                            <RadioGroupItem value="totale" id="remise_totale" />
                            <Label htmlFor="remise_totale" className="cursor-pointer">☐ Remise totale de dette</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <RadioGroupItem value="partielle" id="remise_partielle" />
                            <Label htmlFor="remise_partielle" className="cursor-pointer">☐ Remise partielle</Label>
                          </div>
                        </RadioGroup>
                      </div>

                      {quitusDetteData.remiseDette.remisePartielle && (
                        <div className="space-y-2">
                          <Label>Montant de la remise (€)</Label>
                          <Input
                            type="number"
                            step="0.01"
                            value={quitusDetteData.remiseDette.montantRemise}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              remiseDette: {...quitusDetteData.remiseDette, montantRemise: e.target.value}
                            })}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Conditions de la remise</Label>
                        <textarea
                          value={quitusDetteData.remiseDette.conditionsRemise}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            remiseDette: {...quitusDetteData.remiseDette, conditionsRemise: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-3 border rounded-md"
                          placeholder="Conditions et raisons de la remise de dette..."
                        />
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="effets_retroactifs"
                            checked={quitusDetteData.remiseDette.effetsRetroactifs}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              remiseDette: {...quitusDetteData.remiseDette, effetsRetroactifs: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="effets_retroactifs" className="cursor-pointer">
                            Effets rétroactifs
                          </Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="renonciation_poursuites"
                            checked={quitusDetteData.remiseDette.renonciationPoursuites}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              remiseDette: {...quitusDetteData.remiseDette, renonciationPoursuites: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="renonciation_poursuites" className="cursor-pointer">
                            Renonciation à poursuites futures
                          </Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Preuve de paiement partiel déjà reçu</Label>
                        <textarea
                          value={quitusDetteData.remiseDette.preuvesPaiementsPartiels}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            remiseDette: {...quitusDetteData.remiseDette, preuvesPaiementsPartiels: e.target.value}
                          })}
                          className="w-full min-h-[60px] p-3 border rounded-md"
                          placeholder="Détails des paiements partiels reçus..."
                        />
                      </div>
                    </div>
                  </div>
                )}

                {/* Section 9 : Quitus */}
                {(quitusDetteData.typeActe === "quitus" || quitusDetteData.typeActe === "quitus_partiel" || quitusDetteData.typeActe === "solde_tout_compte" || quitusDetteData.typeActe === "attestation_reglement") && (
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Quitus (dette réglée)</h3>
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Type de quitus</Label>
                        <Select
                          value={quitusDetteData.quitus.typeQuitus}
                          onValueChange={(value) => setQuitusDetteData({
                            ...quitusDetteData,
                            quitus: {...quitusDetteData.quitus, typeQuitus: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="total">☐ Quitus total (dette éteinte)</SelectItem>
                            <SelectItem value="partiel">☐ Quitus partiel</SelectItem>
                            <SelectItem value="comptable">☐ Quitus comptable (solde de tout compte)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Paiements reçus */}
                      <div className="space-y-4">
                        <div className="flex items-center justify-between">
                          <Label className="font-medium">Paiements reçus</Label>
                          <Button
                            type="button"
                            size="sm"
                            variant="outline"
                            onClick={() => {
                              const newPaiement = {
                                id: quitusDetteData.quitus.paiementsRecus.length + 1,
                                date: "",
                                montant: "",
                                modePaiement: "",
                                referenceBancaire: ""
                              };
                              setQuitusDetteData({
                                ...quitusDetteData,
                                quitus: {
                                  ...quitusDetteData.quitus,
                                  paiementsRecus: [...quitusDetteData.quitus.paiementsRecus, newPaiement]
                                }
                              });
                            }}
                          >
                            + Ajouter un paiement
                          </Button>
                        </div>

                        {quitusDetteData.quitus.paiementsRecus.map((paiement, index) => (
                          <div key={paiement.id} className="p-4 border rounded-lg bg-white space-y-3">
                            <div className="flex justify-between items-center">
                              <h4 className="font-medium">Paiement #{index + 1}</h4>
                              {quitusDetteData.quitus.paiementsRecus.length > 1 && (
                                <Button
                                  type="button"
                                  variant="ghost"
                                  size="sm"
                                  onClick={() => {
                                    setQuitusDetteData({
                                      ...quitusDetteData,
                                      quitus: {
                                        ...quitusDetteData.quitus,
                                        paiementsRecus: quitusDetteData.quitus.paiementsRecus.filter(p => p.id !== paiement.id)
                                      }
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              )}
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Date</Label>
                                <Input
                                  type="date"
                                  value={paiement.date}
                                  onChange={(e) => {
                                    const updated = [...quitusDetteData.quitus.paiementsRecus];
                                    updated[index] = {...paiement, date: e.target.value};
                                    setQuitusDetteData({
                                      ...quitusDetteData,
                                      quitus: {...quitusDetteData.quitus, paiementsRecus: updated}
                                    });
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Montant (€)</Label>
                                <Input
                                  type="number"
                                  step="0.01"
                                  value={paiement.montant}
                                  onChange={(e) => {
                                    const updated = [...quitusDetteData.quitus.paiementsRecus];
                                    updated[index] = {...paiement, montant: e.target.value};
                                    setQuitusDetteData({
                                      ...quitusDetteData,
                                      quitus: {...quitusDetteData.quitus, paiementsRecus: updated}
                                    });
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Mode de paiement</Label>
                                <Input
                                  value={paiement.modePaiement}
                                  onChange={(e) => {
                                    const updated = [...quitusDetteData.quitus.paiementsRecus];
                                    updated[index] = {...paiement, modePaiement: e.target.value};
                                    setQuitusDetteData({
                                      ...quitusDetteData,
                                      quitus: {...quitusDetteData.quitus, paiementsRecus: updated}
                                    });
                                  }}
                                  placeholder="Virement, chèque..."
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Référence bancaire</Label>
                                <Input
                                  value={paiement.referenceBancaire}
                                  onChange={(e) => {
                                    const updated = [...quitusDetteData.quitus.paiementsRecus];
                                    updated[index] = {...paiement, referenceBancaire: e.target.value};
                                    setQuitusDetteData({
                                      ...quitusDetteData,
                                      quitus: {...quitusDetteData.quitus, paiementsRecus: updated}
                                    });
                                  }}
                                  placeholder="Numéro de transaction"
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="💰 Preuves des paiements reçus"
                          required
                          files={quitusPreuvesPaiementsFiles}
                          onFilesChange={setQuitusPreuvesPaiementsFiles}
                          accept="application/pdf,image/*"
                        />
                      </div>

                      {/* Déclarations du créancier */}
                      <div className="space-y-3 p-4 border rounded-lg bg-teal-100">
                        <Label className="font-medium">Déclarations du créancier (obligatoires)</Label>
                        
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="sommes_recues"
                              checked={quitusDetteData.quitus.sommesRecuesTotalement}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                quitus: {...quitusDetteData.quitus, sommesRecuesTotalement: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="sommes_recues" className="cursor-pointer">
                              Avoir reçu toutes les sommes dues
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="renonciation_reclamations"
                              checked={quitusDetteData.quitus.renonciationReclamations}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                quitus: {...quitusDetteData.quitus, renonciationReclamations: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="renonciation_reclamations" className="cursor-pointer">
                              Renoncer à toute réclamation future
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="dette_eteinte"
                              checked={quitusDetteData.quitus.detteEteinte}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                quitus: {...quitusDetteData.quitus, detteEteinte: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="dette_eteinte" className="cursor-pointer">
                              Reconnaître la dette comme entièrement éteinte
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="annulation_garanties"
                              checked={quitusDetteData.quitus.annulationGaranties}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                quitus: {...quitusDetteData.quitus, annulationGaranties: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="annulation_garanties" className="cursor-pointer">
                              Annuler les garanties éventuellement données
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="restitution_documents"
                              checked={quitusDetteData.quitus.restitutionDocuments}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                quitus: {...quitusDetteData.quitus, restitutionDocuments: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="restitution_documents" className="cursor-pointer">
                              Restituer les documents remis en garantie
                            </Label>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <MultiFileUpload
                          label="📄 Ancienne reconnaissance de dette"
                          files={quitusAncienneDetteFiles}
                          onFilesChange={setQuitusAncienneDetteFiles}
                          accept="application/pdf,image/*"
                        />
                      </div>
                    </div>
                  </div>
                )}

                {/* Section 10 : Clauses légales */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Clauses légales</h3>
                  
                  <div className="space-y-4">
                    {(quitusDetteData.typeActe === "reconnaissance_dette" || quitusDetteData.typeActe === "reconnaissance_dette_modalites") && (
                      <div className="space-y-3">
                        <Label className="font-medium text-slate-700">Clauses obligatoires pour reconnaissance de dette</Label>
                        
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="consentement_libre"
                              checked={quitusDetteData.clausesLegales.consentementLibre}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, consentementLibre: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="consentement_libre" className="cursor-pointer">
                              Consentement libre et éclairé (absence de vice)
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="reconnaissance_montant"
                              checked={quitusDetteData.clausesLegales.reconnaissanceMontant}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, reconnaissanceMontant: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="reconnaissance_montant" className="cursor-pointer">
                              Reconnaissance du montant exact de la dette
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="engagement_remboursement"
                              checked={quitusDetteData.clausesLegales.engagementRemboursement}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, engagementRemboursement: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="engagement_remboursement" className="cursor-pointer">
                              Engagement de remboursement
                            </Label>
                          </div>

                          <div className="space-y-2 mt-4">
                            <Label htmlFor="mention_manuscrite">
                              Mention manuscrite obligatoire (à recopier par le débiteur) <span className="text-red-600">*</span>
                            </Label>
                            <textarea
                              id="mention_manuscrite"
                              value={quitusDetteData.clausesLegales.mentionManuscrite}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, mentionManuscrite: e.target.value}
                              })}
                              className="w-full min-h-[100px] p-3 border rounded-md"
                              placeholder={`Ex: "Je reconnais devoir la somme de ... euros à ... au titre de ... Je m'engage à rembourser selon les modalités décrites ci-dessus."`}
                            />
                            <p className="text-xs text-gray-600">
                              ⚠️ Cette mention doit être écrite de la main du débiteur pour être valable
                            </p>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="clause_solidarite"
                              checked={quitusDetteData.clausesLegales.clauseSolidarite}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, clauseSolidarite: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="clause_solidarite" className="cursor-pointer">
                              Clause de solidarité (si plusieurs débiteurs)
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="clause_divisibilite"
                              checked={quitusDetteData.clausesLegales.clauseDivisibilite}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, clauseDivisibilite: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="clause_divisibilite" className="cursor-pointer">
                              Clause de divisibilité / indépendance des clauses
                            </Label>
                          </div>
                        </div>
                      </div>
                    )}

                    {(quitusDetteData.typeActe === "quitus" || quitusDetteData.typeActe === "quitus_partiel" || quitusDetteData.typeActe === "solde_tout_compte" || quitusDetteData.typeActe === "remise_dette" || quitusDetteData.typeActe === "attestation_reglement") && (
                      <div className="space-y-3">
                        <Label className="font-medium text-slate-700">Clauses pour quitus / extinction de dette</Label>
                        
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="extinction_dette"
                              checked={quitusDetteData.clausesLegales.extinctionDette}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, extinctionDette: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="extinction_dette" className="cursor-pointer">
                              Extinction complète de la dette
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="liberation_definitive"
                              checked={quitusDetteData.clausesLegales.liberationDefinitive}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, liberationDefinitive: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="liberation_definitive" className="cursor-pointer">
                              Libération définitive du débiteur
                            </Label>
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="renonciation_recours"
                              checked={quitusDetteData.clausesLegales.renonciationRecours}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, renonciationRecours: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="renonciation_recours" className="cursor-pointer">
                              Renonciation à tout recours ultérieur
                            </Label>
                          </div>

                          <div className="space-y-2 mt-4">
                            <Label htmlFor="identification_dette">
                              Identification précise de la dette éteinte
                            </Label>
                            <textarea
                              id="identification_dette"
                              value={quitusDetteData.clausesLegales.identificationDette}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, identificationDette: e.target.value}
                              })}
                              className="w-full min-h-[80px] p-3 border rounded-md"
                              placeholder="Description précise de la dette qui est éteinte (date, montant, nature...)"
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* Nouvelles clauses juridiques importantes */}
                    <div className="space-y-3 mt-6 p-4 border-2 border-red-300 rounded-lg bg-red-50">
                      <Label className="font-medium text-red-800 text-base">🔴 Clauses juridiques essentielles</Label>
                      
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="clause_non_novation"
                            checked={quitusDetteData.clausesLegales.clauseNonNovation}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              clausesLegales: {...quitusDetteData.clausesLegales, clauseNonNovation: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="clause_non_novation" className="cursor-pointer text-sm">
                            <strong>Clause de non-novation</strong> - Le présent acte ne constitue pas novation de la dette initiale
                          </Label>
                        </div>
                        <p className="text-xs text-gray-600 ml-6">
                          ⚠️ Important : Prévient qu'un simple quitus ou reconnaissance ne crée pas une nouvelle dette
                        </p>

                        <div className="space-y-3 mt-4">
                          <div className="space-y-2">
                            <Label htmlFor="droit_applicable">
                              🔴 Droit applicable <span className="text-red-600">*</span>
                            </Label>
                            <Select
                              value={quitusDetteData.clausesLegales.droitApplicable}
                              onValueChange={(value) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, droitApplicable: value}
                              })}
                            >
                              <SelectTrigger id="droit_applicable"><SelectValue /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="france">☐ Droit français</SelectItem>
                                <SelectItem value="autre">☐ Autre droit (à préciser)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label htmlFor="tribunal_competent">
                              🔴 Tribunal compétent <span className="text-red-600">*</span>
                            </Label>
                            <Input
                              id="tribunal_competent"
                              value={quitusDetteData.clausesLegales.tribunalCompetent}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, tribunalCompetent: e.target.value}
                              })}
                              placeholder="Ex: Tribunal de grande instance de Paris"
                            />
                            <p className="text-xs text-gray-600">
                              Indispensable en cas de litige. Généralement le tribunal du lieu du domicile du débiteur.
                            </p>
                          </div>
                        </div>

                        <div className="space-y-2 mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                          <Label className="font-medium text-sm">Pluralité de débiteurs (si applicable)</Label>
                          
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pluralite_debiteurs"
                              checked={quitusDetteData.clausesLegales.pluraliteDebiteurs}
                              onChange={(e) => setQuitusDetteData({
                                ...quitusDetteData,
                                clausesLegales: {...quitusDetteData.clausesLegales, pluraliteDebiteurs: e.target.checked}
                              })}
                              className="rounded"
                            />
                            <Label htmlFor="pluralite_debiteurs" className="cursor-pointer">
                              Plusieurs débiteurs
                            </Label>
                          </div>

                          {quitusDetteData.clausesLegales.pluraliteDebiteurs && (
                            <div className="mt-3 space-y-2">
                              <RadioGroup
                                value={quitusDetteData.clausesLegales.solidarite ? "solidaire" : "non_solidaire"}
                                onValueChange={(value) => setQuitusDetteData({
                                  ...quitusDetteData,
                                  clausesLegales: {...quitusDetteData.clausesLegales, solidarite: value === "solidaire"}
                                })}
                              >
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="solidaire" id="solidarite_oui" />
                                  <Label htmlFor="solidarite_oui" className="cursor-pointer">
                                    ☐ Solidarité (chaque débiteur peut être poursuivi pour la totalité)
                                  </Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non_solidaire" id="solidarite_non" />
                                  <Label htmlFor="solidarite_non" className="cursor-pointer">
                                    ☐ Non solidarité (chacun ne doit que sa part)
                                  </Label>
                                </div>
                              </RadioGroup>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Section 11 : Signatures */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Signatures et formalités</h3>
                  
                  <div className="space-y-4">
                    {/* Dates importantes */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="date_extinction_effective">
                          🔴 Date effective d'extinction de la dette
                        </Label>
                        <Input
                          id="date_extinction_effective"
                          type="date"
                          value={quitusDetteData.signatures.dateExtinctionEffective}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            signatures: {...quitusDetteData.signatures, dateExtinctionEffective: e.target.value}
                          })}
                        />
                        <p className="text-xs text-gray-600">
                          Différente de la date de signature. Date réelle de paiement final ou d'extinction.
                        </p>
                      </div>

                      <div className="space-y-2">
                        <Label htmlFor="date_signature">
                          Date de signature <span className="text-red-600">*</span>
                        </Label>
                        <Input
                          id="date_signature"
                          type="date"
                          value={quitusDetteData.signatures.dateSignature}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            signatures: {...quitusDetteData.signatures, dateSignature: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label htmlFor="lieu_signature">
                          Lieu de signature <span className="text-red-600">*</span>
                        </Label>
                        <Input
                          id="lieu_signature"
                          value={quitusDetteData.signatures.lieuSignature}
                          onChange={(e) => setQuitusDetteData({
                            ...quitusDetteData,
                            signatures: {...quitusDetteData.signatures, lieuSignature: e.target.value}
                          })}
                          placeholder="Ville"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label htmlFor="signature_notaire">
                          Signature devant notaire ?
                        </Label>
                        <Select
                          value={quitusDetteData.signatures.signatureNotaire}
                          onValueChange={(value) => setQuitusDetteData({
                            ...quitusDetteData,
                            signatures: {...quitusDetteData.signatures, signatureNotaire: value}
                          })}
                        >
                          <SelectTrigger id="signature_notaire"><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non (acte sous seing privé)</SelectItem>
                            <SelectItem value="oui">Oui (acte authentique)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {quitusDetteData.signatures.signatureNotaire === "oui" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                        <div className="space-y-2">
                          <Label htmlFor="nom_notaire">
                            Nom du notaire <span className="text-red-600">*</span>
                          </Label>
                          <Input
                            id="nom_notaire"
                            value={quitusDetteData.signatures.nomNotaire}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              signatures: {...quitusDetteData.signatures, nomNotaire: e.target.value}
                            })}
                            placeholder="Nom complet"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="ville_notaire">
                            Ville du notaire <span className="text-red-600">*</span>
                          </Label>
                          <Input
                            id="ville_notaire"
                            value={quitusDetteData.signatures.villeNotaire}
                            onChange={(e) => setQuitusDetteData({
                              ...quitusDetteData,
                              signatures: {...quitusDetteData.signatures, villeNotaire: e.target.value}
                            })}
                            placeholder="Ville de l'étude"
                          />
                        </div>
                      </div>
                    )}
                  </div>
                </div>

              </div>
            )}

            {/* Formulaire Acte de cession de parts sociales */}
            {pendingContractType === "Acte de cession de parts sociales" && (
              <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                
                {/* Section 1 : Type de société */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Type de société</h3>
                  <div className="space-y-3">
                    <Label>Type de société <span className="text-red-500">*</span></Label>
                    <Select
                      value={cessionPartsData.typeSociete}
                      onValueChange={(value) => setCessionPartsData({...cessionPartsData, typeSociete: value})}
                    >
                      <SelectTrigger><SelectValue placeholder="Sélectionner le type de société" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="sarl">SARL (Société à responsabilité limitée)</SelectItem>
                        <SelectItem value="sci">SCI (Société civile immobilière)</SelectItem>
                        <SelectItem value="sas">SAS (Société par actions simplifiée - acte sous seing privé)</SelectItem>
                        <SelectItem value="snc">SNC (Société en nom collectif)</SelectItem>
                        <SelectItem value="autre_personne">Autre société de personnes</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* Section 2 : Informations sur la société */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Informations sur la société</h3>
                  

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Dénomination sociale <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.denominationSociale}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, denominationSociale: e.target.value}
                        })}
                        placeholder="Raison sociale de la société"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Sigle (si existant)</Label>
                      <Input
                        value={cessionPartsData.societe.sigle}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, sigle: e.target.value}
                        })}
                        placeholder="Sigle commercial"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Forme juridique <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.formeJuridique}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, formeJuridique: e.target.value}
                        })}
                        placeholder="SARL, SCI, SAS..."
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Capital social <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.capitalSocial}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, capitalSocial: e.target.value}
                        })}
                        placeholder="Montant du capital"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Siège social <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.siegeSocial}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, siegeSocial: e.target.value}
                        })}
                        placeholder="Adresse complète du siège"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>SIREN <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.siren}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, siren: e.target.value}
                        })}
                        placeholder="Numéro SIREN (9 chiffres)"
                        maxLength={9}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>RCS + Greffe compétent <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.rcs}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, rcs: e.target.value}
                        })}
                        placeholder="Ex: RCS Paris 123456789"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Greffe compétent <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.greffeCompetent}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, greffeCompetent: e.target.value}
                        })}
                        placeholder="Nom du greffe"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Activité de la société <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.societe.activiteSociete}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, activiteSociete: e.target.value}
                        })}
                        placeholder="Secteur d'activité"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Date de création <span className="text-red-500">*</span></Label>
                      <Input
                        type="date"
                        value={cessionPartsData.societe.dateCreation}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, dateCreation: e.target.value}
                        })}
                      />
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label>Objet social <span className="text-red-500">*</span></Label>
                    <Textarea
                      value={cessionPartsData.societe.objetSocial}
                      onChange={(e) => setCessionPartsData({
                        ...cessionPartsData,
                        societe: {...cessionPartsData.societe, objetSocial: e.target.value}
                      })}
                      placeholder="Décrire l'objet social de la société"
                      rows={3}
                    />
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Existence d'un pacte d'associés</Label>
                      <Select
                        value={cessionPartsData.societe.pacteAssocies ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, pacteAssocies: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui (à fournir)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Existence d'un expert-comptable</Label>
                      <Select
                        value={cessionPartsData.societe.expertComptable ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          societe: {...cessionPartsData.societe, expertComptable: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  {/* Identité du gérant/président */}
                  <div className="bg-white p-4 rounded-lg border border-green-300 space-y-4">
                    <h4 className="font-semibold text-green-800">Identité du gérant / président</h4>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.societe.gerantNom}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            societe: {...cessionPartsData.societe, gerantNom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.societe.gerantPrenom}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            societe: {...cessionPartsData.societe, gerantPrenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.societe.gerantAdresse}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            societe: {...cessionPartsData.societe, gerantAdresse: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Pouvoirs selon statuts</Label>
                        <Textarea
                          value={cessionPartsData.societe.gerantPouvoirs}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            societe: {...cessionPartsData.societe, gerantPouvoirs: e.target.value}
                          })}
                          placeholder="Décrire les pouvoirs du gérant/président"
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* Upload statuts */}
                  <div className="space-y-2">
                    <Label className="text-red-600 font-semibold">📄 Statuts de la société (obligatoire)</Label>
                    <MultiFileUpload
                      files={cessionStatutsFiles}
                      onFilesChange={setCessionStatutsFiles}
                      accept=".pdf,.doc,.docx"
                      label="Joindre les statuts à jour"
                    />
                  </div>
                </div>

                {/* Section 3 : Identité du cédant (vendeur) */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Identité complète du cédant (vendeur des parts)</h3>
                  {clients && clients.length > 0 && (
                    <ClientSelector
                      clients={clients}
                      selectedClientId={cessionPartsData.cedant.clientId}
                      onClientChange={(clientId) => {
                        if (clientId) {
                          const selectedClient = clients.find(c => c.id === clientId);
                          if (selectedClient) {
                            // Extraire la situation familiale de l'objet JSON
                            let situationFamiliale = "";
                            if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
                              situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
                            } else if (typeof selectedClient.situation_familiale === 'string') {
                              situationFamiliale = selectedClient.situation_familiale;
                            }
                            
                            // Extraire régime matrimonial seulement si marié/pacsé
                            let regimeMatrimonial = "";
                            const situation = situationFamiliale.toLowerCase();
                            if (situation.includes("marié") || situation.includes("pacsé") || situation.includes("pacse")) {
                              if (typeof selectedClient.regime_matrimonial === 'object' && selectedClient.regime_matrimonial !== null) {
                                regimeMatrimonial = selectedClient.regime_matrimonial.regime_matrimonial || "";
                              } else if (typeof selectedClient.regime_matrimonial === 'string') {
                                regimeMatrimonial = selectedClient.regime_matrimonial;
                              }
                            }
                            
                            setCessionPartsData({
                              ...cessionPartsData,
                              cedant: {
                                ...cessionPartsData.cedant,
                                clientId: clientId,
                                nom: selectedClient.nom,
                                prenom: selectedClient.prenom,
                                dateNaissance: selectedClient.date_naissance || "",
                                nationalite: selectedClient.nationalite || "",
                                profession: selectedClient.profession || "",
                                adresseComplete: selectedClient.adresse || "",
                                telephone: selectedClient.telephone || "",
                                email: selectedClient.email || "",
                                typeIdentite: selectedClient.type_identite || "",
                                numeroIdentite: selectedClient.numero_identite || "",
                                situationMatrimoniale: situationFamiliale || selectedClient.situation_matrimoniale || "",
                                regimeMatrimonial: regimeMatrimonial,
                              }
                            });
                          }
                        } else {
                          setCessionPartsData({
                            ...cessionPartsData,
                            cedant: {
                              ...cessionPartsData.cedant,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              dateNaissance: "",
                              nationalite: "",
                              profession: "",
                              adresseComplete: "",
                              telephone: "",
                              email: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                              situationMatrimoniale: "",
                              regimeMatrimonial: "",
                            }
                          });
                        }
                      }}
                      label="Lier à un client existant (facultatif)"
                      placeholder="Choisir un client..."
                    />
                  )}

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.cedant.nom}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, nom: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Prénom <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.cedant.prenom}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, prenom: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Nom de naissance</Label>
                      <Input
                        value={cessionPartsData.cedant.nomNaissance}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, nomNaissance: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Date de naissance <span className="text-red-500">*</span></Label>
                      <Input
                        type="date"
                        value={cessionPartsData.cedant.dateNaissance}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, dateNaissance: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Nationalité <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.cedant.nationalite}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, nationalite: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Profession</Label>
                      <Input
                        value={cessionPartsData.cedant.profession}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, profession: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse complète <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.cedant.adresseComplete}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, adresseComplete: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Email</Label>
                      <Input
                        type="email"
                        value={cessionPartsData.cedant.email}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, email: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Téléphone</Label>
                      <Input
                        value={cessionPartsData.cedant.telephone}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, telephone: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Situation matrimoniale</Label>
                      <Input
                        value={cessionPartsData.cedant.situationMatrimoniale}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, situationMatrimoniale: e.target.value}
                        })}
                        placeholder="Célibataire, marié(e), pacsé(e)..."
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Régime matrimonial</Label>
                      <Input
                        value={cessionPartsData.cedant.regimeMatrimonial}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, regimeMatrimonial: e.target.value}
                        })}
                        placeholder="Communauté, séparation de biens..."
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Type de pièce d'identité <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.cedant.typeIdentite}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, typeIdentite: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="cni">Carte nationale d'identité</SelectItem>
                          <SelectItem value="passeport">Passeport</SelectItem>
                          <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Numéro de pièce d'identité <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.cedant.numeroIdentite}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, numeroIdentite: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Qualité dans la société <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.cedant.qualiteSociete}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          cedant: {...cessionPartsData.cedant, qualiteSociete: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner la qualité" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="associe">Associé</SelectItem>
                          <SelectItem value="gerant_president">Gérant / Président</SelectItem>
                          <SelectItem value="associe_fondateur">Associé fondateur</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Section 4 : Identité du cessionnaire (acheteur) */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Identité complète du cessionnaire (acheteur)</h3>
                  <div className="space-y-2">
                    <Label>Type de personne <span className="text-red-500">*</span></Label>
                    <Select
                      value={cessionPartsData.cessionnaire.typePersonne}
                      onValueChange={(value) => setCessionPartsData({
                        ...cessionPartsData,
                        cessionnaire: {...cessionPartsData.cessionnaire, typePersonne: value as "physique" | "morale"}
                      })}
                    >
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="physique">Personne physique</SelectItem>
                        <SelectItem value="morale">Personne morale (société)</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  {cessionPartsData.cessionnaire.typePersonne === "physique" && (
                    <>
                      {clients && clients.length > 0 && (
                        <ClientSelector
                          clients={clients}
                          selectedClientId={cessionPartsData.cessionnaire.clientId || ""}
                          onClientChange={(clientId) => {
                            if (clientId) {
                              const selectedClient = clients.find(c => c.id === clientId);
                              if (selectedClient) {
                                // Extraire la situation familiale
                                let situationFamiliale = "";
                                if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  situationFamiliale = selectedClient.situation_familiale;
                                }
                                
                                setCessionPartsData({
                                  ...cessionPartsData,
                                  cessionnaire: {
                                    ...cessionPartsData.cessionnaire,
                                    clientId: clientId,
                                    nom: selectedClient.nom,
                                    prenom: selectedClient.prenom,
                                    dateNaissance: selectedClient.date_naissance || "",
                                    nationalite: selectedClient.nationalite || "",
                                    profession: selectedClient.profession || "",
                                    adresseComplete: selectedClient.adresse || "",
                                    telephone: selectedClient.telephone || "",
                                    email: selectedClient.email || "",
                                    typeIdentite: selectedClient.type_identite || "",
                                    numeroIdentite: selectedClient.numero_identite || "",
                                    situationMatrimoniale: situationFamiliale || selectedClient.situation_matrimoniale || "",
                                  }
                                });
                              }
                            } else {
                              setCessionPartsData({
                                ...cessionPartsData,
                                cessionnaire: {
                                  ...cessionPartsData.cessionnaire,
                                  clientId: "",
                                  nom: "",
                                  prenom: "",
                                  dateNaissance: "",
                                  nationalite: "",
                                  profession: "",
                                  adresseComplete: "",
                                  telephone: "",
                                  email: "",
                                  typeIdentite: "",
                                  numeroIdentite: "",
                                  situationMatrimoniale: "",
                                }
                              });
                            }
                          }}
                          label="Lier à un client existant (facultatif)"
                          placeholder="Choisir un client..."
                        />
                      )}

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.nom}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.prenom}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.adresseComplete}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, adresseComplete: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={cessionPartsData.cessionnaire.email}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, email: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={cessionPartsData.cessionnaire.telephone}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={cessionPartsData.cessionnaire.dateNaissance}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.nationalite}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={cessionPartsData.cessionnaire.profession}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Situation matrimoniale</Label>
                        <Input
                          value={cessionPartsData.cessionnaire.situationMatrimoniale}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, situationMatrimoniale: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Type pièce d'identité <span className="text-red-500">*</span></Label>
                        <Select
                          value={cessionPartsData.cessionnaire.typeIdentite}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, typeIdentite: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="cni">CNI</SelectItem>
                            <SelectItem value="passeport">Passeport</SelectItem>
                            <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro pièce d'identité <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.numeroIdentite}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, numeroIdentite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Capacité juridique</Label>
                        <Select
                          value={cessionPartsData.cessionnaire.capaciteJuridique}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, capaciteJuridique: value}
                          })}
                        >
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="majeur">Majeur capable</SelectItem>
                            <SelectItem value="mineur">Mineur</SelectItem>
                            <SelectItem value="protege">Majeur protégé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                    </>
                  )}

                  {cessionPartsData.cessionnaire.typePersonne === "morale" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Dénomination sociale <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.denominationMorale}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, denominationMorale: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Représentant légal <span className="text-red-500">*</span></Label>
                        <Input
                          value={cessionPartsData.cessionnaire.representantLegal}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            cessionnaire: {...cessionPartsData.cessionnaire, representantLegal: e.target.value}
                          })}
                          placeholder="Nom et prénom du représentant"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label className="text-red-600 font-semibold">📄 Extrait Kbis (obligatoire)</Label>
                        <MultiFileUpload
                          files={cessionCessionnaireKbisFiles}
                          onFilesChange={setCessionCessionnaireKbisFiles}
                          accept=".pdf"
                          label="Joindre Kbis de moins de 3 mois"
                        />
                      </div>
                    </div>
                  )}
                </div>

                {/* Section 5 : Objet de la cession */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Objet de la cession</h3>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label>Nature exacte des titres selon la forme sociale <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.objetCession.natureTitres}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, natureTitres: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="parts_sociales">Parts sociales (SARL / SNC / SCI)</SelectItem>
                          <SelectItem value="actions">Actions (SAS / SA)</SelectItem>
                        </SelectContent>
                      </Select>
                      <p className="text-xs text-amber-700">⚠️ Qualification juridique essentielle</p>
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Type de droits cédés <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.objetCession.typeDroits}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, typeDroits: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="parts_sociales">Parts sociales</SelectItem>
                          <SelectItem value="actions">Actions (SAS)</SelectItem>
                          <SelectItem value="droits_indivis">Droits indivis sur parts</SelectItem>
                          <SelectItem value="compte_courant">Compte courant d'associé (créance)</SelectItem>
                          <SelectItem value="cession_reprise_dette">Cession + reprise de dette éventuelle</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Nombre de parts cédées <span className="text-red-500">*</span></Label>
                      <Input
                        type="number"
                        value={cessionPartsData.objetCession.nombreParts}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, nombreParts: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Pourcentage du capital <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.objetCession.pourcentageCapital}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, pourcentageCapital: e.target.value}
                        })}
                        placeholder="Ex: 25%"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Valeur nominale <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.objetCession.valeurNominale}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, valeurNominale: e.target.value}
                        })}
                        placeholder="Valeur nominale par part"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Prix total de cession <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.objetCession.prixTotal}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, prixTotal: e.target.value}
                        })}
                        placeholder="Montant total en €"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Prix unitaire par part</Label>
                      <Input
                        value={cessionPartsData.objetCession.prixUnitaire}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, prixUnitaire: e.target.value}
                        })}
                        placeholder="Prix par part"
                      />
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Mode de calcul du prix <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.objetCession.modeCalcul}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, modeCalcul: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="valeur_marche">Valeur de marché</SelectItem>
                          <SelectItem value="valeur_comptable">Valeur comptable</SelectItem>
                          <SelectItem value="clause_statutaire">Clause statutaire</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Modalités de paiement <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.objetCession.modalitePaiement}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, modalitePaiement: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="comptant">Comptant</SelectItem>
                          <SelectItem value="echelonne">Échelonné</SelectItem>
                          <SelectItem value="differe">Paiement différé</SelectItem>
                          <SelectItem value="conditionnel">Paiement conditionnel</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>RIB du cédant <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.objetCession.ribCedant}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, ribCedant: e.target.value}
                        })}
                        placeholder="IBAN"
                      />
                    </div>
                  </div>

                  {/* Date d'effet de la cession */}
                  <div className="bg-white p-4 rounded-lg border border-yellow-300 space-y-3">
                    <h4 className="font-semibold text-yellow-800">Date d'effet de la cession (clé fiscale & sociale)</h4>
                    
                    <div className="space-y-2">
                      <Label>Date d'effet <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.objetCession.dateEffetCession}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, dateEffetCession: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="date_signature">À la date de signature</SelectItem>
                          <SelectItem value="date_differee">À une date différée</SelectItem>
                        </SelectContent>
                      </Select>
                      <p className="text-xs text-yellow-700">
                        ➡️ Impact : droits de vote, dividendes, plus-value, responsabilité
                      </p>
                    </div>

                    {cessionPartsData.objetCession.dateEffetCession === "date_differee" && (
                      <div className="space-y-2">
                        <Label>Date différée précise <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={cessionPartsData.objetCession.dateEffetDifferee}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            objetCession: {...cessionPartsData.objetCession, dateEffetDifferee: e.target.value}
                          })}
                        />
                      </div>
                    )}
                  </div>

                  {/* Clause de non-garantie de passif */}
                  <div className="bg-white p-4 rounded-lg border border-yellow-300 space-y-3">
                    <h4 className="font-semibold text-yellow-800">Garantie de passif</h4>
                    
                    <div className="space-y-2">
                      <Label>La cession est-elle consentie sans garantie de passif ?</Label>
                      <Select
                        value={cessionPartsData.objetCession.sansGarantiePassif ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          objetCession: {...cessionPartsData.objetCession, sansGarantiePassif: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non (avec garantie de passif)</SelectItem>
                          <SelectItem value="oui">Oui (sans garantie de passif)</SelectItem>
                        </SelectContent>
                      </Select>
                      <p className="text-xs text-yellow-700">
                        ⚠️ Sans cette précision → zone grise interprétative
                      </p>
                    </div>
                  </div>

                  {/* Conditions suspensives */}
                  <div className="bg-white p-4 rounded-lg border border-yellow-300 space-y-3">
                    <h4 className="font-semibold text-yellow-800">Conditions suspensives</h4>
                    
                    <div className="space-y-2">
                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.objetCession.agrement}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            objetCession: {...cessionPartsData.objetCession, agrement: e.target.checked}
                          })}
                        />
                        <span>Agrément par les associés</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.objetCession.approbationConjoint}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            objetCession: {...cessionPartsData.objetCession, approbationConjoint: e.target.checked}
                          })}
                        />
                        <span>Approbation du conjoint (si bien commun)</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.objetCession.financementBancaire}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            objetCession: {...cessionPartsData.objetCession, financementBancaire: e.target.checked}
                          })}
                        />
                        <span>Financement bancaire</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.objetCession.leveeNantissement}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            objetCession: {...cessionPartsData.objetCession, leveeNantissement: e.target.checked}
                          })}
                        />
                        <span>Levée d'un nantissement sur parts</span>
                      </label>
                    </div>
                  </div>
                </div>

                {/* Section 6 : Agrément (SARL & SCI) */}
                {(cessionPartsData.typeSociete === "sarl" || cessionPartsData.typeSociete === "sci") && (
                  <div>
                    <h3 className="font-semibold text-lg border-b pb-2 mb-4">Agrément (obligatoire pour SARL & SCI)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Organe compétent pour l'agrément <span className="text-red-500">*</span></Label>
                        <Select
                          value={cessionPartsData.agrement.organeCompetent}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, organeCompetent: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="assemblee_generale">Assemblée générale</SelectItem>
                            <SelectItem value="gerant_president">Gérant / Président</SelectItem>
                            <SelectItem value="autre">Autre (selon statuts)</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-red-700">⚠️ Le greffe peut refuser l'acte sans cette précision</p>
                      </div>

                      <div className="space-y-2">
                        <Label>Date de la décision d'agrément</Label>
                        <Input
                          type="date"
                          value={cessionPartsData.agrement.dateDecisionAgrement}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, dateDecisionAgrement: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Mode de vote et majorité</Label>
                        <Input
                          value={cessionPartsData.agrement.modeVoteMajorite}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, modeVoteMajorite: e.target.value}
                          })}
                          placeholder="Ex: 2/3 des voix présentes"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Procédure d'agrément</Label>
                        <Textarea
                          value={cessionPartsData.agrement.procedureAgrement}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, procedureAgrement: e.target.value}
                          })}
                          placeholder="Décrire la procédure suivie"
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Convocation des associés</Label>
                        <Select
                          value={cessionPartsData.agrement.convocationAssocies ? "oui" : "non"}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, convocationAssocies: value === "oui"}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Vote effectué</Label>
                        <Select
                          value={cessionPartsData.agrement.voteEffectue ? "oui" : "non"}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, voteEffectue: value === "oui"}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Majorité requise</Label>
                        <Input
                          value={cessionPartsData.agrement.majoriteRequise}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, majoriteRequise: e.target.value}
                          })}
                          placeholder="Ex: 2/3, majorité simple..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Statut de la notification</Label>
                        <Select
                          value={cessionPartsData.agrement.notificationStatut}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, notificationStatut: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="acceptation">Acceptation</SelectItem>
                            <SelectItem value="refus">Refus</SelectItem>
                            <SelectItem value="en_attente">En attente</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Délai légal respecté</Label>
                        <Select
                          value={cessionPartsData.agrement.delaiLegalRespecte ? "oui" : "non"}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            agrement: {...cessionPartsData.agrement, delaiLegalRespecte: value === "oui"}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label className="text-red-600 font-semibold">📄 Procès-verbal d'assemblée générale</Label>
                        <MultiFileUpload
                          files={cessionPVAgrementFiles}
                          onFilesChange={setCessionPVAgrementFiles}
                          accept=".pdf,.doc,.docx"
                          label="Joindre le PV d'agrément"
                        />
                      </div>
                    </div>
                  </div>
                )}

                {/* Section 7 : Compte courant d'associé */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Compte courant d'associé / Dettes liées</h3>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-3 md:col-span-2">
                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.compteCourant.cessionCCA}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            compteCourant: {...cessionPartsData.compteCourant, cessionCCA: e.target.checked}
                          })}
                        />
                        <span>Cession du compte courant d'associé au cessionnaire</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.compteCourant.maintienCCA}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            compteCourant: {...cessionPartsData.compteCourant, maintienCCA: e.target.checked}
                          })}
                        />
                        <span>Maintien du compte courant au cédant</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.compteCourant.remboursementImmediat}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            compteCourant: {...cessionPartsData.compteCourant, remboursementImmediat: e.target.checked}
                          })}
                        />
                        <span>Remboursement immédiat du compte courant</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.compteCourant.remboursementEchelonne}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            compteCourant: {...cessionPartsData.compteCourant, remboursementEchelonne: e.target.checked}
                          })}
                        />
                        <span>Remboursement échelonné</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.compteCourant.compensationPrix}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            compteCourant: {...cessionPartsData.compteCourant, compensationPrix: e.target.checked}
                          })}
                        />
                        <span>Compensation entre prix de cession et dette CCA</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.compteCourant.garantieSolde}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            compteCourant: {...cessionPartsData.compteCourant, garantieSolde: e.target.checked}
                          })}
                        />
                        <span>Garantie du solde du compte courant</span>
                      </label>
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Montant exact du solde CCA</Label>
                      <Input
                        value={cessionPartsData.compteCourant.montantSoldeCCA}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          compteCourant: {...cessionPartsData.compteCourant, montantSoldeCCA: e.target.value}
                        })}
                        placeholder="Montant en €"
                      />
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label className="font-semibold">📄 Preuves comptables (justificatif CCA)</Label>
                      <MultiFileUpload
                        files={cessionCCAFiles}
                        onFilesChange={setCessionCCAFiles}
                        accept=".pdf,.xlsx,.xls"
                        label="Joindre les justificatifs du compte courant"
                      />
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Dette envers un tiers ?</Label>
                      <Select
                        value={cessionPartsData.compteCourant.detteVersTiers ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          compteCourant: {...cessionPartsData.compteCourant, detteVersTiers: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {cessionPartsData.compteCourant.detteVersTiers && (
                      <>
                        <div className="space-y-2">
                          <Label>Nature de la dette</Label>
                          <Input
                            value={cessionPartsData.compteCourant.natureDetteTiers}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              compteCourant: {...cessionPartsData.compteCourant, natureDetteTiers: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Montant de la dette</Label>
                          <Input
                            value={cessionPartsData.compteCourant.montantDetteTiers}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              compteCourant: {...cessionPartsData.compteCourant, montantDetteTiers: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Créancier</Label>
                          <Input
                            value={cessionPartsData.compteCourant.creancierTiers}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              compteCourant: {...cessionPartsData.compteCourant, creancierTiers: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Acceptation par le créancier</Label>
                          <Select
                            value={cessionPartsData.compteCourant.acceptationCreancier ? "oui" : "non"}
                            onValueChange={(value) => setCessionPartsData({
                              ...cessionPartsData,
                              compteCourant: {...cessionPartsData.compteCourant, acceptationCreancier: value === "oui"}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="non">Non</SelectItem>
                              <SelectItem value="oui">Oui</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </>
                    )}
                  </div>
                </div>

                {/* Section 8 : Garanties données par le cédant */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Garanties données par le cédant</h3>

                  <div className="space-y-4">
                    <div className="bg-white p-4 rounded-lg border border-pink-300 space-y-3">
                      <h4 className="font-semibold text-pink-800">Garanties classiques</h4>
                      
                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.garanties.garantieEviction}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            garanties: {...cessionPartsData.garanties, garantieEviction: e.target.checked}
                          })}
                        />
                        <span>Garantie d'éviction</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.garanties.garantiePropriete}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            garanties: {...cessionPartsData.garanties, garantiePropriete: e.target.checked}
                          })}
                        />
                        <span>Garantie de propriété des parts</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.garanties.garantieActifNet}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            garanties: {...cessionPartsData.garanties, garantieActifNet: e.target.checked}
                          })}
                        />
                        <span>Garantie d'actif net</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.garanties.absenceNantissement}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            garanties: {...cessionPartsData.garanties, absenceNantissement: e.target.checked}
                          })}
                        />
                        <span>Absence de nantissement des parts</span>
                      </label>

                      <label className="flex items-center gap-2">
                        <input
                          type="checkbox"
                          checked={cessionPartsData.garanties.absenceLitiges}
                          onChange={(e) => setCessionPartsData({
                            ...cessionPartsData,
                            garanties: {...cessionPartsData.garanties, absenceLitiges: e.target.checked}
                          })}
                        />
                        <span>Absence de litiges en cours</span>
                      </label>

                      <div className="space-y-2">
                        <Label>Garantie de passif</Label>
                        <Select
                          value={cessionPartsData.garanties.garantiePassif}
                          onValueChange={(value) => setCessionPartsData({
                            ...cessionPartsData,
                            garanties: {...cessionPartsData.garanties, garantiePassif: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="aucune">Aucune</SelectItem>
                            <SelectItem value="limitee">Limitée</SelectItem>
                            <SelectItem value="generale">Générale</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    <div className="bg-white p-4 rounded-lg border border-pink-300 space-y-4">
                      <h4 className="font-semibold text-pink-800">Garanties renforcées (optionnelles)</h4>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Plafond de garantie</Label>
                          <Input
                            value={cessionPartsData.garanties.plafondGarantie}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              garanties: {...cessionPartsData.garanties, plafondGarantie: e.target.value}
                            })}
                            placeholder="Montant maximum"
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Durée de garantie</Label>
                          <Input
                            value={cessionPartsData.garanties.dureeGarantie}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              garanties: {...cessionPartsData.garanties, dureeGarantie: e.target.value}
                            })}
                            placeholder="Ex: 2 ans, 5 ans..."
                          />
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>Exclusions</Label>
                          <Textarea
                            value={cessionPartsData.garanties.exclusions}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              garanties: {...cessionPartsData.garanties, exclusions: e.target.value}
                            })}
                            placeholder="Éléments exclus de la garantie"
                            rows={2}
                          />
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>Procédure de mise en jeu de la garantie</Label>
                          <Textarea
                            value={cessionPartsData.garanties.procedureMiseEnJeu}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              garanties: {...cessionPartsData.garanties, procedureMiseEnJeu: e.target.value}
                            })}
                            placeholder="Décrire la procédure"
                            rows={2}
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Section 9 : Droit du conjoint */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Droit du conjoint (si régime matrimonial = communauté)</h3>

                  <div className="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <p className="text-sm font-semibold text-amber-900">
                      ⚠️ Obligatoire si les parts sont des biens communs. Sinon l'acte est NUL.
                    </p>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label>Identité du conjoint</Label>
                      <Input
                        value={cessionPartsData.conjoint.identiteConjoint}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          conjoint: {...cessionPartsData.conjoint, identiteConjoint: e.target.value}
                        })}
                        placeholder="Nom et prénom du conjoint"
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Acceptation de la cession</Label>
                      <Select
                        value={cessionPartsData.conjoint.acceptationCession ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          conjoint: {...cessionPartsData.conjoint, acceptationCession: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Renonciation à la cession</Label>
                      <Select
                        value={cessionPartsData.conjoint.renonciationCession ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          conjoint: {...cessionPartsData.conjoint, renonciationCession: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Signature obligatoire du conjoint</Label>
                      <Select
                        value={cessionPartsData.conjoint.signatureObligatoire ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          conjoint: {...cessionPartsData.conjoint, signatureObligatoire: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui (requis)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Régime matrimonial précisé</Label>
                      <Input
                        value={cessionPartsData.conjoint.regimeMatrimonialPrecise}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          conjoint: {...cessionPartsData.conjoint, regimeMatrimonialPrecise: e.target.value}
                        })}
                        placeholder="Communauté, séparation..."
                      />
                    </div>
                  </div>
                </div>

                {/* Section 10 : Droits d'enregistrement */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Droits d'enregistrement (fiscal - obligatoire)</h3>

                  <div className="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <p className="text-sm font-semibold text-amber-900">
                      ⚠️ Indispensable pour la validité fiscale
                    </p>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Taux applicable <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.droitsEnregistrement.tauxApplicable}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          droitsEnregistrement: {...cessionPartsData.droitsEnregistrement, tauxApplicable: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="3_pourcent">3 % après abattement (parts sociales)</SelectItem>
                          <SelectItem value="0_1_pourcent">0,1 % (actions)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Charge des droits <span className="text-red-500">*</span></Label>
                      <Select
                        value={cessionPartsData.droitsEnregistrement.chargeDroits}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          droitsEnregistrement: {...cessionPartsData.droitsEnregistrement, chargeDroits: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="cessionnaire">Cessionnaire (acheteur)</SelectItem>
                          <SelectItem value="cedant">Cédant (vendeur)</SelectItem>
                          <SelectItem value="autre">Autre (moitié-moitié ou convention)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Section 11 : Clause de non-concurrence */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Clause de non-concurrence</h3>

                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label>Clause de non-concurrence</Label>
                      <Select
                        value={cessionPartsData.nonConcurrence.clauseNonConcurrence ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          nonConcurrence: {...cessionPartsData.nonConcurrence, clauseNonConcurrence: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                      <p className="text-xs text-violet-700">
                        Pas obligatoire légalement, mais attendue en pratique
                      </p>
                    </div>

                    {cessionPartsData.nonConcurrence.clauseNonConcurrence && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-white border border-violet-300 rounded-lg">
                        <div className="space-y-2">
                          <Label>Durée</Label>
                          <Input
                            value={cessionPartsData.nonConcurrence.dureeNonConcurrence}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              nonConcurrence: {...cessionPartsData.nonConcurrence, dureeNonConcurrence: e.target.value}
                            })}
                            placeholder="Ex: 2 ans, 5 ans..."
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Zone géographique</Label>
                          <Input
                            value={cessionPartsData.nonConcurrence.zoneGeographique}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              nonConcurrence: {...cessionPartsData.nonConcurrence, zoneGeographique: e.target.value}
                            })}
                            placeholder="Ex: France, Île-de-France..."
                          />
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>Activité interdite</Label>
                          <Textarea
                            value={cessionPartsData.nonConcurrence.activiteInterdite}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              nonConcurrence: {...cessionPartsData.nonConcurrence, activiteInterdite: e.target.value}
                            })}
                            placeholder="Décrire l'activité interdite"
                            rows={2}
                          />
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* Section 12 : Notification à la société */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Information de la société (formalisme interne)</h3>

                  <div className="bg-amber-100 border border-amber-300 p-4 rounded-lg">
                    <p className="text-sm font-semibold text-amber-900">
                      ⚠️ Article 1690 du Code civil / pratique sociétaire
                    </p>
                  </div>

                  <div className="space-y-2">
                    <Label>Notification de la cession à la société <span className="text-red-500">*</span></Label>
                    <Select
                      value={cessionPartsData.notificationSociete.modeNotification}
                      onValueChange={(value) => setCessionPartsData({
                        ...cessionPartsData,
                        notificationSociete: {...cessionPartsData.notificationSociete, modeNotification: value}
                      })}
                    >
                      <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="signification_huissier">Signification par huissier</SelectItem>
                        <SelectItem value="acceptation_acte">Acceptation dans l'acte</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* Section 13 : Déclarations légales obligatoires */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Déclarations légales obligatoires</h3>

                  <div className="space-y-3">
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.consentementLibre}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, consentementLibre: e.target.checked}
                        })}
                      />
                      <span>Consentement libre et éclairé</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.origineLiciteFonds}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, origineLiciteFonds: e.target.checked}
                        })}
                      />
                      <span>Origine licite des fonds</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.absenceFraude}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, absenceFraude: e.target.checked}
                        })}
                      />
                      <span>Absence de fraude ou simulation</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.acceptationPrix}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, acceptationPrix: e.target.checked}
                        })}
                      />
                      <span>Acceptation du prix</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.transfertProprieteDateSignature}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, transfertProprieteDateSignature: e.target.checked}
                        })}
                      />
                      <span>Transfert de propriété à la date de signature</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.mentionStatutsMisAJour}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, mentionStatutsMisAJour: e.target.checked}
                        })}
                      />
                      <span>Mention des statuts mis à jour</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.mentionImpositionFiscale}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, mentionImpositionFiscale: e.target.checked}
                        })}
                      />
                      <span>Mention d'imposition fiscale potentielle (plus-value)</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.declarationsLegales.renonciationDroitPreemption}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          declarationsLegales: {...cessionPartsData.declarationsLegales, renonciationDroitPreemption: e.target.checked}
                        })}
                      />
                      <span>Renonciation éventuelle au droit de préemption d'autres associés</span>
                    </label>
                  </div>
                </div>

                {/* Section 14 : Mise à jour statuts et formalités */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Mise à jour des statuts et formalités</h3>
                  <div className="space-y-3">
                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.formalites.modificationCapital}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          formalites: {...cessionPartsData.formalites, modificationCapital: e.target.checked}
                        })}
                      />
                      <span>Modification de la répartition du capital</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.formalites.miseAJourRegistreMouvements}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          formalites: {...cessionPartsData.formalites, miseAJourRegistreMouvements: e.target.checked}
                        })}
                      />
                      <span>Mise à jour du registre des mouvements de titres</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.formalites.miseAJourRegistreAssocies}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          formalites: {...cessionPartsData.formalites, miseAJourRegistreAssocies: e.target.checked}
                        })}
                      />
                      <span>Mise à jour du registre des associés</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.formalites.depotGreffe}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          formalites: {...cessionPartsData.formalites, depotGreffe: e.target.checked}
                        })}
                      />
                      <span>Dépôt au greffe (si applicable)</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.formalites.publicationLegale}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          formalites: {...cessionPartsData.formalites, publicationLegale: e.target.checked}
                        })}
                      />
                      <span>Publication légale (si obligation)</span>
                    </label>

                    <label className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        checked={cessionPartsData.formalites.informationBanques}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          formalites: {...cessionPartsData.formalites, informationBanques: e.target.checked}
                        })}
                      />
                      <span>Information des banques / partenaires</span>
                    </label>
                  </div>
                </div>

                {/* Section 15 : Signatures */}
                <div>
                  <h3 className="font-semibold text-lg border-b pb-2 mb-4">Signatures et formalités finales</h3>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Date de signature <span className="text-red-500">*</span></Label>
                      <Input
                        type="date"
                        value={cessionPartsData.signatures.dateSignature}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          signatures: {...cessionPartsData.signatures, dateSignature: e.target.value}
                        })}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Lieu de signature <span className="text-red-500">*</span></Label>
                      <Input
                        value={cessionPartsData.signatures.lieuSignature}
                        onChange={(e) => setCessionPartsData({
                          ...cessionPartsData,
                          signatures: {...cessionPartsData.signatures, lieuSignature: e.target.value}
                        })}
                        placeholder="Ville de signature"
                      />
                    </div>

                    <div className="space-y-2 md:col-span-2">
                      <Label>Signature du notaire</Label>
                      <Select
                        value={cessionPartsData.signatures.signatureNotaire ? "oui" : "non"}
                        onValueChange={(value) => setCessionPartsData({
                          ...cessionPartsData,
                          signatures: {...cessionPartsData.signatures, signatureNotaire: value === "oui"}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non (acte sous seing privé)</SelectItem>
                          <SelectItem value="oui">Oui (acte authentique)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {cessionPartsData.signatures.signatureNotaire && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                        <div className="space-y-2">
                          <Label>Nom du notaire <span className="text-red-600">*</span></Label>
                          <Input
                            value={cessionPartsData.signatures.nomNotaire}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              signatures: {...cessionPartsData.signatures, nomNotaire: e.target.value}
                            })}
                            placeholder="Nom complet"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Ville du notaire <span className="text-red-600">*</span></Label>
                          <Input
                            value={cessionPartsData.signatures.villeNotaire}
                            onChange={(e) => setCessionPartsData({
                              ...cessionPartsData,
                              signatures: {...cessionPartsData.signatures, villeNotaire: e.target.value}
                            })}
                            placeholder="Ville de l'étude"
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Pièces justificatives (tous les uploads) */}
                  <div className="space-y-4 mt-6">
                    <h4 className="font-semibold text-lime-800 text-base border-b pb-2">
                      📎 Pièces justificatives à fournir
                    </h4>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Kbis de la société</Label>
                        <MultiFileUpload
                          files={cessionKbisFiles}
                          onFilesChange={setCessionKbisFiles}
                          accept=".pdf"
                          label="Joindre Kbis"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Comptes annuels</Label>
                        <MultiFileUpload
                          files={cessionComptesFiles}
                          onFilesChange={setCessionComptesFiles}
                          accept=".pdf,.xlsx,.xls"
                          label="Joindre comptes"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Registre des associés</Label>
                        <MultiFileUpload
                          files={cessionRegistreFiles}
                          onFilesChange={setCessionRegistreFiles}
                          accept=".pdf"
                          label="Joindre registre"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Pacte d'associés (si existant)</Label>
                        <MultiFileUpload
                          files={cessionPacteFiles}
                          onFilesChange={setCessionPacteFiles}
                          accept=".pdf"
                          label="Joindre pacte"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Pièce d'identité cédant</Label>
                        <MultiFileUpload
                          files={cessionCedantIdFiles}
                          onFilesChange={setCessionCedantIdFiles}
                          accept=".pdf,.jpg,.jpeg,.png"
                          label="Joindre ID cédant"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Contrat de mariage (si applicable)</Label>
                        <MultiFileUpload
                          files={cessionCedantMariageFiles}
                          onFilesChange={setCessionCedantMariageFiles}
                          accept=".pdf"
                          label="Joindre contrat mariage"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Expertise des parts (si existante)</Label>
                        <MultiFileUpload
                          files={cessionExpertiseFiles}
                          onFilesChange={setCessionExpertiseFiles}
                          accept=".pdf"
                          label="Joindre expertise"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Pièce d'identité cessionnaire</Label>
                        <MultiFileUpload
                          files={cessionCessionnaireIdFiles}
                          onFilesChange={setCessionCessionnaireIdFiles}
                          accept=".pdf,.jpg,.jpeg,.png"
                          label="Joindre ID cessionnaire"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Justificatif de domicile cessionnaire</Label>
                        <MultiFileUpload
                          files={cessionCessionnaireDomicileFiles}
                          onFilesChange={setCessionCessionnaireDomicileFiles}
                          accept=".pdf,.jpg,.jpeg,.png"
                          label="Joindre justif domicile"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Justificatif origine des fonds (anti-blanchiment)</Label>
                        <MultiFileUpload
                          files={cessionOrigineFondsFiles}
                          onFilesChange={setCessionOrigineFondsFiles}
                          accept=".pdf"
                          label="Joindre justificatifs"
                        />
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            )}

            {/* Formulaire complet pour Contrat de prestation de services */}
            {pendingContractType === "Contrat de prestation de services" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">📝 Contrat de prestation de services</h3>
                
                {/* 1. IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification des parties</h4>
                  
                  {/* PRESTATAIRE */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">👤 Prestataire (fournis le service)</h5>
                    <ClientSelector clients={clients} selectedClientId={prestationPrestataireClientId} onClientChange={(id) => {
                      setPrestationPrestataireClientId(id);
                      const client = clients.find(c => c.id === id);
                      if (client) {
                        setPrestationData(prev => ({
                          ...prev,
                          prestataireDenomination: `${client.prenom} ${client.nom}`,
                          prestataireEmail: client.email || "",
                          prestataireTelephone: client.telephone || "",
                        }));
                      } else {
                        setPrestationData(prev => ({
                          ...prev,
                          prestataireDenomination: "",
                          prestataireEmail: "",
                          prestataireTelephone: "",
                        }));
                      }
                    }} label="Sélectionner le prestataire depuis vos clients" />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                      <div><Label>Dénomination / Nom *</Label><Input value={prestationData.prestataireDenomination} onChange={(e) => setPrestationData({...prestationData, prestataireDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Select value={prestationData.prestataireFormeJuridique} onValueChange={(v) => setPrestationData({...prestationData, prestataireFormeJuridique: v})}><SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger><SelectContent><SelectItem value="SARL">SARL</SelectItem><SelectItem value="SAS">SAS</SelectItem><SelectItem value="SASU">SASU</SelectItem><SelectItem value="EURL">EURL</SelectItem><SelectItem value="auto-entrepreneur">Auto-entrepreneur</SelectItem><SelectItem value="EI">Entreprise Individuelle</SelectItem><SelectItem value="association">Association</SelectItem><SelectItem value="particulier">Particulier</SelectItem></SelectContent></Select></div>
                      <div><Label>RCS / SIREN</Label><Input value={prestationData.prestataireRCS} onChange={(e) => setPrestationData({...prestationData, prestataireRCS: e.target.value})} placeholder="123 456 789" /></div>
                      <div><Label>Siège social</Label><Input value={prestationData.prestataireSiegeSocial} onChange={(e) => setPrestationData({...prestationData, prestataireSiegeSocial: e.target.value})} /></div>
                      <div><Label>Représentant légal</Label><Input value={prestationData.prestataireRepresentant} onChange={(e) => setPrestationData({...prestationData, prestataireRepresentant: e.target.value})} /></div>
                      <div><Label>Fonction du signataire</Label><Input value={prestationData.prestataireFonctionSignataire} onChange={(e) => setPrestationData({...prestationData, prestataireFonctionSignataire: e.target.value})} placeholder="Gérant, Président..." /></div>
                      <div><Label>Email *</Label><Input type="email" value={prestationData.prestataireEmail} onChange={(e) => setPrestationData({...prestationData, prestataireEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={prestationData.prestataireTelephone} onChange={(e) => setPrestationData({...prestationData, prestataireTelephone: e.target.value})} /></div>
                    </div>
                    
                    <div className="space-y-2">
                      <Label>Assurance RC Professionnelle *</Label>
                      <RadioGroup value={prestationData.prestataireAssuranceRC} onValueChange={(v) => setPrestationData({...prestationData, prestataireAssuranceRC: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="assur-oui" /><Label htmlFor="assur-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="assur-non" /><Label htmlFor="assur-non">Non</Label></div>
                      </RadioGroup>
                      {prestationData.prestataireAssuranceRC === "oui" && (
                        <Input value={prestationData.prestataireNumeroAssurance} onChange={(e) => setPrestationData({...prestationData, prestataireNumeroAssurance: e.target.value})} placeholder="Numéro de police d'assurance" className="mt-2" />
                      )}
                    </div>
                    
                    <div className="space-y-3">
                      <h6 className="text-sm font-semibold text-gray-700">Pièces justificatives prestataire</h6>
                      <SingleFileUpload
                        label="Extrait Kbis / Immatriculation"
                        files={prestationPrestataireKbisFiles}
                        onFilesChange={setPrestationPrestataireKbisFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Attestation RC Professionnelle"
                        files={prestationPrestataireAssuranceFiles}
                        onFilesChange={setPrestationPrestataireAssuranceFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Autres documents prestataire"
                        files={prestationPrestataireAutresFiles}
                        onFilesChange={setPrestationPrestataireAutresFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                    </div>
                  </div>
                  
                  {/* CLIENT */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">🏢 Client (bénéficiaire du service)</h5>
                    <ClientSelector clients={clients} selectedClientId={prestationClientClientId} onClientChange={(id) => {
                      setPrestationClientClientId(id);
                      const client = clients.find(c => c.id === id);
                      if (client) {
                        setPrestationData(prev => ({
                          ...prev,
                          clientDenomination: `${client.prenom} ${client.nom}`,
                          clientEmail: client.email || "",
                          clientTelephone: client.telephone || "",
                        }));
                      } else {
                        setPrestationData(prev => ({
                          ...prev,
                          clientDenomination: "",
                          clientEmail: "",
                          clientTelephone: "",
                        }));
                      }
                    }} label="Sélectionner le client depuis vos clients" />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                      <div><Label>Dénomination / Nom *</Label><Input value={prestationData.clientDenomination} onChange={(e) => setPrestationData({...prestationData, clientDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={prestationData.clientFormeJuridique} onChange={(e) => setPrestationData({...prestationData, clientFormeJuridique: e.target.value})} placeholder="SARL, SAS, Particulier..." /></div>
                      <div className="md:col-span-2"><Label>Adresse complète *</Label><Input value={prestationData.clientAdresse} onChange={(e) => setPrestationData({...prestationData, clientAdresse: e.target.value})} /></div>
                      <div><Label>RCS / SIREN</Label><Input value={prestationData.clientRCS} onChange={(e) => setPrestationData({...prestationData, clientRCS: e.target.value})} /></div>
                      <div><Label>Représentant légal</Label><Input value={prestationData.clientRepresentant} onChange={(e) => setPrestationData({...prestationData, clientRepresentant: e.target.value})} /></div>
                      <div><Label>Fonction</Label><Input value={prestationData.clientFonction} onChange={(e) => setPrestationData({...prestationData, clientFonction: e.target.value})} /></div>
                      <div><Label>Contact opérationnel</Label><Input value={prestationData.clientContactOperationnel} onChange={(e) => setPrestationData({...prestationData, clientContactOperationnel: e.target.value})} /></div>
                      <div><Label>Email *</Label><Input type="email" value={prestationData.clientEmail} onChange={(e) => setPrestationData({...prestationData, clientEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={prestationData.clientTelephone} onChange={(e) => setPrestationData({...prestationData, clientTelephone: e.target.value})} /></div>
                    </div>
                    
                    <div className="space-y-3">
                      <h6 className="text-sm font-semibold text-gray-700">Pièces justificatives client</h6>
                      <SingleFileUpload
                        label="Extrait Kbis / Immatriculation client"
                        files={prestationClientKbisFiles}
                        onFilesChange={setPrestationClientKbisFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Autres documents client"
                        files={prestationClientAutresFiles}
                        onFilesChange={setPrestationClientAutresFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                    </div>
                  </div>
                </div>
                
                {/* 2. OBJET DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du contrat — Définition du service</h4>
                  <div className="space-y-3">
                    <div><Label>Nature exacte de la prestation *</Label><Input value={prestationData.naturePrestation} onChange={(e) => setPrestationData({...prestationData, naturePrestation: e.target.value})} placeholder="Ex: Développement web, Conseil juridique, Formation..." /></div>
                    <div><Label>Description détaillée du service *</Label><Textarea value={prestationData.descriptionDetaillee} onChange={(e) => setPrestationData({...prestationData, descriptionDetaillee: e.target.value})} className="min-h-[100px]" placeholder="Décrivez précisément le service fourni..." /></div>
                    <div><Label>Périmètre d'intervention</Label><Textarea value={prestationData.perimetreIntervention} onChange={(e) => setPrestationData({...prestationData, perimetreIntervention: e.target.value})} placeholder="Zone géographique, domaine d'activité..." /></div>
                    <div><Label>Ce qui est inclus dans la prestation</Label><Textarea value={prestationData.inclusionsPrestations} onChange={(e) => setPrestationData({...prestationData, inclusionsPrestations: e.target.value})} placeholder="Liste des éléments inclus..." /></div>
                    <div><Label>Ce qui est exclu de la prestation</Label><Textarea value={prestationData.exclusionsPrestations} onChange={(e) => setPrestationData({...prestationData, exclusionsPrestations: e.target.value})} placeholder="Liste des éléments exclus..." /></div>
                    <div><Label>Résultats attendus / Livrables</Label><Textarea value={prestationData.resultatsAttendus} onChange={(e) => setPrestationData({...prestationData, resultatsAttendus: e.target.value})} placeholder="Quels sont les livrables concrets ?" /></div>
                    <div>
                      <Label>Type d'obligation *</Label>
                      <RadioGroup value={prestationData.typeObligation} onValueChange={(v) => setPrestationData({...prestationData, typeObligation: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="moyens" id="obl-moyens" /><Label htmlFor="obl-moyens">Obligation de moyens</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="resultat" id="obl-resultat" /><Label htmlFor="obl-resultat">Obligation de résultat</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Compétences techniques requises</Label><Input value={prestationData.competencesTechniques} onChange={(e) => setPrestationData({...prestationData, competencesTechniques: e.target.value})} /></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Référent technique prestataire</Label><Input value={prestationData.referentTechniquePrestataire} onChange={(e) => setPrestationData({...prestationData, referentTechniquePrestataire: e.target.value})} /></div>
                      <div><Label>Référent technique client</Label><Input value={prestationData.referentTechniqueClient} onChange={(e) => setPrestationData({...prestationData, referentTechniqueClient: e.target.value})} /></div>
                    </div>
                  </div>
                </div>

                {/* 3. DURÉE DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Durée du contrat</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Type de durée *</Label>
                      <RadioGroup value={prestationData.typeDuree} onValueChange={(v) => setPrestationData({...prestationData, typeDuree: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="determinee" id="dur-det" /><Label htmlFor="dur-det">Durée déterminée</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="ponctuelle" id="dur-ponc" /><Label htmlFor="dur-ponc">Exécution ponctuelle</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="indeterminee" id="dur-ind" /><Label htmlFor="dur-ind">Durée indéterminée</Label></div>
                      </RadioGroup>
                    </div>
                    {(prestationData.typeDuree === "determinee" || prestationData.typeDuree === "ponctuelle") && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div><Label>Date de début</Label><Input type="date" value={prestationData.dateDebut} onChange={(e) => setPrestationData({...prestationData, dateDebut: e.target.value})} /></div>
                        <div><Label>Date de fin</Label><Input type="date" value={prestationData.dateFin} onChange={(e) => setPrestationData({...prestationData, dateFin: e.target.value})} /></div>
                      </div>
                    )}
                    <div>
                      <Label>Reconduction tacite ?</Label>
                      <RadioGroup value={prestationData.reconductionTacite} onValueChange={(v) => setPrestationData({...prestationData, reconductionTacite: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="recon-oui" /><Label htmlFor="recon-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="recon-non" /><Label htmlFor="recon-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Durée minimale d'engagement</Label><Input value={prestationData.dureeMinimale} onChange={(e) => setPrestationData({...prestationData, dureeMinimale: e.target.value})} placeholder="Ex: 6 mois, 1 an..." /></div>
                  </div>
                </div>

                {/* 4. MODALITÉS DE RÉALISATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Modalités de réalisation</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Lieu d'exécution *</Label>
                      <Select value={prestationData.lieuExecution} onValueChange={(v) => setPrestationData({...prestationData, lieuExecution: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="teletravail">Télétravail</SelectItem>
                          <SelectItem value="locaux_client">Locaux du client</SelectItem>
                          <SelectItem value="locaux_prestataire">Locaux du prestataire</SelectItem>
                          <SelectItem value="mixte">Mixte</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Conditions d'intervention</Label><Textarea value={prestationData.conditionsIntervention} onChange={(e) => setPrestationData({...prestationData, conditionsIntervention: e.target.value})} placeholder="Accès, badges, autorisations..." /></div>
                    <div>
                      <Label>Horaires imposés ?</Label>
                      <RadioGroup value={prestationData.horairesImpose} onValueChange={(v) => setPrestationData({...prestationData, horairesImpose: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="hor-oui" /><Label htmlFor="hor-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="hor-non" /><Label htmlFor="hor-non">Non</Label></div>
                      </RadioGroup>
                      {prestationData.horairesImpose === "oui" && (
                        <Input value={prestationData.detailsHoraires} onChange={(e) => setPrestationData({...prestationData, detailsHoraires: e.target.value})} placeholder="Préciser les horaires" className="mt-2" />
                      )}
                    </div>
                    <div><Label>Matériel mis à disposition</Label><Textarea value={prestationData.materielMisADisposition} onChange={(e) => setPrestationData({...prestationData, materielMisADisposition: e.target.value})} placeholder="Ordinateur, logiciels, outils..." /></div>
                    <div><Label>Obligations du client</Label><Textarea value={prestationData.obligationsClient} onChange={(e) => setPrestationData({...prestationData, obligationsClient: e.target.value})} placeholder="Fournir accès, données, outils..." /></div>
                    <div><Label>Délais de réalisation</Label><Input value={prestationData.delaisRealisation} onChange={(e) => setPrestationData({...prestationData, delaisRealisation: e.target.value})} placeholder="Ex: 3 mois, 15 jours..." /></div>
                    <div><Label>Planning / Jalons</Label><Textarea value={prestationData.planning} onChange={(e) => setPrestationData({...prestationData, planning: e.target.value})} placeholder="Étapes, dates clés..." /></div>
                    <div><Label>Critères d'acceptation des livrables</Label><Textarea value={prestationData.criteresAcceptation} onChange={(e) => setPrestationData({...prestationData, criteresAcceptation: e.target.value})} placeholder="Comment valide-t-on les livrables ?" /></div>
                  </div>
                </div>

                {/* 5. PRIX ET CONDITIONS FINANCIÈRES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Prix et conditions financières</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Mode de facturation *</Label>
                      <Select value={prestationData.modeFacturation} onValueChange={(v) => setPrestationData({...prestationData, modeFacturation: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="forfait">Forfait global</SelectItem>
                          <SelectItem value="horaire">Taux horaire</SelectItem>
                          <SelectItem value="journalier">Taux journalier (TJM)</SelectItem>
                          <SelectItem value="livrable">Facturation au livrable</SelectItem>
                          <SelectItem value="abonnement">Abonnement périodique</SelectItem>
                          <SelectItem value="performance">Paiement à la performance</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Montant HT *</Label><Input type="number" value={prestationData.montantHT} onChange={(e) => setPrestationData({...prestationData, montantHT: e.target.value})} placeholder="0.00" /></div>
                      <div><Label>TVA applicable (%)</Label><Input type="number" value={prestationData.tva} onChange={(e) => setPrestationData({...prestationData, tva: e.target.value})} placeholder="20" /></div>
                    </div>
                    <div><Label>Modalités de variation</Label><Input value={prestationData.modalitesVariation} onChange={(e) => setPrestationData({...prestationData, modalitesVariation: e.target.value})} placeholder="Révision annuelle, indexation..." /></div>
                    <div><Label>Frais annexes</Label><Textarea value={prestationData.fraisAnnexes} onChange={(e) => setPrestationData({...prestationData, fraisAnnexes: e.target.value})} placeholder="Déplacement, hébergement, matériel..." /></div>
                    <div>
                      <Label>Modalités de paiement *</Label>
                      <Select value={prestationData.modalitesPaiement} onValueChange={(v) => setPrestationData({...prestationData, modalitesPaiement: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="comptant">Comptant</SelectItem>
                          <SelectItem value="30j">30 jours</SelectItem>
                          <SelectItem value="45j">45 jours</SelectItem>
                          <SelectItem value="60j">60 jours</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Acompte initial</Label><Input value={prestationData.acompte} onChange={(e) => setPrestationData({...prestationData, acompte: e.target.value})} placeholder="Ex: 30%, 5000€..." /></div>
                    <div><Label>Échéancier</Label><Textarea value={prestationData.echeancier} onChange={(e) => setPrestationData({...prestationData, echeancier: e.target.value})} placeholder="Détail des paiements..." /></div>
                    <div>
                      <Label>Facturation électronique ?</Label>
                      <RadioGroup value={prestationData.facturationElectronique} onValueChange={(v) => setPrestationData({...prestationData, facturationElectronique: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="fact-oui" /><Label htmlFor="fact-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="fact-non" /><Label htmlFor="fact-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Pénalités de retard</Label><Input value={prestationData.penalitesRetard} onChange={(e) => setPrestationData({...prestationData, penalitesRetard: e.target.value})} placeholder="Ex: 3 fois le taux légal" /></div>
                    <div><Label>Indemnité légale de recouvrement</Label><Input value={prestationData.indemniteLegale} onChange={(e) => setPrestationData({...prestationData, indemniteLegale: e.target.value})} placeholder="40€" /></div>
                    <div>
                      <Label>Suspension en cas d'impayé ?</Label>
                      <RadioGroup value={prestationData.suspensionImpaye} onValueChange={(v) => setPrestationData({...prestationData, suspensionImpaye: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="susp-oui" /><Label htmlFor="susp-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="susp-non" /><Label htmlFor="susp-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>

                {/* 6. PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Droits sur les créations du prestataire *</Label>
                      <Select value={prestationData.droitsCreationsPrestataire} onValueChange={(v) => setPrestationData({...prestationData, droitsCreationsPrestataire: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="licence">Licence d'utilisation cédée au client</SelectItem>
                          <SelectItem value="cession">Cession totale des droits au client</SelectItem>
                          <SelectItem value="reserves">Droits réservés au prestataire</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Limitation des droits</Label><Input value={prestationData.limitationDroits} onChange={(e) => setPrestationData({...prestationData, limitationDroits: e.target.value})} placeholder="Dans le temps, l'espace..." /></div>
                    <div><Label>Droits sur les créations du client</Label><Textarea value={prestationData.droitsCreationsClient} onChange={(e) => setPrestationData({...prestationData, droitsCreationsClient: e.target.value})} placeholder="Utilisation autorisée ou interdite par le prestataire" /></div>
                    <div>
                      <Label>Propriétaire du code/designs/textes</Label>
                      <RadioGroup value={prestationData.proprietaireCode} onValueChange={(v) => setPrestationData({...prestationData, proprietaireCode: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="prestataire" id="prop-prest" /><Label htmlFor="prop-prest">Prestataire</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="client" id="prop-client" /><Label htmlFor="prop-client">Client</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Droits de reproduction</Label><Input value={prestationData.droitsReproduction} onChange={(e) => setPrestationData({...prestationData, droitsReproduction: e.target.value})} /></div>
                    <div><Label>Garanties contre la contrefaçon</Label><Textarea value={prestationData.garantiesContrefacon} onChange={(e) => setPrestationData({...prestationData, garantiesContrefacon: e.target.value})} placeholder="Engagement du prestataire..." /></div>
                  </div>
                </div>

                {/* 7. CONFIDENTIALITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Confidentialité</h4>
                  <div className="space-y-3">
                    <div><Label>Définition des informations confidentielles</Label><Textarea value={prestationData.definitionInfosConfidentielles} onChange={(e) => setPrestationData({...prestationData, definitionInfosConfidentielles: e.target.value})} placeholder="Toutes informations commerciales, techniques, financières..." /></div>
                    <div><Label>Durée de confidentialité (années)</Label><Input type="number" value={prestationData.dureeConfidentialite} onChange={(e) => setPrestationData({...prestationData, dureeConfidentialite: e.target.value})} placeholder="5" /></div>
                    <div><Label>Exceptions</Label><Textarea value={prestationData.exceptionsConfidentialite} onChange={(e) => setPrestationData({...prestationData, exceptionsConfidentialite: e.target.value})} placeholder="Ordre public, déjà publique..." /></div>
                    <div><Label>Sanctions en cas de violation</Label><Input value={prestationData.sanctionsViolation} onChange={(e) => setPrestationData({...prestationData, sanctionsViolation: e.target.value})} placeholder="Dommages et intérêts..." /></div>
                  </div>
                </div>

                {/* 8. DONNÉES PERSONNELLES / RGPD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Données personnelles / RGPD</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Le prestataire agit-il en tant que sous-traitant ?</Label>
                      <RadioGroup value={prestationData.prestataireSousTraitant} onValueChange={(v) => setPrestationData({...prestationData, prestataireSousTraitant: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="st-oui" /><Label htmlFor="st-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="st-non" /><Label htmlFor="st-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Le client agit-il en tant que responsable de traitement ?</Label>
                      <RadioGroup value={prestationData.clientResponsableTraitement} onValueChange={(v) => setPrestationData({...prestationData, clientResponsableTraitement: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="rt-oui" /><Label htmlFor="rt-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="rt-non" /><Label htmlFor="rt-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Nature des données traitées</Label><Textarea value={prestationData.natureDonnees} onChange={(e) => setPrestationData({...prestationData, natureDonnees: e.target.value})} placeholder="Données d'identification, coordonnées..." /></div>
                    <div><Label>Finalités du traitement</Label><Textarea value={prestationData.finalitesTraitement} onChange={(e) => setPrestationData({...prestationData, finalitesTraitement: e.target.value})} placeholder="Gestion des clients, facturation..." /></div>
                    <div><Label>Mesures de sécurité</Label><Textarea value={prestationData.mesuresSecurite} onChange={(e) => setPrestationData({...prestationData, mesuresSecurite: e.target.value})} placeholder="Chiffrement, accès restreints..." /></div>
                    <div><Label>Durée de conservation</Label><Input value={prestationData.dureeConservation} onChange={(e) => setPrestationData({...prestationData, dureeConservation: e.target.value})} placeholder="Ex: 3 ans" /></div>
                    <div><Label>Clause de violation de données (data breach)</Label><Input value={prestationData.clauseDataBreach} onChange={(e) => setPrestationData({...prestationData, clauseDataBreach: e.target.value})} placeholder="Notification sous 72h..." /></div>
                    <div>
                      <Label>DPA (Data Processing Agreement) requis ?</Label>
                      <RadioGroup value={prestationData.dpaRequis} onValueChange={(v) => setPrestationData({...prestationData, dpaRequis: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="dpa-oui" /><Label htmlFor="dpa-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="dpa-non" /><Label htmlFor="dpa-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>

                {/* 9. SOUS-TRAITANCE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Sous-traitance</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Sous-traitance autorisée ?</Label>
                      <Select value={prestationData.sousTraitanceAutorisee} onValueChange={(v) => setPrestationData({...prestationData, sousTraitanceAutorisee: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui, autorisée</SelectItem>
                          <SelectItem value="non">Non, interdite</SelectItem>
                          <SelectItem value="avec_validation">Avec validation préalable du client</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {prestationData.sousTraitanceAutorisee === "avec_validation" && (
                      <div>
                        <Label>Validation préalable nécessaire ?</Label>
                        <RadioGroup value={prestationData.validationPrealable} onValueChange={(v) => setPrestationData({...prestationData, validationPrealable: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="val-oui" /><Label htmlFor="val-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="val-non" /><Label htmlFor="val-non">Non</Label></div>
                        </RadioGroup>
                      </div>
                    )}
                    <div><Label>Responsabilité du prestataire en cas de sous-traitance</Label><Textarea value={prestationData.responsabilitePrestataire} onChange={(e) => setPrestationData({...prestationData, responsabilitePrestataire: e.target.value})} placeholder="Le prestataire reste responsable..." /></div>
                  </div>
                </div>

                {/* 10. RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟 Responsabilité</h4>
                  <div className="space-y-3">
                    <div><Label>Plafond de responsabilité</Label><Input value={prestationData.plafondResponsabilite} onChange={(e) => setPrestationData({...prestationData, plafondResponsabilite: e.target.value})} placeholder="Ex: Montant du contrat, 100 000€..." /></div>
                    <div><Label>Exclusions de responsabilité</Label><Textarea value={prestationData.exclusionsDommages} onChange={(e) => setPrestationData({...prestationData, exclusionsDommages: e.target.value})} placeholder="Dommages indirects, perte de CA..." /></div>
                    <div><Label>Cas de force majeure</Label><Textarea value={prestationData.forceMajeure} onChange={(e) => setPrestationData({...prestationData, forceMajeure: e.target.value})} placeholder="Événements imprévisibles..." /></div>
                    <div><Label>Responsabilité en cas de non-conformité</Label><Textarea value={prestationData.responsabiliteNonConformite} onChange={(e) => setPrestationData({...prestationData, responsabiliteNonConformite: e.target.value})} /></div>
                    <div><Label>Montant de couverture assurance</Label><Input value={prestationData.montantCouverture} onChange={(e) => setPrestationData({...prestationData, montantCouverture: e.target.value})} placeholder="Ex: 500 000€" /></div>
                  </div>
                </div>

                {/* 11. RÉSILIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Résiliation anticipée</h4>
                  <div className="space-y-3">
                    <div><Label>Préavis de résiliation</Label><Input value={prestationData.resiliationPreavis} onChange={(e) => setPrestationData({...prestationData, resiliationPreavis: e.target.value})} placeholder="Ex: 3 mois, 30 jours..." /></div>
                    <div>
                      <Label>Résiliation immédiate en cas de :</Label>
                      <Select value={prestationData.resiliationImmediate} onValueChange={(v) => setPrestationData({...prestationData, resiliationImmediate: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="faute">Faute grave</SelectItem>
                          <SelectItem value="non_paiement">Non-paiement</SelectItem>
                          <SelectItem value="non_respect">Non-respect du contrat</SelectItem>
                          <SelectItem value="tous">Tous les cas ci-dessus</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Effets de la résiliation</Label><Textarea value={prestationData.effetsResiliation} onChange={(e) => setPrestationData({...prestationData, effetsResiliation: e.target.value})} placeholder="Paiement des prestations accomplies, restitution du matériel..." /></div>
                  </div>
                </div>

                {/* 12. RÉVERSIBILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Réversibilité / Fin de contrat</h4>
                  <div className="space-y-3">
                    <div><Label>Restitution des données</Label><Textarea value={prestationData.restitutionDonnees} onChange={(e) => setPrestationData({...prestationData, restitutionDonnees: e.target.value})} placeholder="Format, délai..." /></div>
                    <div><Label>Restitution des documents</Label><Textarea value={prestationData.restitutionDocuments} onChange={(e) => setPrestationData({...prestationData, restitutionDocuments: e.target.value})} /></div>
                    <div><Label>Continuation du service pendant la transition</Label><Input value={prestationData.continuationTransition} onChange={(e) => setPrestationData({...prestationData, continuationTransition: e.target.value})} placeholder="Ex: 3 mois" /></div>
                    <div><Label>Assistance à la migration</Label><Textarea value={prestationData.assistanceMigration} onChange={(e) => setPrestationData({...prestationData, assistanceMigration: e.target.value})} /></div>
                    <div><Label>Coût de la réversibilité</Label><Input value={prestationData.coutReversibilite} onChange={(e) => setPrestationData({...prestationData, coutReversibilite: e.target.value})} placeholder="Gratuit, 2000€..." /></div>
                  </div>
                </div>

                {/* 13. LITIGES / LOI APPLICABLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Litiges / Loi applicable</h4>
                  <div className="space-y-3">
                    <div><Label>Loi applicable</Label><Input value={prestationData.loiApplicable} onChange={(e) => setPrestationData({...prestationData, loiApplicable: e.target.value})} placeholder="France" /></div>
                    <div><Label>Tribunal compétent</Label><Input value={prestationData.tribunalCompetent} onChange={(e) => setPrestationData({...prestationData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunal de Commerce de Paris" /></div>
                    <div>
                      <Label>Clause de médiation ou arbitrage ?</Label>
                      <RadioGroup value={prestationData.mediationArbitrage} onValueChange={(v) => setPrestationData({...prestationData, mediationArbitrage: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="med-oui" /><Label htmlFor="med-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="med-non" /><Label htmlFor="med-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Clause amiable obligatoire avant contentieux ?</Label>
                      <RadioGroup value={prestationData.clauseAmiable} onValueChange={(v) => setPrestationData({...prestationData, clauseAmiable: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="am-oui" /><Label htmlFor="am-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="am-non" /><Label htmlFor="am-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>

                {/* 14. DATE D'EFFET & INDÉPENDANCE DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Date d'effet & Indépendance des parties</h4>
                  <div className="space-y-3">
                    <div><Label>Date d'entrée en vigueur du contrat *</Label><Input type="date" value={prestationData.dateEffetContrat} onChange={(e) => setPrestationData({...prestationData, dateEffetContrat: e.target.value})} /></div>
                    
                    <div className="p-3 bg-yellow-50 rounded border border-yellow-200">
                      <p className="text-sm font-semibold text-yellow-800 mb-2">⚠️ Clause d'indépendance (fondamentale pour éviter la requalification en contrat de travail)</p>
                    </div>
                    
                    <div>
                      <Label>Absence de lien de subordination</Label>
                      <RadioGroup value={prestationData.absenceSubordination} onValueChange={(v) => setPrestationData({...prestationData, absenceSubordination: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="sub-oui" /><Label htmlFor="sub-oui">Oui, le prestataire est indépendant</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="sub-non" /><Label htmlFor="sub-non">Non (attention : risque de requalification)</Label></div>
                      </RadioGroup>
                    </div>
                    
                    <div>
                      <Label>Liberté d'organisation du prestataire</Label>
                      <RadioGroup value={prestationData.liberteOrganisation} onValueChange={(v) => setPrestationData({...prestationData, liberteOrganisation: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="lib-oui" /><Label htmlFor="lib-oui">Oui, le prestataire organise librement son travail</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="lib-non" /><Label htmlFor="lib-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    
                    <div>
                      <Label>Clause d'exclusivité</Label>
                      <RadioGroup value={prestationData.exclusivite} onValueChange={(v) => setPrestationData({...prestationData, exclusivite: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="excl-non" /><Label htmlFor="excl-non">Non, le prestataire peut travailler pour d'autres clients</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="excl-oui" /><Label htmlFor="excl-oui">Oui, exclusivité totale</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="partielle" id="excl-part" /><Label htmlFor="excl-part">Exclusivité partielle / encadrée</Label></div>
                      </RadioGroup>
                      {prestationData.exclusivite === "oui" || prestationData.exclusivite === "partielle" ? (
                        <Textarea value={prestationData.precisionExclusivite} onChange={(e) => setPrestationData({...prestationData, precisionExclusivite: e.target.value})} placeholder="Préciser les modalités de l'exclusivité..." className="mt-2" />
                      ) : null}
                    </div>
                  </div>
                </div>

                {/* 15. CLAUSE DE NON-SOLLICITATION / NON-DÉBAUCHAGE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clause de non-sollicitation / non-débauchage</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Clause de non-débauchage des salariés / sous-traitants</Label>
                      <RadioGroup value={prestationData.nonDebauchage} onValueChange={(v) => setPrestationData({...prestationData, nonDebauchage: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="deb-oui" /><Label htmlFor="deb-oui">Oui, interdiction de débaucher</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="deb-non" /><Label htmlFor="deb-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    
                    {prestationData.nonDebauchage === "oui" && (
                      <>
                        <div><Label>Durée de la clause</Label><Input value={prestationData.dureeNonDebauchage} onChange={(e) => setPrestationData({...prestationData, dureeNonDebauchage: e.target.value})} placeholder="Ex: 2 ans à compter de la fin du contrat" /></div>
                        <div><Label>Pénalité en cas de violation</Label><Input value={prestationData.penaliteNonDebauchage} onChange={(e) => setPrestationData({...prestationData, penaliteNonDebauchage: e.target.value})} placeholder="Ex: 12 mois de salaire brut de la personne débauchée" /></div>
                      </>
                    )}
                  </div>
                </div>

                {/* 16. MODIFICATION DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Modification du contrat</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Toute modification doit faire l'objet d'un avenant écrit et signé</Label>
                      <RadioGroup value={prestationData.modificationAvenant} onValueChange={(v) => setPrestationData({...prestationData, modificationAvenant: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="aven-oui" /><Label htmlFor="aven-oui">Oui (recommandé)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="aven-non" /><Label htmlFor="aven-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <p className="text-xs text-gray-600">Cette clause sécurise toute évolution de la prestation en exigeant un accord écrit des deux parties.</p>
                  </div>
                </div>

                {/* 17. CLAUSES JURIDIQUES STANDARDS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clauses juridiques standards</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Clause de tolérance / non-renonciation</Label>
                      <RadioGroup value={prestationData.clauseTolerance} onValueChange={(v) => setPrestationData({...prestationData, clauseTolerance: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="tol-oui" /><Label htmlFor="tol-oui">Oui (recommandé)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="tol-non" /><Label htmlFor="tol-non">Non</Label></div>
                      </RadioGroup>
                      <p className="text-xs text-gray-600 mt-1">Le fait pour une partie de ne pas se prévaloir d'un droit ne constitue pas une renonciation définitive à ce droit.</p>
                    </div>
                    
                    <div>
                      <Label>Clause de nullité partielle (divisibilité)</Label>
                      <RadioGroup value={prestationData.clauseNullitePartielle} onValueChange={(v) => setPrestationData({...prestationData, clauseNullitePartielle: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="null-oui" /><Label htmlFor="null-oui">Oui (recommandé)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="null-non" /><Label htmlFor="null-non">Non</Label></div>
                      </RadioGroup>
                      <p className="text-xs text-gray-600 mt-1">Si une clause est déclarée nulle ou inapplicable, le reste du contrat demeure valable et applicable.</p>
                    </div>
                  </div>
                </div>

                {/* 18. ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes et pièces justificatives</h4>
                  <div className="space-y-3">
                    <SingleFileUpload
                      label="Cahier des charges / Description du projet"
                      files={prestationCahierChargesFiles}
                      onFilesChange={setPrestationCahierChargesFiles}
                      accept=".pdf,.doc,.docx,.xls,.xlsx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="CGV / Conditions commerciales"
                      files={prestationCGVFiles}
                      onFilesChange={setPrestationCGVFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="RGPD / DPA (Data Processing Agreement)"
                      files={prestationRGPDFiles}
                      onFilesChange={setPrestationRGPDFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Autres annexes (planning, plans, devis...)"
                      files={prestationAutresAnnexesFiles}
                      onFilesChange={setPrestationAutresAnnexesFiles}
                      accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"
                      role="avocat"
                    />
                  </div>
                </div>
              </div>
            )}

            {/* Formulaire complet pour Contrat de vente B2B / distribution */}
            {pendingContractType === "Contrat de vente B2B / distribution" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🤝 Contrat de vente B2B / distribution</h3>
                
                {/* 1. IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification des parties</h4>
                  
                  {/* FOURNISSEUR / VENDEUR */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">🏭 Fournisseur / Vendeur</h5>
                    <ClientSelector clients={clients} selectedClientId={venteB2BFournisseurClientId} onClientChange={(id) => {
                      setVenteB2BFournisseurClientId(id);
                      const client = clients.find(c => c.id === id);
                      if (client) {
                        setVenteB2BData(prev => ({
                          ...prev,
                          fournisseurDenomination: `${client.prenom} ${client.nom}`,
                          fournisseurEmail: client.email || "",
                          fournisseurTelephone: client.telephone || "",
                        }));
                      } else {
                        setVenteB2BData(prev => ({
                          ...prev,
                          fournisseurDenomination: "",
                          fournisseurEmail: "",
                          fournisseurTelephone: "",
                        }));
                      }
                    }} label="Sélectionner le fournisseur depuis vos clients" />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                      <div><Label>Dénomination sociale *</Label><Input value={venteB2BData.fournisseurDenomination} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique *</Label><Input value={venteB2BData.fournisseurFormeJuridique} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurFormeJuridique: e.target.value})} placeholder="SARL, SAS, SA..." /></div>
                      <div><Label>Capital social</Label><Input value={venteB2BData.fournisseurCapital} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurCapital: e.target.value})} placeholder="Ex: 10 000€" /></div>
                      <div><Label>RCS / SIREN *</Label><Input value={venteB2BData.fournisseurRCS} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurRCS: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Adresse du siège social *</Label><Input value={venteB2BData.fournisseurSiegeSocial} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurSiegeSocial: e.target.value})} /></div>
                      <div><Label>Représentant légal *</Label><Input value={venteB2BData.fournisseurRepresentant} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurRepresentant: e.target.value})} /></div>
                      <div><Label>Email *</Label><Input type="email" value={venteB2BData.fournisseurEmail} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={venteB2BData.fournisseurTelephone} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurTelephone: e.target.value})} /></div>
                    </div>
                    <div>
                      <Label>Assurance professionnelle</Label>
                      <RadioGroup value={venteB2BData.fournisseurAssurancePro} onValueChange={(v) => setVenteB2BData({...venteB2BData, fournisseurAssurancePro: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="f-ass-oui" /><Label htmlFor="f-ass-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="f-ass-non" /><Label htmlFor="f-ass-non">Non</Label></div>
                      </RadioGroup>
                      {venteB2BData.fournisseurAssurancePro === "oui" && (
                        <Input value={venteB2BData.fournisseurNumeroAssurance} onChange={(e) => setVenteB2BData({...venteB2BData, fournisseurNumeroAssurance: e.target.value})} placeholder="Numéro de police" className="mt-2" />
                      )}
                    </div>
                    
                    <div className="space-y-3">
                      <h6 className="text-sm font-semibold text-gray-700">Pièces justificatives fournisseur</h6>
                      <SingleFileUpload
                        label="Extrait Kbis / Statuts"
                        files={venteB2BFournisseurKbisFiles}
                        onFilesChange={setVenteB2BFournisseurKbisFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Attestation assurance professionnelle"
                        files={venteB2BFournisseurAssuranceFiles}
                        onFilesChange={setVenteB2BFournisseurAssuranceFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Fiches techniques produits"
                        files={venteB2BFournisseurFichesFiles}
                        onFilesChange={setVenteB2BFournisseurFichesFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                    </div>
                  </div>
                  
                  {/* ACHETEUR / DISTRIBUTEUR */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">🏢 Acheteur / Distributeur</h5>
                    <ClientSelector clients={clients} selectedClientId={venteB2BDistributeurClientId} onClientChange={(id) => {
                      setVenteB2BDistributeurClientId(id);
                      const client = clients.find(c => c.id === id);
                      if (client) {
                        setVenteB2BData(prev => ({
                          ...prev,
                          acheteurDenomination: `${client.prenom} ${client.nom}`,
                          acheteurEmail: client.email || "",
                          acheteurTelephone: client.telephone || "",
                        }));
                      } else {
                        setVenteB2BData(prev => ({
                          ...prev,
                          acheteurDenomination: "",
                          acheteurEmail: "",
                          acheteurTelephone: "",
                        }));
                      }
                    }} label="Sélectionner le client (acheteur/distributeur)" />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                      <div><Label>Dénomination *</Label><Input value={venteB2BData.acheteurDenomination} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={venteB2BData.acheteurFormeJuridique} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurFormeJuridique: e.target.value})} /></div>
                      <div><Label>RCS / SIREN</Label><Input value={venteB2BData.acheteurRCS} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurRCS: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Adresse complète *</Label><Input value={venteB2BData.acheteurAdresse} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurAdresse: e.target.value})} /></div>
                      <div><Label>Représentant légal</Label><Input value={venteB2BData.acheteurRepresentant} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurRepresentant: e.target.value})} /></div>
                      <div><Label>Email *</Label><Input type="email" value={venteB2BData.acheteurEmail} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={venteB2BData.acheteurTelephone} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurTelephone: e.target.value})} /></div>
                      <div><Label>Zone géographique d'activité</Label><Input value={venteB2BData.acheteurZoneGeographique} onChange={(e) => setVenteB2BData({...venteB2BData, acheteurZoneGeographique: e.target.value})} placeholder="Ex: France, Europe, International" /></div>
                      <div className="md:col-span-2">
                        <Label>Statut commercial</Label>
                        <Select value={venteB2BData.acheteurStatutCommercial} onValueChange={(v) => setVenteB2BData({...venteB2BData, acheteurStatutCommercial: v})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="revendeur">Revendeur</SelectItem>
                            <SelectItem value="agent">Agent commercial</SelectItem>
                            <SelectItem value="importateur">Importateur</SelectItem>
                            <SelectItem value="grossiste">Grossiste</SelectItem>
                            <SelectItem value="detaillant">Détaillant</SelectItem>
                            <SelectItem value="distributeur_exclusif">Distributeur exclusif</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                    
                    <div className="space-y-3">
                      <h6 className="text-sm font-semibold text-gray-700">Pièces justificatives distributeur</h6>
                      <SingleFileUpload
                        label="Extrait Kbis distributeur"
                        files={venteB2BDistributeurKbisFiles}
                        onFilesChange={setVenteB2BDistributeurKbisFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Attestation RC Pro / Assurance"
                        files={venteB2BDistributeurAssuranceFiles}
                        onFilesChange={setVenteB2BDistributeurAssuranceFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                    </div>
                  </div>
                </div>
                
                {/* 2. OBJET DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du contrat</h4>
                  <div className="space-y-3">
                    <div><Label>Nature des produits vendus *</Label><Textarea value={venteB2BData.natureProduits} onChange={(e) => setVenteB2BData({...venteB2BData, natureProduits: e.target.value})} placeholder="Détail, référence, gamme..." className="min-h-[80px]" /></div>
                    <div><Label>Catégories de produits concernées</Label><Input value={venteB2BData.categoriesProduits} onChange={(e) => setVenteB2BData({...venteB2BData, categoriesProduits: e.target.value})} placeholder="Ex: Électronique, Textile, Alimentaire..." /></div>
                    <div>
                      <Label>Périmètre de la distribution *</Label>
                      <Select value={venteB2BData.perimetreDistribution} onValueChange={(v) => setVenteB2BData({...venteB2BData, perimetreDistribution: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="vente_simple">Vente simple B2B</SelectItem>
                          <SelectItem value="distribution_generale">Contrat de distribution générale</SelectItem>
                          <SelectItem value="exclusive">Distribution exclusive</SelectItem>
                          <SelectItem value="selective">Distribution sélective</SelectItem>
                          <SelectItem value="franchise">Franchise</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Obligations minimales du distributeur</Label><Textarea value={venteB2BData.obligationsMinimalesDistributeur} onChange={(e) => setVenteB2BData({...venteB2BData, obligationsMinimalesDistributeur: e.target.value})} placeholder="Volumes minimum, actions promotionnelles..." /></div>
                    <div><Label>Canaux de vente autorisés</Label><Input value={venteB2BData.canauxVenteAutorises} onChange={(e) => setVenteB2BData({...venteB2BData, canauxVenteAutorises: e.target.value})} placeholder="Boutique physique, en ligne, marketplace, export..." /></div>
                  </div>
                </div>

                {/* 3. CONDITIONS DE VENTE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Conditions de vente (Terms & Conditions)</h4>
                  
                  {/* 3A. TARIFS */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-blue-700">💰 A. Tarifs</h5>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Prix unitaire</Label><Input value={venteB2BData.prixUnitaire} onChange={(e) => setVenteB2BData({...venteB2BData, prixUnitaire: e.target.value})} placeholder="Ex: 50€ HT / unité" /></div>
                      <div><Label>Grille tarifaire</Label><Input value={venteB2BData.grilleTarifaire} onChange={(e) => setVenteB2BData({...venteB2BData, grilleTarifaire: e.target.value})} placeholder="Annexe ou lien vers tarifs" /></div>
                    </div>
                    <div><Label>Remises (quantité, volume, saison...)</Label><Textarea value={venteB2BData.remises} onChange={(e) => setVenteB2BData({...venteB2BData, remises: e.target.value})} placeholder="Ex: -5% dès 100 unités, -10% dès 500 unités" /></div>
                    <div><Label>Révisions de prix / Indexation</Label><Input value={venteB2BData.revisionsPrix} onChange={(e) => setVenteB2BData({...venteB2BData, revisionsPrix: e.target.value})} placeholder="Ex: Révision annuelle selon l'inflation" /></div>
                    <div><Label>Conditions préférentielles (si exclusivité)</Label><Input value={venteB2BData.conditionsPreferentielles} onChange={(e) => setVenteB2BData({...venteB2BData, conditionsPreferentielles: e.target.value})} /></div>
                  </div>
                  
                  {/* 3B. COMMANDES */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">📦 B. Commandes</h5>
                    <div><Label>Modalités de passation</Label><Input value={venteB2BData.modalitesPassationCommande} onChange={(e) => setVenteB2BData({...venteB2BData, modalitesPassationCommande: e.target.value})} placeholder="Email, plateforme, téléphone..." /></div>
                    <div><Label>Minimums de commande</Label><Input value={venteB2BData.minimumsCommande} onChange={(e) => setVenteB2BData({...venteB2BData, minimumsCommande: e.target.value})} placeholder="Ex: 100 unités ou 1000€ HT" /></div>
                    <div><Label>Délais de commande</Label><Input value={venteB2BData.delaisCommande} onChange={(e) => setVenteB2BData({...venteB2BData, delaisCommande: e.target.value})} placeholder="Ex: 15 jours avant livraison souhaitée" /></div>
                    <div>
                      <Label>Confirmation de commande</Label>
                      <RadioGroup value={venteB2BData.confirmationCommande} onValueChange={(v) => setVenteB2BData({...venteB2BData, confirmationCommande: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="automatique" id="conf-auto" /><Label htmlFor="conf-auto">Automatique</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="manuelle" id="conf-man" /><Label htmlFor="conf-man">Manuelle (validation fournisseur)</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Conditions annulation / modification</Label><Textarea value={venteB2BData.conditionsAnnulation} onChange={(e) => setVenteB2BData({...venteB2BData, conditionsAnnulation: e.target.value})} placeholder="Délais, pénalités éventuelles..." /></div>
                  </div>
                  
                  {/* 3C. LIVRAISON */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">🚚 C. Livraison</h5>
                    <div>
                      <Label>Incoterms *</Label>
                      <Select value={venteB2BData.incoterms} onValueChange={(v) => setVenteB2BData({...venteB2BData, incoterms: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="EXW">EXW (Ex Works - départ usine)</SelectItem>
                          <SelectItem value="FCA">FCA (Free Carrier - franco transporteur)</SelectItem>
                          <SelectItem value="CPT">CPT (Carriage Paid To - port payé jusqu'à)</SelectItem>
                          <SelectItem value="CIP">CIP (Carriage and Insurance Paid - port et assurance payés)</SelectItem>
                          <SelectItem value="DAP">DAP (Delivered At Place - rendu au lieu de destination)</SelectItem>
                          <SelectItem value="DPU">DPU (Delivered at Place Unloaded - rendu déchargé)</SelectItem>
                          <SelectItem value="DDP">DDP (Delivered Duty Paid - rendu droits acquittés)</SelectItem>
                          <SelectItem value="FOB">FOB (Free On Board - franco à bord)</SelectItem>
                          <SelectItem value="CFR">CFR (Cost and Freight - coût et fret)</SelectItem>
                          <SelectItem value="CIF">CIF (Cost, Insurance and Freight - coût, assurance, fret)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Transporteur</Label><Input value={venteB2BData.transporteur} onChange={(e) => setVenteB2BData({...venteB2BData, transporteur: e.target.value})} placeholder="Choisi par fournisseur / acheteur" /></div>
                    <div><Label>Transfert des risques</Label><Input value={venteB2BData.transfertRisques} onChange={(e) => setVenteB2BData({...venteB2BData, transfertRisques: e.target.value})} placeholder="Selon Incoterms ou précision" /></div>
                    <div><Label>Délais de livraison</Label><Input value={venteB2BData.delaisLivraison} onChange={(e) => setVenteB2BData({...venteB2BData, delaisLivraison: e.target.value})} placeholder="Ex: 10 jours ouvrés" /></div>
                    <div><Label>Pénalités de retard de livraison</Label><Input value={venteB2BData.penalitesRetardLivraison} onChange={(e) => setVenteB2BData({...venteB2BData, penalitesRetardLivraison: e.target.value})} placeholder="Ex: 1% du montant HT par semaine" /></div>
                    <div><Label>Modalités de réception et contrôle</Label><Textarea value={venteB2BData.modalitesReception} onChange={(e) => setVenteB2BData({...venteB2BData, modalitesReception: e.target.value})} placeholder="Délai de réclamation, réserves..." /></div>
                  </div>
                  
                  {/* 3D. PAIEMENT */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">💳 D. Paiement</h5>
                    <div>
                      <Label>Mode de paiement *</Label>
                      <Select value={venteB2BData.modePaiement} onValueChange={(v) => setVenteB2BData({...venteB2BData, modePaiement: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="virement">Virement bancaire</SelectItem>
                          <SelectItem value="prelevement">Prélèvement SEPA</SelectItem>
                          <SelectItem value="LCR">LCR (Lettre de Change Relevé)</SelectItem>
                          <SelectItem value="cheque">Chèque</SelectItem>
                          <SelectItem value="carte">Carte bancaire</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Délais de paiement *</Label>
                      <Select value={venteB2BData.delaisPaiement} onValueChange={(v) => setVenteB2BData({...venteB2BData, delaisPaiement: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="comptant">Comptant</SelectItem>
                          <SelectItem value="30j">30 jours</SelectItem>
                          <SelectItem value="45j">45 jours fin de mois</SelectItem>
                          <SelectItem value="60j">60 jours</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div><Label>Acompte éventuel</Label><Input value={venteB2BData.acomptePaiement} onChange={(e) => setVenteB2BData({...venteB2BData, acomptePaiement: e.target.value})} placeholder="Ex: 30% à la commande" /></div>
                    <div><Label>Pénalités de retard</Label><Input value={venteB2BData.penalitesRetardPaiement} onChange={(e) => setVenteB2BData({...venteB2BData, penalitesRetardPaiement: e.target.value})} placeholder="Ex: 3 fois le taux légal" /></div>
                    <div><Label>Indemnité forfaitaire de recouvrement</Label><Input value={venteB2BData.indemniteLegaleRecouvrement} onChange={(e) => setVenteB2BData({...venteB2BData, indemniteLegaleRecouvrement: e.target.value})} placeholder="40€" /></div>
                    <div>
                      <Label>Suspension des livraisons en cas d'impayé</Label>
                      <RadioGroup value={venteB2BData.suspensionLivraisonImpaye} onValueChange={(v) => setVenteB2BData({...venteB2BData, suspensionLivraisonImpaye: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="susp-liv-oui" /><Label htmlFor="susp-liv-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="susp-liv-non" /><Label htmlFor="susp-liv-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>
                
                {/* 4. OBLIGATIONS DU FOURNISSEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations du fournisseur</h4>
                  <div className="space-y-2">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.obligationConformite} onChange={(e) => setVenteB2BData({...venteB2BData, obligationConformite: e.target.checked})} id="oblig-conf" className="rounded" />
                      <Label htmlFor="oblig-conf" className="font-normal cursor-pointer">Fournir des produits conformes</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.respectNormesCertifications} onChange={(e) => setVenteB2BData({...venteB2BData, respectNormesCertifications: e.target.checked})} id="oblig-normes" className="rounded" />
                      <Label htmlFor="oblig-normes" className="font-normal cursor-pointer">Respect des normes et certifications</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.garantieDisponibilite} onChange={(e) => setVenteB2BData({...venteB2BData, garantieDisponibilite: e.target.checked})} id="oblig-dispo" className="rounded" />
                      <Label htmlFor="oblig-dispo" className="font-normal cursor-pointer">Garantir disponibilité et respect des délais</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.assuranceQualite} onChange={(e) => setVenteB2BData({...venteB2BData, assuranceQualite: e.target.checked})} id="oblig-qualite" className="rounded" />
                      <Label htmlFor="oblig-qualite" className="font-normal cursor-pointer">Assurer la qualité (contrôles, tests)</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.remplacementDefectueux} onChange={(e) => setVenteB2BData({...venteB2BData, remplacementDefectueux: e.target.checked})} id="oblig-remplacement" className="rounded" />
                      <Label htmlFor="oblig-remplacement" className="font-normal cursor-pointer">Remplacer les produits défectueux</Label>
                    </div>
                    <div>
                      <Label>Former le distributeur</Label>
                      <RadioGroup value={venteB2BData.formationDistributeur} onValueChange={(v) => setVenteB2BData({...venteB2BData, formationDistributeur: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="form-dist-oui" /><Label htmlFor="form-dist-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="form-dist-non" /><Label htmlFor="form-dist-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Assistance technique / après-vente</Label>
                      <RadioGroup value={venteB2BData.assistanceTechnique} onValueChange={(v) => setVenteB2BData({...venteB2BData, assistanceTechnique: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="assist-tech-oui" /><Label htmlFor="assist-tech-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="assist-tech-non" /><Label htmlFor="assist-tech-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.obligationInformation} onChange={(e) => setVenteB2BData({...venteB2BData, obligationInformation: e.target.checked})} id="oblig-info" className="rounded" />
                      <Label htmlFor="oblig-info" className="font-normal cursor-pointer">Obligation d'information (ruptures, nouveautés)</Label>
                    </div>
                  </div>
                </div>

                {/* 5. OBLIGATIONS DE L'ACHETEUR / DISTRIBUTEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations de l'acheteur / distributeur</h4>
                  <div className="space-y-2">
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.commercialisationImageMarque} onChange={(e) => setVenteB2BData({...venteB2BData, commercialisationImageMarque: e.target.checked})} id="comm-image" className="rounded" />
                      <Label htmlFor="comm-image" className="font-normal cursor-pointer">Commercialiser conformément à l'image de la marque</Label>
                    </div>
                    <div>
                      <Label>Respecter les prix recommandés (non obligatoire juridiquement)</Label>
                      <RadioGroup value={venteB2BData.respectPrixRecommandes} onValueChange={(v) => setVenteB2BData({...venteB2BData, respectPrixRecommandes: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="prix-rec-oui" /><Label htmlFor="prix-rec-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="prix-rec-non" /><Label htmlFor="prix-rec-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.promotionActive} onChange={(e) => setVenteB2BData({...venteB2BData, promotionActive: e.target.checked})} id="promo-active" className="rounded" />
                      <Label htmlFor="promo-active" className="font-normal cursor-pointer">Promouvoir activement les produits</Label>
                    </div>
                    <div><Label>Maintenir un stock minimum (si exigé)</Label><Input value={venteB2BData.stockMinimum} onChange={(e) => setVenteB2BData({...venteB2BData, stockMinimum: e.target.value})} placeholder="Ex: 100 unités ou 3 mois de ventes" /></div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.reportingMarche} onChange={(e) => setVenteB2BData({...venteB2BData, reportingMarche: e.target.checked})} id="reporting" className="rounded" />
                      <Label htmlFor="reporting" className="font-normal cursor-pointer">Informations sur le marché / reporting</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.respectNormesLocales} onChange={(e) => setVenteB2BData({...venteB2BData, respectNormesLocales: e.target.checked})} id="normes-loc" className="rounded" />
                      <Label htmlFor="normes-loc" className="font-normal cursor-pointer">Respect des normes locales (import/export)</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <input type="checkbox" checked={venteB2BData.serviceClientRetours} onChange={(e) => setVenteB2BData({...venteB2BData, serviceClientRetours: e.target.checked})} id="sav-retours" className="rounded" />
                      <Label htmlFor="sav-retours" className="font-normal cursor-pointer">Service client et gestion des retours</Label>
                    </div>
                    <div>
                      <Label>Formation du personnel de vente</Label>
                      <RadioGroup value={venteB2BData.formationPersonnel} onValueChange={(v) => setVenteB2BData({...venteB2BData, formationPersonnel: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="form-pers-oui" /><Label htmlFor="form-pers-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="form-pers-non" /><Label htmlFor="form-pers-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>

                {/* 6. EXCLUSIVITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Exclusivité (si applicable)</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Exclusivité territoriale</Label>
                      <RadioGroup value={venteB2BData.exclusiviteTerritoriale} onValueChange={(v) => setVenteB2BData({...venteB2BData, exclusiviteTerritoriale: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="excl-terr-oui" /><Label htmlFor="excl-terr-oui">Oui, distributeur unique dans une zone</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="excl-terr-non" /><Label htmlFor="excl-terr-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    
                    {venteB2BData.exclusiviteTerritoriale === "oui" && (
                      <>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                          <div><Label>Pays / Région</Label><Input value={venteB2BData.exclusivitePays} onChange={(e) => setVenteB2BData({...venteB2BData, exclusivitePays: e.target.value})} placeholder="Ex: France, Île-de-France..." /></div>
                          <div><Label>Zone précise</Label><Input value={venteB2BData.exclusiviteRegion} onChange={(e) => setVenteB2BData({...venteB2BData, exclusiviteRegion: e.target.value})} placeholder="Départements, villes..." /></div>
                        </div>
                        <div><Label>Durée de l'exclusivité</Label><Input value={venteB2BData.dureeExclusivite} onChange={(e) => setVenteB2BData({...venteB2BData, dureeExclusivite: e.target.value})} placeholder="Ex: 2 ans renouvelables" /></div>
                        <div><Label>Engagement de volume minimal</Label><Input value={venteB2BData.volumeMinimalExclusivite} onChange={(e) => setVenteB2BData({...venteB2BData, volumeMinimalExclusivite: e.target.value})} placeholder="Ex: 10 000 unités/an" /></div>
                        <div><Label>Objectifs de vente</Label><Textarea value={venteB2BData.objectifsVenteExclusivite} onChange={(e) => setVenteB2BData({...venteB2BData, objectifsVenteExclusivite: e.target.value})} placeholder="Objectifs annuels, trimestriels..." /></div>
                      </>
                    )}
                    
                    <div>
                      <Label>Exclusivité produit (fournisseur ne vend pas à d'autres distributeurs)</Label>
                      <RadioGroup value={venteB2BData.exclusiviteProduit} onValueChange={(v) => setVenteB2BData({...venteB2BData, exclusiviteProduit: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="excl-prod-oui" /><Label htmlFor="excl-prod-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="excl-prod-non" /><Label htmlFor="excl-prod-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    
                    <div><Label>Sanctions en cas d'échec des objectifs</Label><Textarea value={venteB2BData.sanctionsEchecExclusivite} onChange={(e) => setVenteB2BData({...venteB2BData, sanctionsEchecExclusivite: e.target.value})} placeholder="Perte de l'exclusivité, résiliation, pénalité..." /></div>
                  </div>
                </div>

                {/* 7. DISTRIBUTION SÉLECTIVE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Distribution sélective (si applicable)</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Distribution sélective</Label>
                      <RadioGroup value={venteB2BData.distributionSelective} onValueChange={(v) => setVenteB2BData({...venteB2BData, distributionSelective: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="dist-sel-oui" /><Label htmlFor="dist-sel-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="dist-sel-non" /><Label htmlFor="dist-sel-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    
                    {venteB2BData.distributionSelective === "oui" && (
                      <>
                        <div><Label>Critères d'agrément</Label><Textarea value={venteB2BData.criteresAgrement} onChange={(e) => setVenteB2BData({...venteB2BData, criteresAgrement: e.target.value})} placeholder="Compétences techniques, réputation, moyens financiers..." /></div>
                        <div><Label>Exigences de présentation des produits</Label><Textarea value={venteB2BData.exigencesPresentationProduits} onChange={(e) => setVenteB2BData({...venteB2BData, exigencesPresentationProduits: e.target.value})} placeholder="Merchandising, PLV, agencement..." /></div>
                        <div><Label>Qualité minimale du point de vente</Label><Input value={venteB2BData.qualiteMinimalePointVente} onChange={(e) => setVenteB2BData({...venteB2BData, qualiteMinimalePointVente: e.target.value})} placeholder="Surface, emplacement, décoration..." /></div>
                        <div><Label>Conditions de formation du personnel</Label><Input value={venteB2BData.conditionsFormationPersonnel} onChange={(e) => setVenteB2BData({...venteB2BData, conditionsFormationPersonnel: e.target.value})} placeholder="Formation produits, certification..." /></div>
                        <div>
                          <Label>Interdiction de revente hors réseau</Label>
                          <RadioGroup value={venteB2BData.interdictionReventeHorsReseau} onValueChange={(v) => setVenteB2BData({...venteB2BData, interdictionReventeHorsReseau: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="inter-res-oui" /><Label htmlFor="inter-res-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="inter-res-non" /><Label htmlFor="inter-res-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                      </>
                    )}
                  </div>
                </div>
                
                {/* 8. PROPRIÉTÉ INTELLECTUELLE & MARQUE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle & Marque</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Droit d'utiliser la marque du fournisseur</Label>
                      <RadioGroup value={venteB2BData.droitUtilisationMarque} onValueChange={(v) => setVenteB2BData({...venteB2BData, droitUtilisationMarque: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="marque-oui" /><Label htmlFor="marque-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="marque-non" /><Label htmlFor="marque-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Conditions d'utilisation des logos / images</Label><Textarea value={venteB2BData.conditionsUtilisationLogos} onChange={(e) => setVenteB2BData({...venteB2BData, conditionsUtilisationLogos: e.target.value})} placeholder="Charte graphique, autorisations préalables..." /></div>
                    <div>
                      <Label>Interdiction de modification des produits</Label>
                      <RadioGroup value={venteB2BData.interdictionModificationProduits} onValueChange={(v) => setVenteB2BData({...venteB2BData, interdictionModificationProduits: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="modif-non" /><Label htmlFor="modif-non">Oui, interdiction</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="modif-oui" /><Label htmlFor="modif-oui">Non, modifications autorisées</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Propriétaire des documents marketing</Label>
                      <RadioGroup value={venteB2BData.proprietaireDocumentsMarketing} onValueChange={(v) => setVenteB2BData({...venteB2BData, proprietaireDocumentsMarketing: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="fournisseur" id="prop-four" /><Label htmlFor="prop-four">Fournisseur</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="acheteur" id="prop-ach" /><Label htmlFor="prop-ach">Acheteur</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="partage" id="prop-part" /><Label htmlFor="prop-part">Partage</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Interdiction de dépôt de marque similaire</Label>
                      <RadioGroup value={venteB2BData.interdictionDepotMarque} onValueChange={(v) => setVenteB2BData({...venteB2BData, interdictionDepotMarque: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="depot-non" /><Label htmlFor="depot-non">Oui, interdiction</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="depot-oui" /><Label htmlFor="depot-oui">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Clause contre la contrefaçon</Label><Textarea value={venteB2BData.clauseContreContrefacon} onChange={(e) => setVenteB2BData({...venteB2BData, clauseContreContrefacon: e.target.value})} placeholder="Engagement du distributeur, sanctions..." /></div>
                  </div>
                </div>

                {/* 9. GARANTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Garanties</h4>
                  <div className="space-y-3">
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">A. Garantie légale</h5>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input type="checkbox" checked={venteB2BData.garantieLegaleConformite} onChange={(e) => setVenteB2BData({...venteB2BData, garantieLegaleConformite: e.target.checked})} id="gar-conf" className="rounded" />
                          <Label htmlFor="gar-conf" className="font-normal cursor-pointer">Garantie de conformité</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input type="checkbox" checked={venteB2BData.garantieLegaleVicesCaches} onChange={(e) => setVenteB2BData({...venteB2BData, garantieLegaleVicesCaches: e.target.checked})} id="gar-vices" className="rounded" />
                          <Label htmlFor="gar-vices" className="font-normal cursor-pointer">Garantie des vices cachés</Label>
                        </div>
                      </div>
                    </div>
                    
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">B. Garantie commerciale</h5>
                      <div className="space-y-2">
                        <div><Label>Durée</Label><Input value={venteB2BData.garantieCommercialeDuree} onChange={(e) => setVenteB2BData({...venteB2BData, garantieCommercialeDuree: e.target.value})} placeholder="Ex: 2 ans" /></div>
                        <div><Label>Étendue</Label><Input value={venteB2BData.garantieCommercialeEtendue} onChange={(e) => setVenteB2BData({...venteB2BData, garantieCommercialeEtendue: e.target.value})} placeholder="Pièces et main d'œuvre, remplacement..." /></div>
                        <div><Label>Exclusions</Label><Textarea value={venteB2BData.garantieCommercialeExclusions} onChange={(e) => setVenteB2BData({...venteB2BData, garantieCommercialeExclusions: e.target.value})} placeholder="Usure normale, mauvaise utilisation..." /></div>
                      </div>
                    </div>
                    
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">C. Retours</h5>
                      <div className="space-y-2">
                        <div><Label>Conditions de retour</Label><Textarea value={venteB2BData.conditionsRetour} onChange={(e) => setVenteB2BData({...venteB2BData, conditionsRetour: e.target.value})} placeholder="Délai, état du produit, emballage..." /></div>
                        <div><Label>Procédure SAV</Label><Textarea value={venteB2BData.procedureSAV} onChange={(e) => setVenteB2BData({...venteB2BData, procedureSAV: e.target.value})} placeholder="Contact, RMA, réparation/remplacement..." /></div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 10. RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟 Responsabilité</h4>
                  <div className="space-y-3">
                    <div><Label>Limitation de responsabilité du fournisseur</Label><Textarea value={venteB2BData.limitationResponsabiliteFournisseur} onChange={(e) => setVenteB2BData({...venteB2BData, limitationResponsabiliteFournisseur: e.target.value})} placeholder="Plafond, type de dommages..." /></div>
                    <div>
                      <Label>Exclusion des dommages indirects</Label>
                      <RadioGroup value={venteB2BData.exclusionDommagesIndirects} onValueChange={(v) => setVenteB2BData({...venteB2BData, exclusionDommagesIndirects: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="excl-dom-oui" /><Label htmlFor="excl-dom-oui">Oui, exclusion (perte de CA, manque à gagner...)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="excl-dom-non" /><Label htmlFor="excl-dom-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Plafond indemnitaire</Label><Input value={venteB2BData.plafondIndemnitaire} onChange={(e) => setVenteB2BData({...venteB2BData, plafondIndemnitaire: e.target.value})} placeholder="Ex: Montant du contrat sur 12 mois" /></div>
                    <div><Label>Cas de force majeure</Label><Textarea value={venteB2BData.casForceMajeure} onChange={(e) => setVenteB2BData({...venteB2BData, casForceMajeure: e.target.value})} placeholder="Événements imprévisibles exonérant de responsabilité..." /></div>
                    <div><Label>Responsabilité du distributeur vis-à-vis de ses clients</Label><Textarea value={venteB2BData.responsabiliteDistributeurClients} onChange={(e) => setVenteB2BData({...venteB2BData, responsabiliteDistributeurClients: e.target.value})} placeholder="Le distributeur assume la responsabilité..." /></div>
                  </div>
                </div>

                {/* 11. NON-CONCURRENCE & CONFIDENTIALITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Non-concurrence & Confidentialité</h4>
                  <div className="space-y-3">
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">Non-concurrence</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Interdiction de distribuer des produits concurrents</Label>
                          <RadioGroup value={venteB2BData.interdictionProduitsConcurrents} onValueChange={(v) => setVenteB2BData({...venteB2BData, interdictionProduitsConcurrents: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="non-conc-oui" /><Label htmlFor="non-conc-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="non-conc-non" /><Label htmlFor="non-conc-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.interdictionProduitsConcurrents === "oui" && (
                          <>
                            <div><Label>Durée</Label><Input value={venteB2BData.dureeNonConcurrence} onChange={(e) => setVenteB2BData({...venteB2BData, dureeNonConcurrence: e.target.value})} placeholder="Ex: Pendant la durée du contrat + 1 an" /></div>
                            <div><Label>Sanctions</Label><Input value={venteB2BData.sanctionsNonConcurrence} onChange={(e) => setVenteB2BData({...venteB2BData, sanctionsNonConcurrence: e.target.value})} placeholder="Résiliation, pénalité..." /></div>
                          </>
                        )}
                      </div>
                    </div>
                    
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">Confidentialité</h5>
                      <div className="space-y-2">
                        <div><Label>Durée de confidentialité</Label><Input value={venteB2BData.confidentialiteDuree} onChange={(e) => setVenteB2BData({...venteB2BData, confidentialiteDuree: e.target.value})} placeholder="Ex: 5 ans après fin du contrat" /></div>
                        <div><Label>Nature des informations confidentielles</Label><Textarea value={venteB2BData.natureInformationsConfidentielles} onChange={(e) => setVenteB2BData({...venteB2BData, natureInformationsConfidentielles: e.target.value})} placeholder="Prix, techniques, stratégies commerciales..." /></div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 12. DURÉE & RÉSILIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Durée & Résiliation</h4>
                  <div className="space-y-3">
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">Durée du contrat</h5>
                      <div className="space-y-2">
                        <div><Label>Date d'entrée en vigueur *</Label><Input type="date" value={venteB2BData.dateEntreeVigueur} onChange={(e) => setVenteB2BData({...venteB2BData, dateEntreeVigueur: e.target.value})} /></div>
                        <div>
                          <Label>Type de durée *</Label>
                          <RadioGroup value={venteB2BData.dureeContrat} onValueChange={(v) => setVenteB2BData({...venteB2BData, dureeContrat: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="determinee" id="duree-det" /><Label htmlFor="duree-det">Durée déterminée</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="indeterminee" id="duree-ind" /><Label htmlFor="duree-ind">Durée indéterminée</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.dureeContrat === "determinee" && (
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div><Label>Date de début</Label><Input type="date" value={venteB2BData.dateDebutContrat} onChange={(e) => setVenteB2BData({...venteB2BData, dateDebutContrat: e.target.value})} /></div>
                            <div><Label>Date de fin</Label><Input type="date" value={venteB2BData.dateFinContrat} onChange={(e) => setVenteB2BData({...venteB2BData, dateFinContrat: e.target.value})} /></div>
                          </div>
                        )}
                        <div>
                          <Label>Reconduction tacite ?</Label>
                          <RadioGroup value={venteB2BData.reconductionTacite} onValueChange={(v) => setVenteB2BData({...venteB2BData, reconductionTacite: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="recon-oui" /><Label htmlFor="recon-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="recon-non" /><Label htmlFor="recon-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                      </div>
                    </div>
                    
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">Résiliation</h5>
                      <div className="space-y-2">
                        <div><Label>Préavis de résiliation</Label><Input value={venteB2BData.preavisResiliation} onChange={(e) => setVenteB2BData({...venteB2BData, preavisResiliation: e.target.value})} placeholder="Ex: 3 mois, 90 jours..." /></div>
                        <div><Label>Résiliation immédiate en cas de</Label><Textarea value={venteB2BData.resiliationImmediateMotifs} onChange={(e) => setVenteB2BData({...venteB2BData, resiliationImmediateMotifs: e.target.value})} placeholder="Impayés, atteinte à l'image, non-respect des objectifs, violation des obligations..." /></div>
                        
                        <div className="mt-3">
                          <Label className="font-medium">Fautes graves qualifiées</Label>
                          <div className="space-y-2 mt-2">
                            <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.fautesGravesDefautPaiement} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, fautesGravesDefautPaiement: !!v})} id="fg-paiement" /><Label htmlFor="fg-paiement" className="font-normal">Défaut de paiement</Label></div>
                            <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.fautesGravesAtteintemarque} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, fautesGravesAtteintemarque: !!v})} id="fg-marque" /><Label htmlFor="fg-marque" className="font-normal">Atteinte à la marque</Label></div>
                            <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.fautesGravesNonRespectExclusivite} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, fautesGravesNonRespectExclusivite: !!v})} id="fg-exclu" /><Label htmlFor="fg-exclu" className="font-normal">Non-respect exclusivité / territoire</Label></div>
                            <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.fautesGravesViolationPI} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, fautesGravesViolationPI: !!v})} id="fg-pi" /><Label htmlFor="fg-pi" className="font-normal">Violation PI ou confidentialité</Label></div>
                          </div>
                        </div>
                        
                        <div className="mt-3">
                          <Label>Indemnité de fin de contrat (distribution)</Label>
                          <RadioGroup value={venteB2BData.indemniteFinContrat} onValueChange={(v) => setVenteB2BData({...venteB2BData, indemniteFinContrat: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="ifc-oui" /><Label htmlFor="ifc-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="ifc-non" /><Label htmlFor="ifc-non">Non</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="exclusion" id="ifc-excl" /><Label htmlFor="ifc-excl">Exclusion expresse</Label></div>
                          </RadioGroup>
                          {venteB2BData.indemniteFinContrat === "oui" && (
                            <Input value={venteB2BData.montantIndemniteFinContrat} onChange={(e) => setVenteB2BData({...venteB2BData, montantIndemniteFinContrat: e.target.value})} placeholder="Montant ou formule de calcul" className="mt-2" />
                          )}
                        </div>
                        
                        <div><Label>Effets de la résiliation</Label><Textarea value={venteB2BData.effetsResiliation} onChange={(e) => setVenteB2BData({...venteB2BData, effetsResiliation: e.target.value})} placeholder="Dernières commandes, restitution matériels, arrêt marque, stocks..." /></div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 13. CLAUSES SPÉCIFIQUES B2B */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clauses spécifiques B2B</h4>
                  <div className="space-y-4">
                    {/* Réserve de propriété */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">🔒 Clause de réserve de propriété</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Les produits restent la propriété du fournisseur jusqu'au paiement intégral ?</Label>
                          <RadioGroup value={venteB2BData.reservePropriete} onValueChange={(v) => setVenteB2BData({...venteB2BData, reservePropriete: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="rp-oui" /><Label htmlFor="rp-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="rp-non" /><Label htmlFor="rp-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.reservePropriete === "oui" && (
                          <div><Label>Précisions sur la réserve de propriété</Label><Textarea value={venteB2BData.reserveProprietePrecisions} onChange={(e) => setVenteB2BData({...venteB2BData, reserveProprietePrecisions: e.target.value})} placeholder="Transfert de propriété, risques, revendication en cas d'impayé..." /></div>
                        )}
                      </div>
                    </div>
                    
                    {/* Non-sollicitation */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">🚫 Clause de non-sollicitation / non-débauchage</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Interdiction de débaucher salariés / agents</Label>
                          <RadioGroup value={venteB2BData.nonSollicitationSalaries} onValueChange={(v) => setVenteB2BData({...venteB2BData, nonSollicitationSalaries: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="ns-oui" /><Label htmlFor="ns-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="ns-non" /><Label htmlFor="ns-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.nonSollicitationSalaries === "oui" && (
                          <>
                            <div><Label>Durée de l'interdiction</Label><Input value={venteB2BData.dureeNonSollicitation} onChange={(e) => setVenteB2BData({...venteB2BData, dureeNonSollicitation: e.target.value})} placeholder="Ex: 2 ans après fin du contrat" /></div>
                            <div><Label>Pénalité en cas de violation</Label><Input value={venteB2BData.penaliteNonSollicitation} onChange={(e) => setVenteB2BData({...venteB2BData, penaliteNonSollicitation: e.target.value})} placeholder="Montant ou formule" /></div>
                          </>
                        )}
                      </div>
                    </div>
                    
                    {/* Cession du contrat */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">📋 Clause de cession du contrat</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Cession du contrat autorisée ?</Label>
                          <RadioGroup value={venteB2BData.cessionContratAutorisee} onValueChange={(v) => setVenteB2BData({...venteB2BData, cessionContratAutorisee: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="cc-oui" /><Label htmlFor="cc-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="cc-non" /><Label htmlFor="cc-non">Non (interdite)</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.cessionContratAutorisee === "oui" && (
                          <div>
                            <Label>Accord préalable requis ?</Label>
                            <RadioGroup value={venteB2BData.cessionContratAccordPrealable} onValueChange={(v) => setVenteB2BData({...venteB2BData, cessionContratAccordPrealable: v})}>
                              <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="cca-oui" /><Label htmlFor="cca-oui">Oui</Label></div>
                              <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="cca-non" /><Label htmlFor="cca-non">Non (libre)</Label></div>
                            </RadioGroup>
                          </div>
                        )}
                      </div>
                    </div>
                    
                    {/* Clause de survie */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">⏰ Clause de survie (après résiliation)</h5>
                      <div className="space-y-2">
                        <Label className="font-medium">Les clauses suivantes survivent à la fin du contrat :</Label>
                        <div className="space-y-2 mt-2">
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurvieConfidentialite} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurvieConfidentialite: !!v})} id="cs-conf" /><Label htmlFor="cs-conf" className="font-normal">Confidentialité</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurviePI} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurviePI: !!v})} id="cs-pi" /><Label htmlFor="cs-pi" className="font-normal">Propriété intellectuelle</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurvieResponsabilite} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurvieResponsabilite: !!v})} id="cs-resp" /><Label htmlFor="cs-resp" className="font-normal">Responsabilité</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurvieNonConcurrence} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurvieNonConcurrence: !!v})} id="cs-nc" /><Label htmlFor="cs-nc" className="font-normal">Non-concurrence</Label></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 13. CLAUSES SPÉCIFIQUES B2B */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clauses spécifiques B2B</h4>
                  <div className="space-y-4">
                    {/* Réserve de propriété */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">🔒 Clause de réserve de propriété</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Les produits restent la propriété du fournisseur jusqu'au paiement intégral ?</Label>
                          <RadioGroup value={venteB2BData.reservePropriete} onValueChange={(v) => setVenteB2BData({...venteB2BData, reservePropriete: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="rp-oui" /><Label htmlFor="rp-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="rp-non" /><Label htmlFor="rp-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.reservePropriete === "oui" && (
                          <div><Label>Précisions sur la réserve de propriété</Label><Textarea value={venteB2BData.reserveProprietePrecisions} onChange={(e) => setVenteB2BData({...venteB2BData, reserveProprietePrecisions: e.target.value})} placeholder="Transfert de propriété, risques, revendication en cas d'impayé..." /></div>
                        )}
                      </div>
                    </div>
                    
                    {/* Non-sollicitation */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">🚫 Clause de non-sollicitation / non-débauchage</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Interdiction de débaucher salariés / agents</Label>
                          <RadioGroup value={venteB2BData.nonSollicitationSalaries} onValueChange={(v) => setVenteB2BData({...venteB2BData, nonSollicitationSalaries: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="ns-oui" /><Label htmlFor="ns-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="ns-non" /><Label htmlFor="ns-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.nonSollicitationSalaries === "oui" && (
                          <>
                            <div><Label>Durée de l'interdiction</Label><Input value={venteB2BData.dureeNonSollicitation} onChange={(e) => setVenteB2BData({...venteB2BData, dureeNonSollicitation: e.target.value})} placeholder="Ex: 2 ans après fin du contrat" /></div>
                            <div><Label>Pénalité en cas de violation</Label><Input value={venteB2BData.penaliteNonSollicitation} onChange={(e) => setVenteB2BData({...venteB2BData, penaliteNonSollicitation: e.target.value})} placeholder="Montant ou formule" /></div>
                          </>
                        )}
                      </div>
                    </div>
                    
                    {/* Cession du contrat */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">📋 Clause de cession du contrat</h5>
                      <div className="space-y-2">
                        <div>
                          <Label>Cession du contrat autorisée ?</Label>
                          <RadioGroup value={venteB2BData.cessionContratAutorisee} onValueChange={(v) => setVenteB2BData({...venteB2BData, cessionContratAutorisee: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="cc-oui" /><Label htmlFor="cc-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="cc-non" /><Label htmlFor="cc-non">Non (interdite)</Label></div>
                          </RadioGroup>
                        </div>
                        {venteB2BData.cessionContratAutorisee === "oui" && (
                          <div>
                            <Label>Accord préalable requis ?</Label>
                            <RadioGroup value={venteB2BData.cessionContratAccordPrealable} onValueChange={(v) => setVenteB2BData({...venteB2BData, cessionContratAccordPrealable: v})}>
                              <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="cca-oui" /><Label htmlFor="cca-oui">Oui</Label></div>
                              <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="cca-non" /><Label htmlFor="cca-non">Non (libre)</Label></div>
                            </RadioGroup>
                          </div>
                        )}
                      </div>
                    </div>
                    
                    {/* Clause de survie */}
                    <div className="p-3 bg-white rounded border border-blue-100">
                      <h5 className="font-medium text-gray-700 mb-2">⏰ Clause de survie (après résiliation)</h5>
                      <div className="space-y-2">
                        <Label className="font-medium">Les clauses suivantes survivent à la fin du contrat :</Label>
                        <div className="space-y-2 mt-2">
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurvieConfidentialite} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurvieConfidentialite: !!v})} id="cs-conf" /><Label htmlFor="cs-conf" className="font-normal">Confidentialité</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurviePI} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurviePI: !!v})} id="cs-pi" /><Label htmlFor="cs-pi" className="font-normal">Propriété intellectuelle</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurvieResponsabilite} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurvieResponsabilite: !!v})} id="cs-resp" /><Label htmlFor="cs-resp" className="font-normal">Responsabilité</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={venteB2BData.clausesSurvieNonConcurrence} onCheckedChange={(v) => setVenteB2BData({...venteB2BData, clausesSurvieNonConcurrence: !!v})} id="cs-nc" /><Label htmlFor="cs-nc" className="font-normal">Non-concurrence</Label></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 14. COMPLIANCE / DROIT APPLICABLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Compliance / Droit applicable</h4>
                  <div className="space-y-3">
                    <div><Label>Loi applicable</Label><Input value={venteB2BData.loiApplicable} onChange={(e) => setVenteB2BData({...venteB2BData, loiApplicable: e.target.value})} placeholder="France" /></div>
                    <div><Label>Tribunal compétent</Label><Input value={venteB2BData.tribunalCompetent} onChange={(e) => setVenteB2BData({...venteB2BData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunal de Commerce de Paris" /></div>
                    <div>
                      <Label>Clause de médiation</Label>
                      <RadioGroup value={venteB2BData.clauseMediation} onValueChange={(v) => setVenteB2BData({...venteB2BData, clauseMediation: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="med-b2b-oui" /><Label htmlFor="med-b2b-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="med-b2b-non" /><Label htmlFor="med-b2b-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Clause anti-corruption (Sapin II)</Label>
                      <RadioGroup value={venteB2BData.clauseAntiCorruption} onValueChange={(v) => setVenteB2BData({...venteB2BData, clauseAntiCorruption: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="sapin-oui" /><Label htmlFor="sapin-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="sapin-non" /><Label htmlFor="sapin-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Clause RGPD (si données personnelles)</Label>
                      <RadioGroup value={venteB2BData.clauseRGPD} onValueChange={(v) => setVenteB2BData({...venteB2BData, clauseRGPD: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="rgpd-b2b-oui" /><Label htmlFor="rgpd-b2b-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="rgpd-b2b-non" /><Label htmlFor="rgpd-b2b-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Clause de conformité export / import</Label><Textarea value={venteB2BData.clauseConformiteExportImport} onChange={(e) => setVenteB2BData({...venteB2BData, clauseConformiteExportImport: e.target.value})} placeholder="Douanes, licences, embargos..." /></div>
                  </div>
                </div>

                {/* 15. ANNEXES ET PIÈCES JUSTIFICATIVES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes et pièces justificatives</h4>
                  <div className="space-y-3">
                    <SingleFileUpload
                      label="CGV B2B / Conditions commerciales"
                      files={venteB2BCGVFiles}
                      onFilesChange={setVenteB2BCGVFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Grilles tarifaires"
                      files={venteB2BGrillesTarifairesFiles}
                      onFilesChange={setVenteB2BGrillesTarifairesFiles}
                      accept=".pdf,.doc,.docx,.xls,.xlsx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Autres annexes (guides, SAV, chartes...)"
                      files={venteB2BAutresAnnexesFiles}
                      onFilesChange={setVenteB2BAutresAnnexesFiles}
                      accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"
                      role="avocat"
                    />
                  </div>
                </div>
              </div>
            )}



            {/* Formulaire complet pour Conditions Générales de Vente (CGV) */}
            {pendingContractType === "Conditions Générales de Vente (CGV)" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-blue-700">📋 Conditions Générales de Vente (CGV)</h3>
                
                {/* 1. IDENTIFICATION DU VENDEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification du vendeur</h4>
                  <div className="space-y-3">
                    <ClientSelector 
                      clients={clients} 
                      selectedClientId={cgvVendeurClientId} 
                      onClientChange={(clientId) => {
                        setCgvVendeurClientId(clientId);
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setCgvData({
                            ...cgvData,
                            vendeurDenomination: `${client.prenom} ${client.nom}`,
                            vendeurAdresseSiege: client.adresse || "",
                            vendeurEmail: client.email || "",
                            vendeurTelephone: client.telephone || ""
                          });
                        } else {
                          setCgvData({
                            ...cgvData,
                            vendeurDenomination: "",
                            vendeurAdresseSiege: "",
                            vendeurEmail: "",
                            vendeurTelephone: ""
                          });
                        }
                      }} 
                      label="Sélectionner un client comme vendeur" 
                    />
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Dénomination sociale / Nom *</Label><Input value={cgvData.vendeurDenomination} onChange={(e) => setCgvData({...cgvData, vendeurDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={cgvData.vendeurFormeJuridique} onChange={(e) => setCgvData({...cgvData, vendeurFormeJuridique: e.target.value})} placeholder="SARL, SAS, SASU, EI..." /></div>
                      <div><Label>Capital social</Label><Input value={cgvData.vendeurCapitalSocial} onChange={(e) => setCgvData({...cgvData, vendeurCapitalSocial: e.target.value})} placeholder="Ex: 10 000€" /></div>
                      <div><Label>SIREN</Label><Input value={cgvData.vendeurSIREN} onChange={(e) => setCgvData({...cgvData, vendeurSIREN: e.target.value})} placeholder="123 456 789" /></div>
                      <div><Label>RCS</Label><Input value={cgvData.vendeurRCS} onChange={(e) => setCgvData({...cgvData, vendeurRCS: e.target.value})} placeholder="RCS Ville" /></div>
                      <div><Label>TVA intracommunautaire</Label><Input value={cgvData.vendeurTVAIntracommunautaire} onChange={(e) => setCgvData({...cgvData, vendeurTVAIntracommunautaire: e.target.value})} placeholder="FR12345678901" /></div>
                    </div>
                    <div><Label>Adresse du siège social *</Label><Input value={cgvData.vendeurAdresseSiege} onChange={(e) => setCgvData({...cgvData, vendeurAdresseSiege: e.target.value})} /></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Email *</Label><Input type="email" value={cgvData.vendeurEmail} onChange={(e) => setCgvData({...cgvData, vendeurEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={cgvData.vendeurTelephone} onChange={(e) => setCgvData({...cgvData, vendeurTelephone: e.target.value})} /></div>
                      <div><Label>Nom du responsable légal</Label><Input value={cgvData.vendeurResponsableLegal} onChange={(e) => setCgvData({...cgvData, vendeurResponsableLegal: e.target.value})} /></div>
                    </div>
                    <div>
                      <Label>Profession réglementée ?</Label>
                      <RadioGroup value={cgvData.vendeurProfessionReglementee} onValueChange={(v) => setCgvData({...cgvData, vendeurProfessionReglementee: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="prof-oui" /><Label htmlFor="prof-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="prof-non" /><Label htmlFor="prof-non">Non</Label></div>
                      </RadioGroup>
                      {cgvData.vendeurProfessionReglementee === "oui" && (
                        <Input value={cgvData.vendeurPrecisionProfession} onChange={(e) => setCgvData({...cgvData, vendeurPrecisionProfession: e.target.value})} placeholder="Précisez la profession et l'organisme" className="mt-2" />
                      )}
                    </div>
                    <div>
                      <Label>Assurance professionnelle</Label>
                      <RadioGroup value={cgvData.vendeurAssurancePro} onValueChange={(v) => setCgvData({...cgvData, vendeurAssurancePro: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="ass-oui" /><Label htmlFor="ass-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="ass-non" /><Label htmlFor="ass-non">Non</Label></div>
                      </RadioGroup>
                      {cgvData.vendeurAssurancePro === "oui" && (
                        <Input value={cgvData.vendeurNumeroAssurance} onChange={(e) => setCgvData({...cgvData, vendeurNumeroAssurance: e.target.value})} placeholder="Numéro de police d'assurance" className="mt-2" />
                      )}
                    </div>
                    
                    <MultiFileUpload label="Pièces justificatives vendeur (Kbis, mentions légales, RC Pro)" files={cgvVendeurFiles} onFilesChange={setCgvVendeurFiles} accept=".pdf,.jpg,.jpeg,.png" role="avocat" />
                  </div>
                </div>
                
                {/* 2. CHAMP D'APPLICATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Champ d'application des CGV</h4>
                  <div className="space-y-3">
                    <div><Label>Types de produits / services vendus *</Label><Textarea value={cgvData.typesProduitsServices} onChange={(e) => setCgvData({...cgvData, typesProduitsServices: e.target.value})} placeholder="Décrivez les produits et services couverts par ces CGV..." className="min-h-[80px]" /></div>
                    <div>
                      <Label className="font-medium">Types de clients concernés</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.typesClients.includes("B2C")} onCheckedChange={(v) => setCgvData({...cgvData, typesClients: v ? [...cgvData.typesClients, "B2C"] : cgvData.typesClients.filter(t => t !== "B2C")})} id="client-b2c" /><Label htmlFor="client-b2c" className="font-normal">B2C (consommateurs)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.typesClients.includes("B2B")} onCheckedChange={(v) => setCgvData({...cgvData, typesClients: v ? [...cgvData.typesClients, "B2B"] : cgvData.typesClients.filter(t => t !== "B2B")})} id="client-b2b" /><Label htmlFor="client-b2b" className="font-normal">B2B (professionnels)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.typesClients.includes("mixte")} onCheckedChange={(v) => setCgvData({...cgvData, typesClients: v ? [...cgvData.typesClients, "mixte"] : cgvData.typesClients.filter(t => t !== "mixte")})} id="client-mixte" /><Label htmlFor="client-mixte" className="font-normal">Mixte (professionnels & consommateurs)</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">Canaux de vente</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.canalVente.includes("e-commerce")} onCheckedChange={(v) => setCgvData({...cgvData, canalVente: v ? [...cgvData.canalVente, "e-commerce"] : cgvData.canalVente.filter(c => c !== "e-commerce")})} id="canal-ecom" /><Label htmlFor="canal-ecom" className="font-normal">Site e-commerce</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.canalVente.includes("physique")} onCheckedChange={(v) => setCgvData({...cgvData, canalVente: v ? [...cgvData.canalVente, "physique"] : cgvData.canalVente.filter(c => c !== "physique")})} id="canal-phys" /><Label htmlFor="canal-phys" className="font-normal">Vente physique</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.canalVente.includes("marketplace")} onCheckedChange={(v) => setCgvData({...cgvData, canalVente: v ? [...cgvData.canalVente, "marketplace"] : cgvData.canalVente.filter(c => c !== "marketplace")})} id="canal-market" /><Label htmlFor="canal-market" className="font-normal">Marketplace</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.canalVente.includes("contrat-cadre")} onCheckedChange={(v) => setCgvData({...cgvData, canalVente: v ? [...cgvData.canalVente, "contrat-cadre"] : cgvData.canalVente.filter(c => c !== "contrat-cadre")})} id="canal-cadre" /><Label htmlFor="canal-cadre" className="font-normal">Contrat cadre + CGV annexées</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.canalVente.includes("autre")} onCheckedChange={(v) => setCgvData({...cgvData, canalVente: v ? [...cgvData.canalVente, "autre"] : cgvData.canalVente.filter(c => c !== "autre")})} id="canal-autre" /><Label htmlFor="canal-autre" className="font-normal">Autre</Label></div>
                      </div>
                      {cgvData.canalVente.includes("autre") && (
                        <Input value={cgvData.canalAutrePrecision} onChange={(e) => setCgvData({...cgvData, canalAutrePrecision: e.target.value})} placeholder="Précisez" className="mt-2" />
                      )}
                    </div>
                  </div>
                </div>
                
                {/* 3. DÉFINITIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Définitions indispensables</h4>
                  <p className="text-sm text-gray-600">Définissez les termes clés utilisés dans vos CGV</p>
                  <div className="space-y-3">
                    <div><Label>Produit</Label><Textarea value={cgvData.definitionProduit} onChange={(e) => setCgvData({...cgvData, definitionProduit: e.target.value})} placeholder="Ex: Désigne tout bien meuble proposé à la vente..." className="min-h-[60px]" /></div>
                    <div><Label>Service</Label><Textarea value={cgvData.definitionService} onChange={(e) => setCgvData({...cgvData, definitionService: e.target.value})} placeholder="Ex: Désigne toute prestation fournie par le vendeur..." className="min-h-[60px]" /></div>
                    <div><Label>Client</Label><Textarea value={cgvData.definitionClient} onChange={(e) => setCgvData({...cgvData, definitionClient: e.target.value})} placeholder="Ex: Désigne toute personne physique ou morale procédant à un achat..." className="min-h-[60px]" /></div>
                    <div><Label>Commande</Label><Textarea value={cgvData.definitionCommande} onChange={(e) => setCgvData({...cgvData, definitionCommande: e.target.value})} placeholder="Ex: Désigne tout ordre d'achat de produits ou services..." className="min-h-[60px]" /></div>
                    <div><Label>Compte utilisateur</Label><Textarea value={cgvData.definitionCompteUtilisateur} onChange={(e) => setCgvData({...cgvData, definitionCompteUtilisateur: e.target.value})} placeholder="Ex: Espace personnel créé par le client..." className="min-h-[60px]" /></div>
                    <div><Label>Livraison</Label><Textarea value={cgvData.definitionLivraison} onChange={(e) => setCgvData({...cgvData, definitionLivraison: e.target.value})} placeholder="Ex: Désigne le transfert physique des produits..." className="min-h-[60px]" /></div>
                    <div><Label>Abonnement</Label><Textarea value={cgvData.definitionAbonnement} onChange={(e) => setCgvData({...cgvData, definitionAbonnement: e.target.value})} placeholder="Ex: Formule de paiement récurrent..." className="min-h-[60px]" /></div>
                    <div><Label>Prix</Label><Textarea value={cgvData.definitionPrix} onChange={(e) => setCgvData({...cgvData, definitionPrix: e.target.value})} placeholder="Ex: Montant dû par le client en contrepartie..." className="min-h-[60px]" /></div>
                    <div><Label>Force majeure</Label><Textarea value={cgvData.definitionForceMajeure} onChange={(e) => setCgvData({...cgvData, definitionForceMajeure: e.target.value})} placeholder="Ex: Tout événement extérieur, imprévisible et irrésistible..." className="min-h-[60px]" /></div>
                    <div><Label>Contrat</Label><Textarea value={cgvData.definitionContrat} onChange={(e) => setCgvData({...cgvData, definitionContrat: e.target.value})} placeholder="Ex: Désigne l'ensemble formé par les présentes CGV et la commande..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 4. CARACTÉRISTIQUES DES PRODUITS/SERVICES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Caractéristiques des produits / services</h4>
                  <div className="space-y-3">
                    <div><Label>Description précise des produits/services *</Label><Textarea value={cgvData.descriptionProduits} onChange={(e) => setCgvData({...cgvData, descriptionProduits: e.target.value})} placeholder="Décrivez précisément les caractéristiques, spécifications, qualités..." className="min-h-[100px]" /></div>
                    <div>
                      <Label>Visuels / Photos / Maquettes disponibles</Label>
                      <RadioGroup value={cgvData.visuelsDisponibles} onValueChange={(v) => setCgvData({...cgvData, visuelsDisponibles: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="vis-oui" /><Label htmlFor="vis-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="vis-non" /><Label htmlFor="vis-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Spécifications techniques</Label><Textarea value={cgvData.specificationstechniques} onChange={(e) => setCgvData({...cgvData, specificationstechniques: e.target.value})} placeholder="Dimensions, poids, matériaux, compatibilités, performances..." className="min-h-[80px]" /></div>
                    <div><Label>Disponibilités</Label><Input value={cgvData.disponibilites} onChange={(e) => setCgvData({...cgvData, disponibilites: e.target.value})} placeholder="Ex: En stock, sur devis, sur mesure, délai de fabrication..." /></div>
                    <div><Label>Restrictions d'usage</Label><Textarea value={cgvData.restrictionsUsage} onChange={(e) => setCgvData({...cgvData, restrictionsUsage: e.target.value})} placeholder="Interdictions, limitations, précautions d'emploi..." className="min-h-[60px]" /></div>
                    <div><Label>Conditions préalables d'utilisation</Label><Textarea value={cgvData.conditionsPrealables} onChange={(e) => setCgvData({...cgvData, conditionsPrealables: e.target.value})} placeholder="Prérequis techniques, compétences nécessaires, équipements requis..." className="min-h-[60px]" /></div>
                    
                    <MultiFileUpload label="Fiches techniques, certificats produits" files={cgvProduitsFiles} onFilesChange={setCgvProduitsFiles} accept=".pdf,.jpg,.jpeg,.png" role="avocat" />
                  </div>
                </div>
                
                {/* 5. PROCESSUS DE COMMANDE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Processus de commande</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Création d'un compte client obligatoire ?</Label>
                      <RadioGroup value={cgvData.creationCompteObligatoire} onValueChange={(v) => setCgvData({...cgvData, creationCompteObligatoire: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="compte-oui" /><Label htmlFor="compte-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="compte-non" /><Label htmlFor="compte-non">Non (achat invité possible)</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Étapes de commande</Label><Textarea value={cgvData.etapesCommande} onChange={(e) => setCgvData({...cgvData, etapesCommande: e.target.value})} placeholder="Ex: 1. Ajout au panier, 2. Identification, 3. Adresse livraison, 4. Mode de paiement, 5. Validation..." className="min-h-[80px]" /></div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={cgvData.validationDoubleClick} onCheckedChange={(v) => setCgvData({...cgvData, validationDoubleClick: !!v})} id="double-click" />
                      <Label htmlFor="double-click" className="font-normal">Validation du double-clic (obligatoire e-commerce) ✅</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={cgvData.confirmationEmail} onCheckedChange={(v) => setCgvData({...cgvData, confirmationEmail: !!v})} id="confirm-email" />
                      <Label htmlFor="confirm-email" className="font-normal">Confirmation par email ✅</Label>
                    </div>
                    <div>
                      <Label>Annulation possible avant expédition ?</Label>
                      <RadioGroup value={cgvData.annulationAvantExpedition} onValueChange={(v) => setCgvData({...cgvData, annulationAvantExpedition: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="annul-oui" /><Label htmlFor="annul-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="annul-non" /><Label htmlFor="annul-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Commandes sur devis uniquement ?</Label>
                      <RadioGroup value={cgvData.commandesSurDevis} onValueChange={(v) => setCgvData({...cgvData, commandesSurDevis: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="devis-oui" /><Label htmlFor="devis-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="devis-non" /><Label htmlFor="devis-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>
                
                {/* 6. PRIX */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Prix</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Prix affichés *</Label>
                      <RadioGroup value={cgvData.prixAffichesTTC} onValueChange={(v) => setCgvData({...cgvData, prixAffichesTTC: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="TTC" id="prix-ttc" /><Label htmlFor="prix-ttc">TTC (B2C)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="HT" id="prix-ht" /><Label htmlFor="prix-ht">HT (B2B)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="mixte" id="prix-mixte" /><Label htmlFor="prix-mixte">Mixte (selon client)</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>TVA applicable</Label><Input value={cgvData.tvaApplicable} onChange={(e) => setCgvData({...cgvData, tvaApplicable: e.target.value})} placeholder="Ex: 20%, 10%, 5.5%..." /></div>
                    <div><Label>Variation des prix</Label><Textarea value={cgvData.variationPrix} onChange={(e) => setCgvData({...cgvData, variationPrix: e.target.value})} placeholder="Les prix peuvent-ils varier ? Conditions de révision..." className="min-h-[60px]" /></div>
                    <div><Label>Frais supplémentaires</Label><Textarea value={cgvData.fraisSupplementaires} onChange={(e) => setCgvData({...cgvData, fraisSupplementaires: e.target.value})} placeholder="Livraison, installation, personnalisation..." className="min-h-[60px]" /></div>
                    <div><Label>Remises, réductions, promotions</Label><Textarea value={cgvData.remisesReductions} onChange={(e) => setCgvData({...cgvData, remisesReductions: e.target.value})} placeholder="Conditions d'application des remises..." className="min-h-[60px]" /></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Durée de validité des devis</Label><Input value={cgvData.devisDureeValidite} onChange={(e) => setCgvData({...cgvData, devisDureeValidite: e.target.value})} placeholder="Ex: 30 jours" /></div>
                      <div><Label>Révision du devis</Label><Input value={cgvData.devisRevision} onChange={(e) => setCgvData({...cgvData, devisRevision: e.target.value})} placeholder="Conditions de révision" /></div>
                    </div>
                  </div>
                </div>
                
                {/* 7. CONDITIONS DE PAIEMENT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Conditions de paiement</h4>
                  <div className="space-y-3">
                    <div>
                      <Label className="font-medium">Modes de paiement acceptés</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.modesPaiement.includes("carte")} onCheckedChange={(v) => setCgvData({...cgvData, modesPaiement: v ? [...cgvData.modesPaiement, "carte"] : cgvData.modesPaiement.filter(m => m !== "carte")})} id="pay-carte" /><Label htmlFor="pay-carte" className="font-normal">Carte bancaire</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.modesPaiement.includes("virement")} onCheckedChange={(v) => setCgvData({...cgvData, modesPaiement: v ? [...cgvData.modesPaiement, "virement"] : cgvData.modesPaiement.filter(m => m !== "virement")})} id="pay-vir" /><Label htmlFor="pay-vir" className="font-normal">Virement bancaire</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.modesPaiement.includes("sepa")} onCheckedChange={(v) => setCgvData({...cgvData, modesPaiement: v ? [...cgvData.modesPaiement, "sepa"] : cgvData.modesPaiement.filter(m => m !== "sepa")})} id="pay-sepa" /><Label htmlFor="pay-sepa" className="font-normal">Prélèvement SEPA</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.modesPaiement.includes("paypal")} onCheckedChange={(v) => setCgvData({...cgvData, modesPaiement: v ? [...cgvData.modesPaiement, "paypal"] : cgvData.modesPaiement.filter(m => m !== "paypal")})} id="pay-pp" /><Label htmlFor="pay-pp" className="font-normal">PayPal</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cgvData.modesPaiement.includes("plusieurs-fois")} onCheckedChange={(v) => setCgvData({...cgvData, modesPaiement: v ? [...cgvData.modesPaiement, "plusieurs-fois"] : cgvData.modesPaiement.filter(m => m !== "plusieurs-fois")})} id="pay-plusieurs" /><Label htmlFor="pay-plusieurs" className="font-normal">Paiement en plusieurs fois</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label>Paiement</Label>
                      <RadioGroup value={cgvData.paiementImmediatDiffere} onValueChange={(v) => setCgvData({...cgvData, paiementImmediatDiffere: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="immediat" id="pay-immed" /><Label htmlFor="pay-immed">Immédiat</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="differe" id="pay-diff" /><Label htmlFor="pay-diff">Différé</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Acompte / Arrhes / Engagement</Label>
                      <Select value={cgvData.acompteArrhes} onValueChange={(v) => setCgvData({...cgvData, acompteArrhes: v})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="aucun">Aucun</SelectItem>
                          <SelectItem value="acompte">Acompte (engagement ferme)</SelectItem>
                          <SelectItem value="arrhes">Arrhes (possibilité de se désister)</SelectItem>
                        </SelectContent>
                      </Select>
                      {cgvData.acompteArrhes !== "aucun" && cgvData.acompteArrhes && (
                        <Input value={cgvData.montantAcompte} onChange={(e) => setCgvData({...cgvData, montantAcompte: e.target.value})} placeholder="Montant ou pourcentage" className="mt-2" />
                      )}
                    </div>
                    <div><Label>Sécurisation du paiement</Label><Input value={cgvData.securisationPaiement} onChange={(e) => setCgvData({...cgvData, securisationPaiement: e.target.value})} placeholder="3D Secure, SSL, prestataire..." /></div>
                    <div><Label>Frais liés à certains paiements</Label><Input value={cgvData.fraisPaiement} onChange={(e) => setCgvData({...cgvData, fraisPaiement: e.target.value})} placeholder="Frais pour certains modes de paiement" /></div>
                    <div>
                      <Label>Factures électroniques</Label>
                      <RadioGroup value={cgvData.facturesElectroniques} onValueChange={(v) => setCgvData({...cgvData, facturesElectroniques: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="fact-elec-oui" /><Label htmlFor="fact-elec-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="fact-elec-non" /><Label htmlFor="fact-elec-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    
                    {cgvData.typesClients.includes("B2B") && (
                      <div className="p-3 bg-orange-50 border border-orange-200 rounded">
                        <Label className="font-medium text-orange-700">⚠️ Paiement B2B (obligatoire)</Label>
                        <div className="space-y-2 mt-2">
                          <div><Label>Délai de paiement</Label><Select value={cgvData.paiementB2BEcheance} onValueChange={(v) => setCgvData({...cgvData, paiementB2BEcheance: v})}><SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger><SelectContent><SelectItem value="comptant">Comptant</SelectItem><SelectItem value="30j">30 jours (LME)</SelectItem><SelectItem value="45j">45 jours</SelectItem><SelectItem value="60j">60 jours (max)</SelectItem></SelectContent></Select></div>
                          <div><Label>Pénalités de retard (taux) *</Label><Input value={cgvData.penalitesRetardTaux} onChange={(e) => setCgvData({...cgvData, penalitesRetardTaux: e.target.value})} placeholder="Ex: 3 fois le taux légal" /></div>
                          <div><Label>Indemnité forfaitaire de recouvrement *</Label><Input value={cgvData.indemniteRecouvrementB2B} onChange={(e) => setCgvData({...cgvData, indemniteRecouvrementB2B: e.target.value})} placeholder="40€" /></div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
                
                {/* 8. LIVRAISON */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Livraison</h4>
                  <div className="space-y-3">
                    <div><Label>Zones livrées</Label><Input value={cgvData.zonesLivrees} onChange={(e) => setCgvData({...cgvData, zonesLivrees: e.target.value})} placeholder="France métropolitaine, Europe, International..." /></div>
                    <div><Label>Mode de livraison</Label><Input value={cgvData.modeLivraison} onChange={(e) => setCgvData({...cgvData, modeLivraison: e.target.value})} placeholder="Colissimo, transporteur, retrait magasin..." /></div>
                    <div><Label>Délais de livraison indicatifs</Label><Input value={cgvData.delaisLivraison} onChange={(e) => setCgvData({...cgvData, delaisLivraison: e.target.value})} placeholder="Ex: 48h, 5 jours ouvrés..." /></div>
                    <div><Label>Frais de livraison</Label><Textarea value={cgvData.fraisLivraison} onChange={(e) => setCgvData({...cgvData, fraisLivraison: e.target.value})} placeholder="Montants selon zone, poids, offerts si..." className="min-h-[60px]" /></div>
                    <div className="p-3 bg-gray-50 rounded border">
                      <Label className="font-medium">Transfert des risques</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label className="text-sm">B2C (consommateurs)</Label><Input value={cgvData.transfertRisquesB2C} onChange={(e) => setCgvData({...cgvData, transfertRisquesB2C: e.target.value})} placeholder="À la réception" className="text-sm" /></div>
                        <div><Label className="text-sm">B2B (professionnels)</Label><Input value={cgvData.transfertRisquesB2B} onChange={(e) => setCgvData({...cgvData, transfertRisquesB2B: e.target.value})} placeholder="À la remise au transporteur" className="text-sm" /></div>
                      </div>
                    </div>
                    <div><Label>Retards de livraison</Label><Textarea value={cgvData.retardsLivraison} onChange={(e) => setCgvData({...cgvData, retardsLivraison: e.target.value})} placeholder="Procédure en cas de retard : remboursement, annulation..." className="min-h-[60px]" /></div>
                    <div><Label>Cas de force majeure</Label><Textarea value={cgvData.casForceMajeureLivraison} onChange={(e) => setCgvData({...cgvData, casForceMajeureLivraison: e.target.value})} placeholder="Événements exonérant le vendeur de sa responsabilité..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 9. EXÉCUTION DU SERVICE (SI PRESTATION) */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Exécution du service (si prestation)</h4>
                  <p className="text-sm text-gray-600">Remplir uniquement si vous vendez des services/prestations</p>
                  <div className="space-y-3">
                    <div><Label>Calendrier d'exécution</Label><Textarea value={cgvData.calendrierService} onChange={(e) => setCgvData({...cgvData, calendrierService: e.target.value})} placeholder="Délais, planning, phases..." className="min-h-[60px]" /></div>
                    <div><Label>Étapes de réalisation</Label><Textarea value={cgvData.etapesRealisation} onChange={(e) => setCgvData({...cgvData, etapesRealisation: e.target.value})} placeholder="Description des différentes étapes..." className="min-h-[60px]" /></div>
                    <div>
                      <Label>Type d'obligation</Label>
                      <RadioGroup value={cgvData.obligationMoyensResultat} onValueChange={(v) => setCgvData({...cgvData, obligationMoyensResultat: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="moyens" id="obl-moy" /><Label htmlFor="obl-moy">Obligation de moyens</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="resultat" id="obl-res" /><Label htmlFor="obl-res">Obligation de résultat</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Validation des livrables</Label><Textarea value={cgvData.validationLivrables} onChange={(e) => setCgvData({...cgvData, validationLivrables: e.target.value})} placeholder="Procédure de validation par le client..." className="min-h-[60px]" /></div>
                    <div><Label>Report / Annulation du service</Label><Textarea value={cgvData.reportAnnulationService} onChange={(e) => setCgvData({...cgvData, reportAnnulationService: e.target.value})} placeholder="Conditions et délais de report ou annulation..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 10. DROIT DE RÉTRACTATION (B2C) */}
                {cgvData.typesClients.includes("B2C") && (
                  <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                    <h4 className="font-semibold text-lg text-green-700">🔟 Droit de rétractation (B2C uniquement)</h4>
                    <p className="text-sm text-green-600">⚠️ Obligatoire pour les ventes à distance aux consommateurs</p>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={cgvData.droitRetractation14jours} onCheckedChange={(v) => setCgvData({...cgvData, droitRetractation14jours: !!v})} id="retract-14j" disabled />
                        <Label htmlFor="retract-14j" className="font-normal">Délai légal : 14 jours ✅ (obligatoire)</Label>
                      </div>
                      <div>
                        <Label className="font-medium">Exceptions au droit de rétractation</Label>
                        <p className="text-xs text-gray-500 mb-2">Cochez les exceptions applicables</p>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2"><Checkbox checked={cgvData.exceptionsRetractation.includes("sur-mesure")} onCheckedChange={(v) => setCgvData({...cgvData, exceptionsRetractation: v ? [...cgvData.exceptionsRetractation, "sur-mesure"] : cgvData.exceptionsRetractation.filter(e => e !== "sur-mesure")})} id="exc-mesure" /><Label htmlFor="exc-mesure" className="font-normal">Produits confectionnés sur mesure</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={cgvData.exceptionsRetractation.includes("numerique-telecharge")} onCheckedChange={(v) => setCgvData({...cgvData, exceptionsRetractation: v ? [...cgvData.exceptionsRetractation, "numerique-telecharge"] : cgvData.exceptionsRetractation.filter(e => e !== "numerique-telecharge")})} id="exc-num" /><Label htmlFor="exc-num" className="font-normal">Contenus numériques téléchargés</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={cgvData.exceptionsRetractation.includes("service-execute")} onCheckedChange={(v) => setCgvData({...cgvData, exceptionsRetractation: v ? [...cgvData.exceptionsRetractation, "service-execute"] : cgvData.exceptionsRetractation.filter(e => e !== "service-execute")})} id="exc-serv" /><Label htmlFor="exc-serv" className="font-normal">Services pleinement exécutés</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={cgvData.exceptionsRetractation.includes("scelles")} onCheckedChange={(v) => setCgvData({...cgvData, exceptionsRetractation: v ? [...cgvData.exceptionsRetractation, "scelles"] : cgvData.exceptionsRetractation.filter(e => e !== "scelles")})} id="exc-scell" /><Label htmlFor="exc-scell" className="font-normal">Produits scellés descellés (hygiène)</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={cgvData.exceptionsRetractation.includes("perissables")} onCheckedChange={(v) => setCgvData({...cgvData, exceptionsRetractation: v ? [...cgvData.exceptionsRetractation, "perissables"] : cgvData.exceptionsRetractation.filter(e => e !== "perissables")})} id="exc-perish" /><Label htmlFor="exc-perish" className="font-normal">Produits périssables</Label></div>
                          <div className="flex items-center space-x-2"><Checkbox checked={cgvData.exceptionsRetractation.includes("journaux")} onCheckedChange={(v) => setCgvData({...cgvData, exceptionsRetractation: v ? [...cgvData.exceptionsRetractation, "journaux"] : cgvData.exceptionsRetractation.filter(e => e !== "journaux")})} id="exc-journ" /><Label htmlFor="exc-journ" className="font-normal">Journaux, périodiques</Label></div>
                        </div>
                      </div>
                      <div><Label>Procédure de rétractation</Label><Textarea value={cgvData.procedureRetractation} onChange={(e) => setCgvData({...cgvData, procedureRetractation: e.target.value})} placeholder="Comment exercer le droit de rétractation : formulaire, email, courrier..." className="min-h-[60px]" /></div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={cgvData.formulaireRetractation} onCheckedChange={(v) => setCgvData({...cgvData, formulaireRetractation: !!v})} id="form-retract" disabled />
                        <Label htmlFor="form-retract" className="font-normal">Formulaire type de rétractation ✅ (obligatoire)</Label>
                      </div>
                      <div><Label>Délais de remboursement</Label><Input value={cgvData.remboursementDelais} onChange={(e) => setCgvData({...cgvData, remboursementDelais: e.target.value})} placeholder="Ex: 14 jours après réception du retour" /></div>
                      <div><Label>Méthode de remboursement</Label><Input value={cgvData.remboursementMethode} onChange={(e) => setCgvData({...cgvData, remboursementMethode: e.target.value})} placeholder="Ex: Même moyen de paiement que l'achat" /></div>
                    </div>
                  </div>
                )}
                
                {/* 11. RETOURS & REMBOURSEMENTS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Retours & Remboursements</h4>
                  <div className="space-y-3">
                    <div><Label>Conditions de retour</Label><Textarea value={cgvData.conditionsRetour} onChange={(e) => setCgvData({...cgvData, conditionsRetour: e.target.value})} placeholder="Dans quels cas un retour est accepté..." className="min-h-[60px]" /></div>
                    <div><Label>Frais de retour</Label><Input value={cgvData.fraisRetour} onChange={(e) => setCgvData({...cgvData, fraisRetour: e.target.value})} placeholder="À la charge du client ou du vendeur" /></div>
                    <div><Label>État des produits retournés</Label><Input value={cgvData.etatProduits} onChange={(e) => setCgvData({...cgvData, etatProduits: e.target.value})} placeholder="Neuf, emballage d'origine..." /></div>
                    <div><Label>Délais de retour</Label><Input value={cgvData.delaisRetour} onChange={(e) => setCgvData({...cgvData, delaisRetour: e.target.value})} placeholder="Ex: 14 jours, 30 jours..." /></div>
                    <div><Label>Retour des produits non conformes</Label><Textarea value={cgvData.produitsNonConformes} onChange={(e) => setCgvData({...cgvData, produitsNonConformes: e.target.value})} placeholder="Procédure en cas de produit défectueux ou non conforme..." className="min-h-[60px]" /></div>
                    <div><Label>SAV (Service Après-Vente)</Label><Textarea value={cgvData.sav} onChange={(e) => setCgvData({...cgvData, sav: e.target.value})} placeholder="Organisation du SAV, contacts, délais..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 12. GARANTIES LÉGALES (OBLIGATOIRE B2C) */}
                {cgvData.typesClients.includes("B2C") && (
                  <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                    <h4 className="font-semibold text-lg text-green-700">Garanties légales (obligatoire B2C)</h4>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={cgvData.garantieLegaleConformite} onCheckedChange={(v) => setCgvData({...cgvData, garantieLegaleConformite: !!v})} id="gar-conf" disabled />
                        <Label htmlFor="gar-conf" className="font-normal">Garantie légale de conformité (2 ans) ✅</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={cgvData.garantieVicesCaches} onCheckedChange={(v) => setCgvData({...cgvData, garantieVicesCaches: !!v})} id="gar-vices" disabled />
                        <Label htmlFor="gar-vices" className="font-normal">Garantie contre les vices cachés (2 ans après découverte) ✅</Label>
                      </div>
                      <div>
                        <Label>Garantie commerciale (facultative)</Label>
                        <RadioGroup value={cgvData.garantieCommerciale} onValueChange={(v) => setCgvData({...cgvData, garantieCommerciale: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="gar-comm-oui" /><Label htmlFor="gar-comm-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="gar-comm-non" /><Label htmlFor="gar-comm-non">Non</Label></div>
                        </RadioGroup>
                        {cgvData.garantieCommerciale === "oui" && (
                          <div className="space-y-2 mt-2">
                            <Input value={cgvData.garantieCommercialeDuree} onChange={(e) => setCgvData({...cgvData, garantieCommercialeDuree: e.target.value})} placeholder="Durée de la garantie commerciale" />
                            <Textarea value={cgvData.garantieCommercialeConditions} onChange={(e) => setCgvData({...cgvData, garantieCommercialeConditions: e.target.value})} placeholder="Conditions et étendue de la garantie..." className="min-h-[60px]" />
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                )}
                
                {/* 13. TRANSFERT DE PROPRIÉTÉ & DES RISQUES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Transfert de propriété & des risques</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Transfert de propriété</Label>
                      <Select value={cgvData.transfertPropriete} onValueChange={(v) => setCgvData({...cgvData, transfertPropriete: v})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="paiement-complet">Au paiement complet</SelectItem>
                          <SelectItem value="livraison">À la livraison</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Clause de réserve de propriété</Label>
                      <RadioGroup value={cgvData.reservePropriete} onValueChange={(v) => setCgvData({...cgvData, reservePropriete: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="reserve-oui" /><Label htmlFor="reserve-oui">Oui (recommandé B2B)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="reserve-non" /><Label htmlFor="reserve-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Transfert des risques</Label><Textarea value={cgvData.transfertRisques} onChange={(e) => setCgvData({...cgvData, transfertRisques: e.target.value})} placeholder="B2C: à la livraison, B2B: remise au transporteur..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 14. RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Responsabilité</h4>
                  <div className="space-y-3">
                    <div><Label>Limitation de responsabilité</Label><Textarea value={cgvData.limitationResponsabilite} onChange={(e) => setCgvData({...cgvData, limitationResponsabilite: e.target.value})} placeholder="Plafond, exclusions, restrictions..." className="min-h-[80px]" /></div>
                    <div>
                      <Label>Exclusion des dommages indirects</Label>
                      <RadioGroup value={cgvData.exclusionDommagesIndirects} onValueChange={(v) => setCgvData({...cgvData, exclusionDommagesIndirects: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="dmg-oui" /><Label htmlFor="dmg-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="dmg-non" /><Label htmlFor="dmg-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Plafond de responsabilité (si applicable)</Label><Input value={cgvData.plafondResponsabilite} onChange={(e) => setCgvData({...cgvData, plafondResponsabilite: e.target.value})} placeholder="Ex: Montant de la commande, 10 000€..." /></div>
                    <div><Label>Force majeure</Label><Textarea value={cgvData.forceMajeureResponsabilite} onChange={(e) => setCgvData({...cgvData, forceMajeureResponsabilite: e.target.value})} placeholder="Exonération en cas de force majeure..." className="min-h-[60px]" /></div>
                    <div><Label>Responsabilité défaut information</Label><Textarea value={cgvData.responsabiliteDefautInfo} onChange={(e) => setCgvData({...cgvData, responsabiliteDefautInfo: e.target.value})} placeholder="Inexactitudes, omissions..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 15. PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  <div className="space-y-3">
                    <div><Label>Marques & logos</Label><Textarea value={cgvData.marquesLogos} onChange={(e) => setCgvData({...cgvData, marquesLogos: e.target.value})} placeholder="Titularité, protection..." className="min-h-[60px]" /></div>
                    <div>
                      <Label>Interdiction reproduction</Label>
                      <RadioGroup value={cgvData.interdictionReproduction} onValueChange={(v) => setCgvData({...cgvData, interdictionReproduction: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="repro-oui" /><Label htmlFor="repro-oui">Oui (interdiction totale)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="partiel" id="repro-part" /><Label htmlFor="repro-part">Partielle</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="repro-non" /><Label htmlFor="repro-non">Autorisée</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Licence client (si applicable)</Label><Textarea value={cgvData.licenceClient} onChange={(e) => setCgvData({...cgvData, licenceClient: e.target.value})} placeholder="Droit d'usage personnel, restrictions..." className="min-h-[60px]" /></div>
                    <div><Label>Protection contenus numériques</Label><Textarea value={cgvData.protectionContenusNumeriques} onChange={(e) => setCgvData({...cgvData, protectionContenusNumeriques: e.target.value})} placeholder="Téléchargements, copies, DRM..." className="min-h-[60px]" /></div>
                    <div><Label>Clause anti-contrefaçon</Label><Textarea value={cgvData.clauseAntiContrefacon} onChange={(e) => setCgvData({...cgvData, clauseAntiContrefacon: e.target.value})} placeholder="Engagement du vendeur, garanties..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 16. RGPD & DONNÉES PERSONNELLES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">RGPD & Données personnelles</h4>
                  <div className="space-y-3">
                    <div><Label>Nature des données collectées *</Label><Textarea value={cgvData.natureDonneesCollectees} onChange={(e) => setCgvData({...cgvData, natureDonneesCollectees: e.target.value})} placeholder="Identité, coordonnées, données bancaires..." className="min-h-[80px]" /></div>
                    <div><Label>Finalités du traitement *</Label><Textarea value={cgvData.finalitesTraitement} onChange={(e) => setCgvData({...cgvData, finalitesTraitement: e.target.value})} placeholder="Gestion commandes, facturation, livraison, marketing..." className="min-h-[80px]" /></div>
                    <div><Label>Responsable de traitement</Label><Input value={cgvData.responsableTraitement} onChange={(e) => setCgvData({...cgvData, responsableTraitement: e.target.value})} placeholder="Nom de l'entreprise" /></div>
                    <div><Label>Durée de conservation</Label><Input value={cgvData.dureeConservation} onChange={(e) => setCgvData({...cgvData, dureeConservation: e.target.value})} placeholder="Ex: 3 ans après dernière commande" /></div>
                    <div><Label>Droits des personnes</Label><Textarea value={cgvData.droitsPersonnes} onChange={(e) => setCgvData({...cgvData, droitsPersonnes: e.target.value})} placeholder="Accès, rectification, suppression, portabilité, opposition..." className="min-h-[80px]" /></div>
                    <div>
                      <Label>Transfert hors UE</Label>
                      <RadioGroup value={cgvData.transfertHorsUE} onValueChange={(v) => setCgvData({...cgvData, transfertHorsUE: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="ue-oui" /><Label htmlFor="ue-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="ue-non" /><Label htmlFor="ue-non">Non</Label></div>
                      </RadioGroup>
                      {cgvData.transfertHorsUE === "oui" && (
                        <Input value={cgvData.transfertHorsUEPrecisions} onChange={(e) => setCgvData({...cgvData, transfertHorsUEPrecisions: e.target.value})} placeholder="Pays, garanties..." className="mt-2" />
                      )}
                    </div>
                    <div><Label>Traitement des données de paiement</Label><Textarea value={cgvData.traitementPaiement} onChange={(e) => setCgvData({...cgvData, traitementPaiement: e.target.value})} placeholder="Prestataire, sécurisation, PCI DSS..." className="min-h-[60px]" /></div>
                    <div><Label>Politique cookies</Label><Textarea value={cgvData.politiqueCookies} onChange={(e) => setCgvData({...cgvData, politiqueCookies: e.target.value})} placeholder="Types, finalités, durée, consentement..." className="min-h-[80px]" /></div>
                  </div>
                </div>
                
                {/* 17. SERVICE CLIENT & MÉDIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Service client & Médiation</h4>
                  <div className="space-y-3">
                    <div><Label>Contact service client *</Label><Textarea value={cgvData.contactServiceClient} onChange={(e) => setCgvData({...cgvData, contactServiceClient: e.target.value})} placeholder="Email, téléphone, horaires, adresse postale..." className="min-h-[80px]" /></div>
                    <div><Label>Procédure de réclamation</Label><Textarea value={cgvData.procedureReclamation} onChange={(e) => setCgvData({...cgvData, procedureReclamation: e.target.value})} placeholder="Étapes, délais de réponse..." className="min-h-[80px]" /></div>
                    {cgvData.typesClients.includes("B2C") && (
                      <div className="p-3 bg-green-50 rounded border border-green-200">
                        <Label className="font-medium text-green-700">Service de médiation (obligatoire B2C) *</Label>
                        <p className="text-xs text-gray-600 mb-2 mt-1">Conformément à l'article L.612-1 du Code de la consommation</p>
                        <Input value={cgvData.serviceMediationNom} onChange={(e) => setCgvData({...cgvData, serviceMediationNom: e.target.value})} placeholder="Nom du médiateur" className="mb-2" />
                        <Textarea value={cgvData.coordonneesMediateur} onChange={(e) => setCgvData({...cgvData, coordonneesMediateur: e.target.value})} placeholder="Adresse, email, site web du médiateur..." className="min-h-[60px]" />
                      </div>
                    )}
                  </div>
                </div>
                
                {/* 18. RÉSILIATION ABONNEMENTS (si applicable) */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Résiliation abonnements (si applicable)</h4>
                  <div className="space-y-3">
                    <div><Label>Durée de l'abonnement</Label><Input value={cgvData.dureeAbonnement} onChange={(e) => setCgvData({...cgvData, dureeAbonnement: e.target.value})} placeholder="Ex: 1 mois, 1 an..." /></div>
                    <div>
                      <Label>Reconduction tacite</Label>
                      <RadioGroup value={cgvData.reconductionTacite} onValueChange={(v) => setCgvData({...cgvData, reconductionTacite: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="recon-oui" /><Label htmlFor="recon-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="recon-non" /><Label htmlFor="recon-non">Non</Label></div>
                      </RadioGroup>
                      {cgvData.reconductionTacite === "oui" && (
                        <p className="text-xs text-gray-600 mt-1">⚠️ Information préalable (Loi Chatel) requise avant échéance</p>
                      )}
                    </div>
                    <div><Label>Procédure de résiliation</Label><Textarea value={cgvData.procedureResiliation} onChange={(e) => setCgvData({...cgvData, procedureResiliation: e.target.value})} placeholder="Modalités, lettre recommandée, email..." className="min-h-[80px]" /></div>
                    <div><Label>Préavis</Label><Input value={cgvData.preavisResiliation} onChange={(e) => setCgvData({...cgvData, preavisResiliation: e.target.value})} placeholder="Ex: 1 mois avant échéance" /></div>
                    <div><Label>Restitution / exportation des données</Label><Textarea value={cgvData.restitutionDonnees} onChange={(e) => setCgvData({...cgvData, restitutionDonnees: e.target.value})} placeholder="Format, délai, conditions..." className="min-h-[60px]" /></div>
                    <div><Label>Suppression du compte</Label><Textarea value={cgvData.suppressionCompte} onChange={(e) => setCgvData({...cgvData, suppressionCompte: e.target.value})} placeholder="Délai de suppression définitive..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 19. LOI APPLICABLE & TRIBUNAL COMPÉTENT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Loi applicable & Tribunal compétent</h4>
                  <div className="space-y-3">
                    <div><Label>Loi applicable *</Label><Input value={cgvData.loiApplicable} onChange={(e) => setCgvData({...cgvData, loiApplicable: e.target.value})} placeholder="Ex: Droit français" /></div>
                    <div><Label>Tribunal compétent</Label><Textarea value={cgvData.tribunalCompetent} onChange={(e) => setCgvData({...cgvData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunaux du ressort de Paris" className="min-h-[60px]" /></div>
                    <div>
                      <Label>Clause de médiation (alternative au tribunal)</Label>
                      <RadioGroup value={cgvData.clauseMediation} onValueChange={(v) => setCgvData({...cgvData, clauseMediation: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="mediation-oui" /><Label htmlFor="mediation-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="mediation-non" /><Label htmlFor="mediation-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    {cgvData.typesClients.includes("B2B") && (
                      <div>
                        <Label>Clause d'arbitrage (B2B)</Label>
                        <RadioGroup value={cgvData.clauseArbitrage} onValueChange={(v) => setCgvData({...cgvData, clauseArbitrage: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="arb-oui" /><Label htmlFor="arb-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="arb-non" /><Label htmlFor="arb-non">Non</Label></div>
                        </RadioGroup>
                      </div>
                    )}
                  </div>
                </div>
                
                {/* 20. ANNEXES (upload individuel par document) */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes à joindre</h4>
                  <div className="space-y-3">
                    <SingleFileUpload
                      label="Formulaire de rétractation (B2C)"
                      files={cgvFormulaireRetractationFiles}
                      onFilesChange={setCgvFormulaireRetractationFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Politique de confidentialité"
                      files={cgvPolitiqueConfidentialiteFiles}
                      onFilesChange={setCgvPolitiqueConfidentialiteFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Grille tarifaire"
                      files={cgvGrilleTarifaireFiles}
                      onFilesChange={setCgvGrilleTarifaireFiles}
                      accept=".pdf,.doc,.docx,.xls,.xlsx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Fiches techniques produits"
                      files={cgvFichesTechniquesFiles}
                      onFilesChange={setCgvFichesTechniquesFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Procédure SAV"
                      files={cgvProcedureSAVFiles}
                      onFilesChange={setCgvProcedureSAVFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Notices d'utilisation"
                      files={cgvNoticesUtilisationFiles}
                      onFilesChange={setCgvNoticesUtilisationFiles}
                      accept=".pdf,.doc,.docx"
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Autres documents"
                      files={cgvAutresFiles}
                      onFilesChange={setCgvAutresFiles}
                      accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png"
                      role="avocat"
                    />
                  </div>
                </div>
                
              </div>
            )}

            {/* Formulaire complet pour Contrat de franchise */}
            {pendingContractType === "Contrat de franchise" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🏪 Contrat de franchise</h3>
                
                {/* 1. IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification des parties</h4>
                  
                  {/* FRANCHISEUR */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">🏢 Franchiseur</h5>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Dénomination sociale *</Label><Input value={franchiseData.franchiseurDenomination} onChange={(e) => setFranchiseData({...franchiseData, franchiseurDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={franchiseData.franchiseurFormeJuridique} onChange={(e) => setFranchiseData({...franchiseData, franchiseurFormeJuridique: e.target.value})} placeholder="SARL, SAS..." /></div>
                      <div><Label>Capital social</Label><Input value={franchiseData.franchiseurCapital} onChange={(e) => setFranchiseData({...franchiseData, franchiseurCapital: e.target.value})} placeholder="Ex: 50 000 €" /></div>
                      <div><Label>RCS / SIREN *</Label><Input value={franchiseData.franchiseurRCS} onChange={(e) => setFranchiseData({...franchiseData, franchiseurRCS: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Adresse du siège *</Label><Input value={franchiseData.franchiseurSiege} onChange={(e) => setFranchiseData({...franchiseData, franchiseurSiege: e.target.value})} /></div>
                      <div><Label>Représentant légal</Label><Input value={franchiseData.franchiseurRepresentant} onChange={(e) => setFranchiseData({...franchiseData, franchiseurRepresentant: e.target.value})} /></div>
                      <div><Label>Date de création de la marque</Label><Input type="date" value={franchiseData.franchiseurDateCreationMarque} onChange={(e) => setFranchiseData({...franchiseData, franchiseurDateCreationMarque: e.target.value})} /></div>
                      <div><Label>Nombre de franchisés existants</Label><Input type="number" value={franchiseData.franchiseurNombreFranchises} onChange={(e) => setFranchiseData({...franchiseData, franchiseurNombreFranchises: e.target.value})} /></div>
                      <div><Label>Assurance professionnelle</Label><Input value={franchiseData.franchiseurAssurancePro} onChange={(e) => setFranchiseData({...franchiseData, franchiseurAssurancePro: e.target.value})} placeholder="Nom assureur + n° police" /></div>
                      <div><Label>Email *</Label><Input type="email" value={franchiseData.franchiseurEmail} onChange={(e) => setFranchiseData({...franchiseData, franchiseurEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={franchiseData.franchiseurTelephone} onChange={(e) => setFranchiseData({...franchiseData, franchiseurTelephone: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Description du réseau</Label><Textarea value={franchiseData.franchiseurDescriptionReseau} onChange={(e) => setFranchiseData({...franchiseData, franchiseurDescriptionReseau: e.target.value})} placeholder="Histoire, valeurs, positionnement du réseau..." className="min-h-[80px]" /></div>
                    </div>
                    
                    <div className="space-y-3 mt-4">
                      <h6 className="text-sm font-semibold text-gray-700">Pièces justificatives franchiseur</h6>
                      <SingleFileUpload
                        label="Extrait Kbis"
                        files={franchiseurKbisFiles}
                        onFilesChange={setFranchiseurKbisFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Documents financiers (2 derniers exercices)"
                        files={franchiseurDocumentsFinanciersFiles}
                        onFilesChange={setFranchiseurDocumentsFinanciersFiles}
                        accept=".pdf,.xls,.xlsx"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Preuve dépôt marque INPI"
                        files={franchiseurDepotMarqueFiles}
                        onFilesChange={setFranchiseurDepotMarqueFiles}
                        accept=".pdf"
                        role="avocat"
                      />
                    </div>
                  </div>
                  
                  {/* FRANCHISÉ */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">👤 Franchisé</h5>
                    <ClientSelector clients={clients} selectedClientId={franchiseClientId} onClientChange={(id) => {
                      setFranchiseClientId(id);
                      const client = clients.find(c => c.id === id);
                      if (client) {
                        setFranchiseData({
                          ...franchiseData,
                          franchiseNom: client.nom || "",
                          franchiseEmail: client.email || "",
                          franchiseTelephone: client.telephone || ""
                        });
                      } else {
                        setFranchiseData({
                          ...franchiseData,
                          franchiseNom: "",
                          franchiseEmail: "",
                          franchiseTelephone: ""
                        });
                      }
                    }} label="Sélectionner le franchisé (optionnel)" />
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                      <div><Label>Nom / Dénomination *</Label><Input value={franchiseData.franchiseNom} onChange={(e) => setFranchiseData({...franchiseData, franchiseNom: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={franchiseData.franchiseFormeJuridique} onChange={(e) => setFranchiseData({...franchiseData, franchiseFormeJuridique: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Adresse complète *</Label><Input value={franchiseData.franchiseAdresse} onChange={(e) => setFranchiseData({...franchiseData, franchiseAdresse: e.target.value})} /></div>
                      <div><Label>RCS / SIREN</Label><Input value={franchiseData.franchiseRCS} onChange={(e) => setFranchiseData({...franchiseData, franchiseRCS: e.target.value})} /></div>
                      <div><Label>Activité prévue</Label><Input value={franchiseData.franchiseActivitePrevue} onChange={(e) => setFranchiseData({...franchiseData, franchiseActivitePrevue: e.target.value})} placeholder="Ex: Restauration rapide..." /></div>
                      <div><Label>Représentant légal</Label><Input value={franchiseData.franchiseRepresentant} onChange={(e) => setFranchiseData({...franchiseData, franchiseRepresentant: e.target.value})} /></div>
                      <div><Label>Situation financière (optionnel)</Label><Input value={franchiseData.franchiseSituationFinanciere} onChange={(e) => setFranchiseData({...franchiseData, franchiseSituationFinanciere: e.target.value})} placeholder="Capitaux disponibles..." /></div>
                      <div><Label>Email *</Label><Input type="email" value={franchiseData.franchiseEmail} onChange={(e) => setFranchiseData({...franchiseData, franchiseEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={franchiseData.franchiseTelephone} onChange={(e) => setFranchiseData({...franchiseData, franchiseTelephone: e.target.value})} /></div>
                    </div>
                    
                    <div className="space-y-3 mt-4">
                      <h6 className="text-sm font-semibold text-gray-700">Pièces justificatives franchisé</h6>
                      <SingleFileUpload
                        label="Justificatifs d'identité"
                        files={franchiseIdentiteFiles}
                        onFilesChange={setFranchiseIdentiteFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Extrait Kbis franchisé"
                        files={franchiseKbisFiles}
                        onFilesChange={setFranchiseKbisFiles}
                        accept=".pdf,.jpg,.jpeg,.png"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Business plan"
                        files={franchiseBusinessPlanFiles}
                        onFilesChange={setFranchiseBusinessPlanFiles}
                        accept=".pdf,.doc,.docx,.xls,.xlsx"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Preuve capacité financière"
                        files={franchiseCapaciteFinanciereFiles}
                        onFilesChange={setFranchiseCapaciteFinanciereFiles}
                        accept=".pdf"
                        role="avocat"
                      />
                      <SingleFileUpload
                        label="Attestation RC Professionnelle"
                        files={franchiseRCProFiles}
                        onFilesChange={setFranchiseRCProFiles}
                        accept=".pdf"
                        role="avocat"
                      />
                    </div>
                  </div>
                </div>

                {/* 2. DOCUMENT D'INFORMATION PRÉCONTRACTUELLE (DIP) */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Document d'Information Précontractuelle (DIP)</h4>
                  <div className="bg-amber-50 border border-amber-300 rounded-lg p-3 text-sm">
                    <p className="font-semibold text-amber-800">⚖️ Obligation légale (Loi Doubin)</p>
                    <p className="text-amber-700 mt-1">Le DIP doit être remis au moins 20 jours avant la signature du contrat ou le versement de toute somme.</p>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Date de remise du DIP *</Label><Input type="date" value={franchiseData.dipDateRemise} onChange={(e) => setFranchiseData({...franchiseData, dipDateRemise: e.target.value})} /></div>
                    <div><Label>Mode de remise</Label><Select value={franchiseData.dipModeRemise} onValueChange={(val) => setFranchiseData({...franchiseData, dipModeRemise: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="remise_main_propre">Remise en main propre</SelectItem><SelectItem value="recommande_ar">Recommandé AR</SelectItem><SelectItem value="email_accuse">Email avec accusé réception</SelectItem></SelectContent></Select></div>
                    <div className="md:col-span-2"><Label>Observations sur le DIP</Label><Textarea value={franchiseData.dipObservations} onChange={(e) => setFranchiseData({...franchiseData, dipObservations: e.target.value})} placeholder="Remarques éventuelles..." className="min-h-[60px]" /></div>
                  </div>
                  
                  <SingleFileUpload
                    label="Document d'Information Précontractuelle (DIP) *"
                    files={franchiseDIPFiles}
                    onFilesChange={setFranchiseDIPFiles}
                    accept=".pdf"
                    required
                    role="avocat"
                  />
                </div>

                {/* 3. OBJET DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du contrat</h4>
                  
                  <div><Label>Concept de franchise *</Label><Textarea value={franchiseData.objetConcept} onChange={(e) => setFranchiseData({...franchiseData, objetConcept: e.target.value})} placeholder="Description détaillée du concept franchisé..." className="min-h-[100px]" /></div>
                  
                  <div><Label>Signes distinctifs (marque, enseigne)</Label><Textarea value={franchiseData.objetSignesDistinctifs} onChange={(e) => setFranchiseData({...franchiseData, objetSignesDistinctifs: e.target.value})} placeholder="Ex: Marque 'XYZ' n° INPI 123456..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Savoir-faire transmis *</Label><Textarea value={franchiseData.objetSavoirFaire} onChange={(e) => setFranchiseData({...franchiseData, objetSavoirFaire: e.target.value})} placeholder="Description du savoir-faire (méthodes, techniques, expérience...)" className="min-h-[100px]" /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Caractère secret du savoir-faire</Label><RadioGroup value={franchiseData.objetCaractereSecret} onValueChange={(val) => setFranchiseData({...franchiseData, objetCaractereSecret: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="oui" />Oui</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non</label><label className="flex items-center gap-2"><RadioGroupItem value="partiel" />Partiel</label></div></RadioGroup></div>
                    <div><Label>Caractère substantiel</Label><RadioGroup value={franchiseData.objetCaractereSubstantiel} onValueChange={(val) => setFranchiseData({...franchiseData, objetCaractereSubstantiel: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="oui" />Oui</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non</label></div></RadioGroup></div>
                  </div>
                  
                  <div><Label>Formation initiale prévue</Label><Input value={franchiseData.objetFormationInitiale} onChange={(e) => setFranchiseData({...franchiseData, objetFormationInitiale: e.target.value})} placeholder="Ex: 3 semaines au siège + 1 semaine sur site" /></div>
                  
                  <div><Label>Assistance continue prévue</Label><Textarea value={franchiseData.objetAssistanceContinue} onChange={(e) => setFranchiseData({...franchiseData, objetAssistanceContinue: e.target.value})} placeholder="Description de l'assistance (technique, commerciale, marketing...)" className="min-h-[80px]" /></div>
                </div>

                {/* 4. DROITS ACCORDÉS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Droits accordés au franchisé</h4>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Type de licence *</Label><Select value={franchiseData.droitsTypeLicence} onValueChange={(val) => setFranchiseData({...franchiseData, droitsTypeLicence: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="exclusive">Exclusive</SelectItem><SelectItem value="semi_exclusive">Semi-exclusive</SelectItem><SelectItem value="non_exclusive">Non exclusive</SelectItem></SelectContent></Select></div>
                    
                    <div><Label>Territoire attribué *</Label><Input value={franchiseData.droitsTerritoire} onChange={(e) => setFranchiseData({...franchiseData, droitsTerritoire: e.target.value})} placeholder="Ex: Ville de Paris, département 75..." /></div>
                  </div>
                  
                  <div><Label>Zone d'exclusivité (le cas échéant)</Label><Textarea value={franchiseData.droitsZoneExclusivite} onChange={(e) => setFranchiseData({...franchiseData, droitsZoneExclusivite: e.target.value})} placeholder="Définition précise des limites géographiques..." className="min-h-[60px]" /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Protection territoriale</Label><RadioGroup value={franchiseData.droitsProtectionTerritoriale} onValueChange={(val) => setFranchiseData({...franchiseData, droitsProtectionTerritoriale: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="oui" />Oui</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non</label></div></RadioGroup></div>
                    
                    <div><Label>Clause d'approvisionnement exclusif</Label><RadioGroup value={franchiseData.droitsApproExclusif} onValueChange={(val) => setFranchiseData({...franchiseData, droitsApproExclusif: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="oui" />Oui</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non</label><label className="flex items-center gap-2"><RadioGroupItem value="partiel" />Partiel</label></div></RadioGroup></div>
                  </div>
                  
                  <div><Label>Droits sur internet / e-commerce</Label><Textarea value={franchiseData.droitsInternet} onChange={(e) => setFranchiseData({...franchiseData, droitsInternet: e.target.value})} placeholder="Définir si le franchisé peut vendre en ligne, dans quelle zone..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Droit de transmission / sous-franchise</Label><Select value={franchiseData.droitsTransmission} onValueChange={(val) => setFranchiseData({...franchiseData, droitsTransmission: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="interdit">Interdit</SelectItem><SelectItem value="accord_prealable">Avec accord préalable</SelectItem><SelectItem value="libre">Libre</SelectItem></SelectContent></Select></div>
                  
                  <div><Label>Autres droits spécifiques</Label><Textarea value={franchiseData.droitsAutres} onChange={(e) => setFranchiseData({...franchiseData, droitsAutres: e.target.value})} placeholder="Droits particuliers, options..." className="min-h-[60px]" /></div>
                </div>

                {/* 5. OBLIGATIONS DU FRANCHISEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations du franchiseur</h4>
                  
                  <div><Label>Formation initiale *</Label><Textarea value={franchiseData.obligFranchiseurFormationInitiale} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurFormationInitiale: e.target.value})} placeholder="Détail du programme de formation (durée, contenu, lieu...)" className="min-h-[80px]" /></div>
                  
                  <div><Label>Formation continue</Label><Textarea value={franchiseData.obligFranchiseurFormationContinue} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurFormationContinue: e.target.value})} placeholder="Sessions de mise à jour, nouvelles techniques..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Assistance technique *</Label><Textarea value={franchiseData.obligFranchiseurAssistanceTechnique} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurAssistanceTechnique: e.target.value})} placeholder="Hotline, visites sur site, fréquence..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Assistance commerciale</Label><Textarea value={franchiseData.obligFranchiseurAssistanceCommerciale} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurAssistanceCommerciale: e.target.value})} placeholder="Aide au lancement, outils marketing..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Actions publicitaires nationales</Label><Textarea value={franchiseData.obligFranchiseurPubliciteNationale} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurPubliciteNationale: e.target.value})} placeholder="Campagnes prévues, budget, médias..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Recherche & développement</Label><Textarea value={franchiseData.obligFranchiseurRD} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurRD: e.target.value})} placeholder="Innovation, nouveaux produits/services..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Manuel opératoire</Label><RadioGroup value={franchiseData.obligFranchiseurManuelOperatoire} onValueChange={(val) => setFranchiseData({...franchiseData, obligFranchiseurManuelOperatoire: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="fourni" />Fourni</label><label className="flex items-center gap-2"><RadioGroupItem value="en_cours" />En cours d'élaboration</label></div></RadioGroup></div>
                  
                  <div><Label>Autres obligations du franchiseur</Label><Textarea value={franchiseData.obligFranchiseurAutres} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseurAutres: e.target.value})} placeholder="Obligations spécifiques..." className="min-h-[60px]" /></div>
                </div>

                {/* 6. OBLIGATIONS DU FRANCHISÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations du franchisé</h4>
                  
                  <div><Label>Respect du concept *</Label><Textarea value={franchiseData.obligFranchiseRespectConcept} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseRespectConcept: e.target.value})} placeholder="Appliquer le concept, les méthodes, l'image de marque..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Utilisation des signes distinctifs</Label><Textarea value={franchiseData.obligFranchiseSignesDistinctifs} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseSignesDistinctifs: e.target.value})} placeholder="Modalités d'usage de la marque, enseigne, logos..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Respect des normes de qualité *</Label><Textarea value={franchiseData.obligFranchiseNormesQualite} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseNormesQualite: e.target.value})} placeholder="Standards de produits, services, accueil client..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Approvisionnement</Label><Textarea value={franchiseData.obligFranchiseApprovisionnement} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseApprovisionnement: e.target.value})} placeholder="Fournisseurs imposés, centrales d'achat..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Participation aux actions marketing</Label><Textarea value={franchiseData.obligFranchiseMarketing} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseMarketing: e.target.value})} placeholder="Campagnes locales, promotions, événements..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Communication d'informations *</Label><Textarea value={franchiseData.obligFranchiseCommunicationInfos} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseCommunicationInfos: e.target.value})} placeholder="Rapports mensuels, CA, stocks, incidents..." className="min-h-[80px]" /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Fréquence des rapports</Label><Select value={franchiseData.obligFranchiseFrequenceRapports} onValueChange={(val) => setFranchiseData({...franchiseData, obligFranchiseFrequenceRapports: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="mensuelle">Mensuelle</SelectItem><SelectItem value="trimestrielle">Trimestrielle</SelectItem><SelectItem value="annuelle">Annuelle</SelectItem></SelectContent></Select></div>
                    
                    <div><Label>Contrôles / audits</Label><RadioGroup value={franchiseData.obligFranchiseControles} onValueChange={(val) => setFranchiseData({...franchiseData, obligFranchiseControles: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="annonces" />Annoncés</label><label className="flex items-center gap-2"><RadioGroupItem value="surprises" />Surprises</label><label className="flex items-center gap-2"><RadioGroupItem value="mixte" />Mixte</label></div></RadioGroup></div>
                  </div>
                  
                  <div><Label>Formation du personnel</Label><Textarea value={franchiseData.obligFranchiseFormationPersonnel} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseFormationPersonnel: e.target.value})} placeholder="Obligation de former le personnel aux standards du réseau..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Autres obligations du franchisé</Label><Textarea value={franchiseData.obligFranchiseAutres} onChange={(e) => setFranchiseData({...franchiseData, obligFranchiseAutres: e.target.value})} placeholder="Obligations spécifiques..." className="min-h-[60px]" /></div>
                </div>

                {/* 7. REDEVANCES - SECTION CENTRALE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Redevances (élément central du contrat)</h4>
                  
                  <div className="bg-blue-100/50 border border-blue-300 rounded-lg p-3 text-sm">
                    <p className="font-semibold text-blue-800">💶 Structure financière du contrat</p>
                    <p className="text-gray-700 mt-1">Les redevances constituent la contrepartie des droits et de l'assistance fournis par le franchiseur.</p>
                  </div>
                  
                  {/* Droit d'entrée */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-blue-700">💰 Droit d'entrée (redevance initiale forfaitaire)</h5>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Montant du droit d'entrée HT *</Label><Input value={franchiseData.redevanceDroitEntree} onChange={(e) => setFranchiseData({...franchiseData, redevanceDroitEntree: e.target.value})} placeholder="Ex: 30 000 €" /></div>
                      <div><Label>Conditions de paiement</Label><Select value={franchiseData.redevanceDroitEntreeConditions} onValueChange={(val) => setFranchiseData({...franchiseData, redevanceDroitEntreeConditions: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="comptant_signature">Comptant à la signature</SelectItem><SelectItem value="echelonne">Paiement échelonné</SelectItem><SelectItem value="avant_formation">Avant la formation initiale</SelectItem></SelectContent></Select></div>
                      <div className="md:col-span-2"><Label>Ce que couvre le droit d'entrée</Label><Textarea value={franchiseData.redevanceDroitEntreeCouvre} onChange={(e) => setFranchiseData({...franchiseData, redevanceDroitEntreeCouvre: e.target.value})} placeholder="Ex: Formation initiale, assistance au lancement, manuel opératoire..." className="min-h-[60px]" /></div>
                    </div>
                  </div>
                  
                  {/* Redevances périodiques */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">🔄 Redevances périodiques (royalties)</h5>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Type de redevance *</Label><Select value={franchiseData.redevancePeriodiqueType} onValueChange={(val) => setFranchiseData({...franchiseData, redevancePeriodiqueType: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="pourcentage_ca">% du CA HT</SelectItem><SelectItem value="forfaitaire">Forfaitaire</SelectItem><SelectItem value="mixte">Mixte</SelectItem></SelectContent></Select></div>
                      
                      <div><Label>Montant / Pourcentage *</Label><Input value={franchiseData.redevancePeriodiqueMontant} onChange={(e) => setFranchiseData({...franchiseData, redevancePeriodiqueMontant: e.target.value})} placeholder="Ex: 5% ou 1000 € / mois" /></div>
                      
                      <div><Label>Fréquence de paiement</Label><Select value={franchiseData.redevancePeriodiqueFrequence} onValueChange={(val) => setFranchiseData({...franchiseData, redevancePeriodiqueFrequence: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="mensuelle">Mensuelle</SelectItem><SelectItem value="trimestrielle">Trimestrielle</SelectItem><SelectItem value="annuelle">Annuelle</SelectItem></SelectContent></Select></div>
                      
                      <div><Label>Minimum garanti (le cas échéant)</Label><Input value={franchiseData.redevancePeriodiqueMinimum} onChange={(e) => setFranchiseData({...franchiseData, redevancePeriodiqueMinimum: e.target.value})} placeholder="Ex: 500 € minimum même si CA faible" /></div>
                      
                      <div className="md:col-span-2"><Label>Base de calcul (si % du CA)</Label><Textarea value={franchiseData.redevancePeriodiqueBaseCalcul} onChange={(e) => setFranchiseData({...franchiseData, redevancePeriodiqueBaseCalcul: e.target.value})} placeholder="Ex: CA HT, toutes activités confondues..." className="min-h-[60px]" /></div>
                    </div>
                  </div>
                  
                  {/* Redevances marketing */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">📢 Redevance marketing / publicité</h5>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Redevance marketing</Label><Input value={franchiseData.redevanceMarketing} onChange={(e) => setFranchiseData({...franchiseData, redevanceMarketing: e.target.value})} placeholder="Ex: 2% du CA HT" /></div>
                      <div><Label>Destination des fonds</Label><Input value={franchiseData.redevanceMarketingDestination} onChange={(e) => setFranchiseData({...franchiseData, redevanceMarketingDestination: e.target.value})} placeholder="Ex: Fonds commun publicitaire" /></div>
                    </div>
                  </div>
                </div>

                {/* 8. CONDITIONS FINANCIÈRES ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Conditions financières annexes</h4>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Investissement initial estimé</Label><Input value={franchiseData.conditionsInvestissementInitial} onChange={(e) => setFranchiseData({...franchiseData, conditionsInvestissementInitial: e.target.value})} placeholder="Ex: 150 000 € (travaux, stock, matériel...)" /></div>
                    
                    <div><Label>Cautionnement / garantie bancaire</Label><Input value={franchiseData.conditionsCautionnement} onChange={(e) => setFranchiseData({...franchiseData, conditionsCautionnement: e.target.value})} placeholder="Ex: 20 000 €" /></div>
                  </div>
                  
                  <div><Label>Conditions de révision des redevances</Label><Textarea value={franchiseData.conditionsRevision} onChange={(e) => setFranchiseData({...franchiseData, conditionsRevision: e.target.value})} placeholder="Indexation, révision annuelle, conditions..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Pénalités de retard</Label><Textarea value={franchiseData.conditionsPenalites} onChange={(e) => setFranchiseData({...franchiseData, conditionsPenalites: e.target.value})} placeholder="Ex: Intérêts de retard à 10% + indemnité forfaitaire..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Autres conditions financières</Label><Textarea value={franchiseData.conditionsAutres} onChange={(e) => setFranchiseData({...franchiseData, conditionsAutres: e.target.value})} placeholder="Frais divers, contributions..." className="min-h-[60px]" /></div>
                </div>

                {/* 9. LOCAL COMMERCIAL */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Local commercial et aménagement</h4>
                  
                  <div><Label>Adresse du local</Label><Input value={franchiseData.localAdresse} onChange={(e) => setFranchiseData({...franchiseData, localAdresse: e.target.value})} placeholder="Adresse complète du point de vente..." /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Superficie (m²)</Label><Input type="number" value={franchiseData.localSuperficie} onChange={(e) => setFranchiseData({...franchiseData, localSuperficie: e.target.value})} placeholder="Ex: 120" /></div>
                    <div><Label>Type de bail</Label><Select value={franchiseData.localTypeBail} onValueChange={(val) => setFranchiseData({...franchiseData, localTypeBail: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="commercial_3_6_9">Commercial 3-6-9</SelectItem><SelectItem value="precaire">Précaire</SelectItem><SelectItem value="propriete">Propriété</SelectItem></SelectContent></Select></div>
                  </div>
                  
                  <div><Label>Approbation du local par franchiseur</Label><RadioGroup value={franchiseData.localApprobationFranchiseur} onValueChange={(val) => setFranchiseData({...franchiseData, localApprobationFranchiseur: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="obligatoire" />Obligatoire</label><label className="flex items-center gap-2"><RadioGroupItem value="conseille" />Conseillée</label><label className="flex items-center gap-2"><RadioGroupItem value="non_requise" />Non requise</label></div></RadioGroup></div>
                  
                  <div><Label>Normes d'aménagement *</Label><Textarea value={franchiseData.localNormesAmenagement} onChange={(e) => setFranchiseData({...franchiseData, localNormesAmenagement: e.target.value})} placeholder="Standards d'aménagement, charte architecturale, signalétique..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Travaux à la charge du franchisé</Label><Textarea value={franchiseData.localTravauxCharge} onChange={(e) => setFranchiseData({...franchiseData, localTravauxCharge: e.target.value})} placeholder="Aménagement, mise aux normes, décoration..." className="min-h-[60px]" /></div>
                </div>

                {/* 10. MARKETING & COMMUNICATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟 Marketing et communication</h4>
                  
                  <div><Label>Actions marketing nationales *</Label><Textarea value={franchiseData.marketingActionsNationales} onChange={(e) => setFranchiseData({...franchiseData, marketingActionsNationales: e.target.value})} placeholder="Campagnes TV, radio, digitales prévues par le franchiseur..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Actions marketing locales</Label><Textarea value={franchiseData.marketingActionsLocales} onChange={(e) => setFranchiseData({...franchiseData, marketingActionsLocales: e.target.value})} placeholder="Liberté ou obligations du franchisé en matière de marketing local..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Supports fournis</Label><Textarea value={franchiseData.marketingSupports} onChange={(e) => setFranchiseData({...franchiseData, marketingSupports: e.target.value})} placeholder="PLV, affiches, flyers, réseaux sociaux..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Contrôle de la communication</Label><RadioGroup value={franchiseData.marketingControle} onValueChange={(val) => setFranchiseData({...franchiseData, marketingControle: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="validation_prealable" />Validation préalable</label><label className="flex items-center gap-2"><RadioGroupItem value="respect_charte" />Respect de la charte</label><label className="flex items-center gap-2"><RadioGroupItem value="libre" />Libre</label></div></RadioGroup></div>
                  
                  <div><Label>Présence digitale (site web, réseaux sociaux)</Label><Textarea value={franchiseData.marketingDigital} onChange={(e) => setFranchiseData({...franchiseData, marketingDigital: e.target.value})} placeholder="Site propre autorisé ? Page franchiseur ? Présence réseaux sociaux..." className="min-h-[60px]" /></div>
                </div>

                {/* 11. SAVOIR-FAIRE & MANUEL OPÉRATOIRE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Savoir-faire et manuel opératoire</h4>
                  
                  <div><Label>Description détaillée du savoir-faire *</Label><Textarea value={franchiseData.savoirFaireDescription} onChange={(e) => setFranchiseData({...franchiseData, savoirFaireDescription: e.target.value})} placeholder="Techniques, procédés, méthodes commerciales..." className="min-h-[100px]" /></div>
                  
                  <div><Label>Contenu du manuel opératoire *</Label><Textarea value={franchiseData.savoirFaireManuel} onChange={(e) => setFranchiseData({...franchiseData, savoirFaireManuel: e.target.value})} placeholder="Procédures, process, standards..." className="min-h-[80px]" /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Mise à jour du manuel</Label><Select value={franchiseData.savoirFaireMiseAJour} onValueChange={(val) => setFranchiseData({...franchiseData, savoirFaireMiseAJour: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="annuelle">Annuelle</SelectItem><SelectItem value="semestrielle">Semestrielle</SelectItem><SelectItem value="au_besoin">Au besoin</SelectItem></SelectContent></Select></div>
                    
                    <div><Label>Support du manuel</Label><Select value={franchiseData.savoirFaireSupport} onValueChange={(val) => setFranchiseData({...franchiseData, savoirFaireSupport: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="papier">Papier</SelectItem><SelectItem value="numerique">Numérique</SelectItem><SelectItem value="plateforme">Plateforme en ligne</SelectItem></SelectContent></Select></div>
                  </div>
                  
                  <SingleFileUpload
                    label="Manuel opératoire"
                    files={franchiseManuelOperatoireFiles}
                    onFilesChange={setFranchiseManuelOperatoireFiles}
                    accept=".pdf,.doc,.docx"
                    role="avocat"
                  />
                </div>

                {/* 12. PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  
                  <div><Label>Marques, logos, signes distinctifs *</Label><Textarea value={franchiseData.piMarques} onChange={(e) => setFranchiseData({...franchiseData, piMarques: e.target.value})} placeholder="Liste des marques déposées, n° INPI..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Droits d'utilisation accordés *</Label><Textarea value={franchiseData.piDroitsUtilisation} onChange={(e) => setFranchiseData({...franchiseData, piDroitsUtilisation: e.target.value})} placeholder="Licence d'utilisation, limites, conditions..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Protection des créations du franchisé</Label><Textarea value={franchiseData.piProtectionCreations} onChange={(e) => setFranchiseData({...franchiseData, piProtectionCreations: e.target.value})} placeholder="Qui détient la PI sur les créations réalisées durant l'exploitation ?" className="min-h-[60px]" /></div>
                  
                  <div><Label>Droit de suite (après contrat)</Label><Textarea value={franchiseData.piDroitSuite} onChange={(e) => setFranchiseData({...franchiseData, piDroitSuite: e.target.value})} placeholder="Utilisation de la marque après la fin du contrat..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Sanctions en cas d'usage non autorisé</Label><Textarea value={franchiseData.piSanctions} onChange={(e) => setFranchiseData({...franchiseData, piSanctions: e.target.value})} placeholder="Résiliation, dommages et intérêts..." className="min-h-[60px]" /></div>
                </div>

                {/* 13. CONFIDENTIALITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Confidentialité</h4>
                  
                  <div><Label>Informations confidentielles *</Label><Textarea value={franchiseData.confidentialiteInformations} onChange={(e) => setFranchiseData({...franchiseData, confidentialiteInformations: e.target.value})} placeholder="Savoir-faire, données commerciales, fichiers clients, fournisseurs..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Durée de l'obligation de confidentialité *</Label><Select value={franchiseData.confidentialiteDuree} onValueChange={(val) => setFranchiseData({...franchiseData, confidentialiteDuree: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="duree_contrat">Pendant la durée du contrat uniquement</SelectItem><SelectItem value="duree_contrat_plus_2">Pendant + 2 ans après</SelectItem><SelectItem value="duree_contrat_plus_5">Pendant + 5 ans après</SelectItem><SelectItem value="perpetuelle">Perpétuelle</SelectItem></SelectContent></Select></div>
                  
                  <div><Label>Sanctions en cas de violation *</Label><Textarea value={franchiseData.confidentialiteSanctions} onChange={(e) => setFranchiseData({...franchiseData, confidentialiteSanctions: e.target.value})} placeholder="Résiliation, dommages et intérêts..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Exceptions à la confidentialité</Label><Textarea value={franchiseData.confidentialiteExceptions} onChange={(e) => setFranchiseData({...franchiseData, confidentialiteExceptions: e.target.value})} placeholder="Informations déjà publiques, obligations légales..." className="min-h-[60px]" /></div>
                </div>

                {/* 14. NON-CONCURRENCE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Non-concurrence</h4>
                  
                  <div><Label>Clause de non-concurrence pendant le contrat *</Label><Textarea value={franchiseData.nonConcurrencePendant} onChange={(e) => setFranchiseData({...franchiseData, nonConcurrencePendant: e.target.value})} placeholder="Interdiction d'exploiter un concept concurrent, périmètre..." className="min-h-[80px]" /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Clause post-contractuelle</Label><RadioGroup value={franchiseData.nonConcurrencePost} onValueChange={(val) => setFranchiseData({...franchiseData, nonConcurrencePost: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="oui" />Oui</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non</label></div></RadioGroup></div>
                    
                    <div><Label>Durée post-contractuelle</Label><Select value={franchiseData.nonConcurrenceDureePost} onValueChange={(val) => setFranchiseData({...franchiseData, nonConcurrenceDureePost: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="1_an">1 an</SelectItem><SelectItem value="2_ans">2 ans</SelectItem><SelectItem value="3_ans">3 ans</SelectItem></SelectContent></Select></div>
                  </div>
                  
                  <div><Label>Zone géographique de non-concurrence post-contrat</Label><Input value={franchiseData.nonConcurrenceZone} onChange={(e) => setFranchiseData({...franchiseData, nonConcurrenceZone: e.target.value})} placeholder="Ex: Rayon de 50 km autour du local..." /></div>
                  
                  <div><Label>Contrepartie financière (le cas échéant)</Label><Input value={franchiseData.nonConcurrenceContrepartie} onChange={(e) => setFranchiseData({...franchiseData, nonConcurrenceContrepartie: e.target.value})} placeholder="Indemnité versée au franchisé en échange de la clause..." /></div>
                </div>

                {/* 15. RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Responsabilité</h4>
                  
                  <div><Label>Responsabilité du franchiseur</Label><Textarea value={franchiseData.responsabiliteFranchiseur} onChange={(e) => setFranchiseData({...franchiseData, responsabiliteFranchiseur: e.target.value})} placeholder="Limites, exclusions (ex: actes du franchisé)..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Responsabilité du franchisé *</Label><Textarea value={franchiseData.responsabiliteFranchise} onChange={(e) => setFranchiseData({...franchiseData, responsabiliteFranchise: e.target.value})} placeholder="Engagement du franchisé comme entrepreneur indépendant..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Assurance responsabilité civile professionnelle *</Label><RadioGroup value={franchiseData.responsabiliteAssurance} onValueChange={(val) => setFranchiseData({...franchiseData, responsabiliteAssurance: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="obligatoire" />Obligatoire</label><label className="flex items-center gap-2"><RadioGroupItem value="recommandee" />Recommandée</label></div></RadioGroup></div>
                  
                  <div><Label>Autres dispositions sur la responsabilité</Label><Textarea value={franchiseData.responsabiliteAutres} onChange={(e) => setFranchiseData({...franchiseData, responsabiliteAutres: e.target.value})} placeholder="Clauses limitatives, responsabilité solidaire..." className="min-h-[60px]" /></div>
                </div>

                {/* 16. DURÉE DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Durée du contrat</h4>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Date de prise d'effet *</Label><Input type="date" value={franchiseData.dureeDateDebut} onChange={(e) => setFranchiseData({...franchiseData, dureeDateDebut: e.target.value})} /></div>
                    
                    <div><Label>Durée initiale *</Label><Input value={franchiseData.dureeDureeInitiale} onChange={(e) => setFranchiseData({...franchiseData, dureeDureeInitiale: e.target.value})} placeholder="Ex: 5 ans, 7 ans..." /></div>
                  </div>
                  
                  <div><Label>Renouvellement *</Label><RadioGroup value={franchiseData.dureeRenouvellement} onValueChange={(val) => setFranchiseData({...franchiseData, dureeRenouvellement: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="tacite" />Tacite (reconduction automatique)</label><label className="flex items-center gap-2"><RadioGroupItem value="expres" />Exprès (accord des parties)</label><label className="flex items-center gap-2"><RadioGroupItem value="non_renouvelable" />Non renouvelable</label></div></RadioGroup></div>
                </div>

                {/* 17. RÉSILIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Résiliation et rupture</h4>
                  
                  <div><Label>Résiliation pour faute grave *</Label><Textarea value={franchiseData.resiliationFauteGrave} onChange={(e) => setFranchiseData({...franchiseData, resiliationFauteGrave: e.target.value})} placeholder="Cas de résiliation immédiate : non-paiement, manquement grave..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Résiliation pour manquement non grave</Label><Textarea value={franchiseData.resiliationManquement} onChange={(e) => setFranchiseData({...franchiseData, resiliationManquement: e.target.value})} placeholder="Mise en demeure, délai de régularisation..." className="min-h-[60px]" /></div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div><Label>Résiliation amiable</Label><RadioGroup value={franchiseData.resiliationAmiable} onValueChange={(val) => setFranchiseData({...franchiseData, resiliationAmiable: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="possible" />Possible</label><label className="flex items-center gap-2"><RadioGroupItem value="conditions" />Sous conditions</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non prévue</label></div></RadioGroup></div>
                    
                    <div><Label>Préavis de résiliation</Label><Input value={franchiseData.resiliationPreavis} onChange={(e) => setFranchiseData({...franchiseData, resiliationPreavis: e.target.value})} placeholder="Ex: 6 mois, 1 an..." /></div>
                  </div>
                  
                  <div><Label>Effets de la résiliation *</Label><Textarea value={franchiseData.resiliationEffets} onChange={(e) => setFranchiseData({...franchiseData, resiliationEffets: e.target.value})} placeholder="Cessation immédiate usage marque, restitution manuel, désaffiliation..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Indemnités en cas de résiliation</Label><Textarea value={franchiseData.resiliationIndemnites} onChange={(e) => setFranchiseData({...franchiseData, resiliationIndemnites: e.target.value})} placeholder="Dommages et intérêts, pénalités..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Sort des stocks et matériel</Label><Textarea value={franchiseData.resiliationStocksMateriel} onChange={(e) => setFranchiseData({...franchiseData, resiliationStocksMateriel: e.target.value})} placeholder="Rachat par franchiseur ? Écoulement des stocks ?" className="min-h-[60px]" /></div>
                  
                  <div><Label>Désidentification *</Label><Textarea value={franchiseData.resiliationDesidentification} onChange={(e) => setFranchiseData({...franchiseData, resiliationDesidentification: e.target.value})} placeholder="Obligation de retirer enseigne, logos, tout signe distinctif..." className="min-h-[60px]" /></div>
                  
                  <div><Label>Autres conditions de résiliation</Label><Textarea value={franchiseData.resiliationAutres} onChange={(e) => setFranchiseData({...franchiseData, resiliationAutres: e.target.value})} placeholder="Conditions spécifiques..." className="min-h-[60px]" /></div>
                </div>

                {/* 18. VENTE / CESSION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Cession du contrat</h4>
                  
                  <div><Label>Possibilité de cession *</Label><RadioGroup value={franchiseData.cessionPossibilite} onValueChange={(val) => setFranchiseData({...franchiseData, cessionPossibilite: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="accord_franchiseur" />Avec accord du franchiseur</label><label className="flex items-center gap-2"><RadioGroupItem value="libre" />Libre</label><label className="flex items-center gap-2"><RadioGroupItem value="interdite" />Interdite</label></div></RadioGroup></div>
                  
                  <div><Label>Procédure d'agrément du cessionnaire</Label><Textarea value={franchiseData.cessionProcedure} onChange={(e) => setFranchiseData({...franchiseData, cessionProcedure: e.target.value})} placeholder="Dossier à fournir, entretien, formation préalable..." className="min-h-[80px]" /></div>
                  
                  <div><Label>Droit de préemption du franchiseur</Label><RadioGroup value={franchiseData.cessionPreemption} onValueChange={(val) => setFranchiseData({...franchiseData, cessionPreemption: val})}><div className="flex gap-4"><label className="flex items-center gap-2"><RadioGroupItem value="oui" />Oui</label><label className="flex items-center gap-2"><RadioGroupItem value="non" />Non</label></div></RadioGroup></div>
                  
                  <div><Label>Frais de cession</Label><Input value={franchiseData.cessionFrais} onChange={(e) => setFranchiseData({...franchiseData, cessionFrais: e.target.value})} placeholder="Ex: 5000 € de frais d'agrément..." /></div>
                </div>

                {/* 19. DROIT APPLICABLE & LITIGES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Droit applicable et litiges</h4>
                  
                  <div><Label>Droit applicable *</Label><Select value={franchiseData.droitApplicable} onValueChange={(val) => setFranchiseData({...franchiseData, droitApplicable: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="francais">Droit français</SelectItem><SelectItem value="autre">Autre droit</SelectItem></SelectContent></Select></div>
                  
                  {franchiseData.droitApplicable === "autre" && (
                    <div><Label>Préciser le droit applicable</Label><Input value={franchiseData.droitApplicableAutre || ""} onChange={(e) => setFranchiseData({...franchiseData, droitApplicableAutre: e.target.value})} placeholder="Ex: Droit suisse, droit belge..." /></div>
                  )}
                  
                  <div><Label>Mode de résolution des litiges *</Label><Select value={franchiseData.droitModeResolution} onValueChange={(val) => setFranchiseData({...franchiseData, droitModeResolution: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="mediation">Médiation préalable</SelectItem><SelectItem value="conciliation">Conciliation</SelectItem><SelectItem value="arbitrage">Arbitrage</SelectItem><SelectItem value="tribunaux">Tribunaux compétents</SelectItem></SelectContent></Select></div>
                  
                  <div><Label>Juridiction compétente</Label><Input value={franchiseData.droitJuridiction} onChange={(e) => setFranchiseData({...franchiseData, droitJuridiction: e.target.value})} placeholder="Ex: Tribunal de commerce de Paris" /></div>
                  
                  <div><Label>Autres clauses juridiques</Label><Textarea value={franchiseData.droitAutres} onChange={(e) => setFranchiseData({...franchiseData, droitAutres: e.target.value})} placeholder="Clauses diverses..." className="min-h-[60px]" /></div>
                </div>

                {/* 20. ANNEXES OBLIGATOIRES - 14 UPLOAD ZONES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes obligatoires</h4>
                  
                  <div className="space-y-3">
                    <SingleFileUpload
                      label="Charte graphique et identité visuelle"
                      files={franchiseCharteGraphiqueFiles}
                      onFilesChange={setFranchiseCharteGraphiqueFiles}
                      accept=".pdf,.zip"
                      role="avocat"
                    />
                    
                    <SingleFileUpload
                      label="Plans et normes d'agencement du local"
                      files={franchisePlansAgencementFiles}
                      onFilesChange={setFranchisePlansAgencementFiles}
                      accept=".pdf,.dwg,.zip"
                      role="avocat"
                    />
                    
                    <SingleFileUpload
                      label="Grilles tarifaires et barèmes"
                      files={franchiseTarifsFiles}
                      onFilesChange={setFranchiseTarifsFiles}
                      accept=".pdf,.xls,.xlsx"
                      role="avocat"
                    />
                    
                    <SingleFileUpload
                      label="Attestations de formation"
                      files={franchiseAttestationFormationFiles}
                      onFilesChange={setFranchiseAttestationFormationFiles}
                      accept=".pdf"
                      role="avocat"
                    />
                  </div>
                </div>

                {/* 21. OBSERVATIONS FINALES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Observations finales</h4>
                  
                  <div><Label>Observations finales / clauses particulières</Label><Textarea value={franchiseData.observationsFinales} onChange={(e) => setFranchiseData({...franchiseData, observationsFinales: e.target.value})} placeholder="Remarques, conditions suspensives, clauses spécifiques..." className="min-h-[100px]" /></div>
                </div>
                
                {/* Boutons d'action */}
                <div className="flex gap-3 pt-4">
                  <Button type="button" onClick={handleCreateFranchiseContract} disabled={!franchiseData.franchiseurDenomination || !franchiseData.franchiseNom || !franchiseData.redevanceDroitEntree || !franchiseData.objetConcept}>
                    Créer le contrat de franchise
                  </Button>
                  <Button type="button" variant="outline" onClick={() => setPendingContractType("")}>
                    Annuler
                  </Button>
                </div>
              </div>
            )}

            {/* Formulaire complet pour Contrat de partenariat / coopération */}
            {pendingContractType === "Contrat de partenariat / coopération" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🤝 Contrat de partenariat / coopération</h3>
                
                {/* 1. IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification des parties</h4>
                  
                  {/* Partie 1 */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-semibold text-gray-700 mb-3">Partie 1</h5>
                    <ClientSelector
                      clients={clients}
                      selectedClientId={partenariatClientId1}
                      onClientChange={(clientId) => {
                        setPartenariatClientId1(clientId);
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setPartenariatData({
                              ...partenariatData,
                              partie1Nom: client.prenom && client.nom ? `${client.prenom} ${client.nom}` : (client.denomination_sociale || ""),
                              partie1Coordonnees: client.email || "",
                            });
                          }
                        } else {
                          setPartenariatData({
                            ...partenariatData,
                            partie1Nom: "",
                            partie1Coordonnees: "",
                          });
                        }
                      }}
                      label="Sélectionner un client existant (optionnel) - Partie 1"
                    />
                    <div>
                      <Label>Nom / Dénomination sociale *</Label>
                      <Input value={partenariatData.partie1Nom} onChange={(e) => setPartenariatData({...partenariatData, partie1Nom: e.target.value})} placeholder="Ex: Société ABC, Jean Dupont..." />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Forme juridique</Label>
                        <Select value={partenariatData.partie1FormeJuridique} onValueChange={(val) => setPartenariatData({...partenariatData, partie1FormeJuridique: val})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="SAS">SAS</SelectItem>
                            <SelectItem value="SARL">SARL</SelectItem>
                            <SelectItem value="SA">SA</SelectItem>
                            <SelectItem value="EURL">EURL</SelectItem>
                            <SelectItem value="SCI">SCI</SelectItem>
                            <SelectItem value="Association">Association</SelectItem>
                            <SelectItem value="Entrepreneur individuel">Entrepreneur individuel</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Capital social</Label>
                        <Input value={partenariatData.partie1Capital} onChange={(e) => setPartenariatData({...partenariatData, partie1Capital: e.target.value})} placeholder="Ex: 10 000 €" />
                      </div>
                    </div>
                    <div>
                      <Label>Adresse du siège social</Label>
                      <Input value={partenariatData.partie1Siege} onChange={(e) => setPartenariatData({...partenariatData, partie1Siege: e.target.value})} placeholder="Adresse complète" />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>RCS / SIREN</Label>
                        <Input value={partenariatData.partie1RCS} onChange={(e) => setPartenariatData({...partenariatData, partie1RCS: e.target.value})} placeholder="Ex: RCS Paris 123 456 789" />
                      </div>
                      <div>
                        <Label>Secteur d'activité</Label>
                        <Input value={partenariatData.partie1Secteur} onChange={(e) => setPartenariatData({...partenariatData, partie1Secteur: e.target.value})} placeholder="Ex: Tech, Industrie..." />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Nom du représentant légal</Label>
                        <Input value={partenariatData.partie1RepresentantNom} onChange={(e) => setPartenariatData({...partenariatData, partie1RepresentantNom: e.target.value})} placeholder="Nom complet" />
                      </div>
                      <div>
                        <Label>Fonction du représentant</Label>
                        <Input value={partenariatData.partie1RepresentantFonction} onChange={(e) => setPartenariatData({...partenariatData, partie1RepresentantFonction: e.target.value})} placeholder="Ex: Président, Gérant..." />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Coordonnées professionnelles</Label>
                        <Input value={partenariatData.partie1Coordonnees} onChange={(e) => setPartenariatData({...partenariatData, partie1Coordonnees: e.target.value})} placeholder="Email, téléphone..." />
                      </div>
                      <div>
                        <Label>Site web (optionnel)</Label>
                        <Input value={partenariatData.partie1SiteWeb} onChange={(e) => setPartenariatData({...partenariatData, partie1SiteWeb: e.target.value})} placeholder="https://..." />
                      </div>
                    </div>
                    <div>
                      <Label>Assurance RC Pro</Label>
                      <Input value={partenariatData.partie1Assurance} onChange={(e) => setPartenariatData({...partenariatData, partie1Assurance: e.target.value})} placeholder="N° de police, assureur..." />
                    </div>
                    <SingleFileUpload
                      label="Kbis (partie 1)"
                      files={partenariat1KbisFiles}
                      onFilesChange={setPartenariat1KbisFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Pièce d'identité du signataire (partie 1)"
                      files={partenariat1IdentiteFiles}
                      onFilesChange={setPartenariat1IdentiteFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Statuts (partie 1)"
                      files={partenariat1StatutsFiles}
                      onFilesChange={setPartenariat1StatutsFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Pouvoir de signature (partie 1)"
                      files={partenariat1PouvoirFiles}
                      onFilesChange={setPartenariat1PouvoirFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Attestation d'assurance (partie 1)"
                      files={partenariat1AssuranceFiles}
                      onFilesChange={setPartenariat1AssuranceFiles}
                      role="avocat"
                    />
                  </div>
                  
                  {/* Partie 2 */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-semibold text-gray-700 mb-3">Partie 2</h5>
                    <ClientSelector
                      clients={clients}
                      selectedClientId={partenariatClientId2}
                      onClientChange={(clientId) => {
                        setPartenariatClientId2(clientId);
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setPartenariatData({
                              ...partenariatData,
                              partie2Nom: client.prenom && client.nom ? `${client.prenom} ${client.nom}` : (client.denomination_sociale || ""),
                              partie2Coordonnees: client.email || "",
                            });
                          }
                        } else {
                          setPartenariatData({
                            ...partenariatData,
                            partie2Nom: "",
                            partie2Coordonnees: "",
                          });
                        }
                      }}
                      label="Sélectionner un client existant (optionnel) - Partie 2"
                    />
                    <div>
                      <Label>Nom / Dénomination sociale *</Label>
                      <Input value={partenariatData.partie2Nom} onChange={(e) => setPartenariatData({...partenariatData, partie2Nom: e.target.value})} placeholder="Ex: Société XYZ, Marie Martin..." />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Forme juridique</Label>
                        <Select value={partenariatData.partie2FormeJuridique} onValueChange={(val) => setPartenariatData({...partenariatData, partie2FormeJuridique: val})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="SAS">SAS</SelectItem>
                            <SelectItem value="SARL">SARL</SelectItem>
                            <SelectItem value="SA">SA</SelectItem>
                            <SelectItem value="EURL">EURL</SelectItem>
                            <SelectItem value="SCI">SCI</SelectItem>
                            <SelectItem value="Association">Association</SelectItem>
                            <SelectItem value="Entrepreneur individuel">Entrepreneur individuel</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Capital social</Label>
                        <Input value={partenariatData.partie2Capital} onChange={(e) => setPartenariatData({...partenariatData, partie2Capital: e.target.value})} placeholder="Ex: 50 000 €" />
                      </div>
                    </div>
                    <div>
                      <Label>Adresse du siège social</Label>
                      <Input value={partenariatData.partie2Siege} onChange={(e) => setPartenariatData({...partenariatData, partie2Siege: e.target.value})} placeholder="Adresse complète" />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>RCS / SIREN</Label>
                        <Input value={partenariatData.partie2RCS} onChange={(e) => setPartenariatData({...partenariatData, partie2RCS: e.target.value})} placeholder="Ex: RCS Lyon 987 654 321" />
                      </div>
                      <div>
                        <Label>Secteur d'activité</Label>
                        <Input value={partenariatData.partie2Secteur} onChange={(e) => setPartenariatData({...partenariatData, partie2Secteur: e.target.value})} placeholder="Ex: Marketing, Finance..." />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Nom du représentant légal</Label>
                        <Input value={partenariatData.partie2RepresentantNom} onChange={(e) => setPartenariatData({...partenariatData, partie2RepresentantNom: e.target.value})} placeholder="Nom complet" />
                      </div>
                      <div>
                        <Label>Fonction du représentant</Label>
                        <Input value={partenariatData.partie2RepresentantFonction} onChange={(e) => setPartenariatData({...partenariatData, partie2RepresentantFonction: e.target.value})} placeholder="Ex: Directeur général..." />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Coordonnées professionnelles</Label>
                        <Input value={partenariatData.partie2Coordonnees} onChange={(e) => setPartenariatData({...partenariatData, partie2Coordonnees: e.target.value})} placeholder="Email, téléphone..." />
                      </div>
                      <div>
                        <Label>Site web (optionnel)</Label>
                        <Input value={partenariatData.partie2SiteWeb} onChange={(e) => setPartenariatData({...partenariatData, partie2SiteWeb: e.target.value})} placeholder="https://..." />
                      </div>
                    </div>
                    <div>
                      <Label>Assurance RC Pro</Label>
                      <Input value={partenariatData.partie2Assurance} onChange={(e) => setPartenariatData({...partenariatData, partie2Assurance: e.target.value})} placeholder="N° de police, assureur..." />
                    </div>
                    <SingleFileUpload
                      label="Kbis (partie 2)"
                      files={partenariat2KbisFiles}
                      onFilesChange={setPartenariat2KbisFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Pièce d'identité du signataire (partie 2)"
                      files={partenariat2IdentiteFiles}
                      onFilesChange={setPartenariat2IdentiteFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Statuts (partie 2)"
                      files={partenariat2StatutsFiles}
                      onFilesChange={setPartenariat2StatutsFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Pouvoir de signature (partie 2)"
                      files={partenariat2PouvoirFiles}
                      onFilesChange={setPartenariat2PouvoirFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Attestation d'assurance (partie 2)"
                      files={partenariat2AssuranceFiles}
                      onFilesChange={setPartenariat2AssuranceFiles}
                      role="avocat"
                    />
                  </div>
                </div>

                {/* 2. OBJET DU PARTENARIAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du partenariat</h4>
                  <div>
                    <Label>Nature du partenariat * (sélection multiple possible)</Label>
                    <div className="grid grid-cols-2 gap-2 mt-2">
                      {[
                        "Co-développement",
                        "Coopération commerciale",
                        "Partenariat marketing",
                        "Développement territorial",
                        "Partage de ressources / compétences",
                        "Innovation / R&D",
                        "Partenariat institutionnel",
                        "Autre"
                      ].map((nature) => (
                        <label key={nature} className="flex items-center gap-2 p-2 border border-gray-200 rounded hover:bg-blue-50 cursor-pointer">
                          <input
                            type="checkbox"
                            checked={partenariatData.objetNature.includes(nature)}
                            onChange={(e) => {
                              const newNatures = e.target.checked
                                ? [...partenariatData.objetNature, nature]
                                : partenariatData.objetNature.filter(n => n !== nature);
                              setPartenariatData({...partenariatData, objetNature: newNatures});
                            }}
                            className="rounded"
                          />
                          <span className="text-sm">{nature}</span>
                        </label>
                      ))}
                    </div>
                  </div>
                  <div>
                    <Label>Finalités exactes du partenariat *</Label>
                    <Textarea value={partenariatData.objetFinalites} onChange={(e) => setPartenariatData({...partenariatData, objetFinalites: e.target.value})} placeholder="Décrire les objectifs précis du partenariat..." rows={3} />
                  </div>
                  <div>
                    <Label>Résultats attendus</Label>
                    <Textarea value={partenariatData.objetResultatsAttendus} onChange={(e) => setPartenariatData({...partenariatData, objetResultatsAttendus: e.target.value})} placeholder="Ex: Augmentation CA de 20%, lancement de 3 produits..." rows={3} />
                  </div>
                  <div>
                    <Label>Livrables éventuels</Label>
                    <Textarea value={partenariatData.objetLivrables} onChange={(e) => setPartenariatData({...partenariatData, objetLivrables: e.target.value})} placeholder="Ex: Rapport mensuel, prototype, application..." rows={2} />
                  </div>
                  <div>
                    <Label>Limites du partenariat</Label>
                    <Textarea value={partenariatData.objetLimites} onChange={(e) => setPartenariatData({...partenariatData, objetLimites: e.target.value})} placeholder="Préciser les limites géographiques, sectorielles, temporelles..." rows={2} />
                  </div>
                  <div>
                    <Label>Ce qui est expressément exclu</Label>
                    <Textarea value={partenariatData.objetExclusions} onChange={(e) => setPartenariatData({...partenariatData, objetExclusions: e.target.value})} placeholder="Ex: Pas de transfert de personnel, pas de garantie financière..." rows={2} />
                  </div>
                </div>

                {/* 3. RÔLES PARTIE 1 */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Rôles et responsabilités — Partie 1</h4>
                  <div>
                    <Label>Responsabilités</Label>
                    <Textarea value={partenariatData.partie1Responsabilites} onChange={(e) => setPartenariatData({...partenariatData, partie1Responsabilites: e.target.value})} placeholder="Décrire les responsabilités de la partie 1..." rows={2} />
                  </div>
                  <div>
                    <Label>Missions précises</Label>
                    <Textarea value={partenariatData.partie1Missions} onChange={(e) => setPartenariatData({...partenariatData, partie1Missions: e.target.value})} placeholder="Lister les missions confiées..." rows={2} />
                  </div>
                  <div>
                    <Label>Tâches à réaliser</Label>
                    <Textarea value={partenariatData.partie1Taches} onChange={(e) => setPartenariatData({...partenariatData, partie1Taches: e.target.value})} placeholder="Détailler les tâches opérationnelles..." rows={2} />
                  </div>
                  <div>
                    <Label>Ressources mises à disposition</Label>
                    <Textarea value={partenariatData.partie1RessourcesMises} onChange={(e) => setPartenariatData({...partenariatData, partie1RessourcesMises: e.target.value})} placeholder="Ex: 2 développeurs, locaux 100m², serveurs..." rows={2} />
                  </div>
                  <div>
                    <Label>Engagements opérationnels</Label>
                    <Textarea value={partenariatData.partie1EngagementsOperationnels} onChange={(e) => setPartenariatData({...partenariatData, partie1EngagementsOperationnels: e.target.value})} placeholder="Ex: Disponibilité 24/7, délai de réponse 48h..." rows={2} />
                  </div>
                  <div>
                    <Label>Délais / Calendrier</Label>
                    <Textarea value={partenariatData.partie1Delais} onChange={(e) => setPartenariatData({...partenariatData, partie1Delais: e.target.value})} placeholder="Planning prévisionnel des actions..." rows={2} />
                  </div>
                  <div>
                    <Label>Personne référente (contact dédié)</Label>
                    <Input value={partenariatData.partie1Referent} onChange={(e) => setPartenariatData({...partenariatData, partie1Referent: e.target.value})} placeholder="Nom, fonction, contact..." />
                  </div>
                </div>

                {/* 4. RÔLES PARTIE 2 */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Rôles et responsabilités — Partie 2</h4>
                  <div>
                    <Label>Responsabilités</Label>
                    <Textarea value={partenariatData.partie2Responsabilites} onChange={(e) => setPartenariatData({...partenariatData, partie2Responsabilites: e.target.value})} placeholder="Décrire les responsabilités de la partie 2..." rows={2} />
                  </div>
                  <div>
                    <Label>Missions précises</Label>
                    <Textarea value={partenariatData.partie2Missions} onChange={(e) => setPartenariatData({...partenariatData, partie2Missions: e.target.value})} placeholder="Lister les missions confiées..." rows={2} />
                  </div>
                  <div>
                    <Label>Tâches à réaliser</Label>
                    <Textarea value={partenariatData.partie2Taches} onChange={(e) => setPartenariatData({...partenariatData, partie2Taches: e.target.value})} placeholder="Détailler les tâches opérationnelles..." rows={2} />
                  </div>
                  <div>
                    <Label>Ressources mises à disposition</Label>
                    <Textarea value={partenariatData.partie2RessourcesMises} onChange={(e) => setPartenariatData({...partenariatData, partie2RessourcesMises: e.target.value})} placeholder="Ex: Budget marketing 50k€, base clients 10000..." rows={2} />
                  </div>
                  <div>
                    <Label>Engagements opérationnels</Label>
                    <Textarea value={partenariatData.partie2EngagementsOperationnels} onChange={(e) => setPartenariatData({...partenariatData, partie2EngagementsOperationnels: e.target.value})} placeholder="Ex: Livraisons mensuelles, reporting hebdomadaire..." rows={2} />
                  </div>
                  <div>
                    <Label>Délais / Calendrier</Label>
                    <Textarea value={partenariatData.partie2Delais} onChange={(e) => setPartenariatData({...partenariatData, partie2Delais: e.target.value})} placeholder="Planning prévisionnel des actions..." rows={2} />
                  </div>
                  <div>
                    <Label>Personne référente (contact dédié)</Label>
                    <Input value={partenariatData.partie2Referent} onChange={(e) => setPartenariatData({...partenariatData, partie2Referent: e.target.value})} placeholder="Nom, fonction, contact..." />
                  </div>
                </div>

                {/* 5. GOUVERNANCE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Gouvernance du partenariat</h4>
                  <div>
                    <Label>Comité de pilotage ?</Label>
                    <Select value={partenariatData.gouvernanceComitePilotage} onValueChange={(val) => setPartenariatData({...partenariatData, gouvernanceComitePilotage: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.gouvernanceComitePilotage === "oui" && (
                    <>
                      <div>
                        <Label>Composition du comité</Label>
                        <Textarea value={partenariatData.gouvernanceComposition} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceComposition: e.target.value})} placeholder="Ex: 2 représentants par partie, présidence alternée..." rows={2} />
                      </div>
                      <div>
                        <Label>Fréquence des réunions</Label>
                        <Input value={partenariatData.gouvernanceFrequence} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceFrequence: e.target.value})} placeholder="Ex: Trimestrielle, mensuelle..." />
                      </div>
                      <div>
                        <Label>Décisions à prendre en commun</Label>
                        <Textarea value={partenariatData.gouvernanceDecisionsCommunes} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceDecisionsCommunes: e.target.value})} placeholder="Ex: Budget >10k€, embauche, stratégie marketing..." rows={2} />
                      </div>
                    </>
                  )}
                  <div>
                    <Label>Processus décisionnel</Label>
                    <Textarea value={partenariatData.gouvernanceProcessusDecisionnel} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceProcessusDecisionnel: e.target.value})} placeholder="Ex: Unanimité pour décisions stratégiques, majorité pour décisions courantes..." rows={2} />
                  </div>
                  <div>
                    <Label>Droit de veto sur certains sujets ?</Label>
                    <Textarea value={partenariatData.gouvernanceDroitVeto} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceDroitVeto: e.target.value})} placeholder="Préciser les sujets donnant droit de veto..." rows={2} />
                  </div>
                  <div>
                    <Label>Rapports d'avancement</Label>
                    <Input value={partenariatData.gouvernanceRapports} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceRapports: e.target.value})} placeholder="Ex: Rapport mensuel écrit, présentation trimestrielle..." />
                  </div>
                  <div>
                    <Label>KPI / Indicateurs de performance</Label>
                    <Textarea value={partenariatData.gouvernanceKPI} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceKPI: e.target.value})} placeholder="Ex: Chiffre d'affaires commun, nombre de clients, satisfaction..." rows={2} />
                  </div>
                  <div>
                    <Label>Revues périodiques</Label>
                    <Input value={partenariatData.gouvernanceRevues} onChange={(e) => setPartenariatData({...partenariatData, gouvernanceRevues: e.target.value})} placeholder="Ex: Revue annuelle stratégique..." />
                  </div>
                </div>

                {/* 6. CONTRIBUTIONS FINANCIÈRES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Contributions financières</h4>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <Label>Investissement initial — Partie 1</Label>
                      <Input value={partenariatData.financeInvestissementPartie1} onChange={(e) => setPartenariatData({...partenariatData, financeInvestissementPartie1: e.target.value})} placeholder="Montant en €" />
                    </div>
                    <div>
                      <Label>Investissement initial — Partie 2</Label>
                      <Input value={partenariatData.financeInvestissementPartie2} onChange={(e) => setPartenariatData({...partenariatData, financeInvestissementPartie2: e.target.value})} placeholder="Montant en €" />
                    </div>
                  </div>
                  <div>
                    <Label>Budget commun</Label>
                    <Input value={partenariatData.financeBudgetCommun} onChange={(e) => setPartenariatData({...partenariatData, financeBudgetCommun: e.target.value})} placeholder="Ex: 100 000 € annuels" />
                  </div>
                  <div>
                    <Label>Répartition des coûts</Label>
                    <Textarea value={partenariatData.financeRepartitionCouts} onChange={(e) => setPartenariatData({...partenariatData, financeRepartitionCouts: e.target.value})} placeholder="Ex: 50/50, au prorata du CA généré..." rows={2} />
                  </div>
                  <div>
                    <Label>Règles de facturation interne</Label>
                    <Textarea value={partenariatData.financeFacturation} onChange={(e) => setPartenariatData({...partenariatData, financeFacturation: e.target.value})} placeholder="Ex: Facturation mensuelle des prestations réciproques..." rows={2} />
                  </div>
                  <div>
                    <Label>Modalités de paiement</Label>
                    <Input value={partenariatData.financeModalitesPaiement} onChange={(e) => setPartenariatData({...partenariatData, financeModalitesPaiement: e.target.value})} placeholder="Ex: Virement, 30 jours fin de mois..." />
                  </div>
                  <div>
                    <Label>Financement externe</Label>
                    <Textarea value={partenariatData.financeFinancementExterne} onChange={(e) => setPartenariatData({...partenariatData, financeFinancementExterne: e.target.value})} placeholder="Subventions, prêts bancaires, levée de fonds..." rows={2} />
                  </div>
                  <div>
                    <Label>Répartition des bénéfices économiques</Label>
                    <Textarea value={partenariatData.financeRepartitionBenefices} onChange={(e) => setPartenariatData({...partenariatData, financeRepartitionBenefices: e.target.value})} placeholder="Ex: 60/40, selon apport de chaque partie..." rows={2} />
                  </div>
                  <div>
                    <Label>Absence de flux financier entre les parties ?</Label>
                    <Select value={partenariatData.financeAbsenceFlux} onValueChange={(val) => setPartenariatData({...partenariatData, financeAbsenceFlux: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* 7. PARTAGE DES RESSOURCES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Partage des ressources</h4>
                  <div>
                    <Label>Mise à disposition de personnel</Label>
                    <Textarea value={partenariatData.ressourcesPersonnel} onChange={(e) => setPartenariatData({...partenariatData, ressourcesPersonnel: e.target.value})} placeholder="Ex: 1 développeur à temps partiel, 1 commercial..." rows={2} />
                  </div>
                  <div>
                    <Label>Mise à disposition de matériel</Label>
                    <Textarea value={partenariatData.ressourcesMateriel} onChange={(e) => setPartenariatData({...partenariatData, ressourcesMateriel: e.target.value})} placeholder="Ex: Ordinateurs, véhicules, machines..." rows={2} />
                  </div>
                  <div>
                    <Label>Mise à disposition de licences ou logiciels</Label>
                    <Textarea value={partenariatData.ressourcesLicences} onChange={(e) => setPartenariatData({...partenariatData, ressourcesLicences: e.target.value})} placeholder="Ex: Licence CRM, accès plateforme SaaS..." rows={2} />
                  </div>
                  <div>
                    <Label>Accès à des bases de données</Label>
                    <Textarea value={partenariatData.ressourcesBaseDonnees} onChange={(e) => setPartenariatData({...partenariatData, ressourcesBaseDonnees: e.target.value})} placeholder="Ex: Base clients, données marché..." rows={2} />
                  </div>
                  <div>
                    <Label>Accès à un espace de travail</Label>
                    <Input value={partenariatData.ressourcesEspaceTravail} onChange={(e) => setPartenariatData({...partenariatData, ressourcesEspaceTravail: e.target.value})} placeholder="Ex: Bureau partagé, salle de réunion..." />
                  </div>
                  <div>
                    <Label>Conditions d'utilisation</Label>
                    <Textarea value={partenariatData.ressourcesConditionsUtilisation} onChange={(e) => setPartenariatData({...partenariatData, ressourcesConditionsUtilisation: e.target.value})} placeholder="Usage exclusif au partenariat, respect des procédures..." rows={2} />
                  </div>
                  <div>
                    <Label>Restrictions</Label>
                    <Textarea value={partenariatData.ressourcesRestrictions} onChange={(e) => setPartenariatData({...partenariatData, ressourcesRestrictions: e.target.value})} placeholder="Pas de sous-location, pas de cession à des tiers..." rows={2} />
                  </div>
                </div>

                {/* 8. DURÉE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Durée du partenariat</h4>
                  <div>
                    <Label>Durée déterminée ou indéterminée ?</Label>
                    <Select value={partenariatData.dureeDeterminee} onValueChange={(val) => setPartenariatData({...partenariatData, dureeDeterminee: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Durée déterminée</SelectItem>
                        <SelectItem value="non">Durée indéterminée</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.dureeDeterminee === "oui" && (
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Date de début</Label>
                        <Input type="date" value={partenariatData.dureeDebut} onChange={(e) => setPartenariatData({...partenariatData, dureeDebut: e.target.value})} />
                      </div>
                      <div>
                        <Label>Date de fin</Label>
                        <Input type="date" value={partenariatData.dureeFin} onChange={(e) => setPartenariatData({...partenariatData, dureeFin: e.target.value})} />
                      </div>
                    </div>
                  )}
                  <div>
                    <Label>Reconduction tacite ?</Label>
                    <Select value={partenariatData.dureeReconduction} onValueChange={(val) => setPartenariatData({...partenariatData, dureeReconduction: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Clause d'évaluation intermédiaire</Label>
                    <Input value={partenariatData.dureeEvaluationIntermediaire} onChange={(e) => setPartenariatData({...partenariatData, dureeEvaluationIntermediaire: e.target.value})} placeholder="Ex: Évaluation à mi-parcours (12 mois)" />
                  </div>
                </div>

                {/* 9. CONFIDENTIALITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Confidentialité</h4>
                  <div>
                    <Label>Définition de l'information confidentielle *</Label>
                    <Textarea value={partenariatData.confidentialiteDefinition} onChange={(e) => setPartenariatData({...partenariatData, confidentialiteDefinition: e.target.value})} placeholder="Ex: Toute information technique, commerciale, financière échangée dans le cadre du partenariat..." rows={3} />
                  </div>
                  <div>
                    <Label>Durée de confidentialité (en années)</Label>
                    <Select value={partenariatData.confidentialiteDuree} onValueChange={(val) => setPartenariatData({...partenariatData, confidentialiteDuree: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="3">3 ans</SelectItem>
                        <SelectItem value="5">5 ans</SelectItem>
                        <SelectItem value="7">7 ans</SelectItem>
                        <SelectItem value="10">10 ans</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Exceptions (informations non confidentielles)</Label>
                    <Textarea value={partenariatData.confidentialiteExceptions} onChange={(e) => setPartenariatData({...partenariatData, confidentialiteExceptions: e.target.value})} placeholder="Ex: Informations publiques, déjà connues, obtenues légalement d'un tiers..." rows={2} />
                  </div>
                  <div>
                    <Label>Mesures de sécurité à respecter</Label>
                    <Textarea value={partenariatData.confidentialiteMesuresSecurite} onChange={(e) => setPartenariatData({...partenariatData, confidentialiteMesuresSecurite: e.target.value})} placeholder="Ex: Chiffrement des données, accès restreint, classification des documents..." rows={2} />
                  </div>
                  <div>
                    <Label>Conséquences en cas de violation</Label>
                    <Textarea value={partenariatData.confidentialiteConsequences} onChange={(e) => setPartenariatData({...partenariatData, confidentialiteConsequences: e.target.value})} placeholder="Ex: Dommages-intérêts, résiliation immédiate..." rows={2} />
                  </div>
                </div>

                {/* 10. PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  <div>
                    <Label>PI Antérieure (Background IP)</Label>
                    <Textarea value={partenariatData.piAnterieure} onChange={(e) => setPartenariatData({...partenariatData, piAnterieure: e.target.value})} placeholder="Décrire les éléments de PI existants avant le partenariat..." rows={2} />
                  </div>
                  <div>
                    <Label>Régime de la PI antérieure</Label>
                    <Textarea value={partenariatData.piAnterieureRegime} onChange={(e) => setPartenariatData({...partenariatData, piAnterieureRegime: e.target.value})} placeholder="Ex: Reste propriété exclusive, licence d'utilisation accordée pour le partenariat..." rows={2} />
                  </div>
                  <div>
                    <Label>Régime de la PI créée pendant le partenariat (Foreground IP)</Label>
                    <Select value={partenariatData.piCreeRegime} onValueChange={(val) => setPartenariatData({...partenariatData, piCreeRegime: val})}>
                      <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="copropriete">Copropriété (propriété partagée)</SelectItem>
                        <SelectItem value="partie1">Propriété exclusive à la partie 1</SelectItem>
                        <SelectItem value="partie2">Propriété exclusive à la partie 2</SelectItem>
                        <SelectItem value="licence">Propriété à une partie avec licence à l'autre</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.piCreeRegime === "licence" && (
                    <div>
                      <Label>Qui est propriétaire ?</Label>
                      <Select value={partenariatData.piCreeProprietaire} onValueChange={(val) => setPartenariatData({...partenariatData, piCreeProprietaire: val})}>
                        <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="partie1">Partie 1</SelectItem>
                          <SelectItem value="partie2">Partie 2</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                  <div>
                    <Label>Modalités d'exploitation commune</Label>
                    <Textarea value={partenariatData.piCreeExploitation} onChange={(e) => setPartenariatData({...partenariatData, piCreeExploitation: e.target.value})} placeholder="Ex: Accord préalable requis, répartition des revenus de licence..." rows={2} />
                  </div>
                  <div>
                    <Label>Protection (brevets, droits d'auteur, marques)</Label>
                    <Textarea value={partenariatData.piCreeProtection} onChange={(e) => setPartenariatData({...partenariatData, piCreeProtection: e.target.value})} placeholder="Ex: Dépôt de brevet conjoint, enregistrement marque..." rows={2} />
                  </div>
                  <div>
                    <Label>Titularité des livrables / documentation</Label>
                    <Input value={partenariatData.piDocumentsTitularite} onChange={(e) => setPartenariatData({...partenariatData, piDocumentsTitularite: e.target.value})} placeholder="Ex: Propriété conjointe, cession à la partie 1..." />
                  </div>
                  <div>
                    <Label>Restrictions d'usage des livrables</Label>
                    <Textarea value={partenariatData.piDocumentsRestrictions} onChange={(e) => setPartenariatData({...partenariatData, piDocumentsRestrictions: e.target.value})} placeholder="Usage limité au partenariat, pas de revente..." rows={2} />
                  </div>
                </div>

                {/* 11. RGPD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟 Traitement des données &amp; RGPD</h4>
                  <div>
                    <Label>Données personnelles impliquées dans le partenariat ?</Label>
                    <Select value={partenariatData.rgpdApplicable} onValueChange={(val) => setPartenariatData({...partenariatData, rgpdApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.rgpdApplicable === "oui" && (
                    <>
                      <div>
                        <Label>Rôle des parties</Label>
                        <Select value={partenariatData.rgpdRoleParties} onValueChange={(val) => setPartenariatData({...partenariatData, rgpdRoleParties: val})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="responsable_unique">Responsable de traitement unique</SelectItem>
                            <SelectItem value="coresponsables">Co-responsables de traitement</SelectItem>
                            <SelectItem value="responsable_soustraitant">Responsable + Sous-traitant</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Base légale du traitement</Label>
                        <Select value={partenariatData.rgpdBaseLegale} onValueChange={(val) => setPartenariatData({...partenariatData, rgpdBaseLegale: val})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="consentement">Consentement</SelectItem>
                            <SelectItem value="contrat">Exécution du contrat</SelectItem>
                            <SelectItem value="obligation_legale">Obligation légale</SelectItem>
                            <SelectItem value="interet_legitime">Intérêt légitime</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Responsable de traitement</Label>
                        <Input value={partenariatData.rgpdResponsable} onChange={(e) => setPartenariatData({...partenariatData, rgpdResponsable: e.target.value})} placeholder="Quelle partie ?" />
                      </div>
                      <div>
                        <Label>Sous-traitant</Label>
                        <Input value={partenariatData.rgpdSousTraitant} onChange={(e) => setPartenariatData({...partenariatData, rgpdSousTraitant: e.target.value})} placeholder="Quelle partie ?" />
                      </div>
                      <div>
                        <Label>Finalités du traitement</Label>
                        <Textarea value={partenariatData.rgpdFinalites} onChange={(e) => setPartenariatData({...partenariatData, rgpdFinalites: e.target.value})} placeholder="Ex: Gestion clients communs, marketing..." rows={2} />
                      </div>
                      <div>
                        <Label>Durée de conservation</Label>
                        <Input value={partenariatData.rgpdConservation} onChange={(e) => setPartenariatData({...partenariatData, rgpdConservation: e.target.value})} placeholder="Ex: 3 ans après fin du partenariat" />
                      </div>
                      <div>
                        <Label>Sort des données en fin de contrat</Label>
                        <Textarea value={partenariatData.rgpdSortDonneesFin} onChange={(e) => setPartenariatData({...partenariatData, rgpdSortDonneesFin: e.target.value})} placeholder="Ex: Restitution, suppression, anonymisation..." rows={2} />
                      </div>
                      <div>
                        <Label>Mesures de sécurité</Label>
                        <Textarea value={partenariatData.rgpdMesuresSecurite} onChange={(e) => setPartenariatData({...partenariatData, rgpdMesuresSecurite: e.target.value})} placeholder="Chiffrement, pseudonymisation, contrôle d'accès..." rows={2} />
                      </div>
                      <div>
                        <Label>Transfert hors UE ?</Label>
                        <Select value={partenariatData.rgpdTransfertHorsUE} onValueChange={(val) => setPartenariatData({...partenariatData, rgpdTransfertHorsUE: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>DPA (Data Processing Agreement) à joindre ?</Label>
                        <Select value={partenariatData.rgpdDPA} onValueChange={(val) => setPartenariatData({...partenariatData, rgpdDPA: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </>
                  )}
                </div>

                {/* 12. COMMUNICATION & MARKETING */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Communication &amp; marketing commun</h4>
                  <div>
                    <Label>Usage des logos / marques</Label>
                    <Textarea value={partenariatData.communicationUsageLogos} onChange={(e) => setPartenariatData({...partenariatData, communicationUsageLogos: e.target.value})} placeholder="Ex: Autorisation d'usage réciproque des logos sur supports marketing..." rows={2} />
                  </div>
                  <div>
                    <Label>Communiqués de presse conjoints</Label>
                    <Textarea value={partenariatData.communicationCommuniques} onChange={(e) => setPartenariatData({...partenariatData, communicationCommuniques: e.target.value})} placeholder="Processus de validation, fréquence..." rows={2} />
                  </div>
                  <div>
                    <Label>Présence sur les réseaux sociaux</Label>
                    <Textarea value={partenariatData.communicationReseauxSociaux} onChange={(e) => setPartenariatData({...partenariatData, communicationReseauxSociaux: e.target.value})} placeholder="Ex: Mentions mutuelles, partage de contenus..." rows={2} />
                  </div>
                  <div>
                    <Label>Confidentialité sur les chiffres</Label>
                    <Input value={partenariatData.communicationConfidentialiteChiffres} onChange={(e) => setPartenariatData({...partenariatData, communicationConfidentialiteChiffres: e.target.value})} placeholder="Ex: Pas de divulgation de CA, volumes..." />
                  </div>
                  <div>
                    <Label>Processus de validation des communications</Label>
                    <Textarea value={partenariatData.communicationProcessusValidation} onChange={(e) => setPartenariatData({...partenariatData, communicationProcessusValidation: e.target.value})} placeholder="Ex: Validation par les 2 parties avant publication..." rows={2} />
                  </div>
                </div>

                {/* 13. EXCLUSIVITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Exclusivité (optionnelle)</h4>
                  <div>
                    <Label>Partenariat exclusif ?</Label>
                    <Select value={partenariatData.exclusiviteApplicable} onValueChange={(val) => setPartenariatData({...partenariatData, exclusiviteApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui, exclusif</SelectItem>
                        <SelectItem value="non">Non, non exclusif</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.exclusiviteApplicable === "oui" && (
                    <>
                      <div>
                        <Label>Zone géographique d'exclusivité</Label>
                        <Input value={partenariatData.exclusiviteZone} onChange={(e) => setPartenariatData({...partenariatData, exclusiviteZone: e.target.value})} placeholder="Ex: France, Europe, Mondial..." />
                      </div>
                      <div>
                        <Label>Secteur d'activité concerné</Label>
                        <Input value={partenariatData.exclusiviteSecteur} onChange={(e) => setPartenariatData({...partenariatData, exclusiviteSecteur: e.target.value})} placeholder="Ex: SaaS B2B, retail..." />
                      </div>
                      <div>
                        <Label>Durée de l'exclusivité</Label>
                        <Input value={partenariatData.exclusiviteDuree} onChange={(e) => setPartenariatData({...partenariatData, exclusiviteDuree: e.target.value})} placeholder="Ex: 2 ans renouvelables" />
                      </div>
                      <div>
                        <Label>Engagements minimaux requis</Label>
                        <Textarea value={partenariatData.exclusiviteEngagementsMin} onChange={(e) => setPartenariatData({...partenariatData, exclusiviteEngagementsMin: e.target.value})} placeholder="Ex: CA minimum 100k€/an, 50 clients..." rows={2} />
                      </div>
                    </>
                  )}
                </div>

                {/* 14. RESPONSABILITÉ & GARANTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Responsabilité &amp; garanties</h4>
                  <div>
                    <Label>Responsabilité contractuelle</Label>
                    <Textarea value={partenariatData.responsabiliteContractuelle} onChange={(e) => setPartenariatData({...partenariatData, responsabiliteContractuelle: e.target.value})} placeholder="Chaque partie est responsable de ses obligations..." rows={2} />
                  </div>
                  <div>
                    <Label>Responsabilité en cas de retard</Label>
                    <Textarea value={partenariatData.responsabiliteRetard} onChange={(e) => setPartenariatData({...partenariatData, responsabiliteRetard: e.target.value})} placeholder="Pénalités de retard, astreintes..." rows={2} />
                  </div>
                  <div>
                    <Label>Dommages indirects</Label>
                    <Select value={partenariatData.responsabiliteDommagesIndirects} onValueChange={(val) => setPartenariatData({...partenariatData, responsabiliteDommagesIndirects: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="exclus">Exclus</SelectItem>
                        <SelectItem value="inclus">Inclus</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="flex items-center gap-2 p-3 bg-amber-50 rounded border border-amber-200">
                    <input
                      type="checkbox"
                      id="exclusionPertes"
                      checked={partenariatData.responsabiliteExclusionPertesIndirectes}
                      onChange={(e) => setPartenariatData({...partenariatData, responsabiliteExclusionPertesIndirectes: e.target.checked})}
                      className="rounded"
                    />
                    <Label htmlFor="exclusionPertes" className="cursor-pointer text-sm">
                      Exclusion des pertes indirectes, perte de chance, perte de chiffre d'affaires
                    </Label>
                  </div>
                  <div>
                    <Label>Plafond de responsabilité</Label>
                    <Input value={partenariatData.responsabilitePlafond} onChange={(e) => setPartenariatData({...partenariatData, responsabilitePlafond: e.target.value})} placeholder="Ex: 100 000 €, montant du budget annuel..." />
                  </div>
                  <div>
                    <Label>RC professionnelle obligatoire ?</Label>
                    <Select value={partenariatData.responsabiliteAssuranceObligatoire} onValueChange={(val) => setPartenariatData({...partenariatData, responsabiliteAssuranceObligatoire: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Assurance spécifique au projet</Label>
                    <Input value={partenariatData.responsabiliteAssuranceSpecifique} onChange={(e) => setPartenariatData({...partenariatData, responsabiliteAssuranceSpecifique: e.target.value})} placeholder="Ex: Assurance cyber-risque..." />
                  </div>
                </div>

                {/* 15. MODIFICATIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Modifications du partenariat</h4>
                  <div>
                    <Label>Amendements possibles ?</Label>
                    <Select value={partenariatData.modificationsAmendementsAutorise} onValueChange={(val) => setPartenariatData({...partenariatData, modificationsAmendementsAutorise: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.modificationsAmendementsAutorise === "oui" && (
                    <>
                      <div>
                        <Label>Procédure de modification</Label>
                        <Textarea value={partenariatData.modificationsProcedure} onChange={(e) => setPartenariatData({...partenariatData, modificationsProcedure: e.target.value})} placeholder="Ex: Proposition écrite, délai de réponse 15 jours..." rows={2} />
                      </div>
                      <div>
                        <Label>Signature obligatoire des avenants ?</Label>
                        <Select value={partenariatData.modificationsSignature} onValueChange={(val) => setPartenariatData({...partenariatData, modificationsSignature: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </>
                  )}
                </div>

                {/* 16. RÉSILIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Résiliation du contrat</h4>
                  <div>
                    <Label>Durée du préavis (en jours)</Label>
                    <Select value={partenariatData.resiliationPreavisDuree} onValueChange={(val) => setPartenariatData({...partenariatData, resiliationPreavisDuree: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="30">30 jours</SelectItem>
                        <SelectItem value="60">60 jours</SelectItem>
                        <SelectItem value="90">90 jours</SelectItem>
                        <SelectItem value="120">120 jours</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Condition de résiliation avec préavis</Label>
                    <Textarea value={partenariatData.resiliationPreavisCondition} onChange={(e) => setPartenariatData({...partenariatData, resiliationPreavisCondition: e.target.value})} placeholder="Ex: Simple volonté, motif légitime..." rows={2} />
                  </div>
                  <div>
                    <Label>Causes de résiliation immédiate</Label>
                    <Textarea value={partenariatData.resiliationImmediateCauses} onChange={(e) => setPartenariatData({...partenariatData, resiliationImmediateCauses: e.target.value})} placeholder="Ex: Faute grave, violation PI, non-respect obligations financières..." rows={3} />
                  </div>
                  <div>
                    <Label>Restitution des données</Label>
                    <Input value={partenariatData.resiliationEffetsRestitution} onChange={(e) => setPartenariatData({...partenariatData, resiliationEffetsRestitution: e.target.value})} placeholder="Ex: Sous 30 jours, format exploitable..." />
                  </div>
                  <div>
                    <Label>Restitution du matériel</Label>
                    <Input value={partenariatData.resiliationEffetsMateriel} onChange={(e) => setPartenariatData({...partenariatData, resiliationEffetsMateriel: e.target.value})} placeholder="Délai et modalités de restitution..." />
                  </div>
                  <div>
                    <Label>Fin des droits d'usage</Label>
                    <Input value={partenariatData.resiliationEffetsDroitsUsage} onChange={(e) => setPartenariatData({...partenariatData, resiliationEffetsDroitsUsage: e.target.value})} placeholder="Cessation immédiate des licences..." />
                  </div>
                  <div>
                    <Label>Rapport final de clôture</Label>
                    <Input value={partenariatData.resiliationEffetsRapport} onChange={(e) => setPartenariatData({...partenariatData, resiliationEffetsRapport: e.target.value})} placeholder="Ex: Rapport financier, bilan opérationnel..." />
                  </div>
                  <div>
                    <Label>Destruction des informations confidentielles</Label>
                    <Input value={partenariatData.resiliationEffetsDestruction} onChange={(e) => setPartenariatData({...partenariatData, resiliationEffetsDestruction: e.target.value})} placeholder="Délai et modalités..." />
                  </div>
                </div>

                {/* 17. RÈGLEMENT DES LITIGES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Règlement des litiges</h4>
                  <div>
                    <Label>Loi applicable</Label>
                    <Select value={partenariatData.litigesLoiApplicable} onValueChange={(val) => setPartenariatData({...partenariatData, litigesLoiApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="francaise">Droit français</SelectItem>
                        <SelectItem value="autre">Autre droit</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {partenariatData.litigesLoiApplicable === "autre" && (
                    <div>
                      <Label>Préciser le droit applicable</Label>
                      <Input value={partenariatData.litigesLoiAutre} onChange={(e) => setPartenariatData({...partenariatData, litigesLoiAutre: e.target.value})} placeholder="Ex: Droit suisse, droit belge..." />
                    </div>
                  )}
                  <div>
                    <Label>Tribunal compétent</Label>
                    <Input value={partenariatData.litigesTribunal} onChange={(e) => setPartenariatData({...partenariatData, litigesTribunal: e.target.value})} placeholder="Ex: Tribunal de commerce de Paris" />
                  </div>
                  <div>
                    <Label>Clause de médiation préalable ?</Label>
                    <Select value={partenariatData.litigesMediation} onValueChange={(val) => setPartenariatData({...partenariatData, litigesMediation: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Arbitrage (optionnel)</Label>
                    <Select value={partenariatData.litigesArbitrage} onValueChange={(val) => setPartenariatData({...partenariatData, litigesArbitrage: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* 18. CLAUSES GÉNÉRALES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clauses générales</h4>
                  <div className="flex items-center gap-2 p-3 bg-white rounded border border-blue-100">
                    <input
                      type="checkbox"
                      id="clauseIndependance"
                      checked={partenariatData.clauseIndependanceParties}
                      onChange={(e) => setPartenariatData({...partenariatData, clauseIndependanceParties: e.target.checked})}
                      className="rounded"
                    />
                    <Label htmlFor="clauseIndependance" className="cursor-pointer text-sm">
                      <strong>Clause d'indépendance des parties</strong> — Les parties agissent en toute indépendance, sans lien de subordination ni pouvoir de représentation
                    </Label>
                  </div>
                  <div className="flex items-center gap-2 p-3 bg-white rounded border border-blue-100">
                    <input
                      type="checkbox"
                      id="clauseNonSociete"
                      checked={partenariatData.clauseNonCreationSociete}
                      onChange={(e) => setPartenariatData({...partenariatData, clauseNonCreationSociete: e.target.checked})}
                      className="rounded"
                    />
                    <Label htmlFor="clauseNonSociete" className="cursor-pointer text-sm">
                      <strong>Clause de non-création de société / joint-venture</strong> — Le contrat ne constitue ni société créée de fait, ni GIE, ni joint-venture
                    </Label>
                  </div>
                  <div className="space-y-2 p-3 bg-white rounded border border-blue-100">
                    <Label className="font-semibold">Clause de force majeure</Label>
                    <div>
                      <Label>Définition des événements de force majeure</Label>
                      <Textarea value={partenariatData.clauseForceMajeureDefinition} onChange={(e) => setPartenariatData({...partenariatData, clauseForceMajeureDefinition: e.target.value})} placeholder="Ex: Guerre, catastrophe naturelle, pandémie, grève générale..." rows={2} />
                    </div>
                    <div>
                      <Label>Suspension des obligations</Label>
                      <Input value={partenariatData.clauseForceMajeureSuspension} onChange={(e) => setPartenariatData({...partenariatData, clauseForceMajeureSuspension: e.target.value})} placeholder="Ex: Suspension automatique pendant l'événement" />
                    </div>
                    <div>
                      <Label>Résiliation si prolongée</Label>
                      <Input value={partenariatData.clauseForceMajeureResiliation} onChange={(e) => setPartenariatData({...partenariatData, clauseForceMajeureResiliation: e.target.value})} placeholder="Ex: Au-delà de 3 mois" />
                    </div>
                  </div>
                  <div className="space-y-2 p-3 bg-white rounded border border-blue-100">
                    <Label className="font-semibold">Clause de cession du contrat</Label>
                    <div className="flex items-center gap-2">
                      <input
                        type="checkbox"
                        id="clauseCessionInterdite"
                        checked={partenariatData.clauseCessionInterdite}
                        onChange={(e) => setPartenariatData({...partenariatData, clauseCessionInterdite: e.target.checked})}
                        className="rounded"
                      />
                      <Label htmlFor="clauseCessionInterdite" className="cursor-pointer text-sm">
                        Interdiction de cession sans accord écrit préalable
                      </Label>
                    </div>
                    {!partenariatData.clauseCessionInterdite && (
                      <div>
                        <Label>Conditions de cession autorisée</Label>
                        <Textarea value={partenariatData.clauseCessionConditions} onChange={(e) => setPartenariatData({...partenariatData, clauseCessionConditions: e.target.value})} placeholder="Préciser les conditions..." rows={2} />
                      </div>
                    )}
                  </div>
                  <div className="flex items-center gap-2 p-3 bg-white rounded border border-blue-100">
                    <input
                      type="checkbox"
                      id="clauseNullite"
                      checked={partenariatData.clauseNullitePartielle}
                      onChange={(e) => setPartenariatData({...partenariatData, clauseNullitePartielle: e.target.checked})}
                      className="rounded"
                    />
                    <Label htmlFor="clauseNullite" className="cursor-pointer text-sm">
                      <strong>Clause de nullité partielle</strong> — La nullité d'une clause n'entraîne pas la nullité du contrat
                    </Label>
                  </div>
                  <div className="flex items-center gap-2 p-3 bg-white rounded border border-blue-100">
                    <input
                      type="checkbox"
                      id="clauseIntegralite"
                      checked={partenariatData.clauseIntegraliteAccord}
                      onChange={(e) => setPartenariatData({...partenariatData, clauseIntegraliteAccord: e.target.checked})}
                      className="rounded"
                    />
                    <Label htmlFor="clauseIntegralite" className="cursor-pointer text-sm">
                      <strong>Clause d'intégralité de l'accord</strong> — Le contrat prévaut sur tout échange antérieur (emails, discussions...)
                    </Label>
                  </div>
                </div>

                {/* 19. ANNEXES POSSIBLES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes possibles</h4>
                  <div>
                    <Label>Description des annexes</Label>
                    <Textarea value={partenariatData.annexesDescriptions} onChange={(e) => setPartenariatData({...partenariatData, annexesDescriptions: e.target.value})} placeholder="Lister les annexes prévues : cahier des charges, planning, budget..." rows={3} />
                  </div>
                  <SingleFileUpload
                    label="Cahier des charges"
                    files={partenariatCahierChargesFiles}
                    onFilesChange={setPartenariatCahierChargesFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Planning prévisionnel"
                    files={partenariatPlanningFiles}
                    onFilesChange={setPartenariatPlanningFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Budget prévisionnel"
                    files={partenariatBudgetFiles}
                    onFilesChange={setPartenariatBudgetFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Charte graphique"
                    files={partenariatCharteGraphiqueFiles}
                    onFilesChange={setPartenariatCharteGraphiqueFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Protocole RGPD"
                    files={partenariatProtocoleRGPDFiles}
                    onFilesChange={setPartenariatProtocoleRGPDFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Description technique du projet"
                    files={partenariatDescriptionTechniqueFiles}
                    onFilesChange={setPartenariatDescriptionTechniqueFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Plan marketing commun"
                    files={partenariatPlanMarketingFiles}
                    onFilesChange={setPartenariatPlanMarketingFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Contrat de licence PI"
                    files={partenariatContratLicenceFiles}
                    onFilesChange={setPartenariatContratLicenceFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Conditions financières détaillées"
                    files={partenariatConditionsFinancieresFiles}
                    onFilesChange={setPartenariatConditionsFinancieresFiles}
                    role="avocat"
                  />
                  <SingleFileUpload
                    label="Protocole de réversibilité (données / livrables / accès)"
                    files={partenariatProtocoleReversibiliteFiles}
                    onFilesChange={setPartenariatProtocoleReversibiliteFiles}
                    role="avocat"
                  />
                </div>

                {/* Observations finales */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Observations finales</h4>
                  <div>
                    <Label>Observations finales / clauses particulières</Label>
                    <Textarea value={partenariatData.observationsFinales} onChange={(e) => setPartenariatData({...partenariatData, observationsFinales: e.target.value})} placeholder="Précisions complémentaires..." rows={4} />
                  </div>
                </div>
              </div>
            )}

            {/* Formulaire complet pour Contrat de sous-traitance */}
            {pendingContractType === "Contrat de sous-traitance" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🔧 Contrat de sous-traitance</h3>
                
                {/* IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification des parties</h4>
                  
                  {/* Donneur d'ordre */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-semibold text-gray-700 mb-3">Donneur d'ordre (client principal)</h5>
                    <ClientSelector
                      clients={clients}
                      selectedClientId={sousTraitanceClientId1}
                      onClientChange={(clientId) => {
                        setSousTraitanceClientId1(clientId);
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setSousTraitanceData({
                              ...sousTraitanceData,
                              donneurNom: client.prenom && client.nom ? `${client.prenom} ${client.nom}` : (client.denomination_sociale || ""),
                              donneurSiege: client.adresse || "",
                            });
                          }
                        } else {
                          setSousTraitanceData({
                            ...sousTraitanceData,
                            donneurNom: "",
                            donneurSiege: "",
                          });
                        }
                      }}
                      label="Sélectionner un client existant (optionnel) - Donneur d'ordre"
                    />
                    <div>
                      <Label>Dénomination sociale *</Label>
                      <Input value={sousTraitanceData.donneurNom} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurNom: e.target.value})} placeholder="Ex: Société ABC..." />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Forme juridique</Label>
                        <Select value={sousTraitanceData.donneurFormeJuridique} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, donneurFormeJuridique: val})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="SAS">SAS</SelectItem>
                            <SelectItem value="SARL">SARL</SelectItem>
                            <SelectItem value="SA">SA</SelectItem>
                            <SelectItem value="EURL">EURL</SelectItem>
                            <SelectItem value="SCI">SCI</SelectItem>
                            <SelectItem value="Association">Association</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Capital social</Label>
                        <Input value={sousTraitanceData.donneurCapital} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurCapital: e.target.value})} placeholder="Ex: 10 000 €" />
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>RCS / SIREN *</Label>
                        <Input value={sousTraitanceData.donneurRCS} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurRCS: e.target.value})} placeholder="Ex: RCS Paris 123 456 789" />
                      </div>
                      <div>
                        <Label>Secteur d'activité</Label>
                        <Input value={sousTraitanceData.donneurActivite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurActivite: e.target.value})} placeholder="Ex: Tech, Industrie..." />
                      </div>
                    </div>
                    <div>
                      <Label>Adresse du siège social *</Label>
                      <Input value={sousTraitanceData.donneurSiege} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurSiege: e.target.value})} placeholder="Adresse complète" />
                    </div>
                    <div>
                      <Label>Représentant légal *</Label>
                      <Input value={sousTraitanceData.donneurRepresentant} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurRepresentant: e.target.value})} placeholder="Ex: M. Dupont, Président" />
                    </div>
                    <div>
                      <Label>Assurance RC Pro</Label>
                      <Input value={sousTraitanceData.donneurAssurance} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurAssurance: e.target.value})} placeholder="Compagnie et numéro de police" />
                    </div>
                    <SingleFileUpload
                      label="Kbis du donneur d'ordre"
                      files={sousTraitanceDonneurKbisFiles}
                      onFilesChange={setSousTraitanceDonneurKbisFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Conditions techniques / Cahier des charges"
                      files={sousTraitanceDonneurConditionsTechniquesFiles}
                      onFilesChange={setSousTraitanceDonneurConditionsTechniquesFiles}
                      role="avocat"
                    />
                  </div>
                  
                  {/* Sous-traitant */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-semibold text-gray-700 mb-3">Sous-traitant</h5>
                    <ClientSelector
                      clients={clients}
                      selectedClientId={sousTraitanceClientId2}
                      onClientChange={(clientId) => {
                        setSousTraitanceClientId2(clientId);
                        if (clientId) {
                          const client = clients.find(c => c.id === clientId);
                          if (client) {
                            setSousTraitanceData({
                              ...sousTraitanceData,
                              sousTraitantNom: client.prenom && client.nom ? `${client.prenom} ${client.nom}` : (client.denomination_sociale || ""),
                              sousTraitantSiege: client.adresse || "",
                            });
                          }
                        } else {
                          setSousTraitanceData({
                            ...sousTraitanceData,
                            sousTraitantNom: "",
                            sousTraitantSiege: "",
                          });
                        }
                      }}
                      label="Sélectionner un client existant (optionnel) - Sous-traitant"
                    />
                    <div>
                      <Label>Dénomination ou nom *</Label>
                      <Input value={sousTraitanceData.sousTraitantNom} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantNom: e.target.value})} placeholder="Ex: Jean Dupont, Société XYZ..." />
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Statut juridique</Label>
                        <Select value={sousTraitanceData.sousTraitantStatut} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, sousTraitantStatut: val})}>
                          <SelectTrigger><SelectValue placeholder="Choisir" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="EI">EI (Entrepreneur individuel)</SelectItem>
                            <SelectItem value="SASU">SASU</SelectItem>
                            <SelectItem value="EURL">EURL</SelectItem>
                            <SelectItem value="SARL">SARL</SelectItem>
                            <SelectItem value="SAS">SAS</SelectItem>
                            <SelectItem value="SA">SA</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>RCS / SIREN *</Label>
                        <Input value={sousTraitanceData.sousTraitantRCS} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantRCS: e.target.value})} placeholder="Ex: 123 456 789" />
                      </div>
                    </div>
                    <div>
                      <Label>Adresse du siège *</Label>
                      <Input value={sousTraitanceData.sousTraitantSiege} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantSiege: e.target.value})} placeholder="Adresse complète" />
                    </div>
                    <div>
                      <Label>Représentant légal *</Label>
                      <Input value={sousTraitanceData.sousTraitantRepresentant} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantRepresentant: e.target.value})} placeholder="Ex: M. Martin, Gérant" />
                    </div>
                    <div>
                      <Label>Secteur d'activité</Label>
                      <Input value={sousTraitanceData.sousTraitantActivite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantActivite: e.target.value})} placeholder="Ex: Développement web, Logistique..." />
                    </div>
                    <div>
                      <Label>Assurance RC Pro *</Label>
                      <Input value={sousTraitanceData.sousTraitantAssurance} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantAssurance: e.target.value})} placeholder="Compagnie et numéro de police" />
                    </div>
                    <div>
                      <Label>Certification professionnelle (si secteur réglementé)</Label>
                      <Input value={sousTraitanceData.sousTraitantCertification} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitantCertification: e.target.value})} placeholder="Ex: ISO 9001, Qualiopi..." />
                    </div>
                    <SingleFileUpload
                      label="Kbis du sous-traitant"
                      files={sousTraitanceSousTraitantKbisFiles}
                      onFilesChange={setSousTraitanceSousTraitantKbisFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Attestation URSSAF (lutte contre travail dissimulé)"
                      files={sousTraitanceSousTraitantURSSAFFiles}
                      onFilesChange={setSousTraitanceSousTraitantURSSAFFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Attestation assurance RC Pro"
                      files={sousTraitanceSousTraitantRCProFiles}
                      onFilesChange={setSousTraitanceSousTraitantRCProFiles}
                      role="avocat"
                    />
                    <SingleFileUpload
                      label="Certifications (ISO, Qualiopi, etc.)"
                      files={sousTraitanceSousTraitantCertificationsFiles}
                      onFilesChange={setSousTraitanceSousTraitantCertificationsFiles}
                      role="avocat"
                    />
                  </div>
                </div>

                {/* OBJET DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du contrat</h4>
                  <div className="p-3 bg-amber-50 border border-amber-200 rounded">
                    <p className="text-sm text-amber-800">⚠️ Clause essentielle : définir précisément le périmètre de la mission</p>
                  </div>
                  <div>
                    <Label>Nature exacte de la mission sous-traitée *</Label>
                    <Textarea value={sousTraitanceData.missionNature} onChange={(e) => setSousTraitanceData({...sousTraitanceData, missionNature: e.target.value})} placeholder="Décrivez précisément la mission..." rows={3} />
                  </div>
                  <div>
                    <Label>Périmètre des tâches confiées *</Label>
                    <Textarea value={sousTraitanceData.missionPerimetre} onChange={(e) => setSousTraitanceData({...sousTraitanceData, missionPerimetre: e.target.value})} placeholder="Listez les tâches précises..." rows={3} />
                  </div>
                  <div>
                    <Label>Ce qui est inclus</Label>
                    <Textarea value={sousTraitanceData.missionInclusions} onChange={(e) => setSousTraitanceData({...sousTraitanceData, missionInclusions: e.target.value})} placeholder="Liste des prestations incluses..." rows={2} />
                  </div>
                  <div>
                    <Label>Ce qui est exclu</Label>
                    <Textarea value={sousTraitanceData.missionExclusions} onChange={(e) => setSousTraitanceData({...sousTraitanceData, missionExclusions: e.target.value})} placeholder="Liste des prestations exclues..." rows={2} />
                  </div>
                  <div>
                    <Label>Livrables attendus *</Label>
                    <Textarea value={sousTraitanceData.missionLivrables} onChange={(e) => setSousTraitanceData({...sousTraitanceData, missionLivrables: e.target.value})} placeholder="Décrivez les livrables..." rows={3} />
                  </div>
                  <div>
                    <Label>Outils ou ressources fournis par le donneur d'ordre</Label>
                    <Textarea value={sousTraitanceData.missionRessources} onChange={(e) => setSousTraitanceData({...sousTraitanceData, missionRessources: e.target.value})} placeholder="Ex: accès logiciels, matériel, données..." rows={2} />
                  </div>
                  <SingleFileUpload
                    label="Cahier des charges complet"
                    files={sousTraitanceCahierChargesFiles}
                    onFilesChange={setSousTraitanceCahierChargesFiles}
                    role="avocat"
                  />
                </div>

                {/* OBLIGATIONS DU SOUS-TRAITANT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations du sous-traitant</h4>
                  
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Obligations générales</h5>
                    <div className="space-y-2">
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="obligExec" checked={sousTraitanceData.obligationExecution} onChange={(e) => setSousTraitanceData({...sousTraitanceData, obligationExecution: e.target.checked})} className="rounded" />
                        <Label htmlFor="obligExec" className="cursor-pointer">Exécution conforme de la mission</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="obligDelais" checked={sousTraitanceData.obligationDelais} onChange={(e) => setSousTraitanceData({...sousTraitanceData, obligationDelais: e.target.checked})} className="rounded" />
                        <Label htmlFor="obligDelais" className="cursor-pointer">Respect des délais</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="obligNormes" checked={sousTraitanceData.obligationNormes} onChange={(e) => setSousTraitanceData({...sousTraitanceData, obligationNormes: e.target.checked})} className="rounded" />
                        <Label htmlFor="obligNormes" className="cursor-pointer">Respect des normes / législations sectorielles</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="obligMoyens" checked={sousTraitanceData.obligationMoyens} onChange={(e) => setSousTraitanceData({...sousTraitanceData, obligationMoyens: e.target.checked})} className="rounded" />
                        <Label htmlFor="obligMoyens" className="cursor-pointer">Mise à disposition des moyens humains et matériels</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="obligCollab" checked={sousTraitanceData.obligationCollaboration} onChange={(e) => setSousTraitanceData({...sousTraitanceData, obligationCollaboration: e.target.checked})} className="rounded" />
                        <Label htmlFor="obligCollab" className="cursor-pointer">Obligation de collaboration</Label>
                      </div>
                    </div>
                    <div>
                      <Label>Obligation de conseil ?</Label>
                      <Select value={sousTraitanceData.obligationConseil} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, obligationConseil: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Type d'obligation</h5>
                    <div>
                      <Label>Obligation de moyens ou de résultat ? *</Label>
                      <Select value={sousTraitanceData.obligationType} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, obligationType: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="moyens">Obligation de moyens</SelectItem>
                          <SelectItem value="resultat">Obligation de résultat</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.obligationType === "resultat" && (
                      <div className="p-3 bg-amber-50 border border-amber-200 rounded">
                        <p className="text-sm text-amber-800">⚠️ Obligations renforcées avec engagement de résultat</p>
                      </div>
                    )}
                  </div>

                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Continuité de service</h5>
                    <div>
                      <Label>Continuité de service requise ?</Label>
                      <Select value={sousTraitanceData.continuitéService} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, continuitéService: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.continuitéService === "oui" && (
                      <>
                        <div>
                          <Label>Remplacement du personnel absent</Label>
                          <Textarea value={sousTraitanceData.continuitéRemplacement} onChange={(e) => setSousTraitanceData({...sousTraitanceData, continuitéRemplacement: e.target.value})} placeholder="Modalités de remplacement..." rows={2} />
                        </div>
                        <div>
                          <Label>Plan de continuité d'activité (PCA)</Label>
                          <Textarea value={sousTraitanceData.continuitéPCA} onChange={(e) => setSousTraitanceData({...sousTraitanceData, continuitéPCA: e.target.value})} placeholder="Décrivez le PCA..." rows={2} />
                        </div>
                      </>
                    )}
                  </div>

                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Interdictions</h5>
                    <div className="space-y-2">
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="interdCascade" checked={sousTraitanceData.sousTraitanceCascadeInterdite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, sousTraitanceCascadeInterdite: e.target.checked})} className="rounded" />
                        <Label htmlFor="interdCascade" className="cursor-pointer">Sous-traitance en cascade sans autorisation</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="interdConflit" checked={sousTraitanceData.conflitsInteretsInterdits} onChange={(e) => setSousTraitanceData({...sousTraitanceData, conflitsInteretsInterdits: e.target.checked})} className="rounded" />
                        <Label htmlFor="interdConflit" className="cursor-pointer">Conflits d'intérêts</Label>
                      </div>
                    </div>
                    <div>
                      <Label>Développement d'activités concurrentes interdit ?</Label>
                      <Select value={sousTraitanceData.concurrenceInterdite} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, concurrenceInterdite: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* OBLIGATIONS DU DONNEUR D'ORDRE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations du donneur d'ordre</h4>
                  <div className="space-y-2">
                    <div className="flex items-center gap-2">
                      <input type="checkbox" id="donneurInfos" checked={sousTraitanceData.donneurFournitInfos} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurFournitInfos: e.target.checked})} className="rounded" />
                      <Label htmlFor="donneurInfos" className="cursor-pointer">Fournir les informations nécessaires</Label>
                    </div>
                    <div className="flex items-center gap-2">
                      <input type="checkbox" id="donneurValid" checked={sousTraitanceData.donneurValidation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurValidation: e.target.checked})} className="rounded" />
                      <Label htmlFor="donneurValid" className="cursor-pointer">Validation des livrables</Label>
                    </div>
                    <div className="flex items-center gap-2">
                      <input type="checkbox" id="donneurPaie" checked={sousTraitanceData.donneurPaiement} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurPaiement: e.target.checked})} className="rounded" />
                      <Label htmlFor="donneurPaie" className="cursor-pointer">Paiement des prestations</Label>
                    </div>
                    <div className="flex items-center gap-2">
                      <input type="checkbox" id="donneurCollab" checked={sousTraitanceData.donneurCollaboration} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurCollaboration: e.target.checked})} className="rounded" />
                      <Label htmlFor="donneurCollab" className="cursor-pointer">Collaboration active</Label>
                    </div>
                  </div>
                  <div>
                    <Label>Accès aux locaux / matériel / systèmes</Label>
                    <Textarea value={sousTraitanceData.donneurAcces} onChange={(e) => setSousTraitanceData({...sousTraitanceData, donneurAcces: e.target.value})} placeholder="Précisez les accès accordés..." rows={2} />
                  </div>
                </div>

                {/* NIVEAU DE QUALITÉ / SLA */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Niveau de qualité / SLA (Service Level Agreement)</h4>
                  <div>
                    <Label>SLA applicable ?</Label>
                    <Select value={sousTraitanceData.slaApplicable} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, slaApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {sousTraitanceData.slaApplicable === "oui" && (
                    <>
                      <div>
                        <Label>Temps de réponse</Label>
                        <Input value={sousTraitanceData.slaTempsReponse} onChange={(e) => setSousTraitanceData({...sousTraitanceData, slaTempsReponse: e.target.value})} placeholder="Ex: 2 heures max" />
                      </div>
                      <div>
                        <Label>Disponibilité du service</Label>
                        <Input value={sousTraitanceData.slaDisponibilite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, slaDisponibilite: e.target.value})} placeholder="Ex: 99.9%" />
                      </div>
                      <div>
                        <Label>Taux d'erreur acceptable</Label>
                        <Input value={sousTraitanceData.slaTauxErreur} onChange={(e) => setSousTraitanceData({...sousTraitanceData, slaTauxErreur: e.target.value})} placeholder="Ex: < 1%" />
                      </div>
                      <div>
                        <Label>Délais d'exécution</Label>
                        <Input value={sousTraitanceData.slaDelais} onChange={(e) => setSousTraitanceData({...sousTraitanceData, slaDelais: e.target.value})} placeholder="Ex: 48h pour livrable X" />
                      </div>
                      <div>
                        <Label>Critères de performance</Label>
                        <Textarea value={sousTraitanceData.slaCriteres} onChange={(e) => setSousTraitanceData({...sousTraitanceData, slaCriteres: e.target.value})} placeholder="Listez les KPI..." rows={3} />
                      </div>
                      <div>
                        <Label>Pénalités en cas de non-respect</Label>
                        <Textarea value={sousTraitanceData.slaPenalites} onChange={(e) => setSousTraitanceData({...sousTraitanceData, slaPenalites: e.target.value})} placeholder="Ex: 5% du montant mensuel par jour de retard..." rows={2} />
                      </div>
                      <SingleFileUpload
                        label="Document SLA / KPI détaillé"
                        files={sousTraitanceSLAFiles}
                        onFilesChange={setSousTraitanceSLAFiles}
                        role="avocat"
                      />
                    </>
                  )}
                </div>

                {/* PRIX & CONDITIONS FINANCIÈRES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Prix & conditions financières</h4>
                  <div>
                    <Label>Type de prix *</Label>
                    <Select value={sousTraitanceData.prixType} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixType: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="fixe">Montant fixe</SelectItem>
                        <SelectItem value="horaire">Taux horaire</SelectItem>
                        <SelectItem value="forfait">Forfait</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {sousTraitanceData.prixType === "fixe" && (
                    <div>
                      <Label>Montant fixe *</Label>
                      <Input value={sousTraitanceData.prixMontant} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixMontant: e.target.value})} placeholder="Ex: 50 000 €" />
                    </div>
                  )}
                  {sousTraitanceData.prixType === "horaire" && (
                    <div>
                      <Label>Taux horaire *</Label>
                      <Input value={sousTraitanceData.prixTauxHoraire} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixTauxHoraire: e.target.value})} placeholder="Ex: 80 €/heure" />
                    </div>
                  )}
                  {sousTraitanceData.prixType === "forfait" && (
                    <div>
                      <Label>Montant du forfait *</Label>
                      <Input value={sousTraitanceData.prixMontant} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixMontant: e.target.value})} placeholder="Ex: 5 000 €/mois" />
                    </div>
                  )}
                  <div>
                    <Label>Facturation</Label>
                    <Select value={sousTraitanceData.prixFacturation} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixFacturation: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="mensuelle">Mensuelle</SelectItem>
                        <SelectItem value="mission">À la mission</SelectItem>
                        <SelectItem value="étapes">Par étapes</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Révision de prix possible ?</Label>
                    <Select value={sousTraitanceData.prixRevision} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixRevision: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {sousTraitanceData.prixRevision === "oui" && (
                    <div>
                      <Label>Indexation</Label>
                      <Input value={sousTraitanceData.prixRevisionIndexation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixRevisionIndexation: e.target.value})} placeholder="Ex: indice INSEE, inflation..." />
                    </div>
                  )}
                  <div>
                    <Label>Frais annexes</Label>
                    <Input value={sousTraitanceData.prixFraisAnnexes} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixFraisAnnexes: e.target.value})} placeholder="Ex: déplacements, licences..." />
                  </div>
                  <div>
                    <Label>Remboursements éventuels</Label>
                    <Input value={sousTraitanceData.prixRemboursements} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixRemboursements: e.target.value})} placeholder="Ex: frais kilométriques..." />
                  </div>
                  <div>
                    <Label>Délais de paiement (jours)</Label>
                    <Select value={sousTraitanceData.prixDelaisPaiement} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixDelaisPaiement: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="0">Comptant</SelectItem>
                        <SelectItem value="15">15 jours</SelectItem>
                        <SelectItem value="30">30 jours</SelectItem>
                        <SelectItem value="45">45 jours</SelectItem>
                        <SelectItem value="60">60 jours</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Pénalités de retard légales ?</Label>
                    <Select value={sousTraitanceData.prixPenalitesRetard} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixPenalitesRetard: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="applicable">Applicable</SelectItem>
                        <SelectItem value="non_applicable">Non applicable</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Options avancées</h5>
                    <div>
                      <Label>Prime de performance ?</Label>
                      <Select value={sousTraitanceData.prixPrimePerformance} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixPrimePerformance: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.prixPrimePerformance === "oui" && (
                      <div>
                        <Label>Conditions de la prime</Label>
                        <Textarea value={sousTraitanceData.prixPrimeConditions} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixPrimeConditions: e.target.value})} placeholder="Conditions d'attribution..." rows={2} />
                      </div>
                    )}
                    <div>
                      <Label>Retenue de garantie ?</Label>
                      <Select value={sousTraitanceData.prixRetenueGarantie} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixRetenueGarantie: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.prixRetenueGarantie === "oui" && (
                      <div>
                        <Label>Pourcentage retenu</Label>
                        <Input value={sousTraitanceData.prixRetenuePercentage} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixRetenuePercentage: e.target.value})} placeholder="Ex: 10%" />
                      </div>
                    )}
                    <div>
                      <Label>Acomptes ?</Label>
                      <Select value={sousTraitanceData.prixAcomptes} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, prixAcomptes: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.prixAcomptes === "oui" && (
                      <div>
                        <Label>Détails des acomptes</Label>
                        <Textarea value={sousTraitanceData.prixAcomptesDetails} onChange={(e) => setSousTraitanceData({...sousTraitanceData, prixAcomptesDetails: e.target.value})} placeholder="Ex: 30% à la commande, 40% à mi-parcours..." rows={2} />
                      </div>
                    )}
                  </div>
                  <SingleFileUpload
                    label="Budget détaillé"
                    files={sousTraitanceBudgetFiles}
                    onFilesChange={setSousTraitanceBudgetFiles}
                    role="avocat"
                  />
                </div>

                {/* DÉLAIS & CALENDRIER */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Délais & calendrier d'exécution</h4>
                  <div>
                    <Label>Type de mission</Label>
                    <Select value={sousTraitanceData.delaiType} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, delaiType: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="déterminé">Durée déterminée</SelectItem>
                        <SelectItem value="continu">Mission continue</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <Label>Date de début *</Label>
                      <Input type="date" value={sousTraitanceData.delaiDebut} onChange={(e) => setSousTraitanceData({...sousTraitanceData, delaiDebut: e.target.value})} />
                    </div>
                    {sousTraitanceData.delaiType === "déterminé" && (
                      <div>
                        <Label>Date de fin *</Label>
                        <Input type="date" value={sousTraitanceData.delaiFin} onChange={(e) => setSousTraitanceData({...sousTraitanceData, delaiFin: e.target.value})} />
                      </div>
                    )}
                  </div>
                  <div>
                    <Label>Planning détaillé</Label>
                    <Textarea value={sousTraitanceData.delaiPlanning} onChange={(e) => setSousTraitanceData({...sousTraitanceData, delaiPlanning: e.target.value})} placeholder="Décrivez le planning..." rows={3} />
                  </div>
                  <div>
                    <Label>Délais jalons (milestones)</Label>
                    <Textarea value={sousTraitanceData.delaiJalons} onChange={(e) => setSousTraitanceData({...sousTraitanceData, delaiJalons: e.target.value})} placeholder="Ex: Jalon 1 - 15/03, Jalon 2 - 30/04..." rows={3} />
                  </div>
                  <div>
                    <Label>Conditions de report ou interruption</Label>
                    <Textarea value={sousTraitanceData.delaiReportConditions} onChange={(e) => setSousTraitanceData({...sousTraitanceData, delaiReportConditions: e.target.value})} placeholder="Ex: force majeure, retard du donneur d'ordre..." rows={2} />
                  </div>
                  <SingleFileUpload
                    label="Planning détaillé (Gantt, etc.)"
                    files={sousTraitancePlanningFiles}
                    onFilesChange={setSousTraitancePlanningFiles}
                    role="avocat"
                  />
                </div>

                {/* CONFIDENTIALITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Confidentialité</h4>
                  <div className="p-3 bg-amber-50 border border-amber-200 rounded">
                    <p className="text-sm text-amber-800">⚠️ Clause indispensable en sous-traitance</p>
                  </div>
                  <div>
                    <Label>Définition des informations confidentielles *</Label>
                    <Textarea value={sousTraitanceData.confidentialiteDefinition} onChange={(e) => setSousTraitanceData({...sousTraitanceData, confidentialiteDefinition: e.target.value})} placeholder="Ex: données clients, procédés, savoir-faire..." rows={3} />
                  </div>
                  <div>
                    <Label>Durée d'obligation (années après fin du contrat)</Label>
                    <Select value={sousTraitanceData.confidentialiteDuree} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, confidentialiteDuree: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="3">3 ans</SelectItem>
                        <SelectItem value="5">5 ans</SelectItem>
                        <SelectItem value="10">10 ans</SelectItem>
                        <SelectItem value="illimité">Illimité</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="flex items-center gap-2">
                    <input type="checkbox" id="confInterd" checked={sousTraitanceData.confidentialiteInterdictionUtilisation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, confidentialiteInterdictionUtilisation: e.target.checked})} className="rounded" />
                    <Label htmlFor="confInterd" className="cursor-pointer">Interdiction d'utilisation hors contrat</Label>
                  </div>
                  <div>
                    <Label>Obligations de sécurité</Label>
                    <Textarea value={sousTraitanceData.confidentialiteObligationsSecurite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, confidentialiteObligationsSecurite: e.target.value})} placeholder="Ex: chiffrement, accès restreints..." rows={2} />
                  </div>
                  <div>
                    <Label>Retour ou destruction des données en fin de contrat</Label>
                    <Select value={sousTraitanceData.confidentialiteRetourDonnees} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, confidentialiteRetourDonnees: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="restitution">Restitution</SelectItem>
                        <SelectItem value="destruction">Destruction</SelectItem>
                        <SelectItem value="restitution_destruction">Restitution + Destruction</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  <div className="p-3 bg-blue-50 border border-blue-300 rounded">
                    <p className="text-sm text-blue-800">⚠️ Même sans création originale, les livrables peuvent être protégeables</p>
                  </div>
                  <div>
                    <Label>Création de propriété intellectuelle ?</Label>
                    <Select value={sousTraitanceData.piCreation} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piCreation: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  {/* Champs livrables (toujours affichés) */}
                  <div>
                    <Label>Les livrables incluent-ils des éléments protégeables (documents, code, designs...) ?</Label>
                    <Select value={sousTraitanceData.piLivrablesProtectables} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piLivrablesProtectables: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  {sousTraitanceData.piLivrablesProtectables === "oui" && (
                    <>
                      <div>
                        <Label>Régime applicable aux livrables *</Label>
                        <Select value={sousTraitanceData.piCessionLivrables} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piCessionLivrables: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="cession">Cession complète au donneur d'ordre</SelectItem>
                            <SelectItem value="licence">Licence d'utilisation</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Étendue géographique *</Label>
                        <Select value={sousTraitanceData.piEtendueGeographique} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piEtendueGeographique: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="monde">Monde entier</SelectItem>
                            <SelectItem value="france">France uniquement</SelectItem>
                            <SelectItem value="ue">Union Européenne</SelectItem>
                            <SelectItem value="autre">Autre (préciser)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Durée de la cession/licence *</Label>
                        <Select value={sousTraitanceData.piEtendueDuree} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piEtendueDuree: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="illimité">Illimitée</SelectItem>
                            <SelectItem value="contrat">Durée du contrat uniquement</SelectItem>
                            <SelectItem value="autre">Autre durée (préciser)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Supports et modes d'exploitation *</Label>
                        <Select value={sousTraitanceData.piEtendueSupports} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piEtendueSupports: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="tous">Tous supports (impression, web, mobile...)</SelectItem>
                            <SelectItem value="limité">Supports limités (préciser)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="flex items-center">
                        <input type="checkbox" checked={sousTraitanceData.piDroitsAdaptation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piDroitsAdaptation: e.target.checked})} className="mr-2" />
                        <Label>Droit d'adaptation et de modification par le donneur d'ordre</Label>
                      </div>
                      <div className="flex items-center">
                        <input type="checkbox" checked={sousTraitanceData.piDroitsModification} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piDroitsModification: e.target.checked})} className="mr-2" />
                        <Label>Droit de modifier, corriger et faire évoluer</Label>
                      </div>
                    </>
                  )}
                  
                  {sousTraitanceData.piCreation === "non" && (
                    <div className="flex items-center gap-2">
                      <input type="checkbox" id="piInterd" checked={sousTraitanceData.piInterdictionUtilisation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piInterdictionUtilisation: e.target.checked})} className="rounded" />
                      <Label htmlFor="piInterd" className="cursor-pointer">Interdiction d'utiliser les marques/images/logiciels hors contrat</Label>
                    </div>
                  )}
                  
                  {sousTraitanceData.piCreation === "oui" && (
                    <>
                      <div>
                        <Label>Titularité des droits *</Label>
                        <Select value={sousTraitanceData.piTitularite} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, piTitularite: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="donneur">Cession totale au donneur d'ordre</SelectItem>
                            <SelectItem value="licence">Licence d'utilisation</SelectItem>
                            <SelectItem value="copropriété">Copropriété</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {sousTraitanceData.piTitularite === "licence" && (
                        <>
                          <div>
                            <Label>Durée de la licence</Label>
                            <Input value={sousTraitanceData.piCessionDuree} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piCessionDuree: e.target.value})} placeholder="Ex: Durée du contrat + 5 ans" />
                          </div>
                          <div>
                            <Label>Territoire</Label>
                            <Input value={sousTraitanceData.piCessionTerritoire} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piCessionTerritoire: e.target.value})} placeholder="Ex: Monde entier, France..." />
                          </div>
                          <div>
                            <Label>Modes d'exploitation</Label>
                            <Textarea value={sousTraitanceData.piCessionExploitation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piCessionExploitation: e.target.value})} placeholder="Ex: reproduction, représentation..." rows={2} />
                          </div>
                        </>
                      )}
                      <div>
                        <Label>Droit moral</Label>
                        <Input value={sousTraitanceData.piDroitMoral} onChange={(e) => setSousTraitanceData({...sousTraitanceData, piDroitMoral: e.target.value})} placeholder="Ex: Mention du nom de l'auteur..." />
                      </div>
                    </>
                  )}
                </div>

                {/* RGPD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Protection des données (RGPD)</h4>
                  <div className="p-3 bg-amber-50 border border-amber-200 rounded">
                    <p className="text-sm text-amber-800">⚠️ Obligatoire si des données personnelles sont concernées</p>
                  </div>
                  <div>
                    <Label>RGPD applicable ?</Label>
                    <Select value={sousTraitanceData.rgpdApplicable} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, rgpdApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  
                  {sousTraitanceData.rgpdApplicable === "oui" && (
                    <>
                      <div>
                        <Label>Qualification des parties (Article 28 RGPD) *</Label>
                        <Select value={sousTraitanceData.rgpdQualification} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, rgpdQualification: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="responsable">Le donneur d'ordre est responsable, le sous-traitant est sous-traitant</SelectItem>
                            <SelectItem value="coresponsables">Les deux parties sont co-responsables</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Instructions documentées du responsable *</Label>
                        <Textarea value={sousTraitanceData.rgpdInstructionsDocumentees} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdInstructionsDocumentees: e.target.value})} placeholder="Décrivez les instructions précises données au sous-traitant pour le traitement des données..." rows={3} />
                      </div>
                      <div>
                        <Label>Sort des données à la fin du contrat *</Label>
                        <Select value={sousTraitanceData.rgpdSortDonneesFinContrat} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, rgpdSortDonneesFinContrat: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="restitution">Restitution au donneur d'ordre</SelectItem>
                            <SelectItem value="suppression">Suppression définitive</SelectItem>
                            <SelectItem value="anonymisation">Anonymisation</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Contrat de sous-traitance RGPD intégré ?</Label>
                        <Select value={sousTraitanceData.rgpdContratIntegre} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, rgpdContratIntegre: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non (annexe séparée)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Catégories de données traitées *</Label>
                        <Textarea value={sousTraitanceData.rgpdCategories} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdCategories: e.target.value})} placeholder="Ex: nom, prénom, email, adresse..." rows={3} />
                      </div>
                      <div>
                        <Label>Finalités du traitement *</Label>
                        <Textarea value={sousTraitanceData.rgpdFinalites} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdFinalites: e.target.value})} placeholder="Ex: Gestion de la relation client..." rows={2} />
                      </div>
                      <div>
                        <Label>Durée de conservation</Label>
                        <Input value={sousTraitanceData.rgpdDuree} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdDuree: e.target.value})} placeholder="Ex: Durée du contrat + 3 ans" />
                      </div>
                      <div>
                        <Label>Mesures de sécurité techniques *</Label>
                        <Textarea value={sousTraitanceData.rgpdSecurite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdSecurite: e.target.value})} placeholder="Ex: chiffrement, pseudonymisation..." rows={3} />
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="rgpdNotif" checked={sousTraitanceData.rgpdNotification} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdNotification: e.target.checked})} className="rounded" />
                        <Label htmlFor="rgpdNotif" className="cursor-pointer">Obligation de notification en cas de violation de données</Label>
                      </div>
                      <div>
                        <Label>Localisation des serveurs</Label>
                        <Input value={sousTraitanceData.rgpdLocalisation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdLocalisation: e.target.value})} placeholder="Ex: France, UE..." />
                      </div>
                      <div>
                        <Label>Sous-traitants ultérieurs</Label>
                        <Select value={sousTraitanceData.rgpdSousTraitantsUlterieurs} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, rgpdSousTraitantsUlterieurs: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="interdits">Interdits</SelectItem>
                            <SelectItem value="autorisation_prealable">Autorisation préalable obligatoire</SelectItem>
                            <SelectItem value="liste">Liste autorisée</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Les deux parties sont co-responsables ?</Label>
                        <Select value={sousTraitanceData.rgpdCoresponsables} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, rgpdCoresponsables: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {sousTraitanceData.rgpdCoresponsables === "oui" && (
                        <div>
                          <Label>Accord de répartition des responsabilités</Label>
                          <Textarea value={sousTraitanceData.rgpdAccordRepartition} onChange={(e) => setSousTraitanceData({...sousTraitanceData, rgpdAccordRepartition: e.target.value})} placeholder="Qui fait quoi..." rows={3} />
                        </div>
                      )}
                      <SingleFileUpload
                        label="DPA (Accord RGPD)"
                        files={sousTraitanceDPAFiles}
                        onFilesChange={setSousTraitanceDPAFiles}
                        role="avocat"
                      />
                    </>
                  )}
                </div>

                {/* SÉCURITÉ & CONFORMITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Sécurité & conformité</h4>
                  <div>
                    <Label>Protection des systèmes informatiques</Label>
                    <Textarea value={sousTraitanceData.securiteSystemes} onChange={(e) => setSousTraitanceData({...sousTraitanceData, securiteSystemes: e.target.value})} placeholder="Ex: pare-feu, antivirus, mises à jour..." rows={2} />
                  </div>
                  <div>
                    <Label>Accès aux locaux</Label>
                    <Input value={sousTraitanceData.securiteAcces} onChange={(e) => setSousTraitanceData({...sousTraitanceData, securiteAcces: e.target.value})} placeholder="Ex: badge, code..." />
                  </div>
                  <div>
                    <Label>Politique de cybersécurité</Label>
                    <Textarea value={sousTraitanceData.securiteCyber} onChange={(e) => setSousTraitanceData({...sousTraitanceData, securiteCyber: e.target.value})} placeholder="Décrivez la politique..." rows={2} />
                  </div>
                  <div>
                    <Label>Exigence de chiffrement (si données sensibles) ?</Label>
                    <Select value={sousTraitanceData.securiteChiffrement} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, securiteChiffrement: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Conformité légale (normes sectorielles, licences)</Label>
                    <Textarea value={sousTraitanceData.conformiteLegale} onChange={(e) => setSousTraitanceData({...sousTraitanceData, conformiteLegale: e.target.value})} placeholder="Ex: ISO 27001, certifications..." rows={2} />
                  </div>
                  <SingleFileUpload
                    label="Charte de sécurité"
                    files={sousTraitanceCharteSecuriteFiles}
                    onFilesChange={setSousTraitanceCharteSecuriteFiles}
                    role="avocat"
                  />
                </div>

                {/* VÉRIFICATION & AUDITS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Vérification & audits</h4>
                  <div>
                    <Label>Le donneur d'ordre peut auditer ?</Label>
                    <Select value={sousTraitanceData.auditAutorise} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, auditAutorise: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {sousTraitanceData.auditAutorise === "oui" && (
                    <>
                      <div>
                        <Label>Fréquence des audits</Label>
                        <Input value={sousTraitanceData.auditFrequence} onChange={(e) => setSousTraitanceData({...sousTraitanceData, auditFrequence: e.target.value})} placeholder="Ex: Annuel, trimestriel..." />
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="auditDoc" checked={sousTraitanceData.auditDocumentation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, auditDocumentation: e.target.checked})} className="rounded" />
                        <Label htmlFor="auditDoc" className="cursor-pointer">Exiger documentation / logs</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="auditCorr" checked={sousTraitanceData.auditCorrections} onChange={(e) => setSousTraitanceData({...sousTraitanceData, auditCorrections: e.target.checked})} className="rounded" />
                        <Label htmlFor="auditCorr" className="cursor-pointer">Imposer des mesures correctives</Label>
                      </div>
                    </>
                  )}
                </div>

                {/* RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Responsabilité</h4>
                  <div>
                    <Label>Responsabilité en cas de faute</Label>
                    <Textarea value={sousTraitanceData.responsabiliteFaute} onChange={(e) => setSousTraitanceData({...sousTraitanceData, responsabiliteFaute: e.target.value})} placeholder="Décrivez les conditions..." rows={2} />
                  </div>
                  <div>
                    <Label>Plafond de responsabilité</Label>
                    <Input value={sousTraitanceData.responsabilitePlafond} onChange={(e) => setSousTraitanceData({...sousTraitanceData, responsabilitePlafond: e.target.value})} placeholder="Ex: Montant du contrat, 100 000 €..." />
                  </div>
                  <div className="flex items-center gap-2">
                    <input type="checkbox" id="respExcl" checked={sousTraitanceData.responsabiliteExclusionIndirects} onChange={(e) => setSousTraitanceData({...sousTraitanceData, responsabiliteExclusionIndirects: e.target.checked})} className="rounded" />
                    <Label htmlFor="respExcl" className="cursor-pointer">Exclusion des dommages indirects</Label>
                  </div>
                  <div className="flex items-center gap-2">
                    <input type="checkbox" id="respCA" checked={sousTraitanceData.responsabiliteExclusionPerteCA} onChange={(e) => setSousTraitanceData({...sousTraitanceData, responsabiliteExclusionPerteCA: e.target.checked})} className="rounded" />
                    <Label htmlFor="respCA" className="cursor-pointer">Exclusion de la perte de chiffre d'affaires</Label>
                  </div>
                  <div className="flex items-center gap-2">
                    <input type="checkbox" id="respChance" checked={sousTraitanceData.responsabiliteExclusionPerteChance} onChange={(e) => setSousTraitanceData({...sousTraitanceData, responsabiliteExclusionPerteChance: e.target.checked})} className="rounded" />
                    <Label htmlFor="respChance" className="cursor-pointer">Exclusion de la perte de chance</Label>
                  </div>
                  <div>
                    <Label>Assurance obligatoire ?</Label>
                    <Select value={sousTraitanceData.responsabiliteAssuranceObligatoire} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, responsabiliteAssuranceObligatoire: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Cas de force majeure</Label>
                    <Textarea value={sousTraitanceData.responsabiliteForceMajeure} onChange={(e) => setSousTraitanceData({...sousTraitanceData, responsabiliteForceMajeure: e.target.value})} placeholder="Ex: pandémie, catastrophe naturelle..." rows={2} />
                  </div>
                </div>

                {/* RÉSILIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Résiliation</h4>
                  
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Résiliation avec préavis</h5>
                    <div>
                      <Label>Préavis (jours)</Label>
                      <Select value={sousTraitanceData.resiliationPreavis} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, resiliationPreavis: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="30">30 jours</SelectItem>
                          <SelectItem value="60">60 jours</SelectItem>
                          <SelectItem value="90">90 jours</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Résiliation sans motif possible ?</Label>
                      <Select value={sousTraitanceData.resiliationSansMotif} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, resiliationSansMotif: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Résiliation immédiate</h5>
                    <div className="space-y-2">
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="resilFaute" checked={sousTraitanceData.resiliationImmediateFaute} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationImmediateFaute: e.target.checked})} className="rounded" />
                        <Label htmlFor="resilFaute" className="cursor-pointer">Faute grave</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="resilRetard" checked={sousTraitanceData.resiliationImmediateRetard} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationImmediateRetard: e.target.checked})} className="rounded" />
                        <Label htmlFor="resilRetard" className="cursor-pointer">Retard répété</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="resilRGPD" checked={sousTraitanceData.resiliationImmediateRGPD} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationImmediateRGPD: e.target.checked})} className="rounded" />
                        <Label htmlFor="resilRGPD" className="cursor-pointer">Non-respect RGPD</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="resilQual" checked={sousTraitanceData.resiliationImmediateQualite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationImmediateQualite: e.target.checked})} className="rounded" />
                        <Label htmlFor="resilQual" className="cursor-pointer">Défaut de qualité</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="resilImpaye" checked={sousTraitanceData.resiliationImmediateImpayes} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationImmediateImpayes: e.target.checked})} className="rounded" />
                        <Label htmlFor="resilImpaye" className="cursor-pointer">Impayés</Label>
                      </div>
                    </div>
                  </div>

                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Effets de la résiliation</h5>
                    <div className="space-y-2">
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="effetRest" checked={sousTraitanceData.resiliationEffetRestitution} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationEffetRestitution: e.target.checked})} className="rounded" />
                        <Label htmlFor="effetRest" className="cursor-pointer">Restitution du matériel</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="effetLivr" checked={sousTraitanceData.resiliationEffetLivrables} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationEffetLivrables: e.target.checked})} className="rounded" />
                        <Label htmlFor="effetLivr" className="cursor-pointer">Transmission des livrables</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="effetPaie" checked={sousTraitanceData.resiliationEffetPaiement} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationEffetPaiement: e.target.checked})} className="rounded" />
                        <Label htmlFor="effetPaie" className="cursor-pointer">Paiement du travail réalisé</Label>
                      </div>
                      <div className="flex items-center gap-2">
                        <input type="checkbox" id="effetAcces" checked={sousTraitanceData.resiliationEffetAcces} onChange={(e) => setSousTraitanceData({...sousTraitanceData, resiliationEffetAcces: e.target.checked})} className="rounded" />
                        <Label htmlFor="effetAcces" className="cursor-pointer">Suppression des accès</Label>
                      </div>
                    </div>
                  </div>
                </div>

                {/* NON-SOLLICITATION & NON-CONCURRENCE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Non-sollicitation & Non-concurrence</h4>
                  
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Non-sollicitation du personnel</h5>
                    <div>
                      <Label>Non-sollicitation applicable ?</Label>
                      <Select value={sousTraitanceData.nonSollicitationApplicable} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, nonSollicitationApplicable: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.nonSollicitationApplicable === "oui" && (
                      <>
                        <div>
                          <Label>Durée (mois)</Label>
                          <Select value={sousTraitanceData.nonSollicitationDuree} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, nonSollicitationDuree: val})}>
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="12">12 mois</SelectItem>
                              <SelectItem value="24">24 mois</SelectItem>
                              <SelectItem value="36">36 mois</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div>
                          <Label>Pénalité financière</Label>
                          <Input value={sousTraitanceData.nonSollicitationPenalite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, nonSollicitationPenalite: e.target.value})} placeholder="Ex: 50 000 € par employé débauchésé" />
                        </div>
                      </>
                    )}
                  </div>

                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-medium text-gray-700">Non-concurrence (optionnelle)</h5>
                    <div className="p-3 bg-amber-50 border border-amber-200 rounded">
                      <p className="text-sm text-amber-800">⚠️ Valable uniquement si proportionnée</p>
                    </div>
                    <div>
                      <Label>Non-concurrence applicable ?</Label>
                      <Select value={sousTraitanceData.nonConcurrenceApplicable} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, nonConcurrenceApplicable: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {sousTraitanceData.nonConcurrenceApplicable === "oui" && (
                      <>
                        <div>
                          <Label>Zone géographique</Label>
                          <Input value={sousTraitanceData.nonConcurrenceZone} onChange={(e) => setSousTraitanceData({...sousTraitanceData, nonConcurrenceZone: e.target.value})} placeholder="Ex: France, Île-de-France..." />
                        </div>
                        <div>
                          <Label>Durée</Label>
                          <Input value={sousTraitanceData.nonConcurrenceDuree} onChange={(e) => setSousTraitanceData({...sousTraitanceData, nonConcurrenceDuree: e.target.value})} placeholder="Ex: 12 mois" />
                        </div>
                        <div>
                          <Label>Secteur concerné</Label>
                          <Input value={sousTraitanceData.nonConcurrenceSecteur} onChange={(e) => setSousTraitanceData({...sousTraitanceData, nonConcurrenceSecteur: e.target.value})} placeholder="Ex: Logiciels CRM..." />
                        </div>
                      </>
                    )}
                  </div>
                </div>

                {/* SOUS-TRAITANCE EN CASCADE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Sous-traitance en cascade</h4>
                  <div>
                    <Label>Sous-traitance en cascade *</Label>
                    <Select value={sousTraitanceData.cascadeAutorisee} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, cascadeAutorisee: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="autorisée">Autorisée</SelectItem>
                        <SelectItem value="interdite">Interdite</SelectItem>
                        <SelectItem value="validation">Autorisée sous validation du donneur d'ordre</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Responsabilité du premier sous-traitant</Label>
                    <Textarea value={sousTraitanceData.cascadeResponsabilite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, cascadeResponsabilite: e.target.value})} placeholder="Le sous-traitant reste responsable..." rows={2} />
                  </div>
                  <div className="flex items-center">
                    <input type="checkbox" checked={sousTraitanceData.cascadeResponsabilitePleineEntiere} onChange={(e) => setSousTraitanceData({...sousTraitanceData, cascadeResponsabilitePleineEntiere: e.target.checked})} className="mr-2" />
                    <Label>Le sous-traitant demeure pleinement et entièrement responsable vis-à-vis du donneur d'ordre de toute sous-traitance ultérieure</Label>
                  </div>
                  <div className="flex items-center">
                    <input type="checkbox" checked={sousTraitanceData.cascadeSousTraitantsMemesObligations} onChange={(e) => setSousTraitanceData({...sousTraitanceData, cascadeSousTraitantsMemesObligations: e.target.checked})} className="mr-2" />
                    <Label>Les sous-traitants ultérieurs sont tenus aux mêmes obligations que le sous-traitant principal</Label>
                  </div>
                </div>

                {/* CLAUSES GÉNÉRALES ESSENTIELLES */}
                <div className="space-y-6 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clauses générales essentielles</h4>
                  
                  {/* Clause d'indépendance */}
                  <div className="space-y-3">
                    <h5 className="font-medium text-blue-800">Clause d'indépendance des parties</h5>
                    <div className="flex items-center">
                      <input type="checkbox" checked={sousTraitanceData.clauseIndependanceParties} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseIndependanceParties: e.target.checked})} className="mr-2" />
                      <Label>Le sous-traitant agit en toute indépendance</Label>
                    </div>
                    <div>
                      <Label>Absence de lien de subordination</Label>
                      <Textarea value={sousTraitanceData.clauseAbsenceSubordination} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseAbsenceSubordination: e.target.value})} placeholder="Le sous-traitant agit en toute indépendance, sans lien de subordination avec le donneur d'ordre..." rows={2} />
                    </div>
                    <div>
                      <Label>Liberté d'organisation</Label>
                      <Textarea value={sousTraitanceData.clauseLiberteOrganisation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseLiberteOrganisation: e.target.value})} placeholder="Le sous-traitant organise librement son travail et ses moyens..." rows={2} />
                    </div>
                    <div>
                      <Label>Aucun pouvoir de représentation</Label>
                      <Textarea value={sousTraitanceData.clauseAucunPouvoirRepresentation} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseAucunPouvoirRepresentation: e.target.value})} placeholder="Le sous-traitant n'a aucun pouvoir pour engager le donneur d'ordre..." rows={2} />
                    </div>
                  </div>
                  
                  {/* Clause non-création société */}
                  <div className="space-y-2">
                    <h5 className="font-medium text-blue-800">Clause de non-création de société</h5>
                    <div className="flex items-center">
                      <input type="checkbox" checked={sousTraitanceData.clauseNonCreationSociete} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseNonCreationSociete: e.target.checked})} className="mr-2" />
                      <Label>Le présent contrat ne crée aucune société de fait</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={sousTraitanceData.clauseNonGIE} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseNonGIE: e.target.checked})} className="mr-2" />
                      <Label>Aucun groupement d'intérêt économique (GIE)</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={sousTraitanceData.clauseNonMandatImplicite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseNonMandatImplicite: e.target.checked})} className="mr-2" />
                      <Label>Aucun mandat implicite ou apparent</Label>
                    </div>
                  </div>
                  
                  {/* Clause de cession */}
                  <div className="space-y-3">
                    <h5 className="font-medium text-blue-800">Clause de cession du contrat</h5>
                    <div className="flex items-center">
                      <input type="checkbox" checked={sousTraitanceData.clauseCessionInterdite} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseCessionInterdite: e.target.checked})} className="mr-2" />
                      <Label>Interdiction de céder le contrat sans accord écrit préalable</Label>
                    </div>
                    {!sousTraitanceData.clauseCessionInterdite && (
                      <div>
                        <Label>Conditions de cession autorisée</Label>
                        <Textarea value={sousTraitanceData.clauseCessionConditions} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseCessionConditions: e.target.value})} placeholder="Le contrat peut être cédé avec l'accord écrit préalable..." rows={2} />
                      </div>
                    )}
                  </div>
                  
                  {/* Clause continuité/réversibilité */}
                  <div className="space-y-3">
                    <h5 className="font-medium text-blue-800">Clause de continuité et réversibilité</h5>
                    <div>
                      <Label>Obligation de continuité minimale</Label>
                      <Textarea value={sousTraitanceData.clauseContinuiteService} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseContinuiteService: e.target.value})} placeholder="En cas de résiliation, le sous-traitant assure la continuité pendant [durée]..." rows={2} />
                    </div>
                    <div>
                      <Label>Modalités de transfert des opérations</Label>
                      <Textarea value={sousTraitanceData.clauseReversibiliteTransfert} onChange={(e) => setSousTraitanceData({...sousTraitanceData, clauseReversibiliteTransfert: e.target.value})} placeholder="Le sous-traitant remet toute documentation nécessaire..." rows={2} />
                    </div>
                    <div>
                      <Label>Assistance pendant la transition</Label>
                      <Select value={sousTraitanceData.clauseReversibiliteAssistance} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, clauseReversibiliteAssistance: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Aucune assistance</SelectItem>
                          <SelectItem value="gratuite">Assistance gratuite incluse</SelectItem>
                          <SelectItem value="payante">Assistance payante sur devis</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* RÈGLEMENT DES LITIGES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Règlement des litiges</h4>
                  <div>
                    <Label>Loi applicable</Label>
                    <Select value={sousTraitanceData.loiApplicable} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, loiApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="française">Droit français</SelectItem>
                        <SelectItem value="autre">Autre droit</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Tribunal compétent</Label>
                    <Input value={sousTraitanceData.tribunalCompetent} onChange={(e) => setSousTraitanceData({...sousTraitanceData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunal de commerce de Paris" />
                  </div>
                  <div>
                    <Label>Clause de médiation ?</Label>
                    <Select value={sousTraitanceData.mediationClause} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, mediationClause: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Arbitrage ?</Label>
                    <Select value={sousTraitanceData.arbitrage} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, arbitrage: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* NOTIFICATIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Notifications (optionnel)</h4>
                  <div className="p-3 bg-blue-50 border border-blue-300 rounded">
                    <p className="text-sm text-blue-800">💡 Préciser les modalités de notification recommandé pour les mises en demeure</p>
                  </div>
                  <div>
                    <Label>Adresse postale pour notifications</Label>
                    <Input value={sousTraitanceData.notificationAdresse} onChange={(e) => setSousTraitanceData({...sousTraitanceData, notificationAdresse: e.target.value})} placeholder="Adresse complète pour courrier recommandé..." />
                  </div>
                  <div>
                    <Label>Email pour notifications</Label>
                    <Input value={sousTraitanceData.notificationEmail} onChange={(e) => setSousTraitanceData({...sousTraitanceData, notificationEmail: e.target.value})} placeholder="email@exemple.com" type="email" />
                  </div>
                  <div>
                    <Label>Notifications par recommandé avec AR ?</Label>
                    <Select value={sousTraitanceData.notificationRecommande} onValueChange={(val) => setSousTraitanceData({...sousTraitanceData, notificationRecommande: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui, recommandé avec AR obligatoire</SelectItem>
                        <SelectItem value="non">Non, email suffit</SelectItem>
                        <SelectItem value="grave">Recommandé avec AR seulement pour notifications graves (résiliation, mise en demeure)</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes possibles</h4>
                  <SingleFileUpload
                    label="Documentation technique"
                    files={sousTraitanceDocTechniqueFiles}
                    onFilesChange={setSousTraitanceDocTechniqueFiles}
                    role="avocat"
                  />
                  <div>
                    <Label>Observations finales / Clauses particulières</Label>
                    <Textarea value={sousTraitanceData.annexesDescriptions} onChange={(e) => setSousTraitanceData({...sousTraitanceData, annexesDescriptions: e.target.value})} placeholder="Précisions complémentaires..." rows={4} />
                  </div>
                </div>
              </div>
            )}

            {/* Formulaire NDA (Accord de confidentialité) */}
            {pendingContractType === "NDA (Accord de confidentialité)" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🔒 NDA (Accord de Confidentialité)</h3>
                
                {/* CLIENT CONCERNÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">👤 Client concerné</h4>
                  <div className="space-y-2">
                    <Label>Sélectionner le client</Label>
                    <Select 
                      value={selectedClientId}
                      onValueChange={(value) => {
                        setSelectedClientId(value);
                        const client = clients.find(c => c.id === value);
                        if (client) {
                          setGenericDescription(`Contrat NDA pour ${client.prenom} ${client.nom}`);
                        }
                      }}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Choisir un client" />
                      </SelectTrigger>
                      <SelectContent>
                        {clients.map((client) => (
                          <SelectItem key={client.id} value={client.id}>
                            {client.prenom} {client.nom}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="space-y-2">
                    <Label>Description du contrat</Label>
                    <textarea 
                      value={genericDescription}
                      onChange={(e) => setGenericDescription(e.target.value)}
                      placeholder="Décrivez brièvement le contrat NDA..."
                      className="w-full min-h-[100px] p-2 border rounded-md"
                    />
                  </div>
                </div>

                {/* TYPE DE NDA */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Type de NDA</h4>
                  <div>
                    <Label>Type d'accord *</Label>
                    <Select value={ndaData.typeNda} onValueChange={(val) => setNdaData({...ndaData, typeNda: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="bilateral">Bilatéral (échanges mutuels d'informations)</SelectItem>
                        <SelectItem value="unilateral">Unilatéral (une seule partie divulgue)</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {ndaData.typeNda === "unilateral" && (
                    <div>
                      <Label>Partie émettrice (qui divulgue) *</Label>
                      <Select value={ndaData.partieEmettrice} onValueChange={(val) => setNdaData({...ndaData, partieEmettrice: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="partie1">Partie 1</SelectItem>
                          <SelectItem value="partie2">Partie 2</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                </div>

                {/* PARTIE 1 */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Partie 1</h4>
                  <div className="space-y-2">
                    <Label>Sélectionner un client existant (optionnel) - Partie 1</Label>
                    <Select value={ndaClientId1} onValueChange={setNdaClientId1}>
                      <SelectTrigger>
                        <SelectValue placeholder="Choisir un client" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                        {clients.map((client) => (
                          <SelectItem key={client.id} value={client.id}>
                            {client.prenom} {client.nom}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Dénomination sociale / Nom complet *</Label>
                    <Input value={ndaData.partie1Nom} onChange={(e) => setNdaData({...ndaData, partie1Nom: e.target.value})} placeholder="Ex: ACME SAS" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label>Forme juridique</Label>
                      <Input value={ndaData.partie1FormeJuridique} onChange={(e) => setNdaData({...ndaData, partie1FormeJuridique: e.target.value})} placeholder="Ex: SAS, SARL..." />
                    </div>
                    <div>
                      <Label>Capital</Label>
                      <Input value={ndaData.partie1Capital} onChange={(e) => setNdaData({...ndaData, partie1Capital: e.target.value})} placeholder="Ex: 10 000 €" />
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label>RCS / SIREN</Label>
                      <Input value={ndaData.partie1RCS} onChange={(e) => setNdaData({...ndaData, partie1RCS: e.target.value})} placeholder="Ex: 123 456 789" />
                    </div>
                    <div>
                      <Label>Pays</Label>
                      <Input value={ndaData.partie1Pays} onChange={(e) => setNdaData({...ndaData, partie1Pays: e.target.value})} placeholder="France" />
                    </div>
                  </div>
                  <div>
                    <Label>Adresse du siège</Label>
                    <Input value={ndaData.partie1Siege} onChange={(e) => setNdaData({...ndaData, partie1Siege: e.target.value})} placeholder="Adresse complète" />
                  </div>
                  <div>
                    <Label>Représentant légal (nom + fonction)</Label>
                    <Input value={ndaData.partie1Representant} onChange={(e) => setNdaData({...ndaData, partie1Representant: e.target.value})} placeholder="Ex: M. Dupont, Président" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label>Email</Label>
                      <Input type="email" value={ndaData.partie1Email} onChange={(e) => setNdaData({...ndaData, partie1Email: e.target.value})} placeholder="contact@exemple.com" />
                    </div>
                    <div>
                      <Label>Téléphone</Label>
                      <Input type="tel" value={ndaData.partie1Telephone} onChange={(e) => setNdaData({...ndaData, partie1Telephone: e.target.value})} placeholder="01 23 45 67 89" />
                    </div>
                  </div>
                  <SingleFileUpload label="Kbis Partie 1" files={ndaPartie1KbisFiles} onFilesChange={setNdaPartie1KbisFiles} role="avocat" />
                  <SingleFileUpload label="Identité représentant Partie 1" files={ndaPartie1IdentiteFiles} onFilesChange={setNdaPartie1IdentiteFiles} role="avocat" />
                  <SingleFileUpload label="Pouvoir de signature Partie 1" files={ndaPartie1PouvoirFiles} onFilesChange={setNdaPartie1PouvoirFiles} role="avocat" />
                  <SingleFileUpload label="Organigramme Partie 1 (optionnel)" files={ndaPartie1OrganigrammeFiles} onFilesChange={setNdaPartie1OrganigrammeFiles} role="avocat" />
                </div>

                {/* PARTIE 2 */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Partie 2</h4>
                  <div className="space-y-2">
                    <Label>Sélectionner un client existant (optionnel) - Partie 2</Label>
                    <Select value={ndaClientId2} onValueChange={setNdaClientId2}>
                      <SelectTrigger>
                        <SelectValue placeholder="Choisir un client" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                        {clients.map((client) => (
                          <SelectItem key={client.id} value={client.id}>
                            {client.prenom} {client.nom}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Dénomination sociale / Nom complet *</Label>
                    <Input value={ndaData.partie2Nom} onChange={(e) => setNdaData({...ndaData, partie2Nom: e.target.value})} placeholder="Ex: TechCorp Inc" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label>Forme juridique</Label>
                      <Input value={ndaData.partie2FormeJuridique} onChange={(e) => setNdaData({...ndaData, partie2FormeJuridique: e.target.value})} placeholder="Ex: SAS, SARL..." />
                    </div>
                    <div>
                      <Label>Capital</Label>
                      <Input value={ndaData.partie2Capital} onChange={(e) => setNdaData({...ndaData, partie2Capital: e.target.value})} placeholder="Ex: 50 000 €" />
                    </div>
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label>RCS / SIREN</Label>
                      <Input value={ndaData.partie2RCS} onChange={(e) => setNdaData({...ndaData, partie2RCS: e.target.value})} placeholder="Ex: 987 654 321" />
                    </div>
                    <div>
                      <Label>Pays</Label>
                      <Input value={ndaData.partie2Pays} onChange={(e) => setNdaData({...ndaData, partie2Pays: e.target.value})} placeholder="France" />
                    </div>
                  </div>
                  <div>
                    <Label>Adresse du siège</Label>
                    <Input value={ndaData.partie2Siege} onChange={(e) => setNdaData({...ndaData, partie2Siege: e.target.value})} placeholder="Adresse complète" />
                  </div>
                  <div>
                    <Label>Représentant légal (nom + fonction)</Label>
                    <Input value={ndaData.partie2Representant} onChange={(e) => setNdaData({...ndaData, partie2Representant: e.target.value})} placeholder="Ex: Mme Martin, Directrice Générale" />
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <Label>Email</Label>
                      <Input type="email" value={ndaData.partie2Email} onChange={(e) => setNdaData({...ndaData, partie2Email: e.target.value})} placeholder="contact@exemple.com" />
                    </div>
                    <div>
                      <Label>Téléphone</Label>
                      <Input type="tel" value={ndaData.partie2Telephone} onChange={(e) => setNdaData({...ndaData, partie2Telephone: e.target.value})} placeholder="01 98 76 54 32" />
                    </div>
                  </div>
                  <SingleFileUpload label="Kbis Partie 2" files={ndaPartie2KbisFiles} onFilesChange={setNdaPartie2KbisFiles} role="avocat" />
                  <SingleFileUpload label="Identité représentant Partie 2" files={ndaPartie2IdentiteFiles} onFilesChange={setNdaPartie2IdentiteFiles} role="avocat" />
                  <SingleFileUpload label="Pouvoir de signature Partie 2" files={ndaPartie2PouvoirFiles} onFilesChange={setNdaPartie2PouvoirFiles} role="avocat" />
                  <SingleFileUpload label="Organigramme Partie 2 (optionnel)" files={ndaPartie2OrganigrammeFiles} onFilesChange={setNdaPartie2OrganigrammeFiles} role="avocat" />
                </div>

                {/* OBJET DU NDA */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du NDA</h4>
                  <div>
                    <Label>Type de projet *</Label>
                    <Select value={ndaData.typeProjet} onValueChange={(val) => setNdaData({...ndaData, typeProjet: val})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="developpement">Développement technologique</SelectItem>
                        <SelectItem value="negociations">Négociations commerciales</SelectItem>
                        <SelectItem value="audit">Audit / Due diligence</SelectItem>
                        <SelectItem value="partenariat">Partenariat stratégique</SelectItem>
                        <SelectItem value="innovation">Innovation / Prototype</SelectItem>
                        <SelectItem value="sourcing">Sourcing fournisseur</SelectItem>
                        <SelectItem value="autre">Autre</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Projet concerné *</Label>
                    <Textarea value={ndaData.projetConcerne} onChange={(e) => setNdaData({...ndaData, projetConcerne: e.target.value})} placeholder="Décrivez le projet..." rows={3} />
                  </div>
                  <div>
                    <Label>But des échanges d'informations</Label>
                    <Textarea value={ndaData.butEchanges} onChange={(e) => setNdaData({...ndaData, butEchanges: e.target.value})} placeholder="Ex: Évaluer la faisabilité d'un partenariat commercial..." rows={3} />
                  </div>
                  <div>
                    <Label>Limites du NDA (ce qui n'est PAS couvert)</Label>
                    <Textarea value={ndaData.limitesNda} onChange={(e) => setNdaData({...ndaData, limitesNda: e.target.value})} placeholder="Ex: Informations publiques, données marketing générales..." rows={2} />
                  </div>
                  <div>
                    <Label>Durée du projet / collaboration</Label>
                    <Input value={ndaData.dureeProjet} onChange={(e) => setNdaData({...ndaData, dureeProjet: e.target.value})} placeholder="Ex: 6 mois, 1 an..." />
                  </div>
                </div>

                {/* DÉFINITION INFORMATION CONFIDENTIELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Définition de "Information Confidentielle"</h4>
                  <div className="p-3 bg-amber-50 border border-amber-200 rounded">
                    <p className="text-sm text-amber-800">⚠️ Même une info non marquée "confidentielle" peut l'être selon le contexte</p>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.documentsEcrits} onChange={(e) => setNdaData({...ndaData, documentsEcrits: e.target.checked})} className="mr-2" />
                      <Label>Documents écrits</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.informationsOrales} onChange={(e) => setNdaData({...ndaData, informationsOrales: e.target.checked})} className="mr-2" />
                      <Label>Informations orales</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.echangesElectroniques} onChange={(e) => setNdaData({...ndaData, echangesElectroniques: e.target.checked})} className="mr-2" />
                      <Label>Échanges électroniques</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.maquettesPrototypes} onChange={(e) => setNdaData({...ndaData, maquettesPrototypes: e.target.checked})} className="mr-2" />
                      <Label>Maquettes / Prototypes / Logiciels</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.donneesCommerciales} onChange={(e) => setNdaData({...ndaData, donneesCommerciales: e.target.checked})} className="mr-2" />
                      <Label>Données commerciales / stratégiques</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.donneesFinancieres} onChange={(e) => setNdaData({...ndaData, donneesFinancieres: e.target.checked})} className="mr-2" />
                      <Label>Données financières</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.donneesRH} onChange={(e) => setNdaData({...ndaData, donneesRH: e.target.checked})} className="mr-2" />
                      <Label>Données RH</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.secretsIndustriels} onChange={(e) => setNdaData({...ndaData, secretsIndustriels: e.target.checked})} className="mr-2" />
                      <Label>Secrets industriels</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.plansAffaires} onChange={(e) => setNdaData({...ndaData, plansAffaires: e.target.checked})} className="mr-2" />
                      <Label>Plans d'affaires</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.codeSource} onChange={(e) => setNdaData({...ndaData, codeSource: e.target.checked})} className="mr-2" />
                      <Label>Code source</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.basesDonnees} onChange={(e) => setNdaData({...ndaData, basesDonnees: e.target.checked})} className="mr-2" />
                      <Label>Bases de données</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.infoNonMarqueeConfidentielle} onChange={(e) => setNdaData({...ndaData, infoNonMarqueeConfidentielle: e.target.checked})} className="mr-2" />
                      <Label>Info non marquée mais confidentielle par contexte</Label>
                    </div>
                  </div>
                </div>

                {/* EXCLUSIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Exclusions (informations NON confidentielles)</h4>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.informationsPubliques} onChange={(e) => setNdaData({...ndaData, informationsPubliques: e.target.checked})} className="mr-2" />
                      <Label>Informations publiques</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.informationsConnues} onChange={(e) => setNdaData({...ndaData, informationsConnues: e.target.checked})} className="mr-2" />
                      <Label>Informations déjà connues de la partie réceptrice</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.informationsTiers} onChange={(e) => setNdaData({...ndaData, informationsTiers: e.target.checked})} className="mr-2" />
                      <Label>Informations obtenues légalement d'un tiers</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.informationsDeveloppees} onChange={(e) => setNdaData({...ndaData, informationsDeveloppees: e.target.checked})} className="mr-2" />
                      <Label>Informations développées indépendamment</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.informationsPubliquesApres} onChange={(e) => setNdaData({...ndaData, informationsPubliquesApres: e.target.checked})} className="mr-2" />
                      <Label>Informations rendues publiques sans faute</Label>
                    </div>
                  </div>
                </div>

                {/* OBLIGATIONS DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations des parties</h4>
                  
                  <h5 className="font-medium text-blue-800">Obligations principales</h5>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.utilisationProjetUniquement} onChange={(e) => setNdaData({...ndaData, utilisationProjetUniquement: e.target.checked})} className="mr-2" />
                      <Label>Utilisation uniquement pour le projet défini</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.nonDivulgationTiers} onChange={(e) => setNdaData({...ndaData, nonDivulgationTiers: e.target.checked})} className="mr-2" />
                      <Label>Non-divulgation à des tiers</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.protectionDocuments} onChange={(e) => setNdaData({...ndaData, protectionDocuments: e.target.checked})} className="mr-2" />
                      <Label>Protection des documents</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.restitutionDestruction} onChange={(e) => setNdaData({...ndaData, restitutionDestruction: e.target.checked})} className="mr-2" />
                      <Label>Restitution ou destruction à la fin du contrat</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.limitationCopies} onChange={(e) => setNdaData({...ndaData, limitationCopies: e.target.checked})} className="mr-2" />
                      <Label>Limitation de copies</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionReverseEngineering} onChange={(e) => setNdaData({...ndaData, interdictionReverseEngineering: e.target.checked})} className="mr-2" />
                      <Label>Interdiction de reverse engineering</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionExtractionDonnees} onChange={(e) => setNdaData({...ndaData, interdictionExtractionDonnees: e.target.checked})} className="mr-2" />
                      <Label>Interdiction d'extraction de données</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-blue-800 mt-4">Obligations de sécurité</h5>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.stockageSecurise} onChange={(e) => setNdaData({...ndaData, stockageSecurise: e.target.checked})} className="mr-2" />
                      <Label>Stockage sécurisé</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.controleAcces} onChange={(e) => setNdaData({...ndaData, controleAcces: e.target.checked})} className="mr-2" />
                      <Label>Contrôle des accès</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.needToKnow} onChange={(e) => setNdaData({...ndaData, needToKnow: e.target.checked})} className="mr-2" />
                      <Label>Communication interne limitée au "need to know"</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.cryptageRecommande} onChange={(e) => setNdaData({...ndaData, cryptageRecommande: e.target.checked})} className="mr-2" />
                      <Label>Cryptage recommandé (optionnel)</Label>
                    </div>
                  </div>
                  
                  <h5 className="font-medium text-blue-800 mt-4">Sous-traitance</h5>
                  <div>
                    <Label>Sous-traitants autorisés ?</Label>
                    <Select value={ndaData.sousTraitantsAutorises} onValueChange={(val) => setNdaData({...ndaData, sousTraitantsAutorises: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui, autorisés</SelectItem>
                        <SelectItem value="non">Non, interdits</SelectItem>
                        <SelectItem value="validation">Autorisés sous validation préalable</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {ndaData.sousTraitantsAutorises !== "non" && (
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.obligationNdaSousTraitants} onChange={(e) => setNdaData({...ndaData, obligationNdaSousTraitants: e.target.checked})} className="mr-2" />
                      <Label>Obligation de NDA avec les sous-traitants</Label>
                    </div>
                  )}
                </div>

                {/* DURÉE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Durée du NDA</h4>
                  <div>
                    <Label>Durée du contrat</Label>
                    <Input value={ndaData.dureeContrat} onChange={(e) => setNdaData({...ndaData, dureeContrat: e.target.value})} placeholder="Ex: 12 mois, 24 mois..." />
                  </div>
                  <div>
                    <Label>Durée de la confidentialité</Label>
                    <Input value={ndaData.dureeConfidentialite} onChange={(e) => setNdaData({...ndaData, dureeConfidentialite: e.target.value})} placeholder="Ex: 3 ans, 5 ans, 10 ans..." />
                  </div>
                  <div className="flex items-center">
                    <input type="checkbox" checked={ndaData.confidentialiteIllimitee} onChange={(e) => setNdaData({...ndaData, confidentialiteIllimitee: e.target.checked})} className="mr-2" />
                    <Label>Confidentialité illimitée (recommandé pour secrets industriels)</Label>
                  </div>
                </div>

                {/* PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Droits de propriété intellectuelle</h4>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.proprieteDivulgateur} onChange={(e) => setNdaData({...ndaData, proprieteDivulgateur: e.target.checked})} className="mr-2" />
                      <Label>Les informations restent la propriété du divulgateur</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.aucuneLicenceImplicite} onChange={(e) => setNdaData({...ndaData, aucuneLicenceImplicite: e.target.checked})} className="mr-2" />
                      <Label>Aucune licence implicite n'est accordée</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionCopie} onChange={(e) => setNdaData({...ndaData, interdictionCopie: e.target.checked})} className="mr-2" />
                      <Label>Interdiction de copier / reproduire / modifier</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.retourDocuments} onChange={(e) => setNdaData({...ndaData, retourDocuments: e.target.checked})} className="mr-2" />
                      <Label>Retour des documents en fin de NDA</Label>
                    </div>
                  </div>
                  <div>
                    <Label>Propriété des développements ultérieurs</Label>
                    <Select value={ndaData.proprieteDeveloppementsUlterieurs} onValueChange={(val) => setNdaData({...ndaData, proprieteDeveloppementsUlterieurs: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="divulgateur">Appartient au divulgateur</SelectItem>
                        <SelectItem value="recepteur">Appartient au récepteur</SelectItem>
                        <SelectItem value="copropriete">Copropriété</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* RGPD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Données personnelles / RGPD</h4>
                  <div>
                    <Label>Traitement de données personnelles ?</Label>
                    <Select value={ndaData.rgpdApplicable} onValueChange={(val) => setNdaData({...ndaData, rgpdApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {ndaData.rgpdApplicable === "oui" && (
                    <>
                      <div>
                        <Label>Base légale</Label>
                        <Input value={ndaData.rgpdBaseLegale} onChange={(e) => setNdaData({...ndaData, rgpdBaseLegale: e.target.value})} placeholder="Ex: consentement, intérêt légitime..." />
                      </div>
                      <div>
                        <Label>Durée de conservation</Label>
                        <Input value={ndaData.rgpdDureeConservation} onChange={(e) => setNdaData({...ndaData, rgpdDureeConservation: e.target.value})} placeholder="Ex: Durée du projet + 3 ans" />
                      </div>
                      <div>
                        <Label>Obligations du récepteur en matière RGPD</Label>
                        <Textarea value={ndaData.rgpdObligations} onChange={(e) => setNdaData({...ndaData, rgpdObligations: e.target.value})} placeholder="Décrivez les obligations..." rows={3} />
                      </div>
                      <div>
                        <Label>Transfert hors UE</Label>
                        <Select value={ndaData.rgpdTransfertHorsUE} onValueChange={(val) => setNdaData({...ndaData, rgpdTransfertHorsUE: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="interdit">Interdit sans autorisation</SelectItem>
                            <SelectItem value="autorise">Autorisé avec garanties</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="flex items-center">
                        <input type="checkbox" checked={ndaData.rgpdNotificationFuite} onChange={(e) => setNdaData({...ndaData, rgpdNotificationFuite: e.target.checked})} className="mr-2" />
                        <Label>Obligation de notifier en cas de fuite</Label>
                      </div>
                      <div className="flex items-center">
                        <input type="checkbox" checked={ndaData.rgpdDPA} onChange={(e) => setNdaData({...ndaData, rgpdDPA: e.target.checked})} className="mr-2" />
                        <Label>Ajouter une DPA (Data Processing Agreement)</Label>
                      </div>
                    </>
                  )}
                </div>

                {/* RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Responsabilité</h4>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.obligationPrudence} onChange={(e) => setNdaData({...ndaData, obligationPrudence: e.target.checked})} className="mr-2" />
                      <Label>Obligation de prudence du récepteur</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.responsabiliteDivulgation} onChange={(e) => setNdaData({...ndaData, responsabiliteDivulgation: e.target.checked})} className="mr-2" />
                      <Label>Responsabilité en cas de divulgation</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.exclusionDommagesIndirects} onChange={(e) => setNdaData({...ndaData, exclusionDommagesIndirects: e.target.checked})} className="mr-2" />
                      <Label>Exclusion des dommages indirects (optionnel)</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.exceptionDemandeLegale} onChange={(e) => setNdaData({...ndaData, exceptionDemandeLegale: e.target.checked})} className="mr-2" />
                      <Label>Exception en cas de demande légale / judiciaire</Label>
                    </div>
                  </div>
                  <div>
                    <Label>Pénalités en cas de violation (optionnel)</Label>
                    <Input value={ndaData.penalitesViolation} onChange={(e) => setNdaData({...ndaData, penalitesViolation: e.target.value})} placeholder="Ex: 50 000 € par violation" />
                  </div>
                  <div>
                    <Label>Plafond de responsabilité (optionnel)</Label>
                    <Input value={ndaData.plafondResponsabilite} onChange={(e) => setNdaData({...ndaData, plafondResponsabilite: e.target.value})} placeholder="Ex: 100 000 €" />
                  </div>
                </div>

                {/* RESTITUTION/DESTRUCTION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Restitution / Destruction des informations</h4>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.retourDocumentsFin} onChange={(e) => setNdaData({...ndaData, retourDocumentsFin: e.target.checked})} className="mr-2" />
                      <Label>Retourner tous les documents</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.destructionCopies} onChange={(e) => setNdaData({...ndaData, destructionCopies: e.target.checked})} className="mr-2" />
                      <Label>Détruire les copies</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.certificationDestruction} onChange={(e) => setNdaData({...ndaData, certificationDestruction: e.target.checked})} className="mr-2" />
                      <Label>Certifier la destruction</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.suppressionDonneesElectroniques} onChange={(e) => setNdaData({...ndaData, suppressionDonneesElectroniques: e.target.checked})} className="mr-2" />
                      <Label>Supprimer données électroniques</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.desactivationAcces} onChange={(e) => setNdaData({...ndaData, desactivationAcces: e.target.checked})} className="mr-2" />
                      <Label>Désactiver les accès</Label>
                    </div>
                  </div>
                </div>

                {/* INTERDICTIONS COMPLÉMENTAIRES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Interdictions complémentaires (optionnel)</h4>
                  <div className="space-y-2">
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionProspection} onChange={(e) => setNdaData({...ndaData, interdictionProspection: e.target.checked})} className="mr-2" />
                      <Label>Interdiction de prospection</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionContourner} onChange={(e) => setNdaData({...ndaData, interdictionContourner: e.target.checked})} className="mr-2" />
                      <Label>Interdiction de contourner la partie divulgatrice</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionContactClients} onChange={(e) => setNdaData({...ndaData, interdictionContactClients: e.target.checked})} className="mr-2" />
                      <Label>Interdiction de contacter directement clients / fournisseurs</Label>
                    </div>
                    <div className="flex items-center">
                      <input type="checkbox" checked={ndaData.interdictionConcurrence} onChange={(e) => setNdaData({...ndaData, interdictionConcurrence: e.target.checked})} className="mr-2" />
                      <Label>Interdiction d'utiliser les informations pour concurrencer</Label>
                    </div>
                  </div>
                </div>

                {/* DÉBAUCHAGE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Interdiction de débauchage (optionnel)</h4>
                  <div className="flex items-center mb-3">
                    <input type="checkbox" checked={ndaData.interdictionDebauchage} onChange={(e) => setNdaData({...ndaData, interdictionDebauchage: e.target.checked})} className="mr-2" />
                    <Label>Interdiction d'embaucher les employés de l'autre partie</Label>
                  </div>
                  {ndaData.interdictionDebauchage && (
                    <>
                      <div>
                        <Label>Durée (mois)</Label>
                        <Input type="number" value={ndaData.dureeInterdictionDebauchage} onChange={(e) => setNdaData({...ndaData, dureeInterdictionDebauchage: e.target.value})} placeholder="12 ou 24" />
                      </div>
                      <div>
                        <Label>Pénalité financière</Label>
                        <Input value={ndaData.penaliteDebauchage} onChange={(e) => setNdaData({...ndaData, penaliteDebauchage: e.target.value})} placeholder="Ex: 50 000 € par personne" />
                      </div>
                    </>
                  )}
                </div>

                {/* LITIGES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Litiges & juridiction compétente</h4>
                  <div>
                    <Label>Droit applicable</Label>
                    <Select value={ndaData.droitApplicable} onValueChange={(val) => setNdaData({...ndaData, droitApplicable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="français">Droit français</SelectItem>
                        <SelectItem value="autre">Autre droit</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Tribunal compétent</Label>
                    <Input value={ndaData.tribunalCompetent} onChange={(e) => setNdaData({...ndaData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunal de commerce de Paris" />
                  </div>
                  <div>
                    <Label>Clause de médiation préalable ?</Label>
                    <Select value={ndaData.mediationPrealable} onValueChange={(val) => setNdaData({...ndaData, mediationPrealable: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Arbitrage ?</Label>
                    <Select value={ndaData.arbitrage} onValueChange={(val) => setNdaData({...ndaData, arbitrage: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* VARIATIONS SPÉCIALES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Variations spéciales (optionnel)</h4>
                  <div>
                    <Label>Contexte spécial</Label>
                    <Select value={ndaData.contexteSpecial} onValueChange={(val) => setNdaData({...ndaData, contexteSpecial: val})}>
                      <SelectTrigger><SelectValue placeholder="Aucun" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="aucun">Aucun</SelectItem>
                        <SelectItem value="M&A">Fusion-acquisition (M&A)</SelectItem>
                        <SelectItem value="technique">NDA technique / informatique</SelectItem>
                        <SelectItem value="RH">NDA RH</SelectItem>
                        <SelectItem value="industriel">NDA industriel (Code PI)</SelectItem>
                        <SelectItem value="international">NDA international</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Langue du contrat</Label>
                    <Select value={ndaData.langueContrat} onValueChange={(val) => setNdaData({...ndaData, langueContrat: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="français">Français</SelectItem>
                        <SelectItem value="anglais">Anglais</SelectItem>
                        <SelectItem value="bilingue">Bilingue (FR/EN)</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes possibles</h4>
                  <SingleFileUpload label="Liste des informations déjà divulguées" files={ndaListeInfosDivulgueesFiles} onFilesChange={setNdaListeInfosDivulgueesFiles} role="avocat" />
                  <SingleFileUpload label="Schémas techniques" files={ndaSchemasTechniquesFiles} onFilesChange={setNdaSchemasTechniquesFiles} role="avocat" />
                  <SingleFileUpload label="Cahier des charges" files={ndaCahierChargesFiles} onFilesChange={setNdaCahierChargesFiles} role="avocat" />
                  <SingleFileUpload label="Document RGPD" files={ndaDocumentRGPDFiles} onFilesChange={setNdaDocumentRGPDFiles} role="avocat" />
                  <SingleFileUpload label="Charte sécurité informatique" files={ndaCharteSecuriteFiles} onFilesChange={setNdaCharteSecuriteFiles} role="avocat" />
                  <div>
                    <Label>Descriptions annexes supplémentaires</Label>
                    <Textarea value={ndaData.annexesDescriptions} onChange={(e) => setNdaData({...ndaData, annexesDescriptions: e.target.value})} placeholder="Listez d'autres annexes si nécessaire..." rows={3} />
                  </div>
                </div>
              </div>
            )}

            {/* Formulaire Cession de marque / PI */}
            {pendingContractType === "Cession de marque / cession de droits de propriété intellectuelle" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-purple-300 pb-2 text-purple-700">🏷️ Cession de marque / Propriété intellectuelle</h3>
                
                {/* CLIENT CONCERNÉ */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">👤 Clients concernés</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Cédant (vendeur) - Optionnel</Label>
                      <Select value={cessionPiClientIdCedant} onValueChange={setCessionPiClientIdCedant}>
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.prenom} {client.nom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Cessionnaire (acquéreur) - Optionnel</Label>
                      <Select value={cessionPiClientIdCessionnaire} onValueChange={setCessionPiClientIdCessionnaire}>
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.prenom} {client.nom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* TYPE DE CESSION */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Type de droit cédé *</h4>
                  <Select value={cessionPiData.typeCession} onValueChange={(val) => setCessionPiData({...cessionPiData, typeCession: val})}>
                    <SelectTrigger><SelectValue /></SelectTrigger>
                    <SelectContent>
                      <SelectItem value="marque">Marque</SelectItem>
                      <SelectItem value="brevet">Brevet</SelectItem>
                      <SelectItem value="dessin_modele">Dessin / Modèle</SelectItem>
                      <SelectItem value="droit_auteur">Droit d'auteur</SelectItem>
                      <SelectItem value="logiciel">Logiciel</SelectItem>
                      <SelectItem value="nom_domaine">Nom de domaine</SelectItem>
                      <SelectItem value="savoir_faire">Savoir-faire</SelectItem>
                      <SelectItem value="base_donnees">Base de données</SelectItem>
                      <SelectItem value="autre">Autre</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* CÉDANT */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Cédant (propriétaire actuel) *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom / Dénomination sociale *</Label><Input value={cessionPiData.cedantNom} onChange={(e) => setCessionPiData({...cessionPiData, cedantNom: e.target.value})} /></div>
                    <div><Label>Forme juridique</Label><Input value={cessionPiData.cedantFormeJuridique} onChange={(e) => setCessionPiData({...cessionPiData, cedantFormeJuridique: e.target.value})} placeholder="SARL, SAS, SA, EI..." /></div>
                    <div><Label>Capital (si société)</Label><Input value={cessionPiData.cedantCapital} onChange={(e) => setCessionPiData({...cessionPiData, cedantCapital: e.target.value})} placeholder="Ex: 10000 EUR" /></div>
                    <div><Label>RCS / SIREN</Label><Input value={cessionPiData.cedantRCS} onChange={(e) => setCessionPiData({...cessionPiData, cedantRCS: e.target.value})} /></div>
                    <div><Label>Adresse du siège</Label><Input value={cessionPiData.cedantSiege} onChange={(e) => setCessionPiData({...cessionPiData, cedantSiege: e.target.value})} /></div>
                    <div><Label>Représentant légal</Label><Input value={cessionPiData.cedantRepresentant} onChange={(e) => setCessionPiData({...cessionPiData, cedantRepresentant: e.target.value})} placeholder="Nom + fonction" /></div>
                    <div><Label>Email</Label><Input value={cessionPiData.cedantEmail} onChange={(e) => setCessionPiData({...cessionPiData, cedantEmail: e.target.value})} type="email" /></div>
                    <div><Label>Téléphone</Label><Input value={cessionPiData.cedantTelephone} onChange={(e) => setCessionPiData({...cessionPiData, cedantTelephone: e.target.value})} /></div>
                    <div><Label>Pays</Label><Input value={cessionPiData.cedantPays} onChange={(e) => setCessionPiData({...cessionPiData, cedantPays: e.target.value})} /></div>
                  </div>
                  <h5 className="font-medium text-purple-600 mt-4">Pièces justificatives cédant</h5>
                  <SingleFileUpload label="Kbis / Extrait RCS" files={cessionPiCedantKbisFiles} onFilesChange={setCessionPiCedantKbisFiles} role="avocat" />
                  <SingleFileUpload label="Pièce d'identité du représentant" files={cessionPiCedantIdentiteFiles} onFilesChange={setCessionPiCedantIdentiteFiles} role="avocat" />
                  <SingleFileUpload label="Pouvoir de signature" files={cessionPiCedantPouvoirFiles} onFilesChange={setCessionPiCedantPouvoirFiles} role="avocat" />
                </div>

                {/* CESSIONNAIRE */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Cessionnaire (acquéreur) *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom / Dénomination sociale *</Label><Input value={cessionPiData.cessionnaireNom} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireNom: e.target.value})} /></div>
                    <div><Label>Forme juridique</Label><Input value={cessionPiData.cessionnaireFormeJuridique} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireFormeJuridique: e.target.value})} /></div>
                    <div><Label>Capital (si société)</Label><Input value={cessionPiData.cessionnaireCapital} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireCapital: e.target.value})} /></div>
                    <div><Label>RCS / SIREN</Label><Input value={cessionPiData.cessionnaireRCS} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireRCS: e.target.value})} /></div>
                    <div><Label>Adresse du siège</Label><Input value={cessionPiData.cessionnaireSiege} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireSiege: e.target.value})} /></div>
                    <div><Label>Représentant légal</Label><Input value={cessionPiData.cessionnaireRepresentant} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireRepresentant: e.target.value})} /></div>
                    <div><Label>Email</Label><Input value={cessionPiData.cessionnaireEmail} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireEmail: e.target.value})} type="email" /></div>
                    <div><Label>Téléphone</Label><Input value={cessionPiData.cessionnaireTelephone} onChange={(e) => setCessionPiData({...cessionPiData, cessionnaireTelephone: e.target.value})} /></div>
                    <div><Label>Pays</Label><Input value={cessionPiData.cessionnairePays} onChange={(e) => setCessionPiData({...cessionPiData, cessionnairePays: e.target.value})} /></div>
                  </div>
                  <h5 className="font-medium text-purple-600 mt-4">Pièces justificatives cessionnaire</h5>
                  <SingleFileUpload label="Kbis / Extrait RCS" files={cessionPiCessionnaireKbisFiles} onFilesChange={setCessionPiCessionnaireKbisFiles} role="avocat" />
                  <SingleFileUpload label="Pièce d'identité du représentant" files={cessionPiCessionnaireIdentiteFiles} onFilesChange={setCessionPiCessionnaireIdentiteFiles} role="avocat" />
                  <SingleFileUpload label="Pouvoir de signature" files={cessionPiCessionnairePouvoirFiles} onFilesChange={setCessionPiCessionnairePouvoirFiles} role="avocat" />
                </div>

                {/* IDENTIFICATION DU DROIT - MARQUE */}
                {cessionPiData.typeCession === "marque" && (
                  <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                    <h4 className="font-semibold text-lg text-purple-700">Identification de la marque *</h4>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom de la marque *</Label><Input value={cessionPiData.marqueNom} onChange={(e) => setCessionPiData({...cessionPiData, marqueNom: e.target.value})} /></div>
                      <div><Label>Numéro de dépôt</Label><Input value={cessionPiData.marqueNumeroDepot} onChange={(e) => setCessionPiData({...cessionPiData, marqueNumeroDepot: e.target.value})} /></div>
                      <div><Label>Date de dépôt</Label><Input value={cessionPiData.marqueDateDepot} onChange={(e) => setCessionPiData({...cessionPiData, marqueDateDepot: e.target.value})} type="date" /></div>
                      <div><Label>Classes (Nice)</Label><Input value={cessionPiData.marqueClasses} onChange={(e) => setCessionPiData({...cessionPiData, marqueClasses: e.target.value})} placeholder="Ex: 9, 35, 42" /></div>
                      <div><Label>Organisme d'enregistrement</Label><Select value={cessionPiData.marqueOrganismeEnregistrement} onValueChange={(val) => setCessionPiData({...cessionPiData, marqueOrganismeEnregistrement: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="INPI">INPI (France)</SelectItem><SelectItem value="EUIPO">EUIPO (UE)</SelectItem><SelectItem value="OMPI">OMPI (International)</SelectItem><SelectItem value="autre">Autre</SelectItem></SelectContent></Select></div>
                      <div><Label>Échéance renouvellement</Label><Input value={cessionPiData.marqueRenouvellementEcheance} onChange={(e) => setCessionPiData({...cessionPiData, marqueRenouvellementEcheance: e.target.value})} type="date" /></div>
                      <div><Label>Étendue</Label><Select value={cessionPiData.marqueEtendue} onValueChange={(val) => setCessionPiData({...cessionPiData, marqueEtendue: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="nationale">Nationale</SelectItem><SelectItem value="europeenne">Européenne</SelectItem><SelectItem value="internationale">Internationale</SelectItem></SelectContent></Select></div>
                      {cessionPiData.marqueEtendue === "internationale" && <div><Label>Pays couvert s</Label><Textarea value={cessionPiData.marquePays} onChange={(e) => setCessionPiData({...cessionPiData, marquePays: e.target.value})} placeholder="Liste des pays" rows={2} /></div>}
                    </div>
                  </div>
                )}

                {/* IDENTIFICATION DU DROIT - BREVET */}
                {cessionPiData.typeCession === "brevet" && (
                  <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                    <h4 className="font-semibold text-lg text-purple-700">Identification du brevet *</h4>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Titre du brevet *</Label><Input value={cessionPiData.brevetTitre} onChange={(e) => setCessionPiData({...cessionPiData, brevetTitre: e.target.value})} /></div>
                      <div><Label>Numéro de brevet</Label><Input value={cessionPiData.brevetNumero} onChange={(e) => setCessionPiData({...cessionPiData, brevetNumero: e.target.value})} /></div>
                      <div><Label>Date de dépôt</Label><Input value={cessionPiData.brevetDateDepot} onChange={(e) => setCessionPiData({...cessionPiData, brevetDateDepot: e.target.value})} type="date" /></div>
                      <div><Label>Date de délivrance</Label><Input value={cessionPiData.brevetDateDelivrance} onChange={(e) => setCessionPiData({...cessionPiData, brevetDateDelivrance: e.target.value})} type="date" /></div>
                      <div><Label>Organisme</Label><Select value={cessionPiData.brevetOrganisme} onValueChange={(val) => setCessionPiData({...cessionPiData, brevetOrganisme: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="INPI">INPI</SelectItem><SelectItem value="OEB">OEB (Européen)</SelectItem><SelectItem value="USPTO">USPTO (USA)</SelectItem><SelectItem value="autre">Autre</SelectItem></SelectContent></Select></div>
                      <div><Label>Durée de protection</Label><Input value={cessionPiData.brevetDureeProtection} onChange={(e) => setCessionPiData({...cessionPiData, brevetDureeProtection: e.target.value})} placeholder="Ex: 20 ans" /></div>
                    </div>
                    <div><Label>Revendications</Label><Textarea value={cessionPiData.brevetRevendications} onChange={(e) => setCessionPiData({...cessionPiData, brevetRevendications: e.target.value})} rows={3} /></div>
                    <div><Label>Étendue</Label><Select value={cessionPiData.brevetEtendue} onValueChange={(val) => setCessionPiData({...cessionPiData, brevetEtendue: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="nationale">Nationale</SelectItem><SelectItem value="europeenne">Européenne</SelectItem><SelectItem value="internationale">Internationale</SelectItem></SelectContent></Select></div>
                  </div>
                )}

                {/* IDENTIFICATION DU DROIT - LOGICIEL */}
                {cessionPiData.typeCession === "logiciel" && (
                  <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                    <h4 className="font-semibold text-lg text-purple-700">Identification du logiciel *</h4>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom du logiciel *</Label><Input value={cessionPiData.logicielNom} onChange={(e) => setCessionPiData({...cessionPiData, logicielNom: e.target.value})} /></div>
                      <div><Label>Version</Label><Input value={cessionPiData.logicielVersion} onChange={(e) => setCessionPiData({...cessionPiData, logicielVersion: e.target.value})} /></div>
                      <div><Label>Langages de programmation</Label><Input value={cessionPiData.logicielLanguages} onChange={(e) => setCessionPiData({...cessionPiData, logicielLanguages: e.target.value})} placeholder="Ex: Python, JavaScript" /></div>
                      <div><Label>Code source</Label><Select value={cessionPiData.logicielCodeSource} onValueChange={(val) => setCessionPiData({...cessionPiData, logicielCodeSource: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="inclus">Inclus dans la cession</SelectItem><SelectItem value="exclu">Exclu</SelectItem></SelectContent></Select></div>
                      <div><Label>Documentation</Label><Select value={cessionPiData.logicielDocumentation} onValueChange={(val) => setCessionPiData({...cessionPiData, logicielDocumentation: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="incluse">Incluse</SelectItem><SelectItem value="exclue">Exclue</SelectItem></SelectContent></Select></div>
                      <div><Label>Droits moraux</Label><Select value={cessionPiData.logicielDroitsMoraux} onValueChange={(val) => setCessionPiData({...cessionPiData, logicielDroitsMoraux: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="conserves">Conservés par le cédant</SelectItem><SelectItem value="cedes">Cédés</SelectItem></SelectContent></Select></div>
                    </div>
                  </div>
                )}

                {/* IDENTIFICATION - NOM DE DOMAINE */}
                {cessionPiData.typeCession === "nom_domaine" && (
                  <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                    <h4 className="font-semibold text-lg text-purple-700">Identification du nom de domaine *</h4>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom de domaine *</Label><Input value={cessionPiData.nomDomaine} onChange={(e) => setCessionPiData({...cessionPiData, nomDomaine: e.target.value})} placeholder="example.com" /></div>
                      <div><Label>Extension</Label><Input value={cessionPiData.nomDomaineExtension} onChange={(e) => setCessionPiData({...cessionPiData, nomDomaineExtension: e.target.value})} placeholder=".com, .fr, .eu" /></div>
                      <div><Label>Registrar actuel</Label><Input value={cessionPiData.nomDomaineRegistrar} onChange={(e) => setCessionPiData({...cessionPiData, nomDomaineRegistrar: e.target.value})} /></div>
                      <div><Label>Date d'expiration</Label><Input value={cessionPiData.nomDomaineDateExpiration} onChange={(e) => setCessionPiData({...cessionPiData, nomDomaineDateExpiration: e.target.value})} type="date" /></div>
                    </div>
                  </div>
                )}

                {/* NATURE DE LA CESSION */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Nature de la cession *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Type de cession</Label><Select value={cessionPiData.natureCession} onValueChange={(val) => setCessionPiData({...cessionPiData, natureCession: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="totale">Totale</SelectItem><SelectItem value="partielle">Partielle</SelectItem></SelectContent></Select></div>
                    <div className="flex items-center gap-2 pt-6"><input type="checkbox" checked={cessionPiData.cessionExclusive} onChange={(e) => setCessionPiData({...cessionPiData, cessionExclusive: e.target.checked})} id="excl" /><Label htmlFor="excl">Cession exclusive</Label></div>
                  </div>
                  <div><Label>Territoire de la cession</Label><Select value={cessionPiData.territoireCession} onValueChange={(val) => setCessionPiData({...cessionPiData, territoireCession: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="mondial">Mondial</SelectItem><SelectItem value="france">France uniquement</SelectItem><SelectItem value="UE">Union Européenne</SelectItem><SelectItem value="liste_pays">Liste de pays spécifique</SelectItem></SelectContent></Select></div>
                  {cessionPiData.territoireCession === "liste_pays" && <div><Label>Liste des pays couverts</Label><Textarea value={cessionPiData.territoirePaysListe} onChange={(e) => setCessionPiData({...cessionPiData, territoirePaysListe: e.target.value})} rows={2} /></div>}
                  <div><Label>Secteur d'activité limité ?</Label><Select value={cessionPiData.secteurActiviteLimite} onValueChange={(val) => setCessionPiData({...cessionPiData, secteurActiviteLimite: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non, tous secteurs</SelectItem><SelectItem value="oui">Oui, secteur limité</SelectItem></SelectContent></Select></div>
                  {cessionPiData.secteurActiviteLimite === "oui" && <div><Label>Description du secteur limité</Label><Textarea value={cessionPiData.secteurActiviteDescription} onChange={(e) => setCessionPiData({...cessionPiData, secteurActiviteDescription: e.target.value})} rows={2} /></div>}
                  
                  <div className="space-y-3 mt-4">
                    <h5 className="font-medium">Droits cédés :</h5>
                    <div className="grid md:grid-cols-3 gap-2">
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.exploitation} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, exploitation: e.target.checked}})} id="droit-exp" /><Label htmlFor="droit-exp">Exploitation</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.reproduction} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, reproduction: e.target.checked}})} id="droit-rep" /><Label htmlFor="droit-rep">Reproduction</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.representation} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, representation: e.target.checked}})} id="droit-repr" /><Label htmlFor="droit-repr">Représentation</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.adaptation} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, adaptation: e.target.checked}})} id="droit-ada" /><Label htmlFor="droit-ada">Adaptation</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.traduction} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, traduction: e.target.checked}})} id="droit-tra" /><Label htmlFor="droit-tra">Traduction</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.distribution} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, distribution: e.target.checked}})} id="droit-dis" /><Label htmlFor="droit-dis">Distribution</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.modification} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, modification: e.target.checked}})} id="droit-mod" /><Label htmlFor="droit-mod">Modification</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.sousLicence} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, sousLicence: e.target.checked}})} id="droit-sous" /><Label htmlFor="droit-sous">Accorder des sous-licences</Label></div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.droitsCedes.cessionTiers} onChange={(e) => setCessionPiData({...cessionPiData, droitsCedes: {...cessionPiData.droitsCedes, cessionTiers: e.target.checked}})} id="droit-ces" /><Label htmlFor="droit-ces">Céder à des tiers</Label></div>
                    </div>
                  </div>
                </div>

                {/* DATE D'EFFET DE LA CESSION (optionnel) */}
                <div className="space-y-4 p-4 bg-yellow-50/50 rounded-lg border border-yellow-200">
                  <h4 className="font-semibold text-lg text-yellow-700">📅 Date d'effet de la cession (optionnel)</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Effet de la cession</Label>
                      <Select value={cessionPiData.dateEffetCession} onValueChange={(val) => setCessionPiData({...cessionPiData, dateEffetCession: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="signature">À la signature du contrat</SelectItem>
                          <SelectItem value="enregistrement">À l'enregistrement INPI/EUIPO</SelectItem>
                          <SelectItem value="date_specifique">À une date spécifique</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {cessionPiData.dateEffetCession === "date_specifique" && (
                      <div>
                        <Label>Date spécifique</Label>
                        <Input 
                          value={cessionPiData.dateEffetCessionSpecifique} 
                          onChange={(e) => setCessionPiData({...cessionPiData, dateEffetCessionSpecifique: e.target.value})} 
                          type="date" 
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* PRIX ET PAIEMENT */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Prix et modalités de paiement *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Prix de la cession *</Label><Input value={cessionPiData.prixCession} onChange={(e) => setCessionPiData({...cessionPiData, prixCession: e.target.value})} placeholder="Ex: 50000" /></div>
                    <div><Label>Devise</Label><Select value={cessionPiData.prixDevise} onValueChange={(val) => setCessionPiData({...cessionPiData, prixDevise: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="EUR">EUR (€)</SelectItem><SelectItem value="USD">USD ($)</SelectItem><SelectItem value="GBP">GBP (£)</SelectItem></SelectContent></Select></div>
                  </div>
                  <div><Label>Modalité de paiement</Label><Select value={cessionPiData.modalitePaiement} onValueChange={(val) => setCessionPiData({...cessionPiData, modalitePaiement: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="comptant">Comptant</SelectItem><SelectItem value="echelonne">Échelonné</SelectItem><SelectItem value="royalties">Royalties</SelectItem><SelectItem value="mixte">Mixte (fixe + royalties)</SelectItem></SelectContent></Select></div>
                  
                  {cessionPiData.modalitePaiement === "echelonne" && <div><Label>Description de l'échéancier</Label><Textarea value={cessionPiData.echelonnementDescription} onChange={(e) => setCessionPiData({...cessionPiData, echelonnementDescription: e.target.value})} placeholder="Ex: 30% à la signature, 70% à J+90" rows={3} /></div>}
                  
                  {(cessionPiData.modalitePaiement === "royalties" || cessionPiData.modalitePaiement === "mixte") && (
                    <div className="space-y-3 p-3 bg-white rounded border">
                      <h5 className="font-medium">Royalties</h5>
                      <div className="grid md:grid-cols-2 gap-4">
                        <div><Label>Taux (%)</Label><Input value={cessionPiData.royaltiesTaux} onChange={(e) => setCessionPiData({...cessionPiData, royaltiesTaux: e.target.value})} placeholder="Ex: 5%" /></div>
                        <div><Label>Base de calcul</Label><Input value={cessionPiData.royaltiesBase} onChange={(e) => setCessionPiData({...cessionPiData, royaltiesBase: e.target.value})} placeholder="CA HT, bénéfice..." /></div>
                        <div><Label>Durée</Label><Input value={cessionPiData.royaltiesDuree} onChange={(e) => setCessionPiData({...cessionPiData, royaltiesDuree: e.target.value})} placeholder="Ex: 5 ans" /></div>
                        <div><Label>Minimum garanti</Label><Input value={cessionPiData.royaltiesMinimum} onChange={(e) => setCessionPiData({...cessionPiData, royaltiesMinimum: e.target.value})} placeholder="Optionnel" /></div>
                      </div>
                      <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.royaltiesComptabilite} onChange={(e) => setCessionPiData({...cessionPiData, royaltiesComptabilite: e.target.checked})} id="compta" /><Label htmlFor="compta">Audit comptable autorisé</Label></div>
                    </div>
                  )}
                  
                  <div><Label>Date limite de paiement</Label><Input value={cessionPiData.paiementDateLimite} onChange={(e) => setCessionPiData({...cessionPiData, paiementDateLimite: e.target.value})} type="date" /></div>
                  <div><Label>Modalités pratiques</Label><Textarea value={cessionPiData.paiementModalites} onChange={(e) => setCessionPiData({...cessionPiData, paiementModalites: e.target.value})} placeholder="Virement, chèque, séquestre..." rows={2} /></div>
                </div>

                {/* GARANTIES DU CÉDANT */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Garanties du cédant</h4>
                  <div className="grid md:grid-cols-2 gap-2">
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieTitulaire} onChange={(e) => setCessionPiData({...cessionPiData, garantieTitulaire: e.target.checked})} id="g1" /><Label htmlFor="g1">Titulaire légitime du droit</Label></div>
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieLibreCharges} onChange={(e) => setCessionPiData({...cessionPiData, garantieLibreCharges: e.target.checked})} id="g2" /><Label htmlFor="g2">Libre de toute charge</Label></div>
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieNonContrefacon} onChange={(e) => setCessionPiData({...cessionPiData, garantieNonContrefacon: e.target.checked})} id="g3" /><Label htmlFor="g3">Non contrefaçon</Label></div>
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieValidite} onChange={(e) => setCessionPiData({...cessionPiData, garantieValidite: e.target.checked})} id="g4" /><Label htmlFor="g4">Validité du droit</Label></div>
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieExploitabilite} onChange={(e) => setCessionPiData({...cessionPiData, garantieExploitabilite: e.target.checked})} id="g5" /><Label htmlFor="g5">Exploitabilité</Label></div>
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieAucunLitige} onChange={(e) => setCessionPiData({...cessionPiData, garantieAucunLitige: e.target.checked})} id="g6" /><Label htmlFor="g6">Aucun litige en cours</Label></div>
                    <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.garantieEviction} onChange={(e) => setCessionPiData({...cessionPiData, garantieEviction: e.target.checked})} id="g7" /><Label htmlFor="g7">Garantie d'éviction (contre revendication tiers)</Label></div>
                  </div>
                  <div><Label>Durée des garanties</Label><Select value={cessionPiData.garantieDuree} onValueChange={(val) => setCessionPiData({...cessionPiData, garantieDuree: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="permanente">Permanente</SelectItem><SelectItem value="limitee">Limitée dans le temps</SelectItem></SelectContent></Select></div>
                  {cessionPiData.garantieDuree === "limitee" && <div><Label>Durée limite</Label><Input value={cessionPiData.garantieDureeLimitee} onChange={(e) => setCessionPiData({...cessionPiData, garantieDureeLimitee: e.target.value})} placeholder="Ex: 3 ans" /></div>}
                </div>

                {/* OBLIGATIONS POST-CESSION */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Obligations post-cession</h4>
                  <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.obligationTransfertDocuments} onChange={(e) => setCessionPiData({...cessionPiData, obligationTransfertDocuments: e.target.checked})} id="ob1" /><Label htmlFor="ob1">Transfert de tous les documents</Label></div>
                  
                  <div><Label>Formation du cessionnaire ?</Label><Select value={cessionPiData.obligationFormationCessionnaire} onValueChange={(val) => setCessionPiData({...cessionPiData, obligationFormationCessionnaire: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non</SelectItem><SelectItem value="oui">Oui</SelectItem></SelectContent></Select></div>
                  {cessionPiData.obligationFormationCessionnaire === "oui" && <div><Label>Durée de formation</Label><Input value={cessionPiData.obligationFormationDuree} onChange={(e) => setCessionPiData({...cessionPiData, obligationFormationDuree: e.target.value})} placeholder="Ex: 2 jours" /></div>}
                  
                  <div><Label>Assistance technique ?</Label><Select value={cessionPiData.obligationAssistanceTechnique} onValueChange={(val) => setCessionPiData({...cessionPiData, obligationAssistanceTechnique: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non</SelectItem><SelectItem value="oui">Oui</SelectItem></SelectContent></Select></div>
                  {cessionPiData.obligationAssistanceTechnique === "oui" && <div><Label>Durée d'assistance</Label><Input value={cessionPiData.obligationAssistanceDuree} onChange={(e) => setCessionPiData({...cessionPiData, obligationAssistanceDuree: e.target.value})} placeholder="Ex: 6 mois" /></div>}
                  
                  <div><Label>Clause de non-concurrence ?</Label><Select value={cessionPiData.obligationNonConcurrence} onValueChange={(val) => setCessionPiData({...cessionPiData, obligationNonConcurrence: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non</SelectItem><SelectItem value="oui">Oui</SelectItem></SelectContent></Select></div>
                  {cessionPiData.obligationNonConcurrence === "oui" && (
                    <div className="grid md:grid-cols-3 gap-4 p-3 bg-white rounded border">
                      <div><Label>Durée</Label><Input value={cessionPiData.obligationNonConcurrenceDuree} onChange={(e) => setCessionPiData({...cessionPiData, obligationNonConcurrenceDuree: e.target.value})} placeholder="Ex: 2 ans" /></div>
                      <div><Label>Territoire</Label><Input value={cessionPiData.obligationNonConcurrenceTerritoire} onChange={(e) => setCessionPiData({...cessionPiData, obligationNonConcurrenceTerritoire: e.target.value})} /></div>
                      <div><Label>Secteur</Label><Input value={cessionPiData.obligationNonConcurrenceSecteur} onChange={(e) => setCessionPiData({...cessionPiData, obligationNonConcurrenceSecteur: e.target.value})} /></div>
                    </div>
                  )}
                  
                  <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.obligationConfidentialite} onChange={(e) => setCessionPiData({...cessionPiData, obligationConfidentialite: e.target.checked})} id="conf" /><Label htmlFor="conf">Obligation de confidentialité</Label></div>
                  {cessionPiData.obligationConfidentialite && <div><Label>Durée de confidentialité</Label><Input value={cessionPiData.obligationConfidentialiteDuree} onChange={(e) => setCessionPiData({...cessionPiData, obligationConfidentialiteDuree: e.target.value})} placeholder="Ex: 5 ans ou illimitée" /></div>}
                </div>

                {/* FORMALITÉS D'ENREGISTREMENT */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Formalités d'enregistrement</h4>
                  <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.enregistrementNecessaire} onChange={(e) => setCessionPiData({...cessionPiData, enregistrementNecessaire: e.target.checked})} id="enreg" /><Label htmlFor="enreg">Enregistrement nécessaire</Label></div>
                  {cessionPiData.enregistrementNecessaire && (
                    <div className="grid md:grid-cols-3 gap-4">
                      <div><Label>Organisme</Label><Input value={cessionPiData.enregistrementOrganisme} onChange={(e) => setCessionPiData({...cessionPiData, enregistrementOrganisme: e.target.value})} placeholder="INPI, EUIPO, OMPI..." /></div>
                      <div><Label>Frais à la charge de</Label><Select value={cessionPiData.enregistrementFrais} onValueChange={(val) => setCessionPiData({...cessionPiData, enregistrementFrais: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="cedant">Cédant</SelectItem><SelectItem value="cessionnaire">Cessionnaire</SelectItem><SelectItem value="partages">Partagés 50/50</SelectItem></SelectContent></Select></div>
                      <div><Label>Délai d'enregistrement</Label><Input value={cessionPiData.enregistrementDelai} onChange={(e) => setCessionPiData({...cessionPiData, enregistrementDelai: e.target.value})} placeholder="Ex: 30 jours" /></div>
                    </div>
                  )}
                </div>

                {/* RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Responsabilité</h4>
                  <div><Label>Plafond de responsabilité (optionnel)</Label><Input value={cessionPiData.responsabilitePlafond} onChange={(e) => setCessionPiData({...cessionPiData, responsabilitePlafond: e.target.value})} placeholder="Ex: 100000 EUR" /></div>
                  <div className="flex items-center gap-2"><input type="checkbox" checked={cessionPiData.responsabiliteExclusionDommagesIndirects} onChange={(e) => setCessionPiData({...cessionPiData, responsabiliteExclusionDommagesIndirects: e.target.checked})} id="excl-dom" /><Label htmlFor="excl-dom">Exclusion des dommages indirects</Label></div>
                  <div><Label>Assurance obligatoire ?</Label><Select value={cessionPiData.responsabiliteAssuranceObligatoire} onValueChange={(val) => setCessionPiData({...cessionPiData, responsabiliteAssuranceObligatoire: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non</SelectItem><SelectItem value="oui">Oui</SelectItem></SelectContent></Select></div>
                </div>

                {/* LITIGES */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Litiges et juridiction</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Droit applicable</Label><Select value={cessionPiData.droitApplicable} onValueChange={(val) => setCessionPiData({...cessionPiData, droitApplicable: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="français">Droit français</SelectItem><SelectItem value="europeen">Droit européen</SelectItem><SelectItem value="autre">Autre</SelectItem></SelectContent></Select></div>
                    <div><Label>Tribunal compétent</Label><Input value={cessionPiData.tribunalCompetent} onChange={(e) => setCessionPiData({...cessionPiData, tribunalCompetent: e.target.value})} placeholder="Ex: Paris" /></div>
                    <div><Label>Médiation préalable</Label><Select value={cessionPiData.mediationPrealable} onValueChange={(val) => setCessionPiData({...cessionPiData, mediationPrealable: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                    <div><Label>Arbitrage</Label><Select value={cessionPiData.arbitrage} onValueChange={(val) => setCessionPiData({...cessionPiData, arbitrage: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                  </div>
                </div>

                {/* PIÈCES JUSTIFICATIVES ET ANNEXES */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Documents du droit cédé</h4>
                  <SingleFileUpload label="Certificat d'enregistrement" files={cessionPiCertificatEnregistrementFiles} onFilesChange={setCessionPiCertificatEnregistrementFiles} role="avocat" required />
                  <SingleFileUpload label="Preuves d'antériorité" files={cessionPiPreuvesAnterioriteFiles} onFilesChange={setCessionPiPreuvesAnterioriteFiles} role="avocat" />
                  <SingleFileUpload label="Documents techniques" files={cessionPiDocumentsTechniquesFiles} onFilesChange={setCessionPiDocumentsTechniquesFiles} role="avocat" />
                  {cessionPiData.typeCession === "logiciel" && (
                    <>
                      <SingleFileUpload label="Code source" files={cessionPiCodeSourceFiles} onFilesChange={setCessionPiCodeSourceFiles} role="avocat" />
                      <SingleFileUpload label="Documentation" files={cessionPiDocumentationFiles} onFilesChange={setCessionPiDocumentationFiles} role="avocat" />
                    </>
                  )}
                  <SingleFileUpload label="Licences existantes" files={cessionPiLicencesExistantesFiles} onFilesChange={setCessionPiLicencesExistantesFiles} role="avocat" />
                  <SingleFileUpload label="Rapport de valuation (optionnel)" files={cessionPiRapportValuationFiles} onFilesChange={setCessionPiRapportValuationFiles} role="avocat" />
                  <MultiFileUpload label="Autres annexes" files={cessionPiAnnexesFiles} onFilesChange={setCessionPiAnnexesFiles} role="avocat" />
                  <div><Label>Descriptions annexes supplémentaires</Label><Textarea value={cessionPiData.annexesDescriptions} onChange={(e) => setCessionPiData({...cessionPiData, annexesDescriptions: e.target.value})} placeholder="Listez d'autres annexes si nécessaire..." rows={3} /></div>
                </div>
              </div>
            )}

            {/* Formulaire Contrat de travail (CDD/CDI) */}
            {pendingContractType === "Contrat de travail (CDD/CDI)" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">💼 Contrat de travail (CDD/CDI)</h3>
                
                {/* TYPE DE CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Type de contrat *</h4>
                  <div className="grid grid-cols-2 gap-4">
                    <button
                      type="button"
                      onClick={() => setContratTravailData({...contratTravailData, typeContrat: "CDI"})}
                      className={`p-4 rounded-lg border-2 transition ${contratTravailData.typeContrat === "CDI" ? "border-blue-600 bg-blue-100" : "border-gray-300 bg-white"}`}
                    >
                      <div className="font-semibold text-lg">CDI</div>
                      <div className="text-sm text-gray-600">Contrat à Durée Indéterminée</div>
                    </button>
                    <button
                      type="button"
                      onClick={() => setContratTravailData({...contratTravailData, typeContrat: "CDD"})}
                      className={`p-4 rounded-lg border-2 transition ${contratTravailData.typeContrat === "CDD" ? "border-blue-600 bg-blue-100" : "border-gray-300 bg-white"}`}
                    >
                      <div className="font-semibold text-lg">CDD</div>
                      <div className="text-sm text-gray-600">Contrat à Durée Déterminée</div>
                    </button>
                  </div>
                </div>

                {/* CLIENTS CONCERNÉS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">👤 Clients concernés (optionnel)</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Employeur</Label>
                      <Select value={contratTravailClientIdEmployeur} onValueChange={setContratTravailClientIdEmployeur}>
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.prenom} {client.nom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Salarié</Label>
                      <Select value={contratTravailClientIdSalarie} onValueChange={(clientId) => {
                        setContratTravailClientIdSalarie(clientId);
                        const client = clients.find(c => c.id === clientId);
                        if (client && clientId !== "none") {
                          setContratTravailData({
                            ...contratTravailData,
                            salarieNom: client.nom || "",
                            salariePrenom: client.prenom || "",
                            salarieDateNaissance: client.date_naissance || "",
                            salarieLieuNaissance: client.lieu_naissance || "",
                            salarieNationalite: client.nationalite || "",
                            salarieNumeroSecuSociale: client.numero_secu_sociale || "",
                            salarieAdresse: client.adresse || "",
                            salarieCodePostal: client.code_postal || "",
                            salarieVille: client.ville || "",
                            salarieEmail: client.email || "",
                            salarieTelephone: client.telephone || ""
                          });
                        }
                      }}>
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.prenom} {client.nom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* EMPLOYEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">Employeur *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Raison sociale *</Label><Input value={contratTravailData.employeurRaisonSociale} onChange={(e) => setContratTravailData({...contratTravailData, employeurRaisonSociale: e.target.value})} /></div>
                    <div><Label>Forme juridique</Label><Input value={contratTravailData.employeurFormeJuridique} onChange={(e) => setContratTravailData({...contratTravailData, employeurFormeJuridique: e.target.value})} placeholder="SARL, SAS, SA..." /></div>
                    <div><Label>SIRET *</Label><Input value={contratTravailData.employeurSiret} onChange={(e) => setContratTravailData({...contratTravailData, employeurSiret: e.target.value})} /></div>
                    <div><Label>Code NAF</Label><Input value={contratTravailData.employeurCodeNAF} onChange={(e) => setContratTravailData({...contratTravailData, employeurCodeNAF: e.target.value})} /></div>
                    <div className="md:col-span-2"><Label>Adresse du siège</Label><Input value={contratTravailData.employeurSiege} onChange={(e) => setContratTravailData({...contratTravailData, employeurSiege: e.target.value})} /></div>
                    <div><Label>Représentant légal</Label><Input value={contratTravailData.employeurRepresentant} onChange={(e) => setContratTravailData({...contratTravailData, employeurRepresentant: e.target.value})} /></div>
                    <div><Label>Fonction</Label><Input value={contratTravailData.employeurFonction} onChange={(e) => setContratTravailData({...contratTravailData, employeurFonction: e.target.value})} placeholder="Ex: Directeur général" /></div>
                    <div><Label>N° URSSAF</Label><Input value={contratTravailData.employeurNumeroUrssaf} onChange={(e) => setContratTravailData({...contratTravailData, employeurNumeroUrssaf: e.target.value})} /></div>
                    <div><Label>Convention collective</Label><Input value={contratTravailData.employeurConventionCollective} onChange={(e) => setContratTravailData({...contratTravailData, employeurConventionCollective: e.target.value})} placeholder="Ex: Syntec" /></div>
                    <div><Label>N° IDCC</Label><Input value={contratTravailData.employeurIdccNumero} onChange={(e) => setContratTravailData({...contratTravailData, employeurIdccNumero: e.target.value})} placeholder="Ex: 1486" /></div>
                  </div>
                  <h5 className="font-medium text-gray-700 mt-4">Pièces justificatives employeur</h5>
                  <SingleFileUpload label="Kbis / Extrait RCS" files={contratTravailEmployeurKbisFiles} onFilesChange={setContratTravailEmployeurKbisFiles} role="avocat" />
                  <SingleFileUpload label="Convention collective (IDCC)" files={contratTravailEmployeurIdccFiles} onFilesChange={setContratTravailEmployeurIdccFiles} role="avocat" />
                </div>

                {/* SALARIÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">Salarié *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom *</Label><Input value={contratTravailData.salarieNom} onChange={(e) => setContratTravailData({...contratTravailData, salarieNom: e.target.value})} /></div>
                    <div><Label>Prénom *</Label><Input value={contratTravailData.salariePrenom} onChange={(e) => setContratTravailData({...contratTravailData, salariePrenom: e.target.value})} /></div>
                    <div><Label>Date de naissance</Label><Input value={contratTravailData.salarieDateNaissance} onChange={(e) => setContratTravailData({...contratTravailData, salarieDateNaissance: e.target.value})} type="date" /></div>
                    <div><Label>Lieu de naissance</Label><Input value={contratTravailData.salarieLieuNaissance} onChange={(e) => setContratTravailData({...contratTravailData, salarieLieuNaissance: e.target.value})} /></div>
                    <div><Label>Nationalité</Label><Input value={contratTravailData.salarieNationalite} onChange={(e) => setContratTravailData({...contratTravailData, salarieNationalite: e.target.value})} placeholder="Française" /></div>
                    <div><Label>N° Sécurité Sociale</Label><Input value={contratTravailData.salarieNumeroSecuSociale} onChange={(e) => setContratTravailData({...contratTravailData, salarieNumeroSecuSociale: e.target.value})} /></div>
                    <div className="md:col-span-2"><Label>Adresse</Label><Input value={contratTravailData.salarieAdresse} onChange={(e) => setContratTravailData({...contratTravailData, salarieAdresse: e.target.value})} /></div>
                    <div><Label>Code postal</Label><Input value={contratTravailData.salarieCodePostal} onChange={(e) => setContratTravailData({...contratTravailData, salarieCodePostal: e.target.value})} /></div>
                    <div><Label>Ville</Label><Input value={contratTravailData.salarieVille} onChange={(e) => setContratTravailData({...contratTravailData, salarieVille: e.target.value})} /></div>
                    <div><Label>Email</Label><Input value={contratTravailData.salarieEmail} onChange={(e) => setContratTravailData({...contratTravailData, salarieEmail: e.target.value})} type="email" /></div>
                    <div><Label>Téléphone</Label><Input value={contratTravailData.salarieTelephone} onChange={(e) => setContratTravailData({...contratTravailData, salarieTelephone: e.target.value})} /></div>
                  </div>
                  <h5 className="font-medium text-gray-700 mt-4">Pièces justificatives salarié</h5>
                  <SingleFileUpload label="Pièce d'identité" files={contratTravailSalarieIdentiteFiles} onFilesChange={setContratTravailSalarieIdentiteFiles} role="avocat" required />
                  <SingleFileUpload label="Carte Vitale / Attestation Sécurité Sociale" files={contratTravailSalarieVitaleFiles} onFilesChange={setContratTravailSalarieVitaleFiles} role="avocat" />
                  <SingleFileUpload label="RIB" files={contratTravailSalarieRIBFiles} onFilesChange={setContratTravailSalarieRIBFiles} role="avocat" required />
                  <SingleFileUpload label="Diplômes" files={contratTravailSalarieDiplomesFiles} onFilesChange={setContratTravailSalarieDiplomesFiles} role="avocat" />
                  <SingleFileUpload label="CV" files={contratTravailSalarieCVFiles} onFilesChange={setContratTravailSalarieCVFiles} role="avocat" />
                </div>

                {/* POSTE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">Poste et fonctions *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div className="md:col-span-2"><Label>Intitulé du poste *</Label><Input value={contratTravailData.posteIntitule} onChange={(e) => setContratTravailData({...contratTravailData, posteIntitule: e.target.value})} placeholder="Ex: Développeur Full Stack" /></div>
                    <div><Label>Classification</Label><Input value={contratTravailData.posteClassification} onChange={(e) => setContratTravailData({...contratTravailData, posteClassification: e.target.value})} placeholder="Selon convention collective" /></div>
                    <div><Label>Coefficient</Label><Input value={contratTravailData.posteCoefficient} onChange={(e) => setContratTravailData({...contratTravailData, posteCoefficient: e.target.value})} /></div>
                    <div><Label>Catégorie</Label><Select value={contratTravailData.posteCategorie} onValueChange={(val) => setContratTravailData({...contratTravailData, posteCategorie: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="employé">Employé</SelectItem><SelectItem value="agent_maitrise">Agent de maîtrise</SelectItem><SelectItem value="cadre">Cadre</SelectItem></SelectContent></Select></div>
                    <div><Label>Position</Label><Input value={contratTravailData.postePosition} onChange={(e) => setContratTravailData({...contratTravailData, postePosition: e.target.value})} placeholder="Selon grille convention" /></div>
                    <div className="md:col-span-2"><Label>Lieu de travail</Label><Input value={contratTravailData.posteLieuTravail} onChange={(e) => setContratTravailData({...contratTravailData, posteLieuTravail: e.target.value})} /></div>
                  </div>
                  <div><Label>Description des fonctions *</Label><Textarea value={contratTravailData.posteFonctions} onChange={(e) => setContratTravailData({...contratTravailData, posteFonctions: e.target.value})} placeholder="Missions principales du poste..." rows={4} /></div>
                </div>

                {/* DURÉE DU CONTRAT - CDI */}
                {contratTravailData.typeContrat === "CDI" && (
                  <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                    <h4 className="font-semibold text-lg text-blue-700">📅 Durée du contrat (CDI)</h4>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Date d'embauche *</Label><Input value={contratTravailData.cdiDateEmbauche} onChange={(e) => setContratTravailData({...contratTravailData, cdiDateEmbauche: e.target.value})} type="date" /></div>
                      <div><Label>Période d'essai</Label><Select value={contratTravailData.cdiPeriodeEssai} onValueChange={(val) => setContratTravailData({...contratTravailData, cdiPeriodeEssai: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                      {contratTravailData.cdiPeriodeEssai === "oui" && (
                        <>
                          <div><Label>Durée période d'essai (mois)</Label><Input value={contratTravailData.cdiPeriodeEssaiDuree} onChange={(e) => setContratTravailData({...contratTravailData, cdiPeriodeEssaiDuree: e.target.value})} placeholder="2" /></div>
                          <div><Label>Renouvellement possible</Label><Select value={contratTravailData.cdiPeriodeEssaiRenouvellement} onValueChange={(val) => setContratTravailData({...contratTravailData, cdiPeriodeEssaiRenouvellement: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                        </>
                      )}
                    </div>
                  </div>
                )}

                {/* DURÉE DU CONTRAT - CDD */}
                {contratTravailData.typeContrat === "CDD" && (
                  <div className="space-y-4 p-4 bg-white/50 rounded-lg border border-gray-200">
                    <h4 className="font-semibold text-lg text-blue-700">📅 Durée du contrat (CDD)</h4>
                    
                    {/* 1️⃣ MOTIF LÉGAL (OBLIGATOIRE) */}
                    <div className="p-3 bg-white border border-gray-300 rounded">
                      <p className="text-sm font-semibold text-gray-700 mb-2">⚠️ Motif obligatoire - Risque de requalification en CDI si absent</p>
                    </div>
                    
                    <div>
                      <Label>Motif légal du recours au CDD *</Label>
                      <Select value={contratTravailData.cddMotifRecours} onValueChange={(val) => setContratTravailData({...contratTravailData, cddMotifRecours: val})}>
                        <SelectTrigger><SelectValue placeholder="Choisir un motif légal" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="remplacement">Remplacement d'un salarié absent</SelectItem>
                          <SelectItem value="accroissement_activite">Accroissement temporaire d'activité</SelectItem>
                          <SelectItem value="travaux_saisonniers">Emploi saisonnier</SelectItem>
                          <SelectItem value="usage">CDD d'usage</SelectItem>
                          <SelectItem value="attente_cdi">Attente entrée en fonction CDI</SelectItem>
                          <SelectItem value="autre">Autre motif légal</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    {/* Détails selon le motif */}
                    {contratTravailData.cddMotifRecours === "remplacement" && (
                      <div className="p-3 bg-white rounded border space-y-3">
                        <div><Label>Nom du salarié remplacé *</Label><Input value={contratTravailData.cddMotifPrecisions} onChange={(e) => setContratTravailData({...contratTravailData, cddMotifPrecisions: e.target.value})} placeholder="Ex: Jean Dupont" /></div>
                        <div><Label>Motif de l'absence *</Label><Input value={contratTravailData.cddMotifAbsence} onChange={(e) => setContratTravailData({...contratTravailData, cddMotifAbsence: e.target.value})} placeholder="Ex: Congé maternité, arrêt maladie..." /></div>
                      </div>
                    )}
                    
                    {(contratTravailData.cddMotifRecours === "accroissement_activite" || contratTravailData.cddMotifRecours === "autre") && (
                      <div><Label>Précisions sur le motif *</Label><Textarea value={contratTravailData.cddMotifPrecisions} onChange={(e) => setContratTravailData({...contratTravailData, cddMotifPrecisions: e.target.value})} placeholder="Détailler le motif légal du recours au CDD..." rows={2} /></div>
                    )}
                    
                    {/* 2️⃣ DURÉE DU CDD */}
                    <div className="space-y-3 mt-4">
                      <h5 className="font-medium text-gray-600">Type de terme</h5>
                      <Select value={contratTravailData.cddTypeTerme} onValueChange={(val) => setContratTravailData({...contratTravailData, cddTypeTerme: val})}>
                        <SelectTrigger><SelectValue placeholder="Choisir le type de terme" /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="precis">CDD à terme précis (dates définies)</SelectItem>
                          <SelectItem value="imprecis">CDD à terme imprécis (retour salarié, fin chantier...)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    {contratTravailData.cddTypeTerme === "precis" && (
                      <div className="grid md:grid-cols-2 gap-4">
                        <div><Label>Date de début du CDD *</Label><Input value={contratTravailData.cddDateDebut} onChange={(e) => setContratTravailData({...contratTravailData, cddDateDebut: e.target.value})} type="date" /></div>
                        <div><Label>Date de fin du CDD *</Label><Input value={contratTravailData.cddDateFin} onChange={(e) => setContratTravailData({...contratTravailData, cddDateFin: e.target.value})} type="date" /></div>
                      </div>
                    )}
                    
                    {contratTravailData.cddTypeTerme === "imprecis" && (
                      <div className="space-y-3">
                        <div><Label>Date de début *</Label><Input value={contratTravailData.cddDateDebut} onChange={(e) => setContratTravailData({...contratTravailData, cddDateDebut: e.target.value})} type="date" /></div>
                        <div><Label>Durée minimale *</Label><Input value={contratTravailData.cddDuree} onChange={(e) => setContratTravailData({...contratTravailData, cddDuree: e.target.value})} placeholder="Ex: Jusqu'au retour de M. X / Fin du chantier" /></div>
                        <div><Label>Durée maximale estimée</Label><Input value={contratTravailData.cddDureeMax} onChange={(e) => setContratTravailData({...contratTravailData, cddDureeMax: e.target.value})} placeholder="Ex: 6 mois maximum" /></div>
                      </div>
                    )}
                    
                    {/* 3️⃣ RENOUVELLEMENT */}
                    <div className="space-y-3 mt-4 p-3 bg-white rounded border">
                      <h5 className="font-medium text-gray-600">Renouvellement du CDD</h5>
                      <p className="text-xs text-gray-600">Mention obligatoire dans le contrat, même si aucun renouvellement prévu</p>
                      
                      <div><Label>Renouvellement possible ? *</Label><Select value={contratTravailData.cddRenouvellement} onValueChange={(val) => setContratTravailData({...contratTravailData, cddRenouvellement: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non - Pas de renouvellement</SelectItem><SelectItem value="oui">Oui - Renouvellement possible</SelectItem></SelectContent></Select></div>
                      
                      {contratTravailData.cddRenouvellement === "oui" && (
                        <div className="space-y-3">
                          <div><Label>Nombre maximum de renouvellements *</Label><Select value={contratTravailData.cddRenouvellementNombre} onValueChange={(val) => setContratTravailData({...contratTravailData, cddRenouvellementNombre: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="1">1 fois</SelectItem><SelectItem value="2">2 fois</SelectItem></SelectContent></Select></div>
                          <div><Label>Durée totale maximale envisagée *</Label><Input value={contratTravailData.cddRenouvellementDureeMax} onChange={(e) => setContratTravailData({...contratTravailData, cddRenouvellementDureeMax: e.target.value})} placeholder="Ex: 18 mois maximum" /></div>
                          <div><Label>Modalités du renouvellement</Label><Textarea value={contratTravailData.cddRenouvellementModalites} onChange={(e) => setContratTravailData({...contratTravailData, cddRenouvellementModalites: e.target.value})} placeholder="Préciser les conditions de renouvellement..." rows={2} /></div>
                        </div>
                      )}
                    </div>
                    
                    {/* 4️⃣ PÉRIODE D'ESSAI CDD */}
                    <div className="space-y-3 mt-4 p-3 bg-white rounded border border-gray-300">
                      <h5 className="font-medium text-gray-700">Période d'essai (CDD)</h5>
                      <div className="text-xs text-gray-700 p-2 bg-gray-100 rounded">
                        📚 Base légale :<br/>
                        • CDD ≤ 6 mois : 1 jour par semaine (max 2 semaines)<br/>
                        • CDD &gt; 6 mois : 1 mois maximum
                      </div>
                      
                      <div><Label>Période d'essai ?</Label><Select value={contratTravailData.cddPeriodeEssai} onValueChange={(val) => setContratTravailData({...contratTravailData, cddPeriodeEssai: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non</SelectItem><SelectItem value="oui">Oui</SelectItem></SelectContent></Select></div>
                      
                      {contratTravailData.cddPeriodeEssai === "oui" && (
                        <div><Label>Durée de la période d'essai</Label><Input value={contratTravailData.cddPeriodeEssaiDuree} onChange={(e) => setContratTravailData({...contratTravailData, cddPeriodeEssaiDuree: e.target.value})} placeholder="Ex: 2 semaines / 1 mois" /></div>
                      )}
                    </div>
                    
                    {/* 5️⃣ INDEMNITÉ DE FIN DE CONTRAT */}
                    <div className="space-y-3 mt-4 p-3 bg-white rounded border border-gray-300">
                      <h5 className="font-medium text-gray-700">Indemnité de fin de contrat (prime de précarité)</h5>
                      
                      <div><Label>Indemnité de fin de contrat *</Label><Select value={contratTravailData.cddIndemniteFinContrat} onValueChange={(val) => setContratTravailData({...contratTravailData, cddIndemniteFinContrat: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="10%">Oui - 10% de la rémunération brute totale</SelectItem><SelectItem value="exoneration">Non - Exonération légale applicable</SelectItem></SelectContent></Select></div>
                      
                      {contratTravailData.cddIndemniteFinContrat === "exoneration" && (
                        <div>
                          <Label>Motif d'exonération *</Label>
                          <Select value={contratTravailData.cddIndemniteExonerationMotif} onValueChange={(val) => setContratTravailData({...contratTravailData, cddIndemniteExonerationMotif: val})}>
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="saisonnier">CDD saisonnier</SelectItem>
                              <SelectItem value="usage">CDD d'usage</SelectItem>
                              <SelectItem value="refus_cdi">Refus de CDI par le salarié</SelectItem>
                              <SelectItem value="contrat_aide">Contrat aidé</SelectItem>
                              <SelectItem value="jeune_vacances">Contrat jeune pendant vacances scolaires/universitaires</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>
                    
                    {/* 6️⃣ DÉLAI DE CARENCE */}
                    <div className="space-y-3 mt-4 p-3 bg-white rounded border">
                      <h5 className="font-medium text-gray-700">Délai de carence (information juridique)</h5>
                      <p className="text-xs text-gray-600">En principe, un délai de carence s'applique entre deux CDD sur le même poste (1/3 ou 1/2 de la durée du CDD précédent)</p>
                      
                      <div><Label>Délai de carence applicable ?</Label><Select value={contratTravailData.cddDelaiCarence} onValueChange={(val) => setContratTravailData({...contratTravailData, cddDelaiCarence: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="non">Non (premier CDD ou exception)</SelectItem><SelectItem value="oui">Oui - Délai de carence respecté</SelectItem></SelectContent></Select></div>
                      
                      {contratTravailData.cddDelaiCarence === "oui" && (
                        <div><Label>Précisions sur le délai</Label><Input value={contratTravailData.cddDelaiCarencePrecisions} onChange={(e) => setContratTravailData({...contratTravailData, cddDelaiCarencePrecisions: e.target.value})} placeholder="Durée du délai respecté..." /></div>
                      )}
                    </div>
                  </div>
                )}

                {/* TEMPS DE TRAVAIL */}
                <div className="space-y-4 p-4 bg-white/50 rounded-lg border border-gray-300">
                  <h4 className="font-semibold text-lg text-blue-700">⏰ Temps de travail *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Type</Label><Select value={contratTravailData.tempsTravailType} onValueChange={(val) => setContratTravailData({...contratTravailData, tempsTravailType: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="temps_plein">Temps plein</SelectItem><SelectItem value="temps_partiel">Temps partiel</SelectItem></SelectContent></Select></div>
                    <div><Label>Durée hebdomadaire (heures) *</Label><Input value={contratTravailData.tempsTravailDureeHebdo} onChange={(e) => setContratTravailData({...contratTravailData, tempsTravailDureeHebdo: e.target.value})} placeholder="35" /></div>
                    <div className="md:col-span-2"><Label>Répartition horaire</Label><Input value={contratTravailData.tempsTravailRepartition} onChange={(e) => setContratTravailData({...contratTravailData, tempsTravailRepartition: e.target.value})} placeholder="Lundi-Vendredi 9h-17h" /></div>
                    <div><Label>Télétravail</Label><Select value={contratTravailData.tempsTravailTeletravail} onValueChange={(val) => setContratTravailData({...contratTravailData, tempsTravailTeletravail: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                    {contratTravailData.tempsTravailTeletravail === "oui" && <div><Label>Jours de télétravail</Label><Input value={contratTravailData.tempsTravailTeletravailJours} onChange={(e) => setContratTravailData({...contratTravailData, tempsTravailTeletravailJours: e.target.value})} placeholder="Ex: 2 jours/semaine" /></div>}
                  </div>
                </div>

                {/* RÉMUNÉRATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">💰 Rémunération *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Salaire brut mensuel * (€)</Label><Input value={contratTravailData.remunerationBruteMensuelle} onChange={(e) => setContratTravailData({...contratTravailData, remunerationBruteMensuelle: e.target.value})} placeholder="Ex: 3000" /></div>
                    <div><Label>Salaire brut annuel (€)</Label><Input value={contratTravailData.remunerationBruteAnnuelle} onChange={(e) => setContratTravailData({...contratTravailData, remunerationBruteAnnuelle: e.target.value})} placeholder="Ex: 36000" /></div>
                    <div><Label>Minimum conventionnel (€)</Label><Input value={contratTravailData.remunerationMinimumConventionnel} onChange={(e) => setContratTravailData({...contratTravailData, remunerationMinimumConventionnel: e.target.value})} /></div>
                    <div><Label>Primes</Label><Select value={contratTravailData.remunerationPrimes} onValueChange={(val) => setContratTravailData({...contratTravailData, remunerationPrimes: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                    {contratTravailData.remunerationPrimes === "oui" && <div className="md:col-span-2"><Label>Description des primes</Label><Textarea value={contratTravailData.remunerationPrimesDescription} onChange={(e) => setContratTravailData({...contratTravailData, remunerationPrimesDescription: e.target.value})} placeholder="Ex: Prime sur objectifs, 13ème mois..." rows={2} /></div>}
                    <div><Label>Date de paiement</Label><Input value={contratTravailData.remunerationDatePaiement} onChange={(e) => setContratTravailData({...contratTravailData, remunerationDatePaiement: e.target.value})} placeholder="Ex: Dernier jour du mois" /></div>
                    <div><Label>Modalité paiement</Label><Select value={contratTravailData.remunerationModalitePaiement} onValueChange={(val) => setContratTravailData({...contratTravailData, remunerationModalitePaiement: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="virement">Virement bancaire</SelectItem><SelectItem value="cheque">Chèque</SelectItem></SelectContent></Select></div>
                  </div>
                </div>

                {/* CONGÉS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">🏖️ Congés</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Congés payés (jours/an)</Label><Input value={contratTravailData.congesPayesDuree} onChange={(e) => setContratTravailData({...contratTravailData, congesPayesDuree: e.target.value})} placeholder="30 jours ouvrables" /></div>
                    <div><Label>Période d'acquisition</Label><Input value={contratTravailData.congesPayesAcquisition} onChange={(e) => setContratTravailData({...contratTravailData, congesPayesAcquisition: e.target.value})} placeholder="1er juin - 31 mai" /></div>
                    <div><Label>RTT</Label><Select value={contratTravailData.congesRTT} onValueChange={(val) => setContratTravailData({...contratTravailData, congesRTT: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                    {contratTravailData.congesRTT === "oui" && <div><Label>Nombre de RTT</Label><Input value={contratTravailData.congesRTTNombre} onChange={(e) => setContratTravailData({...contratTravailData, congesRTTNombre: e.target.value})} placeholder="Ex: 10 jours" /></div>}
                  </div>
                </div>

                {/* CLAUSES SPÉCIALES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📋 Clauses spéciales</h4>
                  <div className="space-y-3">
                    <div><Label>Confidentialité</Label><Select value={contratTravailData.clauseConfidentialite} onValueChange={(val) => setContratTravailData({...contratTravailData, clauseConfidentialite: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                    <div><Label>Non-concurrence</Label><Select value={contratTravailData.clauseNonConcurrence} onValueChange={(val) => setContratTravailData({...contratTravailData, clauseNonConcurrence: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                    {contratTravailData.clauseNonConcurrence === "oui" && (
                      <div className="p-3 bg-white rounded border space-y-3">
                        <div className="grid md:grid-cols-3 gap-4">
                          <div><Label>Durée (mois)</Label><Input value={contratTravailData.clauseNonConcurrenceDuree} onChange={(e) => setContratTravailData({...contratTravailData, clauseNonConcurrenceDuree: e.target.value})} placeholder="12" /></div>
                          <div><Label>Territoire</Label><Input value={contratTravailData.clauseNonConcurrenceTerritoire} onChange={(e) => setContratTravailData({...contratTravailData, clauseNonConcurrenceTerritoire: e.target.value})} placeholder="France" /></div>
                          <div><Label>Contrepartie (€/mois)</Label><Input value={contratTravailData.clauseNonConcurrenceContrepartieMontant} onChange={(e) => setContratTravailData({...contratTravailData, clauseNonConcurrenceContrepartieMontant: e.target.value})} placeholder="500" /></div>
                        </div>
                      </div>
                    )}
                    <div><Label>Exclusivité</Label><Select value={contratTravailData.clauseExclusivite} onValueChange={(val) => setContratTravailData({...contratTravailData, clauseExclusivite: val})}><SelectTrigger><SelectValue /></SelectTrigger><SelectContent><SelectItem value="oui">Oui</SelectItem><SelectItem value="non">Non</SelectItem></SelectContent></Select></div>
                  </div>
                </div>

                {/* PIÈCES JUSTIFICATIVES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-blue-700">📄 Documents</h4>
                  <SingleFileUpload label="Fiche de poste" files={contratTravailFichePosteFiles} onFilesChange={setContratTravailFichePosteFiles} role="avocat" />
                  <SingleFileUpload label="Règlement intérieur" files={contratTravailReglementInterieurFiles} onFilesChange={setContratTravailReglementInterieurFiles} role="avocat" />
                  <MultiFileUpload label="Autres annexes" files={contratTravailAnnexesFiles} onFilesChange={setContratTravailAnnexesFiles} role="avocat" />
                </div>
              </div>
            )}

            {/* Formulaire Convention de stage */}
            {pendingContractType === "Convention de stage" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🎓 Convention de stage</h3>
                
                {/* TYPE DE STAGE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Type de stage *</h4>
                  <Select value={conventionStageData.stageType} onValueChange={(val) => setConventionStageData({...conventionStageData, stageType: val})}>
                    <SelectTrigger><SelectValue /></SelectTrigger>
                    <SelectContent>
                      <SelectItem value="obligatoire">☑️ Obligatoire (dans le cadre du cursus)</SelectItem>
                      <SelectItem value="optionnel">📌 Optionnel</SelectItem>
                      <SelectItem value="insertion_professionnelle">💼 Stage d'insertion professionnelle</SelectItem>
                      <SelectItem value="etranger">🌍 Stage à l'étranger</SelectItem>
                    </SelectContent>
                  </Select>
                </div>

                {/* 1️⃣ IDENTIFICATION DES PARTIES */}
                
                {/* A. ÉTABLISSEMENT D'ENSEIGNEMENT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🏫 A. Établissement d'enseignement *</h4>
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom de l'établissement *</Label><Input value={conventionStageData.etablissementNom} onChange={(e) => setConventionStageData({...conventionStageData, etablissementNom: e.target.value})} placeholder="Université / École" /></div>
                    <div><Label>Département / UFR / Pôle</Label><Input value={conventionStageData.etablissementDepartement} onChange={(e) => setConventionStageData({...conventionStageData, etablissementDepartement: e.target.value})} placeholder="Ex: UFR Droit" /></div>
                    <div><Label>Adresse *</Label><Input value={conventionStageData.etablissementAdresse} onChange={(e) => setConventionStageData({...conventionStageData, etablissementAdresse: e.target.value})} /></div>
                    <div><Label>Code postal *</Label><Input value={conventionStageData.etablissementCodePostal} onChange={(e) => setConventionStageData({...conventionStageData, etablissementCodePostal: e.target.value})} /></div>
                    <div><Label>Ville *</Label><Input value={conventionStageData.etablissementVille} onChange={(e) => setConventionStageData({...conventionStageData, etablissementVille: e.target.value})} /></div>
                    <div><Label>SIRET (si applicable)</Label><Input value={conventionStageData.etablissementSiret} onChange={(e) => setConventionStageData({...conventionStageData, etablissementSiret: e.target.value})} /></div>
                    <div><Label>Représentant légal *</Label><Input value={conventionStageData.etablissementRepresentant} onChange={(e) => setConventionStageData({...conventionStageData, etablissementRepresentant: e.target.value})} placeholder="Nom du président / directeur" /></div>
                    <div><Label>Cachet</Label><Input value={conventionStageData.etablissementCachet} onChange={(e) => setConventionStageData({...conventionStageData, etablissementCachet: e.target.value})} placeholder="Optionnel" /></div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">Responsable pédagogique</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom et prénom *</Label><Input value={conventionStageData.etablissementResponsablePedagogique} onChange={(e) => setConventionStageData({...conventionStageData, etablissementResponsablePedagogique: e.target.value})} /></div>
                      <div><Label>Fonction</Label><Input value={conventionStageData.etablissementResponsableFonction} onChange={(e) => setConventionStageData({...conventionStageData, etablissementResponsableFonction: e.target.value})} placeholder="Ex: Professeur, Responsable formation" /></div>
                      <div><Label>Email *</Label><Input type="email" value={conventionStageData.etablissementResponsableEmail} onChange={(e) => setConventionStageData({...conventionStageData, etablissementResponsableEmail: e.target.value})} /></div>
                      <div><Label>Téléphone *</Label><Input value={conventionStageData.etablissementResponsableTelephone} onChange={(e) => setConventionStageData({...conventionStageData, etablissementResponsableTelephone: e.target.value})} /></div>
                    </div>
                  </div>
                </div>

                {/* B. STAGIAIRE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">👤 B. Stagiaire *</h4>
                  
                  <div className="mb-4">
                    <Label>Sélectionner parmi vos clients (optionnel)</Label>
                    <Select value={conventionStageClientIdStagiaire} onValueChange={(clientId) => {
                      setConventionStageClientIdStagiaire(clientId);
                      const client = clients.find(c => c.id === clientId);
                      if (client && clientId !== "none") {
                        setConventionStageData({
                          ...conventionStageData,
                          stagiaireNom: client.nom || "",
                          stagiairePrenom: client.prenom || "",
                          stagiaireDateNaissance: client.date_naissance || "",
                          stagiaireLieuNaissance: client.lieu_naissance || "",
                          stagiaireAdresse: client.adresse || "",
                          stagiaireCodePostal: client.code_postal || "",
                          stagiaireVille: client.ville || "",
                          stagiaireEmail: client.email || "",
                          stagiaireTelephone: client.telephone || "",
                          stagiaireNationalite: client.nationalite || ""
                        });
                      }
                    }}>
                      <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                        {clients.map((client) => (
                          <SelectItem key={client.id} value={client.id}>
                            {client.prenom} {client.nom}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Nom *</Label><Input value={conventionStageData.stagiaireNom} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireNom: e.target.value})} /></div>
                    <div><Label>Prénom *</Label><Input value={conventionStageData.stagiairePrenom} onChange={(e) => setConventionStageData({...conventionStageData, stagiairePrenom: e.target.value})} /></div>
                    <div><Label>Date de naissance *</Label><Input type="date" value={conventionStageData.stagiaireDateNaissance} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireDateNaissance: e.target.value})} /></div>
                    <div><Label>Lieu de naissance</Label><Input value={conventionStageData.stagiaireLieuNaissance} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireLieuNaissance: e.target.value})} /></div>
                    <div><Label>Nationalité</Label><Input value={conventionStageData.stagiaireNationalite} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireNationalite: e.target.value})} placeholder="Ex: Française" /></div>
                    <div><Label>Numéro étudiant</Label><Input value={conventionStageData.stagiaireNumeroEtudiant} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireNumeroEtudiant: e.target.value})} /></div>
                    <div><Label>Adresse *</Label><Input value={conventionStageData.stagiaireAdresse} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAdresse: e.target.value})} /></div>
                    <div><Label>Code postal *</Label><Input value={conventionStageData.stagiaireCodePostal} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireCodePostal: e.target.value})} /></div>
                    <div><Label>Ville *</Label><Input value={conventionStageData.stagiaireVille} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireVille: e.target.value})} /></div>
                    <div><Label>Email *</Label><Input type="email" value={conventionStageData.stagiaireEmail} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireEmail: e.target.value})} /></div>
                    <div><Label>Téléphone *</Label><Input value={conventionStageData.stagiaireTelephone} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireTelephone: e.target.value})} /></div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">Formation</h5>
                    <div className="grid md:grid-cols-3 gap-4">
                      <div><Label>Filière / Diplôme préparé *</Label><Input value={conventionStageData.stagiaireFiliere} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireFiliere: e.target.value})} placeholder="Ex: Master Droit des affaires" /></div>
                      <div>
                        <Label>Niveau d'études *</Label>
                        <Select value={conventionStageData.stagiaireNiveauEtudes} onValueChange={(val) => setConventionStageData({...conventionStageData, stagiaireNiveauEtudes: val})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner" /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="L1">L1</SelectItem>
                            <SelectItem value="L2">L2</SelectItem>
                            <SelectItem value="L3">L3</SelectItem>
                            <SelectItem value="M1">M1</SelectItem>
                            <SelectItem value="M2">M2</SelectItem>
                            <SelectItem value="Doctorat">Doctorat</SelectItem>
                            <SelectItem value="BTS">BTS</SelectItem>
                            <SelectItem value="DUT">DUT</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div><Label>Année universitaire *</Label><Input value={conventionStageData.stagiaireAnneeUniversitaire} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAnneeUniversitaire: e.target.value})} placeholder="Ex: 2024-2025" /></div>
                    </div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200 bg-blue-50/50 -m-4 p-4 rounded">
                    <h5 className="font-semibold text-gray-700 mb-3">⚠️ Assurances (OBLIGATOIRE)</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Assurance responsabilité civile *</Label><Input value={conventionStageData.stagiaireAssuranceRC} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAssuranceRC: e.target.value})} placeholder="Nom de l'assurance" /></div>
                      <div><Label>Numéro de police RC *</Label><Input value={conventionStageData.stagiaireAssuranceRCNumero} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAssuranceRCNumero: e.target.value})} /></div>
                      <div><Label>Assurance scolaire (optionnelle)</Label><Input value={conventionStageData.stagiaireAssuranceScolaire} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAssuranceScolaire: e.target.value})} placeholder="Nom de l'assurance" /></div>
                      <div><Label>Numéro de police scolaire</Label><Input value={conventionStageData.stagiaireAssuranceScolaireNumero} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAssuranceScolaireNumero: e.target.value})} /></div>
                    </div>
                  </div>
                </div>

                {/* C. ORGANISME D'ACCUEIL (ENTREPRISE) */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🏢 C. Organisme d'accueil (Entreprise) *</h4>
                  
                  <div className="mb-4">
                    <Label>Sélectionner parmi vos clients (optionnel)</Label>
                    <Select value={conventionStageClientIdEntreprise} onValueChange={setConventionStageClientIdEntreprise}>
                      <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="none">Aucun client (saisie manuelle)</SelectItem>
                        {clients.map((client) => (
                          <SelectItem key={client.id} value={client.id}>
                            {client.prenom} {client.nom}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>

                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Dénomination sociale *</Label><Input value={conventionStageData.entrepriseDenomination} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseDenomination: e.target.value})} /></div>
                    <div><Label>Forme juridique</Label><Input value={conventionStageData.entrepriseFormeJuridique} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseFormeJuridique: e.target.value})} placeholder="SARL, SAS, SA..." /></div>
                    <div><Label>SIREN</Label><Input value={conventionStageData.entrepriseSiren} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseSiren: e.target.value})} /></div>
                    <div><Label>RCS</Label><Input value={conventionStageData.entrepriseRCS} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseRCS: e.target.value})} /></div>
                    <div><Label>Taille (effectif)</Label><Input value={conventionStageData.entrepriseTaille} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseTaille: e.target.value})} placeholder="Ex: 50 salariés" /></div>
                    <div><Label>Convention collective</Label><Input value={conventionStageData.entrepriseConventionCollective} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseConventionCollective: e.target.value})} /></div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">Siège social</h5>
                    <div className="grid md:grid-cols-3 gap-4">
                      <div><Label>Adresse *</Label><Input value={conventionStageData.entrepriseSiege} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseSiege: e.target.value})} /></div>
                      <div><Label>Code postal *</Label><Input value={conventionStageData.entrepriseSiegeCodePostal} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseSiegeCodePostal: e.target.value})} /></div>
                      <div><Label>Ville *</Label><Input value={conventionStageData.entrepriseSiegeVille} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseSiegeVille: e.target.value})} /></div>
                    </div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">Lieu de stage (si différent du siège)</h5>
                    <div className="grid md:grid-cols-3 gap-4">
                      <div><Label>Adresse</Label><Input value={conventionStageData.entrepriseLieuStage} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseLieuStage: e.target.value})} /></div>
                      <div><Label>Code postal</Label><Input value={conventionStageData.entrepriseLieuStageCodePostal} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseLieuStageCodePostal: e.target.value})} /></div>
                      <div><Label>Ville</Label><Input value={conventionStageData.entrepriseLieuStageVille} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseLieuStageVille: e.target.value})} /></div>
                    </div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">Représentant légal</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom et prénom *</Label><Input value={conventionStageData.entrepriseRepresentant} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseRepresentant: e.target.value})} /></div>
                      <div><Label>Fonction</Label><Input value={conventionStageData.entrepriseRepresentantFonction} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseRepresentantFonction: e.target.value})} placeholder="Ex: Directeur général" /></div>
                    </div>
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">👔 Tuteur de stage (OBLIGATOIRE)</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom et prénom *</Label><Input value={conventionStageData.entrepriseTuteurNom} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseTuteurNom: e.target.value})} /></div>
                      <div><Label>Fonction *</Label><Input value={conventionStageData.entrepriseTuteurFonction} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseTuteurFonction: e.target.value})} /></div>
                      <div><Label>Email *</Label><Input type="email" value={conventionStageData.entrepriseTuteurEmail} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseTuteurEmail: e.target.value})} /></div>
                      <div><Label>Téléphone *</Label><Input value={conventionStageData.entrepriseTuteurTelephone} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseTuteurTelephone: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Service d'accueil</Label><Input value={conventionStageData.entrepriseServiceAccueil} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseServiceAccueil: e.target.value})} placeholder="Ex: Direction juridique" /></div>
                    </div>
                  </div>
                </div>

                {/* 2️⃣ OBJET DU STAGE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">2️⃣ Objet du stage *</h4>
                  
                  <div className="p-3 bg-red-50 rounded border border-red-200">
                    <p className="text-sm font-semibold text-red-700">⚠️ IMPORTANT : Description détaillée des missions</p>
                    <p className="text-xs text-red-600 mt-1">La description doit être très précise pour éviter la requalification en contrat de travail.</p>
                  </div>
                  
                  <div className="space-y-4">
                    <div>
                      <Label>Finalités pédagogiques du stage *</Label>
                      <Textarea 
                        value={conventionStageData.stageFinalites} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageFinalites: e.target.value})} 
                        placeholder="Ex: Mise en pratique des connaissances théoriques acquises en M2 Droit des affaires..." 
                        className="min-h-[80px]" 
                      />
                    </div>
                    
                    <div>
                      <Label>Objectifs d'acquisition de compétences *</Label>
                      <Textarea 
                        value={conventionStageData.stageObjectifsCompetences} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageObjectifsCompetences: e.target.value})} 
                        placeholder="Ex: Développer des compétences en rédaction d'actes, conseil juridique, négociation contractuelle..." 
                        className="min-h-[80px]" 
                      />
                    </div>
                    
                    <div>
                      <Label>Description détaillée des missions confiées * (CRUCIAL)</Label>
                      <Textarea 
                        value={conventionStageData.stageMissionsDetaillees} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageMissionsDetaillees: e.target.value})} 
                        placeholder="Ex: - Rédaction de notes juridiques\n- Recherches documentaires\n- Participation aux réunions clients\n- Rédaction de contrats sous supervision\n- Veille juridique..." 
                        className="min-h-[120px]" 
                      />
                    </div>
                    
                    <div>
                      <Label>Intérêt pédagogique pour la formation</Label>
                      <Textarea 
                        value={conventionStageData.stageInteretPedagogique} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageInteretPedagogique: e.target.value})} 
                        placeholder="Ex: Permet la validation du stage obligatoire de M2 et l'obtention du diplôme..." 
                        className="min-h-[60px]" 
                      />
                    </div>
                    
                    <div>
                      <Label>Position du stagiaire dans le service</Label>
                      <Input 
                        value={conventionStageData.stagePositionService} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stagePositionService: e.target.value})} 
                        placeholder="Ex: Au sein de l'équipe juridique, sous la supervision du tuteur" 
                      />
                    </div>
                  </div>
                </div>

                {/* 3️⃣ DURÉE DU STAGE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">3️⃣ Durée du stage *</h4>
                  
                  <div className="grid md:grid-cols-3 gap-4">
                    <div><Label>Date de début *</Label><Input type="date" value={conventionStageData.stageDateDebut} onChange={(e) => setConventionStageData({...conventionStageData, stageDateDebut: e.target.value})} /></div>
                    <div><Label>Date de fin *</Label><Input type="date" value={conventionStageData.stageDateFin} onChange={(e) => setConventionStageData({...conventionStageData, stageDateFin: e.target.value})} /></div>
                    <div><Label>Nombre de semaines</Label><Input type="number" value={conventionStageData.stageNombreSemaines} onChange={(e) => setConventionStageData({...conventionStageData, stageNombreSemaines: e.target.value})} placeholder="Ex: 12" /></div>
                  </div>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Nombre d'heures total de présence</Label>
                      <Input 
                        type="number" 
                        value={conventionStageData.stageNombreHeuresTotal} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageNombreHeuresTotal: e.target.value})} 
                        placeholder="Ex: 420 heures" 
                      />
                      <p className="text-xs text-gray-600 mt-1">⚠️ Si ≥ 308h (44 jours), gratification obligatoire</p>
                    </div>
                    <div>
                      <Label>Volume horaire hebdomadaire</Label>
                      <Input 
                        type="number" 
                        value={conventionStageData.stageVolumeHebdomadaire} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageVolumeHebdomadaire: e.target.value})} 
                        placeholder="Maximum 35h/semaine" 
                      />
                    </div>
                  </div>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Prolongation possible ?</Label>
                      <Select value={conventionStageData.stageProlongationPossible} onValueChange={(val) => setConventionStageData({...conventionStageData, stageProlongationPossible: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Temps partiel ?</Label>
                      <Select value={conventionStageData.stageTempsPartiel} onValueChange={(val) => setConventionStageData({...conventionStageData, stageTempsPartiel: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non (temps plein)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                  
                  <div>
                    <Label>Interruptions (vacances, période d'examens)</Label>
                    <Textarea 
                      value={conventionStageData.stageInterruptions} 
                      onChange={(e) => setConventionStageData({...conventionStageData, stageInterruptions: e.target.value})} 
                      placeholder="Ex: Pause du 1er au 15 février pour examens partiels" 
                      className="min-h-[60px]" 
                    />
                  </div>
                </div>

                {/* 4️⃣ HORAIRES & ORGANISATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">4️⃣ Horaires & Organisation du temps</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Horaires journaliers</Label><Input value={conventionStageData.stageHorairesJournaliers} onChange={(e) => setConventionStageData({...conventionStageData, stageHorairesJournaliers: e.target.value})} placeholder="Ex: 9h-17h" /></div>
                    <div><Label>Horaires hebdomadaires</Label><Input value={conventionStageData.stageHorairesHebdomadaires} onChange={(e) => setConventionStageData({...conventionStageData, stageHorairesHebdomadaires: e.target.value})} placeholder="Ex: Lundi-Vendredi" /></div>
                    <div><Label>Pauses</Label><Input value={conventionStageData.stagePauses} onChange={(e) => setConventionStageData({...conventionStageData, stagePauses: e.target.value})} placeholder="Ex: 1h de pause déjeuner" /></div>
                    <div><Label>Rythme particulier</Label><Input value={conventionStageData.stageRythmeParticulier} onChange={(e) => setConventionStageData({...conventionStageData, stageRythmeParticulier: e.target.value})} placeholder="Ex: travail en soirée occasionnel" /></div>
                  </div>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Télétravail autorisé ?</Label>
                      <Select value={conventionStageData.stageTeletravail} onValueChange={(val) => setConventionStageData({...conventionStageData, stageTeletravail: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui (exceptionnel pour stagiaires)</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Déplacements professionnels ?</Label>
                      <Select value={conventionStageData.stageDeplacementsPro} onValueChange={(val) => setConventionStageData({...conventionStageData, stageDeplacementsPro: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                  
                  {conventionStageData.stageDeplacementsPro === "oui" && (
                    <div>
                      <Label>Prise en charge des déplacements</Label>
                      <Textarea 
                        value={conventionStageData.stageDeplacementsPriseEnCharge} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageDeplacementsPriseEnCharge: e.target.value})} 
                        placeholder="Ex: Remboursement sur facture des frais de transport, hébergement pris en charge..." 
                        className="min-h-[60px]" 
                      />
                    </div>
                  )}
                </div>

                {/* 5️⃣ GRATIFICATION / INDEMNISATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">5️⃣ Gratification / Indemnisation</h4>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <p className="text-sm font-semibold text-gray-700">⚠️ Gratification obligatoire dès 44 jours (308h) de stage</p>
                    <p className="text-xs text-gray-600 mt-1">Minimum légal 2024 : 4,35€/heure (indexé chaque année)</p>
                  </div>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Gratification prévue ?</Label>
                      <Select value={conventionStageData.stageGratification} onValueChange={(val) => setConventionStageData({...conventionStageData, stageGratification: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non (stage &lt; 44 jours)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    
                    {conventionStageData.stageGratification === "oui" && (
                      <>
                        <div>
                          <Label>Montant horaire exact *</Label>
                          <Input 
                            type="number" 
                            step="0.01" 
                            value={conventionStageData.stageGratificationMontantHoraire} 
                            onChange={(e) => setConventionStageData({...conventionStageData, stageGratificationMontantHoraire: e.target.value})} 
                            placeholder="Minimum : 4,35€" 
                          />
                        </div>
                        <div>
                          <Label>Modalité de versement</Label>
                          <Select value={conventionStageData.stageGratificationModalite} onValueChange={(val) => setConventionStageData({...conventionStageData, stageGratificationModalite: val})}>
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="mensuelle">Mensuelle</SelectItem>
                              <SelectItem value="fin_stage">En fin de stage</SelectItem>
                              <SelectItem value="prorata">Au prorata si absence</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </>
                    )}
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-blue-200">
                    <h5 className="font-semibold text-gray-700 mb-3">Avantages éventuels</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <Label>Tickets restaurant</Label>
                        <Select value={conventionStageData.stageTicketsRestaurant} onValueChange={(val) => setConventionStageData({...conventionStageData, stageTicketsRestaurant: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Prise en charge transport</Label>
                        <Input 
                          value={conventionStageData.stagePriseEnChargeTransport} 
                          onChange={(e) => setConventionStageData({...conventionStageData, stagePriseEnChargeTransport: e.target.value})} 
                          placeholder="Minimum légal : 50%" 
                        />
                      </div>
                      <div>
                        <Label>Indemnités de déplacement</Label>
                        <Select value={conventionStageData.stageIndemnitesDeplacement} onValueChange={(val) => setConventionStageData({...conventionStageData, stageIndemnitesDeplacement: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div>
                        <Label>Autres avantages en nature</Label>
                        <Input 
                          value={conventionStageData.stageAvantagesNature} 
                          onChange={(e) => setConventionStageData({...conventionStageData, stageAvantagesNature: e.target.value})} 
                          placeholder="Ex: Ordinateur portable, téléphone..." 
                        />
                      </div>
                    </div>
                  </div>
                </div>

                {/* 6️⃣ ENCADREMENT PÉDAGOGIQUE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">6️⃣ Encadrement pédagogique</h4>
                  
                  <div className="space-y-4">
                    <div className="p-3 bg-white rounded border border-blue-200">
                      <h5 className="font-semibold text-gray-700 mb-2">Tuteur pédagogique (école)</h5>
                      <div className="grid md:grid-cols-2 gap-4">
                        <div><Label>Nom et prénom</Label><Input value={conventionStageData.tuteurPedagogiqueNom} onChange={(e) => setConventionStageData({...conventionStageData, tuteurPedagogiqueNom: e.target.value})} /></div>
                        <div><Label>Fonction</Label><Input value={conventionStageData.tuteurPedagogiqueFonction} onChange={(e) => setConventionStageData({...conventionStageData, tuteurPedagogiqueFonction: e.target.value})} placeholder="Ex: Maître de conférences" /></div>
                        <div><Label>Email</Label><Input type="email" value={conventionStageData.tuteurPedagogiqueEmail} onChange={(e) => setConventionStageData({...conventionStageData, tuteurPedagogiqueEmail: e.target.value})} /></div>
                        <div><Label>Téléphone</Label><Input value={conventionStageData.tuteurPedagogiqueTelephone} onChange={(e) => setConventionStageData({...conventionStageData, tuteurPedagogiqueTelephone: e.target.value})} /></div>
                        <div className="md:col-span-2">
                          <Label>Modalités de suivi</Label>
                          <Textarea 
                            value={conventionStageData.tuteurPedagogiqueModalitesSuivi} 
                            onChange={(e) => setConventionStageData({...conventionStageData, tuteurPedagogiqueModalitesSuivi: e.target.value})} 
                            placeholder="Ex: Visite en entreprise, entretiens réguliers, suivi du rapport..." 
                            className="min-h-[60px]" 
                          />
                        </div>
                      </div>
                    </div>
                    
                    <div>
                      <Label>Missions du tuteur professionnel (entreprise)</Label>
                      <Textarea 
                        value={conventionStageData.tuteurProfessionnelMissions} 
                        onChange={(e) => setConventionStageData({...conventionStageData, tuteurProfessionnelMissions: e.target.value})} 
                        placeholder="Accueil du stagiaire, supervision quotidienne, évaluation des compétences, participation au rapport de stage..." 
                        className="min-h-[80px]" 
                      />
                    </div>
                  </div>
                </div>

                {/* 7️⃣ ASSURANCES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">7️⃣ Assurances (OBLIGATOIRES)</h4>
                  
                  <div className="space-y-4">
                    <div className="p-3 bg-white rounded border border-gray-200">
                      <h5 className="font-semibold text-gray-700 mb-2">Stagiaire</h5>
                      <div className="grid md:grid-cols-2 gap-4">
                        <div><Label>Assurance maladie</Label><Input value={conventionStageData.stagiaireAssuranceMaladie} onChange={(e) => setConventionStageData({...conventionStageData, stagiaireAssuranceMaladie: e.target.value})} placeholder="France ou étranger" /></div>
                        <div>
                          <Label>Accident du travail géré par</Label>
                          <Select value={conventionStageData.stagiaireAccidentTravail} onValueChange={(val) => setConventionStageData({...conventionStageData, stagiaireAccidentTravail: val})}>
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="etablissement">Établissement d'enseignement</SelectItem>
                              <SelectItem value="entreprise">Entreprise</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                    </div>
                    
                    <div className="p-3 bg-white rounded border border-blue-200">
                      <h5 className="font-semibold text-gray-700 mb-2">Organisme d'accueil</h5>
                      <div className="grid md:grid-cols-2 gap-4">
                        <div><Label>Assurance RC Pro</Label><Input value={conventionStageData.entrepriseAssuranceRCPro} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseAssuranceRCPro: e.target.value})} placeholder="Nom de l'assurance" /></div>
                        <div><Label>Numéro de police</Label><Input value={conventionStageData.entrepriseAssuranceRCProNumero} onChange={(e) => setConventionStageData({...conventionStageData, entrepriseAssuranceRCProNumero: e.target.value})} /></div>
                        <div className="md:col-span-2">
                          <Label>Couverture des risques liés aux missions</Label>
                          <Textarea 
                            value={conventionStageData.entrepriseAssuranceCouvertureRisques} 
                            onChange={(e) => setConventionStageData({...conventionStageData, entrepriseAssuranceCouvertureRisques: e.target.value})} 
                            placeholder="Détail de la couverture..." 
                            className="min-h-[60px]" 
                          />
                        </div>
                      </div>
                    </div>
                    
                    {conventionStageData.stageType === "etranger" && (
                      <div className="p-3 bg-white rounded border border-blue-200">
                        <h5 className="font-semibold text-gray-700 mb-2">Assurance à l'étranger</h5>
                        <div className="grid md:grid-cols-2 gap-4">
                          <div><Label>Assistance rapatriement</Label><Input value={conventionStageData.stageAssuranceRapatriement} onChange={(e) => setConventionStageData({...conventionStageData, stageAssuranceRapatriement: e.target.value})} /></div>
                          <div><Label>Assurance santé internationale</Label><Input value={conventionStageData.stageAssuranceSanteInternationale} onChange={(e) => setConventionStageData({...conventionStageData, stageAssuranceSanteInternationale: e.target.value})} /></div>
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* 8️⃣ AVANTAGES, RÈGLES & MOYENS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">8️⃣ Avantages, règles internes & moyens mis à disposition</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageAccesLocaux === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageAccesLocaux: v ? "oui" : "non"})} id="acces-locaux" />
                      <Label htmlFor="acces-locaux" className="font-normal">Accès aux locaux</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageAccesOutils === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageAccesOutils: v ? "oui" : "non"})} id="acces-outils" />
                      <Label htmlFor="acces-outils" className="font-normal">Accès aux outils informatiques</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageAccesMateriel === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageAccesMateriel: v ? "oui" : "non"})} id="acces-materiel" />
                      <Label htmlFor="acces-materiel" className="font-normal">Accès au matériel</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageReglementInterieurRemis === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageReglementInterieurRemis: v ? "oui" : "non"})} id="reglement" />
                      <Label htmlFor="reglement" className="font-normal">Règlement intérieur remis</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageCharteInformatique === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageCharteInformatique: v ? "oui" : "non"})} id="charte-info" />
                      <Label htmlFor="charte-info" className="font-normal">Charte informatique</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageCharteCybersecurite === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageCharteCybersecurite: v ? "oui" : "non"})} id="charte-cyber" />
                      <Label htmlFor="charte-cyber" className="font-normal">Charte cybersécurité</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageCharteHarcelement === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageCharteHarcelement: v ? "oui" : "non"})} id="charte-harcel" />
                      <Label htmlFor="charte-harcel" className="font-normal">Charte harcèlement</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={conventionStageData.stageCharteConfidentialite === "oui"} onCheckedChange={(v) => setConventionStageData({...conventionStageData, stageCharteConfidentialite: v ? "oui" : "non"})} id="charte-conf" />
                      <Label htmlFor="charte-conf" className="font-normal">Charte confidentialité</Label>
                    </div>
                  </div>
                  
                  <div>
                    <Label>Équipements de sécurité (si applicable)</Label>
                    <Textarea 
                      value={conventionStageData.stageEquipementsSecurite} 
                      onChange={(e) => setConventionStageData({...conventionStageData, stageEquipementsSecurite: e.target.value})} 
                      placeholder="Ex: Chaussures de sécurité, casque, gilet..." 
                      className="min-h-[60px]" 
                    />
                  </div>
                </div>

                {/* 9️⃣ CONFIDENTIALITÉ & PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">9️⃣ Confidentialité & Propriété intellectuelle</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Obligation de non-divulgation</Label>
                      <Select value={conventionStageData.stageObligationNonDivulgation} onValueChange={(val) => setConventionStageData({...conventionStageData, stageObligationNonDivulgation: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Durée (années après fin stage)</Label>
                      <Input 
                        type="number" 
                        value={conventionStageData.stageConfidentialiteDuree} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageConfidentialiteDuree: e.target.value})} 
                        placeholder="Ex: 5 ans" 
                      />
                    </div>
                    <div>
                      <Label>Restrictions sur documents</Label>
                      <Select value={conventionStageData.stageRestrictionsDocuments} onValueChange={(val) => setConventionStageData({...conventionStageData, stageRestrictionsDocuments: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui (documents confidentiels à ne pas emporter)</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Propriété intellectuelle</Label>
                      <Select value={conventionStageData.stageProprietéIntellectuelle} onValueChange={(val) => setConventionStageData({...conventionStageData, stageProprietéIntellectuelle: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="entreprise">Appartient à l'entreprise</SelectItem>
                          <SelectItem value="stagiaire">Appartient au stagiaire</SelectItem>
                          <SelectItem value="partage">Copropriété</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Exploitation personnelle</Label>
                      <Select value={conventionStageData.stageExploitationPersonnelle} onValueChange={(val) => setConventionStageData({...conventionStageData, stageExploitationPersonnelle: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="interdite">Interdite</SelectItem>
                          <SelectItem value="autorisee">Autorisée</SelectItem>
                          <SelectItem value="sur_demande">Sur demande</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* 🔟-1️⃣5️⃣ AUTRES SECTIONS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟-1️⃣5️⃣ Droits, obligations & modalités</h4>
                  
                  <div className="space-y-3">
                    <div className="p-3 bg-white rounded border border-blue-200">
                      <h5 className="font-semibold text-gray-700 mb-2">Droits du stagiaire</h5>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p>✓ Respect du temps de travail maximal (35h/semaine)</p>
                        <p>✓ Droit à une pause quotidienne</p>
                        <p>✓ Droit à gratification (si ≥ 44 jours)</p>
                        <p>✓ Droit à validation pédagogique</p>
                        <p>✓ Environnement sain et sécurisé</p>
                        <p>✓ Droit de retrait si danger</p>
                      </div>
                    </div>
                    
                    <div className="p-3 bg-white rounded border border-blue-200">
                      <h5 className="font-semibold text-gray-700 mb-2">Obligations du stagiaire</h5>
                      <div className="text-sm text-gray-600 space-y-1">
                        <p>• Respect du règlement intérieur</p>
                        <p>• Respect des horaires</p>
                        <p>• Obligation de discrétion et confidentialité</p>
                        <p>• Respect des consignes sécurité</p>
                        <p>• Compte rendu régulier au tuteur</p>
                        <p>• Participation active aux missions</p>
                      </div>
                    </div>
                    
                    <div>
                      <Label>Absences autorisées (examens, obligations académiques)</Label>
                      <Textarea 
                        value={conventionStageData.stageAbsencesAutorisees} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageAbsencesAutorisees: e.target.value})} 
                        placeholder="Ex: Examens partiels et finaux, soutenance de mémoire..." 
                        className="min-h-[60px]" 
                      />
                    </div>
                    
                    <div>
                      <Label>Conditions de rupture anticipée</Label>
                      <Textarea 
                        value={conventionStageData.stageRuptureProcedure} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageRuptureProcedure: e.target.value})} 
                        placeholder="Entretien tripartite + notification écrite. Motifs: faute grave, inaptitude, problème de santé, non-respect missions, cessation activité..." 
                        className="min-h-[80px]" 
                      />
                    </div>
                    
                    <div>
                      <Label>Modalités d'évaluation</Label>
                      <Textarea 
                        value={conventionStageData.stageEvaluationModalites} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageEvaluationModalites: e.target.value})} 
                        placeholder="Évaluation par le tuteur professionnel, grille de compétences, rapport de stage obligatoire, attestation de stage (OBLIGATOIRE)..." 
                        className="min-h-[80px]" 
                      />
                    </div>
                  </div>
                </div>

                {/* 1️⃣6️⃣ DROIT APPLICABLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">1️⃣6️⃣ Droit applicable & juridiction</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Droit applicable</Label>
                      <Select value={conventionStageData.stageDroitApplicable} onValueChange={(val) => setConventionStageData({...conventionStageData, stageDroitApplicable: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="français">Droit français</SelectItem>
                          <SelectItem value="local">Droit local (si stage à l'étranger)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div>
                      <Label>Tribunal compétent</Label>
                      <Input 
                        value={conventionStageData.stageTribunalCompetent} 
                        onChange={(e) => setConventionStageData({...conventionStageData, stageTribunalCompetent: e.target.value})} 
                        placeholder="Ex: Tribunal administratif de Paris" 
                      />
                    </div>
                    <div>
                      <Label>Médiation préalable</Label>
                      <Select value={conventionStageData.stageMediation} onValueChange={(val) => setConventionStageData({...conventionStageData, stageMediation: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* 1️⃣7️⃣-1️⃣8️⃣ DOCUMENTS & ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">📄 Pièces justificatives & Annexes</h4>
                  
                  <div className="space-y-3">
                    <h5 className="font-semibold text-gray-700">Documents du stagiaire</h5>
                    <SingleFileUpload label="Carte étudiante (OBLIGATOIRE)" files={conventionStageStagiaireCarteEtudianteFiles} onFilesChange={setConventionStageStagiaireCarteEtudianteFiles} role="avocat" />
                    <SingleFileUpload label="Attestation assurance RC (OBLIGATOIRE)" files={conventionStageStagiaireAssuranceRCFiles} onFilesChange={setConventionStageStagiaireAssuranceRCFiles} role="avocat" />
                    <SingleFileUpload label="RIB (pour gratification)" files={conventionStageStagiaireRIBFiles} onFilesChange={setConventionStageStagiaireRIBFiles} role="avocat" />
                  </div>
                  
                  <div className="space-y-3 mt-4">
                    <h5 className="font-semibold text-gray-700">Documents de l'établissement</h5>
                    <SingleFileUpload label="Attestation affiliation sécurité sociale étudiante" files={conventionStageEtablissementAffiliationSecu} onFilesChange={setConventionStageEtablissementAffiliationSecu} role="avocat" />
                    <SingleFileUpload label="Justificatif pédagogique (obligation du stage)" files={conventionStageEtablissementJustificatifPedago} onFilesChange={setConventionStageEtablissementJustificatifPedago} role="avocat" />
                  </div>
                  
                  <div className="space-y-3 mt-4">
                    <h5 className="font-semibold text-gray-700">Documents de l'entreprise</h5>
                    <SingleFileUpload label="Kbis" files={conventionStageEntrepriseKbisFiles} onFilesChange={setConventionStageEntrepriseKbisFiles} role="avocat" />
                    <SingleFileUpload label="Attestation RC Pro" files={conventionStageEntrepriseAssuranceRCProFiles} onFilesChange={setConventionStageEntrepriseAssuranceRCProFiles} role="avocat" />
                  </div>
                  
                  <div className="space-y-3 mt-4">
                    <h5 className="font-semibold text-gray-700">Annexes</h5>
                    <SingleFileUpload label="Fiche missions détaillées" files={conventionStageFicheMissionsFiles} onFilesChange={setConventionStageFicheMissionsFiles} role="avocat" />
                    <SingleFileUpload label="Charte informatique" files={conventionStageCharteInformatiqueFiles} onFilesChange={setConventionStageCharteInformatiqueFiles} role="avocat" />
                    <SingleFileUpload label="Règlement intérieur" files={conventionStageReglementInterieurFiles} onFilesChange={setConventionStageReglementInterieurFiles} role="avocat" />
                    <SingleFileUpload label="Planning hebdomadaire" files={conventionStagePlanningFiles} onFilesChange={setConventionStagePlanningFiles} role="avocat" />
                    <SingleFileUpload label="Grille d'évaluation" files={conventionStageGrilleEvaluationFiles} onFilesChange={setConventionStageGrilleEvaluationFiles} role="avocat" />
                    <SingleFileUpload label="Engagement de confidentialité (séparé)" files={conventionStageEngagementConfidentialiteFiles} onFilesChange={setConventionStageEngagementConfidentialiteFiles} role="avocat" />
                    <MultiFileUpload label="Autres annexes" files={conventionStageAnnexesFiles} onFilesChange={setConventionStageAnnexesFiles} role="avocat" />
                  </div>
                </div>
              </div>
            )}

            {/* Formulaire Rupture conventionnelle */}
            {pendingContractType === "Rupture conventionnelle" && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🤝 Rupture conventionnelle</h3>
                
                {/* 1️⃣ IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">1️⃣ Identification des parties</h4>
                  
                  {/* A. EMPLOYEUR */}
                  <div className="space-y-4">
                    <h5 className="font-semibold text-gray-700">🏢 Employeur</h5>
                    <ClientSelector 
                      clients={clients} 
                      selectedClientId={ruptureConventionnelleClientIdEmployeur} 
                      onClientChange={(clientId) => {
                        setRuptureConventionnelleClientIdEmployeur(clientId);
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setRuptureConventionnelleData({
                            ...ruptureConventionnelleData,
                            employeurDenomination: `${client.prenom} ${client.nom}`,
                            employeurAdresseSiege: client.adresse || "",
                          });
                        } else {
                          setRuptureConventionnelleData({
                            ...ruptureConventionnelleData,
                            employeurDenomination: "",
                            employeurAdresseSiege: "",
                          });
                        }
                      }} 
                      placeholder="Sélectionner l'employeur (entreprise)" 
                      label="Client employeur (optionnel)"
                    />
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Dénomination sociale *</Label><Input value={ruptureConventionnelleData.employeurDenomination} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={ruptureConventionnelleData.employeurFormeJuridique} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurFormeJuridique: e.target.value})} placeholder="Ex: SAS, SARL, SA" /></div>
                      <div><Label>Adresse du siège</Label><Input value={ruptureConventionnelleData.employeurAdresseSiege} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurAdresseSiege: e.target.value})} /></div>
                      <div><Label>Adresse du lieu de travail</Label><Input value={ruptureConventionnelleData.employeurAdresseTravail} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurAdresseTravail: e.target.value})} /></div>
                      <div><Label>SIRET</Label><Input value={ruptureConventionnelleData.employeurSiret} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurSiret: e.target.value})} placeholder="14 chiffres" /></div>
                      <div><Label>Code APE</Label><Input value={ruptureConventionnelleData.employeurCodeAPE} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurCodeAPE: e.target.value})} placeholder="Ex: 6201Z" /></div>
                      <div><Label>Représentant légal (nom)</Label><Input value={ruptureConventionnelleData.employeurRepresentantNom} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurRepresentantNom: e.target.value})} /></div>
                      <div><Label>Fonction du représentant</Label><Input value={ruptureConventionnelleData.employeurRepresentantFonction} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurRepresentantFonction: e.target.value})} placeholder="Ex: Directeur général" /></div>
                      <div><Label>Convention collective applicable</Label><Input value={ruptureConventionnelleData.employeurConventionCollective} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurConventionCollective: e.target.value})} /></div>
                      <div><Label>Effectif de l'entreprise</Label><Input value={ruptureConventionnelleData.employeurEffectif} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, employeurEffectif: e.target.value})} placeholder="Nombre de salariés" /></div>
                    </div>
                  </div>
                  
                  {/* B. SALARIÉ */}
                  <div className="space-y-4 mt-6">
                    <h5 className="font-semibold text-gray-700">👤 Salarié</h5>
                    <ClientSelector 
                      clients={clients} 
                      selectedClientId={ruptureConventionnelleClientIdSalarie} 
                      onClientChange={(clientId) => {
                        setRuptureConventionnelleClientIdSalarie(clientId);
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setRuptureConventionnelleData({
                            ...ruptureConventionnelleData,
                            salariNom: client.nom,
                            salariPrenom: client.prenom,
                            salariAdresse: client.adresse || "",
                            salariDateNaissance: client.date_naissance || "",
                          });
                        } else {
                          setRuptureConventionnelleData({
                            ...ruptureConventionnelleData,
                            salariNom: "",
                            salariPrenom: "",
                            salariAdresse: "",
                            salariDateNaissance: "",
                          });
                        }
                      }} 
                      placeholder="Sélectionner le salarié" 
                      label="Client salarié (optionnel)"
                    />
                    <div className="grid md:grid-cols-2 gap-4">
                      <div><Label>Nom *</Label><Input value={ruptureConventionnelleData.salariNom} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariNom: e.target.value})} /></div>
                      <div><Label>Prénom *</Label><Input value={ruptureConventionnelleData.salariPrenom} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariPrenom: e.target.value})} /></div>
                      <div className="md:col-span-2"><Label>Adresse personnelle</Label><Input value={ruptureConventionnelleData.salariAdresse} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariAdresse: e.target.value})} /></div>
                      <div><Label>Date de naissance</Label><Input type="date" value={ruptureConventionnelleData.salariDateNaissance} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariDateNaissance: e.target.value})} /></div>
                      <div><Label>Numéro de sécurité sociale</Label><Input value={ruptureConventionnelleData.salariNumSecu} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariNumSecu: e.target.value})} placeholder="15 chiffres" /></div>
                      <div><Label>Poste occupé</Label><Input value={ruptureConventionnelleData.salariPoste} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariPoste: e.target.value})} /></div>
                      <div><Label>Catégorie / classification</Label><Input value={ruptureConventionnelleData.salariCategorie} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariCategorie: e.target.value})} placeholder="Ex: Cadre, Employé, Agent de maîtrise" /></div>
                      <div><Label>Date d'entrée dans l'entreprise</Label><Input type="date" value={ruptureConventionnelleData.salariDateEntree} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariDateEntree: e.target.value})} /></div>
                      <div>
                        <Label>Type de contrat *</Label>
                        <Select value={ruptureConventionnelleData.salariTypeContrat} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariTypeContrat: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CDI">CDI (uniquement)</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-gray-600 mt-1">⚠️ Rupture conventionnelle réservée aux CDI</p>
                      </div>
                      <div>
                        <Label>Temps plein / temps partiel</Label>
                        <Select value={ruptureConventionnelleData.salariTempsPartiel} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, salariTempsPartiel: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Temps plein</SelectItem>
                            <SelectItem value="oui">Temps partiel</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 2️⃣ VÉRIFICATIONS LÉGALES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">2️⃣ Vérifications légales obligatoires</h4>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <p className="text-sm font-semibold text-gray-700 mb-3">⚠️ Situations rendant la rupture impossible ou risquée</p>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox 
                          checked={ruptureConventionnelleData.verificationAccidentTravail === 'oui'} 
                          onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, verificationAccidentTravail: v ? 'oui' : 'non'})} 
                          id="accident-travail" 
                        />
                        <Label htmlFor="accident-travail" className="font-normal">Accident du travail en cours</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox 
                          checked={ruptureConventionnelleData.verificationArretMaladie === 'oui'} 
                          onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, verificationArretMaladie: v ? 'oui' : 'non'})} 
                          id="arret-maladie" 
                        />
                        <Label htmlFor="arret-maladie" className="font-normal">Arrêt maladie lié à une faute de l'employeur</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox 
                          checked={ruptureConventionnelleData.verificationConflitGrave === 'oui'} 
                          onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, verificationConflitGrave: v ? 'oui' : 'non'})} 
                          id="conflit-grave" 
                        />
                        <Label htmlFor="conflit-grave" className="font-normal">Conflit grave empêchant un consentement libre</Label>
                      </div>
                    </div>
                    {(ruptureConventionnelleData.verificationAccidentTravail === 'oui' || 
                      ruptureConventionnelleData.verificationArretMaladie === 'oui' || 
                      ruptureConventionnelleData.verificationConflitGrave === 'oui') && (
                      <div className="mt-3 p-2 bg-red-50 rounded border border-red-200">
                        <p className="text-sm text-red-700">⚠️ RISQUE D'ANNULATION : Ces situations peuvent entraîner la nullité de la rupture conventionnelle. Conseil juridique fortement recommandé.</p>
                      </div>
                    )}
                  </div>
                </div>

                {/* 3️⃣ DATE DE L'ENTRETIEN */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">3️⃣ Date de l'entretien obligatoire</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div><Label>Date de l'entretien *</Label><Input type="date" value={ruptureConventionnelleData.entretienDate} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienDate: e.target.value})} /></div>
                    <div><Label>Lieu de l'entretien</Label><Input value={ruptureConventionnelleData.entretienLieu} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienLieu: e.target.value})} placeholder="Ex: Siège de l'entreprise" /></div>
                    <div className="md:col-span-2"><Label>Personnes présentes</Label><Textarea value={ruptureConventionnelleData.entretienPersonnesPresentes} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienPersonnesPresentes: e.target.value})} placeholder="Liste des participants" className="min-h-[60px]" /></div>
                  </div>
                  
                  <div className="grid md:grid-cols-2 gap-4 mt-4">
                    <div>
                      <Label>Assistance du salarié</Label>
                      <Select value={ruptureConventionnelleData.entretienAssistanceSalarie} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienAssistanceSalarie: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                      {ruptureConventionnelleData.entretienAssistanceSalarie === 'oui' && (
                        <Input className="mt-2" placeholder="Nom de la personne assistante" value={ruptureConventionnelleData.entretienAssistanceSalarieNom} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienAssistanceSalarieNom: e.target.value})} />
                      )}
                    </div>
                    <div>
                      <Label>Assistance de l'employeur</Label>
                      <Select value={ruptureConventionnelleData.entretienAssistanceEmployeur} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienAssistanceEmployeur: val})}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                      {ruptureConventionnelleData.entretienAssistanceEmployeur === 'oui' && (
                        <Input className="mt-2" placeholder="Nom de la personne assistante" value={ruptureConventionnelleData.entretienAssistanceEmployeurNom} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, entretienAssistanceEmployeurNom: e.target.value})} />
                      )}
                    </div>
                  </div>
                </div>

                {/* 4️⃣ TYPE DE RUPTURE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">4️⃣ Type de rupture conventionnelle</h4>
                  
                  <div>
                    <Label>Type de rupture</Label>
                    <Select value={ruptureConventionnelleData.typeRupture} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, typeRupture: val})}>
                      <SelectTrigger><SelectValue /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="simple">Rupture conventionnelle simple</SelectItem>
                        <SelectItem value="collective">Rupture conventionnelle collective (rare)</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                </div>

                {/* 5️⃣ INDEMNITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">5️⃣ Indemnité spécifique de rupture conventionnelle</h4>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">A. Calcul de l'indemnité légale minimale</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <Label>Salaire de référence (3 derniers mois)</Label>
                        <Input type="number" value={ruptureConventionnelleData.indemniteSalaireRef3Mois} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteSalaireRef3Mois: e.target.value})} placeholder="Moyenne mensuelle brute" />
                      </div>
                      <div>
                        <Label>Salaire de référence (12 derniers mois)</Label>
                        <Input type="number" value={ruptureConventionnelleData.indemniteSalaireRef12Mois} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteSalaireRef12Mois: e.target.value})} placeholder="Moyenne mensuelle brute" />
                      </div>
                      <div>
                        <Label>Ancienneté (années complètes)</Label>
                        <Input type="number" value={ruptureConventionnelleData.indemniteAnciennete} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteAnciennete: e.target.value})} placeholder="Ex: 5.5" />
                      </div>
                      <div>
                        <Label>Indemnité légale calculée</Label>
                        <Input type="number" value={ruptureConventionnelleData.indemniteLegaleCalculee} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteLegaleCalculee: e.target.value})} placeholder="Montant minimum" />
                        <p className="text-xs text-gray-600 mt-1">1/4 de mois × ancienneté ≤ 10 ans + 1/3 après</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">B. Indemnité supra-légale (négociée)</h5>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div>
                        <Label>Indemnité supra-légale ?</Label>
                        <Select value={ruptureConventionnelleData.indemniteSupraLegale} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteSupraLegale: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non (montant légal uniquement)</SelectItem>
                            <SelectItem value="oui">Oui (montant supérieur négocié)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {ruptureConventionnelleData.indemniteSupraLegale === 'oui' && (
                        <>
                          <div>
                            <Label>Montant proposé (total)</Label>
                            <Input type="number" value={ruptureConventionnelleData.indemniteMontantPropose} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteMontantPropose: e.target.value})} placeholder="Montant en €" />
                          </div>
                          <div>
                            <Label>Soumise aux cotisations sociales ?</Label>
                            <Select value={ruptureConventionnelleData.indemniteCotisationsSociales} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteCotisationsSociales: val})}>
                              <SelectTrigger><SelectValue /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="non">Non</SelectItem>
                                <SelectItem value="oui">Oui</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="md:col-span-2">
                            <Label>Modalités de paiement</Label>
                            <Textarea value={ruptureConventionnelleData.indemniteModalitesPaiement} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, indemniteModalitesPaiement: e.target.value})} placeholder="Ex: Paiement unique à la rupture, versement échelonné..." className="min-h-[60px]" />
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                </div>

                {/* 6️⃣ DATES DE RUPTURE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">6️⃣ Date de rupture du contrat</h4>
                  
                  <div className="grid md:grid-cols-2 gap-4">
                    <div>
                      <Label>Date de signature de la convention *</Label>
                      <Input type="date" value={ruptureConventionnelleData.dateSignature} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, dateSignature: e.target.value})} />
                      <p className="text-xs text-gray-600 mt-1">Point de départ du délai de rétractation (15 jours)</p>
                    </div>
                    <div>
                      <Label>Date de rupture effective *</Label>
                      <Input type="date" value={ruptureConventionnelleData.dateRuptureEffective} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, dateRuptureEffective: e.target.value})} />
                      <p className="text-xs text-gray-600 mt-1">Après homologation DREETS</p>
                    </div>
                  </div>
                </div>

                {/* 7️⃣ CALENDRIER LÉGAL */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">7️⃣ Calendrier légal obligatoire</h4>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <div className="space-y-3">
                      <div>
                        <h5 className="font-semibold text-gray-700 text-sm">📅 Délai de rétractation</h5>
                        <p className="text-sm text-gray-600">15 jours calendaires à partir de la signature</p>
                        <p className="text-xs text-gray-600 mt-1">Rétractation possible par lettre remise ou envoyée à l'autre partie</p>
                      </div>
                      <div>
                        <h5 className="font-semibold text-gray-700 text-sm">📅 Délai d'homologation DREETS</h5>
                        <p className="text-sm text-gray-600">15 jours ouvrés après envoi du dossier CERFA</p>
                        <p className="text-xs text-gray-600 mt-1">Absence de réponse = homologation tacite</p>
                      </div>
                      <div>
                        <h5 className="font-semibold text-gray-700 text-sm">📅 Date de fin du contrat</h5>
                        <p className="text-sm text-gray-600">Toujours postérieure à l'homologation</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="grid md:grid-cols-3 gap-4 mt-4">
                    <div>
                      <Label>Date fin rétractation (calculée)</Label>
                      <Input type="date" value={ruptureConventionnelleData.dateFinRetractation} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, dateFinRetractation: e.target.value})} />
                    </div>
                    <div>
                      <Label>Date envoi DREETS</Label>
                      <Input type="date" value={ruptureConventionnelleData.dateEnvoiDREETS} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, dateEnvoiDREETS: e.target.value})} />
                    </div>
                    <div>
                      <Label>Date fin homologation (calculée)</Label>
                      <Input type="date" value={ruptureConventionnelleData.dateFinHomologation} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, dateFinHomologation: e.target.value})} />
                    </div>
                  </div>
                </div>

                {/* 8️⃣ à 1️⃣5️⃣ DROITS, CONFIDENTIALITÉ & CLAUSES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">8️⃣-1️⃣5️⃣ Droits du salarié, confidentialité & clauses optionnelles</h4>
                  
                  {/* 8️⃣ DROITS DU SALARIÉ */}
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">8️⃣ Droits du salarié après la rupture</h5>
                    <div className="grid md:grid-cols-2 gap-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.droitChomage === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, droitChomage: v ? 'oui' : 'non'})} id="droit-chomage" />
                        <Label htmlFor="droit-chomage" className="font-normal">Ouverture aux allocations chômage (ARE)</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.droitSoldeToutCompte === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, droitSoldeToutCompte: v ? 'oui' : 'non'})} id="solde-compte" />
                        <Label htmlFor="solde-compte" className="font-normal">Paiement solde de tout compte</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.droitCongesPayes === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, droitCongesPayes: v ? 'oui' : 'non'})} id="conges-payes" />
                        <Label htmlFor="conges-payes" className="font-normal">Paiement prorata congés payés</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.droitCertificatTravail === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, droitCertificatTravail: v ? 'oui' : 'non'})} id="certificat-travail" />
                        <Label htmlFor="certificat-travail" className="font-normal">Certificat de travail</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.droitAttestationPoleEmploi === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, droitAttestationPoleEmploi: v ? 'oui' : 'non'})} id="attestation-pole" />
                        <Label htmlFor="attestation-pole" className="font-normal">Attestation Pôle emploi</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.droitRecuSolde === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, droitRecuSolde: v ? 'oui' : 'non'})} id="recu-solde" />
                        <Label htmlFor="recu-solde" className="font-normal">Reçu pour solde de tout compte</Label>
                      </div>
                    </div>
                  </div>
                  
                  {/* 9️⃣ CONFIDENTIALITÉ */}
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">9️⃣ Confidentialité</h5>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.confidentialiteMotifs === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, confidentialiteMotifs: v ? 'oui' : 'non'})} id="conf-motifs" />
                        <Label htmlFor="conf-motifs" className="font-normal">Interdiction de divulguer les motifs des négociations</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.confidentialiteFinanciere === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, confidentialiteFinanciere: v ? 'oui' : 'non'})} id="conf-financiere" />
                        <Label htmlFor="conf-financiere" className="font-normal">Secret sur les conditions financières</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.confidentialiteReciprocité === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, confidentialiteReciprocité: v ? 'oui' : 'non'})} id="conf-reciprocite" />
                        <Label htmlFor="conf-reciprocite" className="font-normal">Confidentialité réciproque</Label>
                      </div>
                    </div>
                  </div>
                  
                  {/* 🔟 CLAUSES OPTIONNELLES */}
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">🔟 Clauses optionnelles</h5>
                    
                    <div className="space-y-4">
                      <div>
                        <Label>Clause de non-concurrence existante ?</Label>
                        <Select value={ruptureConventionnelleData.clauseNonConcurrence} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, clauseNonConcurrence: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="maintenue">Oui - Maintenue</SelectItem>
                            <SelectItem value="levee">Oui - Levée</SelectItem>
                          </SelectContent>
                        </Select>
                        {ruptureConventionnelleData.clauseNonConcurrence === 'maintenue' && (
                          <Input className="mt-2" placeholder="Indemnité de non-concurrence (montant)" value={ruptureConventionnelleData.clauseNonConcurrenceIndemnite} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, clauseNonConcurrenceIndemnite: e.target.value})} />
                        )}
                      </div>
                      
                      <div>
                        <Label>Clause de confidentialité renforcée ?</Label>
                        <Select value={ruptureConventionnelleData.clauseConfidentialiteRenforcee} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, clauseConfidentialiteRenforcee: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                        {ruptureConventionnelleData.clauseConfidentialiteRenforcee === 'oui' && (
                          <Input className="mt-2" placeholder="Durée (ex: 2 ans)" value={ruptureConventionnelleData.clauseConfidentialiteDuree} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, clauseConfidentialiteDuree: e.target.value})} />
                        )}
                      </div>
                      
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.clauseNonDenigrement === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, clauseNonDenigrement: v ? 'oui' : 'non'})} id="non-denigrement" />
                        <Label htmlFor="non-denigrement" className="font-normal">Clause de non-dénigrement (empêche communication négative)</Label>
                      </div>
                    </div>
                  </div>
                  
                  {/* 1️⃣1️⃣ CAS PARTICULIERS */}
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">1️⃣1️⃣ Cas particuliers à gérer</h5>
                    
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.casParticulierEnceinte === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, casParticulierEnceinte: v ? 'oui' : 'non'})} id="enceinte" />
                        <Label htmlFor="enceinte" className="font-normal">Salariée enceinte (rupture possible mais encadrée)</Label>
                      </div>
                      
                      <div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={ruptureConventionnelleData.casParticulierProtege === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, casParticulierProtege: v ? 'oui' : 'non'})} id="protege" />
                          <Label htmlFor="protege" className="font-normal">Salarié protégé (CSE, DS, élu, RP...)</Label>
                        </div>
                        {ruptureConventionnelleData.casParticulierProtege === 'oui' && (
                          <>
                            <Input className="mt-2" placeholder="Type de protection (ex: Délégué syndical)" value={ruptureConventionnelleData.casParticulierProtegeType} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, casParticulierProtegeType: e.target.value})} />
                            <div className="mt-2 p-2 bg-red-50 rounded border border-red-200">
                              <p className="text-sm text-red-700">⚠️ AUTORISATION INSPECTION DU TRAVAIL NÉCESSAIRE</p>
                            </div>
                          </>
                        )}
                      </div>
                      
                      <div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={ruptureConventionnelleData.casParticulierInaptitude === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, casParticulierInaptitude: v ? 'oui' : 'non'})} id="inaptitude" />
                          <Label htmlFor="inaptitude" className="font-normal">Inaptitude (à éviter)</Label>
                        </div>
                        {ruptureConventionnelleData.casParticulierInaptitude === 'oui' && (
                          <div className="mt-2 p-2 bg-red-50 rounded border border-red-200">
                            <p className="text-sm text-red-700">⚠️ Rupture conventionnelle déconseillée en cas d'inaptitude</p>
                          </div>
                        )}
                      </div>
                      
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.casParticulierEtranger === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, casParticulierEtranger: v ? 'oui' : 'non'})} id="etranger" />
                        <Label htmlFor="etranger" className="font-normal">Rupture à l'étranger (règles locales à intégrer)</Label>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 1️⃣2️⃣ FORMALISATION & 1️⃣3️⃣ DREETS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">1️⃣2️⃣-1️⃣3️⃣ Formalisation & envoi à la DREETS</h4>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">1️⃣2️⃣ Formalisation de la convention</h5>
                    <div className="space-y-3">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.consentementLibre === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, consentementLibre: v ? 'oui' : 'non'})} id="consentement-libre" />
                        <Label htmlFor="consentement-libre" className="font-normal">Liberté du consentement vérifiée</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={ruptureConventionnelleData.absencePression === 'oui'} onCheckedChange={(v) => setRuptureConventionnelleData({...ruptureConventionnelleData, absencePression: v ? 'oui' : 'non'})} id="absence-pression" />
                        <Label htmlFor="absence-pression" className="font-normal">Absence de pression / vice de consentement</Label>
                      </div>
                      <div>
                        <Label>Modalités de rétractation</Label>
                        <Textarea value={ruptureConventionnelleData.modalitesRetractation} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, modalitesRetractation: e.target.value})} placeholder="Préciser comment exercer le droit de rétractation..." className="min-h-[60px]" />
                      </div>
                      <div>
                        <Label>Signature électronique (YouSign) ?</Label>
                        <Select value={ruptureConventionnelleData.signatureElectronique} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, signatureElectronique: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non (signature manuscrite)</SelectItem>
                            <SelectItem value="oui">Oui (signature électronique)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>
                  </div>
                  
                  <div className="p-3 bg-white rounded border border-gray-200">
                    <h5 className="font-semibold text-gray-700 mb-2">1️⃣3️⃣ Envoi à la DREETS (homologation)</h5>
                    <div className="space-y-3">
                      <div>
                        <Label>Coordonnées DREETS compétente</Label>
                        <Textarea value={ruptureConventionnelleData.dreetsCoordonnees} onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, dreetsCoordonnees: e.target.value})} placeholder="Adresse, email, téléphone..." className="min-h-[60px]" />
                      </div>
                      <div>
                        <Label>Transmission électronique (TéléRC) ?</Label>
                        <Select value={ruptureConventionnelleData.dreetsTransmissionElectronique} onValueChange={(val) => setRuptureConventionnelleData({...ruptureConventionnelleData, dreetsTransmissionElectronique: val})}>
                          <SelectTrigger><SelectValue /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (TéléRC - recommandé)</SelectItem>
                            <SelectItem value="non">Non (courrier postal)</SelectItem>
                          </SelectContent>
                        </Select>
                        <p className="text-xs text-gray-600 mt-1">Formulaire CERFA N°14598*01 à préparer</p>
                      </div>
                    </div>
                  </div>
                </div>

                {/* 1️⃣4️⃣-1️⃣5️⃣ DOCUMENTS & PIÈCES JUSTIFICATIVES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">📄 Pièces justificatives & annexes</h4>
                  
                  <div className="space-y-3">
                    <h5 className="font-semibold text-gray-700">Documents de l'employeur</h5>
                    <SingleFileUpload label="Kbis (moins de 3 mois)" files={ruptureConvEmployeurKbisFiles} onFilesChange={setRuptureConvEmployeurKbisFiles} role="avocat" />
                    <SingleFileUpload label="Justificatif du représentant légal" files={ruptureConvEmployeurJustifRepresentantFiles} onFilesChange={setRuptureConvEmployeurJustifRepresentantFiles} role="avocat" />
                  </div>
                  
                  <div className="space-y-3 mt-4">
                    <h5 className="font-semibold text-gray-700">Documents du salarié</h5>
                    <SingleFileUpload label="Pièce d'identité" files={ruptureConvSalariePieceIdentiteFiles} onFilesChange={setRuptureConvSalariePieceIdentiteFiles} role="avocat" />
                    <SingleFileUpload label="RIB" files={ruptureConvSalarieRIBFiles} onFilesChange={setRuptureConvSalarieRIBFiles} role="avocat" />
                  </div>
                  
                  <div className="space-y-3 mt-4">
                    <h5 className="font-semibold text-gray-700">Annexes et documents complémentaires</h5>
                    <SingleFileUpload label="Fiche de poste" files={ruptureConvFichePosteFiles} onFilesChange={setRuptureConvFichePosteFiles} role="avocat" />
                    <SingleFileUpload label="Contrat de travail initial" files={ruptureConvContratTravailFiles} onFilesChange={setRuptureConvContratTravailFiles} role="avocat" />
                    <MultiFileUpload label="Derniers bulletins de salaire (3 ou 12 derniers)" files={ruptureConvBulletinsSalaireFiles} onFilesChange={setRuptureConvBulletinsSalaireFiles} role="avocat" />
                    <SingleFileUpload label="Calcul détaillé de l'indemnité" files={ruptureConvCalculIndemniteFiles} onFilesChange={setRuptureConvCalculIndemniteFiles} role="avocat" />
                    <MultiFileUpload label="Autres annexes" files={ruptureConvAnnexesFiles} onFilesChange={setRuptureConvAnnexesFiles} role="avocat" />
                  </div>
                  
                  <div className="mt-4">
                    <Label>Notes sur les documents annexes</Label>
                    <Textarea 
                      value={ruptureConventionnelleData.documentsNotes} 
                      onChange={(e) => setRuptureConventionnelleData({...ruptureConventionnelleData, documentsNotes: e.target.value})} 
                      placeholder="Historique d'ancienneté, notes complémentaires..." 
                      className="min-h-[80px]" 
                    />
                  </div>
                </div>
              </div>
            )}

            {/* Formulaire complet pour CGU (Conditions Générales d'Utilisation) */}
            {(() => {
              console.log('🔍 DEBUG CGU - pendingContractType:', JSON.stringify(pendingContractType));
              console.log('🔍 DEBUG CGU - includes CGU:', pendingContractType.includes("CGU"));
              console.log('🔍 DEBUG CGU - includes SaaS:', pendingContractType.includes("SaaS"));
              console.log('🔍 DEBUG CGU - includes saas (lowercase):', pendingContractType.toLowerCase().includes("saas"));
              console.log('🔍 DEBUG CGU - Match result:', pendingContractType.includes("CGU") && pendingContractType.includes("SaaS"));
              console.log('🔍 DEBUG CGU - Char codes:', Array.from(pendingContractType).map(c => c.charCodeAt(0)).join(','));
              return null;
            })()}
            {(pendingContractType.includes("CGU") && pendingContractType.toLowerCase().includes("saas")) && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">📱 Conditions Générales d'Utilisation (CGU) — SaaS / Site Web</h3>
                
                {/* 1. IDENTIFICATION DE L'ÉDITEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification de l'éditeur du site / application</h4>
                  <div className="p-3 bg-orange-50 rounded border border-orange-200">
                    <p className="text-xs text-orange-700">⚠️ Obligatoire par la LCEN (Loi pour la Confiance dans l'Économie Numérique)</p>
                  </div>
                  <div className="space-y-3">
                    <ClientSelector 
                      clients={clients} 
                      selectedClientId={cguVendeurClientId} 
                      onClientChange={(clientId) => {
                        setCguVendeurClientId(clientId);
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setCguData({
                            ...cguData,
                            editeurNom: `${client.prenom} ${client.nom}`,
                            editeurDenomination: `${client.prenom} ${client.nom}`,
                            editeurSiegeSocial: client.adresse || "",
                            editeurEmail: client.email || "",
                            editeurTelephone: client.telephone || ""
                          });
                        } else {
                          setCguData({
                            ...cguData,
                            editeurNom: "",
                            editeurDenomination: "",
                            editeurSiegeSocial: "",
                            editeurEmail: "",
                            editeurTelephone: ""
                          });
                        }
                      }} 
                      label="Sélectionner un client comme éditeur" 
                    />
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Nom de l'éditeur *</Label><Input value={cguData.editeurNom} onChange={(e) => setCguData({...cguData, editeurNom: e.target.value})} /></div>
                      <div><Label>Dénomination sociale *</Label><Input value={cguData.editeurDenomination} onChange={(e) => setCguData({...cguData, editeurDenomination: e.target.value})} /></div>
                      <div><Label>Forme juridique</Label><Input value={cguData.editeurFormeJuridique} onChange={(e) => setCguData({...cguData, editeurFormeJuridique: e.target.value})} placeholder="SARL, SAS, SASU, EI..." /></div>
                      <div><Label>Capital social</Label><Input value={cguData.editeurCapitalSocial} onChange={(e) => setCguData({...cguData, editeurCapitalSocial: e.target.value})} placeholder="Ex: 10 000€" /></div>
                      <div><Label>SIREN *</Label><Input value={cguData.editeurSIREN} onChange={(e) => setCguData({...cguData, editeurSIREN: e.target.value})} placeholder="123 456 789" /></div>
                      <div><Label>RCS</Label><Input value={cguData.editeurRCS} onChange={(e) => setCguData({...cguData, editeurRCS: e.target.value})} placeholder="RCS Ville" /></div>
                      <div><Label>TVA intracommunautaire</Label><Input value={cguData.editeurTVA} onChange={(e) => setCguData({...cguData, editeurTVA: e.target.value})} placeholder="FR12345678901" /></div>
                      <div><Label>Directeur de la publication *</Label><Input value={cguData.editeurDirecteurPublication} onChange={(e) => setCguData({...cguData, editeurDirecteurPublication: e.target.value})} /></div>
                    </div>
                    <div><Label>Siège social *</Label><Input value={cguData.editeurSiegeSocial} onChange={(e) => setCguData({...cguData, editeurSiegeSocial: e.target.value})} /></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Email de contact *</Label><Input type="email" value={cguData.editeurEmail} onChange={(e) => setCguData({...cguData, editeurEmail: e.target.value})} /></div>
                      <div><Label>Téléphone</Label><Input value={cguData.editeurTelephone} onChange={(e) => setCguData({...cguData, editeurTelephone: e.target.value})} /></div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div><Label>Nom de l'hébergeur *</Label><Input value={cguData.hebergeurNom} onChange={(e) => setCguData({...cguData, hebergeurNom: e.target.value})} placeholder="Ex: OVH, AWS, Vercel..." /></div>
                      <div><Label>Coordonnées hébergeur *</Label><Textarea value={cguData.hebergeurCoordonnees} onChange={(e) => setCguData({...cguData, hebergeurCoordonnees: e.target.value})} placeholder="Adresse complète de l'hébergeur..." className="min-h-[60px]" /></div>
                    </div>
                    <div>
                      <Label>Secteur réglementé ?</Label>
                      <RadioGroup value={cguData.secteurReglemente} onValueChange={(v) => setCguData({...cguData, secteurReglemente: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="sect-oui" /><Label htmlFor="sect-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="sect-non" /><Label htmlFor="sect-non">Non</Label></div>
                      </RadioGroup>
                      {cguData.secteurReglemente === "oui" && (
                        <Input value={cguData.secteurReglementeAutorite} onChange={(e) => setCguData({...cguData, secteurReglementeAutorite: e.target.value})} placeholder="Nom de l'autorité de régulation..." className="mt-2" />
                      )}
                    </div>
                  </div>
                </div>
                
                {/* 2. OBJET DES CGU */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet des CGU</h4>
                  <div className="space-y-3">
                    <div><Label>Service fourni *</Label><Textarea value={cguData.serviceFourni} onChange={(e) => setCguData({...cguData, serviceFourni: e.target.value})} placeholder="Description détaillée du service..." className="min-h-[100px]" /></div>
                    <div>
                      <Label>Type de plateforme *</Label>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={cguData.typePlateforme.includes("SaaS")} onCheckedChange={(v) => setCguData({...cguData, typePlateforme: v ? [...cguData.typePlateforme, "SaaS"] : cguData.typePlateforme.filter(t => t !== "SaaS")})} id="type-saas" />
                          <Label htmlFor="type-saas" className="font-normal">SaaS</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={cguData.typePlateforme.includes("Application mobile")} onCheckedChange={(v) => setCguData({...cguData, typePlateforme: v ? [...cguData.typePlateforme, "Application mobile"] : cguData.typePlateforme.filter(t => t !== "Application mobile")})} id="type-app" />
                          <Label htmlFor="type-app" className="font-normal">Application mobile</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={cguData.typePlateforme.includes("Marketplace")} onCheckedChange={(v) => setCguData({...cguData, typePlateforme: v ? [...cguData.typePlateforme, "Marketplace"] : cguData.typePlateforme.filter(t => t !== "Marketplace")})} id="type-market" />
                          <Label htmlFor="type-market" className="font-normal">Marketplace</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={cguData.typePlateforme.includes("Réseau social")} onCheckedChange={(v) => setCguData({...cguData, typePlateforme: v ? [...cguData.typePlateforme, "Réseau social"] : cguData.typePlateforme.filter(t => t !== "Réseau social")})} id="type-social" />
                          <Label htmlFor="type-social" className="font-normal">Réseau social</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={cguData.typePlateforme.includes("Service d'information")} onCheckedChange={(v) => setCguData({...cguData, typePlateforme: v ? [...cguData.typePlateforme, "Service d'information"] : cguData.typePlateforme.filter(t => t !== "Service d'information")})} id="type-info" />
                          <Label htmlFor="type-info" className="font-normal">Service d'information</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={cguData.typePlateforme.includes("Plateforme d'échange")} onCheckedChange={(v) => setCguData({...cguData, typePlateforme: v ? [...cguData.typePlateforme, "Plateforme d'échange"] : cguData.typePlateforme.filter(t => t !== "Plateforme d'échange")})} id="type-echange" />
                          <Label htmlFor="type-echange" className="font-normal">Plateforme d'échange ou de mise en relation</Label>
                        </div>
                      </div>
                    </div>
                    <div><Label>Limites du service</Label><Textarea value={cguData.limitesService} onChange={(e) => setCguData({...cguData, limitesService: e.target.value})} placeholder="Ce que le service ne fait pas..." className="min-h-[80px]" /></div>
                    <div><Label>Exclusions explicites</Label><Textarea value={cguData.exclusionsExplicites} onChange={(e) => setCguData({...cguData, exclusionsExplicites: e.target.value})} placeholder="Ce que le service exclut explicitement..." className="min-h-[80px]" /></div>
                  </div>
                </div>
                
                {/* 3. DÉFINITIONS INDISPENSABLES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Définitions indispensables</h4>
                  <div className="space-y-3">
                    <div><Label>Utilisateur</Label><Textarea value={cguData.defUtilisateur} onChange={(e) => setCguData({...cguData, defUtilisateur: e.target.value})} placeholder="Ex: Toute personne qui accède au service..." className="min-h-[60px]" /></div>
                    <div><Label>Compte utilisateur</Label><Textarea value={cguData.defCompteUtilisateur} onChange={(e) => setCguData({...cguData, defCompteUtilisateur: e.target.value})} placeholder="Ex: Espace personnel créé par l'utilisateur..." className="min-h-[60px]" /></div>
                    <div><Label>Service</Label><Textarea value={cguData.defService} onChange={(e) => setCguData({...cguData, defService: e.target.value})} placeholder="Ex: L'ensemble des fonctionnalités proposées..." className="min-h-[60px]" /></div>
                    <div><Label>Contenu</Label><Textarea value={cguData.defContenu} onChange={(e) => setCguData({...cguData, defContenu: e.target.value})} placeholder="Ex: Toute information disponible sur la plateforme..." className="min-h-[60px]" /></div>
                    <div><Label>Contenu utilisateur</Label><Textarea value={cguData.defContenuUtilisateur} onChange={(e) => setCguData({...cguData, defContenuUtilisateur: e.target.value})} placeholder="Ex: Contenu publié par l'utilisateur..." className="min-h-[60px]" /></div>
                    <div><Label>Données personnelles</Label><Textarea value={cguData.defDonneesPersonnelles} onChange={(e) => setCguData({...cguData, defDonneesPersonnelles: e.target.value})} placeholder="Ex: Toute information relative à une personne physique identifiée..." className="min-h-[60px]" /></div>
                    <div><Label>Plateforme</Label><Textarea value={cguData.defPlateforme} onChange={(e) => setCguData({...cguData, defPlateforme: e.target.value})} placeholder="Ex: Le site web ou l'application..." className="min-h-[60px]" /></div>
                    <div><Label>Espace client</Label><Textarea value={cguData.defEspaceClient} onChange={(e) => setCguData({...cguData, defEspaceClient: e.target.value})} placeholder="Ex: Interface personnelle de gestion..." className="min-h-[60px]" /></div>
                    <div><Label>Modération</Label><Textarea value={cguData.defModeration} onChange={(e) => setCguData({...cguData, defModeration: e.target.value})} placeholder="Ex: Contrôle des contenus publiés..." className="min-h-[60px]" /></div>
                    <div><Label>Force majeure</Label><Textarea value={cguData.defForceMajeure} onChange={(e) => setCguData({...cguData, defForceMajeure: e.target.value})} placeholder="Ex: Événement imprévisible et insurmontable..." className="min-h-[60px]" /></div>
                    <div><Label>Acceptation des CGU</Label><Textarea value={cguData.defAcceptationCGU} onChange={(e) => setCguData({...cguData, defAcceptationCGU: e.target.value})} placeholder="Ex: Validation expresse lors de l'inscription..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 4. ACCÈS AU SITE / COMPTE UTILISATEUR */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Accès au site / Compte utilisateur</h4>
                  <div className="space-y-4">
                    <div>
                      <Label className="font-medium">A. Création de compte - Champs collectés</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.champsCreeCompteNom} onCheckedChange={(v) => setCguData({...cguData, champsCreeCompteNom: !!v})} id="champ-nom" /><Label htmlFor="champ-nom" className="font-normal">Nom</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.champsCreeComptePrenom} onCheckedChange={(v) => setCguData({...cguData, champsCreeComptePrenom: !!v})} id="champ-prenom" /><Label htmlFor="champ-prenom" className="font-normal">Prénom</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.champsCreeCompteEmail} onCheckedChange={(v) => setCguData({...cguData, champsCreeCompteEmail: !!v})} id="champ-email" /><Label htmlFor="champ-email" className="font-normal">Email</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.champsCreeCompteTelephone} onCheckedChange={(v) => setCguData({...cguData, champsCreeCompteTelephone: !!v})} id="champ-tel" /><Label htmlFor="champ-tel" className="font-normal">Téléphone</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.champsCreeCompteMotDePasse} onCheckedChange={(v) => setCguData({...cguData, champsCreeCompteMotDePasse: !!v})} id="champ-mdp" /><Label htmlFor="champ-mdp" className="font-normal">Mot de passe</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.champsCreeCompteEntreprise} onCheckedChange={(v) => setCguData({...cguData, champsCreeCompteEntreprise: !!v})} id="champ-ent" /><Label htmlFor="champ-ent" className="font-normal">Entreprise (si B2B)</Label></div>
                      </div>
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      <div>
                        <Label>Vérification email nécessaire ?</Label>
                        <RadioGroup value={cguData.verificationEmail} onValueChange={(v) => setCguData({...cguData, verificationEmail: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="verif-email-oui" /><Label htmlFor="verif-email-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="verif-email-non" /><Label htmlFor="verif-email-non">Non</Label></div>
                        </RadioGroup>
                      </div>
                      <div>
                        <Label>Vérification téléphone nécessaire ?</Label>
                        <RadioGroup value={cguData.verificationTelephone} onValueChange={(v) => setCguData({...cguData, verificationTelephone: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="verif-tel-oui" /><Label htmlFor="verif-tel-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="verif-tel-non" /><Label htmlFor="verif-tel-non">Non</Label></div>
                        </RadioGroup>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">B. Conditions d'accès</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label>Âge minimum *</Label>
                          <Select value={cguData.ageMinimum} onValueChange={(v) => setCguData({...cguData, ageMinimum: v})}>
                            <SelectTrigger><SelectValue /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="16">16 ans (RGPD)</SelectItem>
                              <SelectItem value="18">18 ans (services sensibles)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div><Label>Interdictions d'accès</Label><Textarea value={cguData.interdictionsAcces} onChange={(e) => setCguData({...cguData, interdictionsAcces: e.target.value})} placeholder="Professionnels interdits, mineurs, etc..." className="min-h-[60px]" /></div>
                        <div><Label>Exactitude des données fournies</Label><Textarea value={cguData.exactitudeDonnees} onChange={(e) => setCguData({...cguData, exactitudeDonnees: e.target.value})} placeholder="L'utilisateur s'engage à fournir des informations exactes..." className="min-h-[60px]" /></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">C. Sécurité du compte</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label>Obligation de confidentialité du mot de passe</Label><Textarea value={cguData.confidentialiteMotDePasse} onChange={(e) => setCguData({...cguData, confidentialiteMotDePasse: e.target.value})} placeholder="L'utilisateur est responsable de la confidentialité..." className="min-h-[60px]" /></div>
                        <div>
                          <Label>Double authentification (optionnel)</Label>
                          <RadioGroup value={cguData.doubleAuthentification} onValueChange={(v) => setCguData({...cguData, doubleAuthentification: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="2fa-oui" /><Label htmlFor="2fa-oui">Oui (disponible)</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="2fa-non" /><Label htmlFor="2fa-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        <div><Label>Responsabilité en cas de vol de compte</Label><Textarea value={cguData.responsabiliteVolCompte} onChange={(e) => setCguData({...cguData, responsabiliteVolCompte: e.target.value})} placeholder="L'utilisateur doit signaler immédiatement tout accès non autorisé..." className="min-h-[60px]" /></div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 5. FONCTIONNEMENT DU SERVICE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Fonctionnement du service</h4>
                  <div className="space-y-3">
                    <div><Label>Fonctionnalités disponibles *</Label><Textarea value={cguData.fonctionnalitesDisponibles} onChange={(e) => setCguData({...cguData, fonctionnalitesDisponibles: e.target.value})} placeholder="Liste des fonctionnalités offertes..." className="min-h-[100px]" /></div>
                    <div><Label>Limitations du service</Label><Textarea value={cguData.limitationsService} onChange={(e) => setCguData({...cguData, limitationsService: e.target.value})} placeholder="Limites techniques, quotas, restrictions..." className="min-h-[80px]" /></div>
                    <div><Label>Prérequis techniques</Label><Textarea value={cguData.prerequisTechniques} onChange={(e) => setCguData({...cguData, prerequisTechniques: e.target.value})} placeholder="Navigateur, OS, connexion Internet..." className="min-h-[80px]" /></div>
                    <div><Label>Mises à jour possibles</Label><Textarea value={cguData.misesAJour} onChange={(e) => setCguData({...cguData, misesAJour: e.target.value})} placeholder="Le service peut être mis à jour régulièrement..." className="min-h-[60px]" /></div>
                    <div><Label>Interruptions de service (maintenance)</Label><Textarea value={cguData.interruptionsService} onChange={(e) => setCguData({...cguData, interruptionsService: e.target.value})} placeholder="Maintenance programmée, coupures techniques..." className="min-h-[60px]" /></div>
                    <div><Label>Évolutions sans préavis</Label><Textarea value={cguData.evolutionsSansPreavis} onChange={(e) => setCguData({...cguData, evolutionsSansPreavis: e.target.value})} placeholder="Le service peut évoluer sans notification préalable..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 6. RÈGLES D'UTILISATION / COMPORTEMENTS INTERDITS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Règles d'utilisation / Comportements interdits</h4>
                  <div className="space-y-4">
                    <div>
                      <Label className="font-medium">A. Interdictions générales</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionUsurpationIdentite} onCheckedChange={(v) => setCguData({...cguData, interdictionUsurpationIdentite: !!v})} id="int-usurp" disabled /><Label htmlFor="int-usurp" className="font-normal">Usurpation d'identité ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionViolationLois} onCheckedChange={(v) => setCguData({...cguData, interdictionViolationLois: !!v})} id="int-lois" disabled /><Label htmlFor="int-lois" className="font-normal">Violation des lois (fraude, harcèlement, haine) ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionSpamPhishing} onCheckedChange={(v) => setCguData({...cguData, interdictionSpamPhishing: !!v})} id="int-spam" disabled /><Label htmlFor="int-spam" className="font-normal">Spam / Phishing ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionExploitationCommerciale} onCheckedChange={(v) => setCguData({...cguData, interdictionExploitationCommerciale: !!v})} id="int-comm" disabled /><Label htmlFor="int-comm" className="font-normal">Exploitation commerciale non autorisée ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionAccesNonAutorise} onCheckedChange={(v) => setCguData({...cguData, interdictionAccesNonAutorise: !!v})} id="int-acces" disabled /><Label htmlFor="int-acces" className="font-normal">Accès non autorisé à des données ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionContournementProtections} onCheckedChange={(v) => setCguData({...cguData, interdictionContournementProtections: !!v})} id="int-protect" disabled /><Label htmlFor="int-protect" className="font-normal">Contournement des protections ✅</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">B. Contenu interdit</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.contenuIllicite} onCheckedChange={(v) => setCguData({...cguData, contenuIllicite: !!v})} id="cont-illic" disabled /><Label htmlFor="cont-illic" className="font-normal">Contenu illicite ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.contenuViolentHaineux} onCheckedChange={(v) => setCguData({...cguData, contenuViolentHaineux: !!v})} id="cont-viol" disabled /><Label htmlFor="cont-viol" className="font-normal">Contenu violent ou haineux ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.contenuPornographique} onCheckedChange={(v) => setCguData({...cguData, contenuPornographique: !!v})} id="cont-porno" disabled /><Label htmlFor="cont-porno" className="font-normal">Pornographie / mineurs ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.contenuDiffamatoire} onCheckedChange={(v) => setCguData({...cguData, contenuDiffamatoire: !!v})} id="cont-diff" disabled /><Label htmlFor="cont-diff" className="font-normal">Contenu diffamatoire ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.violationDroitsAuteur} onCheckedChange={(v) => setCguData({...cguData, violationDroitsAuteur: !!v})} id="cont-da" disabled /><Label htmlFor="cont-da" className="font-normal">Violation droits d'auteur ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.publiciteDissimulee} onCheckedChange={(v) => setCguData({...cguData, publiciteDissimulee: !!v})} id="cont-pub" disabled /><Label htmlFor="cont-pub" className="font-normal">Publicité dissimulée ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.venteProduitsInterdits} onCheckedChange={(v) => setCguData({...cguData, venteProduitsInterdits: !!v})} id="cont-vente" disabled /><Label htmlFor="cont-vente" className="font-normal">Vente de produits interdits ✅</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">C. Activités interdites (SaaS / plateformes techniques)</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.reverseEngineering} onCheckedChange={(v) => setCguData({...cguData, reverseEngineering: !!v})} id="act-reverse" disabled /><Label htmlFor="act-reverse" className="font-normal">Reverse engineering ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.scrapingIntensif} onCheckedChange={(v) => setCguData({...cguData, scrapingIntensif: !!v})} id="act-scraping" disabled /><Label htmlFor="act-scraping" className="font-normal">Scraping intensif ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.surutilisationService} onCheckedChange={(v) => setCguData({...cguData, surutilisationService: !!v})} id="act-surutil" disabled /><Label htmlFor="act-surutil" className="font-normal">Surutilisation du service ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.automatisationNonAutorisee} onCheckedChange={(v) => setCguData({...cguData, automatisationNonAutorisee: !!v})} id="act-auto" disabled /><Label htmlFor="act-auto" className="font-normal">Automatisation non autorisée ✅</Label></div>
                      </div>
                    </div>
                    <div><Label>Autres interdictions spécifiques</Label><Textarea value={cguData.autresInterdictions} onChange={(e) => setCguData({...cguData, autresInterdictions: e.target.value})} placeholder="Ajoutez d'autres interdictions spécifiques à votre service..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 7. CONTENUS UTILISATEURS (UGC) */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Contenus utilisateurs (UGC)</h4>
                  <div className="space-y-3">
                    <div><Label>Définition du contenu utilisateur</Label><Textarea value={cguData.definitionContenuUGC} onChange={(e) => setCguData({...cguData, definitionContenuUGC: e.target.value})} placeholder="Tout contenu publié, partagé ou transmis par l'utilisateur..." className="min-h-[60px]" /></div>
                    <div><Label>Droits concédés par l'utilisateur à la plateforme</Label><Textarea value={cguData.droitsConcedes} onChange={(e) => setCguData({...cguData, droitsConcedes: e.target.value})} placeholder="Licence d'utilisation, droits de reproduction..." className="min-h-[80px]" /></div>
                    <div><Label>Licence d'utilisation</Label><Textarea value={cguData.licenceUtilisation} onChange={(e) => setCguData({...cguData, licenceUtilisation: e.target.value})} placeholder="Type de licence accordée (mondiale, gratuite, non-exclusive...)..." className="min-h-[60px]" /></div>
                    <div><Label>Droits de reproduction / hébergement</Label><Textarea value={cguData.droitsReproduction} onChange={(e) => setCguData({...cguData, droitsReproduction: e.target.value})} placeholder="Autorisation de reproduire, héberger, diffuser..." className="min-h-[60px]" /></div>
                    <div><Label>Durée de la licence</Label><Input value={cguData.dureeLicence} onChange={(e) => setCguData({...cguData, dureeLicence: e.target.value})} placeholder="Ex: Durée de présence du contenu, ou perpétuelle" /></div>
                    <div><Label>Responsabilité de l'utilisateur sur son contenu</Label><Textarea value={cguData.responsabiliteContenu} onChange={(e) => setCguData({...cguData, responsabiliteContenu: e.target.value})} placeholder="L'utilisateur garantit être titulaire des droits..." className="min-h-[80px]" /></div>
                    <div><Label>Pouvoir de suppression par la plateforme</Label><Textarea value={cguData.pouvoirSuppression} onChange={(e) => setCguData({...cguData, pouvoirSuppression: e.target.value})} placeholder="La plateforme se réserve le droit de supprimer tout contenu..." className="min-h-[60px]" /></div>
                    <div><Label>Procédure de signalement</Label><Textarea value={cguData.procedureSignalement} onChange={(e) => setCguData({...cguData, procedureSignalement: e.target.value})} placeholder="Comment les utilisateurs peuvent signaler un contenu..." className="min-h-[60px]" /></div>
                    <div><Label>Suspension du compte</Label><Textarea value={cguData.suspensionCompte} onChange={(e) => setCguData({...cguData, suspensionCompte: e.target.value})} placeholder="Conditions de suspension en cas de violation..." className="min-h-[60px]" /></div>
                    <div className="p-3 bg-orange-50 rounded border border-orange-200">
                      <Label className="font-medium text-orange-700">DSA (Digital Services Act)</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label>Procédures de signalement DSA</Label><Textarea value={cguData.dsaSignalement} onChange={(e) => setCguData({...cguData, dsaSignalement: e.target.value})} placeholder="Formulaire de signalement conforme DSA..." className="min-h-[60px]" /></div>
                        <div><Label>Transparence sur la modération</Label><Textarea value={cguData.dsaTransparence} onChange={(e) => setCguData({...cguData, dsaTransparence: e.target.value})} placeholder="Critères de modération, délais de traitement..." className="min-h-[60px]" /></div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 8. PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  <div className="space-y-3">
                    <div><Label>Titularité des droits du site / application</Label><Textarea value={cguData.titulariteDroits} onChange={(e) => setCguData({...cguData, titulariteDroits: e.target.value})} placeholder="Tous les éléments du service sont protégés..." className="min-h-[60px]" /></div>
                    <div><Label>Marques, logos, design</Label><Textarea value={cguData.marquesLogosDesign} onChange={(e) => setCguData({...cguData, marquesLogosDesign: e.target.value})} placeholder="Protection des marques et éléments graphiques..." className="min-h-[60px]" /></div>
                    <div><Label>Logiciels utilisés</Label><Textarea value={cguData.logicielsUtilises} onChange={(e) => setCguData({...cguData, logicielsUtilises: e.target.value})} placeholder="Frameworks, bibliothèques, licences tierces..." className="min-h-[60px]" /></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={cguData.interdictionReproductionPI} onCheckedChange={(v) => setCguData({...cguData, interdictionReproductionPI: !!v})} id="pi-interdit" disabled /><Label htmlFor="pi-interdit" className="font-normal">Interdiction de reproduction sans accord ✅</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={cguData.protectionCodePI} onCheckedChange={(v) => setCguData({...cguData, protectionCodePI: !!v})} id="pi-code" disabled /><Label htmlFor="pi-code" className="font-normal">Protection par le Code de la propriété intellectuelle ✅</Label></div>
                    <div><Label>Droits du client sur son contenu</Label><Textarea value={cguData.droitsClientContenu} onChange={(e) => setCguData({...cguData, droitsClientContenu: e.target.value})} placeholder="Le client conserve tous les droits sur ses données et contenus..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 9. DONNÉES PERSONNELLES / RGPD */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Données personnelles / RGPD</h4>
                  <div className="space-y-4">
                    <div>
                      <Label className="font-medium">A. Données collectées</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.donneesIdentite} onCheckedChange={(v) => setCguData({...cguData, donneesIdentite: !!v})} id="data-id" /><Label htmlFor="data-id" className="font-normal">Identité (nom, prénom)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.donneesContacts} onCheckedChange={(v) => setCguData({...cguData, donneesContacts: !!v})} id="data-contact" /><Label htmlFor="data-contact" className="font-normal">Contacts (email, téléphone)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.donneesIdentifiants} onCheckedChange={(v) => setCguData({...cguData, donneesIdentifiants: !!v})} id="data-idfs" /><Label htmlFor="data-idfs" className="font-normal">Identifiants (login, mot de passe)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.donneesCookiesTracking} onCheckedChange={(v) => setCguData({...cguData, donneesCookiesTracking: !!v})} id="data-cookie" /><Label htmlFor="data-cookie" className="font-normal">Cookies / tracking</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.donneesNavigation} onCheckedChange={(v) => setCguData({...cguData, donneesNavigation: !!v})} id="data-nav" /><Label htmlFor="data-nav" className="font-normal">Données de navigation</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.donneesUsage} onCheckedChange={(v) => setCguData({...cguData, donneesUsage: !!v})} id="data-usage" /><Label htmlFor="data-usage" className="font-normal">Données d'usage</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">B. Finalités</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.finaliteFonctionnement} onCheckedChange={(v) => setCguData({...cguData, finaliteFonctionnement: !!v})} id="fin-fonc" /><Label htmlFor="fin-fonc" className="font-normal">Fonctionnement du service</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.finaliteSecurite} onCheckedChange={(v) => setCguData({...cguData, finaliteSecurite: !!v})} id="fin-secu" /><Label htmlFor="fin-secu" className="font-normal">Sécurité</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.finaliteStatistiques} onCheckedChange={(v) => setCguData({...cguData, finaliteStatistiques: !!v})} id="fin-stat" /><Label htmlFor="fin-stat" className="font-normal">Statistiques</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.finalitePublicite} onCheckedChange={(v) => setCguData({...cguData, finalitePublicite: !!v})} id="fin-pub" /><Label htmlFor="fin-pub" className="font-normal">Publicité / marketing (optionnel)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.finalitePreventionFraude} onCheckedChange={(v) => setCguData({...cguData, finalitePreventionFraude: !!v})} id="fin-fraud" /><Label htmlFor="fin-fraud" className="font-normal">Prévention fraude</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">C. Base légale</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.baseLegaleConsentement} onCheckedChange={(v) => setCguData({...cguData, baseLegaleConsentement: !!v})} id="base-consent" /><Label htmlFor="base-consent" className="font-normal">Consentement</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.baseLegaleContrat} onCheckedChange={(v) => setCguData({...cguData, baseLegaleContrat: !!v})} id="base-contrat" /><Label htmlFor="base-contrat" className="font-normal">Exécution du contrat</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.baseLegaleInteretLegitime} onCheckedChange={(v) => setCguData({...cguData, baseLegaleInteretLegitime: !!v})} id="base-interet" /><Label htmlFor="base-interet" className="font-normal">Intérêt légitime</Label></div>
                      </div>
                    </div>
                    <div><Label>D. Durées de conservation</Label><Textarea value={cguData.dureeConservationRGPD} onChange={(e) => setCguData({...cguData, dureeConservationRGPD: e.target.value})} placeholder="Durées de conservation selon le type de données..." className="min-h-[80px]" /></div>
                    <div>
                      <Label className="font-medium">E. Droits des utilisateurs ✅</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.droitAcces} onCheckedChange={(v) => setCguData({...cguData, droitAcces: !!v})} id="droit-acces" disabled /><Label htmlFor="droit-acces" className="font-normal">Accès ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.droitRectification} onCheckedChange={(v) => setCguData({...cguData, droitRectification: !!v})} id="droit-rect" disabled /><Label htmlFor="droit-rect" className="font-normal">Rectification ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.droitSuppression} onCheckedChange={(v) => setCguData({...cguData, droitSuppression: !!v})} id="droit-suppr" disabled /><Label htmlFor="droit-suppr" className="font-normal">Suppression ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.droitOpposition} onCheckedChange={(v) => setCguData({...cguData, droitOpposition: !!v})} id="droit-oppos" disabled /><Label htmlFor="droit-oppos" className="font-normal">Opposition ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.droitPortabilite} onCheckedChange={(v) => setCguData({...cguData, droitPortabilite: !!v})} id="droit-port" disabled /><Label htmlFor="droit-port" className="font-normal">Portabilité ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.droitLimitation} onCheckedChange={(v) => setCguData({...cguData, droitLimitation: !!v})} id="droit-limit" disabled /><Label htmlFor="droit-limit" className="font-normal">Limitation ✅</Label></div>
                      </div>
                    </div>
                    <div><Label>F. Sous-traitants (API, stockage, paiement)</Label><Textarea value={cguData.sousTraitants} onChange={(e) => setCguData({...cguData, sousTraitants: e.target.value})} placeholder="Liste des sous-traitants et services tiers..." className="min-h-[80px]" /></div>
                    <div>
                      <Label>G. Transfert hors UE</Label>
                      <RadioGroup value={cguData.transfertHorsUERGPD} onValueChange={(v) => setCguData({...cguData, transfertHorsUERGPD: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="ue-rgpd-oui" /><Label htmlFor="ue-rgpd-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="ue-rgpd-non" /><Label htmlFor="ue-rgpd-non">Non</Label></div>
                      </RadioGroup>
                      {cguData.transfertHorsUERGPD === "oui" && (
                        <Input value={cguData.transfertHorsUEPays} onChange={(e) => setCguData({...cguData, transfertHorsUEPays: e.target.value})} placeholder="Pays et garanties (clauses contractuelles types...)" className="mt-2" />
                      )}
                    </div>
                    <div><Label>H. Délégué à la protection des données (DPO)</Label><Input value={cguData.dpo} onChange={(e) => setCguData({...cguData, dpo: e.target.value})} placeholder="Contact DPO ou email de contact RGPD" /></div>
                  </div>
                </div>
                
                {/* 10. COOKIES ET TRACEURS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟 Cookies et traceurs</h4>
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2"><Checkbox checked={cguData.cookiesNecessaires} onCheckedChange={(v) => setCguData({...cguData, cookiesNecessaires: !!v})} id="cook-nec" disabled /><Label htmlFor="cook-nec" className="font-normal">Cookies nécessaires ✅</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={cguData.cookiesStatistiques} onCheckedChange={(v) => setCguData({...cguData, cookiesStatistiques: !!v})} id="cook-stat" /><Label htmlFor="cook-stat" className="font-normal">Cookies statistiques</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={cguData.cookiesPublicitaires} onCheckedChange={(v) => setCguData({...cguData, cookiesPublicitaires: !!v})} id="cook-pub" /><Label htmlFor="cook-pub" className="font-normal">Cookies publicitaires</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={cguData.consentementCookies} onCheckedChange={(v) => setCguData({...cguData, consentementCookies: !!v})} id="cook-consent" disabled /><Label htmlFor="cook-consent" className="font-normal">Consentement et refus ✅</Label></div>
                    <div><Label>Conservation du choix</Label><Input value={cguData.conservationChoixCookies} onChange={(e) => setCguData({...cguData, conservationChoixCookies: e.target.value})} placeholder="Ex: 6 mois, 13 mois..." /></div>
                    <div><Label>Lien vers politique cookies</Label><Input value={cguData.lienPolitiqueCookies} onChange={(e) => setCguData({...cguData, lienPolitiqueCookies: e.target.value})} placeholder="URL vers la politique cookies complète" /></div>
                  </div>
                </div>
                
                {/* 11. RESPONSABILITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Responsabilité</h4>
                  <div className="space-y-4">
                    <div>
                      <Label className="font-medium">Engagements du fournisseur</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label>Disponibilité raisonnable du service</Label><Textarea value={cguData.engagementDisponibilite} onChange={(e) => setCguData({...cguData, engagementDisponibilite: e.target.value})} placeholder="Objectif de disponibilité, maintenance..." className="min-h-[60px]" /></div>
                        <div><Label>Sécurité technique</Label><Textarea value={cguData.engagementSecurite} onChange={(e) => setCguData({...cguData, engagementSecurite: e.target.value})} placeholder="Mesures de sécurité mises en œuvre..." className="min-h-[60px]" /></div>
                        <div><Label>Maintenance</Label><Textarea value={cguData.engagementMaintenance} onChange={(e) => setCguData({...cguData, engagementMaintenance: e.target.value})} placeholder="Maintenance corrective et évolutive..." className="min-h-[60px]" /></div>
                        <div><Label>Respect des lois</Label><Textarea value={cguData.engagementRespectLois} onChange={(e) => setCguData({...cguData, engagementRespectLois: e.target.value})} placeholder="Conformité réglementaire..." className="min-h-[60px]" /></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">Exclusions de responsabilité (dans la limite légale)</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.exclusionUtilisationIncorrecte} onCheckedChange={(v) => setCguData({...cguData, exclusionUtilisationIncorrecte: !!v})} id="excl-util" disabled /><Label htmlFor="excl-util" className="font-normal">Utilisation incorrecte du service ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.exclusionPanneInternet} onCheckedChange={(v) => setCguData({...cguData, exclusionPanneInternet: !!v})} id="excl-net" disabled /><Label htmlFor="excl-net" className="font-normal">Panne Internet ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.exclusionDommagesIndirects} onCheckedChange={(v) => setCguData({...cguData, exclusionDommagesIndirects: !!v})} id="excl-dmg" disabled /><Label htmlFor="excl-dmg" className="font-normal">Dommages indirects ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.exclusionPerteDonnees} onCheckedChange={(v) => setCguData({...cguData, exclusionPerteDonnees: !!v})} id="excl-data" disabled /><Label htmlFor="excl-data" className="font-normal">Perte de données imputable à l'utilisateur ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.exclusionIntrusionExterne} onCheckedChange={(v) => setCguData({...cguData, exclusionIntrusionExterne: !!v})} id="excl-hack" disabled /><Label htmlFor="excl-hack" className="font-normal">Intrusion informatique extérieure ✅</Label></div>
                      </div>
                    </div>
                    <div><Label>Force majeure</Label><Textarea value={cguData.forceMajeureResponsabilite} onChange={(e) => setCguData({...cguData, forceMajeureResponsabilite: e.target.value})} placeholder="Cas de force majeure exonérant de responsabilité..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 12. SUSPENSION / SUPPRESSION DU COMPTE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Suspension / Suppression du compte</h4>
                  <div className="space-y-3">
                    <div>
                      <Label className="font-medium">Cas de suspension/suppression</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.suspensionNonRespectCGU} onCheckedChange={(v) => setCguData({...cguData, suspensionNonRespectCGU: !!v})} id="susp-cgu" disabled /><Label htmlFor="susp-cgu" className="font-normal">Non-respect des CGU ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.suspensionComportementsIllicites} onCheckedChange={(v) => setCguData({...cguData, suspensionComportementsIllicites: !!v})} id="susp-illic" disabled /><Label htmlFor="susp-illic" className="font-normal">Comportements illicites ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.suspensionUtilisationAbusive} onCheckedChange={(v) => setCguData({...cguData, suspensionUtilisationAbusive: !!v})} id="susp-abus" disabled /><Label htmlFor="susp-abus" className="font-normal">Utilisation abusive ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.suppressionDemandeUtilisateur} onCheckedChange={(v) => setCguData({...cguData, suppressionDemandeUtilisateur: !!v})} id="susp-user" disabled /><Label htmlFor="susp-user" className="font-normal">Demande de suppression par l'utilisateur ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={cguData.suppressionDecesUtilisateur} onCheckedChange={(v) => setCguData({...cguData, suppressionDecesUtilisateur: !!v})} id="susp-deces" disabled /><Label htmlFor="susp-deces" className="font-normal">Décès de l'utilisateur ✅</Label></div>
                      </div>
                    </div>
                    <div><Label>Durée de suspension</Label><Input value={cguData.dureeSuspension} onChange={(e) => setCguData({...cguData, dureeSuspension: e.target.value})} placeholder="Ex: Temporaire (1 mois) ou définitive" /></div>
                    <div><Label>Procédure de recours</Label><Textarea value={cguData.procedureRecours} onChange={(e) => setCguData({...cguData, procedureRecours: e.target.value})} placeholder="Comment contester une suspension..." className="min-h-[80px]" /></div>
                  </div>
                </div>
                
                {/* 13. MODIFICATION DES CGU */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Modification des CGU</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Notification de la modification</Label>
                      <RadioGroup value={cguData.notificationModification} onValueChange={(v) => setCguData({...cguData, notificationModification: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="notif-oui" /><Label htmlFor="notif-oui">Oui (par email ou sur le site)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="notif-non" /><Label htmlFor="notif-non">Non (publication suffit)</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Date d'entrée en vigueur</Label><Input value={cguData.dateEntreeVigueur} onChange={(e) => setCguData({...cguData, dateEntreeVigueur: e.target.value})} placeholder="Ex: Immédiate, ou 30 jours après notification" /></div>
                    <div>
                      <Label>Acceptation tacite / expresse</Label>
                      <RadioGroup value={cguData.acceptationTaciteExpresse} onValueChange={(v) => setCguData({...cguData, acceptationTaciteExpresse: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="tacite" id="accept-tacite" /><Label htmlFor="accept-tacite">Tacite (poursuite de l'utilisation)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="expresse" id="accept-expresse" /><Label htmlFor="accept-expresse">Expresse (validation requise)</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Archivage des anciennes versions</Label>
                      <RadioGroup value={cguData.archivageVersions} onValueChange={(v) => setCguData({...cguData, archivageVersions: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="arch-oui" /><Label htmlFor="arch-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="arch-non" /><Label htmlFor="arch-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>
                
                {/* 14. RÉSILIATION DU SERVICE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Résiliation du service</h4>
                  <div className="space-y-3">
                    <div><Label>Résiliation par l'utilisateur</Label><Textarea value={cguData.resiliationParUtilisateur} onChange={(e) => setCguData({...cguData, resiliationParUtilisateur: e.target.value})} placeholder="Modalités de résiliation à l'initiative de l'utilisateur..." className="min-h-[80px]" /></div>
                    <div><Label>Résiliation par la plateforme</Label><Textarea value={cguData.resiliationParPlateforme} onChange={(e) => setCguData({...cguData, resiliationParPlateforme: e.target.value})} placeholder="Cas de résiliation par la plateforme..." className="min-h-[80px]" /></div>
                    <div>
                      <Label className="font-medium">Effets de la résiliation</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label>Clôture du compte</Label><Textarea value={cguData.effetsClotureCompte} onChange={(e) => setCguData({...cguData, effetsClotureCompte: e.target.value})} placeholder="Accès supprimé, fonctionnalités désactivées..." className="min-h-[60px]" /></div>
                        <div><Label>Suppression ou conservation des données</Label><Textarea value={cguData.effetsSuppressionDonnees} onChange={(e) => setCguData({...cguData, effetsSuppressionDonnees: e.target.value})} placeholder="Données supprimées après X jours, archivage légal..." className="min-h-[60px]" /></div>
                        <div><Label>Restitution des accès</Label><Textarea value={cguData.effetsRestitutionAcces} onChange={(e) => setCguData({...cguData, effetsRestitutionAcces: e.target.value})} placeholder="Export des données, transfert vers autre service..." className="min-h-[60px]" /></div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 15. LITIGES / DROIT APPLICABLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Litiges / Droit applicable</h4>
                  <div className="space-y-3">
                    <div><Label>Droit applicable *</Label><Input value={cguData.droitApplicable} onChange={(e) => setCguData({...cguData, droitApplicable: e.target.value})} placeholder="Ex: Droit français" /></div>
                    <div><Label>Tribunal compétent</Label><Textarea value={cguData.tribunalCompetent} onChange={(e) => setCguData({...cguData, tribunalCompetent: e.target.value})} placeholder="Ex: Tribunaux de Paris" className="min-h-[60px]" /></div>
                    <div>
                      <Label>Procédure amiable préalable</Label>
                      <RadioGroup value={cguData.procedureAmiable} onValueChange={(v) => setCguData({...cguData, procedureAmiable: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="amiable-oui" /><Label htmlFor="amiable-oui">Oui (obligatoire)</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="amiable-non" /><Label htmlFor="amiable-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label>Clause de médiation</Label>
                      <RadioGroup value={cguData.clauseMediationLitiges} onValueChange={(v) => setCguData({...cguData, clauseMediationLitiges: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="mediation-lit-oui" /><Label htmlFor="mediation-lit-oui">Oui</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="mediation-lit-non" /><Label htmlFor="mediation-lit-non">Non</Label></div>
                      </RadioGroup>
                    </div>
                  </div>
                </div>
                
                {/* 15bis. HIÉRARCHIE DES DOCUMENTS */}
                <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                  <h4 className="font-semibold text-lg text-green-700">bis Clause de hiérarchie des documents</h4>
                  <div className="p-3 bg-green-100 rounded border border-green-300">
                    <p className="text-xs text-green-800">💡 Utile si CGU + CGV + contrats particuliers coexistent</p>
                  </div>
                  <div>
                    <Label>Ordre de priorité des documents</Label>
                    <Textarea 
                      value={cguData.hierarchieDocuments} 
                      onChange={(e) => setCguData({...cguData, hierarchieDocuments: e.target.value})} 
                      placeholder="Ex: En cas de contradiction entre les documents contractuels, l'ordre de priorité est le suivant : 1. Contrats particuliers, 2. CGV, 3. CGU, 4. Conditions commerciales..."
                      className="min-h-[100px]" 
                    />
                  </div>
                </div>
                
                {/* 15ter. NULLITÉ PARTIELLE */}
                <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                  <h4 className="font-semibold text-lg text-green-700">ter Clause de nullité partielle (séparabilité)</h4>
                  <div className="p-3 bg-green-100 rounded border border-green-300">
                    <p className="text-xs text-green-800">💡 Standard juridique : si une clause est annulée, les autres restent valables</p>
                  </div>
                  <div>
                    <Label>Clause de séparabilité</Label>
                    <Textarea 
                      value={cguData.clauseNullitePartielle} 
                      onChange={(e) => setCguData({...cguData, clauseNullitePartielle: e.target.value})} 
                      placeholder="Ex: Si une ou plusieurs stipulations des présentes CGU sont tenues pour non valides ou déclarées nulles en application d'une loi, d'un règlement ou à la suite d'une décision définitive d'une juridiction compétente, les autres stipulations garderont toute leur force et leur portée."
                      className="min-h-[100px]" 
                    />
                  </div>
                </div>
                
                {/* 15quater. PREUVE ÉLECTRONIQUE */}
                <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                  <h4 className="font-semibold text-lg text-green-700">quater Clause de preuve électronique</h4>
                  <div className="p-3 bg-green-100 rounded border border-green-300">
                    <p className="text-xs text-green-800">💡 Essentiel en SaaS : logs, horodatage, données informatiques font foi</p>
                  </div>
                  <div>
                    <Label>Valeur probante des données électroniques</Label>
                    <Textarea 
                      value={cguData.clausePreuveElectronique} 
                      onChange={(e) => setCguData({...cguData, clausePreuveElectronique: e.target.value})} 
                      placeholder="Ex: Les registres informatisés, conservés dans les systèmes informatiques de la Plateforme dans des conditions raisonnables de sécurité, seront considérés comme des preuves des communications, des commandes et des paiements intervenus entre les parties. L'archivage des contrats et des documents est effectué sur un support fiable et durable de manière à correspondre à une copie fidèle."
                      className="min-h-[120px]" 
                    />
                  </div>
                </div>
                
                {/* 16. ANNEXES TECHNIQUES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Annexes techniques possibles</h4>
                  <div className="space-y-3">
                    <SingleFileUpload label="Politique de confidentialité" files={cguPolitiqueConfidentialiteFiles} onFilesChange={setCguPolitiqueConfidentialiteFiles} role="avocat" />
                    <SingleFileUpload label="Politique cookies" files={cguPolitiqueCookiesFiles} onFilesChange={setCguPolitiqueCookiesFiles} role="avocat" />
                    <SingleFileUpload label="Charte d'utilisation" files={cguCharteUtilisationFiles} onFilesChange={setCguCharteUtilisationFiles} role="avocat" />
                    <SingleFileUpload label="Documentation API (si applicable)" files={cguDocumentationAPIFiles} onFilesChange={setCguDocumentationAPIFiles} role="avocat" />
                    <SingleFileUpload label="Règles de modération (DSA)" files={cguReglesModerationFiles} onFilesChange={setCguReglesModerationFiles} role="avocat" />
                  </div>
                </div>
                
                {/* 17. PIÈCES JUSTIFICATIVES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Pièces justificatives (liste)</h4>
                  <div className="space-y-3">
                    <SingleFileUpload label="Mentions légales (Kbis, statuts...)" files={cguMentionsLegalesFiles} onFilesChange={setCguMentionsLegalesFiles} role="avocat" />
                    <SingleFileUpload label="Politique de confidentialité" files={cguPolitiqueConfidentialite2Files} onFilesChange={setCguPolitiqueConfidentialite2Files} role="avocat" />
                    <SingleFileUpload label="Politique de cookies" files={cguPolitiqueCookies2Files} onFilesChange={setCguPolitiqueCookies2Files} role="avocat" />
                    <SingleFileUpload label="Conditions commerciales (si liées)" files={cguConditionsCommercialesFiles} onFilesChange={setCguConditionsCommercialesFiles} role="avocat" />
                  </div>
                </div>
                
              </div>
            )}

            {/* Formulaire complet pour Contrat d'agence commerciale */}
            {(pendingContractType.includes("agence commerciale") || pendingContractType.includes("Contrat d'agence commerciale")) && (
              <div className="space-y-6">
                <h3 className="font-semibold text-xl border-b-2 border-blue-300 pb-2 text-gray-700">🤝 Contrat d'Agence Commerciale</h3>
                
                {/* 1. IDENTIFICATION DES PARTIES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Identification des parties</h4>
                  
                  {/* MANDANT */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-semibold text-gray-700">A. Mandant (entreprise représentée)</h5>
                    <ClientSelector 
                      clients={clients} 
                      selectedClientId={agenceClientId} 
                      onClientChange={(clientId) => {
                        setAgenceClientId(clientId);
                        const client = clients.find(c => c.id === clientId);
                        if (client) {
                          setAgenceData({
                            ...agenceData,
                            mandantDenomination: client.nom || "",
                            mandantSiege: client.adresse || "",
                            mandantEmail: client.email || "",
                            mandantTelephone: client.telephone || "",
                          });
                        } else {
                          setAgenceData({
                            ...agenceData,
                            mandantDenomination: "",
                            mandantSiege: "",
                            mandantEmail: "",
                            mandantTelephone: "",
                          });
                        }
                      }}
                      label="Sélectionner le mandant (facultatif)"
                      role="avocat"
                    />
                    <div className="grid grid-cols-2 gap-3">
                      <div><Label>Dénomination sociale *</Label><Input value={agenceData.mandantDenomination} onChange={(e) => setAgenceData({...agenceData, mandantDenomination: e.target.value})} placeholder="SAS EXEMPLE" /></div>
                      <div><Label>Forme juridique *</Label><Input value={agenceData.mandantFormeJuridique} onChange={(e) => setAgenceData({...agenceData, mandantFormeJuridique: e.target.value})} placeholder="SAS, SARL, SA..." /></div>
                      <div><Label>Capital social</Label><Input value={agenceData.mandantCapital} onChange={(e) => setAgenceData({...agenceData, mandantCapital: e.target.value})} placeholder="100 000 €" /></div>
                      <div><Label>RCS</Label><Input value={agenceData.mandantRCS} onChange={(e) => setAgenceData({...agenceData, mandantRCS: e.target.value})} placeholder="RCS Paris" /></div>
                      <div><Label>SIREN *</Label><Input value={agenceData.mandantSIREN} onChange={(e) => setAgenceData({...agenceData, mandantSIREN: e.target.value})} placeholder="123 456 789" /></div>
                      <div><Label>Représentant légal *</Label><Input value={agenceData.mandantRepresentant} onChange={(e) => setAgenceData({...agenceData, mandantRepresentant: e.target.value})} placeholder="M. Jean DUPONT" /></div>
                    </div>
                    <div><Label>Adresse siège social *</Label><Textarea value={agenceData.mandantSiege} onChange={(e) => setAgenceData({...agenceData, mandantSiege: e.target.value})} placeholder="Adresse complète" className="min-h-[60px]" /></div>
                    <div className="grid grid-cols-2 gap-3">
                      <div><Label>Activité principale</Label><Input value={agenceData.mandantActivite} onChange={(e) => setAgenceData({...agenceData, mandantActivite: e.target.value})} placeholder="Vente de produits..." /></div>
                      <div><Label>Email</Label><Input type="email" value={agenceData.mandantEmail} onChange={(e) => setAgenceData({...agenceData, mandantEmail: e.target.value})} placeholder="contact@entreprise.com" /></div>
                    </div>
                    <div><Label>Téléphone</Label><Input value={agenceData.mandantTelephone} onChange={(e) => setAgenceData({...agenceData, mandantTelephone: e.target.value})} placeholder="+33 1 23 45 67 89" /></div>
                  </div>
                  
                  {/* AGENT COMMERCIAL */}
                  <div className="space-y-3 p-3 bg-white rounded border border-blue-100">
                    <h5 className="font-semibold text-gray-700">B. Agent commercial (mandataire indépendant)</h5>
                    <div className="p-3 bg-orange-50 rounded border border-orange-200">
                      <p className="text-xs text-orange-700">⚠️ L'agent doit être inscrit au RSAC (Registre Spécial des Agents Commerciaux)</p>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div><Label>Nom / Prénom (si personne physique)</Label><Input value={agenceData.agentNomPrenom} onChange={(e) => setAgenceData({...agenceData, agentNomPrenom: e.target.value})} placeholder="Jean MARTIN" /></div>
                      <div><Label>Ou dénomination sociale (si société)</Label><Input value={agenceData.agentDenomination} onChange={(e) => setAgenceData({...agenceData, agentDenomination: e.target.value})} placeholder="AGENT SOLUTIONS SARL" /></div>
                      <div><Label>Statut juridique *</Label><Input value={agenceData.agentStatutJuridique} onChange={(e) => setAgenceData({...agenceData, agentStatutJuridique: e.target.value})} placeholder="EI, EURL, SASU..." /></div>
                      <div><Label>RCS</Label><Input value={agenceData.agentRCS} onChange={(e) => setAgenceData({...agenceData, agentRCS: e.target.value})} placeholder="RCS Lyon" /></div>
                      <div><Label>SIREN</Label><Input value={agenceData.agentSIREN} onChange={(e) => setAgenceData({...agenceData, agentSIREN: e.target.value})} placeholder="987 654 321" /></div>
                      <div><Label>N° RSAC *</Label><Input value={agenceData.agentRSAC} onChange={(e) => setAgenceData({...agenceData, agentRSAC: e.target.value})} placeholder="RSAC 12345678" /></div>
                    </div>
                    <div><Label>Adresse complète *</Label><Textarea value={agenceData.agentAdresse} onChange={(e) => setAgenceData({...agenceData, agentAdresse: e.target.value})} placeholder="Adresse complète de l'agent" className="min-h-[60px]" /></div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Assurance RC Professionnelle *</Label>
                        <RadioGroup value={agenceData.agentRCPro} onValueChange={(v) => setAgenceData({...agenceData, agentRCPro: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="rc-oui" /><Label htmlFor="rc-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="rc-non" /><Label htmlFor="rc-non">Non</Label></div>
                        </RadioGroup>
                      </div>
                      {agenceData.agentRCPro === "oui" && (
                        <div><Label>Numéro de police</Label><Input value={agenceData.agentNumeroRCPro} onChange={(e) => setAgenceData({...agenceData, agentNumeroRCPro: e.target.value})} placeholder="N° police RC Pro" /></div>
                      )}
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div><Label>Email</Label><Input type="email" value={agenceData.agentEmail} onChange={(e) => setAgenceData({...agenceData, agentEmail: e.target.value})} placeholder="agent@email.com" /></div>
                      <div><Label>Téléphone</Label><Input value={agenceData.agentTelephone} onChange={(e) => setAgenceData({...agenceData, agentTelephone: e.target.value})} placeholder="+33 6 12 34 56 78" /></div>
                    </div>
                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <Checkbox checked={agenceData.agentEtranger} onCheckedChange={(v) => setAgenceData({...agenceData, agentEtranger: !!v})} id="agent-etranger" />
                        <Label htmlFor="agent-etranger" className="font-normal">Agent étranger</Label>
                      </div>
                      <div>
                        <Label>Sous-agents utilisés</Label>
                        <RadioGroup value={agenceData.agentSousAgents} onValueChange={(v) => setAgenceData({...agenceData, agentSousAgents: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="sa-oui" /><Label htmlFor="sa-oui">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="sa-non" /><Label htmlFor="sa-non">Non</Label></div>
                        </RadioGroup>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 2. OBJET DU CONTRAT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Objet du contrat</h4>
                  <div className="space-y-3">
                    <div><Label>Produits ou services à promouvoir *</Label><Textarea value={agenceData.produits} onChange={(e) => setAgenceData({...agenceData, produits: e.target.value})} placeholder="Description des produits/services..." className="min-h-[80px]" /></div>
                    <div><Label>Marchés cibles</Label><Input value={agenceData.marchesCibles} onChange={(e) => setAgenceData({...agenceData, marchesCibles: e.target.value})} placeholder="B2B, B2C, secteur industriel..." /></div>
                    <div><Label>Secteurs géographiques *</Label><Input value={agenceData.secteursGeographiques} onChange={(e) => setAgenceData({...agenceData, secteursGeographiques: e.target.value})} placeholder="France, Europe, régions..." /></div>
                    <div><Label>Type de clientèle visée</Label><Input value={agenceData.clienteleVisee} onChange={(e) => setAgenceData({...agenceData, clienteleVisee: e.target.value})} placeholder="PME, grands comptes, particuliers..." /></div>
                    <div><Label>Conditions générales de vente applicables</Label><Input value={agenceData.cgvApplicables} onChange={(e) => setAgenceData({...agenceData, cgvApplicables: e.target.value})} placeholder="Référence aux CGV du mandant" /></div>
                  </div>
                </div>
                
                {/* 3. NATURE JURIDIQUE */}
                <div className="space-y-4 p-4 bg-orange-50/50 rounded-lg border border-orange-200">
                  <h4 className="font-semibold text-lg text-orange-700">Nature juridique — Rappels obligatoires</h4>
                  <div className="p-3 bg-orange-100 rounded border border-orange-300">
                    <p className="text-xs text-orange-800">⚠️ Articles L134-1 à L134-17 du Code de commerce</p>
                  </div>
                  <div className="space-y-2">
                    <div className="flex items-center space-x-2"><Checkbox checked={agenceData.rappelIntermediaireIndependant} onCheckedChange={(v) => setAgenceData({...agenceData, rappelIntermediaireIndependant: !!v})} id="rappel-1" disabled /><Label htmlFor="rappel-1" className="font-normal">L'agent commercial agit en tant qu'intermédiaire indépendant ✅</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={agenceData.rappelPasRisqueVente} onCheckedChange={(v) => setAgenceData({...agenceData, rappelPasRisqueVente: !!v})} id="rappel-2" disabled /><Label htmlFor="rappel-2" className="font-normal">Il ne supporte pas les risques de la vente ✅</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={agenceData.rappelPasEncaissementSaufClause} onCheckedChange={(v) => setAgenceData({...agenceData, rappelPasEncaissementSaufClause: !!v})} id="rappel-3" disabled /><Label htmlFor="rappel-3" className="font-normal">Il ne peut pas encaisser de paiements sauf clause spéciale ✅</Label></div>
                    <div className="flex items-center space-x-2"><Checkbox checked={agenceData.rappelArticlesCodeCommerce} onCheckedChange={(v) => setAgenceData({...agenceData, rappelArticlesCodeCommerce: !!v})} id="rappel-4" disabled /><Label htmlFor="rappel-4" className="font-normal">Régi par les articles L134-1 à L134-17 du Code de commerce ✅</Label></div>
                  </div>
                </div>
                
                {/* 4. MANDAT & POUVOIRS */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Mandat & Pouvoirs de l'agent</h4>
                  <div className="space-y-3">
                    <div>
                      <Label className="font-medium">Pouvoirs accordés</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.pouvoirProspection} onCheckedChange={(v) => setAgenceData({...agenceData, pouvoirProspection: !!v})} id="pouv-1" /><Label htmlFor="pouv-1" className="font-normal">Prospection commerciale</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.pouvoirPresentation} onCheckedChange={(v) => setAgenceData({...agenceData, pouvoirPresentation: !!v})} id="pouv-2" /><Label htmlFor="pouv-2" className="font-normal">Présentation des produits</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.pouvoirNegociation} onCheckedChange={(v) => setAgenceData({...agenceData, pouvoirNegociation: !!v})} id="pouv-3" /><Label htmlFor="pouv-3" className="font-normal">Négociation des contrats</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.pouvoirConclusion} onCheckedChange={(v) => setAgenceData({...agenceData, pouvoirConclusion: !!v})} id="pouv-4" /><Label htmlFor="pouv-4" className="font-normal">Conclusion des contrats au nom du mandant (optionnel)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.pouvoirSalons} onCheckedChange={(v) => setAgenceData({...agenceData, pouvoirSalons: !!v})} id="pouv-5" /><Label htmlFor="pouv-5" className="font-normal">Participation aux salons / événements</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.pouvoirReporting} onCheckedChange={(v) => setAgenceData({...agenceData, pouvoirReporting: !!v})} id="pouv-6" /><Label htmlFor="pouv-6" className="font-normal">Reporting commercial</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">Pouvoirs interdits (standards)</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.interdictionModifTarifs} onCheckedChange={(v) => setAgenceData({...agenceData, interdictionModifTarifs: !!v})} id="int-1" disabled /><Label htmlFor="int-1" className="font-normal">Modifier les tarifs ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.interdictionRemises} onCheckedChange={(v) => setAgenceData({...agenceData, interdictionRemises: !!v})} id="int-2" disabled /><Label htmlFor="int-2" className="font-normal">Accorder des remises non autorisées ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.interdictionClausesNonApprouvees} onCheckedChange={(v) => setAgenceData({...agenceData, interdictionClausesNonApprouvees: !!v})} id="int-3" disabled /><Label htmlFor="int-3" className="font-normal">Engager la société sur des clauses non approuvées ✅</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.interdictionEncaissement} onCheckedChange={(v) => setAgenceData({...agenceData, interdictionEncaissement: !!v})} id="int-4" disabled /><Label htmlFor="int-4" className="font-normal">Encaisser des paiements (sauf autorisation écrite) ✅</Label></div>
                      </div>
                    </div>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <Label>Type de mandat *</Label>
                        <RadioGroup value={agenceData.mandatExclusif} onValueChange={(v) => setAgenceData({...agenceData, mandatExclusif: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="exclusif" id="mand-exc" /><Label htmlFor="mand-exc">Exclusif</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non_exclusif" id="mand-non" /><Label htmlFor="mand-non">Non exclusif</Label></div>
                        </RadioGroup>
                      </div>
                      <div>
                        <Label>Possibilité de sous-agents</Label>
                        <RadioGroup value={agenceData.possibiliteSousAgents} onValueChange={(v) => setAgenceData({...agenceData, possibiliteSousAgents: v})}>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="sa-yes" /><Label htmlFor="sa-yes">Oui</Label></div>
                          <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="sa-no" /><Label htmlFor="sa-no">Non</Label></div>
                        </RadioGroup>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 5. EXCLUSIVITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Exclusivité (si applicable)</h4>
                  <div className="space-y-3">
                    <div>
                      <Label className="font-medium">Exclusivité accordée à l'agent</Label>
                      <div className="space-y-2 mt-2">
                        <div><Label>Zone géographique</Label><Input value={agenceData.exclusiviteZone} onChange={(e) => setAgenceData({...agenceData, exclusiviteZone: e.target.value})} placeholder="Ex: Ile-de-France, Sud-Est..." /></div>
                        <div><Label>Marché / Secteur</Label><Input value={agenceData.exclusiviteSecteur} onChange={(e) => setAgenceData({...agenceData, exclusiviteSecteur: e.target.value})} placeholder="Ex: Secteur industriel" /></div>
                        <div><Label>Gamme de produits</Label><Input value={agenceData.exclusiviteGamme} onChange={(e) => setAgenceData({...agenceData, exclusiviteGamme: e.target.value})} placeholder="Ex: Gamme Premium uniquement" /></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">Exclusivité accordée au mandant</Label>
                      <div className="space-y-2 mt-2">
                        <div>
                          <Label>Interdiction pour l'agent de représenter un concurrent</Label>
                          <RadioGroup value={agenceData.exclusiviteMandantInterdictionConcurrent} onValueChange={(v) => setAgenceData({...agenceData, exclusiviteMandantInterdictionConcurrent: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="excl-conc-oui" /><Label htmlFor="excl-conc-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="excl-conc-non" /><Label htmlFor="excl-conc-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                        <div>
                          <Label>Interdiction de proposer des produits concurrents</Label>
                          <RadioGroup value={agenceData.exclusiviteMandantInterdictionProduitsConcurrents} onValueChange={(v) => setAgenceData({...agenceData, exclusiviteMandantInterdictionProduitsConcurrents: v})}>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="oui" id="excl-prod-oui" /><Label htmlFor="excl-prod-oui">Oui</Label></div>
                            <div className="flex items-center space-x-2"><RadioGroupItem value="non" id="excl-prod-non" /><Label htmlFor="excl-prod-non">Non</Label></div>
                          </RadioGroup>
                        </div>
                      </div>
                    </div>
                    <div><Label>Volume ou objectifs minimaux</Label><Textarea value={agenceData.objectifsMinimaux} onChange={(e) => setAgenceData({...agenceData, objectifsMinimaux: e.target.value})} placeholder="Objectifs chiffrés, quotas..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 6. OBLIGATIONS DE L'AGENT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations de l'agent</h4>
                  <div className="space-y-3">
                    <div><Label>Prospecter activement</Label><Textarea value={agenceData.obligationProspecter} onChange={(e) => setAgenceData({...agenceData, obligationProspecter: e.target.value})} placeholder="Modalités de prospection..." className="min-h-[60px]" /></div>
                    <div><Label>Promouvoir selon l'image de marque</Label><Textarea value={agenceData.obligationPromouvoir} onChange={(e) => setAgenceData({...agenceData, obligationPromouvoir: e.target.value})} placeholder="Respect de la charte graphique, communication..." className="min-h-[60px]" /></div>
                    <div><Label>Respecter la politique commerciale</Label><Textarea value={agenceData.obligationPolitiqueCommerciale} onChange={(e) => setAgenceData({...agenceData, obligationPolitiqueCommerciale: e.target.value})} placeholder="Règles de tarification, remises..." className="min-h-[60px]" /></div>
                    <div><Label>Informer le mandant des opportunités</Label><Textarea value={agenceData.obligationInformer} onChange={(e) => setAgenceData({...agenceData, obligationInformer: e.target.value})} placeholder="Transmission des leads, alertes marché..." className="min-h-[60px]" /></div>
                    <div><Label>Fréquence du reporting</Label><Input value={agenceData.obligationReportingFrequence} onChange={(e) => setAgenceData({...agenceData, obligationReportingFrequence: e.target.value})} placeholder="Hebdomadaire, mensuel..." /></div>
                    <div><Label>Respecter la confidentialité</Label><Textarea value={agenceData.obligationConfidentialite} onChange={(e) => setAgenceData({...agenceData, obligationConfidentialite: e.target.value})} placeholder="Non-divulgation informations..." className="min-h-[60px]" /></div>
                    <div><Label>Absence de conflits d'intérêts</Label><Textarea value={agenceData.obligationNonConflit} onChange={(e) => setAgenceData({...agenceData, obligationNonConflit: e.target.value})} placeholder="Incompatibilités..." className="min-h-[60px]" /></div>
                    <div><Label>Non-concurrence (si applicable)</Label><Textarea value={agenceData.obligationNonConcurrence} onChange={(e) => setAgenceData({...agenceData, obligationNonConcurrence: e.target.value})} placeholder="Restrictions concurrentielles..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 7. OBLIGATIONS DU MANDANT */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Obligations du mandant</h4>
                  <div className="space-y-3">
                    <div><Label>Remettre catalogues, tarifs, documentation</Label><Textarea value={agenceData.obligationCatalogues} onChange={(e) => setAgenceData({...agenceData, obligationCatalogues: e.target.value})} placeholder="Documents fournis à l'agent..." className="min-h-[60px]" /></div>
                    <div><Label>Informer des modifications tarifaires</Label><Textarea value={agenceData.obligationInformerModifs} onChange={(e) => setAgenceData({...agenceData, obligationInformerModifs: e.target.value})} placeholder="Délai de notification..." className="min-h-[60px]" /></div>
                    <div><Label>Fournir un support technique</Label><Textarea value={agenceData.obligationSupportTechnique} onChange={(e) => setAgenceData({...agenceData, obligationSupportTechnique: e.target.value})} placeholder="Assistance, formation..." className="min-h-[60px]" /></div>
                    <div><Label>Respecter l'exclusivité (si applicable)</Label><Textarea value={agenceData.obligationRespecterExclusivite} onChange={(e) => setAgenceData({...agenceData, obligationRespecterExclusivite: e.target.value})} placeholder="Ne pas court-circuiter l'agent..." className="min-h-[60px]" /></div>
                    <div><Label>Payer les commissions</Label><Textarea value={agenceData.obligationPayerCommissions} onChange={(e) => setAgenceData({...agenceData, obligationPayerCommissions: e.target.value})} placeholder="Délais de paiement..." className="min-h-[60px]" /></div>
                    <div><Label>Informer des opérations commerciales</Label><Textarea value={agenceData.obligationInformerOperations} onChange={(e) => setAgenceData({...agenceData, obligationInformerOperations: e.target.value})} placeholder="Ventes directes sur la zone..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 8. COMMISSIONNEMENT */}
                <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                  <h4 className="font-semibold text-lg text-green-700">Commissionnement (POINT CLÉ)</h4>
                  <div className="p-3 bg-green-100 rounded border border-green-300">
                    <p className="text-xs text-green-800">💰 Élément essentiel du contrat - définir précisément les modalités</p>
                  </div>
                  <div className="space-y-3">
                    <div>
                      <Label className="font-medium">A. Type de commission *</Label>
                      <RadioGroup value={agenceData.commissionType} onValueChange={(v) => setAgenceData({...agenceData, commissionType: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="pourcentage" id="comm-pct" /><Label htmlFor="comm-pct">Pourcentage sur CA</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="fixe" id="comm-fix" /><Label htmlFor="comm-fix">Montant fixe par contrat</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="degressif" id="comm-deg" /><Label htmlFor="comm-deg">Tarifs dégressifs</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="progressif" id="comm-prog" /><Label htmlFor="comm-prog">Tarifs progressifs</Label></div>
                      </RadioGroup>
                    </div>
                    {agenceData.commissionType === "pourcentage" && (
                      <div><Label>Pourcentage *</Label><Input value={agenceData.commissionPourcentage} onChange={(e) => setAgenceData({...agenceData, commissionPourcentage: e.target.value})} placeholder="Ex: 10%" /></div>
                    )}
                    {agenceData.commissionType === "fixe" && (
                      <div><Label>Montant fixe *</Label><Input value={agenceData.commissionMontantFixe} onChange={(e) => setAgenceData({...agenceData, commissionMontantFixe: e.target.value})} placeholder="Ex: 500 € par contrat" /></div>
                    )}
                    <div><Label>Commissions différentes par gamme</Label><Textarea value={agenceData.commissionGammes} onChange={(e) => setAgenceData({...agenceData, commissionGammes: e.target.value})} placeholder="Détail par produit/service..." className="min-h-[60px]" /></div>
                    <div>
                      <Label className="font-medium">B. Sur quelles ventes ?</Label>
                      <div className="space-y-2 mt-2">
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.commissionVentesAgent} onCheckedChange={(v) => setAgenceData({...agenceData, commissionVentesAgent: !!v})} id="vente-1" /><Label htmlFor="vente-1" className="font-normal">Ventes conclues par l'agent</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.commissionVentesMandant} onCheckedChange={(v) => setAgenceData({...agenceData, commissionVentesMandant: !!v})} id="vente-2" /><Label htmlFor="vente-2" className="font-normal">Ventes conclues par le mandant sur la zone de l'agent (obligatoire légalement)</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.commissionRenouvellements} onCheckedChange={(v) => setAgenceData({...agenceData, commissionRenouvellements: !!v})} id="vente-3" /><Label htmlFor="vente-3" className="font-normal">Renouvellements de contrats</Label></div>
                        <div className="flex items-center space-x-2"><Checkbox checked={agenceData.commissionAugmentations} onCheckedChange={(v) => setAgenceData({...agenceData, commissionAugmentations: !!v})} id="vente-4" /><Label htmlFor="vente-4" className="font-normal">Augmentations de volume</Label></div>
                      </div>
                    </div>
                    <div>
                      <Label className="font-medium">C. Moment où la commission est due *</Label>
                      <RadioGroup value={agenceData.commissionMomentDue} onValueChange={(v) => setAgenceData({...agenceData, commissionMomentDue: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="conclusion" id="moment-1" /><Label htmlFor="moment-1">À la conclusion du contrat</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="paiement" id="moment-2" /><Label htmlFor="moment-2">Au paiement par le client</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="expedition" id="moment-3" /><Label htmlFor="moment-3">À l'expédition des produits</Label></div>
                      </RadioGroup>
                    </div>
                    <div>
                      <Label className="font-medium">D. Périodicité de paiement *</Label>
                      <RadioGroup value={agenceData.commissionPeriodicite} onValueChange={(v) => setAgenceData({...agenceData, commissionPeriodicite: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="mensuelle" id="period-1" /><Label htmlFor="period-1">Mensuelle</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="trimestrielle" id="period-2" /><Label htmlFor="period-2">Trimestrielle</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>E. Droit à l'information</Label><Textarea value={agenceData.commissionDroitInformation} onChange={(e) => setAgenceData({...agenceData, commissionDroitInformation: e.target.value})} placeholder="Liste des contrats conclus, montants facturés et encaissés..." className="min-h-[80px]" /></div>
                  </div>
                </div>
                
                {/* 9. NON-CONCURRENCE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Clause de non-concurrence (optionnelle mais fréquente)</h4>
                  <div className="space-y-3">
                    <div><Label>Avant résiliation (pendant le contrat)</Label><Textarea value={agenceData.nonConcurrenceAvant} onChange={(e) => setAgenceData({...agenceData, nonConcurrenceAvant: e.target.value})} placeholder="Interdiction de représenter des produits concurrents..." className="min-h-[60px]" /></div>
                    <div className="p-3 bg-orange-50 rounded border border-orange-200">
                      <p className="text-xs text-orange-700">⚠️ Après résiliation : durée max 2 ans (obligation légale)</p>
                    </div>
                    <div><Label>Durée après résiliation (max 2 ans)</Label><Input value={agenceData.nonConcurrenceApresDuree} onChange={(e) => setAgenceData({...agenceData, nonConcurrenceApresDuree: e.target.value})} placeholder="Ex: 12 mois, 24 mois" /></div>
                    <div><Label>Zone géographique concernée</Label><Input value={agenceData.nonConcurrenceApresZone} onChange={(e) => setAgenceData({...agenceData, nonConcurrenceApresZone: e.target.value})} placeholder="Ex: Ile-de-France" /></div>
                    <div><Label>Secteur concerné</Label><Input value={agenceData.nonConcurrenceApresSecteur} onChange={(e) => setAgenceData({...agenceData, nonConcurrenceApresSecteur: e.target.value})} placeholder="Secteur d'activité" /></div>
                    <div><Label>Compensation financière (optionnelle)</Label><Textarea value={agenceData.nonConcurrenceCompensation} onChange={(e) => setAgenceData({...agenceData, nonConcurrenceCompensation: e.target.value})} placeholder="Indemnité compensatrice..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 10. RESPONSABILITÉ & ASSURANCE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">🔟 Responsabilité & Assurance</h4>
                  <div className="space-y-3">
                    <div><Label>Responsabilité de l'agent</Label><Textarea value={agenceData.responsabiliteAgent} onChange={(e) => setAgenceData({...agenceData, responsabiliteAgent: e.target.value})} placeholder="Responsable de ses fautes professionnelles, doit être assuré en RC Pro..." className="min-h-[80px]" /></div>
                    <div><Label>Responsabilité du mandant</Label><Textarea value={agenceData.responsabiliteMandant} onChange={(e) => setAgenceData({...agenceData, responsabiliteMandant: e.target.value})} placeholder="Responsable des défauts produits, de la politique tarifaire..." className="min-h-[80px]" /></div>
                    <div><Label>Exclusions de responsabilité</Label><Textarea value={agenceData.exclusionsResponsabilite} onChange={(e) => setAgenceData({...agenceData, exclusionsResponsabilite: e.target.value})} placeholder="Perte de clients, dommages indirects..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 11. CONFIDENTIALITÉ */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Confidentialité</h4>
                  <div className="space-y-3">
                    <div><Label>Obligation pendant le contrat</Label><Textarea value={agenceData.confidentialitePendant} onChange={(e) => setAgenceData({...agenceData, confidentialitePendant: e.target.value})} placeholder="Non-divulgation des informations confidentielles..." className="min-h-[60px]" /></div>
                    <div><Label>Obligation après le contrat</Label><Textarea value={agenceData.confidentialiteApres} onChange={(e) => setAgenceData({...agenceData, confidentialiteApres: e.target.value})} placeholder="Durée de maintien de la confidentialité..." className="min-h-[60px]" /></div>
                    <div><Label>Interdiction de divulguer données sensibles</Label><Textarea value={agenceData.confidentialiteDonneesSensibles} onChange={(e) => setAgenceData({...agenceData, confidentialiteDonneesSensibles: e.target.value})} placeholder="Liste des données sensibles..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 12. PROPRIÉTÉ INTELLECTUELLE */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Propriété intellectuelle</h4>
                  <div className="space-y-3">
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.piInterdictionMarques} onCheckedChange={(v) => setAgenceData({...agenceData, piInterdictionMarques: !!v})} id="pi-marques" disabled />
                      <Label htmlFor="pi-marques" className="font-normal">Interdiction d'utiliser les marques sans autorisation ✅</Label>
                    </div>
                    <div><Label>Licence limitée et non exclusive</Label><Textarea value={agenceData.piLicenceLimitee} onChange={(e) => setAgenceData({...agenceData, piLicenceLimitee: e.target.value})} placeholder="Droit d'utilisation limité à l'exécution du contrat..." className="min-h-[60px]" /></div>
                    <div><Label>Restitution du matériel marketing</Label><Textarea value={agenceData.piRestitutionMateriel} onChange={(e) => setAgenceData({...agenceData, piRestitutionMateriel: e.target.value})} placeholder="Restitution à la fin du contrat..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 13. DONNÉES PERSONNELLES / RGPD */}
                <div className="space-y-4 p-4 bg-purple-50/50 rounded-lg border border-purple-200">
                  <h4 className="font-semibold text-lg text-purple-700">Données personnelles / RGPD</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Statut de l'agent *</Label>
                      <RadioGroup value={agenceData.rgpdStatutAgent} onValueChange={(v) => setAgenceData({...agenceData, rgpdStatutAgent: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="responsable" id="rgpd-resp" /><Label htmlFor="rgpd-resp">Responsable de traitement</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="sous-traitant" id="rgpd-st" /><Label htmlFor="rgpd-st">Sous-traitant</Label></div>
                      </RadioGroup>
                    </div>
                    <div><Label>Données traitées</Label><Textarea value={agenceData.rgpdDonneesTraitees} onChange={(e) => setAgenceData({...agenceData, rgpdDonneesTraitees: e.target.value})} placeholder="Types de données collectées..." className="min-h-[60px]" /></div>
                    <div><Label>Finalités</Label><Textarea value={agenceData.rgpdFinalites} onChange={(e) => setAgenceData({...agenceData, rgpdFinalites: e.target.value})} placeholder="Objectifs du traitement..." className="min-h-[60px]" /></div>
                    <div><Label>Durées de conservation</Label><Input value={agenceData.rgpdDurees} onChange={(e) => setAgenceData({...agenceData, rgpdDurees: e.target.value})} placeholder="Ex: 3 ans après fin de relation" /></div>
                    <div><Label>Mesures de sécurité</Label><Textarea value={agenceData.rgpdMesuresSecurite} onChange={(e) => setAgenceData({...agenceData, rgpdMesuresSecurite: e.target.value})} placeholder="Chiffrement, accès restreints..." className="min-h-[60px]" /></div>
                    <div><Label>DPO du mandant (si applicable)</Label><Input value={agenceData.rgpdDPO} onChange={(e) => setAgenceData({...agenceData, rgpdDPO: e.target.value})} placeholder="Nom et contact du DPO" /></div>
                  </div>
                </div>
                
                {/* 14. DURÉE & RÉSILIATION */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Durée & Résiliation</h4>
                  <div className="space-y-3">
                    <div>
                      <Label>Type de durée *</Label>
                      <RadioGroup value={agenceData.dureeDeterminee} onValueChange={(v) => setAgenceData({...agenceData, dureeDeterminee: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="determinee" id="dur-det" /><Label htmlFor="dur-det">Durée déterminée</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="indeterminee" id="dur-ind" /><Label htmlFor="dur-ind">Durée indéterminée</Label></div>
                      </RadioGroup>
                    </div>
                    {agenceData.dureeDeterminee === 'determinee' && (
                      <div><Label>Durée initiale</Label><Input value={agenceData.dureeInitiale} onChange={(e) => setAgenceData({...agenceData, dureeInitiale: e.target.value})} placeholder="Ex: 2 ans" /></div>
                    )}
                    <div>
                      <Label>Reconduction</Label>
                      <RadioGroup value={agenceData.dureeReconduction} onValueChange={(v) => setAgenceData({...agenceData, dureeReconduction: v})}>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="tacite" id="rec-tac" /><Label htmlFor="rec-tac">Tacite</Label></div>
                        <div className="flex items-center space-x-2"><RadioGroupItem value="expresse" id="rec-exp" /><Label htmlFor="rec-exp">Expresse</Label></div>
                      </RadioGroup>
                    </div>
                    <div className="p-3 bg-orange-50 rounded border border-orange-200">
                      <p className="text-xs text-orange-700 font-semibold">⚠️ Préavis légaux OBLIGATOIRES (Code de commerce L134-12) :</p>
                      <ul className="text-xs text-orange-700 mt-1 ml-4 list-disc">
                        <li>1ère année : 1 mois minimum</li>
                        <li>2ème année : 2 mois minimum</li>
                        <li>3ème année et + : 3 mois minimum</li>
                      </ul>
                    </div>
                    <div className="grid grid-cols-3 gap-3">
                      <div><Label>Préavis 1ère année</Label><Input value="1 mois" disabled /></div>
                      <div><Label>Préavis 2ème année</Label><Input value="2 mois" disabled /></div>
                      <div><Label>Préavis 3ème année et +</Label><Input value="3 mois et plus" disabled /></div>
                    </div>
                    <div><Label>Résiliation immédiate (cas limitatifs)</Label>
                      <div className="mt-2 space-y-2">
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={agenceData.resiliationFauteGrave} onCheckedChange={(v) => setAgenceData({...agenceData, resiliationFauteGrave: !!v})} id="res-faute" disabled />
                          <Label htmlFor="res-faute" className="font-normal">Faute grave ✅</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={agenceData.resiliationNonRespect} onCheckedChange={(v) => setAgenceData({...agenceData, resiliationNonRespect: !!v})} id="res-nonresp" disabled />
                          <Label htmlFor="res-nonresp" className="font-normal">Non-respect obligations contractuelles ✅</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={agenceData.resiliationCessation} onCheckedChange={(v) => setAgenceData({...agenceData, resiliationCessation: !!v})} id="res-cess" disabled />
                          <Label htmlFor="res-cess" className="font-normal">Cessation d'activité du mandant ✅</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <Checkbox checked={agenceData.resiliationLiquidation} onCheckedChange={(v) => setAgenceData({...agenceData, resiliationLiquidation: !!v})} id="res-liq" disabled />
                          <Label htmlFor="res-liq" className="font-normal">Liquidation judiciaire ✅</Label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 15. INDEMNITÉ LÉGALE FIN DE CONTRAT */}
                <div className="space-y-4 p-4 bg-orange-50 rounded-lg border border-orange-300">
                  <h4 className="font-semibold text-lg text-orange-700">Indemnité légale de fin de contrat ⚠️ OBLIGATOIRE !!!</h4>
                  <div className="p-3 bg-orange-100 rounded border border-orange-400">
                    <p className="text-sm text-orange-800 font-semibold">🚨 ÉLÉMENT CLÉ du contrat d'agent commercial</p>
                    <p className="text-xs text-orange-700 mt-1">Indemnité généralement fixée à 2 années de commissions (sauf faute grave). C'est une obligation légale impérative (L134-12 Code de commerce).</p>
                  </div>
                  <div className="space-y-3">
                    <div><Label>Montant de l'indemnité</Label><Input value={agenceData.indemniteMontant} onChange={(e) => setAgenceData({...agenceData, indemniteMontant: e.target.value})} placeholder="Ex: 2 années de commissions moyennes" disabled /></div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.indemniteSaufFauteGrave} onCheckedChange={(v) => setAgenceData({...agenceData, indemniteSaufFauteGrave: !!v})} id="ind-faute" disabled />
                      <Label htmlFor="ind-faute" className="font-normal">Sauf en cas de faute grave de l'agent ✅</Label>
                    </div>
                    <div><Label>Délai de paiement</Label><Textarea value={agenceData.indemniteDelai} onChange={(e) => setAgenceData({...agenceData, indemniteDelai: e.target.value})} placeholder="Dans un délai raisonnable après la fin du contrat..." className="min-h-[60px]" /></div>
                  </div>
                </div>
                
                {/* 16. FORMALITÉS & ANNEXES */}
                <div className="space-y-4 p-4 bg-blue-50/50 rounded-lg border border-blue-200">
                  <h4 className="font-semibold text-lg text-gray-700">Formalités & Annexes</h4>
                  <div className="space-y-2">
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexeTarifs} onCheckedChange={(v) => setAgenceData({...agenceData, annexeTarifs: !!v})} id="ann-tarifs" />
                      <Label htmlFor="ann-tarifs" className="font-normal">Annexe : Tarifs et prix publics</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexeCatalogue} onCheckedChange={(v) => setAgenceData({...agenceData, annexeCatalogue: !!v})} id="ann-cat" />
                      <Label htmlFor="ann-cat" className="font-normal">Annexe : Catalogue produits</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexePolitiqueCommerciale} onCheckedChange={(v) => setAgenceData({...agenceData, annexePolitiqueCommerciale: !!v})} id="ann-pol" />
                      <Label htmlFor="ann-pol" className="font-normal">Annexe : Politique commerciale</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexeFichesProduits} onCheckedChange={(v) => setAgenceData({...agenceData, annexeFichesProduits: !!v})} id="ann-fiches" />
                      <Label htmlFor="ann-fiches" className="font-normal">Annexe : Fiches produits</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexeReporting} onCheckedChange={(v) => setAgenceData({...agenceData, annexeReporting: !!v})} id="ann-rep" />
                      <Label htmlFor="ann-rep" className="font-normal">Annexe : Modèle de reporting</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexeHistorique} onCheckedChange={(v) => setAgenceData({...agenceData, annexeHistorique: !!v})} id="ann-hist" />
                      <Label htmlFor="ann-hist" className="font-normal">Annexe : Historique des commissions</Label>
                    </div>
                    <div className="flex items-center space-x-2">
                      <Checkbox checked={agenceData.annexeRSAC} onCheckedChange={(v) => setAgenceData({...agenceData, annexeRSAC: !!v})} id="ann-rsac" />
                      <Label htmlFor="ann-rsac" className="font-normal">Annexe : Extrait RSAC de l'agent</Label>
                    </div>
                  </div>
                </div>
                
                {/* 17. PIÈCES JUSTIFICATIVES */}
                <div className="space-y-4 p-4 bg-green-50/50 rounded-lg border border-green-200">
                  <h4 className="font-semibold text-lg text-green-700">Pièces justificatives requises</h4>
                  <div className="space-y-4">
                    <div className="space-y-3">
                      <p className="text-sm font-semibold">Côté mandant :</p>
                      <SingleFileUpload label="Extrait Kbis" files={agenceMandantKbisFiles} onFilesChange={setAgenceMandantKbisFiles} role="avocat" />
                      <SingleFileUpload label="Politique commerciale" files={agenceMandantPolitiqueFiles} onFilesChange={setAgenceMandantPolitiqueFiles} role="avocat" />
                      <SingleFileUpload label="Catalogue" files={agenceMandantCatalogueFiles} onFilesChange={setAgenceMandantCatalogueFiles} role="avocat" />
                      <SingleFileUpload label="Grille tarifaire" files={agenceMandantTarifsFiles} onFilesChange={setAgenceMandantTarifsFiles} role="avocat" />
                    </div>
                    <div className="space-y-3">
                      <p className="text-sm font-semibold">Côté agent commercial :</p>
                      <SingleFileUpload label="Extrait Kbis RSAC (obligatoire)" files={agenceAgentRSACFiles} onFilesChange={setAgenceAgentRSACFiles} role="avocat" required />
                      <SingleFileUpload label="Attestation RC Pro" files={agenceAgentRCProFiles} onFilesChange={setAgenceAgentRCProFiles} role="avocat" />
                      <SingleFileUpload label="Pièce d'identité si personne physique" files={agenceAgentIdentiteFiles} onFilesChange={setAgenceAgentIdentiteFiles} role="avocat" />
                    </div>
                    <div className="space-y-2">
                      <p className="text-sm font-semibold">Annexes générales :</p>
                      <MultiFileUpload files={agenceAnnexesFiles} onFilesChange={setAgenceAnnexesFiles} label="Autres annexes (plusieurs fichiers possibles)" role="avocat" />
                    </div>
                  </div>
                </div>

              </div>
            )}

          </div>

          <div className="flex justify-end gap-3 mt-6 pt-4 border-t">
            <Button 
              type="button"
              variant="outline"
              className={role === 'notaire' ? 'border-orange-600 text-orange-600 hover:text-orange-600 hover:bg-orange-50' : 'border-blue-600 text-gray-700 hover:text-gray-700 hover:bg-blue-50'}
              onClick={(e) => {
                e.preventDefault();
                e.stopPropagation();
                setShowQuestionDialog(false);
              }}
            >
              Annuler
            </Button>
            <Button 
              type="button"
              className={role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700' : 'bg-blue-600 hover:bg-blue-700'}
              onClick={(e) => {
                e.preventDefault();
                e.stopPropagation();
                if (pendingContractType === "Compromis de vente / Promesse unilatérale de vente") {
                  handleQuestionnaireSubmit();
                } else if (pendingContractType === "Acte de vente immobilière") {
                  handleActeVenteSubmit();
                } else if (pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé") {
                  handleBailHabitationSubmit();
                } else if (pendingContractType === "Bail commercial / professionnel") {
                  handleBailCommercialSubmit();
                } else if (pendingContractType === "Convention d'indivision") {
                  handleIndivisionSubmit();
                } else if (pendingContractType === "Mainlevée d'hypothèque") {
                  handleMainleveeSubmit();
                } else if (pendingContractType === "Contrat de mariage (régimes matrimoniaux)") {
                  handleContratMariageSubmit();
                } else if (pendingContractType === "PACS (convention + enregistrement)") {
                  handlePacsSubmit();
                } else if (pendingContractType === "Donation entre époux") {
                  handleDonationEntreEpouxSubmit();
                } else if (pendingContractType === "Donation simple (parent → enfant, etc.)") {
                  handleDonationSimpleSubmit();
                } else if (pendingContractType === "Testament authentique ou mystique") {
                  handleTestamentSubmit();
                } else if (pendingContractType === "Changement de régime matrimonial") {
                  handleChangementRegimeSubmit();
                } else if (pendingContractType === "Déclaration de succession") {
                  handleSuccessionSubmit();
                } else if (pendingContractType === "Acte de notoriété") {
                  handleActeNotorieteSubmit();
                } else if (pendingContractType === "Partage successoral") {
                  handlePartageSuccessoralSubmit();
                } else if (pendingContractType === "Procuration authentique") {
                  handleProcurationSubmit();
                } else if (pendingContractType === "Mandat de protection future") {
                  handleMandatProtectionSubmit();
                } else if (pendingContractType === "Attestation de propriété immobilière") {
                  handleAttestationSubmit();
                } else if (pendingContractType === "Quitus / reconnaissance de dette") {
                  handleQuitusDetteSubmit();
                } else if (pendingContractType === "Acte de cession de parts sociales") {
                  handleCessionPartsSubmit();
                } else if (pendingContractType.includes("CGU") && pendingContractType.toLowerCase().includes("saas")) {
                  handleCGUSubmit();
                } else if (pendingContractType.includes("agence commerciale")) {
                  handleAgenceCommercialeSubmit();
                } else if (pendingContractType === "NDA (Accord de confidentialité)") {
                  handleCreateNdaContract();
                } else if (pendingContractType === "Cession de marque / cession de droits de propriété intellectuelle") {
                  handleCreateCessionPiContract();
                } else if (pendingContractType === "Contrat de travail (CDD/CDI)") {
                  handleCreateContratTravailContract();
                } else if (pendingContractType === "Convention de stage") {
                  handleCreateConventionStageContract();
                } else if (pendingContractType === "Rupture conventionnelle") {
                  handleCreateRuptureConventionnelleContract();
                } else if (pendingContractType === "Avenants au contrat de travail") {
                  handleCreateAvenantContratTravailContract();
                } else if (pendingContractType === "Accords de confidentialité employé") {
                  handleCreateAccordConfidentialiteContract();
                } else if (pendingContractType === "Politique RGPD interne (annexes)") {
                  handleCreatePolitiqueRGPDContract();
                } else if (pendingContractType === "État des lieux (annexe)") {
                  handleEtatLieuxSubmit();
                } else if (pendingContractType === "Mise en demeure de payer le loyer / autres obligations") {
                  handleMiseEnDemeureSubmit();
                } else if (pendingContractType === "Pacte de concubinage") {
                  handlePacteConcubinageSubmit();
                } else if (pendingContractType === "Convention parentale") {
                  handleConventionParentaleSubmit();
                } else if (pendingContractType === "Reconnaissance de dettes") {
                  handleReconnaissanceDetteSubmit();
                } else if (pendingContractType === "Mandat de protection future sous seing privé") {
                  handleMandatProtectionSousSeingSubmit();
                } else if (["Contrat de prestation de services", "Contrat de vente B2B / distribution", "Conditions Générales de Vente (CGV)", "Contrat de franchise", "Contrat de partenariat / coopération", "Testament olographe + accompagnement au dépôt", "Contrat de cession de droits d'auteur", "Licence logicielle", "Contrat de développement web / application", "Politique de confidentialité / mentions légales / RGPD"].includes(pendingContractType)) {
                  handleGenericContractSubmit();
                } else {
                  // Pour tous les autres types, utiliser le formulaire générique
                  handleGenericContractSubmit();
                }
              }}
            >
              Créer le contrat
            </Button>
          </div>
        </DialogContent>
      </Dialog>
    </AppLayout>
  );
}
