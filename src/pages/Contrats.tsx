import { AppLayout } from "@/components/layout/AppLayout";
import { Button } from "@/components/ui/button";
import { Eye, Search, MoreHorizontal, Trash2, Plus, ArrowRight, Upload } from "lucide-react";
import { useLocation, useNavigate } from "react-router-dom";
import { useAuth } from "@/contexts/AuthContext";
import { useEffect, useState } from "react";
import { supabase } from "@/lib/supabaseClient";
import { NOTAIRE_CONTRACT_CATEGORIES } from "@/components/dashboard/ContractSelectorNotaire";
import { AVOCAT_CONTRACT_CATEGORIES } from "@/components/dashboard/ContractSelectorAvocat";
import { Input } from "@/components/ui/input";
import { Badge } from "@/components/ui/badge";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
} from "@/components/ui/dropdown-menu";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { RadioGroup, RadioGroupItem } from "@/components/ui/radio-group";
import { toast } from "sonner";
import { ShareToCollaborativeDialog } from "@/components/cabinet/ShareToCollaborativeDialog";

type ContratRow = {
  id: string;
  name: string;
  category: string;
  type: string;
  created_at: string;
  updated_at: string;
};

// Catégories filtrage dynamiques selon le rôle
const categoriesNotaire = [
  "Tous",
  "Immobilier",
  "Famille & Patrimoine",
  "Succession",
  "Procurations & Actes divers"
];

const categoriesAvocat = [
  "Tous",
  "Droit des affaires / Commercial",
  "Droit du travail",
  "Droit immobilier",
  "Droit civil / Vie privée",
  "Propriété intellectuelle & Numérique",
];

export default function Contrats() {
  const { user } = useAuth();
  const location = useLocation();
  const [loading, setLoading] = useState(true);
  const [contrats, setContrats] = useState<ContratRow[]>([]);
  const [search, setSearch] = useState("");
  const [categoryFilter, setCategoryFilter] = useState("Tous");
  const [debounced, setDebounced] = useState("");

  // Dialog questionnaire pour compromis de vente
  const [showQuestionDialog, setShowQuestionDialog] = useState(false);
  const [pendingContractType, setPendingContractType] = useState<string>("");
  const [pendingCategory, setPendingCategory] = useState<string>("");
  const [clients, setClients] = useState<Array<{id: string, nom: string, prenom: string, adresse: string, telephone?: string, email?: string, date_naissance?: string, lieu_naissance?: string, nationalite?: string, profession?: string, situation_matrimoniale?: string, situation_familiale?: string | {regime_matrimonial?: string, nombre_enfants?: string, personne_a_charge?: any}, type_identite?: string, numero_identite?: string, id_doc_path?: string}>>([]);

  // States pour les fichiers uploadés
  const [compromisClientIdentiteUrl, setCompromisClientIdentiteUrl] = useState<string | null>(null); // URL du document du client
  const [compromisAutrePartieFiles, setCompromisAutrePartieFiles] = useState<File[]>([]); // Fichiers de l'autre partie
  const [compromisDiagnosticsFiles, setCompromisDiagnosticsFiles] = useState<File[]>([]);
  const [acteClientIdentiteUrl, setActeClientIdentiteUrl] = useState<string | null>(null); // URL du document du client acte
  const [bailClientIdentiteUrl, setBailClientIdentiteUrl] = useState<string | null>(null); // URL du document du client bail
  const [bailCommercialBailleurClientIdentiteUrl, setBailCommercialBailleurClientIdentiteUrl] = useState<string | null>(null); // URL du document du bailleur bail commercial
  const [bailCommercialPreneurClientIdentiteUrl, setBailCommercialPreneurClientIdentiteUrl] = useState<string | null>(null); // URL du document du preneur bail commercial
  const [acteAutrePartieFiles, setActeAutrePartieFiles] = useState<File[]>([]); // Fichiers de l'autre partie acte
  const [acteVendeurFiles, setActeVendeurFiles] = useState<File[]>([]); // Fichiers supplémentaires vendeur
  const [acteAcheteurFiles, setActeAcheteurFiles] = useState<File[]>([]); // Fichiers supplémentaires acheteur
  const [acteDiagnosticsFiles, setActeDiagnosticsFiles] = useState<File[]>([]);
  const [locataireDocsFiles, setLocataireDocsFiles] = useState<File[]>([]);
  const [bailleurIdFiles, setBailleurIdFiles] = useState<File[]>([]); // Pièce d'identité bailleur
  const [locataireIdFiles, setLocataireIdFiles] = useState<File[]>([]); // Documents locataire
  const [inventaireMobilierFiles, setInventaireMobilierFiles] = useState<File[]>([]); // Inventaire mobilier PDF/images
  const [bailCommercialBailleurFiles, setBailCommercialBailleurFiles] = useState<File[]>([]); // Kbis/ID bailleur commercial
  const [bailCommercialLocataireFiles, setBailCommercialLocataireFiles] = useState<File[]>([]); // Kbis/ID locataire commercial
  const [bailCommercialDiagnosticsFiles, setBailCommercialDiagnosticsFiles] = useState<File[]>([]); // Diagnostics bail commercial
  const [bailCommercialCautionFiles, setBailCommercialCautionFiles] = useState<File[]>([]); // Acte de caution
  const [bailCommercialEtatLieuxFiles, setBailCommercialEtatLieuxFiles] = useState<File[]>([]); // État des lieux
  const [bailCommercialCautionIdFiles, setBailCommercialCautionIdFiles] = useState<File[]>([]); // Pièce d'identité caution
  const [bailCommercialAssuranceFiles, setBailCommercialAssuranceFiles] = useState<File[]>([]); // Attestation d'assurance
  const [bailProfessionnelOrdreFiles, setBailProfessionnelOrdreFiles] = useState<File[]>([]); // Attestation inscription ordre professionnel
  const [garantDocsFiles, setGarantDocsFiles] = useState<File[]>([]);
  const [bailDiagnosticsFiles, setBailDiagnosticsFiles] = useState<File[]>([]);
  
  // States pour convention d'indivision
  const [indivisairesIdentiteUrls, setIndivisairesIdentiteUrls] = useState<Record<number, string | null>>({}); // URLs des documents identité indivisaires clients
  const [indivisairesIdentiteFiles, setIndivisairesIdentiteFiles] = useState<Record<number, File[]>>({}); // Fichiers identité indivisaires non-clients
  const [indivisairesDomicileFiles, setIndivisairesDomicileFiles] = useState<Record<number, File[]>>({}); // Justificatifs domicile
  const [indivisairesContratMariageFiles, setIndivisairesContratMariageFiles] = useState<Record<number, File[]>>({}); // Contrats de mariage
  const [indivisairesLivretFamilleFiles, setIndivisairesLivretFamilleFiles] = useState<Record<number, File[]>>({}); // Livrets de famille
  const [indivisionTitreProprietFiles, setIndivisionTitreProprietFiles] = useState<File[]>([]); // Titre de propriété
  const [indivisionEvaluationFiles, setIndivisionEvaluationFiles] = useState<File[]>([]); // Évaluation/estimation
  const [indivisionCadastreFiles, setIndivisionCadastreFiles] = useState<File[]>([]); // Relevé cadastral
  const [indivisionDiagnosticsFiles, setIndivisionDiagnosticsFiles] = useState<File[]>([]); // Diagnostics
  const [indivisionBailFiles, setIndivisionBailFiles] = useState<File[]>([]); // Bail si bien loué
  const [indivisionProcurationFiles, setIndivisionProcurationFiles] = useState<File[]>([]); // Procurations
  const [indivisionMandatGerantFiles, setIndivisionMandatGerantFiles] = useState<File[]>([]); // Mandat du gérant
  const [indivisionAssuranceFiles, setIndivisionAssuranceFiles] = useState<File[]>([]); // Attestation d'assurance
  
  // States pour mainlevée d'hypothèque
  const [mainleveeCreancierMandatFiles, setMainleveeCreancierMandatFiles] = useState<File[]>([]); // Mandat représentant
  const [mainleveeCreancierKbisFiles, setMainleveeCreancierKbisFiles] = useState<File[]>([]); // KBIS
  const [mainleveeCreancierDelegationFiles, setMainleveeCreancierDelegationFiles] = useState<File[]>([]); // Délégation de pouvoir
  const [mainleveeCreancierIdentiteFiles, setMainleveeCreancierIdentiteFiles] = useState<File[]>([]); // Identité représentant
  const [mainleveeDebiteursIdentiteFiles, setMainleveeDebiteursIdentiteFiles] = useState<Record<number, File[]>>({}); // Identités débiteurs
  const [mainleveeDebiteursJustifDomicileFiles, setMainleveeDebiteursJustifDomicileFiles] = useState<Record<number, File[]>>({}); // Justif domicile
  const [mainleveeActeConstitutifFiles, setMainleveeActeConstitutifFiles] = useState<File[]>([]); // Acte constitutif
  const [mainleveeInscriptionHypothequeFiles, setMainleveeInscriptionHypothequeFiles] = useState<File[]>([]); // Inscription hypothécaire
  const [mainleveeAttestationRemboursementFiles, setMainleveeAttestationRemboursementFiles] = useState<File[]>([]); // Attestation remboursement
  
  // States pour contrat de mariage
  const [contratMariageEpoux1IdentiteFiles, setContratMariageEpoux1IdentiteFiles] = useState<File[]>([]); // Identité époux 1
  const [contratMariageEpoux2IdentiteFiles, setContratMariageEpoux2IdentiteFiles] = useState<File[]>([]); // Identité époux 2
  const [contratMariageEpoux1ActeNaissanceFiles, setContratMariageEpoux1ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance époux 1
  const [contratMariageEpoux2ActeNaissanceFiles, setContratMariageEpoux2ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance époux 2
  const [contratMariageEpoux1DomicileFiles, setContratMariageEpoux1DomicileFiles] = useState<File[]>([]); // Justif domicile époux 1
  const [contratMariageEpoux2DomicileFiles, setContratMariageEpoux2DomicileFiles] = useState<File[]>([]); // Justif domicile époux 2
  const [contratMariageContratInitialFiles, setContratMariageContratInitialFiles] = useState<File[]>([]); // Contrat mariage initial (si changement)
  const [contratMariageJustificatifMariageFiles, setContratMariageJustificatifMariageFiles] = useState<File[]>([]); // Justificatif mariage
  const [contratMariageAccordEnfantsFiles, setContratMariageAccordEnfantsFiles] = useState<File[]>([]); // Accord enfants majeurs
  const [contratMariageTitresProprieteFiles, setContratMariageTitresProprieteFiles] = useState<File[]>([]); // Titres propriété
  const [contratMariageEstimationBiensFiles, setContratMariageEstimationBiensFiles] = useState<File[]>([]); // Estimation biens
  const [contratMariageActeDecesFiles, setContratMariageActeDecesFiles] = useState<File[]>([]); // Acte décès (si veuf)
  const [contratMariageConsentementEnfantsFiles, setContratMariageConsentementEnfantsFiles] = useState<File[]>([]); // Consentement enfants majeurs
  const [contratMariageCertificatBansFiles, setContratMariageCertificatBansFiles] = useState<File[]>([]); // Certificat publication bans
  const [contratMariageDecisionJugeFiles, setContratMariageDecisionJugeFiles] = useState<File[]>([]); // Décision/autorisation judiciaire
  
  // State pour PACS - Pièces justificatives
  const [pacsPartenaire1IdentiteFiles, setPacsPartenaire1IdentiteFiles] = useState<File[]>([]); // Identité partenaire 1
  const [pacsPartenaire2IdentiteFiles, setPacsPartenaire2IdentiteFiles] = useState<File[]>([]); // Identité partenaire 2
  const [pacsPartenaire1ActeNaissanceFiles, setPacsPartenaire1ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance partenaire 1
  const [pacsPartenaire2ActeNaissanceFiles, setPacsPartenaire2ActeNaissanceFiles] = useState<File[]>([]); // Acte naissance partenaire 2
  const [pacsPartenaire1DomicileFiles, setPacsPartenaire1DomicileFiles] = useState<File[]>([]); // Justif domicile partenaire 1
  const [pacsPartenaire2DomicileFiles, setPacsPartenaire2DomicileFiles] = useState<File[]>([]); // Justif domicile partenaire 2
  const [pacsPartenaire1DivorceFiles, setPacsPartenaire1DivorceFiles] = useState<File[]>([]); // Jugement divorce partenaire 1
  const [pacsPartenaire2DivorceFiles, setPacsPartenaire2DivorceFiles] = useState<File[]>([]); // Jugement divorce partenaire 2
  const [pacsPartenaire1DecesFiles, setPacsPartenaire1DecesFiles] = useState<File[]>([]); // Acte décès conjoint précédent partenaire 1
  const [pacsPartenaire2DecesFiles, setPacsPartenaire2DecesFiles] = useState<File[]>([]); // Acte décès conjoint précédent partenaire 2
  const [pacsPartenaire1CertificatCoutumeFiles, setPacsPartenaire1CertificatCoutumeFiles] = useState<File[]>([]); // Certificat coutume étranger partenaire 1
  const [pacsPartenaire2CertificatCoutumeFiles, setPacsPartenaire2CertificatCoutumeFiles] = useState<File[]>([]); // Certificat coutume étranger partenaire 2
  const [pacsPartenaire1CertificatNonPacsFiles, setPacsPartenaire1CertificatNonPacsFiles] = useState<File[]>([]); // Certificat non-PACS étranger partenaire 1
  const [pacsPartenaire2CertificatNonPacsFiles, setPacsPartenaire2CertificatNonPacsFiles] = useState<File[]>([]); // Certificat non-PACS étranger partenaire 2
  const [pacsPartenaire1TraductionsFiles, setPacsPartenaire1TraductionsFiles] = useState<File[]>([]); // Traductions certifiées partenaire 1
  const [pacsPartenaire2TraductionsFiles, setPacsPartenaire2TraductionsFiles] = useState<File[]>([]); // Traductions certifiées partenaire 2
  
  // State pour Donation entre époux - Pièces justificatives
  const [donationEpoux1IdentiteFiles, setDonationEpoux1IdentiteFiles] = useState<File[]>([]); // Identité époux 1
  const [donationEpoux2IdentiteFiles, setDonationEpoux2IdentiteFiles] = useState<File[]>([]); // Identité époux 2
  const [donationEpoux1LivretFamilleFiles, setDonationEpoux1LivretFamilleFiles] = useState<File[]>([]); // Livret famille (époux 1 peut uploader)
  const [donationEpoux2LivretFamilleFiles, setDonationEpoux2LivretFamilleFiles] = useState<File[]>([]); // Livret famille (époux 2 peut uploader)
  const [donationEpoux1ActeMariageFiles, setDonationEpoux1ActeMariageFiles] = useState<File[]>([]); // Acte mariage
  const [donationEpoux2ActeMariageFiles, setDonationEpoux2ActeMariageFiles] = useState<File[]>([]); // Acte mariage (doublon pour symétrie)
  const [donationEpoux1ContratMariageFiles, setDonationEpoux1ContratMariageFiles] = useState<File[]>([]); // Contrat mariage si existant
  const [donationEpoux2ContratMariageFiles, setDonationEpoux2ContratMariageFiles] = useState<File[]>([]); // Contrat mariage
  const [donationEpoux1DomicileFiles, setDonationEpoux1DomicileFiles] = useState<File[]>([]); // Justificatif domicile époux 1
  const [donationEpoux2DomicileFiles, setDonationEpoux2DomicileFiles] = useState<File[]>([]); // Justificatif domicile époux 2
  const [donationTitresProprieteBiensFiles, setDonationTitresProprieteBiensFiles] = useState<File[]>([]); // Titres propriété biens immobiliers
  const [donationEstimationBiensFiles, setDonationEstimationBiensFiles] = useState<File[]>([]); // Estimations / évaluations
  const [donationHypothequesFiles, setDonationHypothequesFiles] = useState<File[]>([]); // Hypothèques
  const [donationSituationLocativeFiles, setDonationSituationLocativeFiles] = useState<File[]>([]); // Situation locative
  const [donationRIBFiles, setDonationRIBFiles] = useState<File[]>([]); // RIB pour donation financière
  const [donationCarteGriseFiles, setDonationCarteGriseFiles] = useState<File[]>([]); // Carte grise véhicule
  const [donationAutresDocumentsFiles, setDonationAutresDocumentsFiles] = useState<File[]>([]); // Autres documents
  
  // State pour Donation Simple (8 file types)
  const [donationSimpleDonateurIdentiteFiles, setDonationSimpleDonateurIdentiteFiles] = useState<File[]>([]);
  const [donationSimpleDonateurLivretFamilleFiles, setDonationSimpleDonateurLivretFamilleFiles] = useState<File[]>([]);
  const [donationSimpleDonateurDomicileFiles, setDonationSimpleDonateurDomicileFiles] = useState<File[]>([]);
  const [donationSimpleDonatairePieceIdentiteFiles, setDonationSimpleDonatairePieceIdentiteFiles] = useState<File[]>([]);
  const [donationSimpleDonataireDomicileFiles, setDonationSimpleDonataireDomicileFiles] = useState<File[]>([]);
  const [donationSimpleTitreProprieteFiles, setDonationSimpleTitreProprieteFiles] = useState<File[]>([]);
  const [donationSimpleEvaluationBienFiles, setDonationSimpleEvaluationBienFiles] = useState<File[]>([]);
  const [donationSimpleAutresDocumentsFiles, setDonationSimpleAutresDocumentsFiles] = useState<File[]>([]);

  // State pour Donation Simple
  const [donationSimpleData, setDonationSimpleData] = useState({
    // 1. Type de donation
    typeDonation: "", // biens_meubles / biens_immobiliers / sommes_argent / nue_propriete / usufruit / parts_sociales / manuelle / mixte
    donationAvecCharges: false,
    descriptionCharges: "",
    donationAvecReserveUsufruit: false,
    donationAvecDroitRetour: false,
    donationEffetImmediat: true,
    donationPresenteIrrevocable: true,
    
    // 2. Identité donateur
    donateur: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      situationFamiliale: "", // celibataire / marie / divorce / veuf / pacse
      regimeMatrimonial: "", // communaute / separation / participation_acquets
      situationFiscale: "",
    },
    
    // 3. Identité donataire
    donataire: {
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      adresseComplete: "",
      telephone: "",
      email: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      lienDonateur: "", // enfant / parent / frere_soeur / neveu_niece / cousin / ami / conjoint_pacse / autre
      lienDonateurAutrePrecision: "", // Si lienDonateur === "autre"
    },
    
    // 4. Enfants / héritiers du donateur
    nombreEnfants: "",
    enfants: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
    }],
    donationHorsPartSuccessorale: false,
    donationAvancementPart: false,
    
    // 5. Description des biens
    // A. Bien immobilier
    bienImmobilier: {
      adresseComplete: "",
      natureBien: "", // maison / appartement / terrain / dependances
      designationCadastrale: "",
      sectionCadastrale: "",
      numeroCadastral: "",
      contenance: "",
      descriptionDetaille: "",
      situationLocative: "", // libre / loue
      valeurVenale: "",
      existenceHypotheques: false,
      montantHypotheques: "",
      repartitionUsufruit: "",
      repartitionNuePropriete: "",
    },
    
    // B. Bien mobilier corporel
    bienMobilier: {
      descriptionPrecise: "",
      numeroSerie: "",
      valeurEstimee: "",
      factureExistante: false,
    },
    
    // C. Somme d'argent
    sommesArgent: {
      montantExact: "",
      provenanceFonds: "",
      modalite: "", // virement / cheque / especes
      dateTransfert: "",
    },
    
    // D. Parts sociales / actions
    partsSociales: {
      typeSociete: "",
      nombreParts: "",
      valeurUnitaire: "",
      pourcentageCapital: "",
      agrementObligatoire: false,
      clausesSpecifiques: "",
    },
    
    // E. Nue-propriété / Usufruit
    nueProprieteUsufruit: {
      valeurNuePropriete: "",
      valeurUsufruit: "",
      duree: "", // temporaire / viager
      repartitionCharges: "",
      usufruitSimultaneConjoint: false,
    },
    
    // 6. Clauses optionnelles
    clausesOptionnelles: {
      // A. Réserve d'usufruit
      reserveUsufruit: false,
      etendueUsufruit: "",
      droitUsageHabitation: false,
      
      // B. Droit de retour conventionnel
      droitRetour: false,
      etendueRetour: "", // totalite / part_recue
      
      // C. Charge imposée
      chargeImposee: false,
      descriptionCharge: "",
      montantNatureCharge: "",
      conditionsExecution: "",
      
      // D. Affectation particulière
      usageProfessionnel: false,
      exclusionCommunaute: false,
      
      // E. Donation rapportable
      donationRapportable: "", // avancement_hoirie / hors_part
      
      // F. Clause d'inaliénabilité
      clauseInalienabilite: false,
      dureeInalienabilite: "",
      motifLegitime: "",
      autorisationRequise: false,
    },
    
    // 7. Mentions légales
    mentionsLegales: {
      caracterePresentIrrevocable: true,
      acceptationExpresse: false,
      consentementEclaire: false,
      mentionReserveHereditaire: true,
      modalitesTransfertPropriete: true,
      rappelArticlesCodeCivil: true,
      obligationsFiscales: true,
    },
    
    // 8. Acceptation du donataire
    acceptationDonataire: {
      dansActe: true, // true = dans l'acte, false = acte séparé
      dateAcceptation: "",
      lieuAcceptation: "",
    },
    
    // 9. Modalités de remise du bien
    modalitesRemise: {
      modeRemise: "", // immediate / differee / don_manuel_deja_realise / symbolique
      lieuRemise: "",
      dateRemise: "",
      personneResponsable: "",
      documentRemis: "", // carte_grise / certificat / facture / cle / autre
    },
  });

  // State pour Testament (fichiers)
  const [testamentIdentiteTestateur, setTestamentIdentiteTestateur] = useState<File | null>(null);
  const [testamentLivretFamille, setTestamentLivretFamille] = useState<File | null>(null);
  const [testamentCapaciteJuridique, setTestamentCapaciteJuridique] = useState<File | null>(null);
  const [testamentIdentiteTemoins, setTestamentIdentiteTemoins] = useState<File | null>(null);
  const [testamentDomicileTemoins, setTestamentDomicileTemoins] = useState<File | null>(null);
  const [testamentAttestationsTemoins, setTestamentAttestationsTemoins] = useState<File | null>(null);
  const [testamentCasiersTemoins, setTestamentCasiersTemoins] = useState<File | null>(null);
  const [testamentTitresPropriete, setTestamentTitresPropriete] = useState<File | null>(null);
  const [testamentRelevesBancaires, setTestamentRelevesBancaires] = useState<File | null>(null);
  const [testamentContratMariage, setTestamentContratMariage] = useState<File | null>(null);
  const [testamentAutresJustificatifs, setTestamentAutresJustificatifs] = useState<File | null>(null);
  const [testamentTestamentMystique, setTestamentTestamentMystique] = useState<File | null>(null); // Le testament cacheté lui-même

  // State pour Testament
  const [testamentData, setTestamentData] = useState({
    // 1. Informations générales
    typeTestament: "", // authentique / mystique
    caractereTestament: "", // initial / revocation / modification_codicille
    dateSouhaiteeRedaction: "",
    langueTestateur: "", // Langue comprise par le testateur (remplace langueComprise)
    autreLangue: "", // Précision si langue = "autre"
    interpreteNecessaire: false,
    interpreteNom: "",
    interpretePrenom: "",
    interpreteQualification: "",
    interpreteLangueTraduite: "",
    interpreteAttestationFidelite: "",
    interpreteSignature: "",
    
    // 2. Identité testateur
    clientId: "",
    testateurNom: "",
    testateurPrenom: "",
    testateurNomNaissance: "",
    testateurDateNaissance: "",
    testateurLieuNaissance: "",
    testateurNationalite: "",
    testateurProfession: "",
    testateurSituationFamiliale: "",
    testateurAdresse: "",
    testateurTelephone: "",
    testateurEmail: "",
    testateurPieceType: "",
    testateurPieceNumero: "",
    testateurPieceAutorite: "",
    testateurPieceExpiration: "",
    capaciteJuridiqueConfirmee: false,
    sousTutelleCuratelle: false,
    
    // 3. Héritiers réservataires
    heritiersReservataires: {
      enfants: [] as Array<{nom: string; prenom: string; dateNaissance: string}>,
      descendants: [] as Array<{nom: string; prenom: string; lien: string}>,
      nomPrenomPere: "",
      nomPrenomMere: "",
      pereVivant: "",
      mereVivante: "",
    },
    
    // 4. Légataires
    legataires: [] as Array<{nom: string; prenom: string; lien: string; adresse: string}>,
    
    // 5. Dispositions testamentaires
    dispositions: {
      legsUniversel: false,
      detailsLegsUniversel: "",
      legsTitreUniversel: false,
      detailsLegsTitreUniversel: "",
      legsParticuliers: false,
      listeLegsParticuliers: [] as Array<{description: string; beneficiaire: string}>,
      chargesConditions: false,
      detailsChargesConditions: "",
      demembrement: false,
      detailsDemembrement: "",
      droitRetour: false,
      detailsDroitRetour: "",
      exheredation: false,
      detailsExheredation: "",
      executeurTestamentaire: false,
      nomExecuteur: "",
      adresseExecuteur: "",
    },
    
    // 6. Situation patrimoniale
    patrimoine: {
      immobiliers: [] as Array<{adresse: string; type: string; valeur: string}>,
      avoirsFinanciers: [] as Array<{type: string; etablissement: string; montant: string}>,
      biensMeubles: [] as Array<{description: string; valeur: string}>,
      partsSociales: [] as Array<{societe: string; nombre: string; valeur: string}>,
    },
    
    // 7. Régime matrimonial
    regimeMatrimonial: {
      nature: "",
      contratMariage: "",
      notaireContrat: "",
      biensPropres: "",
      biensCommuns: "",
      preciput: false,
      detailsPreciput: "",
    },
    
    // Testament antérieur
    testamentAnterieur: false, // true / false
    testamentAnterieurDate: "",
    testamentAnterieurType: "", // authentique / mystique / olographe
    testamentAnterieurNotaire: "",
    
    // 8. Testament authentique spécifique
    testamentAuthentique: {
      // Nouveau: Caractère du testament
      caractere: "", // initial / modificatif / revocatoire
      dateSouhaitee: "",
      
      // Modalités de réception
      modaliteReception: "", // "1notaire_2temoins" ou "2notaires"
      lieuReception: "",
      dateReception: "",
      
      // Notaire(s)
      notaireNom: "",
      notaireOffice: "",
      notaireAdresse: "",
      presenceSecondNotaire: false,
      secondNotaireNom: "",
      secondNotaireOffice: "",
      secondNotaireAdresse: "",
      
      // Témoins (qualification complète)
      temoins: [] as Array<{
        nom: string;
        prenom: string;
        dateNaissance: string;
        lieuNaissance: string;
        nationalite: string;
        profession: string;
        adresse: string;
        lienAvecTestateur: string;
        nonHeritier: boolean;
        nonLegataire: boolean;
        nonConjoint: boolean;
        nonParentJusque4eDegre: boolean;
        capaciteJuridique: boolean;
        comprendLangue: boolean;
        agitLibrement: boolean;
        signature: boolean;
      }>,
      
      // Formalités légales
      formaliteDicte: false,
      formaliteRelu: false,
      formaliteSigne: false,
      formaliteRegistre: false,
      declarationApprobation: false,
      impossibiliteSigner: false,
      motifImpossibilite: "",
      
      // Inscription FCDDV
      inscriptionFCDDV: false,
      dateInscriptionFCDDV: "",
      notaireDepositaire: "",
    },
    
    // 9. Testament mystique spécifique
    testamentMystique: {
      // Rédaction du testament
      redactionPar: "", // "testateur" ou "tiers"
      nomRedacteur: "", // Si rédigé par un tiers
      typeEcriture: "", // "manuscrit" ou "dactylographie"
      langueTestament: "",
      nombrePages: "",
      
      // Présentation sous pli fermé
      cachete: false,
      descriptionScelle: "",
      lieuPresentation: "",
      datePresentation: "",
      
      // Notaire
      notaireNom: "",
      notaireOffice: "",
      notaireAdresse: "",
      
      // Témoins (2 obligatoires)
      temoins: [] as Array<{
        nom: string;
        prenom: string;
        dateNaissance: string;
        lieuNaissance: string;
        nationalite: string;
        profession: string;
        adresse: string;
        lienAvecTestateur: string;
        nonHeritier: boolean;
        nonLegataire: boolean;
        nonConjoint: boolean;
        nonParentJusque4eDegre: boolean;
        capaciteJuridique: boolean;
        comprendLangue: boolean;
        agitLibrement: boolean;
        signature: boolean;
      }>,
      
      // Acte de suscription
      suscription: "", // Déclaration que le pli contient le testament
      declarationContenuTestament: false,
      dateSuscription: "",
      lieuSuscription: "",
      presenceSimultanee: false, // Présence simultanée testateur/notaire/témoins
      
      // Déclarations obligatoires art. 976 C. civ.
      testateurSaitLireEcrire: false, // OBLIGATOIRE - art. 976
      testateurReconnaitTestament: false, // OBLIGATOIRE - reconnaissance personnelle
      pliNonOuvert: false, // OBLIGATOIRE - le pli n'a pas été ouvert par le notaire
      
      // Signatures
      signatureTestateur: false,
      signatureNotaire: false,
      impossibiliteSignerTestateur: false,
      motifImpossibiliteSignature: "",
      
      // Conditions légales témoins (sécurisation)
      temoinsMajeurs: false,
      temoinsNonHeritiersLegataires: false,
      temoinsSaventLireEcrire: false,
      
      // Inscription FCDDV
      inscriptionFCDDV: false,
      dateInscriptionFCDDV: "",
      notaireDepositaire: "",
    },
    
    // 10. Mentions légales
    mentionsLegales: {
      rappelReserveHereditaire: false,
      rappelQuotiteDisponible: false,
      testamentRevocable: false,
      casIndignite: false,
      verificationCapaciteLegataires: false,
      droitsReduction: false,
      regimeFiscalSuccessions: false,
    },
    
    // 11. Documents obligatoires
    documentsAuthentique: {
      pieceIdentiteTestateur: "",
      livretFamilleTestateur: "",
      certificatCapaciteTestateur: "",
      piecesIdentiteTemoins: "",
      justificatifsDomicileTemoins: "",
      attestationsCapaciteTemoins: "",
      casiersJudiciairesTemoins: "",
      titresPropriete: "",
      relevesBancaires: "",
      contratMariage: "",
      autresJustificatifs: "",
    },
  });
  
  // State pour Changement de Régime Matrimonial (fichiers)
  const [changementRegimeEpouxIdentite1, setChangementRegimeEpouxIdentite1] = useState<File | null>(null);
  const [changementRegimeEpouxIdentite2, setChangementRegimeEpouxIdentite2] = useState<File | null>(null);
  const [changementRegimeLivretFamille, setChangementRegimeLivretFamille] = useState<File | null>(null);
  const [changementRegimeActeMariage, setChangementRegimeActeMariage] = useState<File | null>(null);
  const [changementRegimeContratMariageInitial, setChangementRegimeContratMariageInitial] = useState<File | null>(null);
  const [changementRegimeJustifDomicile1, setChangementRegimeJustifDomicile1] = useState<File | null>(null);
  const [changementRegimeJustifDomicile2, setChangementRegimeJustifDomicile2] = useState<File | null>(null);
  const [changementRegimeEnfantsAccords, setChangementRegimeEnfantsAccords] = useState<File | null>(null);
  const [changementRegimeTitresPropriete, setChangementRegimeTitresPropriete] = useState<File | null>(null);
  const [changementRegimeRelevesComptes, setChangementRegimeRelevesComptes] = useState<File | null>(null);
  const [changementRegimeStatutsSocietes, setChangementRegimeStatutsSocietes] = useState<File | null>(null);
  const [changementRegimeActesPrets, setChangementRegimeActesPrets] = useState<File | null>(null);
  const [changementRegimeEstimationsBiens, setChangementRegimeEstimationsBiens] = useState<File | null>(null);
  const [changementRegimeJugementTutelle, setChangementRegimeJugementTutelle] = useState<File | null>(null);

  // State pour Changement de Régime Matrimonial
  const [changementRegimeData, setChangementRegimeData] = useState({
    // 1. Informations générales
    typeModification: "", // separation_biens / communaute_reduite / communaute_universelle / participation_acquets / modification_actuel / ajout_clauses / adoption_contrat
    regimeActuel: "", // communaute_legale / communaute_universelle / separation_biens / participation_acquets / autre
    regimeActuelAutre: "",
    dateMariage: "",
    lieuMariage: "",
    contratMariageInitial: false,
    nouveauRegimeSouhaite: "", // communaute_reduite / separation_biens / communaute_universelle / participation_acquets
    dateEffetSouhaitee: "",
    motifChangement: "", // protection_conjoint / activite_professionnelle / anticipation_successorale / simplification_patrimoniale / autre
    motifChangementAutre: "",
    
    // 1bis. Présence d'enfants
    presenceEnfants: {
      enfantsCommuns: false,
      enfantsAutreUnion: false,
      enfantsMineurs: false,
      enfantsMajeursInformes: false,
      nombreEnfantsCommuns: "",
      nombreEnfantsAutreUnion: "",
    },
    
    // 1ter. Opposition possible des tiers
    oppositionTiers: {
      creanciersConnus: false,
      risqueOpposition: false,
      detailsCreanciers: "",
      natureRisque: "",
    },
    
    // 1quater. Liquidation du régime
    liquidationRegime: {
      necessaire: "", // oui / non
      justificationAbsence: "",
      repartitionBiens: "", // 50-50 / autre
      autreRepartition: "",
      recompensesCreances: false,
      detailsRecompenses: "",
    },
    
    // 1quinquies. Homologation judiciaire
    homologation: {
      requise: false,
      motif: "", // enfants_mineurs / opposition_tiers / protection_epoux / autre
      autreMotif: "",
      tribunalCompetent: "",
    },
    
    // 1sexies. Clauses spécifiques
    clausesSpecifiques: {
      attributionIntegrale: false,
      detailsAttribution: "",
      preciput: false,
      detailsPreciput: "",
      exclusionBiens: false,
      biensExclus: "",
      amenagements: false,
      detailsAmenagements: "",
    },
    
    // 2. Époux 1
    epoux1: {
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      adresse: "",
      profession: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      validiteIdentite: "",
      sousTutelleCuratelle: false,
      changementAnterieur: false,
    },
    
    // 3. Époux 2
    epoux2: {
      clientId: "",
      nom: "",
      prenom: "",
      nomNaissance: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      adresse: "",
      profession: "",
      telephone: "",
      email: "",
      typeIdentite: "",
      numeroIdentite: "",
      validiteIdentite: "",
      sousTutelleCuratelle: false,
      changementAnterieur: false,
    },
    
    // 4. Enfants et héritiers
    enfantsCommuns: [] as Array<{
      nom: string;
      prenom: string;
      dateNaissance: string;
      majeur: boolean;
      consentement: string; // accord / opposition / pas_reponse
    }>,
    enfantsPrecedenteUnion: [] as Array<{
      nom: string;
      prenom: string;
      dateNaissance: string;
      majeur: boolean;
      parent: string; // epoux1 / epoux2
      consentement: string;
    }>,
    parentsVivants: {
      pereEpoux1: false,
      mereEpoux1: false,
      pereEpoux2: false,
      mereEpoux2: false,
    },
    
    // 5. Consentements et notifications
    consentements: {
      enfantsMajeursInformes: false,
      creancierAccord: false,
      creancierNom: "",
      creancierNatureDette: "",
      autorisationJuge: false,
      dateAutorisationJuge: "",
      motifAutorisationJuge: "",
    },
    
    // 6. Patrimoine actuel
    patrimoine: {
      // Biens propres époux 1
      biensPropreEpoux1: [] as Array<{
        description: string;
        valeur: string;
        origine: string;
        dettes: string;
      }>,
      // Biens propres époux 2
      biensPropreEpoux2: [] as Array<{
        description: string;
        valeur: string;
        origine: string;
        dettes: string;
      }>,
      // Biens communs
      biensCommuns: [] as Array<{
        description: string;
        valeur: string;
        hypotheques: string;
        affectationPro: boolean;
      }>,
      // Biens indivis
      biensIndivis: [] as Array<{
        description: string;
        quotePart: string;
        provenance: string;
      }>,
      // Entreprises
      entreprises: [] as Array<{
        nom: string;
        forme: string;
        valeur: string;
        droitsTransmis: string;
      }>,
      // Comptes financiers
      comptes: [] as Array<{
        banque: string;
        type: string;
        titulaire: string;
        solde: string;
      }>,
    },
    
    // 7. Nouveau régime choisi
    nouveauRegime: {
      type: "", // communaute_universelle / communaute_reduite / separation_biens / participation_acquets
      
      // Communauté universelle
      communauteUniverselle: {
        biensPresents: true,
        biensFuturs: true,
        clauseAttributionIntegrale: false,
        clausePreciput: false,
        detailsPreciput: "",
        exclusionBiens: [] as Array<{description: string; motif: string}>,
      },
      
      // Communauté réduite aux acquêts
      communauteReduite: {
        biensPropreDefinition: "",
        biensCommunsDefinition: "",
        repartitionDettes: "",
        clauseReprise: false,
        detailsClauseReprise: "",
        clausesFiscales: "",
      },
      
      // Séparation de biens
      separationBiens: {
        attributionBiensPropres: "",
        repartitionBiensCommuns: "",
        gestionCommuneBien: false,
        detailsGestionCommune: "",
        contributionCharges: "",
      },
      
      // Participation aux acquêts
      participationAcquets: {
        masseDepart: "",
        masseFin: "",
        modalitesCalcul: "",
      },
      
      // Clauses facultatives (tous régimes)
      clausesFacultatives: {
        preciput: false,
        detailsPreciput: "",
        administrationSeparee: false,
        detailsAdministrationSeparee: "",
        inalienabilite: false,
        motifInalienabilite: "",
        donationEntreEpoux: false,
        detailsDonation: "",
        protectionConjointSurvivant: false,
        detailsProtection: "",
        attributionPreferentielle: false,
        detailsAttributionPreferentielle: "",
        gestionSepareePro: false,
        detailsGestionPro: "",
      },
    },
    
    // 8. Liquidation régime précédent
    liquidation: {
      necessaire: false, // true si on quitte communautaire
      actifCommunaute: [] as Array<{
        description: string;
        valeur: string;
        repartition: string;
      }>,
      passifCommunaute: [] as Array<{
        description: string;
        montant: string;
        repartition: string;
      }>,
      acceptationLiquidation: false,
      cleRepartition: "50-50", // 50-50 / autre
      autreRepartition: "",
    },
    
    // 9. Mentions légales
    mentionsLegales: {
      rappelArticlesCodeCivil: false,
      rappelLiberteContractuelle: false,
      interetFamille: false,
      declarationLibreConsent: false,
      detailsAttestations: "",
      publicationBODACCInformee: false,
      depotGreffe: false,
      effetChangement: "", // 3_mois / immediat
    },
    
    // 10. Publicité et formalités
    formalites: {
      depotGreffe: false,
      coordonneesTribunal: "",
      dateDepot: "",
      publicationBODACCFaite: false,
      datePublicationBODACC: "",
      notificationCreanciers: false,
      delaisNotification: "",
      preuvesReception: "",
    },
  });

  // State pour l'acte de vente
  const [acteVenteData, setActeVenteData] = useState({
    // Sélection du client et son rôle
    clientId: "",
    clientRole: "", // "vendeur" ou "acheteur"
    
    // Informations détaillées sur le bien
    adresseBien: "",
    typeBien: "",
    naturePropriete: "",
    referencesCadastrales: "",
    sectionCadastrale: "",
    numeroCadastral: "",
    contenanceCadastrale: "",
    surfaceHabitable: "",
    surfaceTerrain: "",
    nombrePieces: "",
    equipements: [] as string[],
    // Bien - Année et annexes
    anneeConstruction: "",
    bienGarage: "",
    bienParking: "",
    bienCave: "",
    bienGrenier: "",
    bienJardin: "",
    autresDependances: "",
    // Bien - Équipements inclus
    cuisineEquipee: "",
    electromenagersInclus: "",
    electromenagersListe: "",
    mobilierLaisse: "",
    autresEquipements: "",
    // Copropriété
    bienCopropriete: "",
    numerosLots: "",
    tantièmes: "",
    reglementCopro: "",
    chargesAnnuelles: "",
    // État juridique
    servitudesExistantes: "",
    hypotheques: "",
    destinationBien: "",
    bienLibreOuOccupe: "",
    informationsBail: "",
    // Si occupé par locataire
    locataireNom: "",
    dateBail: "",
    dureeBail: "",
    montantLoyer: "",
    depotGarantieLocataire: "",
    // Si vendeur occupant
    dateLiberation: "",
    
    // Vendeur (soit client sélectionné avec auto-fill, soit manuel)
    vendeurNom: "",
    vendeurPrenom: "",
    vendeurAdresse: "",
    vendeurDateNaissance: "",
    vendeurLieuNaissance: "",
    vendeurNationalite: "",
    vendeurProfession: "",
    vendeurStatutMatrimonial: "",
    vendeurRegimeMatrimonial: "",
    vendeurPrecisionRegime: "",
    vendeurPieceIdentite: "",
    vendeurNumeroIdentite: "",
    // Vendeur - Type de partie
    vendeurTypePartie: "personne_physique",
    vendeurDenominationSociale: "",
    vendeurFormeJuridique: "",
    vendeurSiren: "",
    vendeurSiegeSocial: "",
    vendeurRepresentantNom: "",
    vendeurRepresentantQualite: "",
    // Vendeur - Représentation
    vendeurRepresente: "",
    vendeurMandataireNom: "",
    vendeurMandatairePrenom: "",
    vendeurTypePouvoir: "",
    
    // Acheteur (soit client sélectionné avec auto-fill, soit manuel)
    acheteurNom: "",
    acheteurPrenom: "",
    acheteurAdresse: "",
    acheteurDateNaissance: "",
    acheteurLieuNaissance: "",
    acheteurNationalite: "",
    acheteurProfession: "",
    acheteurStatutMatrimonial: "",
    acheteurRegimeMatrimonial: "",
    acheteurPrecisionRegime: "",
    acheteurModeAcquisition: "",
    acheteurQuotePart: "",
    // Acheteur - Type de partie
    acheteurTypePartie: "personne_physique",
    acheteurDenominationSociale: "",
    acheteurFormeJuridique: "",
    acheteurSiren: "",
    acheteurSiegeSocial: "",
    acheteurRepresentantNom: "",
    acheteurRepresentantQualite: "",
    // Acheteur - Représentation
    acheteurRepresente: "",
    acheteurMandataireNom: "",
    acheteurMandatairePrenom: "",
    acheteurTypePouvoir: "",
    
    // Conditions financières
    prixVente: "",
    origineFonds: "",
    depotGarantie: "",
    fraisNotaire: "",
    repartitionProrata: "",
    modalitesPaiement: "",
    
    // Prêt immobilier
    pretImmobilier: "",
    montantPret: "",
    banquePreteur: "",
    tauxPret: "",
    dureePret: "",
    typePret: "",
    dateAccordPret: "",
    conditionsPret: "",
    tauxMaximal: "",
    conditionSuspensivePret: "",
    
    // Documents et diagnostics
    diagnosticsFournis: "",
    dateDPE: "",
    classeEnergetique: "",
    presenceAmiante: "",
    presencePlomb: "",
    presenceTermites: "",
    assainissementConforme: "",
    
    // Origine de propriété
    origineProprieteDateAcquisition: "",
    origineReferenceActe: "",
    travauxDerniers10ans: "",
    conformiteUrbanisme: "",
    assuranceDommageOuvrage: "",
    taxesFoncieres: "",
    sinistreRecent: "",
    
    // Urbanisme
    zonePLU: "",
    droitPreemption: "",
    declarationsUrbanisme: "",
    documentsUrbanisme: "",
    dateEnvoiDIA: "",
    reponseMairieDIA: "",
    
    // Délais et signature
    dateSignatureActe: "",
    lieuSignature: "",
    remiseCles: "",
    remiseClesAnticipee: "",
    dateRemiseAnticipee: "",
    indemnitéOccupation: "",
    montantIndemnite: "",
    procuration: "",
    identiteMandataire: "",
    
    // Annexes
    titrePropriete: "",
    diagnostics: "",
    planBien: "",
    reglementCopropriete: "",
    etatDate: "",
    attestationAssurance: "",
    releveSyndic: "",
    
    // Informations complémentaires
    travauxPrevusCopro: "",
    proceduresEnCours: "",
    differendsVoisins: "",
    particularitesBien: "",
  });

  // State pour le bail d'habitation
  const [bailHabitationData, setBailHabitationData] = useState({
    // Rôle du client
    clientRole: "", // "bailleur" ou "locataire"
    clientId: "",
    
    // Sélection du bailleur (client)
    bailleurClientId: "",
    bailleurNom: "",
    bailleurPrenom: "",
    bailleurAdresse: "",
    bailleurDateNaissance: "",
    bailleurLieuNaissance: "",
    bailleurNationalite: "",
    bailleurProfession: "",
    bailleurStatutMatrimonial: "",
    bailleurPieceIdentite: "",
    bailleurNumeroIdentite: "",
    
    // Locataire(s) - saisie manuelle ou client
    locataireClientId: "",
    locataireNom: "",
    locatairePrenom: "",
    locataireAdresse: "",
    locataireDateNaissance: "",
    locataireLieuNaissance: "",
    locataireNationalite: "",
    locataireProfession: "",
    locataireStatutMatrimonial: "",
    locatairePieceIdentite: "",
    locataireNumeroIdentite: "",
    nombreOccupants: "",
    
    // Situation financière du locataire
    locataireRevenusMensuelsNets: "",
    locataireTypeContrat: "",
    locataireEmployeur: "",
    locataireEmployeurAdresse: "",
    locataireAncienneteEmployeur: "",
    
    // Colocation
    colocation: "",
    solidariteColocataires: "",
    nombreColocataires: "",
    colocatairesNoms: "",
    
    // Garant
    aGarant: "",
    garantNom: "",
    garantPrenom: "",
    garantAdresse: "",
    garantDateNaissance: "",
    garantLieuNaissance: "",
    garantStatutMatrimonial: "",
    garantProfession: "",
    garantPieceIdentite: "",
    garantNumeroIdentite: "",
    typeCaution: "",
    
    // Logement
    adresseLogement: "",
    typeLogement: "",
    etageNumeroLot: "",
    surfaceHabitable: "",
    surfaceAnnexes: "",
    anneeConstruction: "",
    etatUsage: "",
    dependances: [] as string[], // cave, parking, grenier, jardin
    placeParking: "",
    numeroPlaceParking: "",
    entretienJardin: "",
    logementCopropriete: "",
    reglementCoproFourni: "",
    
    // Si meublé
    typeBail: "", // "vide" ou "meuble"
    contratMeuble: "",
    mobilierListeComplete: [] as string[],
    inventaireFourni: "",
    inventaireMobilierTexte: "",
    etatMobilierEntree: "",
    entretienMobilier: "", // "locataire" ou "bailleur"
    
    // Liste légale mobilier minimal (décret 2015-981)
    mobilierLiterie: false,
    mobilierOccultation: false,
    mobilierPlaquesCuisson: false,
    mobilierFourMicroondes: false,
    mobilierRefrigo: false,
    mobilierCongelateur: false,
    mobilierVaisselle: false,
    mobilierUstensiles: false,
    mobilierTable: false,
    mobilierSieges: false,
    mobilierEtageres: false,
    mobilierLampes: false,
    mobilierMaterielEntretien: false,
    
    // Type et durée bail meublé
    typeDureeMeuble: "", // "1an" "9mois" "mobilite"
    motifBailMobilite: "", // si bail mobilité
    
    // Nature du bailleur
    natureBailleur: "", // "physique" ou "morale"
    
    // Usage
    residencePrincipale: "", // Oui/Non - obligatoire pour bail vide
    destinationBien: "",
    souslocationAutorisee: "",
    colocationPossible: "",
    animauxAutorises: "",
    precisionAnimaux: "",
    
    // Conditions financières
    loyerMensuel: "",
    chargesMensuelles: "",
    typeCharges: "", // "provision" ou "forfait"
    typologieCharges: "",
    depotGarantie: "",
    premierLoyerDate: "",
    modePaiement: "",
    ibanBailleur: "",
    periodiciteRegularisationCharges: "",
    revisionLoyerPrevue: "", // Oui/Non
    indiceIRL: "",
    trimestreReference: "",
    
    // Dates
    typeBailDuree: "", // "3ans" "6ans" "1an" "9mois"
    dateDebutBail: "",
    dureeBail: "",
    
    // Diagnostics obligatoires
    diagnosticsFournis: "", // Oui/Non
    diagnosticDPE: "",
    diagnosticElectricite: "",
    diagnosticGaz: "",
    diagnosticERP: "",
    diagnosticPlomb: "",
    diagnosticAmiante: "",
    
    // État logement
    etatLieuxFourni: "",
    inventaireMobilierFourni: "",
    travauxRecents: "",
    travauxDerniers6Mois: "",
    descriptionTravaux: "",
    
    // Obligations techniques
    typeChauffage: "",
    compteursIndividuels: "",
    releveCompteurs: "",
    
    // Assurance
    attestationAssurance: "",
    
    // Particularités juridiques
    servitudes: "",
    logementZoneERP: "",
    usageProfessionnel: "",
    
    // Informations complémentaires
    informationsComplementaires: "",
    
    // Remise des clés
    nombreJeuxCles: "",
    typesCles: [] as string[], // portes, boites_aux_lettres, garage, badges
    codesFournis: "", // WIFI, interphone, digicode...
  });

  // State pour le bail commercial
  const [bailCommercialData, setBailCommercialData] = useState({
    // Type de bail
    typeBail: "commercial", // "commercial" ou "professionnel"
    
    // Rôle du client
    clientRole: "", // "bailleur" ou "preneur"
    clientId: "",
    
    // Bailleur personne physique
    bailleurClientId: "",
    statutBailleur: "", // "physique" ou "morale"
    bailleurNom: "",
    bailleurPrenom: "",
    bailleurAdresse: "",
    bailleurDateNaissance: "",
    bailleurLieuNaissance: "",
    bailleurNationalite: "",
    bailleurSituationFamiliale: "", // célibataire, marié, divorcé, veuf
    bailleurRegimeMatrimonial: "", // si marié: communauté, séparation, etc.
    bailleurProfession: "",
    
    // Bailleur personne morale
    bailleurDenomination: "",
    bailleurFormeJuridique: "",
    bailleurSiren: "",
    bailleurSiret: "",
    bailleurSiegeSocial: "",
    bailleurCapitalSocial: "",
    bailleurRepresentant: "",
    bailleurRepresentantPrenom: "",
    bailleurRepresentantFonction: "",
    bailleurRepresentantEstLegal: "", // "oui" ou "non"
    bailleurMandataireNom: "",
    bailleurMandatairePrenom: "",
    bailleurMandataireTypePouvoir: "",
    
    // Preneur (locataire) personne physique
    locataireClientId: "",
    statutLocataire: "", // "physique" ou "morale"
    locataireNom: "",
    locatairePrenom: "",
    locataireAdresse: "",
    locataireDateNaissance: "",
    locataireLieuNaissance: "",
    locataireNationalite: "",
    locataireSituationFamiliale: "", // célibataire, marié, divorcé, veuf
    locataireRegimeMatrimonial: "", // si marié: communauté, séparation, etc.
    locataireProfession: "",
    locataireTelephone: "",
    locataireEmail: "",
    locataireExerceEnNomPropre: "", // "oui" ou "non"
    locataireActivite: "",
    locataireSirenPersonnel: "",
    locataireEntrepriseEnCreation: "", // "oui" ou "non"
    
    // Preneur personne morale
    locataireImmatriculation: "",
    locataireDenomination: "",
    locataireFormeJuridique: "",
    locataireSiege: "",
    locataireSiren: "",
    locataireSiret: "",
    locataireObjetSocial: "",
    locataireCapital: "",
    locataireRepresentant: "",
    locataireRepresentantPrenom: "",
    locataireRepresentantFonction: "",
    locataireMandataireNom: "",
    locataireMandatairePrenom: "",
    locataireMandataireTypePouvoir: "",
    
    // Activité (1. Destination des lieux)
    activitePrincipale: "",
    activitesAnnexes: "",
    destinationBail: "",
    destinationContractuelle: "", // Description précise des activités autorisées (commercial uniquement)
    exclusivitesEventuelles: "", // Exclusivités accordées (commercial uniquement)
    interdictionsUsage: "", // Activités interdites (commercial uniquement)
    clauseExclusivite: "",
    clauseNonConcurrence: "",
    
    // Bail professionnel spécifique
    typeProfession: "", // libérale_reglementee / libérale_non_reglementee
    numeroOrdreProfessionnel: "",
    assuranceRCPro: "", // oui / non
    assuranceLocaux: "", // oui / non
    clauseResiliationTriennale: "", // oui / non
    preavisResiliation: "", // 6 mois standard
    
    // Local commercial
    adresseLocal: "",
    natureLocal: "",
    surfaceTotale: "",
    lotsCopropriete: "",
    etageNumero: "",
    partiesPrivatives: [] as string[], // cave, sous-sol, mezzanine, parking, terrasse
    longueurVitrine: "",
    accesLivraison: "",
    etatGeneral: "",
    
    // Travaux
    travauxBailleur: "",
    travauxLocataire: "",
    etatLocalRemise: "",
    diagnosticAmiante: "",
    
    // Durée
    dureeBail: "", // "3-6-9" "derogatoire" "saisonnier"
    datePriseEffet: "",
    dureeTotale: "",
    renouvellementAuto: "",
    
    // Conditions financières (2. Clause de révision du loyer)
    loyerAnnuelHT: "",
    loyerMensuelHT: "",
    modalitePaiement: "", // mensuel, trimestriel
    typeIndexation: "", // ILC, ILAT
    indiceApplicable: "", // ILC / ILAT
    baseCalculIndice: "", // Année de base
    modaliteRevision: "", // annuelle / triennale
    chargesMensuelles: "",
    typeCharges: "", // provisions, forfait
    modeReglementCharges: "", // Forfait ou Provision avec régularisation
    depotGarantie: "", // 3. Dépôt de garantie
    montantDepotGarantie: "",
    restitutionDepot: "", // Modalités de restitution
    modePaiementLoyer: "", // virement, prelevement, cheque
    ibanBailleur: "",
    
    // Charges & travaux (4. Travaux et réparations)
    chargesLocataire: [] as string[], // eau, electricite, chauffage, entretien, copro, teom, taxe_fonciere
    chargesBailleur: [] as string[], // gros_travaux, mise_conformite, ravalement, remplacement, structurel
    chargesSupporteesBailleur: "", // Description des charges du bailleur
    chargesSupporteesPreneur: "", // Description des charges du preneur
    travauxChargeBailleur: "", // Travaux à la charge du bailleur
    travauxChargePreneur: "", // Travaux à la charge du preneur
    compteursIndividuels: "",
    
    // 5. Impôts et taxes
    taxeFonciereSupporteePar: "", // bailleur ou locataire
    taxesRecuperables: "", // Description des taxes récupérables
    
    // Garanties (9. Garanties)
    cautionPersonnelle: "",
    cautionPersonnelleOuiNon: "", // Oui / Non
    nomCaution: "",
    prenomCaution: "",
    montantGaranti: "",
    garantieBancaire: "",
    dureeGarantie: "",
    
    // Diagnostics
    diagnosticDPE: "",
    diagnosticAmianteDTA: "",
    diagnosticERP: "",
    diagnosticElectricite: "",
    diagnosticGaz: "",
    accessibiliteHandicapes: "",
    
    // État des lieux (6. État des lieux)
    etatLieuxJoint: "",
    etatLieuxRealise: "", // Oui / Non
    etatEquipements: "",
    
    // Remise des clés
    nombreJeuxCles: "",
    typesCles: [] as string[],
    codesAcces: "",
    
    // Clauses juridiques (8. Sous-location & cession)
    clauseResolutoire: "",
    resiliationTriennale: "",
    clauseAssurances: "",
    souslocationAutorisee: "", // Oui / Non
    souslocationConditions: "", // Conditions si autorisée
    cessionBailAutorisee: "", // Oui / Non
    cessionConditions: "", // Conditions (agrément du bailleur...)
    
    // 10. Assurance obligatoire
    assuranceMultirisqueSouscrite: "", // Oui / Non
    nomAssureur: "",
    numeropolice: "",
    
    // Infos complémentaires
    particularitesLocal: "",
    conditionsSpecifiques: "",
    restrictionsUsage: "",
    horairesOuverture: "",
  });
  
  const [questionnaireData, setQuestionnaireData] = useState({
    // Type de contrat
    typeContrat: "", // "compromis" ou "promesse_unilaterale"
    
    // Informations sur le bien
    adresseBien: "",
    typeBien: "",
    surfaceHabitable: "",
    nombrePieces: "",
    naturePropriete: "", // Pleine propriété / Usufruit / Nue-propriété / Indivision
    bienCopropriete: "", // Oui / Non
    numeroLot: "",
    tantièmes: "",
    occupationBien: "", // Libre / Occupé par le vendeur / Occupé par un locataire / Bail en cours
    servitudesConnues: "", // Oui / Non
    descriptionServitudes: "",
    bienLibre: "", // Oui / Non
    
    // Client et son rôle
    clientId: "",
    clientRole: "", // "acheteur" ou "vendeur"
    
    // Statut matrimonial client
    statutMatrimonialClient: "", // Célibataire / Marié / Pacsé / Divorcé / Veuf
    regimeMatrimonialClient: "", // Communauté légale / Séparation de biens / Autre
    precisionRegimeClient: "",
    
    // Informations autre partie (saisie manuelle)
    nomAutrePartie: "",
    prenomAutrePartie: "",
    adresseAutrePartie: "",
    
    // Statut matrimonial autre partie
    statutMatrimonialAutrePartie: "",
    regimeMatrimonialAutrePartie: "",
    precisionRegimeAutrePartie: "",
    
    // Conditions financières
    prixVente: "",
    depotGarantie: "",
    modalitesPaiement: "",
    
    // Conditions suspensives - Prêt immobilier
    conditionPret: "", // Oui / Non
    montantPret: "",
    dureePret: "",
    tauxInteretMax: "",
    delaiAccordPret: "",
    
    // Conditions suspensives - Autres
    conditionDiagnostics: "",
    autresConditions: "",
    
    // Droit de préemption
    droitPreemptionUrbain: "", // Oui / Non / Inconnu
    locatairePreemption: "", // Oui / Non
    
    // Délais
    dateSignatureActeDefinitif: "",
    delaiReflexion: "",
    
    // Promesse unilatérale spécifique
    dureeOption: "",
    dateLimiteOption: "",
    indemniteImmobilisation: "",
    
    // Informations complémentaires
    chargesCopropriete: "",
    travauxAPrevenir: "",
    autresInformations: "",
  });

  // State pour convention d'indivision
  const [indivisionData, setIndivisionData] = useState({
    // Informations générales
    typeBien: "immobilier", // immobilier / mobilier / autre
    origine: "", // succession / achat_commun / investissement / donation / autre
    objet: "", // Texte libre
    
    // Indivisaires (tableau)
    indivisaires: [{
      id: 1,
      isClient: false, // true si c'est un de nos clients
      clientId: "",
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      situationFamiliale: "", // celibataire / marie / pacse / divorce / veuf
      regimeMatrimonial: "", // communaute / separation / participation / autre
      typeIdentite: "",
      numeroIdentite: "",
      email: "",
      telephone: "",
      quotePart: "", // % de propriété
      origineQuotePart: "", // heritage / achat / donation...
      origineQuotePartAutre: "", // Si origine = autre
    }],
    
    // Description du bien
    description: {
      typeBien: "immobilier",
      immobilier: {
        adresse: "",
        nature: "", // maison / appartement / terrain / immeuble / local_commercial / autre
        description: "",
        surface: "",
        cadastre: "",
        etatLocatif: "", // libre / loue / occupe
        loyer: "",
        valeurVenale: "",
      },
      mobilier: {
        description: "",
        valeurEstimee: "",
        numerosIdentification: "",
      }
    },
    
    // Durée de la convention
    duree: {
      type: "indeterminee", // indeterminee / determinee
      annees: "", // Si déterminée (max 5 ans)
      conditionsRenouvellement: "",
      conditionsSortie: "",
    },
    
    // Gestion
    gestion: {
      gerant: "",
      pouvoirs: {
        gestion_courante: false,
        travaux: false,
        representation: false,
        signature_actes: false,
      },
      decisions: "", // unanimite / majorite_2_3 / majorite_simple
      charges: "",
      compteBancaire: "",
      repartitionDepensesExceptionnelles: "", // Nouvelle section
      repartitionRevenus: "", // Nouvelle section
    },
    
    // Utilisation du bien
    utilisation: {
      utilisationParIndivisaires: "non",
      conditionsUtilisation: "",
      indemniteOccupation: "non", // Nouvelle section: oui/non/conditions
      indemniteOccupationMontant: "", // Si oui ou conditions
      indemniteOccupationConditions: "", // Si conditions
      indemniteMontant: "",
      indemniteFrequence: "",
      locationAutorisee: "non",
      mandataireLocation: "",
      repartitionLoyers: "",
    },
    
    // Travaux
    travaux: {
      typesAutorises: "",
      decisionRequise: "",
      repartitionCouts: "",
      travauxUrgents: "",
      documentation: "",
    },
    
    // Sortie d'indivisaire
    sortie: {
      venteLibre: "libre", // libre / droit_preemption
      evaluationPart: "", // gerant / accord_indivisaires / expert / juge
      delaiRachat: "",
      modalitesPaiement: "",
    },
    
    // Vente du bien
    vente: {
      conditionsMiseEnVente: "",
      decisionRequise: "", // unanimite / majorite_2_3 / majorite_simple
      mandataire: "",
      repartitionPrix: "",
      gestionPlusValues: "",
    },
    
    // Comptabilité
    comptabilite: {
      registreDepenses: "non",
      archivageFactures: "",
      remboursementAvances: "",
      rapportAnnuel: "non",
    },
    
    // Litiges
    litiges: {
      modesResolution: {
        mediation: false,
        arbitrage: false,
        tribunal: false,
      },
      solidariteDettes: "non",
    },
    
    // Assurance (nouvelle section)
    assurance: {
      assuranceObligatoire: "oui",
      nomAssureur: "",
      numeroPolice: "",
      repartitionPrime: "",
      dateEcheance: "",
    },
  });

  // State pour la mainlevée d'hypothèque
  const [mainleveeData, setMainleveeData] = useState({
    // 1. Informations générales
    typeMainlevee: "totale", // totale / partielle / renonciation / substitution
    precisionPartielle: "",
    natureInscription: "hypotheque_conventionnelle", // hypotheque_conventionnelle / hypotheque_legale / hypotheque_judiciaire / privilege_ppd
    numeroInscription: "",
    dateInscription: "",
    volumeNumero: "",
    referencePartenaire: "",

    // 2. Créancier
    creancierType: "banque", // banque / personne_physique
    creancierBanque: {
      denominationSociale: "",
      formeJuridique: "",
      capitalSocial: "",
      adresseSiege: "",
      rcs: "",
      siren: "",
      representantNom: "",
      representantPrenom: "",
      representantFonction: "",
      pouvoirsType: "", // mandat / delegation / pv
    },
    creancierPersonne: {
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      statutMatrimonial: "",
      typeIdentite: "",
      numeroIdentite: "",
    },

    // 3. Débiteurs (tableau)
    debiteurs: [{
      id: 1,
      isClient: false,
      clientId: "",
      nom: "",
      prenom: "",
      adresse: "",
      dateNaissance: "",
      lieuNaissance: "",
      nationalite: "",
      profession: "",
      situationFamiliale: "",
      regimeMatrimonial: "",
      typeIdentite: "",
      numeroIdentite: "",
      qualite: "emprunteur", // emprunteur / cofinanceur / caution_hypothecaire
    }],

    // 4. Acte constitutif
    acteOrigine: {
      dateSignature: "",
      natureActe: "acte_notarie", // acte_notarie / acte_sous_seing_prive
      notaireAuteur: "",
      datePublication: "",
      numeroPublication: "",
    },
    conditionsPret: {
      montantInitial: "",
      tauxInteret: "",
      dureePret: "",
      numeroContrat: "",
      etablissementPreteur: "",
      numeroDossier: "",
    },

    // 5. Bien hypothéqué (tableau pour gérer plusieurs biens)
    biens: [{
      id: 1,
      adresse: "",
      descriptionBien: "",
      typeBien: "", // maison / appartement / terrain / locaux / dependances
      modeDetention: "", // propriete_exclusive / indivision / communaute_acquets / separation_biens / autre
      quotepartsIndivision: "", // Si indivision
      autreRegime: "", // Si autre
      cadastreSection: "",
      cadastreParcelle: "",
      cadastreContenance: "",
      estCopropriete: "non",
      numeroLot: "",
      quotePart: "",
    }],

    // 6. Déclaration du créancier
    declaration: {
      creancePayee: true,
      aucuneDette: true,
      consentMainlevee: true,
      renonciation: true,
      demandeRadiation: true,
    },

    // 7. Mandat/Procuration
    mandataire: {
      existe: "non",
      nom: "",
      prenom: "",
      fonction: "",
      pouvoirSigner: false,
      pouvoirDeposer: false,
    },

    // 8. Consentement débiteur
    consentementDebiteur: {
      requis: "non",
      accordRadiation: false,
      declarationsComplementaires: "",
    },

    // 10. Frais
    frais: {
      fraisRadiation: "",
      honoraires: "",
      timbresFiscaux: "",
    },
  });

  // State pour contrat de mariage (régimes matrimoniaux)
  const [contratMariageData, setContratMariageData] = useState({
    // 1. Informations générales
    typeRegime: "", // separation_biens / communaute_acquets / communaute_acquets_amenagee / communaute_universelle / participation_acquets / autre
    autreRegimePrecision: "",
    typeContrat: "prenuptial", // prenuptial / changement_regime
    
    // Lieu et date du mariage (prénuptial)
    dateMariagePrevue: "",
    lieuMariage: {
      mairie: "",
      commune: "",
      departement: "",
      pays: "France",
    },
    
    // Si changement de régime
    dateMariage: "",
    regimeActuel: "", // separation_biens / communaute_legale / participation_acquets / communaute_universelle / regime_etranger / autre
    regimeActuelAutre: "",
    motifChangement: "",
    accordEnfantsMajeurs: "",
    accordCreancier: "",
    
    // Consentement enfants majeurs (si changement)
    consentementEnfantsMajeursRequis: "non",
    
    // Liquidation du régime actuel (si changement depuis régime communautaire)
    liquidationRegimeActuel: "non", // oui / non
    biensCommuns: [{
      id: 1,
      description: "",
      valeurEstimee: "",
      dettesAttachees: "",
      affectationPrevue: "", // epoux1 / epoux2 / vente / indivision
      repartitionEnvisagee: "", // conservé pour compatibilité
    }],
    passifCommun: [{
      id: 1,
      description: "",
      montant: "",
      modeRepartition: "", // epoux1 / epoux2 / 50_50
    }],
    soulte: {
      soulteDue: "non",
      montantSoulte: "",
      epouxDebiteur: "",
      modalitesPaiement: "", // comptant / echelonne
      dateLimitePaiement: "",
    },
    actifsFinanciers: [{
      id: 1,
      natureCompte: "",
      etablissement: "",
      solde: "",
      modePartage: "", // epoux1 / epoux2 / personnalise
      partagePersonnalise: "",
    }],
    observationsLiquidation: "",
    
    // Choix de la loi applicable (cas internationaux)
    choixLoiApplicable: "loi_francaise", // loi_francaise / loi_residence / loi_nationalite / autre
    choixLoiApplicableAutre: "",
    
    // Consentement juge (si enfants mineurs et changement)
    accordJugeRequis: "non",
    
    // 2. Époux (tableau de 2 personnes)
    epoux: [
      {
        id: 1,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        adresse: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationFamiliale: "", // celibataire / divorce / veuf
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        lieuEmissionIdentite: "",
        domicileActuel: "",
        domicileApresMariage: "",
        // Si mariage antérieur hors France
        mariageAnterieurtHorsFrance: "non",
        datePremierMariage: "",
        lieuPremierMariage: "",
        regimeMatrimonialInitial: "",
        acteEtatCivilEtranger: "",
      },
      {
        id: 2,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        adresse: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationFamiliale: "",
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        lieuEmissionIdentite: "",
        domicileActuel: "",
        domicileApresMariage: "",
        mariageAnterieurtHorsFrance: "non",
        datePremierMariage: "",
        lieuPremierMariage: "",
        regimeMatrimonialInitial: "",
        acteEtatCivilEtranger: "",
      },
    ],
    
    // 3. Informations sur les enfants
    nombreEnfants: "",
    enfantsMajeurs: [{
      id: 1,
      nom: "",
      prenom: "",
      adresse: "",
      accordInformation: "", // oui / non
    }],
    enfantsMineurs: "",
    informationJugeNecessaire: "",
    
    // 4. Patrimoine actuel des époux
    patrimoineEpoux1: {
      biensPropres: "",
      biensAcquisPendantMariage: "",
      valeurEstimee: "",
      dettesPersonnelles: "",
      dettesCommunes: "",
      masseDepart: "",
      masseFin: "",
    },
    patrimoineEpoux2: {
      biensPropres: "",
      biensAcquisPendantMariage: "",
      valeurEstimee: "",
      dettesPersonnelles: "",
      dettesCommunes: "",
      masseDepart: "",
      masseFin: "",
    },
    
    // 5. Clauses personnalisables selon le régime
    
    // A. Séparation de biens
    clausesSeparation: {
      administrationExclusive: false,
      comptesSepares: false,
      contributionCharges: "", // proportionnelle / 50_50 / autre
      contributionChargesAutre: "",
      miseEnCommunBien: "",
      abandonCreance: "",
    },
    
    // B. Communauté réduite aux acquêts aménagée
    clausesCommunauteAmenagee: {
      definitionBiensCommunsPropres: "",
      amenagementBiensProfessionnels: "",
      contributionCharges: "",
      repartitionDettes: "",
      typeAdministration: "", // symetriques / unique
      pouvoirUniqueDetails: "",
    },
    
    // C. Communauté universelle
    clausesCommunauteUniverselle: {
      tousLiensCommunsPresentsEtFuturs: true,
      attributionIntegraleSurvivant: "", // oui / non
      clausesPreciput: "",
      exclusionCertainsBiens: "",
    },
    
    // D. Participation aux acquêts
    clausesParticipation: {
      definitionPatrimoinesOriginels: "",
      definitionPatrimoineFinal: "",
      calculCreanceParticipation: "",
      renonciationCreance: "",
      biensPropresParNature: "",
    },
    
    // E. Clauses optionnelles avancées
    clausesAvancees: {
      clauseRemploi: "",
      clausePreciput: "",
      attributionPreferentielle: "",
      gestionSepareeBiensProfessionnels: "",
      protectionConjointSurvivant: "",
      donationEntreEpoux: "",
      solidariteDetteSpecifiques: "",
    },
    
    // 6. Déclarations obligatoires
    declarations: {
      identite: true,
      capaciteJuridique: true,
      situationMatrimoniale: true,
      absenceOpposition: true,
      choixLibreEclaire: true,
      connaissanceEffetsJuridiques: true,
    },
  });

  // State pour PACS
  const [pacsData, setPacsData] = useState({
    // 1. Informations générales sur le PACS
    objetPacs: "initial", // initial / modification / dissolution
    regimePacs: "separation", // separation / indivision / personnalise
    regimePersonnalise: {
      definitionBiensCommuns: "",
      biensPropres: "",
      clausesSpecifiques: "",
    },
    datePriseEffetSouhaitee: "",
    
    // Si modification de PACS
    pacsInitialDate: "",
    pacsInitialMairie: "",
    pacsInitialNumero: "",
    clausesModifiees: "",
    
    // 2. Partenaires (tableau de 2 personnes)
    partenaires: [
      {
        id: 1,
        isClient: false,
        clientId: "",
        // A. Informations civiles obligatoires
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseActuelle: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        telephone: "",
        email: "",
        // B. Informations pour contrôle juridique
        situationFamiliale: "", // celibataire / divorce / veuf
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        autoriteDelivrante: "",
        // C. Pour partenaire étranger
        estEtranger: false,
        attestationNonPacsPaysOrigine: false,
        certificatCoutumeRequis: false,
        traductionRequise: false,
      },
      {
        id: 2,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseActuelle: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        telephone: "",
        email: "",
        situationFamiliale: "",
        typeIdentite: "",
        numeroIdentite: "",
        dateEmissionIdentite: "",
        autoriteDelivrante: "",
        estEtranger: false,
        attestationNonPacsPaysOrigine: false,
        certificatCoutumeRequis: false,
        traductionRequise: false,
      }
    ],
    
    // 3. Adresse commune (obligatoire)
    adresseCommune: "",
    dateDebutResidenceCommune: "",
    
    // 4. Clauses du PACS
    // A. Clauses obligatoires
    contributionCharges: "proportionnelle", // proportionnelle / 50_50 / autre
    contributionChargesAutre: "",
    
    // B. Clauses facultatives
    clausesFacultatives: {
      gestionBiensPersonnels: "",
      gestionBienCommun: "",
      usageBienIndivis: "",
      repartitionDepensesSpecifiques: "",
      clauseOccupationLogementSeparation: "",
      clauseRepriseBienDeces: "",
      clauseAbandonCreance: "",
      modalitesCompteBancaireCommun: "",
      clausesFinancieresPersonnalisees: "",
      clausesSolidariteDettes: "",
    },
    
    // 6. Déclarations sur l'honneur (obligatoires)
    declarations: {
      residenceCommune: false,
      absenceLienParente: false,
      absenceMariageEtPacs: false,
    },
    
    // 7. Cas particuliers
    // A. Enfant en commun
    enfantEnCommun: "non",
    enfants: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
      autoriteParentale: "",
    }],
    
    // B. Régimes patrimoniaux étrangers
    droitApplicable: "francais",
    droitApplicableAutre: "",
    
    // C. Biens déjà acquis ensemble
    biensPreexistants: "non",
    biensListe: [{
      id: 1,
      description: "",
      quotePart1: "",
      quotePart2: "",
      indivision: "",
    }],
  });

  // State pour Donation entre époux
  const [donationEntreEpouxData, setDonationEntreEpouxData] = useState({
    // 1. Informations générales sur la donation
    typeDonation: "au_dernier_vivant", // au_dernier_vivant / biens_presents / mixte
    objetDonation: [], // protection_conjoint / transmission_bien / partage_inegal / renforcement_droits
    datePrevueSignature: "",
    
    // 2. Identité complète des époux
    epoux: [
      {
        id: 1,
        isClient: false,
        clientId: "",
        // Informations civiles
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseComplete: "",
        telephone: "",
        email: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationMatrimoniale: "marie",
        // Régime matrimonial
        regimeMatrimonial: "", // communaute_legale / communaute_universelle / separation_biens / participation_acquets / autre
        regimeMatrimonialAutre: "",
        dateMariage: "",
        lieuMariage: "",
        existenceContratMariage: "non", // oui / non
        // Pièce d'identité
        typeIdentite: "",
        numeroIdentite: "",
        autoriteDelivrance: "",
        dateExpiration: "",
      },
      {
        id: 2,
        isClient: false,
        clientId: "",
        nom: "",
        prenom: "",
        nomNaissance: "",
        adresseComplete: "",
        telephone: "",
        email: "",
        dateNaissance: "",
        lieuNaissance: "",
        nationalite: "",
        profession: "",
        situationMatrimoniale: "marie",
        regimeMatrimonial: "",
        regimeMatrimonialAutre: "",
        dateMariage: "",
        lieuMariage: "",
        existenceContratMariage: "non",
        typeIdentite: "",
        numeroIdentite: "",
        autoriteDelivrance: "",
        dateExpiration: "",
      }
    ],
    
    // 3. Enfants et héritiers potentiels
    enfantsCommuns: [{
      id: 1,
      nom: "",
      prenom: "",
      dateNaissance: "",
    }],
    enfantsNonCommuns: [{
      id: 1,
      epoux: "1", // 1 ou 2
      nom: "",
      prenom: "",
      dateNaissance: "",
    }],
    parentsVivants: {
      epoux1: "non", // oui / non
      epoux2: "non",
    },
    autresHeritiers: "",
    
    // 4. Patrimoine des époux
    biensPropresEpoux1: [{
      id: 1,
      type: "", // immobilier / meuble / financier / autre
      description: "",
      valeur: "",
      origine: "", // heritage / donation / achat
    }],
    biensPropresEpoux2: [{
      id: 1,
      type: "",
      description: "",
      valeur: "",
      origine: "",
    }],
    biensCommuns: [{
      id: 1,
      description: "",
      valeur: "",
      partEpoux1: "",
      partEpoux2: "",
    }],
    droitsParticuliers: {
      nueProprieteBiens: "",
      usufruitBiens: "",
      biensIndivis: "",
      biensHypotheques: "",
    },
    
    // 5. Clauses de donation - Donation au dernier vivant
    donationDernierVivant: {
      // Options successorales
      optionsSuccessorales: [], // pleine_propriete_quotite / usufruit_universel / quart_pleine_3quarts_usufruit / choix_multiple / attribution_biens_specifiques
      biensSpecifiques: "",
      // Clause d'attribution préférentielle
      attributionPreferentielle: {
        active: false,
        logementFamilial: false,
        mobilier: false,
        bienProfessionnel: false,
        vehicule: false,
        autresBiens: "",
      },
      // Clause de préciput
      clausePreciput: {
        active: false,
        descriptionBien: "",
        effet: "", // hors_part / valorise_part
      },
      // Clause de cantonnement
      clauseCantonnement: false,
      // Clause d'exclusion
      clauseExclusion: {
        active: false,
        biensExclus: "",
        casParticuliers: "",
      },
    },
    
    // 5B. Clauses - Donation de biens présents
    donationBiensPresents: {
      biensDonnes: [{
        id: 1,
        nature: "", // immobilier / financier / meuble / entreprise / autre
        description: "",
        valeur: "",
        regimePropriete: "", // propre / commun / indivis
      }],
      irrevocabilite: "oui", // oui / non
      clauseRetourPredeces: "non", // oui / non
      reserveUsufruit: {
        active: false,
        conditions: "",
      },
    },
    
    // 6. Clauses communes
    clausesCommunes: {
      administrationGestion: "",
      conditionSuspensiveResolutoire: "",
      acceptationBeneficiaire: false,
      renonciationDroitsSuccessorauxStandards: false,
      clauseNonRevocation: false,
      // Révocabilité de la donation
      revocabilite: "revocable", // revocable / irrevocable
      motifsRevocation: [], // survenance_enfants / ingratitude / non_execution / revocation_libre
      // Mandataire éventuel
      signatureMandataire: "non", // oui / non
      mandataireEpoux1: {
        nom: "",
        prenom: "",
        typeProcuration: "", // sous_seing_prive / acte_notarie
      },
      mandataireEpoux2: {
        nom: "",
        prenom: "",
        typeProcuration: "",
      },
      // Information successorale obligatoire
      informationEffetsSuccessoraux: false,
    },
    
    // 7. Mentions légales (pré-remplies mais éditables)
    mentionsLegales: {
      articlesCodeCivil: true,
      effetsDonation: true,
      quotiteDisponible: true,
      limitesReserveHereditaire: true,
      declarationCapaciteJuridique: true,
      consentementEclaire: true,
      lectureActe: true,
      signaturesElectroniques: true,
    },
  });

  const navigate = useNavigate();

  // debounce
  useEffect(() => {
    const t = setTimeout(() => setDebounced(search.trim()), 300);
    return () => clearTimeout(t);
  }, [search]);

  // Détecte les paramètres URL pour ouvrir automatiquement le formulaire
  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const shouldCreate = params.get('create');
    const contractType = params.get('type');
    const category = params.get('category');
    
    if (shouldCreate === 'true' && contractType && category) {
      // Ouvrir le dialog avec le type de contrat
      setPendingContractType(contractType);
      setPendingCategory(category);
      setShowQuestionDialog(true);
      
      // Nettoyer les paramètres URL
      navigate(location.pathname, { replace: true });
    }
  }, [location.search, location.pathname, navigate]);

  // Détecte le rôle depuis l'URL
  let role: 'avocat' | 'notaire' = 'avocat';
  if (location.pathname.includes('/notaires')) role = 'notaire';
  if (location.pathname.includes('/avocats')) role = 'avocat';

  const mainButtonColor = role === 'notaire'
    ? 'bg-orange-600 hover:bg-orange-700 text-white'
    : 'bg-blue-600 hover:bg-blue-700 text-white';

  // Role-based menu/select styling
  const menuContentClass = role === 'notaire' ? 'bg-orange-50 border-orange-200' : 'bg-blue-50 border-blue-200';
  const menuItemClass = role === 'notaire' ? 'focus:bg-orange-600 focus:text-white hover:bg-orange-600 hover:text-white' : 'focus:bg-blue-600 focus:text-white hover:bg-blue-600 hover:text-white';
  const selectContentClass = role === 'notaire' ? 'bg-orange-50 border-orange-200' : 'bg-blue-50 border-blue-200';
  const selectItemClass = role === 'notaire' ? 'cursor-pointer hover:bg-orange-600 hover:text-white' : 'cursor-pointer hover:bg-blue-600 hover:text-white';

  // Charger les clients
  useEffect(() => {
    let isMounted = true;
    async function loadClients() {
      if (!user) return;
      const { data, error } = await supabase
        .from('clients')
        .select('id, nom, prenom, adresse, telephone, email, date_naissance, lieu_naissance, nationalite, profession, situation_matrimoniale, situation_familiale, type_identite, numero_identite, id_doc_path')
        .eq('owner_id', user.id)
        .eq('role', role)
        .order('nom', { ascending: true });
      
      if (error) {
        console.error('Erreur chargement clients:', error);
      } else if (isMounted && data) {
        setClients(data);
      }
    }
    loadClients();
    return () => { isMounted = false; };
  }, [user, role]);

  // Pré-remplir les informations du client sélectionné (Compromis de vente)
  useEffect(() => {
    if (questionnaireData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === questionnaireData.clientId) as any;
      if (selectedClient) {
        console.log('📋 Client sélectionné:', selectedClient.nom, selectedClient.prenom);
        console.log('📄 id_doc_path:', selectedClient.id_doc_path);
        
        // Extraire la situation familiale de l'objet JSON
        let situationFamiliale = "";
        if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
          situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
        } else if (typeof selectedClient.situation_familiale === 'string') {
          situationFamiliale = selectedClient.situation_familiale;
        }
        
        setQuestionnaireData(prev => ({
          ...prev,
          statutMatrimonialClient: situationFamiliale || selectedClient.situation_matrimoniale || "",
        }));

        // Charger le document d'identité du client si disponible
        if (selectedClient.id_doc_path) {
          console.log('✅ Chargement du document depuis id_doc_path:', selectedClient.id_doc_path);
          // Générer l'URL signée pour accéder au document
          supabase.storage
            .from('documents')
            .createSignedUrl(selectedClient.id_doc_path, 3600)
            .then(({ data, error }) => {
              if (error) {
                console.error('❌ Erreur chargement document:', error);
                setCompromisClientIdentiteUrl(null);
              } else if (data?.signedUrl) {
                console.log('✅ Document chargé avec succès');
                setCompromisClientIdentiteUrl(data.signedUrl);
              }
            });
        } else {
          // Chercher dans client_documents si pas de id_doc_path
          console.log('🔍 Recherche dans client_documents pour client:', selectedClient.id);
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5) // Prendre les 5 plus récents
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents:', docsError);
                setCompromisClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) trouvé(s) pour ce client`);
                // Chercher d'abord piece_identite, sinon prendre le premier
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document:', error);
                      setCompromisClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document client_documents chargé avec succès');
                      setCompromisClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document trouvé dans client_documents');
                setCompromisClientIdentiteUrl(null);
              }
            });
        }
      }
    } else {
      setCompromisClientIdentiteUrl(null);
    }
  }, [questionnaireData.clientId, clients]);

  // Auto-fill depuis le client sélectionné selon son rôle (Acte de vente)
  useEffect(() => {
    if (acteVenteData.clientId && acteVenteData.clientRole && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === acteVenteData.clientId) as any;
      if (selectedClient) {
        // Extraire la situation familiale de l'objet JSON
        let situationFamiliale = "";
        if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
          situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
        } else if (typeof selectedClient.situation_familiale === 'string') {
          situationFamiliale = selectedClient.situation_familiale;
        }
        
        const statutMatrimonial = situationFamiliale || selectedClient.situation_matrimoniale || "";

        if (acteVenteData.clientRole === "vendeur") {
          setActeVenteData(prev => ({
            ...prev,
            // Remplir les infos du vendeur avec le client
            vendeurNom: selectedClient.nom || "",
            vendeurPrenom: selectedClient.prenom || "",
            vendeurAdresse: selectedClient.adresse || "",
            vendeurDateNaissance: selectedClient.date_naissance || "",
            vendeurLieuNaissance: selectedClient.lieu_naissance || "",
            vendeurNationalite: selectedClient.nationalite || "",
            vendeurProfession: selectedClient.profession || "",
            vendeurStatutMatrimonial: statutMatrimonial,
            vendeurPieceIdentite: selectedClient.type_identite || "",
            vendeurNumeroIdentite: selectedClient.numero_identite || "",
            // Vider les champs de l'acheteur
            acheteurNom: "",
            acheteurPrenom: "",
            acheteurAdresse: "",
            acheteurDateNaissance: "",
            acheteurLieuNaissance: "",
            acheteurNationalite: "",
            acheteurProfession: "",
            acheteurStatutMatrimonial: "",
          }));
        } else if (acteVenteData.clientRole === "acheteur") {
          setActeVenteData(prev => ({
            ...prev,
            // Remplir les infos de l'acheteur avec le client
            acheteurNom: selectedClient.nom || "",
            acheteurPrenom: selectedClient.prenom || "",
            acheteurAdresse: selectedClient.adresse || "",
            acheteurDateNaissance: selectedClient.date_naissance || "",
            acheteurLieuNaissance: selectedClient.lieu_naissance || "",
            acheteurNationalite: selectedClient.nationalite || "",
            acheteurProfession: selectedClient.profession || "",
            acheteurStatutMatrimonial: statutMatrimonial,
            // Vider les champs du vendeur
            vendeurNom: "",
            vendeurPrenom: "",
            vendeurAdresse: "",
            vendeurDateNaissance: "",
            vendeurLieuNaissance: "",
            vendeurNationalite: "",
            vendeurProfession: "",
            vendeurStatutMatrimonial: "",
            vendeurPieceIdentite: "",
            vendeurNumeroIdentite: "",
          }));
        }
      }
    }
  }, [acteVenteData.clientId, acteVenteData.clientRole, clients]);

  // Charger automatiquement le document d'identité du client pour l'acte de vente
  useEffect(() => {
    if (acteVenteData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === acteVenteData.clientId) as any;
      console.log('📋 Client acte sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path acte:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document acte depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document acte:', error);
              setActeClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document acte chargé avec succès');
              setActeClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour client (acte):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5) // Prendre les 5 plus récents
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents (acte):', docsError);
                setActeClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) acte trouvé(s) pour ce client`);
                // Chercher d'abord piece_identite, sinon prendre le premier
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document acte sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document acte:', error);
                      setActeClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document acte client_documents chargé avec succès');
                      setActeClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document trouvé dans client_documents (acte)');
                setActeClientIdentiteUrl(null);
              }
            });
        } else {
          setActeClientIdentiteUrl(null);
        }
      }
    } else {
      setActeClientIdentiteUrl(null);
    }
  }, [acteVenteData.clientId, clients]);

  // Charger la pièce d'identité du client (Bail d'habitation)
  // Auto-load carte d'identité bailleur bail commercial
  useEffect(() => {
    if (bailCommercialData.clientRole === "bailleur" && bailCommercialData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailCommercialData.clientId) as any;
      console.log('📋 Client bailleur bail commercial sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path bail commercial:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document bail commercial depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document bail commercial:', error);
              setBailCommercialBailleurClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document bail commercial chargé avec succès');
              setBailCommercialBailleurClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour client (bail commercial):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents (bail commercial):', docsError);
                setBailCommercialBailleurClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) bail commercial trouvé(s) pour ce client`);
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document bail commercial sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document bail commercial:', error);
                      setBailCommercialBailleurClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document bail commercial client_documents chargé avec succès');
                      setBailCommercialBailleurClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document bail commercial trouvé dans client_documents');
                setBailCommercialBailleurClientIdentiteUrl(null);
              }
            });
        } else {
          setBailCommercialBailleurClientIdentiteUrl(null);
        }
      }
    } else {
      setBailCommercialBailleurClientIdentiteUrl(null);
    }
  }, [bailCommercialData.clientId, bailCommercialData.clientRole, clients]);

  // Auto-load carte d'identité preneur bail commercial
  useEffect(() => {
    if (bailCommercialData.clientRole === "preneur" && bailCommercialData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailCommercialData.clientId) as any;
      console.log('📋 Client preneur bail commercial sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path bail commercial preneur:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document preneur bail commercial depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document preneur bail commercial:', error);
              setBailCommercialPreneurClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document preneur bail commercial chargé avec succès');
              setBailCommercialPreneurClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour preneur (bail commercial):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents preneur (bail commercial):', docsError);
                setBailCommercialPreneurClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) preneur bail commercial trouvé(s) pour ce client`);
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document preneur bail commercial sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document preneur bail commercial:', error);
                      setBailCommercialPreneurClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document preneur bail commercial client_documents chargé avec succès');
                      setBailCommercialPreneurClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document preneur bail commercial trouvé dans client_documents');
                setBailCommercialPreneurClientIdentiteUrl(null);
              }
            });
        } else {
          setBailCommercialPreneurClientIdentiteUrl(null);
        }
      }
    } else {
      setBailCommercialPreneurClientIdentiteUrl(null);
    }
  }, [bailCommercialData.clientId, bailCommercialData.clientRole, clients]);

  useEffect(() => {
    if (bailHabitationData.clientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailHabitationData.clientId) as any;
      console.log('📋 Client bail sélectionné:', selectedClient?.nom, selectedClient?.prenom);
      console.log('📄 id_doc_path bail:', selectedClient?.id_doc_path);
      
      if (selectedClient?.id_doc_path) {
        console.log('✅ Chargement document bail depuis id_doc_path:', selectedClient.id_doc_path);
        supabase.storage
          .from('documents')
          .createSignedUrl(selectedClient.id_doc_path, 3600)
          .then(({ data, error }) => {
            if (error) {
              console.error('❌ Erreur chargement document bail:', error);
              setBailClientIdentiteUrl(null);
            } else if (data?.signedUrl) {
              console.log('✅ Document bail chargé avec succès');
              setBailClientIdentiteUrl(data.signedUrl);
            }
          });
      } else {
        // Chercher dans client_documents si pas de id_doc_path
        console.log('🔍 Recherche dans client_documents pour client (bail):', selectedClient?.id);
        if (selectedClient?.id) {
          supabase
            .from('client_documents')
            .select('file_path, file_name, document_type')
            .eq('client_id', selectedClient.id)
            .order('uploaded_at', { ascending: false })
            .limit(5)
            .then(({ data: docs, error: docsError }) => {
              if (docsError) {
                console.error('❌ Erreur recherche documents (bail):', docsError);
                setBailClientIdentiteUrl(null);
              } else if (docs && docs.length > 0) {
                console.log(`📄 ${docs.length} document(s) bail trouvé(s) pour ce client`);
                const idDoc = docs.find(d => d.document_type === 'piece_identite') || docs[0];
                console.log('📄 Document bail sélectionné:', idDoc.file_name, '(type:', idDoc.document_type, ')');
                supabase.storage
                  .from('documents')
                  .createSignedUrl(idDoc.file_path, 3600)
                  .then(({ data, error }) => {
                    if (error) {
                      console.error('❌ Erreur chargement document bail:', error);
                      setBailClientIdentiteUrl(null);
                    } else if (data?.signedUrl) {
                      console.log('✅ Document bail client_documents chargé avec succès');
                      setBailClientIdentiteUrl(data.signedUrl);
                    }
                  });
              } else {
                console.log('⚠️ Aucun document trouvé dans client_documents (bail)');
                setBailClientIdentiteUrl(null);
              }
            });
        } else {
          setBailClientIdentiteUrl(null);
        }
      }
    } else {
      setBailClientIdentiteUrl(null);
    }
  }, [bailHabitationData.clientId, clients]);

  // Auto-fill depuis le client sélectionné comme bailleur (Bail d'habitation)
  useEffect(() => {
    if (bailHabitationData.bailleurClientId && clients.length > 0) {
      const selectedClient = clients.find(c => c.id === bailHabitationData.bailleurClientId) as any;
      if (selectedClient) {
        // Extraire la situation familiale de l'objet JSON
        let situationFamiliale = "";
        if (typeof selectedClient.situation_familiale === 'object' && selectedClient.situation_familiale !== null) {
          situationFamiliale = selectedClient.situation_familiale.situation_familiale || "";
        } else if (typeof selectedClient.situation_familiale === 'string') {
          situationFamiliale = selectedClient.situation_familiale;
        }

        setBailHabitationData(prev => ({
          ...prev,
          bailleurNom: selectedClient.nom || "",
          bailleurPrenom: selectedClient.prenom || "",
          bailleurAdresse: selectedClient.adresse || "",
          bailleurDateNaissance: selectedClient.date_naissance || "",
          bailleurLieuNaissance: selectedClient.lieu_naissance || "",
          bailleurNationalite: selectedClient.nationalite || "",
          bailleurProfession: selectedClient.profession || "",
          bailleurStatutMatrimonial: situationFamiliale || selectedClient.situation_matrimoniale || "",
          bailleurPieceIdentite: selectedClient.type_identite || "",
          bailleurNumeroIdentite: selectedClient.numero_identite || "",
        }));
      }
    }
  }, [bailHabitationData.bailleurClientId, clients]);

  // Détecter les paramètres URL pour ouvrir le questionnaire automatiquement
  useEffect(() => {
    const params = new URLSearchParams(location.search);
    const shouldCreate = params.get('create') === 'true';
    const type = params.get('type');
    const category = params.get('category');
    
    if (shouldCreate && type && category) {
      setPendingContractType(type);
      setPendingCategory(category);
      setShowQuestionDialog(true);
      
      // Nettoyer l'URL
      window.history.replaceState({}, '', location.pathname);
    }
  }, [location]);

  useEffect(() => {
    let isMounted = true;
    async function load() {
      if (!user) {
        setContrats([]);
        setLoading(false);
        return;
      }
      setLoading(true);
      let query = supabase
        .from('contrats')
        .select('id,name,category,type,created_at,updated_at')
        .eq('owner_id', user.id)
        .eq('role', role)
        .order('created_at', { ascending: false });
      if (debounced) {
        query = query.or(`name.ilike.%${debounced}%,type.ilike.%${debounced}%`);
      }
      if (categoryFilter && categoryFilter !== 'Tous') {
        query = query.eq('category', categoryFilter);
      }
      const { data, error } = await query;
      if (error) {
        console.error('Erreur chargement contrats:', error);
        if (isMounted) setContrats([]);
      } else if (isMounted) {
        setContrats(data as ContratRow[]);
      }
      if (isMounted) setLoading(false);
    }
    load();
    return () => { isMounted = false; };
  }, [user, role, debounced, categoryFilter]);

  const createContract = async (contractType: string, categoryKey: string) => {
    if (!user) {
      toast.error("Connexion requise");
      return;
    }
    
    // Si c'est un compromis de vente immobilier, ouvrir le questionnaire
    if (contractType === "Compromis de vente / Promesse unilatérale de vente" && categoryKey === "Immobilier") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un acte de vente immobilière, ouvrir le questionnaire spécifique
    if (contractType === "Acte de vente immobilière" && categoryKey === "Immobilier") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un bail d'habitation, ouvrir le questionnaire spécifique
    if ((contractType === "Bail d'habitation vide" || contractType === "Bail d'habitation meublé") && categoryKey === "Immobilier") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un bail commercial, ouvrir le questionnaire spécifique
    if (contractType === "Bail commercial / professionnel" && categoryKey === "Immobilier") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est une convention d'indivision, ouvrir le questionnaire spécifique
    if (contractType === "Convention d'indivision" && categoryKey === "Immobilier") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est une mainlevée d'hypothèque, ouvrir le questionnaire spécifique
    if (contractType === "Mainlevée d'hypothèque" && categoryKey === "Immobilier") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un contrat de mariage, ouvrir le questionnaire spécifique
    if (contractType === "Contrat de mariage (régimes matrimoniaux)" && categoryKey === "Famille & Patrimoine") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un PACS, ouvrir le questionnaire spécifique
    if (contractType === "PACS (convention + enregistrement)" && categoryKey === "Famille & Patrimoine") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est une donation entre époux, ouvrir le questionnaire spécifique
    if (contractType === "Donation entre époux" && categoryKey === "Famille & Patrimoine") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est une donation simple, ouvrir le questionnaire spécifique
    if (contractType === "Donation simple (parent → enfant, etc.)" && categoryKey === "Famille & Patrimoine") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un testament, ouvrir le questionnaire spécifique
    if (contractType === "Testament authentique ou mystique" && categoryKey === "Famille & Patrimoine") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Si c'est un changement de régime matrimonial, ouvrir le questionnaire spécifique
    if (contractType === "Changement de régime matrimonial" && categoryKey === "Famille & Patrimoine") {
      setPendingContractType(contractType);
      setPendingCategory(categoryKey);
      setShowQuestionDialog(true);
      return;
    }
    
    // Sinon, créer directement le contrat
    try {
      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: contractType,
          type: contractType,
          category: categoryKey,
          role: role,
        })
        .select()
        .single();

      if (error) throw error;
      toast.success('Contrat créé', { description: contractType });
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  const handleQuestionnaireSubmit = async () => {
    if (!user) return;
    
    try {
      // Récupérer les infos du client sélectionné
      const selectedClient = clients.find(c => c.id === questionnaireData.clientId);
      if (!selectedClient) {
        toast.error('Veuillez sélectionner un client');
        return;
      }

      // Déterminer qui est le vendeur et qui est l'acquéreur
      const isClientAcheteur = questionnaireData.clientRole === "acheteur";
      const vendeurInfo = isClientAcheteur 
        ? {
            nom: questionnaireData.nomAutrePartie,
            prenom: questionnaireData.prenomAutrePartie,
            adresse: questionnaireData.adresseAutrePartie
          }
        : {
            nom: selectedClient.nom,
            prenom: selectedClient.prenom,
            adresse: selectedClient.adresse
          };
      
      const acquereurInfo = isClientAcheteur
        ? {
            nom: selectedClient.nom,
            prenom: selectedClient.prenom,
            adresse: selectedClient.adresse
          }
        : {
            nom: questionnaireData.nomAutrePartie,
            prenom: questionnaireData.prenomAutrePartie,
            adresse: questionnaireData.adresseAutrePartie
          };

      // Créer le contrat avec les données du questionnaire en description
      const descriptionData = `
TYPE DE CONTRAT: ${questionnaireData.typeContrat === "compromis" ? "Compromis de vente" : "Promesse unilatérale de vente"}

INFORMATIONS SUR LE BIEN:
- Adresse: ${questionnaireData.adresseBien}
- Type de bien: ${questionnaireData.typeBien}
- Surface habitable: ${questionnaireData.surfaceHabitable} m²
- Nombre de pièces: ${questionnaireData.nombrePieces}
- Nature de la propriété: ${questionnaireData.naturePropriete}
- Bien en copropriété: ${questionnaireData.bienCopropriete}
${questionnaireData.bienCopropriete === "oui" ? `- Numéro de lot: ${questionnaireData.numeroLot}\n- Tantièmes: ${questionnaireData.tantièmes}` : ''}
- Occupation du bien: ${questionnaireData.occupationBien}
- Servitudes connues: ${questionnaireData.servitudesConnues}
${questionnaireData.servitudesConnues === "oui" ? `- Description des servitudes: ${questionnaireData.descriptionServitudes}` : ''}
- Bien vendu libre de toute occupation: ${questionnaireData.bienLibre}

VENDEUR:
- Nom: ${vendeurInfo.nom}
- Prénom: ${vendeurInfo.prenom}
- Adresse: ${vendeurInfo.adresse}
- Statut matrimonial: ${isClientAcheteur ? questionnaireData.statutMatrimonialAutrePartie : questionnaireData.statutMatrimonialClient}
${(isClientAcheteur ? questionnaireData.statutMatrimonialAutrePartie : questionnaireData.statutMatrimonialClient) === "marie" || (isClientAcheteur ? questionnaireData.statutMatrimonialAutrePartie : questionnaireData.statutMatrimonialClient) === "pacse" ? `- Régime matrimonial: ${isClientAcheteur ? questionnaireData.regimeMatrimonialAutrePartie : questionnaireData.regimeMatrimonialClient}` : ''}

ACQUÉREUR:
- Nom: ${acquereurInfo.nom}
- Prénom: ${acquereurInfo.prenom}
- Adresse: ${acquereurInfo.adresse}
- Statut matrimonial: ${isClientAcheteur ? questionnaireData.statutMatrimonialClient : questionnaireData.statutMatrimonialAutrePartie}
${(isClientAcheteur ? questionnaireData.statutMatrimonialClient : questionnaireData.statutMatrimonialAutrePartie) === "marie" || (isClientAcheteur ? questionnaireData.statutMatrimonialClient : questionnaireData.statutMatrimonialAutrePartie) === "pacse" ? `- Régime matrimonial: ${isClientAcheteur ? questionnaireData.regimeMatrimonialClient : questionnaireData.regimeMatrimonialAutrePartie}` : ''}

CONDITIONS FINANCIÈRES:
- Prix de vente: ${questionnaireData.prixVente} €
- Dépôt de garantie: ${questionnaireData.depotGarantie} €
- Modalités de paiement: ${questionnaireData.modalitesPaiement}

${questionnaireData.typeContrat === "compromis" ? `
CONDITIONS SUSPENSIVES:
- Condition de prêt: ${questionnaireData.conditionPret}
${questionnaireData.conditionPret === "oui" ? `
DÉTAILS DU PRÊT IMMOBILIER:
- Montant du prêt: ${questionnaireData.montantPret} €
- Durée du prêt: ${questionnaireData.dureePret} années
- Taux d'intérêt maximal: ${questionnaireData.tauxInteretMax} %
- Délai pour accord de prêt: ${questionnaireData.delaiAccordPret}` : ''}
- Diagnostics: ${questionnaireData.conditionDiagnostics}
- Autres conditions: ${questionnaireData.autresConditions}` : ''}

DROIT DE PRÉEMPTION:
- Droit de préemption urbain: ${questionnaireData.droitPreemptionUrbain}
- Locataire avec droit de préemption: ${questionnaireData.locatairePreemption}

${questionnaireData.typeContrat === "promesse_unilaterale" ? `
PROMESSE UNILATÉRALE:
- Durée de l'option: ${questionnaireData.dureeOption} jours
- Date limite de levée d'option: ${questionnaireData.dateLimiteOption}
- Indemnité d'immobilisation: ${questionnaireData.indemniteImmobilisation}` : ''}

DÉLAIS:
- Date signature acte définitif: ${questionnaireData.dateSignatureActeDefinitif}
- Délai de réflexion: ${questionnaireData.delaiReflexion} jours

INFORMATIONS COMPLÉMENTAIRES:
- Charges de copropriété: ${questionnaireData.chargesCopropriete}
- Travaux à prévoir: ${questionnaireData.travauxAPrevenir}
- Autres informations: ${questionnaireData.autresInformations}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success('Contrat créé avec succès', { 
        description: 'Les informations ont été enregistrées et pourront être utilisées pour générer le document'
      });
      
      setShowQuestionDialog(false);
      // Réinitialiser le questionnaire
      setQuestionnaireData({
        typeContrat: "",
        adresseBien: "",
        typeBien: "",
        surfaceHabitable: "",
        nombrePieces: "",
        naturePropriete: "",
        bienCopropriete: "",
        numeroLot: "",
        tantièmes: "",
        occupationBien: "",
        servitudesConnues: "",
        descriptionServitudes: "",
        bienLibre: "",
        clientId: "",
        clientRole: "",
        statutMatrimonialClient: "",
        regimeMatrimonialClient: "",
        precisionRegimeClient: "",
        nomAutrePartie: "",
        prenomAutrePartie: "",
        adresseAutrePartie: "",
        statutMatrimonialAutrePartie: "",
        regimeMatrimonialAutrePartie: "",
        precisionRegimeAutrePartie: "",
        prixVente: "",
        depotGarantie: "",
        modalitesPaiement: "",
        conditionPret: "",
        montantPret: "",
        dureePret: "",
        tauxInteretMax: "",
        delaiAccordPret: "",
        conditionDiagnostics: "",
        autresConditions: "",
        droitPreemptionUrbain: "",
        locatairePreemption: "",
        dateSignatureActeDefinitif: "",
        delaiReflexion: "",
        dureeOption: "",
        dateLimiteOption: "",
        indemniteImmobilisation: "",
        chargesCopropriete: "",
        travauxAPrevenir: "",
        autresInformations: "",
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création contrat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  // Handler pour la soumission du questionnaire Acte de vente immobilière
  const handleActeVenteSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      // Validation des champs requis
      if (!acteVenteData.clientId || !acteVenteData.clientRole) {
        toast.error('Veuillez sélectionner un client et son rôle');
        return;
      }

      if (!acteVenteData.vendeurNom || !acteVenteData.acheteurNom) {
        toast.error('Veuillez remplir les informations du vendeur et de l\'acheteur');
        return;
      }

      if (!acteVenteData.adresseBien || !acteVenteData.typeBien || !acteVenteData.prixVente) {
        toast.error('Veuillez remplir les champs obligatoires (adresse, type de bien, prix)');
        return;
      }

      // Créer le contrat avec les données complètes en description
      const descriptionData = `
TYPE DE CONTRAT: Acte de vente immobilière

═══════════════════════════════════════════════════════════════
INFORMATIONS SUR LE BIEN
═══════════════════════════════════════════════════════════════
- Adresse complète: ${acteVenteData.adresseBien}
- Type de bien: ${acteVenteData.typeBien}
- Nature de propriété: ${acteVenteData.naturePropriete}
- Destination: ${acteVenteData.destinationBien}

RÉFÉRENCES CADASTRALES:
- Section cadastrale: ${acteVenteData.sectionCadastrale}
- Numéro cadastral: ${acteVenteData.numeroCadastral}
- Contenance cadastrale: ${acteVenteData.contenanceCadastrale}

SURFACES:
- Surface habitable: ${acteVenteData.surfaceHabitable} m²
- Surface terrain: ${acteVenteData.surfaceTerrain} m²
- Nombre de pièces: ${acteVenteData.nombrePieces}

${acteVenteData.bienCopropriete === "oui" ? `
COPROPRIÉTÉ:
- Bien en copropriété: Oui
- Numéros de lot(s): ${acteVenteData.numerosLots}
- Tantièmes / Quote-parts: ${acteVenteData.tantièmes}
- Règlement disponible: ${acteVenteData.reglementCopro}
- Charges annuelles: ${acteVenteData.chargesAnnuelles} €` : `
COPROPRIÉTÉ: Non`}

═══════════════════════════════════════════════════════════════
ÉTAT JURIDIQUE DU BIEN
═══════════════════════════════════════════════════════════════
- Servitudes existantes: ${acteVenteData.servitudesExistantes || 'Aucune'}
- Hypothèques / Inscriptions: ${acteVenteData.hypotheques || 'Aucune'}
- Bien libre ou occupé: ${acteVenteData.bienLibreOuOccupe}
${acteVenteData.bienLibreOuOccupe === "occupe" ? `- Informations bail: ${acteVenteData.informationsBail}` : ''}

═══════════════════════════════════════════════════════════════
VENDEUR
═══════════════════════════════════════════════════════════════
- Nom complet: ${acteVenteData.vendeurNom} ${acteVenteData.vendeurPrenom}
- Adresse: ${acteVenteData.vendeurAdresse}
- Date de naissance: ${acteVenteData.vendeurDateNaissance}
- Lieu de naissance: ${acteVenteData.vendeurLieuNaissance}
- Nationalité: ${acteVenteData.vendeurNationalite}
- Profession: ${acteVenteData.vendeurProfession}
- Statut matrimonial: ${acteVenteData.vendeurStatutMatrimonial}
${(acteVenteData.vendeurStatutMatrimonial === "marie" || acteVenteData.vendeurStatutMatrimonial === "pacse") ? `- Régime matrimonial: ${acteVenteData.vendeurRegimeMatrimonial}` : ''}
- Pièce d'identité: ${acteVenteData.vendeurPieceIdentite} n° ${acteVenteData.vendeurNumeroIdentite}

═══════════════════════════════════════════════════════════════
ACHETEUR
═══════════════════════════════════════════════════════════════
- Nom complet: ${acteVenteData.acheteurNom} ${acteVenteData.acheteurPrenom}
- Adresse: ${acteVenteData.acheteurAdresse}
- Date de naissance: ${acteVenteData.acheteurDateNaissance}
- Lieu de naissance: ${acteVenteData.acheteurLieuNaissance}
- Nationalité: ${acteVenteData.acheteurNationalite}
- Profession: ${acteVenteData.acheteurProfession}
- Statut matrimonial: ${acteVenteData.acheteurStatutMatrimonial}
${(acteVenteData.acheteurStatutMatrimonial === "marie" || acteVenteData.acheteurStatutMatrimonial === "pacse") ? `- Régime matrimonial: ${acteVenteData.acheteurRegimeMatrimonial}` : ''}
- Mode d'acquisition: ${acteVenteData.acheteurModeAcquisition}
${acteVenteData.acheteurModeAcquisition === "indivision" ? `- Quote-part: ${acteVenteData.acheteurQuotePart}%` : ''}

═══════════════════════════════════════════════════════════════
CONDITIONS FINANCIÈRES
═══════════════════════════════════════════════════════════════
- Prix de vente: ${acteVenteData.prixVente} €
- Origine des fonds: ${acteVenteData.origineFonds}
- Dépôt de garantie: ${acteVenteData.depotGarantie} €
- Frais de notaire: ${acteVenteData.fraisNotaire} €
- Répartition prorata: ${acteVenteData.repartitionProrata}
- Modalités de paiement: ${acteVenteData.modalitesPaiement}

${acteVenteData.pretImmobilier === "oui" ? `
PRÊT IMMOBILIER:
- Montant du prêt: ${acteVenteData.montantPret} €
- Banque prêteuse: ${acteVenteData.banquePreteur}
- Taux réel: ${acteVenteData.tauxPret} %
- Durée: ${acteVenteData.dureePret} années
- Type de prêt: ${acteVenteData.typePret}
- Date accord: ${acteVenteData.dateAccordPret}
- Conditions: ${acteVenteData.conditionsPret}` : ''}

═══════════════════════════════════════════════════════════════
DOCUMENTS & DIAGNOSTICS
═══════════════════════════════════════════════════════════════
${acteVenteData.diagnosticsFournis}

═══════════════════════════════════════════════════════════════
ORIGINE DE PROPRIÉTÉ & DÉCLARATIONS
═══════════════════════════════════════════════════════════════
- Date d'acquisition précédente: ${acteVenteData.origineProprieteDateAcquisition}
- Référence acte: ${acteVenteData.origineReferenceActe}
- Travaux (10 ans): ${acteVenteData.travauxDerniers10ans || 'Aucun'}
- Conformité urbanisme: ${acteVenteData.conformiteUrbanisme}
- Assurance dommage-ouvrage: ${acteVenteData.assuranceDommageOuvrage}
- Taxes foncières N-1: ${acteVenteData.taxesFoncieres} €
- Sinistre récent: ${acteVenteData.sinistreRecent}

═══════════════════════════════════════════════════════════════
URBANISME
═══════════════════════════════════════════════════════════════
- Zone PLU/POS: ${acteVenteData.zonePLU}
- Droit de préemption: ${acteVenteData.droitPreemption}
- Déclarations d'urbanisme: ${acteVenteData.declarationsUrbanisme}
- Documents fournis: ${acteVenteData.documentsUrbanisme}

═══════════════════════════════════════════════════════════════
DÉLAIS & SIGNATURE
═══════════════════════════════════════════════════════════════
- Date de signature: ${acteVenteData.dateSignatureActe}
- Lieu de signature: ${acteVenteData.lieuSignature}
- Remise des clés: ${acteVenteData.remiseCles}
${acteVenteData.procuration === "oui" ? `- Procuration: Oui\n- Mandataire: ${acteVenteData.identiteMandataire}` : '- Procuration: Non'}

═══════════════════════════════════════════════════════════════
ANNEXES
═══════════════════════════════════════════════════════════════
- Titre de propriété: ${acteVenteData.titrePropriete}
- Diagnostics: ${acteVenteData.diagnostics}
- Plan du bien: ${acteVenteData.planBien}
- Règlement copropriété: ${acteVenteData.reglementCopropriete}
- État daté: ${acteVenteData.etatDate}
- Attestation assurance: ${acteVenteData.attestationAssurance}
- Relevé syndic: ${acteVenteData.releveSyndic}

═══════════════════════════════════════════════════════════════
INFORMATIONS COMPLÉMENTAIRES
═══════════════════════════════════════════════════════════════
- Travaux prévus copropriété: ${acteVenteData.travauxPrevusCopro || 'Aucun'}
- Procédures en cours: ${acteVenteData.proceduresEnCours || 'Aucune'}
- Différends voisins: ${acteVenteData.differendsVoisins || 'Aucun'}
- Particularités: ${acteVenteData.particularitesBien || 'Aucune'}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: pendingContractType,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success('Acte de vente créé avec succès', { 
        description: 'Toutes les informations ont été enregistrées et pourront être utilisées pour générer le document'
      });
      
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire acte de vente
      setActeVenteData({
        clientId: "",
        clientRole: "",
        adresseBien: "",
        typeBien: "",
        naturePropriete: "",
        sectionCadastrale: "",
        numeroCadastral: "",
        contenanceCadastrale: "",
        surfaceHabitable: "",
        surfaceTerrain: "",
        nombrePieces: "",
        equipements: [],
        bienCopropriete: "",
        numerosLots: "",
        tantièmes: "",
        reglementCopro: "",
        chargesAnnuelles: "",
        servitudesExistantes: "",
        hypotheques: "",
        destinationBien: "",
        bienLibreOuOccupe: "",
        informationsBail: "",
        vendeurNom: "",
        vendeurPrenom: "",
        vendeurAdresse: "",
        vendeurDateNaissance: "",
        vendeurLieuNaissance: "",
        vendeurNationalite: "",
        vendeurProfession: "",
        vendeurStatutMatrimonial: "",
        vendeurRegimeMatrimonial: "",
        vendeurPrecisionRegime: "",
        vendeurPieceIdentite: "",
        vendeurNumeroIdentite: "",
        acheteurNom: "",
        acheteurPrenom: "",
        acheteurAdresse: "",
        acheteurDateNaissance: "",
        acheteurLieuNaissance: "",
        acheteurNationalite: "",
        acheteurProfession: "",
        acheteurStatutMatrimonial: "",
        acheteurRegimeMatrimonial: "",
        acheteurPrecisionRegime: "",
        acheteurModeAcquisition: "",
        acheteurQuotePart: "",
        prixVente: "",
        origineFonds: "",
        depotGarantie: "",
        fraisNotaire: "",
        repartitionProrata: "",
        modalitesPaiement: "",
        pretImmobilier: "",
        montantPret: "",
        banquePreteur: "",
        tauxPret: "",
        dureePret: "",
        typePret: "",
        dateAccordPret: "",
        conditionsPret: "",
        diagnosticsFournis: "",
        origineProprieteDateAcquisition: "",
        origineReferenceActe: "",
        travauxDerniers10ans: "",
        conformiteUrbanisme: "",
        assuranceDommageOuvrage: "",
        taxesFoncieres: "",
        sinistreRecent: "",
        zonePLU: "",
        droitPreemption: "",
        declarationsUrbanisme: "",
        documentsUrbanisme: "",
        dateSignatureActe: "",
        lieuSignature: "",
        remiseCles: "",
        procuration: "",
        identiteMandataire: "",
        titrePropriete: "",
        diagnostics: "",
        planBien: "",
        reglementCopropriete: "",
        etatDate: "",
        attestationAssurance: "",
        releveSyndic: "",
        travauxPrevusCopro: "",
        proceduresEnCours: "",
        differendsVoisins: "",
        particularitesBien: "",
      });
      
      refreshContrats();
    } catch (err: unknown) {
      console.error('Erreur création acte de vente:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la création', { description: message });
    }
  };

  const refreshContrats = () => {
    // Force un rechargement
    if (!user) return;
    supabase
      .from('contrats')
      .select('id,name,category,type,created_at,updated_at')
      .eq('owner_id', user.id)
      .eq('role', role)
      .order('created_at', { ascending: false })
      .then(({ data, error }) => {
        if (error) {
          console.error('Erreur rechargement contrats:', error);
        } else {
          setContrats(data as ContratRow[]);
        }
      });
  };

  // Handler pour la soumission du bail d'habitation
  const handleBailHabitationSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!bailHabitationData.bailleurClientId) {
        toast.error('Veuillez sélectionner un client bailleur');
        return;
      }

      if (!bailHabitationData.locataireNom || !bailHabitationData.adresseLogement || !bailHabitationData.loyerMensuel) {
        toast.error('Veuillez remplir les champs obligatoires (locataire, adresse logement, loyer)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: Bail d'habitation ${bailHabitationData.typeBail === "meuble" ? "meublé" : "vide"}

═══════════════════════════════════════════════════════════════
BAILLEUR
═══════════════════════════════════════════════════════════════
- Nom complet: ${bailHabitationData.bailleurNom} ${bailHabitationData.bailleurPrenom}
- Adresse: ${bailHabitationData.bailleurAdresse}
- Date de naissance: ${bailHabitationData.bailleurDateNaissance}
- Lieu de naissance: ${bailHabitationData.bailleurLieuNaissance}
- Nationalité: ${bailHabitationData.bailleurNationalite}
- Profession: ${bailHabitationData.bailleurProfession}
- Statut matrimonial: ${bailHabitationData.bailleurStatutMatrimonial}
- Pièce d'identité: ${bailHabitationData.bailleurPieceIdentite} n° ${bailHabitationData.bailleurNumeroIdentite}

═══════════════════════════════════════════════════════════════
LOCATAIRE
═══════════════════════════════════════════════════════════════
- Nom complet: ${bailHabitationData.locataireNom} ${bailHabitationData.locatairePrenom}
- Adresse: ${bailHabitationData.locataireAdresse}
- Date de naissance: ${bailHabitationData.locataireDateNaissance}
- Lieu de naissance: ${bailHabitationData.locataireLieuNaissance}
- Nationalité: ${bailHabitationData.locataireNationalite}
- Profession: ${bailHabitationData.locataireProfession}
- Statut matrimonial: ${bailHabitationData.locataireStatutMatrimonial}
- Pièce d'identité: ${bailHabitationData.locatairePieceIdentite} n° ${bailHabitationData.locataireNumeroIdentite}
- Nombre d'occupants: ${bailHabitationData.nombreOccupants}

${bailHabitationData.aGarant === "oui" ? `═══════════════════════════════════════════════════════════════
GARANT
═══════════════════════════════════════════════════════════════
- Nom complet: ${bailHabitationData.garantNom} ${bailHabitationData.garantPrenom}
- Adresse: ${bailHabitationData.garantAdresse}
- Profession: ${bailHabitationData.garantProfession}
- Type de caution: ${bailHabitationData.typeCaution}
` : ''}

═══════════════════════════════════════════════════════════════
LOGEMENT
═══════════════════════════════════════════════════════════════
- Adresse complète: ${bailHabitationData.adresseLogement}
- Type de logement: ${bailHabitationData.typeLogement}
- Surface habitable: ${bailHabitationData.surfaceHabitable} m²
- Année construction: ${bailHabitationData.anneeConstruction || 'Non renseignée'}
- État d'usage: ${bailHabitationData.etatUsage}
- Copropriété: ${bailHabitationData.logementCopropriete}

═══════════════════════════════════════════════════════════════
CONDITIONS FINANCIÈRES
═══════════════════════════════════════════════════════════════
- Loyer mensuel: ${bailHabitationData.loyerMensuel} €
- Charges mensuelles: ${bailHabitationData.chargesMensuelles} €
- Type de charges: ${bailHabitationData.typologieCharges}
- Dépôt de garantie: ${bailHabitationData.depotGarantie} €
- Premier loyer payable le: ${bailHabitationData.premierLoyerDate}
- Mode de paiement: ${bailHabitationData.modePaiement}

═══════════════════════════════════════════════════════════════
DATES DU BAIL
═══════════════════════════════════════════════════════════════
- Type: ${bailHabitationData.typeBail === "meuble" ? "Location meublée" : "Location vide"}
- Durée: ${bailHabitationData.typeBailDuree}
- Date de début: ${bailHabitationData.dateDebutBail}

═══════════════════════════════════════════════════════════════
INFORMATIONS COMPLÉMENTAIRES
═══════════════════════════════════════════════════════════════
${bailHabitationData.informationsComplementaires || 'Aucune'}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Bail d'habitation - ${bailHabitationData.locataireNom} ${bailHabitationData.locatairePrenom}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Bail d'habitation créé avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setBailHabitationData({
        clientRole: "",
        clientId: "",
        bailleurClientId: "",
        bailleurNom: "",
        bailleurPrenom: "",
        bailleurAdresse: "",
        bailleurDateNaissance: "",
        bailleurLieuNaissance: "",
        bailleurNationalite: "",
        bailleurProfession: "",
        bailleurStatutMatrimonial: "",
        bailleurPieceIdentite: "",
        bailleurNumeroIdentite: "",
        locataireClientId: "",
        locataireNom: "",
        locatairePrenom: "",
        locataireAdresse: "",
        locataireDateNaissance: "",
        locataireLieuNaissance: "",
        locataireNationalite: "",
        locataireProfession: "",
        locataireStatutMatrimonial: "",
        locatairePieceIdentite: "",
        locataireNumeroIdentite: "",
        nombreOccupants: "",
        locataireRevenusMensuelsNets: "",
        locataireTypeContrat: "",
        locataireEmployeur: "",
        locataireEmployeurAdresse: "",
        locataireAncienneteEmployeur: "",
        colocation: "",
        solidariteColocataires: "",
        nombreColocataires: "",
        colocatairesNoms: "",
        aGarant: "",
        garantNom: "",
        garantPrenom: "",
        garantAdresse: "",
        garantDateNaissance: "",
        garantLieuNaissance: "",
        garantStatutMatrimonial: "",
        garantProfession: "",
        garantPieceIdentite: "",
        garantNumeroIdentite: "",
        typeCaution: "",
        adresseLogement: "",
        typeLogement: "",
        etageNumeroLot: "",
        surfaceHabitable: "",
        surfaceAnnexes: "",
        anneeConstruction: "",
        etatUsage: "",
        dependances: [],
        placeParking: "",
        numeroPlaceParking: "",
        entretienJardin: "",
        logementCopropriete: "",
        reglementCoproFourni: "",
        typeBail: "",
        contratMeuble: "",
        mobilierListeComplete: [],
        inventaireFourni: "",
        inventaireMobilierTexte: "",
        etatMobilierEntree: "",
        entretienMobilier: "",
        mobilierLiterie: false,
        mobilierOccultation: false,
        mobilierPlaquesCuisson: false,
        mobilierFourMicroondes: false,
        mobilierRefrigo: false,
        mobilierCongelateur: false,
        mobilierVaisselle: false,
        mobilierUstensiles: false,
        mobilierTable: false,
        mobilierSieges: false,
        mobilierEtageres: false,
        mobilierLampes: false,
        mobilierMaterielEntretien: false,
        typeDureeMeuble: "",
        motifBailMobilite: "",
        natureBailleur: "",
        residencePrincipale: "",
        destinationBien: "",
        souslocationAutorisee: "",
        colocationPossible: "",
        animauxAutorises: "",
        precisionAnimaux: "",
        loyerMensuel: "",
        chargesMensuelles: "",
        typeCharges: "",
        typologieCharges: "",
        depotGarantie: "",
        premierLoyerDate: "",
        modePaiement: "",
        ibanBailleur: "",
        periodiciteRegularisationCharges: "",
        revisionLoyerPrevue: "",
        indiceIRL: "",
        trimestreReference: "",
        typeBailDuree: "",
        dateDebutBail: "",
        dureeBail: "",
        diagnosticsFournis: "",
        diagnosticDPE: "",
        diagnosticElectricite: "",
        diagnosticGaz: "",
        diagnosticERP: "",
        diagnosticPlomb: "",
        diagnosticAmiante: "",
        etatLieuxFourni: "",
        inventaireMobilierFourni: "",
        travauxRecents: "",
        travauxDerniers6Mois: "",
        descriptionTravaux: "",
        typeChauffage: "",
        compteursIndividuels: "",
        releveCompteurs: "",
        attestationAssurance: "",
        servitudes: "",
        logementZoneERP: "",
        usageProfessionnel: "",
        informationsComplementaires: "",
        nombreJeuxCles: "",
        typesCles: [],
        codesFournis: "",
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création bail:', err);
      toast.error('Erreur lors de la création du bail');
    }
  };

  const handleBailCommercialSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!bailCommercialData.typeBail || !bailCommercialData.statutBailleur || !bailCommercialData.adresseLocal || !bailCommercialData.loyerMensuelHT) {
        toast.error('Veuillez remplir les champs obligatoires (type de bail, statut bailleur, adresse local, loyer)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: ${bailCommercialData.typeBail === "commercial" ? "Bail commercial" : "Bail professionnel"}

═══════════════════════════════════════════════════════════════
BAILLEUR
═══════════════════════════════════════════════════════════════
- Statut: ${bailCommercialData.statutBailleur === "physique" ? "Personne physique" : "Personne morale (société)"}
${bailCommercialData.statutBailleur === "physique" ? `- Nom: ${bailCommercialData.bailleurNom} ${bailCommercialData.bailleurPrenom}` : `- Dénomination: ${bailCommercialData.bailleurDenomination}
- Forme juridique: ${bailCommercialData.bailleurFormeJuridique}
- SIREN: ${bailCommercialData.bailleurSiren}
- SIRET: ${bailCommercialData.bailleurSiret}`}
- Adresse: ${bailCommercialData.bailleurAdresse}

═══════════════════════════════════════════════════════════════
LOCAL COMMERCIAL
═══════════════════════════════════════════════════════════════
- Adresse: ${bailCommercialData.adresseLocal}
- Nature: ${bailCommercialData.natureLocal}
- Surface totale: ${bailCommercialData.surfaceTotale} m²

═══════════════════════════════════════════════════════════════
ACTIVITÉ
═══════════════════════════════════════════════════════════════
- Activité principale autorisée: ${bailCommercialData.activitePrincipale}

═══════════════════════════════════════════════════════════════
CONDITIONS FINANCIÈRES
═══════════════════════════════════════════════════════════════
- Loyer mensuel HT: ${bailCommercialData.loyerMensuelHT} €
- Charges mensuelles: ${bailCommercialData.chargesMensuelles} €

═══════════════════════════════════════════════════════════════
DURÉE DU BAIL
═══════════════════════════════════════════════════════════════
- Type de bail: ${bailCommercialData.typeBail}
- Date de prise d'effet: ${bailCommercialData.datePriseEffet}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Bail commercial - ${bailCommercialData.adresseLocal}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Bail commercial créé avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setBailCommercialData({
        clientRole: "",
        clientId: "",
        bailleurClientId: "",
        statutBailleur: "",
        bailleurNom: "",
        bailleurPrenom: "",
        bailleurAdresse: "",
        bailleurDateNaissance: "",
        bailleurLieuNaissance: "",
        bailleurNationalite: "",
        bailleurStatutMatrimonial: "",
        bailleurRegimeMatrimonial: "",
        bailleurProfession: "",
        bailleurDenomination: "",
        bailleurFormeJuridique: "",
        bailleurSiren: "",
        bailleurSiret: "",
        bailleurSiegeSocial: "",
        bailleurCapitalSocial: "",
        bailleurRepresentant: "",
        bailleurRepresentantPrenom: "",
        bailleurRepresentantFonction: "",
        bailleurRepresentantEstLegal: "",
        bailleurMandataireNom: "",
        bailleurMandatairePrenom: "",
        bailleurMandataireTypePouvoir: "",
        locataireClientId: "",
        statutLocataire: "",
        locataireNom: "",
        locatairePrenom: "",
        locataireAdresse: "",
        locataireDateNaissance: "",
        locataireLieuNaissance: "",
        locataireNationalite: "",
        locataireStatutMatrimonial: "",
        locataireRegimeMatrimonial: "",
        locataireProfession: "",
        locataireTelephone: "",
        locataireEmail: "",
        locataireExerceEnNomPropre: "",
        locataireActivite: "",
        locataireSirenPersonnel: "",
        locataireEntrepriseEnCreation: "",
        locataireImmatriculation: "",
        locataireDenomination: "",
        locataireFormeJuridique: "",
        locataireSiege: "",
        locataireSiren: "",
        locataireSiret: "",
        locataireObjetSocial: "",
        locataireCapital: "",
        locataireRepresentant: "",
        locataireRepresentantPrenom: "",
        locataireRepresentantFonction: "",
        locataireMandataireNom: "",
        locataireMandatairePrenom: "",
        locataireMandataireTypePouvoir: "",
        activitePrincipale: "",
        activitesAnnexes: "",
        destinationBail: "",
        clauseExclusivite: "",
        clauseNonConcurrence: "",
        adresseLocal: "",
        natureLocal: "",
        surfaceTotale: "",
        lotsCopropriete: "",
        etageNumero: "",
        partiesPrivatives: [],
        longueurVitrine: "",
        accesLivraison: "",
        etatGeneral: "",
        travauxBailleur: "",
        travauxLocataire: "",
        etatLocalRemise: "",
        diagnosticAmiante: "",
        typeBail: "",
        datePriseEffet: "",
        dureeTotale: "",
        renouvellementAuto: "",
        loyerAnnuelHT: "",
        loyerMensuelHT: "",
        modalitePaiement: "",
        typeIndexation: "",
        chargesMensuelles: "",
        typeCharges: "",
        depotGarantie: "",
        modePaiementLoyer: "",
        ibanBailleur: "",
        chargesLocataire: [],
        chargesBailleur: [],
        compteursIndividuels: "",
        cautionPersonnelle: "",
        garantieBancaire: "",
        montantGaranti: "",
        dureeGarantie: "",
        diagnosticDPE: "",
        diagnosticAmianteDTA: "",
        diagnosticERP: "",
        diagnosticElectricite: "",
        diagnosticGaz: "",
        diagnosticTermites: "",
        attestationConformiteERP: "",
        cedabilite: "",
        conditionsCession: "",
        droitPreemptionCommune: "",
        derogationUsageLocal: "",
        clauseRecettes: "",
        clauseNonAffectation: "",
        clauseNonConcurrenceDetails: "",
        presenceCompteurs: "",
        releveCompteurs: "",
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création bail commercial:', err);
      toast.error('Erreur lors de la création du bail commercial');
    }
  };

  const handleIndivisionSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!indivisionData.typeBien || !indivisionData.origineIndivision) {
        toast.error('Veuillez remplir les champs obligatoires (type de bien, origine)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: Convention d'indivision

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Type de bien: ${indivisionData.typeBien}
${indivisionData.typeBien === "autre" ? `- Précision: ${indivisionData.typeBienAutre}` : ""}
- Origine de l'indivision: ${indivisionData.origineIndivision}
${indivisionData.origineIndivision === "autre" ? `- Précision: ${indivisionData.origineIndivisionAutre}` : ""}
- Objet: ${indivisionData.objetConvention}

═══════════════════════════════════════════════════════════════
INDIVISAIRES
═══════════════════════════════════════════════════════════════
Nombre d'indivisaires: ${indivisionData.indivisaires.length}
${indivisionData.indivisaires.map((ind, idx) => `
Indivisaire ${idx + 1}:
- Nom: ${ind.nom} ${ind.prenom}
- Quote-part: ${ind.quotePart}%
`).join('')}

═══════════════════════════════════════════════════════════════
BIEN EN INDIVISION
═══════════════════════════════════════════════════════════════
${indivisionData.typeBien === "immobilier" ? `- Adresse: ${indivisionData.adresseBien}
- Nature: ${indivisionData.natureBienImmobilier}
- Description: ${indivisionData.descriptionBien}
- Surface: ${indivisionData.surfaceBien} m²
- Références cadastrales: ${indivisionData.referencesCadastrales}
- État locatif: ${indivisionData.etatLocatif}
- Valeur vénale: ${indivisionData.valeurVenale} €` : 
indivisionData.typeBien === "mobilier" ? `- Description: ${indivisionData.descriptionBienMobilier}
- Valeur estimée: ${indivisionData.valeurEstimee} €` : ""}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Convention d'indivision - ${indivisionData.adresseBien || indivisionData.descriptionBienMobilier || 'Bien indivis'}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Convention d'indivision créée avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setIndivisionData({
        typeBien: "",
        typeBienAutre: "",
        origineIndivision: "",
        origineIndivisionAutre: "",
        objetConvention: "",
        indivisaires: [{
          id: 1,
          isClient: false,
          clientId: "",
          nom: "",
          prenom: "",
          adresse: "",
          dateNaissance: "",
          lieuNaissance: "",
          nationalite: "",
          profession: "",
          statutMatrimonial: "",
          regimeMatrimonial: "",
          typeIdentite: "",
          numeroIdentite: "",
          email: "",
          telephone: "",
          quotePart: "",
          origineQuotePart: "",
        }],
        adresseBien: "",
        natureBienImmobilier: "",
        descriptionBien: "",
        surfaceBien: "",
        referencesCadastrales: "",
        etatLocatif: "",
        montantLoyer: "",
        dureeBail: "",
        valeurVenale: "",
        dateEstimation: "",
        sourceEstimation: "",
        descriptionBienMobilier: "",
        valeurEstimee: "",
        numerosSerie: "",
        dureeType: "",
        dureeAnnees: "",
        conditionsRenouvellement: "",
        conditionsSortie: "",
        gerantNom: "",
        gerantPrenom: "",
        gerantEstIndivisaire: "",
        pouvoirsGerant: [],
        pouvoirsAutres: "",
        dureeMandat: "",
        decisionsType: "",
        casUnanimite: "",
        chargesRepartition: "",
        chargesRepartitionAutre: "",
        modalitesRemboursement: "",
        compteBancaire: "",
        compteTitulaires: "",
        compteModalites: "",
        utilisationParIndivisaires: "",
        utilisationConditions: "",
        indemnitéOccupation: "",
        indemniteOccupationMontant: "",
        indemniteOccupationFrequence: "",
        locationAutorisee: "",
        locationMandataire: "",
        locationRepartitionLoyers: "",
        travauxAutorises: "",
        travauxDecision: "",
        travauxRepartitionCouts: "",
        travauxUrgents: "",
        travauxDocumentation: "",
        ventePartLibre: "",
        droitPreemption: "",
        evaluationPart: "",
        delaiRachat: "",
        modalitesPaiement: "",
        conditionsMiseEnVente: "",
        decisionVente: "",
        mandataireVente: "",
        repartitionPrix: "",
        gestionPlusValues: "",
        registreDepenses: "",
        archivageFactures: "",
        modalitesRemboursementAvances: "",
        rapportAnnuel: "",
        resolutionLitiges: [],
        solidariteDettes: "",
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création convention d\'indivision:', err);
      toast.error('Erreur lors de la création de la convention');
    }
  };

  const handleMainleveeSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!mainleveeData.informationsGenerales.typeMainlevee || !mainleveeData.informationsGenerales.natureInscription) {
        toast.error('Veuillez remplir les champs obligatoires (type de mainlevée, nature de l\'inscription)');
        return;
      }

      const descriptionData = `
TYPE DE CONTRAT: Mainlevée d'hypothèque

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Type de mainlevée: ${mainleveeData.informationsGenerales.typeMainlevee}
${mainleveeData.informationsGenerales.typeMainlevee === "partielle" ? `- Précision: ${mainleveeData.informationsGenerales.precisionPartielle}` : ""}
- Nature de l'inscription: ${mainleveeData.informationsGenerales.natureInscription}
- Numéro d'inscription: ${mainleveeData.informationsGenerales.numeroInscription}
- Date d'inscription: ${mainleveeData.informationsGenerales.dateInscription}
- Volume: ${mainleveeData.informationsGenerales.volume}
- Numéro de publication: ${mainleveeData.informationsGenerales.numeroPublication}

═══════════════════════════════════════════════════════════════
CRÉANCIER
═══════════════════════════════════════════════════════════════
Type: ${mainleveeData.creancier.typeCreancier}
${mainleveeData.creancier.typeCreancier === "banque" ? `
- Dénomination: ${mainleveeData.creancierBanque.denomination}
- SIREN: ${mainleveeData.creancierBanque.siren}
- Siège social: ${mainleveeData.creancierBanque.siegeSocial}
- Représentant: ${mainleveeData.creancierBanque.representantNom} ${mainleveeData.creancierBanque.representantPrenom}
- Fonction: ${mainleveeData.creancierBanque.representantFonction}
` : `
- Nom: ${mainleveeData.creancierPersonne.nom} ${mainleveeData.creancierPersonne.prenom}
- Date de naissance: ${mainleveeData.creancierPersonne.dateNaissance}
- Lieu de naissance: ${mainleveeData.creancierPersonne.lieuNaissance}
- Adresse: ${mainleveeData.creancierPersonne.adresse}
- Nationalité: ${mainleveeData.creancierPersonne.nationalite}
- Situation familiale: ${mainleveeData.creancierPersonne.situationFamiliale}
${mainleveeData.creancierPersonne.regimeMatrimonial ? `- Régime matrimonial: ${mainleveeData.creancierPersonne.regimeMatrimonial}` : ""}
`}

═══════════════════════════════════════════════════════════════
DÉBITEURS
═══════════════════════════════════════════════════════════════
Nombre de débiteurs: ${mainleveeData.debiteurs.length}
${mainleveeData.debiteurs.map((deb, idx) => `
Débiteur ${idx + 1}:
- Nom: ${deb.nom} ${deb.prenom}
- Date de naissance: ${deb.dateNaissance}
- Lieu de naissance: ${deb.lieuNaissance}
- Adresse: ${deb.adresse}
- Situation familiale: ${deb.situationFamiliale}
${deb.regimeMatrimonial ? `- Régime matrimonial: ${deb.regimeMatrimonial}` : ""}
- Qualité: ${deb.qualite}
`).join('')}

═══════════════════════════════════════════════════════════════
ACTE CONSTITUTIF
═══════════════════════════════════════════════════════════════
- Date de signature: ${mainleveeData.acteOrigine.dateSignature}
- Nature de l'acte: ${mainleveeData.acteOrigine.natureActe}
- Notaire/Auteur: ${mainleveeData.acteOrigine.notaireAuteur}
- Date de publication: ${mainleveeData.acteOrigine.datePublication}
- Numéro de publication: ${mainleveeData.acteOrigine.numeroPublication}

CONDITIONS DU PRÊT:
- Montant initial: ${mainleveeData.conditionsPret.montantInitial} €
- Taux d'intérêt: ${mainleveeData.conditionsPret.tauxInteret}
- Durée: ${mainleveeData.conditionsPret.dureePret}
- Numéro de contrat: ${mainleveeData.conditionsPret.numeroContrat}
- Établissement prêteur: ${mainleveeData.conditionsPret.etablissementPreteur}
- Numéro de dossier: ${mainleveeData.conditionsPret.numeroDossier}

═══════════════════════════════════════════════════════════════
BIENS HYPOTHÉQUÉS
═══════════════════════════════════════════════════════════════
Nombre de biens: ${mainleveeData.biens.length}
${mainleveeData.biens.map((bien, idx) => `
Bien ${idx + 1}:
- Adresse: ${bien.adresse}
- Type: ${bien.typeBien}
- Description: ${bien.descriptionBien}
- Mode de détention: ${bien.modeDetention === "propriete_exclusive" ? "Propriété exclusive" : bien.modeDetention === "indivision" ? `Indivision (${bien.quotepartsIndivision})` : bien.modeDetention === "communaute_acquets" ? "Communauté réduite aux acquêts" : bien.modeDetention === "separation_biens" ? "Séparation de biens" : bien.modeDetention === "autre" ? `Autre: ${bien.autreRegime}` : "Non précisé"}
- Cadastre: Section ${bien.cadastreSection}, Parcelle ${bien.cadastreParcelle}
- Contenance: ${bien.cadastreContenance}
${bien.estCopropriete === "oui" ? `- Copropriété: Lot n°${bien.numeroLot}, Quote-part: ${bien.quotePart}` : ""}
`).join('')}

═══════════════════════════════════════════════════════════════
DÉCLARATION DU CRÉANCIER
═══════════════════════════════════════════════════════════════
- Créance intégralement payée: ${mainleveeData.declaration.creancePayee ? "Oui" : "Non"}
- Aucune dette subsistante: ${mainleveeData.declaration.aucuneDette ? "Oui" : "Non"}
- Consent à la mainlevée: ${mainleveeData.declaration.consentMainlevee ? "Oui" : "Non"}
- Renonce à l'inscription: ${mainleveeData.declaration.renonciation ? "Oui" : "Non"}
- Demande la radiation au SPF: ${mainleveeData.declaration.demandeRadiation ? "Oui" : "Non"}

═══════════════════════════════════════════════════════════════
MANDAT/PROCURATION
═══════════════════════════════════════════════════════════════
${mainleveeData.mandataire.existe === "oui" ? `
- Mandataire: ${mainleveeData.mandataire.nom} ${mainleveeData.mandataire.prenom}
- Fonction: ${mainleveeData.mandataire.fonction}
- Pouvoirs: ${mainleveeData.mandataire.pouvoirSigner ? "Signer la mainlevée" : ""}${mainleveeData.mandataire.pouvoirDeposer ? ", Déposer au SPF" : ""}
` : "Aucun mandataire"}

═══════════════════════════════════════════════════════════════
CONSENTEMENT DÉBITEUR
═══════════════════════════════════════════════════════════════
${mainleveeData.consentementDebiteur.requis === "oui" ? `
- Accord pour la radiation: ${mainleveeData.consentementDebiteur.accordRadiation ? "Oui" : "Non"}
- Déclarations complémentaires: ${mainleveeData.consentementDebiteur.declarationsComplementaires}
` : "Non requis"}

═══════════════════════════════════════════════════════════════
FRAIS
═══════════════════════════════════════════════════════════════
- Frais de radiation: ${mainleveeData.frais.fraisRadiation} €
- Honoraires: ${mainleveeData.frais.honoraires} €
- Timbres fiscaux: ${mainleveeData.frais.timbresFiscaux} €
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Mainlevée d'hypothèque - ${mainleveeData.debiteurs[0]?.nom || 'Débiteur'} - ${mainleveeData.biens[0]?.adresse || 'Bien'}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Mainlevée d'hypothèque créée avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire
      setMainleveeData({
        informationsGenerales: {
          typeMainlevee: "",
          precisionPartielle: "",
          natureInscription: "",
          numeroInscription: "",
          dateInscription: "",
          volume: "",
          numeroPublication: "",
        },
        creancier: {
          typeCreancier: "",
        },
        creancierBanque: {
          denomination: "",
          siren: "",
          siegeSocial: "",
          representantNom: "",
          representantPrenom: "",
          representantFonction: "",
        },
        creancierPersonne: {
          isClient: false,
          clientId: "",
          nom: "",
          prenom: "",
          dateNaissance: "",
          lieuNaissance: "",
          adresse: "",
          nationalite: "",
          situationFamiliale: "",
          regimeMatrimonial: "",
          typeIdentite: "",
          numeroIdentite: "",
        },
        debiteurs: [{
          id: 1,
          isClient: false,
          clientId: "",
          nom: "",
          prenom: "",
          dateNaissance: "",
          lieuNaissance: "",
          adresse: "",
          nationalite: "",
          situationFamiliale: "",
          regimeMatrimonial: "",
          qualite: "",
          typeIdentite: "",
          numeroIdentite: "",
        }],
        acteOrigine: {
          dateSignature: "",
          natureActe: "",
          notaireAuteur: "",
          datePublication: "",
          numeroPublication: "",
        },
        conditionsPret: {
          montantInitial: "",
          tauxInteret: "",
          dureePret: "",
          numeroContrat: "",
          etablissementPreteur: "",
          numeroDossier: "",
        },
        biens: [{
          id: 1,
          adresse: "",
          descriptionBien: "",
          typeBien: "",
          modeDetention: "",
          quotepartsIndivision: "",
          autreRegime: "",
          cadastreSection: "",
          cadastreParcelle: "",
          cadastreContenance: "",
          estCopropriete: "non",
          numeroLot: "",
          quotePart: "",
        }],
        declaration: {
          creancePayee: false,
          aucuneDette: false,
          consentMainlevee: false,
          renonciation: false,
          demandeRadiation: false,
        },
        mandataire: {
          existe: "non",
          nom: "",
          prenom: "",
          fonction: "",
          pouvoirSigner: false,
          pouvoirDeposer: false,
        },
        consentementDebiteur: {
          requis: "non",
          accordRadiation: false,
          declarationsComplementaires: "",
        },
        frais: {
          fraisRadiation: "",
          honoraires: "",
          timbresFiscaux: "",
        },
      });

      refreshContrats();
    } catch (err) {
      console.error('Erreur création mainlevée d\'hypothèque:', err);
      toast.error('Erreur lors de la création de la mainlevée');
    }
  };

  const handleContratMariageSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      if (!contratMariageData.typeRegime) {
        toast.error('Veuillez sélectionner un type de régime matrimonial');
        return;
      }

      if (!contratMariageData.dateMariagePrevue) {
        toast.error('Veuillez renseigner la date prévue du mariage');
        return;
      }

      if (!contratMariageData.lieuMariage.mairie || !contratMariageData.lieuMariage.commune) {
        toast.error('Veuillez renseigner le lieu du mariage (mairie et commune obligatoires)');
        return;
      }

      const regimeLabels: Record<string, string> = {
        separation_biens: "Séparation de biens",
        communaute_acquets: "Communauté réduite aux acquêts",
        communaute_acquets_amenagee: "Communauté réduite aux acquêts aménagée",
        communaute_universelle: "Communauté universelle",
        participation_acquets: "Participation aux acquêts",
        autre: contratMariageData.autreRegimePrecision
      };

      const descriptionData = `
TYPE DE CONTRAT: Contrat de mariage prénuptial (régimes matrimoniaux)

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Régime matrimonial choisi: ${regimeLabels[contratMariageData.typeRegime] || contratMariageData.typeRegime}

DATE ET LIEU DU MARIAGE:
- Date prévue: ${contratMariageData.dateMariagePrevue || "Non renseignée"}
- Mairie: ${contratMariageData.lieuMariage.mairie || "Non renseignée"}
- Commune: ${contratMariageData.lieuMariage.commune || "Non renseignée"}
- Département: ${contratMariageData.lieuMariage.departement || "Non renseigné"}
- Pays: ${contratMariageData.lieuMariage.pays || "France"}

LOI APPLICABLE:
- ${contratMariageData.choixLoiApplicable === "autre" ? contratMariageData.choixLoiApplicableAutre : contratMariageData.choixLoiApplicable}

═══════════════════════════════════════════════════════════════
ÉPOUX
═══════════════════════════════════════════════════════════════
${contratMariageData.epoux.map((epoux, idx) => `
Époux ${idx + 1}:
- Nom: ${epoux.nom} ${epoux.prenom}
- Date de naissance: ${epoux.dateNaissance}
- Lieu de naissance: ${epoux.lieuNaissance}
- Nationalité: ${epoux.nationalite}
- Profession: ${epoux.profession}
- Situation familiale: ${epoux.situationFamiliale}
- Domicile actuel: ${epoux.domicileActuel}
${epoux.domicileApresMariage ? `- Domicile après mariage: ${epoux.domicileApresMariage}` : ""}
${epoux.mariageAnterieurtHorsFrance === "oui" ? `
MARIAGE ANTÉRIEUR HORS FRANCE:
- Date: ${epoux.datePremierMariage}
- Lieu: ${epoux.lieuPremierMariage}
- Régime initial: ${epoux.regimeMatrimonialInitial}
` : ""}
`).join('')}

═══════════════════════════════════════════════════════════════
ENFANTS (si changement de régime)
═══════════════════════════════════════════════════════════════
${contratMariageData.nombreEnfants ? `
- Nombre d'enfants: ${contratMariageData.nombreEnfants}
- Enfants mineurs: ${contratMariageData.enfantsMineurs}
- Information au juge: ${contratMariageData.informationJugeNecessaire}
` : "Non applicable"}

═══════════════════════════════════════════════════════════════
CLAUSES SPÉCIFIQUES DU RÉGIME
═══════════════════════════════════════════════════════════════
Régime: ${regimeLabels[contratMariageData.typeRegime] || contratMariageData.typeRegime}

${contratMariageData.typeRegime === "separation_biens" ? `
SÉPARATION DE BIENS:
- Administration exclusive: ${contratMariageData.clausesSeparation.administrationExclusive ? "Oui" : "Non"}
- Comptes séparés: ${contratMariageData.clausesSeparation.comptesSepares ? "Oui" : "Non"}
- Contribution aux charges: ${contratMariageData.clausesSeparation.contributionCharges}
` : ""}

${contratMariageData.typeRegime === "communaute_universelle" ? `
COMMUNAUTÉ UNIVERSELLE:
- Attribution intégrale au survivant: ${contratMariageData.clausesCommunauteUniverselle.attributionIntegraleSurvivant}
- Clause de préciput: ${contratMariageData.clausesCommunauteUniverselle.clausesPreciput}
- Exclusions de biens: ${contratMariageData.clausesCommunauteUniverselle.exclusionCertainsBiens}
` : ""}

${contratMariageData.typeRegime === "participation_acquets" ? `
PARTICIPATION AUX ACQUÊTS:
- Patrimoine originel défini: ${contratMariageData.clausesParticipation.definitionPatrimoinesOriginels}
- Calcul créance: ${contratMariageData.clausesParticipation.calculCreanceParticipation}
` : ""}

═══════════════════════════════════════════════════════════════
DÉCLARATIONS DES ÉPOUX
═══════════════════════════════════════════════════════════════
- Identité: ${contratMariageData.declarations.identite ? "✓" : "✗"}
- Capacité juridique: ${contratMariageData.declarations.capaciteJuridique ? "✓" : "✗"}
- Choix libre et éclairé: ${contratMariageData.declarations.choixLibreEclaire ? "✓" : "✗"}
- Connaissance des effets juridiques: ${contratMariageData.declarations.connaissanceEffetsJuridiques ? "✓" : "✗"}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Contrat de mariage - ${contratMariageData.epoux[0]?.nom || 'Époux 1'} & ${contratMariageData.epoux[1]?.nom || 'Époux 2'}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;
      
      toast.success("Contrat de mariage créé avec succès");
      setShowQuestionDialog(false);
      
      // Réinitialiser le formulaire (structure minimale pour ne pas alourdir)
      setContratMariageData({
        typeRegime: "",
        autreRegimePrecision: "",
        typeContrat: "prenuptial",
        dateMariagePrevue: "",
        lieuMariage: {
          mairie: "",
          commune: "",
          departement: "",
          pays: "France",
        },
        dateMariage: "",
        regimeActuel: "",
        regimeActuelAutre: "",
        motifChangement: "",
        accordEnfantsMajeurs: "",
        accordCreancier: "",
        consentementEnfantsMajeursRequis: "non",
        liquidationRegimeActuel: "non",
        biensCommuns: [{
          id: 1,
          description: "",
          valeurEstimee: "",
          dettesAttachees: "",
          affectationPrevue: "",
          repartitionEnvisagee: "",
        }],
        passifCommun: [{
          id: 1,
          description: "",
          montant: "",
          modeRepartition: "",
        }],
        soulte: {
          soulteDue: "non",
          montantSoulte: "",
          epouxDebiteur: "",
          modalitesPaiement: "",
          dateLimitePaiement: "",
        },
        actifsFinanciers: [{
          id: 1,
          natureCompte: "",
          etablissement: "",
          solde: "",
          modePartage: "",
          partagePersonnalise: "",
        }],
        observationsLiquidation: "",
        choixLoiApplicable: "loi_francaise",
        choixLoiApplicableAutre: "",
        accordJugeRequis: "non",
        epoux: [
          {
            id: 1,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            adresse: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            lieuEmissionIdentite: "",
            domicileActuel: "",
            domicileApresMariage: "",
            mariageAnterieurtHorsFrance: "non",
            datePremierMariage: "",
            lieuPremierMariage: "",
            regimeMatrimonialInitial: "",
            acteEtatCivilEtranger: "",
          },
          {
            id: 2,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            adresse: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            lieuEmissionIdentite: "",
            domicileActuel: "",
            domicileApresMariage: "",
            mariageAnterieurtHorsFrance: "non",
            datePremierMariage: "",
            lieuPremierMariage: "",
            regimeMatrimonialInitial: "",
            acteEtatCivilEtranger: "",
          },
        ],
        nombreEnfants: "",
        enfantsMajeurs: [{
          id: 1,
          nom: "",
          prenom: "",
          adresse: "",
          accordInformation: "",
        }],
        enfantsMineurs: "",
        informationJugeNecessaire: "",
        patrimoineEpoux1: {
          biensPropres: "",
          biensAcquisPendantMariage: "",
          valeurEstimee: "",
          dettesPersonnelles: "",
          dettesCommunes: "",
          masseDepart: "",
          masseFin: "",
        },
        patrimoineEpoux2: {
          biensPropres: "",
          biensAcquisPendantMariage: "",
          valeurEstimee: "",
          dettesPersonnelles: "",
          dettesCommunes: "",
          masseDepart: "",
          masseFin: "",
        },
        clausesSeparation: {
          administrationExclusive: false,
          comptesSepares: false,
          contributionCharges: "",
          contributionChargesAutre: "",
          miseEnCommunBien: "",
          abandonCreance: "",
        },
        clausesCommunauteAmenagee: {
          definitionBiensCommunsPropres: "",
          amenagementBiensProfessionnels: "",
          contributionCharges: "",
          repartitionDettes: "",
          typeAdministration: "",
          pouvoirUniqueDetails: "",
        },
        clausesCommunauteUniverselle: {
          tousLiensCommunsPresentsEtFuturs: true,
          attributionIntegraleSurvivant: "",
          clausesPreciput: "",
          exclusionCertainsBiens: "",
        },
        clausesParticipation: {
          definitionPatrimoinesOriginels: "",
          definitionPatrimoineFinal: "",
          calculCreanceParticipation: "",
          renonciationCreance: "",
          biensPropresParNature: "",
        },
        clausesAvancees: {
          clauseRemploi: "",
          clausePreciput: "",
          attributionPreferentielle: "",
          gestionSepareeBiensProfessionnels: "",
          protectionConjointSurvivant: "",
          donationEntreEpoux: "",
          solidariteDetteSpecifiques: "",
        },
        declarations: {
          identite: true,
          capaciteJuridique: true,
          situationMatrimoniale: true,
          absenceOpposition: true,
          choixLibreEclaire: true,
          connaissanceEffetsJuridiques: true,
        },
      });

      // Reset file uploads
      setContratMariageEpoux1IdentiteFiles([]);
      setContratMariageEpoux2IdentiteFiles([]);
      setContratMariageEpoux1ActeNaissanceFiles([]);
      setContratMariageEpoux2ActeNaissanceFiles([]);
      setContratMariageEpoux1DomicileFiles([]);
      setContratMariageEpoux2DomicileFiles([]);
      setContratMariageContratInitialFiles([]);
      setContratMariageJustificatifMariageFiles([]);
      setContratMariageAccordEnfantsFiles([]);
      setContratMariageTitresProprieteFiles([]);
      setContratMariageEstimationBiensFiles([]);
      setContratMariageActeDecesFiles([]);
      setContratMariageConsentementEnfantsFiles([]);
      setContratMariageCertificatBansFiles([]);
      setContratMariageDecisionJugeFiles([]);

      refreshContrats();
    } catch (err) {
      console.error('Erreur création contrat de mariage:', err);
      toast.error('Erreur lors de la création du contrat de mariage');
    }
  };

  const handlePacsSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      // Validations obligatoires
      if (!pacsData.regimePacs) {
        toast.error('Veuillez sélectionner un régime de PACS');
        return;
      }

      if (!pacsData.adresseCommune) {
        toast.error('Veuillez renseigner l\'adresse commune (obligatoire pour l\'enregistrement)');
        return;
      }

      if (!pacsData.declarations.residenceCommune || !pacsData.declarations.absenceLienParente || !pacsData.declarations.absenceMariageEtPacs) {
        toast.error('Veuillez valider toutes les déclarations sur l\'honneur obligatoires');
        return;
      }

      const regimeLabels: Record<string, string> = {
        separation: "Séparation de biens (régime légal par défaut)",
        indivision: "Indivision",
        personnalise: "Régime personnalisé"
      };

      const objetLabels: Record<string, string> = {
        initial: "PACS initial",
        modification: "Modification de PACS existant",
        dissolution: "Dissolution de PACS"
      };

      const descriptionData = `
TYPE DE CONTRAT: PACS (Pacte Civil de Solidarité)

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Objet du PACS: ${objetLabels[pacsData.objetPacs] || pacsData.objetPacs}
- Régime choisi: ${regimeLabels[pacsData.regimePacs] || pacsData.regimePacs}
${pacsData.regimePacs === "personnalise" ? `
  • Définition biens communs: ${pacsData.regimePersonnalise.definitionBiensCommuns || "Non renseigné"}
  • Biens propres: ${pacsData.regimePersonnalise.biensPropres || "Non renseigné"}
  • Clauses spécifiques: ${pacsData.regimePersonnalise.clausesSpecifiques || "Non renseigné"}
` : ""}
- Date de prise d'effet souhaitée: ${pacsData.datePriseEffetSouhaitee || "À l'enregistrement"}

${pacsData.objetPacs === "modification" ? `
RÉFÉRENCE DU PACS INITIAL:
- Date: ${pacsData.pacsInitialDate || "Non renseignée"}
- Mairie/Notaire: ${pacsData.pacsInitialMairie || "Non renseigné"}
- Numéro d'enregistrement: ${pacsData.pacsInitialNumero || "Non renseigné"}
- Clauses modifiées: ${pacsData.clausesModifiees || "Non renseigné"}
` : ""}

═══════════════════════════════════════════════════════════════
PARTENAIRES
═══════════════════════════════════════════════════════════════
${pacsData.partenaires.map((p, idx) => `
Partenaire ${idx + 1}:
- Nom: ${p.nom} ${p.prenom}
- Nom de naissance: ${p.nomNaissance || p.nom}
- Date de naissance: ${p.dateNaissance || "Non renseignée"}
- Lieu de naissance: ${p.lieuNaissance || "Non renseigné"}
- Nationalité: ${p.nationalite || "Non renseignée"}
- Profession: ${p.profession || "Non renseignée"}
- Adresse actuelle: ${p.adresseActuelle || "Non renseignée"}
- Téléphone: ${p.telephone || "Non renseigné"}
- Email: ${p.email || "Non renseigné"}
- Situation familiale: ${p.situationFamiliale || "Non renseignée"}
- Pièce d'identité: ${p.typeIdentite || "Non renseigné"} n°${p.numeroIdentite || "Non renseigné"}
  Délivrée le ${p.dateEmissionIdentite || "Non renseigné"} par ${p.autoriteDelivrante || "Non renseigné"}
${p.estEtranger ? `
  ⚠️ PARTENAIRE ÉTRANGER:
  - Attestation non-PACS pays d'origine: ${p.attestationNonPacsPaysOrigine ? "Oui" : "Non"}
  - Certificat de coutume requis: ${p.certificatCoutumeRequis ? "Oui" : "Non"}
  - Traduction requise: ${p.traductionRequise ? "Oui" : "Non"}
` : ""}
`).join('\n')}

═══════════════════════════════════════════════════════════════
ADRESSE COMMUNE (OBLIGATOIRE)
═══════════════════════════════════════════════════════════════
- Adresse commune déclarée: ${pacsData.adresseCommune}
- Date de début de résidence commune: ${pacsData.dateDebutResidenceCommune || "Non renseignée"}

═══════════════════════════════════════════════════════════════
CLAUSES DU PACS
═══════════════════════════════════════════════════════════════
A. CLAUSES OBLIGATOIRES
- Contribution aux charges du ménage: ${pacsData.contributionCharges === "proportionnelle" ? "Proportionnelle aux revenus" : pacsData.contributionCharges === "50_50" ? "50/50" : pacsData.contributionChargesAutre || "Non renseigné"}

B. CLAUSES FACULTATIVES
${pacsData.clausesFacultatives.gestionBiensPersonnels ? `- Gestion des biens personnels: ${pacsData.clausesFacultatives.gestionBiensPersonnels}` : ""}
${pacsData.clausesFacultatives.gestionBienCommun ? `- Gestion d'un bien commun: ${pacsData.clausesFacultatives.gestionBienCommun}` : ""}
${pacsData.clausesFacultatives.usageBienIndivis ? `- Usage d'un bien indivis: ${pacsData.clausesFacultatives.usageBienIndivis}` : ""}
${pacsData.clausesFacultatives.repartitionDepensesSpecifiques ? `- Répartition dépenses spécifiques: ${pacsData.clausesFacultatives.repartitionDepensesSpecifiques}` : ""}
${pacsData.clausesFacultatives.clauseOccupationLogementSeparation ? `- Clause occupation logement en cas de séparation: ${pacsData.clausesFacultatives.clauseOccupationLogementSeparation}` : ""}
${pacsData.clausesFacultatives.clauseRepriseBienDeces ? `- Clause reprise bien en cas de décès: ${pacsData.clausesFacultatives.clauseRepriseBienDeces}` : ""}
${pacsData.clausesFacultatives.clauseAbandonCreance ? `- Clause abandon de créance: ${pacsData.clausesFacultatives.clauseAbandonCreance}` : ""}
${pacsData.clausesFacultatives.modalitesCompteBancaireCommun ? `- Modalités compte bancaire commun: ${pacsData.clausesFacultatives.modalitesCompteBancaireCommun}` : ""}
${pacsData.clausesFacultatives.clausesFinancieresPersonnalisees ? `- Clauses financières personnalisées: ${pacsData.clausesFacultatives.clausesFinancieresPersonnalisees}` : ""}
${pacsData.clausesFacultatives.clausesSolidariteDettes ? `- Clauses solidarité sur dettes: ${pacsData.clausesFacultatives.clausesSolidariteDettes}` : ""}

═══════════════════════════════════════════════════════════════
DÉCLARATIONS SUR L'HONNEUR (OBLIGATOIRES)
═══════════════════════════════════════════════════════════════
✓ Déclaration de résidence commune: ${pacsData.declarations.residenceCommune ? "Oui" : "Non"}
✓ Déclaration d'absence de lien de parenté: ${pacsData.declarations.absenceLienParente ? "Oui" : "Non"}
✓ Déclaration d'absence de mariage et PACS en cours: ${pacsData.declarations.absenceMariageEtPacs ? "Oui" : "Non"}

${pacsData.enfantEnCommun === "oui" ? `
═══════════════════════════════════════════════════════════════
ENFANT(S) EN COMMUN
═══════════════════════════════════════════════════════════════
${pacsData.enfants.map((e, idx) => `
Enfant ${idx + 1}:
- Nom: ${e.nom} ${e.prenom}
- Date de naissance: ${e.dateNaissance || "Non renseignée"}
- Autorité parentale: ${e.autoriteParentale || "Non renseignée"}
`).join('\n')}
` : ""}

${pacsData.droitApplicable !== "francais" ? `
═══════════════════════════════════════════════════════════════
RÉGIME PATRIMONIAL ÉTRANGER
═══════════════════════════════════════════════════════════════
- Droit applicable: ${pacsData.droitApplicableAutre || pacsData.droitApplicable}
- Clause de priorité du droit français pour le PACS appliquée
` : ""}

${pacsData.biensPreexistants === "oui" ? `
═══════════════════════════════════════════════════════════════
BIENS DÉJÀ ACQUIS ENSEMBLE
═══════════════════════════════════════════════════════════════
${pacsData.biensListe.map((b, idx) => `
Bien ${idx + 1}:
- Description: ${b.description || "Non renseigné"}
- Quote-part partenaire 1: ${b.quotePart1 || "Non renseigné"}
- Quote-part partenaire 2: ${b.quotePart2 || "Non renseigné"}
- Indivision: ${b.indivision || "Non renseigné"}
`).join('\n')}
` : ""}
      `.trim();

      const { data, error } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          role: role,
          type: 'pacs',
          name: `PACS - ${pacsData.partenaires[0]?.nom || "Sans nom"} & ${pacsData.partenaires[1]?.nom || "Sans nom"}`,
          status: 'draft',
          description: descriptionData,
        })
        .select()
        .single();

      if (error) throw error;

      toast.success('Convention de PACS créée avec succès');

      // Reset du formulaire
      setPacsData({
        objetPacs: "initial",
        regimePacs: "separation",
        regimePersonnalise: {
          definitionBiensCommuns: "",
          biensPropres: "",
          clausesSpecifiques: "",
        },
        datePriseEffetSouhaitee: "",
        pacsInitialDate: "",
        pacsInitialMairie: "",
        pacsInitialNumero: "",
        clausesModifiees: "",
        partenaires: [
          {
            id: 1,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            nomNaissance: "",
            adresseActuelle: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            telephone: "",
            email: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            autoriteDelivrante: "",
            estEtranger: false,
            attestationNonPacsPaysOrigine: false,
            certificatCoutumeRequis: false,
            traductionRequise: false,
          },
          {
            id: 2,
            isClient: false,
            clientId: "",
            nom: "",
            prenom: "",
            nomNaissance: "",
            adresseActuelle: "",
            dateNaissance: "",
            lieuNaissance: "",
            nationalite: "",
            profession: "",
            telephone: "",
            email: "",
            situationFamiliale: "",
            typeIdentite: "",
            numeroIdentite: "",
            dateEmissionIdentite: "",
            autoriteDelivrante: "",
            estEtranger: false,
            attestationNonPacsPaysOrigine: false,
            certificatCoutumeRequis: false,
            traductionRequise: false,
          }
        ],
        adresseCommune: "",
        dateDebutResidenceCommune: "",
        contributionCharges: "proportionnelle",
        contributionChargesAutre: "",
        clausesFacultatives: {
          gestionBiensPersonnels: "",
          gestionBienCommun: "",
          usageBienIndivis: "",
          repartitionDepensesSpecifiques: "",
          clauseOccupationLogementSeparation: "",
          clauseRepriseBienDeces: "",
          clauseAbandonCreance: "",
          modalitesCompteBancaireCommun: "",
          clausesFinancieresPersonnalisees: "",
          clausesSolidariteDettes: "",
        },
        declarations: {
          residenceCommune: false,
          absenceLienParente: false,
          absenceMariageEtPacs: false,
        },
        enfantEnCommun: "non",
        enfants: [{
          id: 1,
          nom: "",
          prenom: "",
          dateNaissance: "",
          autoriteParentale: "",
        }],
        droitApplicable: "francais",
        droitApplicableAutre: "",
        biensPreexistants: "non",
        biensListe: [{
          id: 1,
          description: "",
          quotePart1: "",
          quotePart2: "",
          indivision: "",
        }],
      });

      // Reset file uploads
      setPacsPartenaire1IdentiteFiles([]);
      setPacsPartenaire2IdentiteFiles([]);
      setPacsPartenaire1ActeNaissanceFiles([]);
      setPacsPartenaire2ActeNaissanceFiles([]);
      setPacsPartenaire1DomicileFiles([]);
      setPacsPartenaire2DomicileFiles([]);
      setPacsPartenaire1DivorceFiles([]);
      setPacsPartenaire2DivorceFiles([]);
      setPacsPartenaire1DecesFiles([]);
      setPacsPartenaire2DecesFiles([]);
      setPacsPartenaire1CertificatCoutumeFiles([]);
      setPacsPartenaire2CertificatCoutumeFiles([]);
      setPacsPartenaire1CertificatNonPacsFiles([]);
      setPacsPartenaire2CertificatNonPacsFiles([]);
      setPacsPartenaire1TraductionsFiles([]);
      setPacsPartenaire2TraductionsFiles([]);

      refreshContrats();
    } catch (err) {
      console.error('Erreur création PACS:', err);
      toast.error('Erreur lors de la création de la convention de PACS');
    }
  };

  const handleDonationEntreEpouxSubmit = async () => {
    try {
      if (!user) {
        toast.error('Utilisateur non connecté');
        return;
      }

      // Validations obligatoires
      if (!donationEntreEpouxData.typeDonation) {
        toast.error('Veuillez sélectionner un type de donation');
        return;
      }

      if (donationEntreEpouxData.objetDonation.length === 0) {
        toast.error('Veuillez sélectionner au moins un objet de donation');
        return;
      }

      if (!donationEntreEpouxData.epoux[0].regimeMatrimonial || !donationEntreEpouxData.epoux[1].regimeMatrimonial) {
        toast.error('Veuillez renseigner le régime matrimonial des deux époux');
        return;
      }

      const typeLabels: Record<string, string> = {
        au_dernier_vivant: "Donation entre époux au dernier vivant (effets au décès)",
        biens_presents: "Donation de biens présents (effets immédiats)",
        mixte: "Donation mixte"
      };

      const regimeLabels: Record<string, string> = {
        communaute_legale: "Communauté légale",
        communaute_universelle: "Communauté universelle",
        separation_biens: "Séparation de biens",
        participation_acquets: "Participation aux acquêts",
        autre: "Autre régime"
      };

      const descriptionData = `
TYPE DE CONTRAT: DONATION ENTRE ÉPOUX

═══════════════════════════════════════════════════════════════
INFORMATIONS GÉNÉRALES
═══════════════════════════════════════════════════════════════
- Type de donation: ${typeLabels[donationEntreEpouxData.typeDonation] || donationEntreEpouxData.typeDonation}
- Objet(s) de la donation: ${donationEntreEpouxData.objetDonation.map(o => {
  const labels: Record<string, string> = {
    protection_conjoint: "Protection du conjoint survivant",
    transmission_bien: "Transmission d'un bien particulier",
    partage_inegal: "Partage inégal",
    renforcement_droits: "Renforcement des droits successoraux"
  };
  return labels[o] || o;
}).join(', ')}
- Date prévue de signature: ${donationEntreEpouxData.datePrevueSignature || "Non renseignée"}

═══════════════════════════════════════════════════════════════
IDENTITÉ DES ÉPOUX
═══════════════════════════════════════════════════════════════
${donationEntreEpouxData.epoux.map((e, idx) => `
Époux ${idx + 1}:
- Nom: ${e.nom} ${e.prenom}
- Nom de naissance: ${e.nomNaissance || e.nom}
- Date de naissance: ${e.dateNaissance || "Non renseignée"}
- Lieu de naissance: ${e.lieuNaissance || "Non renseigné"}
- Nationalité: ${e.nationalite || "Non renseignée"}
- Profession: ${e.profession || "Non renseignée"}
- Adresse: ${e.adresseComplete || "Non renseignée"}
- Téléphone: ${e.telephone || "Non renseigné"}
- Email: ${e.email || "Non renseigné"}
- Régime matrimonial: ${regimeLabels[e.regimeMatrimonial] || e.regimeMatrimonialAutre || "Non renseigné"}
- Date du mariage: ${e.dateMariage || "Non renseignée"}
- Lieu du mariage: ${e.lieuMariage || "Non renseigné"}
- Contrat de mariage: ${e.existenceContratMariage === "oui" ? "Oui (copie à joindre)" : "Non"}
- Pièce d'identité: ${e.typeIdentite || "Non renseigné"} n°${e.numeroIdentite || "Non renseigné"}
  Autorité: ${e.autoriteDelivrance || "Non renseigné"}, Expiration: ${e.dateExpiration || "Non renseignée"}
`).join('\n')}

═══════════════════════════════════════════════════════════════
ENFANTS ET HÉRITIERS RÉSERVATAIRES
═══════════════════════════════════════════════════════════════
A. ENFANTS COMMUNS (${donationEntreEpouxData.enfantsCommuns.length || 0})
${donationEntreEpouxData.enfantsCommuns.filter(e => e.nom).map(e => `- ${e.nom} ${e.prenom}, né(e) le ${e.dateNaissance || "Non renseigné"}`).join('\n') || "Aucun enfant commun déclaré"}

B. ENFANTS NON COMMUNS (${donationEntreEpouxData.enfantsNonCommuns.filter(e => e.nom).length || 0})
${donationEntreEpouxData.enfantsNonCommuns.filter(e => e.nom).map(e => `- ${e.nom} ${e.prenom} (époux ${e.epoux}), né(e) le ${e.dateNaissance || "Non renseigné"}`).join('\n') || "Aucun enfant non commun déclaré"}

C. PARENTS VIVANTS
- Parents époux 1: ${donationEntreEpouxData.parentsVivants.epoux1 === "oui" ? "Oui" : "Non"}
- Parents époux 2: ${donationEntreEpouxData.parentsVivants.epoux2 === "oui" ? "Oui" : "Non"}

D. AUTRES HÉRITIERS
${donationEntreEpouxData.autresHeritiers || "Aucun autre héritier déclaré"}

═══════════════════════════════════════════════════════════════
PATRIMOINE DES ÉPOUX
═══════════════════════════════════════════════════════════════
A. BIENS PROPRES ÉPOUX 1 (${donationEntreEpouxData.biensPropresEpoux1.filter(b => b.description).length})
${donationEntreEpouxData.biensPropresEpoux1.filter(b => b.description).map(b => 
  `- ${b.type}: ${b.description}, valeur: ${b.valeur || "Non estimée"}, origine: ${b.origine || "Non précisée"}`
).join('\n') || "Aucun bien propre déclaré"}

B. BIENS PROPRES ÉPOUX 2 (${donationEntreEpouxData.biensPropresEpoux2.filter(b => b.description).length})
${donationEntreEpouxData.biensPropresEpoux2.filter(b => b.description).map(b => 
  `- ${b.type}: ${b.description}, valeur: ${b.valeur || "Non estimée"}, origine: ${b.origine || "Non précisée"}`
).join('\n') || "Aucun bien propre déclaré"}

C. BIENS COMMUNS (${donationEntreEpouxData.biensCommuns.filter(b => b.description).length})
${donationEntreEpouxData.biensCommuns.filter(b => b.description).map(b => 
  `- ${b.description}, valeur: ${b.valeur || "Non estimée"}, parts: ${b.partEpoux1 || "50"}% / ${b.partEpoux2 || "50"}%`
).join('\n') || "Aucun bien commun déclaré"}

D. DROITS PARTICULIERS
${donationEntreEpouxData.droitsParticuliers.nueProprieteBiens ? `- Nue-propriété: ${donationEntreEpouxData.droitsParticuliers.nueProprieteBiens}` : ""}
${donationEntreEpouxData.droitsParticuliers.usufruitBiens ? `- Usufruit: ${donationEntreEpouxData.droitsParticuliers.usufruitBiens}` : ""}
${donationEntreEpouxData.droitsParticuliers.biensIndivis ? `- Biens indivis: ${donationEntreEpouxData.droitsParticuliers.biensIndivis}` : ""}
${donationEntreEpouxData.droitsParticuliers.biensHypotheques ? `- Hypothèques: ${donationEntreEpouxData.droitsParticuliers.biensHypotheques}` : ""}

═══════════════════════════════════════════════════════════════
CLAUSES DE LA DONATION
═══════════════════════════════════════════════════════════════
${donationEntreEpouxData.typeDonation === "au_dernier_vivant" || donationEntreEpouxData.typeDonation === "mixte" ? `
A. DONATION AU DERNIER VIVANT
Options successorales choisies:
${donationEntreEpouxData.donationDernierVivant.optionsSuccessorales.map(o => {
  const labels: Record<string, string> = {
    pleine_propriete_quotite: "- Pleine propriété de la quotité disponible",
    usufruit_universel: "- Usufruit universel de la succession",
    quart_pleine_3quarts_usufruit: "- 1/4 en pleine propriété + 3/4 en usufruit",
    choix_multiple: "- Choix entre plusieurs options au décès",
    attribution_biens_specifiques: "- Attribution de biens spécifiques"
  };
  return labels[o] || o;
}).join('\n') || "Aucune option sélectionnée"}
${donationEntreEpouxData.donationDernierVivant.biensSpecifiques ? `Biens spécifiques: ${donationEntreEpouxData.donationDernierVivant.biensSpecifiques}` : ""}

Attribution préférentielle:
${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.active ? `
- Logement familial: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.logementFamilial ? "Oui" : "Non"}
- Mobilier: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.mobilier ? "Oui" : "Non"}
- Bien professionnel: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.bienProfessionnel ? "Oui" : "Non"}
- Véhicule: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.vehicule ? "Oui" : "Non"}
${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.autresBiens ? `- Autres biens: ${donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.autresBiens}` : ""}
` : "Non activée"}

Clause de préciput: ${donationEntreEpouxData.donationDernierVivant.clausePreciput.active ? `
- Bien: ${donationEntreEpouxData.donationDernierVivant.clausePreciput.descriptionBien || "Non précisé"}
- Effet: ${donationEntreEpouxData.donationDernierVivant.clausePreciput.effet === "hors_part" ? "Hors part successorale" : "Valorisé dans la part"}
` : "Non activée"}

Clause de cantonnement: ${donationEntreEpouxData.donationDernierVivant.clauseCantonnement ? "Oui (optimisation fiscale)" : "Non"}

Clause d'exclusion: ${donationEntreEpouxData.donationDernierVivant.clauseExclusion.active ? `
- Biens exclus: ${donationEntreEpouxData.donationDernierVivant.clauseExclusion.biensExclus || "Non précisé"}
- Cas particuliers: ${donationEntreEpouxData.donationDernierVivant.clauseExclusion.casParticuliers || "Non précisé"}
` : "Non activée"}
` : ""}

${donationEntreEpouxData.typeDonation === "biens_presents" || donationEntreEpouxData.typeDonation === "mixte" ? `
B. DONATION DE BIENS PRÉSENTS
Biens donnés immédiatement (${donationEntreEpouxData.donationBiensPresents.biensDonnes.filter(b => b.description).length}):
${donationEntreEpouxData.donationBiensPresents.biensDonnes.filter(b => b.description).map(b => 
  `- ${b.nature}: ${b.description}, valeur: ${b.valeur || "Non estimée"}, régime: ${b.regimePropriete || "Non précisé"}`
).join('\n') || "Aucun bien donné"}

Irrévocabilité: ${donationEntreEpouxData.donationBiensPresents.irrevocabilite === "oui" ? "Oui (donation irrévocable)" : "Non"}
Clause de retour en cas de prédécès: ${donationEntreEpouxData.donationBiensPresents.clauseRetourPredeces === "oui" ? "Oui" : "Non"}
Réserve d'usufruit: ${donationEntreEpouxData.donationBiensPresents.reserveUsufruit.active ? `Oui - ${donationEntreEpouxData.donationBiensPresents.reserveUsufruit.conditions || "Conditions non précisées"}` : "Non"}
` : ""}

C. CLAUSES COMMUNES
${donationEntreEpouxData.clausesCommunes.administrationGestion ? `- Administration et gestion: ${donationEntreEpouxData.clausesCommunes.administrationGestion}` : ""}
${donationEntreEpouxData.clausesCommunes.conditionSuspensiveResolutoire ? `- Condition suspensive/résolutoire: ${donationEntreEpouxData.clausesCommunes.conditionSuspensiveResolutoire}` : ""}
- Acceptation du bénéficiaire: ${donationEntreEpouxData.clausesCommunes.acceptationBeneficiaire ? "Oui (obligatoire)" : "En attente"}
- Renonciation droits successoraux standards: ${donationEntreEpouxData.clausesCommunes.renonciationDroitsSuccessorauxStandards ? "Oui" : "Non"}
- Clause de non-révocation: ${donationEntreEpouxData.clausesCommunes.clauseNonRevocation ? "Oui" : "Non"}

═══════════════════════════════════════════════════════════════
MENTIONS LÉGALES OBLIGATOIRES
═══════════════════════════════════════════════════════════════
✓ Articles du Code civil applicables
✓ Effets de la donation entre époux
✓ Quotité disponible spéciale entre époux
✓ Limites de la réserve héréditaire
✓ Déclaration de capacité juridique
✓ Consentement éclairé des deux époux
✓ Lecture de l'acte
✓ Signatures électroniques

═══════════════════════════════════════════════════════════════
FIN DE LA CONVENTION
═══════════════════════════════════════════════════════════════
`;

      await supabase.from('contrats').insert({
        name: `Donation entre époux - ${donationEntreEpouxData.epoux[0].nom} ${donationEntreEpouxData.epoux[0].prenom} & ${donationEntreEpouxData.epoux[1].nom} ${donationEntreEpouxData.epoux[1].prenom}`,
        user_id: user.id,
        status: 'draft',
        type: 'Donation entre époux',
        description: descriptionData,
      });

      toast.success('Donation entre époux créée avec succès');
      setShowQuestionDialog(false);

      // Reset form
      setDonationEntreEpouxData({
        typeDonation: "au_dernier_vivant",
        objetDonation: [],
        datePrevueSignature: "",
        epoux: [
          {
            id: 1, isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", adresseComplete: "",
            telephone: "", email: "", dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "",
            situationMatrimoniale: "marie", regimeMatrimonial: "", regimeMatrimonialAutre: "",
            dateMariage: "", lieuMariage: "", existenceContratMariage: "non",
            typeIdentite: "", numeroIdentite: "", autoriteDelivrance: "", dateExpiration: "",
          },
          {
            id: 2, isClient: false, clientId: "", nom: "", prenom: "", nomNaissance: "", adresseComplete: "",
            telephone: "", email: "", dateNaissance: "", lieuNaissance: "", nationalite: "", profession: "",
            situationMatrimoniale: "marie", regimeMatrimonial: "", regimeMatrimonialAutre: "",
            dateMariage: "", lieuMariage: "", existenceContratMariage: "non",
            typeIdentite: "", numeroIdentite: "", autoriteDelivrance: "", dateExpiration: "",
          }
        ],
        enfantsCommuns: [{ id: 1, nom: "", prenom: "", dateNaissance: "" }],
        enfantsNonCommuns: [{ id: 1, epoux: "1", nom: "", prenom: "", dateNaissance: "" }],
        parentsVivants: { epoux1: "non", epoux2: "non" },
        autresHeritiers: "",
        biensPropresEpoux1: [{ id: 1, type: "", description: "", valeur: "", origine: "" }],
        biensPropresEpoux2: [{ id: 1, type: "", description: "", valeur: "", origine: "" }],
        biensCommuns: [{ id: 1, description: "", valeur: "", partEpoux1: "", partEpoux2: "" }],
        droitsParticuliers: { nueProprieteBiens: "", usufruitBiens: "", biensIndivis: "", biensHypotheques: "" },
        donationDernierVivant: {
          optionsSuccessorales: [],
          biensSpecifiques: "",
          attributionPreferentielle: {
            active: false, logementFamilial: false, mobilier: false, bienProfessionnel: false,
            vehicule: false, autresBiens: "",
          },
          clausePreciput: { active: false, descriptionBien: "", effet: "" },
          clauseCantonnement: false,
          clauseExclusion: { active: false, biensExclus: "", casParticuliers: "" },
        },
        donationBiensPresents: {
          biensDonnes: [{ id: 1, nature: "", description: "", valeur: "", regimePropriete: "" }],
          irrevocabilite: "oui",
          clauseRetourPredeces: "non",
          reserveUsufruit: { active: false, conditions: "" },
        },
        clausesCommunes: {
          administrationGestion: "",
          conditionSuspensiveResolutoire: "",
          acceptationBeneficiaire: false,
          renonciationDroitsSuccessorauxStandards: false,
          clauseNonRevocation: false,
        },
        mentionsLegales: {
          articlesCodeCivil: true, effetsDonation: true, quotiteDisponible: true,
          limitesReserveHereditaire: true, declarationCapaciteJuridique: true,
          consentementEclaire: true, lectureActe: true, signaturesElectroniques: true,
        },
      });

      // Reset file states
      setDonationEpoux1IdentiteFiles([]);
      setDonationEpoux2IdentiteFiles([]);
      setDonationEpoux1LivretFamilleFiles([]);
      setDonationEpoux2LivretFamilleFiles([]);
      setDonationEpoux1ActeMariageFiles([]);
      setDonationEpoux2ActeMariageFiles([]);
      setDonationEpoux1ContratMariageFiles([]);
      setDonationEpoux2ContratMariageFiles([]);
      setDonationEpoux1DomicileFiles([]);
      setDonationEpoux2DomicileFiles([]);
      setDonationTitresProprieteBiensFiles([]);
      setDonationEstimationBiensFiles([]);
      setDonationHypothequesFiles([]);
      setDonationSituationLocativeFiles([]);
      setDonationRIBFiles([]);
      setDonationCarteGriseFiles([]);
      setDonationAutresDocumentsFiles([]);

      refreshContrats();
    } catch (err) {
      console.error('Erreur création donation entre époux:', err);
      toast.error('Erreur lors de la création de la donation entre époux');
    }
  };

  const handleDonationSimpleSubmit = async () => {
    if (!user) return;
    
    // Validation
    if (!donationSimpleData.typeDonation) {
      toast.error("Veuillez sélectionner un type de donation");
      return;
    }
    if (!donationSimpleData.donateur.nom || !donationSimpleData.donateur.prenom) {
      toast.error("Veuillez renseigner le donateur");
      return;
    }
    if (!donationSimpleData.donataire.nom || !donationSimpleData.donataire.prenom) {
      toast.error("Veuillez renseigner le donataire");
      return;
    }
    if (!donationSimpleData.mentionsLegales.acceptationExpresse) {
      toast.error("L'acceptation expresse du donataire est obligatoire");
      return;
    }
    if (!donationSimpleData.mentionsLegales.consentementEclaire) {
      toast.error("Le consentement éclairé du donateur est obligatoire");
      return;
    }
    
    try {
      // Construction de la description détaillée
      let description = `DONATION SIMPLE\n\n`;
      
      // Type de donation
      const typesLibelles: Record<string, string> = {
        biens_meubles: "Donation simple de biens meubles",
        biens_immobiliers: "Donation simple de biens immobiliers",
        sommes_argent: "Donation de sommes d'argent",
        nue_propriete: "Donation de nue-propriété",
        usufruit: "Donation d'usufruit",
        parts_sociales: "Donation de parts sociales / actions",
        manuelle: "Donation manuelle",
        mixte: "Donation mixte",
      };
      description += `Type : ${typesLibelles[donationSimpleData.typeDonation] || donationSimpleData.typeDonation}\n`;
      description += `Avec charges : ${donationSimpleData.donationAvecCharges ? "Oui" : "Non"}\n`;
      if (donationSimpleData.donationAvecCharges) {
        description += `Charges : ${donationSimpleData.descriptionCharges}\n`;
      }
      description += `Avec réserve d'usufruit : ${donationSimpleData.donationAvecReserveUsufruit ? "Oui" : "Non"}\n`;
      description += `Avec droit de retour : ${donationSimpleData.donationAvecDroitRetour ? "Oui" : "Non"}\n\n`;
      
      // Donateur
      description += `DONATEUR :\n`;
      description += `${donationSimpleData.donateur.prenom} ${donationSimpleData.donateur.nom}\n`;
      if (donationSimpleData.donateur.nomNaissance) description += `Nom de naissance : ${donationSimpleData.donateur.nomNaissance}\n`;
      description += `Né(e) le ${donationSimpleData.donateur.dateNaissance} à ${donationSimpleData.donateur.lieuNaissance}\n`;
      description += `Adresse : ${donationSimpleData.donateur.adresseComplete}\n`;
      description += `Téléphone : ${donationSimpleData.donateur.telephone}\n`;
      description += `Email : ${donationSimpleData.donateur.email}\n`;
      description += `Nationalité : ${donationSimpleData.donateur.nationalite}\n`;
      description += `Profession : ${donationSimpleData.donateur.profession}\n`;
      description += `Situation familiale : ${donationSimpleData.donateur.situationFamiliale}\n`;
      if (donationSimpleData.donateur.situationFamiliale === "marie") {
        description += `Régime matrimonial : ${donationSimpleData.donateur.regimeMatrimonial}\n`;
      }
      if (donationSimpleData.donateur.situationFiscale) {
        description += `Situation fiscale : ${donationSimpleData.donateur.situationFiscale}\n`;
      }
      description += `\n`;
      
      // Donataire
      description += `DONATAIRE :\n`;
      description += `${donationSimpleData.donataire.prenom} ${donationSimpleData.donataire.nom}\n`;
      if (donationSimpleData.donataire.nomNaissance) description += `Nom de naissance : ${donationSimpleData.donataire.nomNaissance}\n`;
      description += `Né(e) le ${donationSimpleData.donataire.dateNaissance} à ${donationSimpleData.donataire.lieuNaissance}\n`;
      description += `Adresse : ${donationSimpleData.donataire.adresseComplete}\n`;
      description += `Téléphone : ${donationSimpleData.donataire.telephone}\n`;
      description += `Email : ${donationSimpleData.donataire.email}\n`;
      description += `Nationalité : ${donationSimpleData.donataire.nationalite}\n`;
      description += `Profession : ${donationSimpleData.donataire.profession}\n`;
      description += `Lien avec le donateur : ${donationSimpleData.donataire.lienDonateur}\n`;
      description += `\n`;
      
      // Enfants / héritiers
      if (donationSimpleData.nombreEnfants) {
        description += `ENFANTS DU DONATEUR :\n`;
        description += `Nombre : ${donationSimpleData.nombreEnfants}\n`;
        donationSimpleData.enfants.forEach((enfant, idx) => {
          if (enfant.nom) {
            description += `- ${enfant.prenom} ${enfant.nom}, né(e) le ${enfant.dateNaissance}\n`;
          }
        });
        description += `Type de donation : ${donationSimpleData.donationHorsPartSuccessorale ? "Hors part successorale" : ""}${donationSimpleData.donationAvancementPart ? "En avancement de part successorale" : ""}\n`;
        description += `\n`;
      }
      
      // Description des biens selon type
      description += `BIEN(S) DONNÉ(S) :\n`;
      if (donationSimpleData.typeDonation === "biens_immobiliers" && donationSimpleData.bienImmobilier.adresseComplete) {
        description += `Bien immobilier :\n`;
        description += `Adresse : ${donationSimpleData.bienImmobilier.adresseComplete}\n`;
        description += `Nature : ${donationSimpleData.bienImmobilier.natureBien}\n`;
        description += `Désignation cadastrale : Section ${donationSimpleData.bienImmobilier.sectionCadastrale}, N° ${donationSimpleData.bienImmobilier.numeroCadastral}\n`;
        description += `Contenance : ${donationSimpleData.bienImmobilier.contenance}\n`;
        description += `Description : ${donationSimpleData.bienImmobilier.descriptionDetaille}\n`;
        description += `Situation locative : ${donationSimpleData.bienImmobilier.situationLocative}\n`;
        description += `Valeur vénale : ${donationSimpleData.bienImmobilier.valeurVenale} €\n`;
        if (donationSimpleData.bienImmobilier.existenceHypotheques) {
          description += `Hypothèques : ${donationSimpleData.bienImmobilier.montantHypotheques} €\n`;
        }
        if (donationSimpleData.bienImmobilier.repartitionUsufruit) {
          description += `Usufruit : ${donationSimpleData.bienImmobilier.repartitionUsufruit}\n`;
          description += `Nue-propriété : ${donationSimpleData.bienImmobilier.repartitionNuePropriete}\n`;
        }
      }
      
      if (donationSimpleData.typeDonation === "biens_meubles" && donationSimpleData.bienMobilier.descriptionPrecise) {
        description += `Bien mobilier :\n`;
        description += `Description : ${donationSimpleData.bienMobilier.descriptionPrecise}\n`;
        if (donationSimpleData.bienMobilier.numeroSerie) description += `N° série : ${donationSimpleData.bienMobilier.numeroSerie}\n`;
        description += `Valeur estimée : ${donationSimpleData.bienMobilier.valeurEstimee} €\n`;
      }
      
      if (donationSimpleData.typeDonation === "sommes_argent" && donationSimpleData.sommesArgent.montantExact) {
        description += `Somme d'argent :\n`;
        description += `Montant : ${donationSimpleData.sommesArgent.montantExact} €\n`;
        description += `Provenance : ${donationSimpleData.sommesArgent.provenanceFonds}\n`;
        description += `Modalité : ${donationSimpleData.sommesArgent.modalite}\n`;
        description += `Date transfert : ${donationSimpleData.sommesArgent.dateTransfert}\n`;
      }
      
      if (donationSimpleData.typeDonation === "parts_sociales" && donationSimpleData.partsSociales.typeSociete) {
        description += `Parts sociales / Actions :\n`;
        description += `Type société : ${donationSimpleData.partsSociales.typeSociete}\n`;
        description += `Nombre de parts : ${donationSimpleData.partsSociales.nombreParts}\n`;
        description += `Valeur unitaire : ${donationSimpleData.partsSociales.valeurUnitaire} €\n`;
        description += `Pourcentage du capital : ${donationSimpleData.partsSociales.pourcentageCapital}%\n`;
        description += `Agrément obligatoire : ${donationSimpleData.partsSociales.agrementObligatoire ? "Oui" : "Non"}\n`;
        if (donationSimpleData.partsSociales.clausesSpecifiques) {
          description += `Clauses spécifiques : ${donationSimpleData.partsSociales.clausesSpecifiques}\n`;
        }
      }
      
      if ((donationSimpleData.typeDonation === "nue_propriete" || donationSimpleData.typeDonation === "usufruit") && donationSimpleData.nueProprieteUsufruit.valeurNuePropriete) {
        description += `Nue-propriété / Usufruit :\n`;
        description += `Valeur nue-propriété : ${donationSimpleData.nueProprieteUsufruit.valeurNuePropriete} €\n`;
        description += `Valeur usufruit : ${donationSimpleData.nueProprieteUsufruit.valeurUsufruit} €\n`;
        description += `Durée : ${donationSimpleData.nueProprieteUsufruit.duree}\n`;
        description += `Répartition charges : ${donationSimpleData.nueProprieteUsufruit.repartitionCharges}\n`;
      }
      description += `\n`;
      
      // Clauses optionnelles
      if (donationSimpleData.clausesOptionnelles.reserveUsufruit) {
        description += `RÉSERVE D'USUFRUIT :\n`;
        description += `Étendue : ${donationSimpleData.clausesOptionnelles.etendueUsufruit}\n`;
        description += `Droit usage/habitation : ${donationSimpleData.clausesOptionnelles.droitUsageHabitation ? "Oui" : "Non"}\n\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.droitRetour) {
        description += `DROIT DE RETOUR CONVENTIONNEL :\n`;
        description += `Étendue : ${donationSimpleData.clausesOptionnelles.etendueRetour}\n\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.chargeImposee) {
        description += `CHARGE IMPOSÉE AU DONATAIRE :\n`;
        description += `Description : ${donationSimpleData.clausesOptionnelles.descriptionCharge}\n`;
        description += `Montant/Nature : ${donationSimpleData.clausesOptionnelles.montantNatureCharge}\n`;
        description += `Conditions : ${donationSimpleData.clausesOptionnelles.conditionsExecution}\n\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.usageProfessionnel) {
        description += `Bien donné pour usage professionnel\n`;
      }
      if (donationSimpleData.clausesOptionnelles.exclusionCommunaute) {
        description += `Exclusion de la communauté en cas de mariage du donataire\n`;
      }
      if (donationSimpleData.clausesOptionnelles.donationRapportable) {
        description += `Type de donation : ${donationSimpleData.clausesOptionnelles.donationRapportable === "avancement_hoirie" ? "En avancement d'hoirie (rapportable)" : "Hors part successorale (non rapportable)"}\n`;
      }
      
      if (donationSimpleData.clausesOptionnelles.clauseInalienabilite) {
        description += `CLAUSE D'INALIÉNABILITÉ :\n`;
        description += `Durée : ${donationSimpleData.clausesOptionnelles.dureeInalienabilite}\n`;
        description += `Motif légitime : ${donationSimpleData.clausesOptionnelles.motifLegitime}\n`;
        description += `Autorisation requise : ${donationSimpleData.clausesOptionnelles.autorisationRequise ? "Oui" : "Non"}\n`;
      }
      
      // Créer le contrat
      const { data: contrat, error: contratError } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Donation simple - ${donationSimpleData.donateur.nom} → ${donationSimpleData.donataire.nom}`,
          type: pendingContractType,
          category: pendingCategory,
          role: role,
          description: description,
          questionnaire_data: donationSimpleData,
        })
        .select()
        .single();
      
      if (contratError) throw contratError;
      
      // Upload des fichiers
      const uploadTasks: Promise<void>[] = [];
      
      const uploadFiles = async (files: File[], folder: string) => {
        for (const file of files) {
          const uniqueName = `${Date.now()}_${file.name}`;
          const filePath = `contrats/${contrat.id}/${folder}/${uniqueName}`;
          
          const { error: uploadError } = await supabase.storage
            .from('contrat-documents')
            .upload(filePath, file);
          
          if (uploadError) {
            console.error(`Erreur upload ${folder}:`, uploadError);
          }
        }
      };
      
      if (donationSimpleDonateurIdentiteFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonateurIdentiteFiles, 'donateur_identite'));
      if (donationSimpleDonateurLivretFamilleFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonateurLivretFamilleFiles, 'donateur_livret_famille'));
      if (donationSimpleDonateurDomicileFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonateurDomicileFiles, 'donateur_domicile'));
      if (donationSimpleDonatairePieceIdentiteFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonatairePieceIdentiteFiles, 'donataire_identite'));
      if (donationSimpleDonataireDomicileFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleDonataireDomicileFiles, 'donataire_domicile'));
      if (donationSimpleTitreProprieteFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleTitreProprieteFiles, 'titre_propriete'));
      if (donationSimpleEvaluationBienFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleEvaluationBienFiles, 'evaluation_bien'));
      if (donationSimpleAutresDocumentsFiles.length > 0) uploadTasks.push(uploadFiles(donationSimpleAutresDocumentsFiles, 'autres_documents'));
      
      await Promise.all(uploadTasks);
      
      // Rafraîchir la liste
      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Donation simple créée avec succès');
      navigate(role === 'notaire' ? '/notaires/contracts' : '/avocats/contracts');
      
    } catch (err: unknown) {
      console.error('Erreur création donation simple:', err);
      toast.error('Erreur lors de la création de la donation simple');
    }
  };

  const handleTestamentSubmit = async () => {
    if (!user) return;
    
    // Validation
    if (!testamentData.typeTestament) {
      toast.error("Veuillez sélectionner le type de testament");
      return;
    }
    
    if (!testamentData.testateurNom || !testamentData.testateurPrenom) {
      toast.error("Veuillez renseigner l'identité complète du testateur");
      return;
    }

    try {
      // Générer la description détaillée
      let description = `TESTAMENT ${testamentData.typeTestament.toUpperCase()}\n\n`;
      
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `INFORMATIONS GÉNÉRALES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `Type : ${testamentData.typeTestament === "authentique" ? "Testament authentique" : "Testament mystique"}\n`;
      description += `Caractère : ${testamentData.caractereTestament}\n`;
      if (testamentData.dateSouhaiteeRedaction) {
        description += `Date souhaitée : ${testamentData.dateSouhaiteeRedaction}\n`;
      }
      description += `\n`;
      
      // Testateur
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `TESTATEUR\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `${testamentData.testateurPrenom} ${testamentData.testateurNom}\n`;
      if (testamentData.testateurNomNaissance) description += `Nom de naissance : ${testamentData.testateurNomNaissance}\n`;
      description += `Né(e) le ${testamentData.testateurDateNaissance} à ${testamentData.testateurLieuNaissance}\n`;
      description += `Adresse : ${testamentData.testateurAdresse}\n`;
      description += `Téléphone : ${testamentData.testateurTelephone}\n`;
      description += `Email : ${testamentData.testateurEmail}\n`;
      description += `Nationalité : ${testamentData.testateurNationalite}\n`;
      description += `Profession : ${testamentData.testateurProfession}\n`;
      description += `Situation familiale : ${testamentData.testateurSituationFamiliale}\n`;
      if (testamentData.regimeMatrimonial.nature) {
        description += `Régime matrimonial : ${testamentData.regimeMatrimonial.nature}\n`;
      }
      description += `Pièce d'identité : ${testamentData.testateurPieceType} n°${testamentData.testateurPieceNumero}\n`;
      description += `Capacité juridique confirmée : ${testamentData.capaciteJuridiqueConfirmee ? "Oui" : "Non"}\n`;
      if (testamentData.sousTutelleCuratelle) {
        description += `⚠️ Sous tutelle/curatelle\n`;
      }
      description += `\n`;
      
      // Héritiers réservataires
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `HÉRITIERS RÉSERVATAIRES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      if (testamentData.heritiersReservataires.enfants.length > 0 && testamentData.heritiersReservataires.enfants[0]?.nom) {
        description += `\nENFANTS (${testamentData.heritiersReservataires.enfants.filter(e => e.nom).length}) :\n`;
        testamentData.heritiersReservataires.enfants.forEach((enfant, idx) => {
          if (enfant.nom) {
            description += `${idx + 1}. ${enfant.prenom} ${enfant.nom}, né(e) le ${enfant.dateNaissance}\n`;
          }
        });
      }
      
      if (testamentData.heritiersReservataires.descendants.length > 0 && testamentData.heritiersReservataires.descendants[0]?.nom) {
        description += `\nDESCENDANTS (petits-enfants) :\n`;
        testamentData.heritiersReservataires.descendants.forEach((desc, idx) => {
          if (desc.nom) {
            description += `${idx + 1}. ${desc.prenom} ${desc.nom} - ${desc.lien}\n`;
          }
        });
      }
      
      if (testamentData.heritiersReservataires.pereVivant === "oui" || testamentData.heritiersReservataires.mereVivante === "oui") {
        description += `\nPARENTS VIVANTS :\n`;
        if (testamentData.heritiersReservataires.pereVivant === "oui") {
          description += `Père : ${testamentData.heritiersReservataires.nomPrenomPere}\n`;
        }
        if (testamentData.heritiersReservataires.mereVivante === "oui") {
          description += `Mère : ${testamentData.heritiersReservataires.nomPrenomMere}\n`;
        }
      }
      
      description += `\n`;
      
      // Légataires
      if (testamentData.legataires.length > 0 && testamentData.legataires[0]?.nom) {
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `LÉGATAIRES\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        testamentData.legataires.forEach((leg, idx) => {
          if (leg.nom) {
            description += `${idx + 1}. ${leg.prenom} ${leg.nom}\n`;
            description += `   Adresse : ${leg.adresse}\n`;
            description += `   Lien : ${leg.lien}\n`;
          }
        });
        description += `\n`;
      }
      
      // Dispositions testamentaires
      description += `═══════════════════════════════════════════════════════════════\n`;
      description += `DISPOSITIONS TESTAMENTAIRES\n`;
      description += `═══════════════════════════════════════════════════════════════\n`;
      
      if (testamentData.dispositionsTestamentaires.legsUniversel.actif) {
        description += `\n✓ LEGS UNIVERSEL\n`;
        description += `Bénéficiaire : ${testamentData.dispositionsTestamentaires.legsUniversel.beneficiaire}\n`;
        if (testamentData.dispositionsTestamentaires.legsUniversel.conditions) {
          description += `Conditions : ${testamentData.dispositionsTestamentaires.legsUniversel.conditions}\n`;
        }
      }
      
      if (testamentData.dispositionsTestamentaires.legsTitreUniversel.actif) {
        description += `\n✓ LEGS À TITRE UNIVERSEL\n`;
        description += `Quotité : ${testamentData.dispositionsTestamentaires.legsTitreUniversel.quotite}\n`;
        description += `Bénéficiaire : ${testamentData.dispositionsTestamentaires.legsTitreUniversel.beneficiaire}\n`;
        if (testamentData.dispositionsTestamentaires.legsTitreUniversel.conditions) {
          description += `Conditions : ${testamentData.dispositionsTestamentaires.legsTitreUniversel.conditions}\n`;
        }
      }
      
      if (testamentData.dispositionsTestamentaires.legsParticuliers.length > 0 && testamentData.dispositionsTestamentaires.legsParticuliers[0]?.beneficiaire) {
        description += `\n✓ LEGS PARTICULIERS (${testamentData.dispositionsTestamentaires.legsParticuliers.length})\n`;
        testamentData.dispositionsTestamentaires.legsParticuliers.forEach((leg, idx) => {
          if (leg.beneficiaire) {
            description += `${idx + 1}. ${leg.description} → ${leg.beneficiaire}\n`;
          }
        });
      }
      
      if (testamentData.dispositionsTestamentaires.executeurTestamentaire.actif) {
        description += `\n✓ EXÉCUTEUR TESTAMENTAIRE\n`;
        description += `${testamentData.dispositionsTestamentaires.executeurTestamentaire.prenom} ${testamentData.dispositionsTestamentaires.executeurTestamentaire.nom}\n`;
        description += `Mission : ${testamentData.dispositionsTestamentaires.executeurTestamentaire.mission}\n`;
      }
      description += `\n`;
      
      // Patrimoine
      if (testamentData.patrimoine.biensImmobiliers.length > 0 && testamentData.patrimoine.biensImmobiliers[0]?.adresse) {
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `PATRIMOINE\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `\nBIENS IMMOBILIERS :\n`;
        testamentData.patrimoine.biensImmobiliers.forEach((bien, idx) => {
          if (bien.adresse) {
            description += `${idx + 1}. ${bien.typeBien} - ${bien.adresse} (${bien.valeurEstimative}€)\n`;
          }
        });
      }
      
      // Testament authentique spécifique
      if (testamentData.typeTestament === "authentique") {
        description += `\n═══════════════════════════════════════════════════════════════\n`;
        description += `TESTAMENT AUTHENTIQUE - FORMALITÉS\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `Notaire : ${testamentData.testamentAuthentique.notaireNom}\n`;
        description += `Office : ${testamentData.testamentAuthentique.notaireOffice}\n`;
        
        if (testamentData.testamentAuthentique.presenceSecondNotaire) {
          description += `Deuxième notaire : ${testamentData.testamentAuthentique.secondNotaireNom}\n`;
        }
        
        if (testamentData.testamentAuthentique.temoins.length > 0 && testamentData.testamentAuthentique.temoins[0]?.nom) {
          description += `\nTÉMOINS :\n`;
          testamentData.testamentAuthentique.temoins.forEach((temoin, idx) => {
            if (temoin.nom) {
              description += `${idx + 1}. ${temoin.prenom} ${temoin.nom} - ${temoin.adresse}\n`;
            }
          });
        }
        
        description += `\nFormalités accomplies :\n`;
        description += `- Testament dicté : ${testamentData.testamentAuthentique.formaliteDicte ? "✓" : "✗"}\n`;
        description += `- Testament relu : ${testamentData.testamentAuthentique.formaliteRelu ? "✓" : "✗"}\n`;
        description += `- Testament signé : ${testamentData.testamentAuthentique.formaliteSigne ? "✓" : "✗"}\n`;
        description += `- Inscription FCDDV : ${testamentData.testamentAuthentique.formaliteRegistre ? "✓" : "✗"}\n`;
      }
      
      // Testament mystique spécifique
      if (testamentData.typeTestament === "mystique") {
        description += `\n═══════════════════════════════════════════════════════════════\n`;
        description += `TESTAMENT MYSTIQUE - FORMALITÉS\n`;
        description += `═══════════════════════════════════════════════════════════════\n`;
        description += `Type d'écriture : ${testamentData.testamentMystique.typeEcriture}\n`;
        description += `Enveloppe cachetée : ${testamentData.testamentMystique.cachete ? "Oui" : "Non"}\n`;
        if (testamentData.testamentMystique.suscription) {
          description += `Suscription : ${testamentData.testamentMystique.suscription}\n`;
        }
        
        if (testamentData.testamentMystique.temoins.length > 0 && testamentData.testamentMystique.temoins[0]?.nom) {
          description += `\nTÉMOINS OBLIGATOIRES :\n`;
          testamentData.testamentMystique.temoins.forEach((temoin, idx) => {
            if (temoin.nom) {
              description += `${idx + 1}. ${temoin.prenom} ${temoin.nom}\n`;
            }
          });
        }
        description += `Inscription FCDDV : ${testamentData.testamentMystique.inscriptionFCDDV ? "Oui" : "Non"}\n`;
      }

      // Créer le contrat
      const { data: contrat, error: contratError } = await supabase
        .from('contrats')
        .insert({
          owner_id: user.id,
          name: `Testament ${testamentData.typeTestament} - ${testamentData.testateur.nom}`,
          type: "Testament authentique ou mystique",
          category: pendingCategory,
          role: role,
          description: description,
        })
        .select()
        .single();

      if (contratError) throw contratError;

      // Upload des fichiers (même logique que donation simple)
      // ... Upload de tous les fichiers testament

      setContrats((prev) => [contrat, ...prev]);
      setShowQuestionDialog(false);
      toast.success('Testament créé avec succès');
      navigate(role === 'notaire' ? '/notaires/contracts' : '/avocats/contracts');
      
    } catch (err: unknown) {
      console.error('Erreur création testament:', err);
      toast.error('Erreur lors de la création du testament');
    }
  };

  const handleDelete = async (contrat: ContratRow) => {
    if (!user) return;
    if (!confirm(`Supprimer "${contrat.name}" ?`)) return;
    
    try {
      const { error } = await supabase
        .from('contrats')
        .delete()
        .eq('id', contrat.id)
        .eq('owner_id', user.id);
      
      if (error) throw error;
      
      setContrats((prev) => prev.filter((c) => c.id !== contrat.id));
      toast.success('Contrat supprimé');
    } catch (err: unknown) {
      console.error('Erreur suppression contrat:', err);
      const message = err instanceof Error ? err.message : String(err);
      toast.error('Erreur lors de la suppression', { description: message });
    }
  };

  const handleView = (contrat: ContratRow) => {
    navigate(role === 'notaire' ? `/notaires/contrats/${contrat.id}` : `/avocats/contrats/${contrat.id}`);
  };

  // Résultats déjà filtrés côté SQL
  const filteredContrats = contrats;

  return (
    <AppLayout>
      <div className="p-6">
        <div className="flex items-center justify-between mb-6">
          <div>
            <h1 className="text-3xl font-bold">{role === 'notaire' ? 'Actes' : 'Contrats'}</h1>
            <p className="text-foreground mt-1">
              Centralisez et créez vos modèles de contrats
            </p>
          </div>
          <div>
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <Button className={mainButtonColor}>
                  <Plus className="h-4 w-4 mr-2" />
                  Ajouter
                </Button>
              </DropdownMenuTrigger>
              <DropdownMenuContent align="end" className={menuContentClass}>
                <DropdownMenuItem className={role === 'notaire' ? 'focus:bg-orange-600 focus:text-white' : 'focus:bg-blue-600 focus:text-white'} onClick={() => window.location.href = (role === 'notaire' ? '/notaires/documents?openImport=1' : '/avocats/documents?openImport=1')}>
                  <Upload className="mr-2 h-4 w-4" />
                  Importer depuis mon appareil
                </DropdownMenuItem>

                <DropdownMenuSub>
                    <DropdownMenuSubTrigger className={role === 'notaire' ? 'font-semibold hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white data-[state=open]:bg-orange-600 data-[state=open]:text-white' : 'font-semibold hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white data-[state=open]:bg-blue-600 data-[state=open]:text-white'}>Créer un contrat</DropdownMenuSubTrigger>
                  <DropdownMenuSubContent className={menuContentClass}>
                    {(role === 'notaire' ? NOTAIRE_CONTRACT_CATEGORIES : AVOCAT_CONTRACT_CATEGORIES).map((cat) => (
                      <DropdownMenuSub key={cat.key}>
                          <DropdownMenuSubTrigger className={role === 'notaire' ? 'font-semibold hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white data-[state=open]:bg-orange-600 data-[state=open]:text-white' : 'font-semibold hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white data-[state=open]:bg-blue-600 data-[state=open]:text-white'}>{cat.label}</DropdownMenuSubTrigger>
                            <DropdownMenuSubContent className={menuContentClass}>
                          {cat.contracts.map((contract) => (
                            <DropdownMenuItem
                              key={contract}
                              className={role === 'notaire' ? 'cursor-pointer hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'cursor-pointer hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}
                              onClick={() => createContract(contract, cat.key)}
                            >
                              {contract}
                            </DropdownMenuItem>
                          ))}
                        </DropdownMenuSubContent>
                      </DropdownMenuSub>
                    ))}
                  </DropdownMenuSubContent>
                </DropdownMenuSub>
              </DropdownMenuContent>
            </DropdownMenu>
          </div>
        </div>

        {loading ? (
          <div className="flex items-center justify-center h-[400px] border border-dashed border-border rounded-lg">
            <p className="text-foreground">Chargement…</p>
          </div>
        ) : contrats.length === 0 ? (
          <div className="flex items-center justify-center h-[400px] border border-dashed border-border rounded-lg">
            <div className="text-center">
              <p className="text-foreground">Aucun contrat pour le moment</p>
              <div className="mt-4 flex justify-center">
                <DropdownMenu>
                  <DropdownMenuTrigger asChild>
                    <Button className={mainButtonColor}>
                      <Plus className="h-4 w-4 mr-2" />
                      Ajouter
                    </Button>
                  </DropdownMenuTrigger>
                  <DropdownMenuContent align="end" className={menuContentClass}>
                    <DropdownMenuSub>
                      <DropdownMenuSubTrigger className={`font-semibold ${role === 'notaire' ? 'hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}`}>Créer un contrat</DropdownMenuSubTrigger>
                      <DropdownMenuSubContent className={menuContentClass}>
                        {(role === 'notaire' ? NOTAIRE_CONTRACT_CATEGORIES : AVOCAT_CONTRACT_CATEGORIES).map((cat) => (
                          <DropdownMenuSub key={cat.key}>
                            <DropdownMenuSubTrigger className={`font-semibold ${role === 'notaire' ? 'hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}`}>{cat.label}</DropdownMenuSubTrigger>
                            <DropdownMenuSubContent className={menuContentClass}>
                              {cat.contracts.map((contract) => (
                                <DropdownMenuItem
                                  key={contract}
                                  className={role === 'notaire' ? 'cursor-pointer hover:bg-orange-600 hover:text-white focus:bg-orange-600 focus:text-white' : 'cursor-pointer hover:bg-blue-600 hover:text-white focus:bg-blue-600 focus:text-white'}
                                  onClick={() => createContract(contract, cat.key)}
                                >
                                  {contract}
                                </DropdownMenuItem>
                              ))}
                            </DropdownMenuSubContent>
                          </DropdownMenuSub>
                        ))}
                      </DropdownMenuSubContent>
                    </DropdownMenuSub>
                  </DropdownMenuContent>
                </DropdownMenu>
              </div>
            </div>
          </div>
        ) : (
          <>
            <div className="flex items-center gap-4 mb-4 bg-white p-4 rounded-lg border">
              <div className="relative flex-1">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-foreground" />
                <Input
                  placeholder="Rechercher un contrat..."
                  value={search}
                  onChange={(e) => setSearch(e.target.value)}
                  className="pl-10 bg-white text-foreground placeholder:text-foreground/50"
                />
              </div>
              <Select value={categoryFilter} onValueChange={setCategoryFilter}>
                <SelectTrigger className="w-[280px]">
                  <SelectValue placeholder="Catégorie" />
                </SelectTrigger>
                <SelectContent className={selectContentClass}>
                  {(role === 'notaire' ? categoriesNotaire : categoriesAvocat).map((cat) => (
                    <SelectItem key={cat} value={cat} className={selectItemClass}>
                      {cat}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <Card>
              <CardHeader>
                <CardTitle className="text-lg">{role === 'notaire' ? 'Liste des actes' : 'Liste des contrats'}</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="border rounded-lg bg-white">
                  <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>Nom du contrat</TableHead>
                    <TableHead>Type</TableHead>
                    <TableHead>Catégorie</TableHead>
                    <TableHead>Créé le</TableHead>
                    <TableHead className="w-[50px]"></TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {filteredContrats.length === 0 ? (
                    <TableRow>
                      <TableCell colSpan={5} className="text-center text-foreground">
                        Aucun contrat trouvé
                      </TableCell>
                    </TableRow>
                  ) : (
                    filteredContrats.map((contrat) => (
                      <TableRow key={contrat.id}>
                        <TableCell className="font-medium">{contrat.name}</TableCell>
                        <TableCell className="text-sm text-foreground">{contrat.type}</TableCell>
                        <TableCell>
                          <Badge variant="outline" className={
                            role === 'notaire'
                              ? 'bg-orange-100 text-orange-600 border-orange-200'
                              : 'bg-blue-100 text-blue-600 border-blue-200'
                          }>
                            {contrat.category}
                          </Badge>
                        </TableCell>
                        <TableCell className="text-sm text-foreground">
                          {new Date(contrat.created_at).toLocaleDateString()}
                        </TableCell>
                        <TableCell>
                          <div className="flex items-center gap-1">
                            <ShareToCollaborativeDialog
                              itemId={contrat.id}
                              itemName={contrat.name}
                              itemType="contrat"
                              role={role}
                              onSuccess={() => {
                                toast.success('Contrat partagé');
                              }}
                            />
                            <DropdownMenu>
                              <DropdownMenuTrigger asChild>
                                <Button 
                                  variant="ghost" 
                                  size="icon"
                                  className={role === 'notaire' ? 'hover:bg-orange-100 hover:text-orange-600' : 'hover:bg-blue-100 hover:text-blue-600'}
                                >
                                  <MoreHorizontal className="h-4 w-4" />
                                </Button>
                              </DropdownMenuTrigger>
                              <DropdownMenuContent align="end" className={menuContentClass}>
                                <DropdownMenuItem 
                                  className={menuItemClass}
                                  onClick={() => handleView(contrat)}
                                >
                                  <Eye className="mr-2 h-4 w-4" />
                                  Voir
                                </DropdownMenuItem>
                                <DropdownMenuItem 
                                  className={`text-destructive ${menuItemClass}`}
                                  onClick={() => handleDelete(contrat)}
                                >
                                  <Trash2 className="mr-2 h-4 w-4" />
                                  Supprimer
                                </DropdownMenuItem>
                              </DropdownMenuContent>
                            </DropdownMenu>
                          </div>
                        </TableCell>
                      </TableRow>
                    ))
                  )}
                </TableBody>
                  </Table>
                </div>
              </CardContent>
            </Card>
          </>
        )}
      </div>

      {/* Dialog questionnaire pour compromis de vente / acte de vente */}
      <Dialog open={showQuestionDialog} onOpenChange={setShowQuestionDialog}>
        <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>
              {pendingContractType === "Acte de vente immobilière" 
                ? "Informations pour l'acte de vente immobilière" 
                : (pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé")
                ? "Informations pour le bail d'habitation"
                : pendingContractType === "Bail commercial / professionnel"
                ? (bailCommercialData.typeBail === "commercial" 
                    ? "Informations pour le bail commercial"
                    : bailCommercialData.typeBail === "professionnel"
                    ? "Informations pour le bail professionnel" 
                    : "Informations pour le bail commercial / professionnel")
                : pendingContractType === "Convention d'indivision"
                ? "Informations pour la convention d'indivision"
                : pendingContractType === "Mainlevée d'hypothèque"
                ? "Informations pour la mainlevée d'hypothèque"
                : pendingContractType === "Contrat de mariage (régimes matrimoniaux)"
                ? "Informations pour le contrat de mariage"
                : pendingContractType === "PACS (convention + enregistrement)"
                ? "Informations pour le PACS"
                : pendingContractType === "Donation entre époux"
                ? "Informations pour la donation entre époux"
                : pendingContractType === "Donation simple (parent → enfant, etc.)"
                ? "Informations pour la donation simple"
                : pendingContractType === "Testament authentique ou mystique"
                ? "Informations pour le testament"
                : questionnaireData.typeContrat === "promesse_unilaterale"
                ? "Informations pour la promesse unilatérale de vente"
                : "Informations pour le compromis de vente"}
            </DialogTitle>
            <DialogDescription>
              Remplissez les informations suivantes pour préparer le document. Ces informations aideront l'IA à rédiger un contrat personnalisé.
            </DialogDescription>
          </DialogHeader>

          <div className="space-y-6 mt-4">
            {/* Formulaire spécifique pour Compromis de vente */}
            {pendingContractType === "Compromis de vente / Promesse unilatérale de vente" && (
              <>
            {/* Choix du type de contrat */}
            <div className="space-y-4 bg-muted/50 p-4 rounded-lg">
              <h3 className="font-semibold text-lg">Type de contrat *</h3>
              <RadioGroup 
                value={questionnaireData.typeContrat}
                onValueChange={(value) => setQuestionnaireData({...questionnaireData, typeContrat: value})}
              >
                <div className="flex items-center space-x-2">
                  <RadioGroupItem value="compromis" id="compromis" />
                  <Label htmlFor="compromis" className="cursor-pointer">Compromis de vente</Label>
                </div>
                <div className="flex items-center space-x-2">
                  <RadioGroupItem value="promesse_unilaterale" id="promesse_unilaterale" />
                  <Label htmlFor="promesse_unilaterale" className="cursor-pointer">Promesse unilatérale de vente</Label>
                </div>
              </RadioGroup>
            </div>

            {/* Sélection du rôle du client */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Rôle du client</h3>
              <div className="space-y-2">
                <Label>Votre client est : *</Label>
                <RadioGroup 
                  value={questionnaireData.clientRole}
                  onValueChange={(value) => setQuestionnaireData({...questionnaireData, clientRole: value})}
                >
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="vendeur" id="vendeur" />
                    <Label htmlFor="vendeur" className="cursor-pointer">Vendeur</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="acheteur" id="acheteur" />
                    <Label htmlFor="acheteur" className="cursor-pointer">Acquéreur</Label>
                  </div>
                </RadioGroup>
              </div>
            </div>

            {/* Section Vendeur */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">👤 Vendeur</h3>
              <div className="space-y-4">
                {questionnaireData.clientRole === "vendeur" ? (
                  <>
                    {/* Le client est le vendeur */}
                    <div className="space-y-2">
                      <Label htmlFor="clientId">Sélectionner votre client *</Label>
                      <Select 
                        value={questionnaireData.clientId}
                        onValueChange={(value) => setQuestionnaireData({...questionnaireData, clientId: value})}
                      >
                        <SelectTrigger>
                          <SelectValue placeholder="Choisir un client" />
                        </SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.nom} {client.prenom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    {/* Afficher les informations du client sélectionné */}
                    {questionnaireData.clientId && clients.find(c => c.id === questionnaireData.clientId) && (
                      <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                        <p><strong>Nom complet:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nom} {clients.find(c => c.id === questionnaireData.clientId)?.prenom}</p>
                        {clients.find(c => c.id === questionnaireData.clientId)?.adresse && (
                          <p><strong>Adresse:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.adresse}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.telephone && (
                          <p><strong>Téléphone:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.telephone}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.email && (
                          <p><strong>Email:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.email}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.date_naissance && (
                          <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === questionnaireData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.nationalite && (
                          <p><strong>Nationalité:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nationalite}</p>
                        )}
                      </div>
                    )}

                    {/* Statut matrimonial du client vendeur */}
                    <div className="space-y-2">
                      <Label htmlFor="statutMatrimonialClient">Statut matrimonial *</Label>
                      <Input 
                        id="statutMatrimonialClient"
                        value={questionnaireData.statutMatrimonialClient} 
                        onChange={(e) => setQuestionnaireData({...questionnaireData, statutMatrimonialClient: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>

                    {(questionnaireData.statutMatrimonialClient === "marie" || questionnaireData.statutMatrimonialClient === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="regimeMatrimonialClient">Régime matrimonial *</Label>
                          <Select value={questionnaireData.regimeMatrimonialClient} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialClient: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {questionnaireData.regimeMatrimonialClient === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="precisionRegimeClient">Préciser le régime</Label>
                            <Input 
                              id="precisionRegimeClient"
                              value={questionnaireData.precisionRegimeClient}
                              onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeClient: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}

                    {/* Pièce d'identité du client vendeur */}
                    {questionnaireData.clientId && (
                      <div className="space-y-2">
                        <Label>📎 Pièce d'identité</Label>
                        {compromisClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(compromisClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    {/* Saisie manuelle vendeur (le client est acheteur) */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="nomAutrePartie">Nom *</Label>
                        <Input 
                          id="nomAutrePartie"
                          value={questionnaireData.nomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, nomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="prenomAutrePartie">Prénom *</Label>
                        <Input 
                          id="prenomAutrePartie"
                          value={questionnaireData.prenomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, prenomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="adresseAutrePartie">Adresse complète *</Label>
                        <Input 
                          id="adresseAutrePartie"
                          value={questionnaireData.adresseAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, adresseAutrePartie: e.target.value})}
                        />
                      </div>

                      {/* Statut matrimonial autre partie */}
                      <div className="space-y-2">
                        <Label htmlFor="statutMatrimonialAutrePartie">Statut matrimonial *</Label>
                        <Select value={questionnaireData.statutMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, statutMatrimonialAutrePartie: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="celibataire">Célibataire</SelectItem>
                            <SelectItem value="marie">Marié</SelectItem>
                            <SelectItem value="pacse">Pacsé</SelectItem>
                            <SelectItem value="divorce">Divorcé</SelectItem>
                            <SelectItem value="veuf">Veuf</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {(questionnaireData.statutMatrimonialAutrePartie === "marie" || questionnaireData.statutMatrimonialAutrePartie === "pacse") && (
                        <>
                          <div className="space-y-2">
                            <Label htmlFor="regimeMatrimonialAutrePartie">Régime matrimonial *</Label>
                            <Select value={questionnaireData.regimeMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialAutrePartie: value})}>
                              <SelectTrigger>
                                <SelectValue placeholder="Sélectionner..." />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {questionnaireData.regimeMatrimonialAutrePartie === "autre" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label htmlFor="precisionRegimeAutrePartie">Préciser le régime</Label>
                              <Input 
                                id="precisionRegimeAutrePartie"
                                value={questionnaireData.precisionRegimeAutrePartie}
                                onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeAutrePartie: e.target.value})}
                                placeholder="Précisez le régime matrimonial..."
                              />
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </>
                )}
              </div>
            </div>

            {/* Section Acquéreur */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">👥 Acquéreur</h3>
              <div className="space-y-4">
                {questionnaireData.clientRole === "acheteur" ? (
                  <>
                    {/* Le client est l'acheteur */}
                    <div className="space-y-2">
                      <Label htmlFor="clientId">Sélectionner votre client *</Label>
                      <Select 
                        value={questionnaireData.clientId}
                        onValueChange={(value) => setQuestionnaireData({...questionnaireData, clientId: value})}
                      >
                        <SelectTrigger>
                          <SelectValue placeholder="Choisir un client" />
                        </SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.nom} {client.prenom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    {/* Afficher les informations du client sélectionné */}
                    {questionnaireData.clientId && clients.find(c => c.id === questionnaireData.clientId) && (
                      <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                        <p><strong>Nom complet:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nom} {clients.find(c => c.id === questionnaireData.clientId)?.prenom}</p>
                        {clients.find(c => c.id === questionnaireData.clientId)?.adresse && (
                          <p><strong>Adresse:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.adresse}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.telephone && (
                          <p><strong>Téléphone:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.telephone}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.email && (
                          <p><strong>Email:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.email}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.date_naissance && (
                          <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === questionnaireData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                        )}
                        {clients.find(c => c.id === questionnaireData.clientId)?.nationalite && (
                          <p><strong>Nationalité:</strong> {clients.find(c => c.id === questionnaireData.clientId)?.nationalite}</p>
                        )}
                      </div>
                    )}

                    {/* Statut matrimonial du client acheteur */}
                    <div className="space-y-2">
                      <Label htmlFor="statutMatrimonialClient">Statut matrimonial *</Label>
                      <Input 
                        id="statutMatrimonialClient"
                        value={questionnaireData.statutMatrimonialClient} 
                        onChange={(e) => setQuestionnaireData({...questionnaireData, statutMatrimonialClient: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>

                    {(questionnaireData.statutMatrimonialClient === "marie" || questionnaireData.statutMatrimonialClient === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="regimeMatrimonialClient">Régime matrimonial *</Label>
                          <Select value={questionnaireData.regimeMatrimonialClient} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialClient: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {questionnaireData.regimeMatrimonialClient === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="precisionRegimeClient">Préciser le régime</Label>
                            <Input 
                              id="precisionRegimeClient"
                              value={questionnaireData.precisionRegimeClient}
                              onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeClient: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}

                    {/* Pièce d'identité du client acquéreur */}
                    {questionnaireData.clientId && (
                      <div className="space-y-2">
                        <Label>📎 Pièce d'identité</Label>
                        {compromisClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(compromisClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}
                  </>
                ) : (
                  <>
                    {/* Saisie manuelle acquéreur (le client est vendeur) */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="nomAutrePartie">Nom *</Label>
                        <Input 
                          id="nomAutrePartie"
                          value={questionnaireData.nomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, nomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="prenomAutrePartie">Prénom *</Label>
                        <Input 
                          id="prenomAutrePartie"
                          value={questionnaireData.prenomAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, prenomAutrePartie: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="adresseAutrePartie">Adresse complète *</Label>
                        <Input 
                          id="adresseAutrePartie"
                          value={questionnaireData.adresseAutrePartie}
                          onChange={(e) => setQuestionnaireData({...questionnaireData, adresseAutrePartie: e.target.value})}
                        />
                      </div>

                      {/* Statut matrimonial autre partie */}
                      <div className="space-y-2">
                        <Label htmlFor="statutMatrimonialAutrePartie">Statut matrimonial *</Label>
                        <Select value={questionnaireData.statutMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, statutMatrimonialAutrePartie: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="celibataire">Célibataire</SelectItem>
                            <SelectItem value="marie">Marié</SelectItem>
                            <SelectItem value="pacse">Pacsé</SelectItem>
                            <SelectItem value="divorce">Divorcé</SelectItem>
                            <SelectItem value="veuf">Veuf</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {(questionnaireData.statutMatrimonialAutrePartie === "marie" || questionnaireData.statutMatrimonialAutrePartie === "pacse") && (
                        <>
                          <div className="space-y-2">
                            <Label htmlFor="regimeMatrimonialAutrePartie">Régime matrimonial *</Label>
                            <Select value={questionnaireData.regimeMatrimonialAutrePartie} onValueChange={(value) => setQuestionnaireData({...questionnaireData, regimeMatrimonialAutrePartie: value})}>
                              <SelectTrigger>
                                <SelectValue placeholder="Sélectionner..." />
                              </SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {questionnaireData.regimeMatrimonialAutrePartie === "autre" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label htmlFor="precisionRegimeAutrePartie">Préciser le régime</Label>
                              <Input 
                                id="precisionRegimeAutrePartie"
                                value={questionnaireData.precisionRegimeAutrePartie}
                                onChange={(e) => setQuestionnaireData({...questionnaireData, precisionRegimeAutrePartie: e.target.value})}
                                placeholder="Précisez le régime matrimonial..."
                              />
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </>
                )}
              </div>
              <div className="space-y-2">
                <Label>📎 Pièce d'identité de l'autre partie</Label>
                
                {/* Upload pour l'autre partie */}
                {questionnaireData.clientId && (
                  <div className="space-y-2">
                    <p className="text-sm font-medium text-muted-foreground">
                      {questionnaireData.clientRole === "vendeur" ? "Acquéreur" : "Vendeur"}
                    </p>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                    <input
                      type="file"
                      accept="application/pdf,image/*"
                      multiple
                      className="hidden"
                      id="compromis-autre-partie-upload"
                      onChange={(e) => {
                        const files = Array.from(e.target.files || []);
                        if (files.length > 0) {
                          setCompromisAutrePartieFiles(prev => [...prev, ...files]);
                          toast.success(`${files.length} fichier(s) ajouté(s)`);
                        }
                        e.target.value = '';
                      }}
                    />
                    <label htmlFor="compromis-autre-partie-upload" className="cursor-pointer flex items-center gap-3">
                      <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                        <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                        </svg>
                      </div>
                      <div className="flex-1">
                        <p className="text-sm font-medium">Joindre la pièce d'identité</p>
                        <p className="text-xs text-muted-foreground">PDF ou images</p>
                      </div>
                    </label>
                  </div>
                  {compromisAutrePartieFiles.length > 0 && (
                    <div className="space-y-2 mt-2">
                      {compromisAutrePartieFiles.map((file, index) => (
                        <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                          <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                          </svg>
                          <span className="text-sm flex-1 truncate">{file.name}</span>
                          <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="h-6 w-6 p-0 hover:bg-transparent"
                            onClick={() => setCompromisAutrePartieFiles(prev => prev.filter((_, i) => i !== index))}
                          >
                            <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                          </Button>
                        </div>
                      ))}
                    </div>
                  )}
                  </div>
                )}
              </div>
            </div>

            {/* Informations sur le bien */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">🏠 Informations sur le bien</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="adresseBien">Adresse complète du bien *</Label>
                  <Input 
                    id="adresseBien"
                    value={questionnaireData.adresseBien}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, adresseBien: e.target.value})}
                    placeholder="Ex: 12 rue de la Paix, 75002 Paris"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="typeBien">Type de bien *</Label>
                  <Select value={questionnaireData.typeBien} onValueChange={(value) => setQuestionnaireData({...questionnaireData, typeBien: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="appartement">Appartement</SelectItem>
                      <SelectItem value="maison">Maison</SelectItem>
                      <SelectItem value="terrain">Terrain</SelectItem>
                      <SelectItem value="immeuble">Immeuble</SelectItem>
                      <SelectItem value="local_commercial">Local commercial</SelectItem>
                      <SelectItem value="parking">Parking/Garage</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="surfaceHabitable">Surface habitable (m²) *</Label>
                  <Input 
                    id="surfaceHabitable"
                    type="number"
                    value={questionnaireData.surfaceHabitable}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, surfaceHabitable: e.target.value})}
                    placeholder="Ex: 75"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="nombrePieces">Nombre de pièces</Label>
                  <Input 
                    id="nombrePieces"
                    type="number"
                    value={questionnaireData.nombrePieces}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, nombrePieces: e.target.value})}
                    placeholder="Ex: 3"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="naturePropriete">Nature de la propriété *</Label>
                  <Select value={questionnaireData.naturePropriete} onValueChange={(value) => setQuestionnaireData({...questionnaireData, naturePropriete: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="pleine_propriete">Pleine propriété</SelectItem>
                      <SelectItem value="usufruit">Usufruit</SelectItem>
                      <SelectItem value="nue_propriete">Nue-propriété</SelectItem>
                      <SelectItem value="indivision">Indivision</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="bienCopropriete">Bien en copropriété ? *</Label>
                  <Select value={questionnaireData.bienCopropriete} onValueChange={(value) => setQuestionnaireData({...questionnaireData, bienCopropriete: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                {questionnaireData.bienCopropriete === "oui" && (
                  <>
                    <div className="space-y-2">
                      <Label htmlFor="numeroLot">Numéro de lot</Label>
                      <Input 
                        id="numeroLot"
                        value={questionnaireData.numeroLot}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, numeroLot: e.target.value})}
                        placeholder="Ex: 123"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="tantièmes">Tantièmes / Quote-part des parties communes</Label>
                      <Input 
                        id="tantièmes"
                        value={questionnaireData.tantièmes}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, tantièmes: e.target.value})}
                        placeholder="Ex: 150/10000"
                      />
                    </div>
                  </>
                )}
                <div className="space-y-2">
                  <Label htmlFor="occupationBien">Occupation du bien *</Label>
                  <Select value={questionnaireData.occupationBien} onValueChange={(value) => setQuestionnaireData({...questionnaireData, occupationBien: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="libre">Libre</SelectItem>
                      <SelectItem value="occupe_vendeur">Occupé par le vendeur</SelectItem>
                      <SelectItem value="occupe_locataire">Occupé par un locataire</SelectItem>
                      <SelectItem value="bail_en_cours">Bail en cours</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="servitudesConnues">Servitudes connues ? *</Label>
                  <Select value={questionnaireData.servitudesConnues} onValueChange={(value) => setQuestionnaireData({...questionnaireData, servitudesConnues: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                {questionnaireData.servitudesConnues === "oui" && (
                  <div className="space-y-2 md:col-span-2">
                    <Label htmlFor="descriptionServitudes">Description des servitudes</Label>
                    <Textarea 
                      id="descriptionServitudes"
                      value={questionnaireData.descriptionServitudes}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, descriptionServitudes: e.target.value})}
                      placeholder="Décrivez les servitudes..."
                      rows={3}
                    />
                  </div>
                )}
                <div className="space-y-2">
                  <Label htmlFor="bienLibre">Bien vendu libre de toute occupation à la signature ? *</Label>
                  <Select value={questionnaireData.bienLibre} onValueChange={(value) => setQuestionnaireData({...questionnaireData, bienLibre: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>

            {/* Conditions financières */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Conditions financières</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="prixVente">Prix de vente (€) *</Label>
                  <Input 
                    id="prixVente"
                    type="number"
                    value={questionnaireData.prixVente}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, prixVente: e.target.value})}
                    placeholder="Ex: 350000"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="depotGarantie">Dépôt de garantie (€)</Label>
                  <Input 
                    id="depotGarantie"
                    type="number"
                    value={questionnaireData.depotGarantie}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, depotGarantie: e.target.value})}
                    placeholder="Ex: 35000"
                  />
                </div>
                <div className="space-y-2 md:col-span-2">
                  <Label htmlFor="modalitesPaiement">Modalités de paiement</Label>
                  <Textarea 
                    id="modalitesPaiement"
                    rows={2}
                    value={questionnaireData.modalitesPaiement}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, modalitesPaiement: e.target.value})}
                    placeholder="Décrivez les modalités de paiement (comptant, crédit, etc.)"
                  />
                </div>
              </div>
            </div>

            {/* Conditions suspensives - Uniquement pour Compromis */}
            {questionnaireData.typeContrat === "compromis" && (
              <div className="space-y-4">
                <h3 className="font-semibold text-lg border-b pb-2">Conditions suspensives</h3>
                <div className="space-y-4">
                  <div className="space-y-2">
                    <Label htmlFor="conditionPret">Condition d'obtention de prêt ? *</Label>
                    <Select value={questionnaireData.conditionPret} onValueChange={(value) => setQuestionnaireData({...questionnaireData, conditionPret: value})}>
                      <SelectTrigger>
                        <SelectValue placeholder="Sélectionner..." />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  {questionnaireData.conditionPret === "oui" && (
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg">
                    <div className="md:col-span-2">
                      <h4 className="font-medium text-sm mb-4">Détails du prêt immobilier</h4>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="montantPret">Montant du prêt envisagé (€) *</Label>
                      <Input 
                        id="montantPret"
                        type="number"
                        value={questionnaireData.montantPret}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, montantPret: e.target.value})}
                        placeholder="Ex: 280000"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="dureePret">Durée maximale du prêt (années) *</Label>
                      <Input 
                        id="dureePret"
                        type="number"
                        value={questionnaireData.dureePret}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, dureePret: e.target.value})}
                        placeholder="Ex: 25"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="tauxInteretMax">Taux d'intérêt maximal accepté (%) *</Label>
                      <Input 
                        id="tauxInteretMax"
                        type="number"
                        step="0.01"
                        value={questionnaireData.tauxInteretMax}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, tauxInteretMax: e.target.value})}
                        placeholder="Ex: 3.5"
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="delaiAccordPret">Délai pour obtenir l'accord de prêt *</Label>
                      <Input 
                        id="delaiAccordPret"
                        value={questionnaireData.delaiAccordPret}
                        onChange={(e) => setQuestionnaireData({...questionnaireData, delaiAccordPret: e.target.value})}
                        placeholder="Ex: 45 jours ou date limite"
                      />
                    </div>
                  </div>
                )}
                <div className="space-y-2">
                  <Label htmlFor="conditionDiagnostics">Diagnostics et contrôles techniques</Label>
                  <Textarea 
                    id="conditionDiagnostics"
                    rows={2}
                    value={questionnaireData.conditionDiagnostics}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, conditionDiagnostics: e.target.value})}
                    placeholder="Ex: DPE, diagnostic amiante, plomb, termites..."
                  />
                </div>
                <div className="space-y-2">
                  <Label>📎 Joindre les diagnostics</Label>
                  <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                    <input
                      type="file"
                      accept="application/pdf"
                      multiple
                      className="hidden"
                      id="compromis-diagnostics-upload"
                      onChange={(e) => {
                        const files = Array.from(e.target.files || []);
                        if (files.length > 0) {
                          setCompromisDiagnosticsFiles(prev => [...prev, ...files]);
                          toast.success(`${files.length} fichier(s) ajouté(s)`);
                        }
                        e.target.value = '';
                      }}
                    />
                    <label htmlFor="compromis-diagnostics-upload" className="cursor-pointer flex items-center gap-3">
                      <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                        <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                      </div>
                      <div className="flex-1">
                        <p className="text-sm font-medium">Ajouter des documents</p>
                        <p className="text-xs text-muted-foreground">DPE, diagnostics, plans...</p>
                      </div>
                    </label>
                  </div>
                  {compromisDiagnosticsFiles.length > 0 && (
                    <div className="space-y-2 mt-2">
                      {compromisDiagnosticsFiles.map((file, index) => (
                        <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                          <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                          </svg>
                          <span className="text-sm flex-1 truncate">{file.name}</span>
                          <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="h-6 w-6 p-0 hover:bg-transparent"
                            onClick={() => setCompromisDiagnosticsFiles(prev => prev.filter((_, i) => i !== index))}
                          >
                            <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                            </svg>
                          </Button>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
                <div className="space-y-2">
                  <Label htmlFor="autresConditions">Autres conditions suspensives</Label>
                  <Textarea 
                    id="autresConditions"
                    rows={2}
                    value={questionnaireData.autresConditions}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, autresConditions: e.target.value})}
                    placeholder="Autres conditions éventuelles"
                  />
                </div>
              </div>
            </div>
            )}

            {/* Droit de préemption */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Droit de préemption</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="droitPreemptionUrbain">Bien soumis au droit de préemption urbain ? *</Label>
                  <Select value={questionnaireData.droitPreemptionUrbain} onValueChange={(value) => setQuestionnaireData({...questionnaireData, droitPreemptionUrbain: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                      <SelectItem value="inconnu">Inconnu</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label htmlFor="locatairePreemption">Présence d'un locataire avec droit de préemption ? *</Label>
                  <Select value={questionnaireData.locatairePreemption} onValueChange={(value) => setQuestionnaireData({...questionnaireData, locatairePreemption: value})}>
                    <SelectTrigger>
                      <SelectValue placeholder="Sélectionner..." />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="oui">Oui</SelectItem>
                      <SelectItem value="non">Non</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
              </div>
            </div>

            {/* Promesse unilatérale spécifique */}
            {questionnaireData.typeContrat === "promesse_unilaterale" && (
              <div className="space-y-4">
                <h3 className="font-semibold text-lg border-b pb-2">Spécifique à la promesse unilatérale de vente</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div className="space-y-2">
                    <Label htmlFor="dureeOption">Durée de l'option (en jours) *</Label>
                    <Input 
                      id="dureeOption"
                      type="number"
                      value={questionnaireData.dureeOption}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, dureeOption: e.target.value})}
                      placeholder="Ex: 60"
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="dateLimiteOption">Date limite de levée d'option *</Label>
                    <Input 
                      id="dateLimiteOption"
                      type="date"
                      value={questionnaireData.dateLimiteOption}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, dateLimiteOption: e.target.value})}
                    />
                  </div>
                  <div className="space-y-2 md:col-span-2">
                    <Label htmlFor="indemniteImmobilisation">Indemnité d'immobilisation (€ ou %) *</Label>
                    <Input 
                      id="indemniteImmobilisation"
                      value={questionnaireData.indemniteImmobilisation}
                      onChange={(e) => setQuestionnaireData({...questionnaireData, indemniteImmobilisation: e.target.value})}
                      placeholder="Ex: 5000 € ou 5% du prix de vente"
                    />
                  </div>
                </div>
              </div>
            )}

            {/* Délais */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Délais</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <Label htmlFor="dateSignatureActeDefinitif">Date prévue signature acte définitif</Label>
                  <Input 
                    id="dateSignatureActeDefinitif"
                    type="date"
                    value={questionnaireData.dateSignatureActeDefinitif}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, dateSignatureActeDefinitif: e.target.value})}
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="delaiReflexion">Délai de rétractation (jours)</Label>
                  <Input 
                    id="delaiReflexion"
                    type="number"
                    value={questionnaireData.delaiReflexion}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, delaiReflexion: e.target.value})}
                    placeholder="Ex: 10"
                  />
                </div>
              </div>
            </div>

            {/* Informations complémentaires */}
            <div className="space-y-4">
              <h3 className="font-semibold text-lg border-b pb-2">Informations complémentaires</h3>
              <div className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="chargesCopropriete">Charges de copropriété (si applicable)</Label>
                  <Textarea 
                    id="chargesCopropriete"
                    rows={2}
                    value={questionnaireData.chargesCopropriete}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, chargesCopropriete: e.target.value})}
                    placeholder="Montant annuel, répartition, détails..."
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="travauxAPrevenir">Travaux à prévoir</Label>
                  <Textarea 
                    id="travauxAPrevenir"
                    rows={2}
                    value={questionnaireData.travauxAPrevenir}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, travauxAPrevenir: e.target.value})}
                    placeholder="Description des travaux prévus ou nécessaires"
                  />
                </div>
                <div className="space-y-2">
                  <Label htmlFor="autresInformations">Autres informations utiles</Label>
                  <Textarea 
                    id="autresInformations"
                    rows={3}
                    value={questionnaireData.autresInformations}
                    onChange={(e) => setQuestionnaireData({...questionnaireData, autresInformations: e.target.value})}
                    placeholder="Toute information complémentaire pertinente pour le contrat"
                  />
                </div>
              </div>
            </div>
          </>
            )}

            {/* Formulaire spécifique pour Acte de vente immobilière */}
            {pendingContractType === "Acte de vente immobilière" && (
              <>
                {/* Sélection du rôle du client */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">Rôle du client</h3>
                  <div className="space-y-2">
                    <Label>Votre client est : *</Label>
                    <RadioGroup 
                      value={acteVenteData.clientRole}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, clientRole: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="vendeur" id="acte-vendeur" />
                        <Label htmlFor="acte-vendeur" className="cursor-pointer">Vendeur</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="acheteur" id="acte-acheteur" />
                        <Label htmlFor="acte-acheteur" className="cursor-pointer">Acquéreur</Label>
                      </div>
                    </RadioGroup>
                  </div>
                </div>

                {/* Vendeur - avec auto-fill si client sélectionné comme vendeur, sinon manuel */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">👤 Vendeur</h3>
                  <div className="space-y-4">
                    {acteVenteData.clientRole === "vendeur" ? (
                      <>
                        {/* Le client est le vendeur */}
                        <div className="space-y-2">
                          <Label htmlFor="acte_clientId">Sélectionner votre client *</Label>
                          <Select 
                            value={acteVenteData.clientId}
                            onValueChange={(value) => setActeVenteData({...acteVenteData, clientId: value})}
                          >
                            <SelectTrigger>
                              <SelectValue placeholder="Choisir un client" />
                            </SelectTrigger>
                            <SelectContent>
                              {clients.map((client) => (
                                <SelectItem key={client.id} value={client.id}>
                                  {client.nom} {client.prenom}
                                </SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                        </div>

                        {/* Afficher les informations du client sélectionné */}
                        {acteVenteData.clientId && clients.find(c => c.id === acteVenteData.clientId) && (
                          <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                            <p><strong>Nom complet:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nom} {clients.find(c => c.id === acteVenteData.clientId)?.prenom}</p>
                            {clients.find(c => c.id === acteVenteData.clientId)?.adresse && (
                              <p><strong>Adresse:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.adresse}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.telephone && (
                              <p><strong>Téléphone:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.telephone}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.email && (
                              <p><strong>Email:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.email}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.date_naissance && (
                              <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === acteVenteData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.nationalite && (
                              <p><strong>Nationalité:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nationalite}</p>
                            )}
                          </div>
                        )}
                      </>
                    ) : (
                      <>
                        {/* Saisie manuelle vendeur (le client est acheteur) */}
                        <div className="text-sm text-muted-foreground mb-2">
                          Saisir manuellement les informations du vendeur
                        </div>
                      </>
                    )}
                  </div>
                  
                  {/* Type de partie - Vendeur */}
                  <div className="space-y-4">
                    <Label>Type de partie *</Label>
                    <RadioGroup 
                      value={acteVenteData.vendeurTypePartie}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurTypePartie: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_physique" id="vendeur_pp" />
                        <Label htmlFor="vendeur_pp" className="cursor-pointer">Personne physique</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_morale" id="vendeur_pm" />
                        <Label htmlFor="vendeur_pm" className="cursor-pointer">Personne morale (société)</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si personne morale */}
                  {acteVenteData.vendeurTypePartie === "personne_morale" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="vendeur_denomination">Dénomination sociale *</Label>
                        <Input 
                          id="vendeur_denomination"
                          value={acteVenteData.vendeurDenominationSociale}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurDenominationSociale: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_forme">Forme juridique *</Label>
                        <Input 
                          id="vendeur_forme"
                          value={acteVenteData.vendeurFormeJuridique}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurFormeJuridique: e.target.value})}
                          placeholder="SARL, SAS, SCI..."
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_siren">SIREN *</Label>
                        <Input 
                          id="vendeur_siren"
                          value={acteVenteData.vendeurSiren}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurSiren: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="vendeur_siege">Adresse du siège social *</Label>
                        <Input 
                          id="vendeur_siege"
                          value={acteVenteData.vendeurSiegeSocial}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurSiegeSocial: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_representant">Nom du représentant légal *</Label>
                        <Input 
                          id="vendeur_representant"
                          value={acteVenteData.vendeurRepresentantNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurRepresentantNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_qualite">Qualité *</Label>
                        <Input 
                          id="vendeur_qualite"
                          value={acteVenteData.vendeurRepresentantQualite}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurRepresentantQualite: e.target.value})}
                          placeholder="Gérant, Président..."
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Extrait Kbis</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('kbis-vendeur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="kbis-vendeur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}

                  {/* Représentation - Vendeur */}
                  <div className="space-y-4">
                    <Label>La partie est-elle représentée ?</Label>
                    <RadioGroup 
                      value={acteVenteData.vendeurRepresente}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurRepresente: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="non" id="vendeur_rep_non" />
                        <Label htmlFor="vendeur_rep_non" className="cursor-pointer">Non</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="oui" id="vendeur_rep_oui" />
                        <Label htmlFor="vendeur_rep_oui" className="cursor-pointer">Oui</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si représenté */}
                  {acteVenteData.vendeurRepresente === "oui" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_mand_nom">Nom du mandataire *</Label>
                        <Input 
                          id="vendeur_mand_nom"
                          value={acteVenteData.vendeurMandataireNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurMandataireNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="vendeur_mand_prenom">Prénom du mandataire *</Label>
                        <Input 
                          id="vendeur_mand_prenom"
                          value={acteVenteData.vendeurMandatairePrenom}
                          onChange={(e) => setActeVenteData({...acteVenteData, vendeurMandatairePrenom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="vendeur_type_pouvoir">Type de pouvoir *</Label>
                        <Select value={acteVenteData.vendeurTypePouvoir} onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurTypePouvoir: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="mandat_authentique">Mandat authentique</SelectItem>
                            <SelectItem value="mandat_ssp">Mandat sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Joindre le mandat (PDF)</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('mandat-vendeur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="mandat-vendeur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}
                  
                  {/* Champs communs pour le vendeur */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurNom">Nom *</Label>
                      <Input 
                        id="acte_vendeurNom" 
                        value={acteVenteData.vendeurNom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurNom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurPrenom">Prénom *</Label>
                      <Input 
                        id="acte_vendeurPrenom" 
                        value={acteVenteData.vendeurPrenom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurPrenom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_vendeurAdresse">Adresse *</Label>
                      <Input 
                        id="acte_vendeurAdresse" 
                        value={acteVenteData.vendeurAdresse} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurAdresse: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurDateNaissance">Date de naissance *</Label>
                      <Input 
                        id="acte_vendeurDateNaissance" 
                        type="date" 
                        value={acteVenteData.vendeurDateNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurDateNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurLieuNaissance">Lieu de naissance *</Label>
                      <Input 
                        id="acte_vendeurLieuNaissance" 
                        value={acteVenteData.vendeurLieuNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurLieuNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurNationalite">Nationalité *</Label>
                      <Input 
                        id="acte_vendeurNationalite" 
                        value={acteVenteData.vendeurNationalite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurNationalite: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurProfession">Profession *</Label>
                      <Input 
                        id="acte_vendeurProfession" 
                        value={acteVenteData.vendeurProfession} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurProfession: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurStatut">Statut matrimonial *</Label>
                      <Input 
                        id="acte_vendeurStatut"
                        value={acteVenteData.vendeurStatutMatrimonial} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurStatutMatrimonial: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>
                    {(acteVenteData.vendeurStatutMatrimonial === "marie" || acteVenteData.vendeurStatutMatrimonial === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="acte_vendeurRegime">Régime matrimonial *</Label>
                          <Select value={acteVenteData.vendeurRegimeMatrimonial} onValueChange={(value) => setActeVenteData({...acteVenteData, vendeurRegimeMatrimonial: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {acteVenteData.vendeurRegimeMatrimonial === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="acte_vendeurPrecisionRegime">Préciser le régime</Label>
                            <Input 
                              id="acte_vendeurPrecisionRegime"
                              value={acteVenteData.vendeurPrecisionRegime}
                              onChange={(e) => setActeVenteData({...acteVenteData, vendeurPrecisionRegime: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurPiece">Type de pièce d'identité *</Label>
                      <Input 
                        id="acte_vendeurPiece" 
                        value={acteVenteData.vendeurPieceIdentite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurPieceIdentite: e.target.value})} 
                        placeholder="Ex: CNI, Passeport" 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_vendeurNumero">Numéro de pièce d'identité *</Label>
                      <Input 
                        id="acte_vendeurNumero" 
                        value={acteVenteData.vendeurNumeroIdentite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, vendeurNumeroIdentite: e.target.value})} 
                        
                      />
                    </div>
                  </div>
                  
                  {/* Pièce d'identité du vendeur - chargée depuis client ou upload */}
                  {acteVenteData.clientRole === "vendeur" && acteVenteData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {acteClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(acteClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="w-4 h-4" />
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : (
                    /* Upload de pièces d'identité vendeur */
                    <div className="space-y-2">
                      <Label>📎 Pièces d'identité du vendeur</Label>
                      <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                        <input
                          type="file"
                          accept="application/pdf,image/*"
                          multiple
                          className="hidden"
                          id="acte-vendeur-upload"
                          onChange={(e) => {
                            const files = Array.from(e.target.files || []);
                            if (files.length > 0) {
                              setActeVendeurFiles(prev => [...prev, ...files]);
                              toast.success(`${files.length} fichier(s) ajouté(s)`);
                            }
                            e.target.value = '';
                          }}
                        />
                        <label htmlFor="acte-vendeur-upload" className="cursor-pointer flex items-center gap-3">
                          <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                            <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                            </svg>
                          </div>
                          <div className="flex-1">
                            <p className="text-sm font-medium">Joindre des pièces d'identité</p>
                            <p className="text-xs text-muted-foreground">CNI, passeport, livret de famille - PDF ou images</p>
                          </div>
                        </label>
                      </div>
                      {acteVendeurFiles.length > 0 && (
                        <div className="space-y-2 mt-2">
                          {acteVendeurFiles.map((file, index) => (
                            <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                              <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                              <span className="text-sm flex-1 truncate">{file.name}</span>
                              <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                className="h-6 w-6 p-0 hover:bg-transparent"
                                onClick={() => setActeVendeurFiles(prev => prev.filter((_, i) => i !== index))}
                              >
                                <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                              </Button>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}
                </div>

                {/* Acheteur - avec auto-fill si client sélectionné comme acheteur, sinon manuel */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">👥 Acquéreur</h3>
                  <div className="space-y-4">
                    {acteVenteData.clientRole === "acheteur" ? (
                      <>
                        {/* Le client est l'acheteur */}
                        <div className="space-y-2">
                          <Label htmlFor="acte_clientId_acheteur">Sélectionner votre client *</Label>
                          <Select 
                            value={acteVenteData.clientId}
                            onValueChange={(value) => setActeVenteData({...acteVenteData, clientId: value})}
                          >
                            <SelectTrigger>
                              <SelectValue placeholder="Choisir un client" />
                            </SelectTrigger>
                            <SelectContent>
                              {clients.map((client) => (
                                <SelectItem key={client.id} value={client.id}>
                                  {client.nom} {client.prenom}
                                </SelectItem>
                              ))}
                            </SelectContent>
                          </Select>
                        </div>

                        {/* Afficher les informations du client sélectionné */}
                        {acteVenteData.clientId && clients.find(c => c.id === acteVenteData.clientId) && (
                          <div className="p-4 bg-muted/50 rounded-lg space-y-2 text-sm">
                            <p><strong>Nom complet:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nom} {clients.find(c => c.id === acteVenteData.clientId)?.prenom}</p>
                            {clients.find(c => c.id === acteVenteData.clientId)?.adresse && (
                              <p><strong>Adresse:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.adresse}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.telephone && (
                              <p><strong>Téléphone:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.telephone}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.email && (
                              <p><strong>Email:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.email}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.date_naissance && (
                              <p><strong>Date de naissance:</strong> {new Date(clients.find(c => c.id === acteVenteData.clientId)?.date_naissance).toLocaleDateString('fr-FR')}</p>
                            )}
                            {clients.find(c => c.id === acteVenteData.clientId)?.nationalite && (
                              <p><strong>Nationalité:</strong> {clients.find(c => c.id === acteVenteData.clientId)?.nationalite}</p>
                            )}
                          </div>
                        )}
                      </>
                    ) : (
                      <>
                        {/* Saisie manuelle acheteur (le client est vendeur) */}
                        <div className="text-sm text-muted-foreground mb-2">
                          Saisir manuellement les informations de l'acheteur
                        </div>
                      </>
                    )}
                  </div>
                  
                  {/* Champs communs pour l'acheteur */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurNom">Nom *</Label>
                      <Input 
                        id="acte_acheteurNom" 
                        value={acteVenteData.acheteurNom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurNom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurPrenom">Prénom *</Label>
                      <Input 
                        id="acte_acheteurPrenom" 
                        value={acteVenteData.acheteurPrenom} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurPrenom: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_acheteurAdresse">Adresse *</Label>
                      <Input 
                        id="acte_acheteurAdresse" 
                        value={acteVenteData.acheteurAdresse} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurAdresse: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurDateNaissance">Date de naissance *</Label>
                      <Input 
                        id="acte_acheteurDateNaissance" 
                        type="date" 
                        value={acteVenteData.acheteurDateNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurDateNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurLieuNaissance">Lieu de naissance *</Label>
                      <Input 
                        id="acte_acheteurLieuNaissance" 
                        value={acteVenteData.acheteurLieuNaissance} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurLieuNaissance: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurNationalite">Nationalité *</Label>
                      <Input 
                        id="acte_acheteurNationalite" 
                        value={acteVenteData.acheteurNationalite} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurNationalite: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurProfession">Profession *</Label>
                      <Input 
                        id="acte_acheteurProfession" 
                        value={acteVenteData.acheteurProfession} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurProfession: e.target.value})} 
                        
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_acheteurStatut">Statut matrimonial *</Label>
                      <Input 
                        id="acte_acheteurStatut"
                        value={acteVenteData.acheteurStatutMatrimonial} 
                        onChange={(e) => setActeVenteData({...acteVenteData, acheteurStatutMatrimonial: e.target.value})}
                        placeholder="Ex: Célibataire, Marié, Pacsé, Divorcé, Veuf"
                      />
                    </div>
                    {(acteVenteData.acheteurStatutMatrimonial === "marie" || acteVenteData.acheteurStatutMatrimonial === "pacse") && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="acte_acheteurRegime">Régime matrimonial *</Label>
                          <Select value={acteVenteData.acheteurRegimeMatrimonial} onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurRegimeMatrimonial: value})}>
                            <SelectTrigger>
                              <SelectValue placeholder="Sélectionner..." />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                              <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {acteVenteData.acheteurRegimeMatrimonial === "autre" && (
                          <div className="space-y-2">
                            <Label htmlFor="acte_acheteurPrecisionRegime">Préciser le régime</Label>
                            <Input 
                              id="acte_acheteurPrecisionRegime"
                              value={acteVenteData.acheteurPrecisionRegime}
                              onChange={(e) => setActeVenteData({...acteVenteData, acheteurPrecisionRegime: e.target.value})}
                              placeholder="Précisez le régime matrimonial..."
                            />
                          </div>
                        )}
                      </>
                    )}
                    <div className="space-y-2">
                      <Label htmlFor="acte_modeAcquisition">Mode d'acquisition *</Label>
                      <Select value={acteVenteData.acheteurModeAcquisition} onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurModeAcquisition: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="seul">Achat seul</SelectItem>
                          <SelectItem value="couple">En couple</SelectItem>
                          <SelectItem value="indivision">En indivision</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.acheteurModeAcquisition === "indivision" && (
                      <div className="space-y-2">
                        <Label htmlFor="acte_quotePart">Quote-part d'acquisition (%)</Label>
                        <Input id="acte_quotePart" type="number" value={acteVenteData.acheteurQuotePart} onChange={(e) => setActeVenteData({...acteVenteData, acheteurQuotePart: e.target.value})} placeholder="Ex: 50" />
                      </div>
                    )}
                  </div>
                  
                  {/* Type de partie - Acquéreur */}
                  <div className="space-y-4">
                    <Label>Type de partie *</Label>
                    <RadioGroup 
                      value={acteVenteData.acheteurTypePartie}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurTypePartie: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_physique" id="acheteur_pp" />
                        <Label htmlFor="acheteur_pp" className="cursor-pointer">Personne physique</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="personne_morale" id="acheteur_pm" />
                        <Label htmlFor="acheteur_pm" className="cursor-pointer">Personne morale (société)</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si personne morale - Acquéreur */}
                  {acteVenteData.acheteurTypePartie === "personne_morale" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg">
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acheteur_denomination">Dénomination sociale *</Label>
                        <Input 
                          id="acheteur_denomination"
                          value={acteVenteData.acheteurDenominationSociale}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurDenominationSociale: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_forme">Forme juridique *</Label>
                        <Input 
                          id="acheteur_forme"
                          value={acteVenteData.acheteurFormeJuridique}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurFormeJuridique: e.target.value})}
                          placeholder="SARL, SAS, SCI..."
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_siren">SIREN *</Label>
                        <Input 
                          id="acheteur_siren"
                          value={acteVenteData.acheteurSiren}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurSiren: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acheteur_siege">Adresse du siège social *</Label>
                        <Input 
                          id="acheteur_siege"
                          value={acteVenteData.acheteurSiegeSocial}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurSiegeSocial: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_representant">Nom du représentant légal *</Label>
                        <Input 
                          id="acheteur_representant"
                          value={acteVenteData.acheteurRepresentantNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurRepresentantNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_qualite">Qualité *</Label>
                        <Input 
                          id="acheteur_qualite"
                          value={acteVenteData.acheteurRepresentantQualite}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurRepresentantQualite: e.target.value})}
                          placeholder="Gérant, Président..."
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Extrait Kbis</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('kbis-acheteur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="kbis-acheteur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}

                  {/* Représentation - Acquéreur */}
                  <div className="space-y-4">
                    <Label>La partie est-elle représentée ?</Label>
                    <RadioGroup 
                      value={acteVenteData.acheteurRepresente}
                      onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurRepresente: value})}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="non" id="acheteur_rep_non" />
                        <Label htmlFor="acheteur_rep_non" className="cursor-pointer">Non</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="oui" id="acheteur_rep_oui" />
                        <Label htmlFor="acheteur_rep_oui" className="cursor-pointer">Oui</Label>
                      </div>
                    </RadioGroup>
                  </div>

                  {/* Si représenté - Acquéreur */}
                  {acteVenteData.acheteurRepresente === "oui" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_mand_nom">Nom du mandataire *</Label>
                        <Input 
                          id="acheteur_mand_nom"
                          value={acteVenteData.acheteurMandataireNom}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurMandataireNom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acheteur_mand_prenom">Prénom du mandataire *</Label>
                        <Input 
                          id="acheteur_mand_prenom"
                          value={acteVenteData.acheteurMandatairePrenom}
                          onChange={(e) => setActeVenteData({...acteVenteData, acheteurMandatairePrenom: e.target.value})}
                        />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acheteur_type_pouvoir">Type de pouvoir *</Label>
                        <Select value={acteVenteData.acheteurTypePouvoir} onValueChange={(value) => setActeVenteData({...acteVenteData, acheteurTypePouvoir: value})}>
                          <SelectTrigger>
                            <SelectValue placeholder="Sélectionner..." />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="mandat_authentique">Mandat authentique</SelectItem>
                            <SelectItem value="mandat_ssp">Mandat sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Joindre le mandat (PDF)</Label>
                        <button
                          type="button"
                          className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                          onClick={() => document.getElementById('mandat-acheteur')?.click()}
                        >
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                        </button>
                        <Input id="mandat-acheteur" type="file" accept=".pdf" className="hidden" />
                      </div>
                    </div>
                  )}
                  
                  {/* Pièce d'identité de l'acquéreur - chargée depuis client ou upload */}
                  {acteVenteData.clientRole === "acheteur" && acteVenteData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {acteClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(acteClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="w-4 h-4" />
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : (
                    /* Upload de pièces d'identité acheteur */
                  <div className="space-y-2">
                    <Label>📎 Pièces d'identité de l'acheteur</Label>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                      <input
                        type="file"
                        accept="application/pdf,image/*"
                        multiple
                        className="hidden"
                        id="acte-acheteur-upload"
                        onChange={(e) => {
                          const files = Array.from(e.target.files || []);
                          if (files.length > 0) {
                            setActeAcheteurFiles(prev => [...prev, ...files]);
                            toast.success(`${files.length} fichier(s) ajouté(s)`);
                          }
                          e.target.value = '';
                        }}
                      />
                      <label htmlFor="acte-acheteur-upload" className="cursor-pointer flex items-center gap-3">
                        <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                          <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <p className="text-sm font-medium">Joindre des pièces d'identité</p>
                          <p className="text-xs text-muted-foreground">CNI, passeport, livret de famille - PDF ou images</p>
                        </div>
                      </label>
                    </div>
                    {acteAcheteurFiles.length > 0 && (
                      <div className="space-y-2 mt-2">
                        {acteAcheteurFiles.map((file, index) => (
                          <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                            <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span className="text-sm flex-1 truncate">{file.name}</span>
                            <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="h-6 w-6 p-0 hover:bg-transparent"
                              onClick={() => setActeAcheteurFiles(prev => prev.filter((_, i) => i !== index))}
                            >
                              <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                              </svg>
                            </Button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                  )}
                </div>

                {/* Informations sur le bien */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏠 Informations sur le bien</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_adresse">Adresse complète du bien *</Label>
                      <Input 
                        id="acte_adresse"
                        value={acteVenteData.adresseBien}
                        onChange={(e) => setActeVenteData({...acteVenteData, adresseBien: e.target.value})}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_typeBien">Type de bien *</Label>
                      <Select value={acteVenteData.typeBien} onValueChange={(value) => setActeVenteData({...acteVenteData, typeBien: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="appartement">Appartement</SelectItem>
                          <SelectItem value="maison">Maison</SelectItem>
                          <SelectItem value="terrain">Terrain</SelectItem>
                          <SelectItem value="immeuble">Immeuble</SelectItem>
                          <SelectItem value="local_commercial">Local commercial</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_naturePropriete">Nature de propriété *</Label>
                      <Select value={acteVenteData.naturePropriete} onValueChange={(value) => setActeVenteData({...acteVenteData, naturePropriete: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="pleine_propriete">Pleine propriété</SelectItem>
                          <SelectItem value="usufruit">Usufruit</SelectItem>
                          <SelectItem value="nue_propriete">Nue-propriété</SelectItem>
                          <SelectItem value="indivision">Indivision</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_sectionCadastrale">Section cadastrale *</Label>
                      <Input id="acte_sectionCadastrale" value={acteVenteData.sectionCadastrale} onChange={(e) => setActeVenteData({...acteVenteData, sectionCadastrale: e.target.value})} placeholder="Ex: AB" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_numeroCadastral">Numéro cadastral *</Label>
                      <Input id="acte_numeroCadastral" value={acteVenteData.numeroCadastral} onChange={(e) => setActeVenteData({...acteVenteData, numeroCadastral: e.target.value})} placeholder="Ex: 123" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_contenanceCadastrale">Contenance cadastrale *</Label>
                      <Input id="acte_contenanceCadastrale" value={acteVenteData.contenanceCadastrale} onChange={(e) => setActeVenteData({...acteVenteData, contenanceCadastrale: e.target.value})} placeholder="Ex: 500 m²" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_surfaceHabitable">Surface habitable (m²) *</Label>
                      <Input id="acte_surfaceHabitable" type="number" value={acteVenteData.surfaceHabitable} onChange={(e) => setActeVenteData({...acteVenteData, surfaceHabitable: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_surfaceTerrain">Surface du terrain (m²)</Label>
                      <Input id="acte_surfaceTerrain" type="number" value={acteVenteData.surfaceTerrain} onChange={(e) => setActeVenteData({...acteVenteData, surfaceTerrain: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_nombrePieces">Nombre de pièces</Label>
                      <Input id="acte_nombrePieces" type="number" value={acteVenteData.nombrePieces} onChange={(e) => setActeVenteData({...acteVenteData, nombrePieces: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_anneeConstruction">Année de construction</Label>
                      <Input id="acte_anneeConstruction" type="number" value={acteVenteData.anneeConstruction} onChange={(e) => setActeVenteData({...acteVenteData, anneeConstruction: e.target.value})} placeholder="Ex: 1990" />
                    </div>
                  </div>

                  {/* Annexes et dépendances */}
                  <div className="space-y-4 p-4 bg-slate-50 dark:bg-slate-900 rounded-lg">
                    <h4 className="font-medium">Annexes et dépendances</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_garage">Garage</Label>
                        <Select value={acteVenteData.bienGarage} onValueChange={(value) => setActeVenteData({...acteVenteData, bienGarage: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_parking">Parking</Label>
                        <Select value={acteVenteData.bienParking} onValueChange={(value) => setActeVenteData({...acteVenteData, bienParking: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_cave">Cave</Label>
                        <Select value={acteVenteData.bienCave} onValueChange={(value) => setActeVenteData({...acteVenteData, bienCave: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_grenier">Grenier</Label>
                        <Select value={acteVenteData.bienGrenier} onValueChange={(value) => setActeVenteData({...acteVenteData, bienGrenier: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_jardin">Jardin</Label>
                        <Select value={acteVenteData.bienJardin} onValueChange={(value) => setActeVenteData({...acteVenteData, bienJardin: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_autresDep">Autres dépendances</Label>
                        <Input 
                          id="acte_autresDep"
                          value={acteVenteData.autresDependances}
                          onChange={(e) => setActeVenteData({...acteVenteData, autresDependances: e.target.value})}
                          placeholder="Ex: buanderie, atelier..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* Équipements inclus dans la vente */}
                  <div className="space-y-4 p-4 bg-green-50 dark:bg-green-950 rounded-lg">
                    <h4 className="font-medium">Équipements inclus dans la vente</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_cuisine">Cuisine équipée</Label>
                        <Select value={acteVenteData.cuisineEquipee} onValueChange={(value) => setActeVenteData({...acteVenteData, cuisineEquipee: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_electromenagers">Électroménagers inclus</Label>
                        <Select value={acteVenteData.electromenagersInclus} onValueChange={(value) => setActeVenteData({...acteVenteData, electromenagersInclus: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {acteVenteData.electromenagersInclus === "oui" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label htmlFor="acte_electroListe">Liste des électroménagers</Label>
                          <Textarea 
                            id="acte_electroListe"
                            value={acteVenteData.electromenagersListe}
                            onChange={(e) => setActeVenteData({...acteVenteData, electromenagersListe: e.target.value})}
                            placeholder="Ex: réfrigérateur, four, lave-vaisselle..."
                            rows={2}
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label htmlFor="acte_mobilier">Mobilier laissé</Label>
                        <Select value={acteVenteData.mobilierLaisse} onValueChange={(value) => setActeVenteData({...acteVenteData, mobilierLaisse: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="acte_autresEquip">Autres équipements</Label>
                        <Input 
                          id="acte_autresEquip"
                          value={acteVenteData.autresEquipements}
                          onChange={(e) => setActeVenteData({...acteVenteData, autresEquipements: e.target.value})}
                          placeholder="Ex: climatisation, alarme..."
                        />
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_destinationBien">Destination du bien *</Label>
                      <Select value={acteVenteData.destinationBien} onValueChange={(value) => setActeVenteData({...acteVenteData, destinationBien: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="habitation">Habitation</SelectItem>
                          <SelectItem value="commerciale">Commerciale</SelectItem>
                          <SelectItem value="mixte">Mixte</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Copropriété */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏢 Copropriété</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_bienCopropriete">Bien en copropriété ? *</Label>
                      <Select value={acteVenteData.bienCopropriete} onValueChange={(value) => setActeVenteData({...acteVenteData, bienCopropriete: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.bienCopropriete === "oui" && (
                      <>
                        <div className="space-y-2">
                          <Label htmlFor="acte_numerosLots">Numéros de lot(s)</Label>
                          <Input id="acte_numerosLots" value={acteVenteData.numerosLots} onChange={(e) => setActeVenteData({...acteVenteData, numerosLots: e.target.value})} placeholder="Ex: 12, 13, 14" />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_tantiemes">Tantièmes / Quote-parts</Label>
                          <Input id="acte_tantiemes" value={acteVenteData.tantièmes} onChange={(e) => setActeVenteData({...acteVenteData, tantièmes: e.target.value})} placeholder="Ex: 150/10000" />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_reglementCopro">Règlement de copropriété disponible ?</Label>
                          <Select value={acteVenteData.reglementCopro} onValueChange={(value) => setActeVenteData({...acteVenteData, reglementCopro: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_chargesAnnuelles">Charges annuelles (€)</Label>
                          <Input id="acte_chargesAnnuelles" type="number" value={acteVenteData.chargesAnnuelles} onChange={(e) => setActeVenteData({...acteVenteData, chargesAnnuelles: e.target.value})} />
                        </div>
                      </>
                    )}
                  </div>
                </div>

                {/* État juridique */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">⚖️ État juridique du bien</h3>
                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_servitudes">Servitudes existantes</Label>
                      <Textarea id="acte_servitudes" value={acteVenteData.servitudesExistantes} onChange={(e) => setActeVenteData({...acteVenteData, servitudesExistantes: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_hypotheques">Hypothèques / Inscriptions existantes</Label>
                      <Textarea id="acte_hypotheques" value={acteVenteData.hypotheques} onChange={(e) => setActeVenteData({...acteVenteData, hypotheques: e.target.value})} rows={2} />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_bienLibre">Bien libre ou occupé à l'acte ?</Label>
                        <Select value={acteVenteData.bienLibreOuOccupe} onValueChange={(value) => setActeVenteData({...acteVenteData, bienLibreOuOccupe: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="libre">Libre</SelectItem>
                            <SelectItem value="occupe">Occupé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {acteVenteData.bienLibreOuOccupe === "occupe" && (
                        <div className="space-y-2">
                          <Label htmlFor="acte_infoBail">Informations sur le bail</Label>
                          <Input id="acte_infoBail" value={acteVenteData.informationsBail} onChange={(e) => setActeVenteData({...acteVenteData, informationsBail: e.target.value})} />
                        </div>
                      )}
                    </div>

                    {/* Détails d'occupation si occupé */}
                    {acteVenteData.bienLibreOuOccupe === "occupe" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                        <div className="space-y-2 md:col-span-2">
                          <Label htmlFor="acte_locataireNom">Nom du locataire</Label>
                          <Input 
                            id="acte_locataireNom"
                            value={acteVenteData.locataireNom}
                            onChange={(e) => setActeVenteData({...acteVenteData, locataireNom: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dateBail">Date du bail</Label>
                          <Input 
                            id="acte_dateBail"
                            type="date"
                            value={acteVenteData.dateBail}
                            onChange={(e) => setActeVenteData({...acteVenteData, dateBail: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dureeBail">Durée du bail</Label>
                          <Input 
                            id="acte_dureeBail"
                            value={acteVenteData.dureeBail}
                            onChange={(e) => setActeVenteData({...acteVenteData, dureeBail: e.target.value})}
                            placeholder="Ex: 3 ans"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_montantLoyer">Montant du loyer mensuel (€)</Label>
                          <Input 
                            id="acte_montantLoyer"
                            type="number"
                            value={acteVenteData.montantLoyer}
                            onChange={(e) => setActeVenteData({...acteVenteData, montantLoyer: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_depotGarantieLocataire">Dépôt de garantie (€)</Label>
                          <Input 
                            id="acte_depotGarantieLocataire"
                            type="number"
                            value={acteVenteData.depotGarantieLocataire}
                            onChange={(e) => setActeVenteData({...acteVenteData, depotGarantieLocataire: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dateLiberation">Date prévue de libération</Label>
                          <Input 
                            id="acte_dateLiberation"
                            type="date"
                            value={acteVenteData.dateLiberation}
                            onChange={(e) => setActeVenteData({...acteVenteData, dateLiberation: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Bail locatif (PDF)</Label>
                          <button
                            type="button"
                            className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                            onClick={() => document.getElementById('bail-locatif')?.click()}
                          >
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce chargée - Cliquer pour ajouter</span>
                          </button>
                          <Input id="bail-locatif" type="file" accept=".pdf" className="hidden" />
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* Conditions financières */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">💶 Conditions financières</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_prixVente">Prix de vente (€) *</Label>
                      <Input id="acte_prixVente" type="number" value={acteVenteData.prixVente} onChange={(e) => setActeVenteData({...acteVenteData, prixVente: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_origineFonds">Origine des fonds</Label>
                      <Input id="acte_origineFonds" value={acteVenteData.origineFonds} onChange={(e) => setActeVenteData({...acteVenteData, origineFonds: e.target.value})} placeholder="Épargne / Revente / Prêt" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_depotGarantie">Dépôt de garantie versé (€)</Label>
                      <Input id="acte_depotGarantie" type="number" value={acteVenteData.depotGarantie} onChange={(e) => setActeVenteData({...acteVenteData, depotGarantie: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_fraisNotaire">Frais de notaire estimés (€)</Label>
                      <Input id="acte_fraisNotaire" type="number" value={acteVenteData.fraisNotaire} onChange={(e) => setActeVenteData({...acteVenteData, fraisNotaire: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_repartition">Répartition prorata temporis</Label>
                      <Textarea id="acte_repartition" value={acteVenteData.repartitionProrata} onChange={(e) => setActeVenteData({...acteVenteData, repartitionProrata: e.target.value})} rows={2} placeholder="Taxe foncière, charges, loyers..." />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_modalitesPaiement">Modalités de paiement</Label>
                      <Textarea id="acte_modalitesPaiement" value={acteVenteData.modalitesPaiement} onChange={(e) => setActeVenteData({...acteVenteData, modalitesPaiement: e.target.value})} rows={2} placeholder="Virement notarial / Prêts bancaires" />
                    </div>
                  </div>
                </div>

                {/* Prêt immobilier */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏦 Prêt immobilier</h3>
                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_pretImmobilier">Achat financé par prêt ?</Label>
                      <Select value={acteVenteData.pretImmobilier} onValueChange={(value) => setActeVenteData({...acteVenteData, pretImmobilier: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.pretImmobilier === "oui" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg">
                        <div className="space-y-2">
                          <Label htmlFor="acte_montantPret">Montant du prêt (€) *</Label>
                          <Input id="acte_montantPret" type="number" value={acteVenteData.montantPret} onChange={(e) => setActeVenteData({...acteVenteData, montantPret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_banque">Banque prêteuse *</Label>
                          <Input id="acte_banque" value={acteVenteData.banquePreteur} onChange={(e) => setActeVenteData({...acteVenteData, banquePreteur: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_tauxPret">Taux réel obtenu (%) *</Label>
                          <Input id="acte_tauxPret" type="number" step="0.01" value={acteVenteData.tauxPret} onChange={(e) => setActeVenteData({...acteVenteData, tauxPret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dureePret">Durée du prêt (années) *</Label>
                          <Input id="acte_dureePret" type="number" value={acteVenteData.dureePret} onChange={(e) => setActeVenteData({...acteVenteData, dureePret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_typePret">Type de prêt *</Label>
                          <Input id="acte_typePret" value={acteVenteData.typePret} onChange={(e) => setActeVenteData({...acteVenteData, typePret: e.target.value})} placeholder="Amortissable / Relais / PTZ" />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_dateAccordPret">Date accord de prêt *</Label>
                          <Input id="acte_dateAccordPret" type="date" value={acteVenteData.dateAccordPret} onChange={(e) => setActeVenteData({...acteVenteData, dateAccordPret: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_tauxMaximal">Taux maximal accepté (%)</Label>
                          <Input 
                            id="acte_tauxMaximal"
                            type="number"
                            step="0.01"
                            value={acteVenteData.tauxMaximal}
                            onChange={(e) => setActeVenteData({...acteVenteData, tauxMaximal: e.target.value})}
                            placeholder="Ex: 4.5"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label htmlFor="acte_conditionSuspensivePret">Condition suspensive de prêt</Label>
                          <Select 
                            value={acteVenteData.conditionSuspensivePret} 
                            onValueChange={(value) => setActeVenteData({...acteVenteData, conditionSuspensivePret: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label htmlFor="acte_conditionsPret">Conditions particulières du prêt</Label>
                          <Textarea id="acte_conditionsPret" value={acteVenteData.conditionsPret} onChange={(e) => setActeVenteData({...acteVenteData, conditionsPret: e.target.value})} rows={2} />
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* Documents et diagnostics */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">📜 Documents & diagnostics obligatoires</h3>
                  
                  {/* Diagnostics - données essentielles */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-purple-50 dark:bg-purple-950 rounded-lg">
                    <div className="space-y-2">
                      <Label htmlFor="acte_dateDPE">Date du DPE</Label>
                      <Input 
                        id="acte_dateDPE"
                        type="date"
                        value={acteVenteData.dateDPE}
                        onChange={(e) => setActeVenteData({...acteVenteData, dateDPE: e.target.value})}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_classeEnergetique">Classe énergétique</Label>
                      <Select 
                        value={acteVenteData.classeEnergetique} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, classeEnergetique: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="A">A</SelectItem>
                          <SelectItem value="B">B</SelectItem>
                          <SelectItem value="C">C</SelectItem>
                          <SelectItem value="D">D</SelectItem>
                          <SelectItem value="E">E</SelectItem>
                          <SelectItem value="F">F</SelectItem>
                          <SelectItem value="G">G</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_presenceAmiante">Présence d'amiante</Label>
                      <Select 
                        value={acteVenteData.presenceAmiante} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, presenceAmiante: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_presencePlomb">Présence de plomb</Label>
                      <Select 
                        value={acteVenteData.presencePlomb} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, presencePlomb: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_presenceTermites">Présence de termites</Label>
                      <Select 
                        value={acteVenteData.presenceTermites} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, presenceTermites: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_assainissementConforme">Assainissement conforme</Label>
                      <Select 
                        value={acteVenteData.assainissementConforme} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, assainissementConforme: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="non_applicable">Non applicable</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="acte_diagnostics">Autres diagnostics fournis</Label>
                    <Textarea id="acte_diagnostics" value={acteVenteData.diagnosticsFournis} onChange={(e) => setActeVenteData({...acteVenteData, diagnosticsFournis: e.target.value})} rows={3} placeholder="Électricité, Gaz, Loi Carrez, ERP, Audit énergétique..." />
                  </div>
                  <div className="space-y-2">
                    <Label>📎 Joindre les diagnostics et documents obligatoires</Label>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 hover:border-muted-foreground/50 transition-colors">
                      <input
                        type="file"
                        accept="application/pdf"
                        multiple
                        className="hidden"
                        id="acte-diagnostics-upload"
                        onChange={(e) => {
                          const files = Array.from(e.target.files || []);
                          if (files.length > 0) {
                            setActeDiagnosticsFiles(prev => [...prev, ...files]);
                            toast.success(`${files.length} fichier(s) ajouté(s)`);
                          }
                          e.target.value = '';
                        }}
                      />
                      <label htmlFor="acte-diagnostics-upload" className="cursor-pointer flex flex-col items-center gap-2">
                        <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                          <svg className="w-6 h-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                          </svg>
                        </div>
                        <div className="text-center">
                          <p className="text-sm font-medium">Cliquez pour parcourir</p>
                          <p className="text-xs text-muted-foreground">DPE, diagnostics, titre de propriété, plans...</p>
                        </div>
                      </label>
                    </div>
                    {acteDiagnosticsFiles.length > 0 && (
                      <div className="space-y-2 mt-2">
                        {acteDiagnosticsFiles.map((file, index) => (
                          <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                            <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span className="text-sm flex-1 truncate">{file.name}</span>
                            <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="h-6 w-6 p-0 hover:bg-transparent"
                              onClick={() => setActeDiagnosticsFiles(prev => prev.filter((_, i) => i !== index))}
                            >
                              <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                              </svg>
                            </Button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                {/* Déclarations vendeur */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">Déclarations & attestations du vendeur</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_origineDate">Date d'acquisition précédente *</Label>
                      <Input id="acte_origineDate" type="date" value={acteVenteData.origineProprieteDateAcquisition} onChange={(e) => setActeVenteData({...acteVenteData, origineProprieteDateAcquisition: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_origineRef">Référence acte d'acquisition *</Label>
                      <Input id="acte_origineRef" value={acteVenteData.origineReferenceActe} onChange={(e) => setActeVenteData({...acteVenteData, origineReferenceActe: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_travaux">Travaux réalisés (10 dernières années)</Label>
                      <Textarea id="acte_travaux" value={acteVenteData.travauxDerniers10ans} onChange={(e) => setActeVenteData({...acteVenteData, travauxDerniers10ans: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_conformiteUrbanisme">Conformité urbanisme</Label>
                      <Input id="acte_conformiteUrbanisme" value={acteVenteData.conformiteUrbanisme} onChange={(e) => setActeVenteData({...acteVenteData, conformiteUrbanisme: e.target.value})} placeholder="Permis, déclarations..." />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_assuranceDO">Assurance dommage-ouvrage</Label>
                      <Input id="acte_assuranceDO" value={acteVenteData.assuranceDommageOuvrage} onChange={(e) => setActeVenteData({...acteVenteData, assuranceDommageOuvrage: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_taxesFoncieres">Taxes foncières N-1 (€)</Label>
                      <Input id="acte_taxesFoncieres" type="number" value={acteVenteData.taxesFoncieres} onChange={(e) => setActeVenteData({...acteVenteData, taxesFoncieres: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_sinistre">Sinistre récent ?</Label>
                      <Select value={acteVenteData.sinistreRecent} onValueChange={(value) => setActeVenteData({...acteVenteData, sinistreRecent: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Urbanisme */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏛️ Urbanisme</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_zonePLU">Zone PLU / POS</Label>
                      <Input id="acte_zonePLU" value={acteVenteData.zonePLU} onChange={(e) => setActeVenteData({...acteVenteData, zonePLU: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_droitPreemption">Droit de préemption</Label>
                      <Input id="acte_droitPreemption" value={acteVenteData.droitPreemption} onChange={(e) => setActeVenteData({...acteVenteData, droitPreemption: e.target.value})} placeholder="Exercé / Levé + date" />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_declarationsUrbanisme">Déclarations d'urbanisme passées</Label>
                      <Textarea id="acte_declarationsUrbanisme" value={acteVenteData.declarationsUrbanisme} onChange={(e) => setActeVenteData({...acteVenteData, declarationsUrbanisme: e.target.value})} rows={2} placeholder="DP, permis de construire, etc." />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_documentsUrbanisme">Documents d'urbanisme fournis</Label>
                      <Input id="acte_documentsUrbanisme" value={acteVenteData.documentsUrbanisme} onChange={(e) => setActeVenteData({...acteVenteData, documentsUrbanisme: e.target.value})} />
                    </div>
                  </div>

                  {/* DIA - Déclaration d'Intention d'Aliéner */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-indigo-50 dark:bg-indigo-950 rounded-lg">
                    <div className="space-y-2">
                      <Label htmlFor="acte_dateEnvoiDIA">Date d'envoi de la DIA</Label>
                      <Input 
                        id="acte_dateEnvoiDIA"
                        type="date"
                        value={acteVenteData.dateEnvoiDIA}
                        onChange={(e) => setActeVenteData({...acteVenteData, dateEnvoiDIA: e.target.value})}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_reponseMairieDIA">Réponse de la mairie</Label>
                      <Select 
                        value={acteVenteData.reponseMairieDIA} 
                        onValueChange={(value) => setActeVenteData({...acteVenteData, reponseMairieDIA: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non_preemption">Non préemption</SelectItem>
                          <SelectItem value="preemption">Préemption</SelectItem>
                          <SelectItem value="en_attente">En attente</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Délais et signature */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">📅 Délais & modalités de signature</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_dateSignature">Date de signature de l'acte *</Label>
                      <Input id="acte_dateSignature" type="date" value={acteVenteData.dateSignatureActe} onChange={(e) => setActeVenteData({...acteVenteData, dateSignatureActe: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_lieuSignature">Lieu de signature *</Label>
                      <Input id="acte_lieuSignature" value={acteVenteData.lieuSignature} onChange={(e) => setActeVenteData({...acteVenteData, lieuSignature: e.target.value})} placeholder="Étude notariale" />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_remiseCles">Remise des clés</Label>
                      <Select value={acteVenteData.remiseCles} onValueChange={(value) => setActeVenteData({...acteVenteData, remiseCles: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="signature">À la signature</SelectItem>
                          <SelectItem value="differee">Différée</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_procuration">Procuration ?</Label>
                      <Select value={acteVenteData.procuration} onValueChange={(value) => setActeVenteData({...acteVenteData, procuration: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {acteVenteData.procuration === "oui" && (
                      <div className="space-y-2 md:col-span-2">
                        <Label htmlFor="acte_mandataire">Identité du mandataire</Label>
                        <Input id="acte_mandataire" value={acteVenteData.identiteMandataire} onChange={(e) => setActeVenteData({...acteVenteData, identiteMandataire: e.target.value})} />
                      </div>
                    )}
                  </div>

                  {/* Remise des clés anticipée */}
                  <div className="space-y-4 p-4 bg-teal-50 dark:bg-teal-950 rounded-lg">
                    <h4 className="font-medium">Remise des clés anticipée</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label htmlFor="acte_remiseClesAnticipee">Remise anticipée des clés</Label>
                        <Select 
                          value={acteVenteData.remiseClesAnticipee} 
                          onValueChange={(value) => setActeVenteData({...acteVenteData, remiseClesAnticipee: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {acteVenteData.remiseClesAnticipee === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label htmlFor="acte_dateRemiseAnticipee">Date de remise anticipée</Label>
                            <Input 
                              id="acte_dateRemiseAnticipee"
                              type="date"
                              value={acteVenteData.dateRemiseAnticipee}
                              onChange={(e) => setActeVenteData({...acteVenteData, dateRemiseAnticipee: e.target.value})}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label htmlFor="acte_indemnitéOccupation">Indemnité d'occupation</Label>
                            <Select 
                              value={acteVenteData.indemnitéOccupation} 
                              onValueChange={(value) => setActeVenteData({...acteVenteData, indemnitéOccupation: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="non">Non</SelectItem>
                                <SelectItem value="oui">Oui</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {acteVenteData.indemnitéOccupation === "oui" && (
                            <div className="space-y-2">
                              <Label htmlFor="acte_montantIndemnite">Montant de l'indemnité (€/jour)</Label>
                              <Input 
                                id="acte_montantIndemnite"
                                type="number"
                                value={acteVenteData.montantIndemnite}
                                onChange={(e) => setActeVenteData({...acteVenteData, montantIndemnite: e.target.value})}
                              />
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </div>
                </div>

                {/* Annexes */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🧩 Annexes à joindre</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_titrePropriete">Titre de propriété précédent</Label>
                      <Input id="acte_titrePropriete" value={acteVenteData.titrePropriete} onChange={(e) => setActeVenteData({...acteVenteData, titrePropriete: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_diagnosticsAnnexes">Diagnostics (fichiers)</Label>
                      <Input id="acte_diagnosticsAnnexes" value={acteVenteData.diagnostics} onChange={(e) => setActeVenteData({...acteVenteData, diagnostics: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_plan">Plan du bien</Label>
                      <Input id="acte_plan" value={acteVenteData.planBien} onChange={(e) => setActeVenteData({...acteVenteData, planBien: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_reglementCoproAnnexe">Copie règlement de copropriété</Label>
                      <Input id="acte_reglementCoproAnnexe" value={acteVenteData.reglementCopropriete} onChange={(e) => setActeVenteData({...acteVenteData, reglementCopropriete: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_etatDate">État daté</Label>
                      <Input id="acte_etatDate" value={acteVenteData.etatDate} onChange={(e) => setActeVenteData({...acteVenteData, etatDate: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_attestationAssurance">Attestation d'assurance (PNO)</Label>
                      <Input id="acte_attestationAssurance" value={acteVenteData.attestationAssurance} onChange={(e) => setActeVenteData({...acteVenteData, attestationAssurance: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label htmlFor="acte_releveSyndic">Relevé du syndic</Label>
                      <Input id="acte_releveSyndic" value={acteVenteData.releveSyndic} onChange={(e) => setActeVenteData({...acteVenteData, releveSyndic: e.target.value})} />
                    </div>
                  </div>
                </div>

                {/* Informations complémentaires */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🎯 Informations complémentaires</h3>
                  <div className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="acte_travauxPrevus">Travaux prévus par la copropriété</Label>
                      <Textarea id="acte_travauxPrevus" value={acteVenteData.travauxPrevusCopro} onChange={(e) => setActeVenteData({...acteVenteData, travauxPrevusCopro: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_procedures">Procédures en cours</Label>
                      <Textarea id="acte_procedures" value={acteVenteData.proceduresEnCours} onChange={(e) => setActeVenteData({...acteVenteData, proceduresEnCours: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_differends">Différends connus avec un voisin</Label>
                      <Textarea id="acte_differends" value={acteVenteData.differendsVoisins} onChange={(e) => setActeVenteData({...acteVenteData, differendsVoisins: e.target.value})} rows={2} />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="acte_particularites">Particularités du bien</Label>
                      <Textarea id="acte_particularites" value={acteVenteData.particularitesBien} onChange={(e) => setActeVenteData({...acteVenteData, particularitesBien: e.target.value})} rows={3} />
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire spécifique pour Bail d'habitation */}
            {(pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé") && (
              <>
                {/* Sélection du rôle du client */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">👤 Votre client</h3>
                  <div className="space-y-2">
                    <Label>Votre client est le *</Label>
                    <RadioGroup 
                      value={bailHabitationData.clientRole} 
                      onValueChange={(value) => {
                        setBailHabitationData({
                          ...bailHabitationData, 
                          clientRole: value,
                          clientId: "",
                          // Reset des champs de l'autre partie
                          ...(value === "bailleur" ? {
                            locataireClientId: "",
                            locataireNom: "",
                            locatairePrenom: "",
                            locataireAdresse: "",
                            locataireDateNaissance: "",
                            locataireLieuNaissance: "",
                            locataireNationalite: "",
                            locataireProfession: "",
                            locataireStatutMatrimonial: "",
                            nombreOccupants: "",
                          } : {
                            bailleurClientId: "",
                            bailleurNom: "",
                            bailleurPrenom: "",
                            bailleurAdresse: "",
                            bailleurDateNaissance: "",
                            bailleurLieuNaissance: "",
                            bailleurNationalite: "",
                            bailleurProfession: "",
                            bailleurStatutMatrimonial: "",
                          })
                        });
                      }}
                    >
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="bailleur" id="role_bailleur" />
                        <Label htmlFor="role_bailleur" className="cursor-pointer">Bailleur (propriétaire)</Label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <RadioGroupItem value="locataire" id="role_locataire" />
                        <Label htmlFor="role_locataire" className="cursor-pointer">Locataire</Label>
                      </div>
                    </RadioGroup>
                  </div>
                </div>

                {/* Bailleur */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">
                    {bailHabitationData.clientRole === "bailleur" ? "👤 Bailleur (votre client)" : "👤 Bailleur"}
                  </h3>
                  
                  {/* Sélection du client si bailleur */}
                  {bailHabitationData.clientRole === "bailleur" ? (
                    <div className="space-y-2">
                      <Label>Sélectionner le client bailleur *</Label>
                      <Select 
                        value={bailHabitationData.clientId} 
                        onValueChange={(value) => {
                          const selectedClient = clients.find(c => c.id === value);
                          if (selectedClient) {
                            setBailHabitationData({
                              ...bailHabitationData,
                              clientId: value,
                              bailleurClientId: value,
                              bailleurNom: selectedClient.nom,
                              bailleurPrenom: selectedClient.prenom,
                              bailleurAdresse: selectedClient.adresse || "",
                              bailleurDateNaissance: selectedClient.date_naissance || "",
                              bailleurLieuNaissance: selectedClient.lieu_naissance || "",
                              bailleurNationalite: selectedClient.nationalite || "",
                              bailleurProfession: selectedClient.profession || "",
                              bailleurStatutMatrimonial: selectedClient.statut_matrimonial || "",
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>{client.nom} {client.prenom}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  ) : (
                    <div className="text-sm text-muted-foreground mb-2">
                      Saisir manuellement les informations du bailleur
                    </div>
                  )}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom *</Label>
                      <Input value={bailHabitationData.bailleurNom} onChange={(e) => setBailHabitationData({...bailHabitationData, bailleurNom: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Prénom *</Label>
                      <Input value={bailHabitationData.bailleurPrenom} onChange={(e) => setBailHabitationData({...bailHabitationData, bailleurPrenom: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse *</Label>
                      <Input value={bailHabitationData.bailleurAdresse} onChange={(e) => setBailHabitationData({...bailHabitationData, bailleurAdresse: e.target.value})} />
                    </div>
                  </div>

                  {/* Pièce d'identité du bailleur - chargée depuis client si c'est le client */}
                  {bailHabitationData.clientRole === "bailleur" && bailHabitationData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {bailClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(bailClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="mr-2 h-4 w-4" />
                            Voir
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : bailHabitationData.clientRole === "locataire" && (
                    /* Upload pour bailleur si le client est locataire */
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité du bailleur</Label>
                      <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                        <input
                          type="file"
                          accept="application/pdf,image/*"
                          className="hidden"
                          id="bailleur-id-upload"
                          onChange={(e) => {
                            const files = Array.from(e.target.files || []);
                            if (files.length > 0) {
                              setBailleurIdFiles(prev => [...prev, ...files]);
                              toast.success(`${files.length} fichier(s) ajouté(s)`);
                            }
                            e.target.value = '';
                          }}
                        />
                        <label htmlFor="bailleur-id-upload" className="cursor-pointer flex items-center gap-3">
                          <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                            <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                          </div>
                          <div className="flex-1">
                            <p className="text-sm font-medium">Joindre la pièce d'identité</p>
                            <p className="text-xs text-muted-foreground">PDF, images acceptés</p>
                          </div>
                        </label>
                      </div>
                      {bailleurIdFiles.length > 0 && (
                        <div className="space-y-2 mt-2">
                          {bailleurIdFiles.map((file, index) => (
                            <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                              <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                              <span className="text-sm flex-1 truncate">{file.name}</span>
                              <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                className="h-6 w-6 p-0 hover:bg-transparent"
                                onClick={() => setBailleurIdFiles(prev => prev.filter((_, i) => i !== index))}
                              >
                                <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                              </Button>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}
                </div>

                {/* Locataire */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">
                    {bailHabitationData.clientRole === "locataire" ? "👥 Locataire (votre client)" : "👥 Locataire"}
                  </h3>
                  
                  {/* Sélection du client si locataire */}
                  {bailHabitationData.clientRole === "locataire" ? (
                    <div className="space-y-2">
                      <Label>Sélectionner le client locataire *</Label>
                      <Select 
                        value={bailHabitationData.clientId} 
                        onValueChange={(value) => {
                          const selectedClient = clients.find(c => c.id === value);
                          if (selectedClient) {
                            setBailHabitationData({
                              ...bailHabitationData,
                              clientId: value,
                              locataireClientId: value,
                              locataireNom: selectedClient.nom,
                              locatairePrenom: selectedClient.prenom,
                              locataireAdresse: selectedClient.adresse || "",
                              locataireDateNaissance: selectedClient.date_naissance || "",
                              locataireLieuNaissance: selectedClient.lieu_naissance || "",
                              locataireNationalite: selectedClient.nationalite || "",
                              locataireProfession: selectedClient.profession || "",
                              locataireStatutMatrimonial: selectedClient.statut_matrimonial || "",
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>{client.nom} {client.prenom}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>
                  ) : (
                    <div className="text-sm text-muted-foreground mb-2">
                      Saisir manuellement les informations du locataire
                    </div>
                  )}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nom *</Label>
                      <Input value={bailHabitationData.locataireNom} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireNom: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Prénom *</Label>
                      <Input value={bailHabitationData.locatairePrenom} onChange={(e) => setBailHabitationData({...bailHabitationData, locatairePrenom: e.target.value})} />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse actuelle *</Label>
                      <Input value={bailHabitationData.locataireAdresse} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireAdresse: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Date de naissance *</Label>
                      <Input type="date" value={bailHabitationData.locataireDateNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireDateNaissance: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Lieu de naissance *</Label>
                      <Input value={bailHabitationData.locataireLieuNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireLieuNaissance: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Profession *</Label>
                      <Input value={bailHabitationData.locataireProfession} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireProfession: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Statut matrimonial *</Label>
                      <Input value={bailHabitationData.locataireStatutMatrimonial} onChange={(e) => setBailHabitationData({...bailHabitationData, locataireStatutMatrimonial: e.target.value})} placeholder="Ex: Célibataire, Marié..." />
                    </div>
                    <div className="space-y-2">
                      <Label>Nombre d'occupants *</Label>
                      <Input type="number" value={bailHabitationData.nombreOccupants} onChange={(e) => setBailHabitationData({...bailHabitationData, nombreOccupants: e.target.value})} />
                    </div>
                  </div>

                  {/* Pièce d'identité du locataire - chargée depuis client si c'est le client */}
                  {bailHabitationData.clientRole === "locataire" && bailHabitationData.clientId ? (
                    <div className="space-y-2">
                      <Label>📎 Pièce d'identité</Label>
                      {bailClientIdentiteUrl ? (
                        <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                          <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                          </svg>
                          <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            className="bg-green-600 hover:bg-green-700 text-white"
                            onClick={() => window.open(bailClientIdentiteUrl, '_blank')}
                          >
                            <Eye className="mr-2 h-4 w-4" />
                            Voir
                          </Button>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                          <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                          </svg>
                          <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                        </div>
                      )}
                    </div>
                  ) : bailHabitationData.clientRole === "bailleur" && (
                    /* Upload section pour documents locataire si le client est bailleur */
                    <div className="space-y-2">
                      <Label>📎 Documents du locataire (pièce d'identité, justificatifs de revenus)</Label>
                      <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                        <input
                          type="file"
                          accept="application/pdf,image/*"
                          multiple
                          className="hidden"
                          id="locataire-id-upload-alt"
                          onChange={(e) => {
                            const files = Array.from(e.target.files || []);
                            if (files.length > 0) {
                              setLocataireIdFiles(prev => [...prev, ...files]);
                              toast.success(`${files.length} fichier(s) ajouté(s)`);
                            }
                            e.target.value = '';
                          }}
                        />
                        <label htmlFor="locataire-id-upload-alt" className="cursor-pointer flex items-center gap-3">
                          <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                            <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                          </div>
                          <div className="flex-1">
                            <p className="text-sm font-medium">Joindre les documents</p>
                            <p className="text-xs text-muted-foreground">PDF, images acceptés</p>
                          </div>
                        </label>
                      </div>
                      {locataireIdFiles.length > 0 && (
                        <div className="space-y-2 mt-2">
                          {locataireIdFiles.map((file, index) => (
                            <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                              <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                              <span className="text-sm flex-1 truncate">{file.name}</span>
                              <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                              <Button
                                type="button"
                                variant="ghost"
                                size="sm"
                                className="h-6 w-6 p-0 hover:bg-transparent"
                                onClick={() => setLocataireIdFiles(prev => prev.filter((_, i) => i !== index))}
                              >
                                <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                </svg>
                              </Button>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>
                  )}

                  {/* Situation financière du locataire */}
                  <div className="p-4 bg-blue-50 dark:bg-blue-950 rounded-lg space-y-4">
                    <h4 className="font-medium">Situation financière du locataire</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Revenus mensuels nets (€)</Label>
                        <Input 
                          type="number"
                          value={bailHabitationData.locataireRevenusMensuelsNets} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireRevenusMensuelsNets: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Type de contrat de travail</Label>
                        <Select 
                          value={bailHabitationData.locataireTypeContrat} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, locataireTypeContrat: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="CDI">CDI</SelectItem>
                            <SelectItem value="CDD">CDD</SelectItem>
                            <SelectItem value="Intérim">Intérim</SelectItem>
                            <SelectItem value="Étudiant">Étudiant</SelectItem>
                            <SelectItem value="Indépendant">Indépendant</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Employeur actuel</Label>
                        <Input 
                          value={bailHabitationData.locataireEmployeur} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireEmployeur: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Adresse de l'employeur</Label>
                        <Input 
                          value={bailHabitationData.locataireEmployeurAdresse} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireEmployeurAdresse: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Ancienneté dans l'emploi</Label>
                        <Input 
                          value={bailHabitationData.locataireAncienneteEmployeur} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, locataireAncienneteEmployeur: e.target.value})} 
                          placeholder="Ex: 2 ans"
                        />
                      </div>
                    </div>
                  </div>

                  {/* Colocation */}
                  <div className="space-y-4 p-4 bg-purple-50 dark:bg-purple-950 rounded-lg">
                    <h4 className="font-medium">Colocation</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>S'agit-il d'une colocation ?</Label>
                        <Select 
                          value={bailHabitationData.colocation} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, colocation: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Non">Non</SelectItem>
                            <SelectItem value="Oui">Oui</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {bailHabitationData.colocation === "Oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Solidarité entre colocataires ?</Label>
                            <Select 
                              value={bailHabitationData.solidariteColocataires} 
                              onValueChange={(value) => setBailHabitationData({...bailHabitationData, solidariteColocataires: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="Oui">Oui (solidaires)</SelectItem>
                                <SelectItem value="Non">Non (séparés)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2">
                            <Label>Nombre de colocataires</Label>
                            <Input 
                              type="number"
                              value={bailHabitationData.nombreColocataires} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, nombreColocataires: e.target.value})} 
                            />
                          </div>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Noms et prénoms des colocataires</Label>
                            <Textarea 
                              value={bailHabitationData.colocatairesNoms} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, colocatairesNoms: e.target.value})} 
                              placeholder="Ex: Jean Dupont, Marie Martin..."
                              rows={2}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                  
                  <div className="space-y-2">
                    <Label>📎 Documents du locataire (pièce d'identité, justificatifs de revenus)</Label>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                      <input
                        type="file"
                        accept="application/pdf,image/*"
                        multiple
                        className="hidden"
                        id="locataire-docs-upload"
                        onChange={(e) => {
                          const files = Array.from(e.target.files || []);
                          if (files.length > 0) {
                            setLocataireDocsFiles(prev => [...prev, ...files]);
                            toast.success(`${files.length} fichier(s) ajouté(s)`);
                          }
                          e.target.value = '';
                        }}
                      />
                      <label htmlFor="locataire-docs-upload" className="cursor-pointer flex items-center gap-3">
                        <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                          <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                          </svg>
                        </div>
                        <div className="flex-1">
                          <p className="text-sm font-medium">Joindre les documents</p>
                          <p className="text-xs text-muted-foreground">PDF, images acceptés</p>
                        </div>
                      </label>
                    </div>
                    {locataireDocsFiles.length > 0 && (
                      <div className="space-y-2 mt-2">
                        {locataireDocsFiles.map((file, index) => (
                          <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                            <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span className="text-sm flex-1 truncate">{file.name}</span>
                            <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="h-6 w-6 p-0 hover:bg-transparent"
                              onClick={() => setLocataireDocsFiles(prev => prev.filter((_, i) => i !== index))}
                            >
                              <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                              </svg>
                            </Button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                {/* Logement */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🏠 Logement</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2 md:col-span-2">
                      <Label>Adresse complète du logement *</Label>
                      <Input value={bailHabitationData.adresseLogement} onChange={(e) => setBailHabitationData({...bailHabitationData, adresseLogement: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Type de logement *</Label>
                      <Input value={bailHabitationData.typeLogement} onChange={(e) => setBailHabitationData({...bailHabitationData, typeLogement: e.target.value})} placeholder="Ex: T2, Studio, Maison..." />
                    </div>
                    <div className="space-y-2">
                      <Label>Étage / N° appartement</Label>
                      <Input value={bailHabitationData.etageNumeroLot} onChange={(e) => setBailHabitationData({...bailHabitationData, etageNumeroLot: e.target.value})} placeholder="Ex: 3ème étage, Appt 12..." />
                    </div>
                    <div className="space-y-2">
                      <Label>Surface habitable (m²) *</Label>
                      <Input type="number" value={bailHabitationData.surfaceHabitable} onChange={(e) => setBailHabitationData({...bailHabitationData, surfaceHabitable: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Logement en copropriété ? *</Label>
                      <Select value={bailHabitationData.logementCopropriete} onValueChange={(value) => setBailHabitationData({...bailHabitationData, logementCopropriete: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.logementCopropriete === "oui" && (
                      <div className="space-y-2">
                        <Label>Règlement de copropriété fourni ?</Label>
                        <Select value={bailHabitationData.reglementCoproFourni} onValueChange={(value) => setBailHabitationData({...bailHabitationData, reglementCoproFourni: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    )}
                    <div className="space-y-2 md:col-span-2">
                      <Label>Dépendances incluses *</Label>
                      <div className="flex flex-wrap gap-3">
                        {["Cave", "Parking", "Grenier", "Jardin"].map((dep) => (
                          <label key={dep} className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              checked={bailHabitationData.dependances.includes(dep)}
                              onChange={(e) => {
                                if (e.target.checked) {
                                  setBailHabitationData({...bailHabitationData, dependances: [...bailHabitationData.dependances, dep]});
                                } else {
                                  setBailHabitationData({...bailHabitationData, dependances: bailHabitationData.dependances.filter(d => d !== dep)});
                                }
                              }}
                              className="rounded border-gray-300"
                            />
                            <span className="text-sm">{dep}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                  </div>

                  {/* Détails parking */}
                  {bailHabitationData.dependances.includes("Parking") && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-slate-50 dark:bg-slate-900 rounded-lg">
                      <div className="space-y-2">
                        <Label>Place de parking numérotée ?</Label>
                        <Select 
                          value={bailHabitationData.placeParking} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, placeParking: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Oui">Oui</SelectItem>
                            <SelectItem value="Non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {bailHabitationData.placeParking === "Oui" && (
                        <div className="space-y-2">
                          <Label>Numéro de la place</Label>
                          <Input 
                            value={bailHabitationData.numeroPlaceParking} 
                            onChange={(e) => setBailHabitationData({...bailHabitationData, numeroPlaceParking: e.target.value})} 
                            placeholder="Ex: P12"
                          />
                        </div>
                      )}
                    </div>
                  )}

                  {/* Entretien jardin */}
                  {bailHabitationData.dependances.includes("Jardin") && (
                    <div className="space-y-2 p-4 bg-green-50 dark:bg-green-950 rounded-lg">
                      <Label>Entretien du jardin à la charge de</Label>
                      <Select 
                        value={bailHabitationData.entretienJardin} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, entretienJardin: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Locataire">Locataire</SelectItem>
                          <SelectItem value="Bailleur">Bailleur</SelectItem>
                          <SelectItem value="Partagé">Partagé</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                </div>

                {/* Spécificités du bail meublé */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🛋️ Spécificités du bail meublé</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {/* Type et durée du bail meublé */}
                    <div className="space-y-2">
                      <Label>Type de durée du bail meublé</Label>
                      <Select 
                        value={bailHabitationData.typeDureeMeuble} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeDureeMeuble: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="1an">1 an renouvelable (cas général)</SelectItem>
                          <SelectItem value="9mois">9 mois étudiant (non renouvelable)</SelectItem>
                          <SelectItem value="mobilite">Bail mobilité (1 à 10 mois)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {bailHabitationData.typeDureeMeuble === "mobilite" && (
                          <div className="space-y-2">
                            <Label>Motif du bail mobilité</Label>
                            <Input 
                              value={bailHabitationData.motifBailMobilite} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, motifBailMobilite: e.target.value})} 
                              placeholder="Ex: Stage, études, mission professionnelle..."
                            />
                          </div>
                        )}

                        {/* Inventaire du mobilier */}
                        <div className="md:col-span-2 p-4 bg-orange-50 dark:bg-orange-950 rounded-lg space-y-3">
                          <h4 className="font-medium text-orange-800 dark:text-orange-200">📋 Inventaire complet du mobilier (OBLIGATOIRE LÉGALEMENT)</h4>
                          <div className="space-y-2">
                            <Label>Description détaillée pièce par pièce *</Label>
                            <Textarea 
                              value={bailHabitationData.inventaireMobilierTexte} 
                              onChange={(e) => setBailHabitationData({...bailHabitationData, inventaireMobilierTexte: e.target.value})} 
                              placeholder="Ex: Salon: canapé 3 places en tissu gris, table basse en bois, 2 lampes...\nChambre: lit 140x190, matelas, couette, 2 oreillers, armoire 3 portes..."
                              rows={5}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Fichier inventaire (PDF ou images)</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf,image/*"
                                multiple
                                className="hidden"
                                id="inventaire-mobilier-upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  if (files.length > 0) {
                                    setInventaireMobilierFiles(prev => [...prev, ...files]);
                                    toast.success(`${files.length} fichier(s) ajouté(s)`);
                                  }
                                  e.target.value = '';
                                }}
                              />
                              <label htmlFor="inventaire-mobilier-upload" className="cursor-pointer flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                  <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                </div>
                                <div className="flex-1">
                                  <p className="text-sm font-medium">Joindre l'inventaire</p>
                                  <p className="text-xs text-muted-foreground">PDF ou images acceptés</p>
                                </div>
                              </label>
                            </div>
                            {inventaireMobilierFiles.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {inventaireMobilierFiles.map((file, index) => (
                                  <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="h-6 w-6 p-0 hover:bg-transparent"
                                      onClick={() => setInventaireMobilierFiles(prev => prev.filter((_, i) => i !== index))}
                                    >
                                      <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                      </svg>
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Liste légale du mobilier minimal (décret 2015-981) */}
                        <div className="md:col-span-2 p-4 bg-blue-50 dark:bg-blue-950 rounded-lg space-y-3">
                          <h4 className="font-medium">✅ Mobilier minimal obligatoire (décret n°2015-981)</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                            {[
                              { key: 'mobilierLiterie', label: 'Literie + couette ou couverture' },
                              { key: 'mobilierOccultation', label: 'Dispositif d\'occultation des fenêtres' },
                              { key: 'mobilierPlaquesCuisson', label: 'Plaques de cuisson' },
                              { key: 'mobilierFourMicroondes', label: 'Four ou micro-ondes' },
                              { key: 'mobilierRefrigo', label: 'Réfrigérateur' },
                              { key: 'mobilierCongelateur', label: 'Congélateur ou compartiment freezer' },
                              { key: 'mobilierVaisselle', label: 'Vaisselle en quantité suffisante' },
                              { key: 'mobilierUstensiles', label: 'Ustensiles de cuisine' },
                              { key: 'mobilierTable', label: 'Table' },
                              { key: 'mobilierSieges', label: 'Sièges' },
                              { key: 'mobilierEtageres', label: 'Étagères de rangement' },
                              { key: 'mobilierLampes', label: 'Lampes' },
                              { key: 'mobilierMaterielEntretien', label: 'Matériel d\'entretien' },
                            ].map((item) => (
                              <div key={item.key} className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id={item.key}
                                  checked={bailHabitationData[item.key as keyof typeof bailHabitationData] as boolean}
                                  onChange={(e) => setBailHabitationData({...bailHabitationData, [item.key]: e.target.checked})}
                                  className="w-4 h-4"
                                />
                                <Label htmlFor={item.key} className="cursor-pointer text-sm">{item.label}</Label>
                              </div>
                            ))}
                          </div>
                        </div>

                        {/* État du mobilier */}
                        <div className="space-y-2 md:col-span-2">
                          <Label>État du mobilier lors de l'entrée</Label>
                          <Textarea 
                            value={bailHabitationData.etatMobilierEntree} 
                            onChange={(e) => setBailHabitationData({...bailHabitationData, etatMobilierEntree: e.target.value})} 
                            placeholder="Description de l'état du mobilier pièce par pièce..."
                            rows={3}
                          />
                        </div>

                        {/* Entretien du mobilier */}
                        <div className="space-y-2">
                          <Label>Entretien du mobilier à la charge de</Label>
                          <Select 
                            value={bailHabitationData.entretienMobilier} 
                            onValueChange={(value) => setBailHabitationData({...bailHabitationData, entretienMobilier: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="Locataire">Locataire</SelectItem>
                              <SelectItem value="Bailleur">Bailleur</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                  </div>
                </div>

                {/* Animaux */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🐾 Animaux domestiques</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Animaux domestiques autorisés ?</Label>
                      <Select 
                        value={bailHabitationData.animauxAutorises} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, animauxAutorises: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Oui">Oui</SelectItem>
                          <SelectItem value="Non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.animauxAutorises === "Oui" && (
                      <div className="space-y-2">
                        <Label>Précisions</Label>
                        <Input 
                          value={bailHabitationData.precisionAnimaux} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, precisionAnimaux: e.target.value})} 
                          placeholder="Ex: petits chiens, chats..."
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* Nature du bailleur et durée */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">⚖️ Nature du bailleur et durée du bail</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nature du bailleur *</Label>
                      <Select value={bailHabitationData.natureBailleur} onValueChange={(value) => setBailHabitationData({...bailHabitationData, natureBailleur: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="physique">Personne physique (3 ans pour bail vide)</SelectItem>
                          <SelectItem value="morale">Personne morale (6 ans pour bail vide)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Résidence principale du locataire ? *</Label>
                      <Select value={bailHabitationData.residencePrincipale} onValueChange={(value) => setBailHabitationData({...bailHabitationData, residencePrincipale: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Garant */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">👥 Garant (si applicable)</h3>
                  <div className="space-y-2">
                    <Label>A-t-il un garant ?</Label>
                    <Select value={bailHabitationData.aGarant} onValueChange={(value) => setBailHabitationData({...bailHabitationData, aGarant: value})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui</SelectItem>
                        <SelectItem value="non">Non</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  {bailHabitationData.aGarant === "oui" && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg">
                      <div className="space-y-2">
                        <Label>Nom du garant *</Label>
                        <Input value={bailHabitationData.garantNom} onChange={(e) => setBailHabitationData({...bailHabitationData, garantNom: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Prénom *</Label>
                        <Input value={bailHabitationData.garantPrenom} onChange={(e) => setBailHabitationData({...bailHabitationData, garantPrenom: e.target.value})} />
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse *</Label>
                        <Input value={bailHabitationData.garantAdresse} onChange={(e) => setBailHabitationData({...bailHabitationData, garantAdresse: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de naissance *</Label>
                        <Input type="date" value={bailHabitationData.garantDateNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, garantDateNaissance: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Lieu de naissance *</Label>
                        <Input value={bailHabitationData.garantLieuNaissance} onChange={(e) => setBailHabitationData({...bailHabitationData, garantLieuNaissance: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Profession *</Label>
                        <Input value={bailHabitationData.garantProfession} onChange={(e) => setBailHabitationData({...bailHabitationData, garantProfession: e.target.value})} />
                      </div>
                      <div className="space-y-2">
                        <Label>Type de caution *</Label>
                        <Select value={bailHabitationData.typeCaution} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeCaution: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="simple">Caution simple</SelectItem>
                            <SelectItem value="solidaire">Caution solidaire</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2 md:col-span-2">
                        <Label>📎 Documents du garant (pièce d'identité, justificatifs de revenus)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                          <input
                            type="file"
                            accept="application/pdf,image/*"
                            multiple
                            className="hidden"
                            id="garant-docs-upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              if (files.length > 0) {
                                setGarantDocsFiles(prev => [...prev, ...files]);
                                toast.success(`${files.length} fichier(s) ajouté(s)`);
                              }
                              e.target.value = '';
                            }}
                          />
                          <label htmlFor="garant-docs-upload" className="cursor-pointer flex items-center gap-3">
                            <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                              <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                            </div>
                            <div className="flex-1">
                              <p className="text-sm font-medium">Joindre les documents du garant</p>
                              <p className="text-xs text-muted-foreground">PDF, images acceptés</p>
                            </div>
                          </label>
                        </div>
                        {garantDocsFiles.length > 0 && (
                          <div className="space-y-2 mt-2">
                            {garantDocsFiles.map((file, index) => (
                              <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <span className="text-sm flex-1 truncate">{file.name}</span>
                                <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                                <Button
                                  type="button"
                                  variant="ghost"
                                  size="sm"
                                  className="h-6 w-6 p-0 hover:bg-transparent"
                                  onClick={() => setGarantDocsFiles(prev => prev.filter((_, i) => i !== index))}
                                >
                                  <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                  </svg>
                                </Button>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>

                {/* Conditions financières */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">💶 Conditions financières</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Loyer mensuel (€) *</Label>
                      <Input type="number" value={bailHabitationData.loyerMensuel} onChange={(e) => setBailHabitationData({...bailHabitationData, loyerMensuel: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Charges mensuelles (€)</Label>
                      <Input type="number" value={bailHabitationData.chargesMensuelles} onChange={(e) => setBailHabitationData({...bailHabitationData, chargesMensuelles: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Type de charges *</Label>
                      <Select value={bailHabitationData.typeCharges} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeCharges: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="provision">Provision + régularisation annuelle</SelectItem>
                          <SelectItem value="forfait">Forfait</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Dépôt de garantie (€) *</Label>
                      <Input type="number" value={bailHabitationData.depotGarantie} onChange={(e) => setBailHabitationData({...bailHabitationData, depotGarantie: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Révision du loyer prévue ? *</Label>
                      <Select value={bailHabitationData.revisionLoyerPrevue} onValueChange={(value) => setBailHabitationData({...bailHabitationData, revisionLoyerPrevue: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.revisionLoyerPrevue === "oui" && (
                      <div className="space-y-2">
                        <Label>Trimestre de référence IRL *</Label>
                        <Input value={bailHabitationData.trimestreReference} onChange={(e) => setBailHabitationData({...bailHabitationData, trimestreReference: e.target.value})} placeholder="Ex: 2e trimestre 2025" />
                      </div>
                    )}
                    <div className="space-y-2">
                      <Label>Type de bail</Label>
                      <Select value={bailHabitationData.typeBail} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeBail: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="vide">Location vide</SelectItem>
                          <SelectItem value="meuble">Location meublée</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  {/* Mode de paiement */}
                  <div className="p-4 bg-emerald-50 dark:bg-emerald-950 rounded-lg space-y-4">
                    <h4 className="font-medium">Mode de paiement du loyer</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Mode de paiement choisi</Label>
                        <Select 
                          value={bailHabitationData.modePaiement} 
                          onValueChange={(value) => setBailHabitationData({...bailHabitationData, modePaiement: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="Virement">Virement</SelectItem>
                            <SelectItem value="Prélèvement automatique">Prélèvement automatique</SelectItem>
                            <SelectItem value="Chèque">Chèque</SelectItem>
                            <SelectItem value="Autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>IBAN du bailleur</Label>
                        <Input 
                          value={bailHabitationData.ibanBailleur} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, ibanBailleur: e.target.value})} 
                          placeholder="FR76..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* Régularisation des charges */}
                  {bailHabitationData.typeCharges === "provision" && (
                    <div className="space-y-2 p-4 bg-amber-50 dark:bg-amber-950 rounded-lg">
                      <Label>Périodicité de régularisation des charges</Label>
                      <Select 
                        value={bailHabitationData.periodiciteRegularisationCharges} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, periodiciteRegularisationCharges: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Annuelle">Annuelle</SelectItem>
                          <SelectItem value="Semestrielle">Semestrielle</SelectItem>
                          <SelectItem value="Autre">Autre</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  )}
                </div>

                {/* Dates */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">📅 Dates du bail</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Date de début du bail *</Label>
                      <Input type="date" value={bailHabitationData.dateDebutBail} onChange={(e) => setBailHabitationData({...bailHabitationData, dateDebutBail: e.target.value})} />
                    </div>
                    <div className="space-y-2">
                      <Label>Durée du bail</Label>
                      <Select value={bailHabitationData.typeBailDuree} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeBailDuree: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="3ans">3 ans (vide)</SelectItem>
                          <SelectItem value="6ans">6 ans (vide - personne morale)</SelectItem>
                          <SelectItem value="1an">1 an (meublé)</SelectItem>
                          <SelectItem value="9mois">9 mois (étudiant)</SelectItem>
                          <SelectItem value="mobilite">Bail mobilité (1 à 10 mois)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Caractéristiques techniques ALUR */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🔌 Caractéristiques techniques (obligatoires ALUR)</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Type de chauffage *</Label>
                      <Select value={bailHabitationData.typeChauffage} onValueChange={(value) => setBailHabitationData({...bailHabitationData, typeChauffage: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="electrique">Électrique</SelectItem>
                          <SelectItem value="gaz">Gaz</SelectItem>
                          <SelectItem value="fioul">Fioul</SelectItem>
                          <SelectItem value="collectif">Collectif</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Compteurs individuels ? *</Label>
                      <Select value={bailHabitationData.compteursIndividuels} onValueChange={(value) => setBailHabitationData({...bailHabitationData, compteursIndividuels: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Relevé des compteurs à l'entrée</Label>
                      <Input value={bailHabitationData.releveCompteurs} onChange={(e) => setBailHabitationData({...bailHabitationData, releveCompteurs: e.target.value})} placeholder="Électricité: XX kWh, Eau: XX m3..." />
                    </div>
                  </div>
                </div>

                {/* Travaux récents */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🔨 Travaux effectués</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Travaux réalisés dans les 6 derniers mois ?</Label>
                      <Select 
                        value={bailHabitationData.travauxDerniers6Mois} 
                        onValueChange={(value) => setBailHabitationData({...bailHabitationData, travauxDerniers6Mois: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="Non">Non</SelectItem>
                          <SelectItem value="Oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                    {bailHabitationData.travauxDerniers6Mois === "Oui" && (
                      <div className="space-y-2 md:col-span-2">
                        <Label>Description des travaux</Label>
                        <Textarea 
                          value={bailHabitationData.descriptionTravaux} 
                          onChange={(e) => setBailHabitationData({...bailHabitationData, descriptionTravaux: e.target.value})} 
                          placeholder="Ex: Peinture, rénovation salle de bain, électricité..."
                          rows={3}
                        />
                      </div>
                    )}
                  </div>
                </div>

                {/* Diagnostics obligatoires */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">📁 Diagnostics obligatoires</h3>
                  <div className="space-y-2">
                    <Label>Diagnostics fournis ? *</Label>
                    <Select value={bailHabitationData.diagnosticsFournis} onValueChange={(value) => setBailHabitationData({...bailHabitationData, diagnosticsFournis: value})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui - Tous les diagnostics obligatoires sont fournis</SelectItem>
                        <SelectItem value="non">Non - Diagnostics manquants</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="text-sm text-muted-foreground p-3 bg-muted/30 rounded-lg">
                    <p className="font-medium mb-2">Diagnostics obligatoires pour un bail vide :</p>
                    <ul className="list-disc list-inside space-y-1">
                      <li>DPE (Diagnostic de Performance Énergétique)</li>
                      <li>État de l'installation électrique (si + de 15 ans)</li>
                      <li>État de l'installation gaz (si + de 15 ans)</li>
                      <li>ERP (État des Risques et Pollutions)</li>
                      <li>CREP - Plomb (si immeuble avant 1949)</li>
                      <li>Amiante (information obligatoire)</li>
                    </ul>
                  </div>
                  <div className="space-y-2">
                    <Label>📎 Joindre les diagnostics (PDF)</Label>
                    <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 hover:border-muted-foreground/50 transition-colors">
                      <input
                        type="file"
                        accept="application/pdf"
                        multiple
                        className="hidden"
                        id="diagnostics-upload"
                        onChange={(e) => {
                          const files = Array.from(e.target.files || []);
                          if (files.length > 0) {
                            setBailDiagnosticsFiles(prev => [...prev, ...files]);
                            toast.success(`${files.length} fichier(s) ajouté(s)`);
                          }
                          e.target.value = '';
                        }}
                      />
                      <label htmlFor="diagnostics-upload" className="cursor-pointer flex flex-col items-center gap-2">
                        <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                          <svg className="w-6 h-6 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                          </svg>
                        </div>
                        <div className="text-center">
                          <p className="text-sm font-medium">Cliquez pour parcourir</p>
                          <p className="text-xs text-muted-foreground">Depuis votre ordinateur ou espace Documents</p>
                        </div>
                      </label>
                    </div>
                    {bailDiagnosticsFiles.length > 0 && (
                      <div className="space-y-2 mt-2">
                        {bailDiagnosticsFiles.map((file, index) => (
                          <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                            <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span className="text-sm flex-1 truncate">{file.name}</span>
                            <span className="text-xs text-muted-foreground">{(file.size / 1024).toFixed(1)} KB</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="h-6 w-6 p-0 hover:bg-transparent"
                              onClick={() => setBailDiagnosticsFiles(prev => prev.filter((_, i) => i !== index))}
                            >
                              <svg className="w-4 h-4 text-muted-foreground hover:text-destructive" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                              </svg>
                            </Button>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                {/* État des lieux */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🛠️ État des lieux</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>État des lieux d'entrée fourni ? *</Label>
                      <Select value={bailHabitationData.etatLieuxFourni} onValueChange={(value) => setBailHabitationData({...bailHabitationData, etatLieuxFourni: value})}>
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui</SelectItem>
                          <SelectItem value="non">Non - À établir lors de la remise des clés</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>
                </div>

                {/* Assurance */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🛡️ Assurance habitation</h3>
                  <div className="space-y-2">
                    <Label>Attestation d'assurance fournie par le locataire ? *</Label>
                    <Select value={bailHabitationData.attestationAssurance} onValueChange={(value) => setBailHabitationData({...bailHabitationData, attestationAssurance: value})}>
                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                      <SelectContent>
                        <SelectItem value="oui">Oui - Attestation fournie</SelectItem>
                        <SelectItem value="non">Non - À fournir avant la remise des clés</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>
                  <p className="text-sm text-muted-foreground">L'assurance habitation est obligatoire pour le locataire avant l'entrée dans les lieux.</p>
                </div>

                {/* Remise des clés */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🔑 Remise des clés et accès</h3>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <Label>Nombre de jeux de clés remis</Label>
                      <Input 
                        type="number"
                        value={bailHabitationData.nombreJeuxCles} 
                        onChange={(e) => setBailHabitationData({...bailHabitationData, nombreJeuxCles: e.target.value})} 
                        placeholder="Ex: 2"
                      />
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Types de clés</Label>
                      <div className="flex flex-wrap gap-3">
                        {[
                          { value: "portes", label: "Portes" },
                          { value: "boites_aux_lettres", label: "Boîtes aux lettres" },
                          { value: "garage", label: "Garage" },
                          { value: "badges", label: "Badges" },
                          { value: "telecommande", label: "Télécommande portail" }
                        ].map((type) => (
                          <label key={type.value} className="flex items-center gap-2">
                            <input
                              type="checkbox"
                              checked={bailHabitationData.typesCles.includes(type.value)}
                              onChange={(e) => {
                                if (e.target.checked) {
                                  setBailHabitationData({
                                    ...bailHabitationData, 
                                    typesCles: [...bailHabitationData.typesCles, type.value]
                                  });
                                } else {
                                  setBailHabitationData({
                                    ...bailHabitationData, 
                                    typesCles: bailHabitationData.typesCles.filter(t => t !== type.value)
                                  });
                                }
                              }}
                              className="rounded border-gray-300"
                            />
                            <span className="text-sm">{type.label}</span>
                          </label>
                        ))}
                      </div>
                    </div>
                    <div className="space-y-2 md:col-span-2">
                      <Label>Codes fournis (optionnel)</Label>
                      <Textarea 
                        value={bailHabitationData.codesFournis} 
                        onChange={(e) => setBailHabitationData({...bailHabitationData, codesFournis: e.target.value})} 
                        rows={2}
                        placeholder="Ex: WIFI, interphone, digicode d'entrée..."
                      />
                    </div>
                  </div>
                </div>

                {/* Informations complémentaires */}
                <div className="space-y-4">
                  <h3 className="font-semibold text-lg border-b pb-2">🎯 Informations complémentaires</h3>
                  <div className="space-y-2">
                    <Label>Précisions, particularités...</Label>
                    <Textarea 
                      value={bailHabitationData.informationsComplementaires} 
                      onChange={(e) => setBailHabitationData({...bailHabitationData, informationsComplementaires: e.target.value})} 
                      rows={4}
                      placeholder="Garant, travaux récents, diagnostics fournis, assurance, etc."
                    />
                  </div>
                </div>
              </>
            )}

            {/* Formulaire spécifique pour Bail commercial */}
            {pendingContractType === "Bail commercial / professionnel" && (
              <>
                <div className="space-y-6">
                  {/* Sélection du type de bail */}
                  <div className="space-y-4 bg-muted/50 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg">📋 Type de bail *</h3>
                    <div className="space-y-2">
                      <RadioGroup 
                        value={bailCommercialData.typeBail} 
                        onValueChange={(value) => setBailCommercialData({...bailCommercialData, typeBail: value})}
                      >
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="commercial" id="bail_type_commercial" />
                          <Label htmlFor="bail_type_commercial" className="cursor-pointer">
                            <span className="font-medium">Bail commercial</span>
                            <span className="text-xs text-muted-foreground ml-2">(statut 3/6/9 - activité commerciale)</span>
                          </Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="professionnel" id="bail_type_professionnel" />
                          <Label htmlFor="bail_type_professionnel" className="cursor-pointer">
                            <span className="font-medium">Bail professionnel</span>
                            <span className="text-xs text-muted-foreground ml-2">(profession libérale - min. 6 ans)</span>
                          </Label>
                        </div>
                      </RadioGroup>
                    </div>
                  </div>

                  {/* Sélection du rôle du client */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👤 Votre client</h3>
                    <div className="space-y-2">
                      <Label>Votre client est le *</Label>
                          <RadioGroup 
                            value={bailCommercialData.clientRole} 
                            onValueChange={(value) => {
                              setBailCommercialData({
                                ...bailCommercialData, 
                                clientRole: value,
                                clientId: "",
                                // Reset des champs de l'autre partie
                                ...(value === "bailleur" ? {
                                  locataireClientId: "",
                                  statutLocataire: "",
                                  locataireNom: "",
                                  locatairePrenom: "",
                                  locataireAdresse: "",
                                  locataireImmatriculation: "",
                                  locataireDenomination: "",
                                  locataireFormeJuridique: "",
                                  locataireSiege: "",
                                  locataireSiren: "",
                                  locataireSiret: "",
                                } : {
                                  bailleurClientId: "",
                                  statutBailleur: "",
                                  bailleurNom: "",
                                  bailleurPrenom: "",
                                  bailleurDenomination: "",
                                  bailleurFormeJuridique: "",
                                  bailleurAdresse: "",
                                  bailleurSiren: "",
                                  bailleurSiret: "",
                                })
                              });
                            }}
                          >
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="bailleur" id="bc_role_bailleur" />
                              <Label htmlFor="bc_role_bailleur" className="cursor-pointer">Bailleur (propriétaire)</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <RadioGroupItem value="preneur" id="bc_role_preneur" />
                          <Label htmlFor="bc_role_preneur" className="cursor-pointer">Preneur (locataire)</Label>
                        </div>
                      </RadioGroup>
                    </div>
                  </div>

                  {/* Bailleur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">
                      {bailCommercialData.clientRole === "bailleur" ? "🏢 Bailleur (votre client)" : "🏢 Bailleur"}
                    </h3>
                    
                    {/* Sélection du client si bailleur */}
                    {bailCommercialData.clientRole === "bailleur" && (
                      <div className="space-y-2">
                        <Label>Sélectionner le client bailleur *</Label>
                        <Select 
                          value={bailCommercialData.clientId} 
                          onValueChange={(value) => {
                            const selectedClient = clients.find(c => c.id === value);
                            if (selectedClient) {
                              console.log('🔍 BAILLEUR - Client:', selectedClient);
                              console.log('🔍 BAILLEUR - situation_matrimoniale:', selectedClient.situation_matrimoniale);
                              console.log('🔍 BAILLEUR - situation_familiale:', selectedClient.situation_familiale);
                              
                              let situationFamiliale = "";
                              let regimeMatrimonial = "";
                              
                              // Essayer d'abord situation_matrimoniale
                              if (selectedClient.situation_matrimoniale) {
                                if (typeof selectedClient.situation_matrimoniale === 'object') {
                                  // Cas 1: Objet JSON dans situation_matrimoniale
                                  situationFamiliale = selectedClient.situation_matrimoniale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_matrimoniale.regime_matrimonial || '';
                                  
                                  console.log('🔍 BAILLEUR - Extrait de situation_matrimoniale:', situationFamiliale, regimeMatrimonial);
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_matrimoniale === 'string') {
                                  // Cas 2: Simple chaîne de texte
                                  situationFamiliale = selectedClient.situation_matrimoniale;
                                  console.log('🔍 BAILLEUR - String directe:', situationFamiliale);
                                }
                              }
                              
                              // Si pas trouvé, essayer situation_familiale
                              if (!situationFamiliale && selectedClient.situation_familiale) {
                                if (typeof selectedClient.situation_familiale === 'object') {
                                  // Objet JSON dans situation_familiale
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_familiale.regime_matrimonial || '';
                                  
                                  console.log('🔍 BAILLEUR - Extrait de situation_familiale:', situationFamiliale, regimeMatrimonial);
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  // Simple chaîne
                                  situationFamiliale = selectedClient.situation_familiale;
                                  console.log('🔍 BAILLEUR - String situation_familiale:', situationFamiliale);
                                }
                              }
                              
                              console.log('🔍 BAILLEUR - Valeurs finales:', { situationFamiliale, regimeMatrimonial });
                              
                              setBailCommercialData({
                                ...bailCommercialData,
                                clientId: value,
                                bailleurClientId: value,
                                statutBailleur: "physique",
                                bailleurNom: selectedClient.nom || "",
                                bailleurPrenom: selectedClient.prenom || "",
                                bailleurAdresse: selectedClient.adresse || "",
                                bailleurDateNaissance: selectedClient.date_naissance || "",
                                bailleurLieuNaissance: selectedClient.lieu_naissance || "",
                                bailleurNationalite: selectedClient.nationalite || "",
                                bailleurSituationFamiliale: situationFamiliale,
                                bailleurRegimeMatrimonial: regimeMatrimonial,
                                bailleurProfession: selectedClient.profession || "",
                              });
                            }
                          }}
                        >
                          <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                          <SelectContent>
                            {clients.map((client) => (
                              <SelectItem key={client.id} value={client.id}>{client.nom} {client.prenom}</SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                    )}
                    
                    {bailCommercialData.clientRole === "preneur" && (
                      <div className="text-sm text-muted-foreground mb-2">
                        Saisir manuellement les informations du bailleur
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Statut du bailleur *</Label>
                        <Select 
                          value={bailCommercialData.statutBailleur} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, statutBailleur: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="physique">Personne physique</SelectItem>
                            <SelectItem value="morale">Personne morale (société)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {/* Champs personne physique */}
                    {bailCommercialData.statutBailleur === "physique" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input value={bailCommercialData.bailleurNom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurNom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input value={bailCommercialData.bailleurPrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurPrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Input value={bailCommercialData.bailleurAdresse} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurAdresse: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={bailCommercialData.bailleurDateNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurDateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input value={bailCommercialData.bailleurLieuNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurLieuNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input value={bailCommercialData.bailleurNationalite} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurNationalite: e.target.value})} placeholder="Ex: Française" />
                        </div>
                        <div className="space-y-2">
                          <Label>Situation familiale</Label>
                          <Input value={bailCommercialData.bailleurSituationFamiliale} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSituationFamiliale: e.target.value})} placeholder="Ex: Célibataire, Marié, Divorcé..." />
                        </div>
                        {bailCommercialData.bailleurSituationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => bailCommercialData.bailleurSituationFamiliale.toLowerCase().includes(term)) && (
                          <div className="space-y-2">
                            <Label>Régime matrimonial</Label>
                            <Input value={bailCommercialData.bailleurRegimeMatrimonial} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRegimeMatrimonial: e.target.value})} placeholder="Ex: Communauté légale, Séparation de biens..." />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Profession</Label>
                          <Input value={bailCommercialData.bailleurProfession} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurProfession: e.target.value})} />
                        </div>

                        {/* Upload carte identité bailleur si le client est preneur (avant la fin de la grid) */}
                        {bailCommercialData.clientRole === "preneur" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Pièce d'identité du bailleur</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf,image/*"
                                multiple
                                className="hidden"
                                id="bail-commercial-bailleur-upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  if (files.length > 0) {
                                    setBailCommercialBailleurFiles(files);
                                    toast.success(`${files.length} fichier(s) ajouté(s)`);
                                  }
                                  e.target.value = '';
                                }}
                              />
                              <label htmlFor="bail-commercial-bailleur-upload" className="cursor-pointer flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                  <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                                  </svg>
                                </div>
                                <div className="flex-1">
                                  <p className="text-sm font-medium">Joindre la pièce d'identité</p>
                                  <p className="text-xs text-muted-foreground">PDF ou images</p>
                                </div>
                              </label>
                            </div>
                            {bailCommercialBailleurFiles.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {bailCommercialBailleurFiles.map((file, index) => (
                                  <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      onClick={() => {
                                        setBailCommercialBailleurFiles(prev => prev.filter((_, i) => i !== index));
                                        toast.success('Fichier supprimé');
                                      }}
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    )}

                    {/* Pièce d'identité du bailleur (si client sélectionné) */}
                    {bailCommercialData.clientRole === "bailleur" && bailCommercialData.clientId && (
                      <div className="space-y-2 mt-4">
                        <Label>📎 Pièce d'identité du bailleur</Label>
                        {bailCommercialBailleurClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(bailCommercialBailleurClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}

                    {/* Champs personne morale */}
                    {bailCommercialData.statutBailleur === "morale" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Dénomination sociale *</Label>
                          <Input value={bailCommercialData.bailleurDenomination} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurDenomination: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Forme juridique *</Label>
                          <Select value={bailCommercialData.bailleurFormeJuridique} onValueChange={(value) => setBailCommercialData({...bailCommercialData, bailleurFormeJuridique: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="SAS">SAS</SelectItem>
                              <SelectItem value="SARL">SARL</SelectItem>
                              <SelectItem value="SCI">SCI</SelectItem>
                              <SelectItem value="SA">SA</SelectItem>
                              <SelectItem value="EURL">EURL</SelectItem>
                              <SelectItem value="SASU">SASU</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>SIREN *</Label>
                          <Input value={bailCommercialData.bailleurSiren} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSiren: e.target.value})} placeholder="9 chiffres" />
                        </div>
                        <div className="space-y-2">
                          <Label>SIRET *</Label>
                          <Input value={bailCommercialData.bailleurSiret} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSiret: e.target.value})} placeholder="14 chiffres" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse du siège social *</Label>
                          <Input value={bailCommercialData.bailleurSiegeSocial} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurSiegeSocial: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Capital social</Label>
                          <Input value={bailCommercialData.bailleurCapitalSocial} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurCapitalSocial: e.target.value})} placeholder="Ex: 10000 €" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-4">Représentant légal</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du représentant *</Label>
                          <Input value={bailCommercialData.bailleurRepresentant} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRepresentant: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du représentant *</Label>
                          <Input value={bailCommercialData.bailleurRepresentantPrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRepresentantPrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Fonction *</Label>
                          <Input value={bailCommercialData.bailleurRepresentantFonction} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurRepresentantFonction: e.target.value})} placeholder="Ex: Gérant, Président..." />
                        </div>
                        <div className="space-y-2">
                          <Label>Le signataire est-il le représentant légal ? *</Label>
                          <Select value={bailCommercialData.bailleurRepresentantEstLegal} onValueChange={(value) => setBailCommercialData({...bailCommercialData, bailleurRepresentantEstLegal: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non (mandataire)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {bailCommercialData.bailleurRepresentantEstLegal === "non" && (
                          <>
                            <div className="space-y-2 md:col-span-2">
                              <h4 className="font-medium text-sm mt-2">Mandataire</h4>
                            </div>
                            <div className="space-y-2">
                              <Label>Nom du mandataire *</Label>
                              <Input value={bailCommercialData.bailleurMandataireNom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurMandataireNom: e.target.value})} />
                            </div>
                            <div className="space-y-2">
                              <Label>Prénom du mandataire *</Label>
                              <Input value={bailCommercialData.bailleurMandatairePrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurMandatairePrenom: e.target.value})} />
                            </div>
                            <div className="space-y-2 md:col-span-2">
                              <Label>Type de pouvoir *</Label>
                              <Input value={bailCommercialData.bailleurMandataireTypePouvoir} onChange={(e) => setBailCommercialData({...bailCommercialData, bailleurMandataireTypePouvoir: e.target.value})} placeholder="Ex: Procuration spéciale..." />
                            </div>
                          </>
                        )}
                      </div>
                    )}
                  </div>

                  {/* Local commercial */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏪 Local commercial</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète du local *</Label>
                        <Input 
                          value={bailCommercialData.adresseLocal} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, adresseLocal: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Nature du local *</Label>
                        <Select 
                          value={bailCommercialData.natureLocal} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, natureLocal: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="boutique">Boutique</SelectItem>
                            <SelectItem value="bureaux">Bureaux</SelectItem>
                            <SelectItem value="restaurant">Restaurant</SelectItem>
                            <SelectItem value="entrepot">Entrepôt</SelectItem>
                            <SelectItem value="atelier">Atelier</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      <div className="space-y-2">
                        <Label>Surface totale (m²) *</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.surfaceTotale} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, surfaceTotale: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* Preneur (Locataire) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">
                      {bailCommercialData.clientRole === "preneur" ? "🏢 Preneur (votre client)" : "🏢 Preneur (Locataire)"}
                    </h3>
                    
                    {/* Sélection du client si preneur */}
                    {bailCommercialData.clientRole === "preneur" && (
                      <div className="space-y-2">
                        <Label>Sélectionner le client preneur *</Label>
                        <Select 
                          value={bailCommercialData.clientId} 
                          onValueChange={(value) => {
                            const selectedClient = clients.find(c => c.id === value);
                            if (selectedClient) {
                              let situationFamiliale = "";
                              let regimeMatrimonial = "";
                              
                              // Essayer d'abord situation_matrimoniale
                              if (selectedClient.situation_matrimoniale) {
                                if (typeof selectedClient.situation_matrimoniale === 'object') {
                                  // Cas 1: Objet JSON dans situation_matrimoniale
                                  situationFamiliale = selectedClient.situation_matrimoniale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_matrimoniale.regime_matrimonial || '';
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_matrimoniale === 'string') {
                                  // Cas 2: Simple chaîne de texte
                                  situationFamiliale = selectedClient.situation_matrimoniale;
                                }
                              }
                              
                              // Si pas trouvé, essayer situation_familiale
                              if (!situationFamiliale && selectedClient.situation_familiale) {
                                if (typeof selectedClient.situation_familiale === 'object') {
                                  // Objet JSON dans situation_familiale
                                  situationFamiliale = selectedClient.situation_familiale.situation_familiale || '';
                                  regimeMatrimonial = selectedClient.situation_familiale.regime_matrimonial || '';
                                  
                                  // Capitaliser
                                  if (situationFamiliale) {
                                    situationFamiliale = situationFamiliale.charAt(0).toUpperCase() + situationFamiliale.slice(1);
                                  }
                                  if (regimeMatrimonial) {
                                    regimeMatrimonial = regimeMatrimonial.replace(/_/g, ' ');
                                  }
                                } else if (typeof selectedClient.situation_familiale === 'string') {
                                  // Simple chaîne
                                  situationFamiliale = selectedClient.situation_familiale;
                                }
                              }
                              
                              setBailCommercialData({
                                ...bailCommercialData,
                                clientId: value,
                                locataireClientId: value,
                                statutLocataire: "physique",
                                locataireNom: selectedClient.nom || "",
                                locatairePrenom: selectedClient.prenom || "",
                                locataireAdresse: selectedClient.adresse || "",
                                locataireDateNaissance: selectedClient.date_naissance || "",
                                locataireLieuNaissance: selectedClient.lieu_naissance || "",
                                locataireNationalite: selectedClient.nationalite || "",
                                locataireSituationFamiliale: situationFamiliale,
                                locataireRegimeMatrimonial: regimeMatrimonial,
                                locataireProfession: selectedClient.profession || "",
                                locataireTelephone: selectedClient.telephone || "",
                                locataireEmail: selectedClient.email || "",
                              });
                            }
                          }}
                        >
                          <SelectTrigger><SelectValue placeholder="Choisir un client" /></SelectTrigger>
                          <SelectContent>
                            {clients.map((client) => (
                              <SelectItem key={client.id} value={client.id}>{client.nom} {client.prenom}</SelectItem>
                            ))}
                          </SelectContent>
                        </Select>
                      </div>
                    )}
                    
                    {bailCommercialData.clientRole === "bailleur" && (
                      <div className="text-sm text-muted-foreground mb-2">
                        Saisir manuellement les informations du preneur
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Statut du preneur *</Label>
                        <Select 
                          value={bailCommercialData.statutLocataire} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, statutLocataire: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="physique">Personne physique</SelectItem>
                            <SelectItem value="morale">Personne morale (société)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {/* Champs personne physique */}
                    {bailCommercialData.statutLocataire === "physique" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2">
                          <Label>Nom *</Label>
                          <Input value={bailCommercialData.locataireNom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireNom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom *</Label>
                          <Input value={bailCommercialData.locatairePrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, locatairePrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse actuelle *</Label>
                          <Input value={bailCommercialData.locataireAdresse} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireAdresse: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Date de naissance *</Label>
                          <Input type="date" value={bailCommercialData.locataireDateNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireDateNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Lieu de naissance *</Label>
                          <Input value={bailCommercialData.locataireLieuNaissance} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireLieuNaissance: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Nationalité *</Label>
                          <Input value={bailCommercialData.locataireNationalite} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireNationalite: e.target.value})} placeholder="Ex: Française" />
                        </div>
                        <div className="space-y-2">
                          <Label>Situation familiale</Label>
                          <Input value={bailCommercialData.locataireSituationFamiliale} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSituationFamiliale: e.target.value})} placeholder="Ex: Célibataire, Marié, Divorcé..." />
                        </div>
                        {bailCommercialData.locataireSituationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => bailCommercialData.locataireSituationFamiliale.toLowerCase().includes(term)) && (
                          <div className="space-y-2">
                            <Label>Régime matrimonial</Label>
                            <Input value={bailCommercialData.locataireRegimeMatrimonial} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRegimeMatrimonial: e.target.value})} placeholder="Ex: Communauté légale, Séparation de biens..." />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Profession *</Label>
                          <Input value={bailCommercialData.locataireProfession} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireProfession: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Téléphone *</Label>
                          <Input value={bailCommercialData.locataireTelephone} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireTelephone: e.target.value})} placeholder="06 XX XX XX XX" />
                        </div>

                        {/* Upload carte identité preneur si le client est bailleur (avant Email) */}
                        {bailCommercialData.clientRole === "bailleur" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Pièce d'identité du preneur</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf,image/*"
                                multiple
                                className="hidden"
                                id="bail-commercial-preneur-upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  if (files.length > 0) {
                                    setBailCommercialLocataireFiles(files);
                                    toast.success(`${files.length} fichier(s) ajouté(s)`);
                                  }
                                  e.target.value = '';
                                }}
                              />
                              <label htmlFor="bail-commercial-preneur-upload" className="cursor-pointer flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                  <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                                  </svg>
                                </div>
                                <div className="flex-1">
                                  <p className="text-sm font-medium">Joindre la pièce d'identité</p>
                                  <p className="text-xs text-muted-foreground">PDF ou images</p>
                                </div>
                              </label>
                            </div>
                            {bailCommercialLocataireFiles.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {bailCommercialLocataireFiles.map((file, index) => (
                                  <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      onClick={() => {
                                        setBailCommercialLocataireFiles(prev => prev.filter((_, i) => i !== index));
                                        toast.success('Fichier supprimé');
                                      }}
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        )}

                        <div className="space-y-2 md:col-span-2">
                          <Label>Email *</Label>
                          <Input type="email" value={bailCommercialData.locataireEmail} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireEmail: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-4">Activité professionnelle</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Exerce en nom propre ou sous EI ? *</Label>
                          <Select value={bailCommercialData.locataireExerceEnNomPropre} onValueChange={(value) => setBailCommercialData({...bailCommercialData, locataireExerceEnNomPropre: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="nom_propre">Nom propre</SelectItem>
                              <SelectItem value="ei">EI</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Intitulé de l'activité exercée *</Label>
                          <Input value={bailCommercialData.locataireActivite} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireActivite: e.target.value})} placeholder="Ex: Commerce de détail, Artisan..." />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéro SIREN</Label>
                          <Input value={bailCommercialData.locataireSirenPersonnel} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSirenPersonnel: e.target.value})} placeholder="Si existant" />
                        </div>
                        <div className="space-y-2">
                          <Label>Entreprise en cours de création ? *</Label>
                          <Select value={bailCommercialData.locataireEntrepriseEnCreation} onValueChange={(value) => setBailCommercialData({...bailCommercialData, locataireEntrepriseEnCreation: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                    )}

                    {/* Pièce d'identité du preneur (si client sélectionné) */}
                    {bailCommercialData.clientRole === "preneur" && bailCommercialData.clientId && bailCommercialData.statutLocataire === "physique" && (
                      <div className="space-y-2 mt-4">
                        <Label>📎 Pièce d'identité du preneur</Label>
                        {bailCommercialPreneurClientIdentiteUrl ? (
                          <div className="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded-lg">
                            <svg className="w-4 h-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span className="text-sm flex-1 text-green-700">Pièce d'identité chargée depuis le profil client</span>
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="bg-green-600 hover:bg-green-700 text-white"
                              onClick={() => window.open(bailCommercialPreneurClientIdentiteUrl, '_blank')}
                            >
                              <Eye className="w-4 h-4" />
                            </Button>
                          </div>
                        ) : (
                          <div className="flex items-center gap-2 p-2 bg-orange-50 border border-orange-200 rounded-lg">
                            <svg className="w-4 h-4 text-orange-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <span className="text-sm flex-1 text-orange-700">Aucune pièce d'identité dans le profil client</span>
                          </div>
                        )}
                      </div>
                    )}

                    {/* Upload carte identité pour l'autre partie (bailleur qui n'est pas client) - déplacé ailleurs */}

                    {/* Champs personne morale */}
                    {bailCommercialData.statutLocataire === "morale" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Dénomination sociale *</Label>
                          <Input value={bailCommercialData.locataireDenomination} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireDenomination: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Forme juridique *</Label>
                          <Select value={bailCommercialData.locataireFormeJuridique} onValueChange={(value) => setBailCommercialData({...bailCommercialData, locataireFormeJuridique: value})}>
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="SAS">SAS</SelectItem>
                              <SelectItem value="SARL">SARL</SelectItem>
                              <SelectItem value="SCI">SCI</SelectItem>
                              <SelectItem value="SA">SA</SelectItem>
                              <SelectItem value="EURL">EURL</SelectItem>
                              <SelectItem value="SASU">SASU</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>SIREN *</Label>
                          <Input value={bailCommercialData.locataireSiren} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSiren: e.target.value})} placeholder="9 chiffres" />
                        </div>
                        <div className="space-y-2">
                          <Label>SIRET *</Label>
                          <Input value={bailCommercialData.locataireSiret} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSiret: e.target.value})} placeholder="14 chiffres" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse du siège social *</Label>
                          <Input value={bailCommercialData.locataireSiege} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireSiege: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Objet social *</Label>
                          <Input value={bailCommercialData.locataireObjetSocial} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireObjetSocial: e.target.value})} placeholder="Pour vérifier compatibilité" />
                        </div>
                        <div className="space-y-2">
                          <Label>Capital social</Label>
                          <Input value={bailCommercialData.locataireCapital} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireCapital: e.target.value})} placeholder="Ex: 5000 €" />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-4">Représentant légal</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du représentant *</Label>
                          <Input value={bailCommercialData.locataireRepresentant} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRepresentant: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du représentant *</Label>
                          <Input value={bailCommercialData.locataireRepresentantPrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRepresentantPrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Fonction *</Label>
                          <Input value={bailCommercialData.locataireRepresentantFonction} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireRepresentantFonction: e.target.value})} placeholder="Ex: Gérant, Président..." />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <h4 className="font-medium text-sm mt-2">Mandataire (si différent du représentant)</h4>
                        </div>
                        <div className="space-y-2">
                          <Label>Nom du mandataire</Label>
                          <Input value={bailCommercialData.locataireMandataireNom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireMandataireNom: e.target.value})} />
                        </div>
                        <div className="space-y-2">
                          <Label>Prénom du mandataire</Label>
                          <Input value={bailCommercialData.locataireMandatairePrenom} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireMandatairePrenom: e.target.value})} />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Type de pouvoir</Label>
                          <Input value={bailCommercialData.locataireMandataireTypePouvoir} onChange={(e) => setBailCommercialData({...bailCommercialData, locataireMandataireTypePouvoir: e.target.value})} placeholder="Ex: Procuration..." />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* Activité */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💼 Activité</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Activité principale autorisée *</Label>
                        <Input 
                          value={bailCommercialData.activitePrincipale} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, activitePrincipale: e.target.value})} 
                          placeholder="Ex: Commerce de détail, Restauration, Cabinet médical..."
                        />
                      </div>

                      {/* COMMERCIAL UNIQUEMENT - 1. Destination des lieux */}
                      {bailCommercialData.typeBail === "commercial" && (
                        <>
                          <div className="space-y-2">
                            <Label>Destination contractuelle précise *</Label>
                            <Textarea 
                              value={bailCommercialData.destinationContractuelle} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, destinationContractuelle: e.target.value})} 
                              placeholder="Ex: Vente et préparation de produits alimentaires à consommer sur place ou à emporter"
                              rows={3}
                            />
                            <p className="text-xs text-muted-foreground">Décrivez précisément les activités autorisées</p>
                          </div>

                          <div className="space-y-2">
                            <Label>Exclusivités éventuelles</Label>
                            <Textarea 
                              value={bailCommercialData.exclusivitesEventuelles} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, exclusivitesEventuelles: e.target.value})} 
                              placeholder="Ex: Exclusivité de vente de produits bio dans l'immeuble"
                              rows={2}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Interdictions d'usage</Label>
                            <Textarea 
                              value={bailCommercialData.interdictionsUsage} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, interdictionsUsage: e.target.value})} 
                              placeholder="Ex: À l'exclusion de toute activité bruyante ou nuisible"
                              rows={2}
                            />
                          </div>
                        </>
                      )}

                      {/* PROFESSIONNEL UNIQUEMENT - Type de profession */}
                      {bailCommercialData.typeBail === "professionnel" && (
                        <>
                          <div className="space-y-2">
                            <Label>Type de profession *</Label>
                            <Select 
                              value={bailCommercialData.typeProfession} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, typeProfession: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="libérale_reglementee">Profession libérale réglementée (médecin, avocat, architecte...)</SelectItem>
                                <SelectItem value="libérale_non_reglementee">Profession libérale non réglementée (consultant, coach...)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {bailCommercialData.typeProfession === "libérale_reglementee" && (
                            <>
                              <div className="space-y-2">
                                <Label>Numéro d'ordre professionnel *</Label>
                                <Input 
                                  value={bailCommercialData.numeroOrdreProfessionnel} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, numeroOrdreProfessionnel: e.target.value})} 
                                  placeholder="Ex: Numéro RPPS, numéro d'inscription au barreau..."
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>📎 Attestation d'inscription à l'ordre</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="bail-professionnel-ordre-upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      if (files.length > 0) {
                                        setBailProfessionnelOrdreFiles(files);
                                        toast.success(`${files.length} fichier(s) ajouté(s)`);
                                      }
                                      e.target.value = '';
                                    }}
                                  />
                                  <label htmlFor="bail-professionnel-ordre-upload" className="cursor-pointer flex items-center gap-3">
                                    <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                      <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                      </svg>
                                    </div>
                                    <div className="flex-1">
                                      <p className="text-sm font-medium">Joindre l'attestation d'inscription</p>
                                      <p className="text-xs text-muted-foreground">PDF uniquement</p>
                                    </div>
                                  </label>
                                </div>
                                {bailProfessionnelOrdreFiles.length > 0 && (
                                  <div className="space-y-2 mt-2">
                                    {bailProfessionnelOrdreFiles.map((file, index) => (
                                      <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                        <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        <span className="text-sm flex-1 truncate">{file.name}</span>
                                        <Button
                                          type="button"
                                          variant="ghost"
                                          size="sm"
                                          className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                          onClick={() => {
                                            setBailProfessionnelOrdreFiles(prev => prev.filter((_, i) => i !== index));
                                            toast.success('Fichier supprimé');
                                          }}
                                        >
                                          <Trash2 className="w-4 h-4" />
                                        </Button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </>
                          )}
                        </>
                      )}
                    </div>
                  </div>

                  {/* Conditions financières */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💶 Conditions financières</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Loyer mensuel HT (€) *</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.loyerMensuelHT} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, loyerMensuelHT: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Charges mensuelles (€) *</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.chargesMensuelles} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, chargesMensuelles: e.target.value})} 
                        />
                      </div>

                      {/* 2. Clause de révision du loyer */}
                      <div className="space-y-2 md:col-span-2 mt-4">
                        <h4 className="font-medium">Révision du loyer</h4>
                      </div>
                      
                      {bailCommercialData.typeBail === "commercial" ? (
                        <>
                          <div className="space-y-2">
                            <Label>Indice applicable *</Label>
                            <Select 
                              value={bailCommercialData.indiceApplicable} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, indiceApplicable: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="ILC">ILC (Indice des Loyers Commerciaux)</SelectItem>
                                <SelectItem value="ILAT">ILAT (Indice des Loyers des Activités Tertiaires)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="space-y-2">
                            <Label>Base de calcul de l'indice</Label>
                            <Input 
                              value={bailCommercialData.baseCalculIndice} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, baseCalculIndice: e.target.value})} 
                              placeholder="Ex: Indice du 1er trimestre 2025"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Modalité de révision *</Label>
                            <Select 
                              value={bailCommercialData.modaliteRevision} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, modaliteRevision: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="annuelle">Annuelle</SelectItem>
                                <SelectItem value="triennale">Triennale</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                        </>
                      ) : (
                        <>
                          {/* PROFESSIONNEL - Révision via IRL uniquement */}
                          <div className="space-y-2 md:col-span-2">
                            <p className="text-sm text-muted-foreground">
                              Pour un bail professionnel : révision annuelle via IRL (Indice de Référence des Loyers)
                            </p>
                          </div>
                          <div className="space-y-2">
                            <Label>Base de calcul de l'indice IRL</Label>
                            <Input 
                              value={bailCommercialData.baseCalculIndice} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, baseCalculIndice: e.target.value})} 
                              placeholder="Ex: IRL du 1er trimestre 2025"
                            />
                          </div>
                        </>
                      )}

                      {/* 7. Charges récupérables */}
                      <div className="space-y-2">
                        <Label>Mode de règlement des charges *</Label>
                        <Select 
                          value={bailCommercialData.modeReglementCharges} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, modeReglementCharges: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="forfait">Forfait</SelectItem>
                            <SelectItem value="provision">Provision avec régularisation</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* 3. Dépôt de garantie */}
                      <div className="space-y-2 md:col-span-2 mt-4">
                        <h4 className="font-medium">Dépôt de garantie</h4>
                      </div>
                      <div className="space-y-2">
                        <Label>Montant du dépôt de garantie (€)</Label>
                        <Input 
                          type="number"
                          value={bailCommercialData.montantDepotGarantie} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, montantDepotGarantie: e.target.value})} 
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Modalités de restitution</Label>
                        <Input 
                          value={bailCommercialData.restitutionDepot} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, restitutionDepot: e.target.value})} 
                          placeholder="Ex: Dans les 30 jours suivant la restitution des lieux"
                        />
                      </div>
                    </div>
                  </div>

                  {/* Durée */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📅 Durée du bail</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {bailCommercialData.typeBail === "commercial" ? (
                        <div className="space-y-2">
                          <Label>Type de bail *</Label>
                          <Select 
                            value={bailCommercialData.dureeBail} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, dureeBail: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="3-6-9">Bail commercial 3/6/9</SelectItem>
                              <SelectItem value="derogatoire">Bail dérogatoire (≤ 3 ans)</SelectItem>
                              <SelectItem value="saisonnier">Bail saisonnier</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      ) : (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Durée du bail professionnel</Label>
                          <p className="text-sm text-muted-foreground">Durée minimum de 6 ans avec possibilité de résiliation triennale</p>
                          <Input 
                            type="number"
                            value={bailCommercialData.dureeBail || "6"} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, dureeBail: e.target.value})}
                            placeholder="6"
                            min="6"
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Date de prise d'effet *</Label>
                        <Input 
                          type="date"
                          value={bailCommercialData.datePriseEffet} 
                          onChange={(e) => setBailCommercialData({...bailCommercialData, datePriseEffet: e.target.value})} 
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4. Travaux et réparations (COMMERCIAL UNIQUEMENT) */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">🔧 Travaux et réparations</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Travaux à la charge du bailleur</Label>
                          <Textarea 
                            value={bailCommercialData.travauxChargeBailleur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, travauxChargeBailleur: e.target.value})} 
                            placeholder="Ex: Gros œuvre, ravalement, toiture, structure..."
                            rows={3}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Travaux à la charge du preneur</Label>
                          <Textarea 
                            value={bailCommercialData.travauxChargePreneur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, travauxChargePreneur: e.target.value})} 
                            placeholder="Ex: Entretien courant, réparations locatives, aménagements intérieurs..."
                            rows={3}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Charges supportées par le bailleur</Label>
                          <Textarea 
                            value={bailCommercialData.chargesSupporteesBailleur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, chargesSupporteesBailleur: e.target.value})} 
                            placeholder="Ex: Taxe foncière, gros entretien..."
                            rows={2}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Charges supportées par le preneur</Label>
                          <Textarea 
                            value={bailCommercialData.chargesSupporteesPreneur} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, chargesSupporteesPreneur: e.target.value})} 
                            placeholder="Ex: Eau, électricité, chauffage, taxe ordures ménagères..."
                            rows={2}
                        />
                      </div>
                    </div>
                  </div>
                  )}

                  {/* 5. Impôts et taxes (COMMERCIAL UNIQUEMENT) */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">💰 Impôts et taxes</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Taxe foncière supportée par *</Label>
                          <Select 
                            value={bailCommercialData.taxeFonciereSupporteePar} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, taxeFonciereSupporteePar: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="bailleur">Bailleur</SelectItem>
                              <SelectItem value="locataire">Locataire</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Taxes et contributions récupérables</Label>
                          <Textarea 
                            value={bailCommercialData.taxesRecuperables} 
                            onChange={(e) => setBailCommercialData({...bailCommercialData, taxesRecuperables: e.target.value})} 
                            placeholder="Ex: TEOM, CFE..."
                            rows={2}
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 6. État des lieux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 État des lieux</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>État des lieux d'entrée réalisé ? *</Label>
                        <Select 
                          value={bailCommercialData.etatLieuxRealise} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, etatLieuxRealise: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.etatLieuxRealise === "oui" && (
                        <div className="space-y-2">
                          <Label>📎 État des lieux (PDF)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="bail-commercial-etat-lieux-upload"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                if (files.length > 0) {
                                  setBailCommercialEtatLieuxFiles(files);
                                  toast.success(`${files.length} fichier(s) ajouté(s)`);
                                }
                                e.target.value = '';
                              }}
                            />
                            <label htmlFor="bail-commercial-etat-lieux-upload" className="cursor-pointer flex items-center gap-3">
                              <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">Joindre l'état des lieux</p>
                                <p className="text-xs text-muted-foreground">PDF uniquement</p>
                              </div>
                            </label>
                          </div>
                          {bailCommercialEtatLieuxFiles.length > 0 && (
                            <div className="space-y-2 mt-2">
                              {bailCommercialEtatLieuxFiles.map((file, index) => (
                                <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                  <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                  <span className="text-sm flex-1 truncate">{file.name}</span>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={() => {
                                      setBailCommercialEtatLieuxFiles(prev => prev.filter((_, i) => i !== index));
                                      toast.success('Fichier supprimé');
                                    }}
                                  >
                                    <Trash2 className="w-4 h-4" />
                                  </Button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 8. Sous-location & cession (COMMERCIAL UNIQUEMENT) */}
                  {bailCommercialData.typeBail === "commercial" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📄 Sous-location & Cession</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Sous-location autorisée ? *</Label>
                          <Select 
                            value={bailCommercialData.souslocationAutorisee} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, souslocationAutorisee: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {bailCommercialData.souslocationAutorisee === "oui" && (
                          <div className="space-y-2">
                            <Label>Conditions de sous-location</Label>
                            <Input 
                              value={bailCommercialData.souslocationConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, souslocationConditions: e.target.value})} 
                              placeholder="Ex: Avec accord préalable du bailleur"
                            />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Cession du bail autorisée ? *</Label>
                          <Select 
                            value={bailCommercialData.cessionBailAutorisee} 
                            onValueChange={(value) => setBailCommercialData({...bailCommercialData, cessionBailAutorisee: value})}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {bailCommercialData.cessionBailAutorisee === "oui" && (
                          <div className="space-y-2">
                            <Label>Conditions de cession</Label>
                            <Input 
                              value={bailCommercialData.cessionConditions} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, cessionConditions: e.target.value})} 
                              placeholder="Ex: Agrément du bailleur requis"
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 9. Garanties */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🛡️ Garanties</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Caution personnelle ? *</Label>
                        <Select 
                          value={bailCommercialData.cautionPersonnelleOuiNon} 
                          onValueChange={(value) => setBailCommercialData({...bailCommercialData, cautionPersonnelleOuiNon: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui</SelectItem>
                            <SelectItem value="non">Non</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {bailCommercialData.cautionPersonnelleOuiNon === "oui" && (
                        <>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom de la caution *</Label>
                              <Input 
                                value={bailCommercialData.nomCaution} 
                                onChange={(e) => setBailCommercialData({...bailCommercialData, nomCaution: e.target.value})} 
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Prénom de la caution *</Label>
                              <Input 
                                value={bailCommercialData.prenomCaution} 
                                onChange={(e) => setBailCommercialData({...bailCommercialData, prenomCaution: e.target.value})} 
                              />
                            </div>
                          </div>
                          <div className="space-y-2">
                            <Label>Montant garanti (€)</Label>
                            <Input 
                              type="number"
                              value={bailCommercialData.montantGaranti} 
                              onChange={(e) => setBailCommercialData({...bailCommercialData, montantGaranti: e.target.value})} 
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>📎 Pièce d'identité de la caution</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf,image/*"
                                multiple
                                className="hidden"
                                id="bail-commercial-caution-id-upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  if (files.length > 0) {
                                    setBailCommercialCautionIdFiles(files);
                                    toast.success(`${files.length} fichier(s) ajouté(s)`);
                                  }
                                  e.target.value = '';
                                }}
                              />
                              <label htmlFor="bail-commercial-caution-id-upload" className="cursor-pointer flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                  <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                                  </svg>
                                </div>
                                <div className="flex-1">
                                  <p className="text-sm font-medium">Joindre la pièce d'identité</p>
                                  <p className="text-xs text-muted-foreground">PDF ou images</p>
                                </div>
                              </label>
                            </div>
                            {bailCommercialCautionIdFiles.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {bailCommercialCautionIdFiles.map((file, index) => (
                                  <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      onClick={() => {
                                        setBailCommercialCautionIdFiles(prev => prev.filter((_, i) => i !== index));
                                        toast.success('Fichier supprimé');
                                      }}
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 10. Assurance obligatoire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏥 Assurance obligatoire</h3>
                    <div className="grid grid-cols-1 gap-4">
                      {bailCommercialData.typeBail === "commercial" ? (
                        <>
                          {/* COMMERCIAL - Assurance multirisque professionnelle */}
                          <div className="space-y-2">
                            <Label>Assurance multirisque professionnelle souscrite ? *</Label>
                            <Select 
                              value={bailCommercialData.assuranceMultirisqueSouscrite} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, assuranceMultirisqueSouscrite: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui</SelectItem>
                                <SelectItem value="non">Non (à souscrire avant entrée)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {bailCommercialData.assuranceMultirisqueSouscrite === "oui" && (
                            <>
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-2">
                                  <Label>Nom de l'assureur</Label>
                                  <Input 
                                    value={bailCommercialData.nomAssureur} 
                                    onChange={(e) => setBailCommercialData({...bailCommercialData, nomAssureur: e.target.value})} 
                                    placeholder="Ex: AXA, Allianz..."
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Numéro de police</Label>
                                  <Input 
                                    value={bailCommercialData.numeropolice} 
                                    onChange={(e) => setBailCommercialData({...bailCommercialData, numeropolice: e.target.value})} 
                                  />
                                </div>
                              </div>

                              <div className="space-y-2">
                                <Label>📎 Attestation d'assurance</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="bail-commercial-assurance-upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      if (files.length > 0) {
                                        setBailCommercialAssuranceFiles(files);
                                        toast.success(`${files.length} fichier(s) ajouté(s)`);
                                      }
                                      e.target.value = '';
                                    }}
                                  />
                                  <label htmlFor="bail-commercial-assurance-upload" className="cursor-pointer flex items-center gap-3">
                                    <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                      <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                      </svg>
                                    </div>
                                    <div className="flex-1">
                                      <p className="text-sm font-medium">Joindre l'attestation d'assurance</p>
                                      <p className="text-xs text-muted-foreground">PDF uniquement</p>
                                    </div>
                                  </label>
                                </div>
                                {bailCommercialAssuranceFiles.length > 0 && (
                                  <div className="space-y-2 mt-2">
                                    {bailCommercialAssuranceFiles.map((file, index) => (
                                      <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                        <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                        <span className="text-sm flex-1 truncate">{file.name}</span>
                                        <Button
                                          type="button"
                                          variant="ghost"
                                          size="sm"
                                          className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                          onClick={() => {
                                            setBailCommercialAssuranceFiles(prev => prev.filter((_, i) => i !== index));
                                            toast.success('Fichier supprimé');
                                          }}
                                        >
                                          <Trash2 className="w-4 h-4" />
                                        </Button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </>
                          )}
                        </>
                      ) : (
                        <>
                          {/* PROFESSIONNEL - RC Pro + Assurance locaux */}
                          <div className="space-y-2 md:col-span-2">
                            <p className="text-sm text-muted-foreground">
                              Pour un bail professionnel : obligation d'assurer la RC professionnelle et les locaux
                            </p>
                          </div>

                          <div className="space-y-2">
                            <Label>Assurance RC Professionnelle souscrite ? *</Label>
                            <Select 
                              value={bailCommercialData.assuranceRCPro} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, assuranceRCPro: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui</SelectItem>
                                <SelectItem value="non">Non (à souscrire avant entrée)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Assurance des locaux souscrite ? *</Label>
                            <Select 
                              value={bailCommercialData.assuranceLocaux} 
                              onValueChange={(value) => setBailCommercialData({...bailCommercialData, assuranceLocaux: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui</SelectItem>
                                <SelectItem value="non">Non (à souscrire avant entrée)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {(bailCommercialData.assuranceRCPro === "oui" || bailCommercialData.assuranceLocaux === "oui") && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:col-span-2">
                              <div className="space-y-2">
                                <Label>Nom de l'assureur</Label>
                                <Input 
                                  value={bailCommercialData.nomAssureur} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, nomAssureur: e.target.value})} 
                                  placeholder="Ex: AXA, Allianz..."
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Numéro de police</Label>
                                <Input 
                                  value={bailCommercialData.numeropolice} 
                                  onChange={(e) => setBailCommercialData({...bailCommercialData, numeropolice: e.target.value})} 
                                />
                              </div>
                            </div>
                          )}

                          {(bailCommercialData.assuranceRCPro === "oui" || bailCommercialData.assuranceLocaux === "oui") && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>📎 Attestations d'assurance</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="bail-professionnel-assurance-upload"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    if (files.length > 0) {
                                      setBailCommercialAssuranceFiles(files);
                                      toast.success(`${files.length} fichier(s) ajouté(s)`);
                                    }
                                    e.target.value = '';
                                  }}
                                />
                                <label htmlFor="bail-professionnel-assurance-upload" className="cursor-pointer flex items-center gap-3">
                                  <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                    <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                  </div>
                                  <div className="flex-1">
                                    <p className="text-sm font-medium">Joindre les attestations (RC Pro et/ou Locaux)</p>
                                    <p className="text-xs text-muted-foreground">PDF uniquement</p>
                                  </div>
                                </label>
                              </div>
                              {bailCommercialAssuranceFiles.length > 0 && (
                                <div className="space-y-2 mt-2">
                                  {bailCommercialAssuranceFiles.map((file, index) => (
                                    <div key={index} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                      <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                      </svg>
                                      <span className="text-sm flex-1 truncate">{file.name}</span>
                                      <Button
                                        type="button"
                                        variant="ghost"
                                        size="sm"
                                        className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                        onClick={() => {
                                          setBailCommercialAssuranceFiles(prev => prev.filter((_, i) => i !== index));
                                          toast.success('Fichier supprimé');
                                        }}
                                      >
                                        <Trash2 className="w-4 h-4" />
                                      </Button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  </div>
                </div>
              </>
            )}

            {/* Formulaire spécifique pour Convention d'indivision */}
            {pendingContractType === "Convention d'indivision" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1. Informations générales */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 Informations générales sur l'indivision</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de bien *</Label>
                        <Select 
                          value={indivisionData.typeBien} 
                          onValueChange={(value) => setIndivisionData({...indivisionData, typeBien: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="immobilier">Immobilier</SelectItem>
                            <SelectItem value="mobilier">Mobilier</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {indivisionData.typeBien === "autre" && (
                        <div className="space-y-2">
                          <Label>Préciser le type de bien</Label>
                          <Input 
                            value={indivisionData.typeBienAutre} 
                            onChange={(e) => setIndivisionData({...indivisionData, typeBienAutre: e.target.value})} 
                          />
                        </div>
                      )}
                      <div className="space-y-2">
                        <Label>Origine de l'indivision *</Label>
                        <Select 
                          value={indivisionData.origineIndivision} 
                          onValueChange={(value) => setIndivisionData({...indivisionData, origineIndivision: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="succession">Succession</SelectItem>
                            <SelectItem value="achat_commun">Achat en commun</SelectItem>
                            <SelectItem value="investissement">Investissement commun</SelectItem>
                            <SelectItem value="donation">Donation</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                      {indivisionData.origineIndivision === "autre" && (
                        <div className="space-y-2">
                          <Label>Préciser l'origine</Label>
                          <Input 
                            value={indivisionData.origineIndivisionAutre} 
                            onChange={(e) => setIndivisionData({...indivisionData, origineIndivisionAutre: e.target.value})} 
                          />
                        </div>
                      )}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Objet de la convention</Label>
                        <Textarea 
                          value={indivisionData.objetConvention} 
                          onChange={(e) => setIndivisionData({...indivisionData, objetConvention: e.target.value})} 
                          placeholder="Ex: Gestion du bien, répartition des droits, désignation d'un gérant..."
                          rows={3}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 2. Indivisaires */}
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <h3 className="font-semibold text-lg border-b pb-2 flex-1">👥 Indivisaires</h3>
                      <Button
                        type="button"
                        variant="outline"
                        size="sm"
                        className="text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                        onClick={() => {
                          const newId = Math.max(...indivisionData.indivisaires.map(i => i.id), 0) + 1;
                          setIndivisionData({
                            ...indivisionData,
                            indivisaires: [...indivisionData.indivisaires, {
                              id: newId,
                              isClient: false,
                              clientId: "",
                              nom: "",
                              prenom: "",
                              adresse: "",
                              dateNaissance: "",
                              lieuNaissance: "",
                              nationalite: "",
                              profession: "",
                              statutMatrimonial: "",
                              regimeMatrimonial: "",
                              typeIdentite: "",
                              numeroIdentite: "",
                              email: "",
                              telephone: "",
                              quotePart: "",
                              origineQuotePart: "",
                              origineQuotePartAutre: "",
                            }]
                          });
                        }}
                      >
                        + Ajouter un indivisaire
                      </Button>
                    </div>

                    {indivisionData.indivisaires.map((indivisaire, index) => (
                      <div key={indivisaire.id} className="border rounded-lg p-4 space-y-4 bg-muted/30">
                        <div className="flex items-center justify-between">
                          <h4 className="font-medium">Indivisaire {index + 1}</h4>
                          {indivisionData.indivisaires.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="text-red-600 hover:text-red-700 hover:bg-red-50"
                              onClick={() => {
                                setIndivisionData({
                                  ...indivisionData,
                                  indivisaires: indivisionData.indivisaires.filter(i => i.id !== indivisaire.id)
                                });
                              }}
                            >
                              <Trash2 className="w-4 h-4" />
                            </Button>
                          )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Client ou non */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>Cet indivisaire est-il votre client ? *</Label>
                            <RadioGroup
                              value={indivisaire.isClient ? "oui" : "non"}
                              onValueChange={(value) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {
                                  ...newIndivisaires[idx],
                                  isClient: value === "oui",
                                  clientId: value === "oui" ? newIndivisaires[idx].clientId : "",
                                };
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id={`indiv_${indivisaire.id}_client_oui`} />
                                  <Label htmlFor={`indiv_${indivisaire.id}_client_oui`} className="cursor-pointer">Oui (client)</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id={`indiv_${indivisaire.id}_client_non`} />
                                  <Label htmlFor={`indiv_${indivisaire.id}_client_non`} className="cursor-pointer">Non (autre partie)</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {/* Si c'est un client */}
                          {indivisaire.isClient ? (
                            <>
                              <div className="space-y-2 md:col-span-2">
                                <Label>Sélectionner le client *</Label>
                                <Select
                                  value={indivisaire.clientId}
                                  onValueChange={async (value) => {
                                    const selectedClient = clients.find(c => c.id === value);
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    if (selectedClient) {
                                      console.log('🔍 Client sélectionné:', selectedClient.nom, selectedClient.prenom);
                                      console.log('📋 situation_matrimoniale:', selectedClient.situation_matrimoniale);
                                      console.log('📋 situation_familiale:', selectedClient.situation_familiale);
                                      console.log('📄 id_doc_path:', selectedClient.id_doc_path);
                                      
                                      // Extraire la situation familiale et le régime matrimonial
                                      // Priorité 1: utiliser situation_matrimoniale directement (c'est le champ principal)
                                      let situationFamiliale = selectedClient.situation_matrimoniale || "";
                                      let regimeMatrimonial = "";
                                      
                                      // Extraire le régime matrimonial de l'objet situation_familiale si c'est un objet
                                      if (selectedClient.situation_familiale) {
                                        if (typeof selectedClient.situation_familiale === 'string') {
                                          if (!situationFamiliale) situationFamiliale = selectedClient.situation_familiale;
                                        } else if (typeof selectedClient.situation_familiale === 'object') {
                                          const sitFam = selectedClient.situation_familiale as any;
                                          regimeMatrimonial = sitFam.regime_matrimonial || "";
                                          // Si pas de situation_matrimoniale, essayer de l'extraire de l'objet
                                          if (!situationFamiliale && sitFam.situation_familiale) {
                                            situationFamiliale = sitFam.situation_familiale;
                                          }
                                        }
                                      }
                                      
                                      console.log('📋 situationFamiliale extraite:', situationFamiliale);
                                      console.log('📋 regimeMatrimonial extrait:', regimeMatrimonial);
                                      
                                      newIndivisaires[idx] = {
                                        ...newIndivisaires[idx],
                                        clientId: value,
                                        isClient: true,
                                        nom: selectedClient.nom || "",
                                        prenom: selectedClient.prenom || "",
                                        adresse: selectedClient.adresse || "",
                                        dateNaissance: selectedClient.date_naissance || "",
                                        lieuNaissance: selectedClient.lieu_naissance || "",
                                        nationalite: selectedClient.nationalite || "",
                                        profession: selectedClient.profession || "",
                                        situationFamiliale: situationFamiliale,
                                        regimeMatrimonial: regimeMatrimonial,
                                        typeIdentite: selectedClient.type_identite || "",
                                        numeroIdentite: selectedClient.numero_identite || "",
                                        email: selectedClient.email || "",
                                        telephone: selectedClient.telephone || "",
                                      };
                                      
                                      // Charger automatiquement la carte d'identité depuis Supabase storage
                                      if (selectedClient.id_doc_path) {
                                        console.log('✅ Début chargement document:', selectedClient.id_doc_path);
                                        try {
                                          const { data, error } = await supabase.storage
                                            .from('documents')
                                            .download(selectedClient.id_doc_path);
                                          
                                          if (data && !error) {
                                            console.log('✅ Document téléchargé avec succès');
                                            const fileName = selectedClient.id_doc_path.split('/').pop() || 'identite.pdf';
                                            const file = new File([data], fileName, { type: data.type });
                                            console.log('📁 Fichier créé:', fileName, 'taille:', file.size);
                                            setIndivisairesIdentiteFiles(prev => {
                                              const newState = {
                                                ...prev,
                                                [indivisaire.id]: [file]
                                              };
                                              console.log('📊 Nouveau state identiteFiles:', newState);
                                              return newState;
                                            });
                                            setIndivisairesIdentiteUrls(prev => ({
                                              ...prev,
                                              [indivisaire.id]: [selectedClient.id_doc_path]
                                            }));
                                          } else {
                                            console.error('❌ Erreur téléchargement:', error);
                                          }
                                        } catch (error) {
                                          console.error('❌ Erreur chargement carte identité:', error);
                                        }
                                      } else {
                                        console.log('⚠️ Pas de id_doc_path, recherche dans client_documents pour client:', selectedClient.id);
                                        // Chercher dans client_documents si pas de id_doc_path
                                        try {
                                          const { data: docs, error: docsError } = await supabase
                                            .from('client_documents')
                                            .select('file_path, file_name, document_type')
                                            .eq('client_id', selectedClient.id)
                                            .eq('document_type', 'piece_identite')
                                            .order('uploaded_at', { ascending: false })
                                            .limit(1);
                                          
                                          if (docsError) {
                                            console.error('❌ Erreur recherche documents:', docsError);
                                          } else if (docs && docs.length > 0) {
                                            const idDoc = docs[0];
                                            console.log('📄 Document pièce identité trouvé:', idDoc.file_name);
                                            
                                            const { data, error } = await supabase.storage
                                              .from('documents')
                                              .download(idDoc.file_path);
                                            
                                            if (data && !error) {
                                              console.log('✅ Document téléchargé avec succès depuis client_documents');
                                              const file = new File([data], idDoc.file_name, { type: data.type });
                                              setIndivisairesIdentiteFiles(prev => ({
                                                ...prev,
                                                [indivisaire.id]: [file]
                                              }));
                                              setIndivisairesIdentiteUrls(prev => ({
                                                ...prev,
                                                [indivisaire.id]: [idDoc.file_path]
                                              }));
                                            } else {
                                              console.error('❌ Erreur téléchargement depuis storage:', error);
                                            }
                                          } else {
                                            console.log('ℹ️ Aucune pièce d\'identité trouvée dans client_documents');
                                          }
                                        } catch (error) {
                                          console.error('❌ Erreur recherche client_documents:', error);
                                        }
                                      }
                                    }
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                                  <SelectContent>
                                    {clients.map((client) => (
                                      <SelectItem key={client.id} value={client.id}>
                                        {client.nom} {client.prenom}
                                      </SelectItem>
                                    ))}
                                  </SelectContent>
                                </Select>
                              </div>

                              {/* Affichage des infos du client */}
                              {indivisaire.clientId && (
                                <div className="md:col-span-2 p-3 bg-green-50 border border-green-200 rounded-lg">
                                  <p className="text-sm font-medium text-green-800">✓ Informations chargées depuis la fiche client</p>
                                  <p className="text-sm text-green-700 mt-1">{indivisaire.nom} {indivisaire.prenom} - {indivisaire.adresse}</p>
                                </div>
                              )}
                            </>
                          ) : (
                            <>
                              {/* Saisie manuelle pour non-client */}
                              <div className="space-y-2">
                                <Label>Nom *</Label>
                                <Input
                                  value={indivisaire.nom}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], nom: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Prénom *</Label>
                                <Input
                                  value={indivisaire.prenom}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], prenom: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2 md:col-span-2">
                                <Label>Adresse *</Label>
                                <Input
                                  value={indivisaire.adresse}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], adresse: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Date de naissance</Label>
                                <Input
                                  type="date"
                                  value={indivisaire.dateNaissance}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], dateNaissance: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Lieu de naissance</Label>
                                <Input
                                  value={indivisaire.lieuNaissance}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], lieuNaissance: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Nationalité</Label>
                                <Input
                                  value={indivisaire.nationalite}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], nationalite: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Profession</Label>
                                <Input
                                  value={indivisaire.profession}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], profession: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Email</Label>
                                <Input
                                  type="email"
                                  value={indivisaire.email}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], email: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Téléphone</Label>
                                <Input
                                  value={indivisaire.telephone}
                                  onChange={(e) => {
                                    const newIndivisaires = [...indivisionData.indivisaires];
                                    const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                    newIndivisaires[idx] = {...newIndivisaires[idx], telephone: e.target.value};
                                    setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                  }}
                                />
                              </div>
                            </>
                          )}

                          {/* Situation familiale */}
                          <div className="space-y-2">
                            <Label>Situation familiale</Label>
                            <Input
                              value={indivisaire.situationFamiliale}
                              onChange={(e) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {...newIndivisaires[idx], situationFamiliale: e.target.value};
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                              placeholder="Ex: Célibataire, Marié, Divorcé..."
                            />
                          </div>

                          {indivisaire.situationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => indivisaire.situationFamiliale.toLowerCase().includes(term)) && (
                            <div className="space-y-2">
                              <Label>Régime matrimonial</Label>
                              <Input
                                value={indivisaire.regimeMatrimonial}
                                onChange={(e) => {
                                  const newIndivisaires = [...indivisionData.indivisaires];
                                  const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                  newIndivisaires[idx] = {...newIndivisaires[idx], regimeMatrimonial: e.target.value};
                                  setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                }}
                                placeholder="Ex: Communauté légale, Séparation de biens..."
                              />
                            </div>
                          )}

                          {/* Quote-part */}
                          <div className="space-y-2">
                            <Label>Quote-part (%) *</Label>
                            <Input
                              type="number"
                              min="0"
                              max="100"
                              value={indivisaire.quotePart}
                              onChange={(e) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {...newIndivisaires[idx], quotePart: e.target.value};
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                              placeholder="Ex: 50"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Origine de la quote-part</Label>
                            <Select
                              value={indivisaire.origineQuotePart}
                              onValueChange={(value) => {
                                const newIndivisaires = [...indivisionData.indivisaires];
                                const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                newIndivisaires[idx] = {...newIndivisaires[idx], origineQuotePart: value};
                                setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="heritage">Héritage</SelectItem>
                                <SelectItem value="achat">Achat</SelectItem>
                                <SelectItem value="donation">Donation</SelectItem>
                                <SelectItem value="succession">Succession</SelectItem>
                                <SelectItem value="investissement">Investissement</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          {indivisaire.origineQuotePart === "autre" && (
                            <div className="space-y-2">
                              <Label>Préciser l'origine</Label>
                              <Input
                                value={indivisaire.origineQuotePartAutre || ""}
                                onChange={(e) => {
                                  const newIndivisaires = [...indivisionData.indivisaires];
                                  const idx = newIndivisaires.findIndex(i => i.id === indivisaire.id);
                                  newIndivisaires[idx] = {...newIndivisaires[idx], origineQuotePartAutre: e.target.value};
                                  setIndivisionData({...indivisionData, indivisaires: newIndivisaires});
                                }}
                                placeholder="Ex: Partage amiable..."
                              />
                            </div>
                          )}

                          {/* Upload pièces jointes pour cet indivisaire */}
                          {!indivisaire.isClient && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>📎 Pièce d'identité</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                                <input
                                  type="file"
                                  accept="application/pdf,image/*"
                                  multiple
                                  className="hidden"
                                  id={`indiv_${indivisaire.id}_id_upload`}
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    if (files.length > 0) {
                                      setIndivisairesIdentiteFiles(prev => ({...prev, [indivisaire.id]: files}));
                                      toast.success(`${files.length} fichier(s) ajouté(s)`);
                                    }
                                    e.target.value = '';
                                  }}
                                />
                                <label htmlFor={`indiv_${indivisaire.id}_id_upload`} className="cursor-pointer flex items-center gap-3">
                                  <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                    <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2" />
                                    </svg>
                                  </div>
                                  <div className="flex-1">
                                    <p className="text-sm font-medium">Joindre la pièce d'identité</p>
                                    <p className="text-xs text-muted-foreground">PDF ou images</p>
                                  </div>
                                </label>
                              </div>
                              {indivisairesIdentiteFiles[indivisaire.id]?.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {indivisairesIdentiteFiles[indivisaire.id].map((file, idx) => (
                                  <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      onClick={() => {
                                        setIndivisairesIdentiteFiles(prev => ({
                                          ...prev,
                                          [indivisaire.id]: prev[indivisaire.id].filter((_, i) => i !== idx)
                                        }));
                                        toast.success('Fichier supprimé');
                                      }}
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                          )}

                          {/* Affichage de la carte d'identité chargée depuis le client */}
                          {indivisaire.isClient && indivisairesIdentiteFiles[indivisaire.id]?.length > 0 && (
                            <div className="space-y-2 md:col-span-2">
                              <div className="flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg">
                                <svg className="w-5 h-5 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <div className="flex-1">
                                  <p className="text-sm font-medium text-green-800">✓ Pièce d'identité chargée depuis la fiche client</p>
                                  <p className="text-xs text-green-700 mt-1">
                                    {indivisairesIdentiteFiles[indivisaire.id].map((file, idx) => file.name).join(', ')}
                                  </p>
                                </div>
                              </div>
                            </div>
                          )}

                          {/* Upload justificatif de domicile */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Justificatif de domicile</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf,image/*"
                                multiple
                                className="hidden"
                                id={`indiv_${indivisaire.id}_domicile_upload`}
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  if (files.length > 0) {
                                    setIndivisairesDomicileFiles(prev => ({...prev, [indivisaire.id]: files}));
                                    toast.success(`${files.length} fichier(s) ajouté(s)`);
                                  }
                                  e.target.value = '';
                                }}
                              />
                              <label htmlFor={`indiv_${indivisaire.id}_domicile_upload`} className="cursor-pointer flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                  <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                  </svg>
                                </div>
                                <div className="flex-1">
                                  <p className="text-sm font-medium">Joindre le justificatif de domicile</p>
                                  <p className="text-xs text-muted-foreground">Facture, quittance de loyer, etc.</p>
                                </div>
                              </label>
                            </div>
                            {indivisairesDomicileFiles[indivisaire.id]?.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {indivisairesDomicileFiles[indivisaire.id].map((file, idx) => (
                                  <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      onClick={() => {
                                        setIndivisairesDomicileFiles(prev => ({
                                          ...prev,
                                          [indivisaire.id]: prev[indivisaire.id].filter((_, i) => i !== idx)
                                        }));
                                        toast.success('Fichier supprimé');
                                      }}
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>

                          {/* Upload contrat de mariage si marié */}
                          {indivisaire.statutMatrimonial === "marie" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>📎 Contrat de mariage (si applicable)</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id={`indiv_${indivisaire.id}_contrat_mariage_upload`}
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    if (files.length > 0) {
                                      setIndivisairesContratMariageFiles(prev => ({...prev, [indivisaire.id]: files}));
                                      toast.success(`${files.length} fichier(s) ajouté(s)`);
                                    }
                                    e.target.value = '';
                                  }}
                                />
                                <label htmlFor={`indiv_${indivisaire.id}_contrat_mariage_upload`} className="cursor-pointer flex items-center gap-3">
                                  <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                    <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                  </div>
                                  <div className="flex-1">
                                    <p className="text-sm font-medium">Joindre le contrat de mariage</p>
                                    <p className="text-xs text-muted-foreground">PDF uniquement</p>
                                  </div>
                                </label>
                              </div>
                              {indivisairesContratMariageFiles[indivisaire.id]?.length > 0 && (
                                <div className="space-y-2 mt-2">
                                  {indivisairesContratMariageFiles[indivisaire.id].map((file, idx) => (
                                    <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                      <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                      </svg>
                                      <span className="text-sm flex-1 truncate">{file.name}</span>
                                      <Button
                                        type="button"
                                        variant="ghost"
                                        size="sm"
                                        className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                        onClick={() => {
                                          setIndivisairesContratMariageFiles(prev => ({
                                            ...prev,
                                            [indivisaire.id]: prev[indivisaire.id].filter((_, i) => i !== idx)
                                          }));
                                          toast.success('Fichier supprimé');
                                        }}
                                      >
                                        <Trash2 className="w-4 h-4" />
                                      </Button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          )}

                          {/* Upload livret de famille si succession */}
                          {indivisionData.origine === "succession" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>📎 Livret de famille (si succession)</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                                <input
                                  type="file"
                                  accept="application/pdf,image/*"
                                  multiple
                                  className="hidden"
                                  id={`indiv_${indivisaire.id}_livret_famille_upload`}
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    if (files.length > 0) {
                                      setIndivisairesLivretFamilleFiles(prev => ({...prev, [indivisaire.id]: files}));
                                      toast.success(`${files.length} fichier(s) ajouté(s)`);
                                    }
                                    e.target.value = '';
                                  }}
                                />
                                <label htmlFor={`indiv_${indivisaire.id}_livret_famille_upload`} className="cursor-pointer flex items-center gap-3">
                                  <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                    <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                    </svg>
                                  </div>
                                  <div className="flex-1">
                                    <p className="text-sm font-medium">Joindre le livret de famille</p>
                                    <p className="text-xs text-muted-foreground">PDF ou images</p>
                                  </div>
                                </label>
                              </div>
                              {indivisairesLivretFamilleFiles[indivisaire.id]?.length > 0 && (
                                <div className="space-y-2 mt-2">
                                  {indivisairesLivretFamilleFiles[indivisaire.id].map((file, idx) => (
                                    <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                      <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                      </svg>
                                      <span className="text-sm flex-1 truncate">{file.name}</span>
                                      <Button
                                        type="button"
                                        variant="ghost"
                                        size="sm"
                                        className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                        onClick={() => {
                                          setIndivisairesLivretFamilleFiles(prev => ({
                                            ...prev,
                                            [indivisaire.id]: prev[indivisaire.id].filter((_, i) => i !== idx)
                                          }));
                                          toast.success('Fichier supprimé');
                                        }}
                                      >
                                        <Trash2 className="w-4 h-4" />
                                      </Button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 3. Description du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏠 Description du bien indivis</h3>
                    
                    {indivisionData.description.typeBien === "immobilier" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Adresse complète *</Label>
                          <Input
                            value={indivisionData.description.immobilier.adresse}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, adresse: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Nature du bien *</Label>
                          <Select
                            value={indivisionData.description.immobilier.nature}
                            onValueChange={(value) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, nature: value}
                              }
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="maison">Maison</SelectItem>
                              <SelectItem value="appartement">Appartement</SelectItem>
                              <SelectItem value="terrain">Terrain</SelectItem>
                              <SelectItem value="immeuble">Immeuble</SelectItem>
                              <SelectItem value="local_commercial">Local commercial</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Surface (m²)</Label>
                          <Input
                            type="number"
                            value={indivisionData.description.immobilier.surface}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, surface: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Description détaillée</Label>
                          <Textarea
                            rows={3}
                            value={indivisionData.description.immobilier.description}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, description: e.target.value}
                              }
                            })}
                            placeholder="Description du bien..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>État locatif</Label>
                          <Select
                            value={indivisionData.description.immobilier.etatLocatif}
                            onValueChange={(value) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, etatLocatif: value}
                              }
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="libre">Libre</SelectItem>
                              <SelectItem value="loue">Loué</SelectItem>
                              <SelectItem value="occupe">Occupé par un indivisaire</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        {indivisionData.description.immobilier.etatLocatif === "loue" && (
                          <div className="space-y-2">
                            <Label>Loyer mensuel (€)</Label>
                            <Input
                              type="number"
                              value={indivisionData.description.immobilier.loyer}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                description: {
                                  ...indivisionData.description,
                                  immobilier: {...indivisionData.description.immobilier, loyer: e.target.value}
                                }
                              })}
                            />
                          </div>
                        )}
                        <div className="space-y-2">
                          <Label>Valeur vénale estimée (€)</Label>
                          <Input
                            type="number"
                            value={indivisionData.description.immobilier.valeurVenale}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, valeurVenale: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Références cadastrales</Label>
                          <Input
                            value={indivisionData.description.immobilier.cadastre}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                immobilier: {...indivisionData.description.immobilier, cadastre: e.target.value}
                              }
                            })}
                            placeholder="Ex: Section AB n° 123"
                          />
                        </div>

                        {/* Uploads pour bien immobilier */}
                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Titre de propriété *</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="titre_propriete_upload"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                if (files.length > 0) {
                                  setIndivisionTitreProprietFiles(files);
                                  toast.success(`${files.length} fichier(s) ajouté(s)`);
                                }
                                e.target.value = '';
                              }}
                            />
                            <label htmlFor="titre_propriete_upload" className="cursor-pointer flex items-center gap-3">
                              <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">Joindre le titre de propriété</p>
                                <p className="text-xs text-muted-foreground">Acte notarié, attestation immobilière...</p>
                              </div>
                            </label>
                          </div>
                          {indivisionTitreProprietFiles.length > 0 && (
                            <div className="space-y-2 mt-2">
                              {indivisionTitreProprietFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                  <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                  <span className="text-sm flex-1 truncate">{file.name}</span>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={() => {
                                      setIndivisionTitreProprietFiles(indivisionTitreProprietFiles.filter((_, i) => i !== idx));
                                      toast.success('Fichier supprimé');
                                    }}
                                  >
                                    <Trash2 className="w-4 h-4" />
                                  </Button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Évaluation du bien</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="evaluation_upload"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                if (files.length > 0) {
                                  setIndivisionEvaluationFiles(files);
                                  toast.success(`${files.length} fichier(s) ajouté(s)`);
                                }
                                e.target.value = '';
                              }}
                            />
                            <label htmlFor="evaluation_upload" className="cursor-pointer flex items-center gap-3">
                              <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                </svg>
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">Joindre l'évaluation du bien</p>
                                <p className="text-xs text-muted-foreground">Rapport d'expert, estimation notariale...</p>
                              </div>
                            </label>
                          </div>
                          {indivisionEvaluationFiles.length > 0 && (
                            <div className="space-y-2 mt-2">
                              {indivisionEvaluationFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                  <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                  <span className="text-sm flex-1 truncate">{file.name}</span>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={() => {
                                      setIndivisionEvaluationFiles(indivisionEvaluationFiles.filter((_, i) => i !== idx));
                                      toast.success('Fichier supprimé');
                                    }}
                                  >
                                    <Trash2 className="w-4 h-4" />
                                  </Button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Plan cadastral</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="cadastre_upload"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                if (files.length > 0) {
                                  setIndivisionCadastreFiles(files);
                                  toast.success(`${files.length} fichier(s) ajouté(s)`);
                                }
                                e.target.value = '';
                              }}
                            />
                            <label htmlFor="cadastre_upload" className="cursor-pointer flex items-center gap-3">
                              <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                                </svg>
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">Joindre le plan cadastral</p>
                                <p className="text-xs text-muted-foreground">PDF ou images</p>
                              </div>
                            </label>
                          </div>
                          {indivisionCadastreFiles.length > 0 && (
                            <div className="space-y-2 mt-2">
                              {indivisionCadastreFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                  <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                  <span className="text-sm flex-1 truncate">{file.name}</span>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={() => {
                                      setIndivisionCadastreFiles(indivisionCadastreFiles.filter((_, i) => i !== idx));
                                      toast.success('Fichier supprimé');
                                    }}
                                  >
                                    <Trash2 className="w-4 h-4" />
                                  </Button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Diagnostics techniques</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="diagnostics_upload"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                if (files.length > 0) {
                                  setIndivisionDiagnosticsFiles(files);
                                  toast.success(`${files.length} fichier(s) ajouté(s)`);
                                }
                                e.target.value = '';
                              }}
                            />
                            <label htmlFor="diagnostics_upload" className="cursor-pointer flex items-center gap-3">
                              <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                                </svg>
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">Joindre les diagnostics</p>
                                <p className="text-xs text-muted-foreground">DPE, amiante, plomb, termites...</p>
                              </div>
                            </label>
                          </div>
                          {indivisionDiagnosticsFiles.length > 0 && (
                            <div className="space-y-2 mt-2">
                              {indivisionDiagnosticsFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                  <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                  <span className="text-sm flex-1 truncate">{file.name}</span>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={() => {
                                      setIndivisionDiagnosticsFiles(indivisionDiagnosticsFiles.filter((_, i) => i !== idx));
                                      toast.success('Fichier supprimé');
                                    }}
                                  >
                                    <Trash2 className="w-4 h-4" />
                                  </Button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>

                        {indivisionData.description.immobilier.etatLocatif === "loue" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Bail en cours</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="bail_upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  if (files.length > 0) {
                                    setIndivisionBailFiles(files);
                                    toast.success(`${files.length} fichier(s) ajouté(s)`);
                                  }
                                  e.target.value = '';
                                }}
                              />
                              <label htmlFor="bail_upload" className="cursor-pointer flex items-center gap-3">
                                <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                  <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                </div>
                                <div className="flex-1">
                                  <p className="text-sm font-medium">Joindre le bail</p>
                                  <p className="text-xs text-muted-foreground">PDF uniquement</p>
                                </div>
                              </label>
                            </div>
                            {indivisionBailFiles.length > 0 && (
                              <div className="space-y-2 mt-2">
                                {indivisionBailFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                    <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                    <span className="text-sm flex-1 truncate">{file.name}</span>
                                    <Button
                                      type="button"
                                      variant="ghost"
                                      size="sm"
                                      className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                      onClick={() => {
                                        setIndivisionBailFiles(indivisionBailFiles.filter((_, i) => i !== idx));
                                        toast.success('Fichier supprimé');
                                      }}
                                    >
                                      <Trash2 className="w-4 h-4" />
                                    </Button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    )}

                    {indivisionData.description.typeBien === "mobilier" && (
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Description des biens mobiliers *</Label>
                          <Textarea
                            rows={4}
                            value={indivisionData.description.mobilier.description}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                mobilier: {...indivisionData.description.mobilier, description: e.target.value}
                              }
                            })}
                            placeholder="Description détaillée des biens mobiliers..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Valeur estimée (€)</Label>
                          <Input
                            type="number"
                            value={indivisionData.description.mobilier.valeurEstimee}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                mobilier: {...indivisionData.description.mobilier, valeurEstimee: e.target.value}
                              }
                            })}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéros de série / identifiants</Label>
                          <Input
                            value={indivisionData.description.mobilier.numerosIdentification}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              description: {
                                ...indivisionData.description,
                                mobilier: {...indivisionData.description.mobilier, numerosIdentification: e.target.value}
                              }
                            })}
                            placeholder="Si applicable"
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 4. Durée de la convention */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⏱️ Durée de la convention</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de durée *</Label>
                        <RadioGroup
                          value={indivisionData.duree.type}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            duree: {...indivisionData.duree, type: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="indeterminee" id="duree_indeterminee" />
                              <Label htmlFor="duree_indeterminee" className="cursor-pointer">Indéterminée</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="determinee" id="duree_determinee" />
                              <Label htmlFor="duree_determinee" className="cursor-pointer">Déterminée (max 5 ans)</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.duree.type === "determinee" && (
                        <div className="space-y-2">
                          <Label>Durée (en années) *</Label>
                          <Input
                            type="number"
                            min="1"
                            max="5"
                            value={indivisionData.duree.annees}
                            onChange={(e) => setIndivisionData({
                              ...indivisionData,
                              duree: {...indivisionData.duree, annees: e.target.value}
                            })}
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Conditions de renouvellement</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.duree.conditionsRenouvellement}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            duree: {...indivisionData.duree, conditionsRenouvellement: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Conditions de sortie anticipée</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.duree.conditionsSortie}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            duree: {...indivisionData.duree, conditionsSortie: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 5. Gestion de l'indivision */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⚙️ Gestion de l'indivision</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Gérant désigné</Label>
                        <Input
                          value={indivisionData.gestion.gerant}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, gerant: e.target.value}
                          })}
                          placeholder="Nom du gérant (peut être un indivisaire ou une personne externe)"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Pouvoirs du gérant</Label>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_gestion"
                              checked={indivisionData.gestion.pouvoirs.gestion_courante}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, gestion_courante: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_gestion" className="cursor-pointer">Gestion courante</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_travaux"
                              checked={indivisionData.gestion.pouvoirs.travaux}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, travaux: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_travaux" className="cursor-pointer">Autorisation des travaux</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_representation"
                              checked={indivisionData.gestion.pouvoirs.representation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, representation: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_representation" className="cursor-pointer">Représentation de l'indivision</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="pouvoir_signature"
                              checked={indivisionData.gestion.pouvoirs.signature_actes}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                gestion: {
                                  ...indivisionData.gestion,
                                  pouvoirs: {...indivisionData.gestion.pouvoirs, signature_actes: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="pouvoir_signature" className="cursor-pointer">Signature d'actes au nom de l'indivision</Label>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Type de décisions *</Label>
                        <Select
                          value={indivisionData.gestion.decisions}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, decisions: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Unanimité</SelectItem>
                            <SelectItem value="majorite_2_3">Majorité des 2/3</SelectItem>
                            <SelectItem value="majorite_simple">Majorité simple</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des charges</Label>
                        <Input
                          value={indivisionData.gestion.charges}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, charges: e.target.value}
                          })}
                          placeholder="Ex: Proportionnellement aux quote-parts"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des dépenses exceptionnelles</Label>
                        <Input
                          value={indivisionData.gestion.repartitionDepensesExceptionnelles}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, repartitionDepensesExceptionnelles: e.target.value}
                          })}
                          placeholder="Ex: Gros travaux, sinistres, procédures..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des revenus tirés du bien</Label>
                        <Input
                          value={indivisionData.gestion.repartitionRevenus}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, repartitionRevenus: e.target.value}
                          })}
                          placeholder="Ex: Loyers, indemnités d'occupation, revenus divers..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Compte bancaire dédié</Label>
                        <Input
                          value={indivisionData.gestion.compteBancaire}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            gestion: {...indivisionData.gestion, compteBancaire: e.target.value}
                          })}
                          placeholder="Coordonnées du compte (IBAN, nom de la banque...)"
                        />
                      </div>

                      {/* Upload mandat du gérant */}
                      {indivisionData.gestion.gerant && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>📎 Mandat du gérant</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="mandat_gerant_upload"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                if (files.length > 0) {
                                  setIndivisionMandatGerantFiles(files);
                                  toast.success(`${files.length} fichier(s) ajouté(s)`);
                                }
                                e.target.value = '';
                              }}
                            />
                            <label htmlFor="mandat_gerant_upload" className="cursor-pointer flex items-center gap-3">
                              <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                                <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                              </div>
                              <div className="flex-1">
                                <p className="text-sm font-medium">Joindre le mandat du gérant</p>
                                <p className="text-xs text-muted-foreground">PDF uniquement</p>
                              </div>
                            </label>
                          </div>
                          {indivisionMandatGerantFiles.length > 0 && (
                            <div className="space-y-2 mt-2">
                              {indivisionMandatGerantFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                  <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                  </svg>
                                  <span className="text-sm flex-1 truncate">{file.name}</span>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                    onClick={() => {
                                      setIndivisionMandatGerantFiles(indivisionMandatGerantFiles.filter((_, i) => i !== idx));
                                      toast.success('Fichier supprimé');
                                    }}
                                  >
                                    <Trash2 className="w-4 h-4" />
                                  </Button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 6. Utilisation du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🔑 Utilisation du bien</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Utilisation par les indivisaires</Label>
                        <RadioGroup
                          value={indivisionData.utilisation.utilisationParIndivisaires}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            utilisation: {...indivisionData.utilisation, utilisationParIndivisaires: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="util_oui" />
                              <Label htmlFor="util_oui" className="cursor-pointer">Autorisée</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="util_non" />
                              <Label htmlFor="util_non" className="cursor-pointer">Non autorisée</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.utilisation.utilisationParIndivisaires === "oui" && (
                        <>
                          <div className="space-y-2 md:col-span-2">
                            <Label>Conditions d'utilisation</Label>
                            <Textarea
                              rows={2}
                              value={indivisionData.utilisation.conditionsUtilisation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, conditionsUtilisation: e.target.value}
                              })}
                              placeholder="Préciser les conditions..."
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Indemnité d'occupation (clause centrale)</Label>
                            <RadioGroup
                              value={indivisionData.utilisation.indemniteOccupation}
                              onValueChange={(value) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, indemniteOccupation: value}
                              })}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id="indem_oui" />
                                  <Label htmlFor="indem_oui" className="cursor-pointer">Oui, indemnité obligatoire</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id="indem_non" />
                                  <Label htmlFor="indem_non" className="cursor-pointer">Non, aucune indemnité</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="conditions" id="indem_cond" />
                                  <Label htmlFor="indem_cond" className="cursor-pointer">Selon conditions</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {(indivisionData.utilisation.indemniteOccupation === "oui" || indivisionData.utilisation.indemniteOccupation === "conditions") && (
                            <>
                              <div className="space-y-2">
                                <Label>Montant de l'indemnité d'occupation (€)</Label>
                                <Input
                                  type="number"
                                  value={indivisionData.utilisation.indemniteOccupationMontant}
                                  onChange={(e) => setIndivisionData({
                                    ...indivisionData,
                                    utilisation: {...indivisionData.utilisation, indemniteOccupationMontant: e.target.value}
                                  })}
                                  placeholder="Montant mensuel ou annuel"
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Fréquence de l'indemnité</Label>
                                <Select
                                  value={indivisionData.utilisation.indemniteFrequence}
                                  onValueChange={(value) => setIndivisionData({
                                    ...indivisionData,
                                    utilisation: {...indivisionData.utilisation, indemniteFrequence: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="mensuelle">Mensuelle</SelectItem>
                                    <SelectItem value="trimestrielle">Trimestrielle</SelectItem>
                                    <SelectItem value="annuelle">Annuelle</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </>
                          )}

                          {indivisionData.utilisation.indemniteOccupation === "conditions" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Conditions pour l'indemnité d'occupation</Label>
                              <Textarea
                                rows={2}
                                value={indivisionData.utilisation.indemniteOccupationConditions}
                                onChange={(e) => setIndivisionData({
                                  ...indivisionData,
                                  utilisation: {...indivisionData.utilisation, indemniteOccupationConditions: e.target.value}
                                })}
                                placeholder="Ex: Indemnité due uniquement si occupation exclusive pendant plus de 6 mois..."
                              />
                            </div>
                          )}
                        </>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Location autorisée</Label>
                        <RadioGroup
                          value={indivisionData.utilisation.locationAutorisee}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            utilisation: {...indivisionData.utilisation, locationAutorisee: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="location_oui" />
                              <Label htmlFor="location_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="location_non" />
                              <Label htmlFor="location_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.utilisation.locationAutorisee === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Mandataire pour la location</Label>
                            <Input
                              value={indivisionData.utilisation.mandataireLocation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, mandataireLocation: e.target.value}
                              })}
                              placeholder="Nom du mandataire"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Répartition des loyers</Label>
                            <Input
                              value={indivisionData.utilisation.repartitionLoyers}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                utilisation: {...indivisionData.utilisation, repartitionLoyers: e.target.value}
                              })}
                              placeholder="Ex: Proportionnellement aux quote-parts"
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 7. Travaux et améliorations */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🔨 Travaux et améliorations</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Types de travaux autorisés</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.travaux.typesAutorises}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, typesAutorises: e.target.value}
                          })}
                          placeholder="Préciser les types de travaux..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Décision requise *</Label>
                        <Select
                          value={indivisionData.travaux.decisionRequise}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, decisionRequise: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Unanimité</SelectItem>
                            <SelectItem value="majorite_2_3">Majorité des 2/3</SelectItem>
                            <SelectItem value="majorite_simple">Majorité simple</SelectItem>
                            <SelectItem value="gerant">Décision du gérant</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition des coûts</Label>
                        <Input
                          value={indivisionData.travaux.repartitionCouts}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, repartitionCouts: e.target.value}
                          })}
                          placeholder="Ex: Proportionnellement aux quote-parts"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Travaux urgents (procédure)</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.travaux.travauxUrgents}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, travauxUrgents: e.target.value}
                          })}
                          placeholder="Procédure en cas de travaux urgents..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Exigences de documentation</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.travaux.documentation}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            travaux: {...indivisionData.travaux, documentation: e.target.value}
                          })}
                          placeholder="Préciser les documents requis (devis, factures, autorisations...)..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 8. Sortie d'un indivisaire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🚪 Sortie d'un indivisaire</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de vente de la part *</Label>
                        <RadioGroup
                          value={indivisionData.sortie.venteLibre}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, venteLibre: value}
                          })}
                        >
                          <div className="flex flex-col gap-2">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="libre" id="vente_libre" />
                              <Label htmlFor="vente_libre" className="cursor-pointer">Vente libre</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="droit_preemption" id="vente_preemption" />
                              <Label htmlFor="vente_preemption" className="cursor-pointer">Droit de préemption des autres indivisaires</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      <div className="space-y-2">
                        <Label>Évaluation de la part *</Label>
                        <Select
                          value={indivisionData.sortie.evaluationPart}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, evaluationPart: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="gerant">Par le gérant</SelectItem>
                            <SelectItem value="accord_indivisaires">Accord des indivisaires</SelectItem>
                            <SelectItem value="expert">Expert indépendant</SelectItem>
                            <SelectItem value="juge">Décision du juge</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Délai de rachat (jours)</Label>
                        <Input
                          type="number"
                          value={indivisionData.sortie.delaiRachat}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, delaiRachat: e.target.value}
                          })}
                          placeholder="Ex: 60"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de paiement</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.sortie.modalitesPaiement}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            sortie: {...indivisionData.sortie, modalitesPaiement: e.target.value}
                          })}
                          placeholder="Préciser les conditions de paiement..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 9. Vente du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💰 Vente du bien</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Conditions de mise en vente</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.vente.conditionsMiseEnVente}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, conditionsMiseEnVente: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Décision requise *</Label>
                        <Select
                          value={indivisionData.vente.decisionRequise}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, decisionRequise: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="unanimite">Unanimité</SelectItem>
                            <SelectItem value="majorite_2_3">Majorité des 2/3</SelectItem>
                            <SelectItem value="majorite_simple">Majorité simple</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Mandataire pour la vente</Label>
                        <Input
                          value={indivisionData.vente.mandataire}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, mandataire: e.target.value}
                          })}
                          placeholder="Nom du mandataire"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Répartition du prix de vente</Label>
                        <Input
                          value={indivisionData.vente.repartitionPrix}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, repartitionPrix: e.target.value}
                          })}
                          placeholder="Ex: Proportionnellement aux quote-parts"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Gestion des plus-values</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.vente.gestionPlusValues}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            vente: {...indivisionData.vente, gestionPlusValues: e.target.value}
                          })}
                          placeholder="Préciser la gestion fiscale et la répartition..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 10. Comptabilité */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📊 Comptabilité</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Tenue d'un registre des dépenses</Label>
                        <RadioGroup
                          value={indivisionData.comptabilite.registreDepenses}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, registreDepenses: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="registre_oui" />
                              <Label htmlFor="registre_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="registre_non" />
                              <Label htmlFor="registre_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Archivage des factures et justificatifs</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.comptabilite.archivageFactures}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, archivageFactures: e.target.value}
                          })}
                          placeholder="Modalités d'archivage..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Modalités de remboursement des avances</Label>
                        <Textarea
                          rows={2}
                          value={indivisionData.comptabilite.remboursementAvances}
                          onChange={(e) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, remboursementAvances: e.target.value}
                          })}
                          placeholder="Préciser les conditions..."
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Rapport annuel de gestion</Label>
                        <RadioGroup
                          value={indivisionData.comptabilite.rapportAnnuel}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            comptabilite: {...indivisionData.comptabilite, rapportAnnuel: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="rapport_oui" />
                              <Label htmlFor="rapport_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="rapport_non" />
                              <Label htmlFor="rapport_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>
                    </div>
                  </div>

                  {/* 11. Litiges */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⚖️ Règlement des litiges</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Modes de résolution des litiges</Label>
                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="litige_mediation"
                              checked={indivisionData.litiges.modesResolution.mediation}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                litiges: {
                                  ...indivisionData.litiges,
                                  modesResolution: {...indivisionData.litiges.modesResolution, mediation: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="litige_mediation" className="cursor-pointer">Médiation</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="litige_arbitrage"
                              checked={indivisionData.litiges.modesResolution.arbitrage}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                litiges: {
                                  ...indivisionData.litiges,
                                  modesResolution: {...indivisionData.litiges.modesResolution, arbitrage: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="litige_arbitrage" className="cursor-pointer">Arbitrage</Label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="litige_tribunal"
                              checked={indivisionData.litiges.modesResolution.tribunal}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                litiges: {
                                  ...indivisionData.litiges,
                                  modesResolution: {...indivisionData.litiges.modesResolution, tribunal: e.target.checked}
                                }
                              })}
                              className="rounded border-gray-300"
                            />
                            <Label htmlFor="litige_tribunal" className="cursor-pointer">Tribunal compétent</Label>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Clause de solidarité pour les dettes</Label>
                        <RadioGroup
                          value={indivisionData.litiges.solidariteDettes}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            litiges: {...indivisionData.litiges, solidariteDettes: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="solidarite_oui" />
                              <Label htmlFor="solidarite_oui" className="cursor-pointer">Oui (indivisaires solidaires)</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="solidarite_non" />
                              <Label htmlFor="solidarite_non" className="cursor-pointer">Non (chacun à hauteur de sa quote-part)</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>
                    </div>
                  </div>

                  {/* 12. Assurance du bien indivis */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🛡️ Assurance du bien indivis</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Assurance obligatoire</Label>
                        <RadioGroup
                          value={indivisionData.assurance.assuranceObligatoire}
                          onValueChange={(value) => setIndivisionData({
                            ...indivisionData,
                            assurance: {...indivisionData.assurance, assuranceObligatoire: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="assur_oui" />
                              <Label htmlFor="assur_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="assur_non" />
                              <Label htmlFor="assur_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {indivisionData.assurance.assuranceObligatoire === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Nom de l'assureur</Label>
                            <Input
                              value={indivisionData.assurance.nomAssureur}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, nomAssureur: e.target.value}
                              })}
                              placeholder="Ex: AXA, MAIF, Allianz..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de police d'assurance</Label>
                            <Input
                              value={indivisionData.assurance.numeroPolice}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, numeroPolice: e.target.value}
                              })}
                              placeholder="Numéro de contrat"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Répartition de la prime d'assurance</Label>
                            <Input
                              value={indivisionData.assurance.repartitionPrime}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, repartitionPrime: e.target.value}
                              })}
                              placeholder="Ex: Proportionnellement aux quote-parts"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'échéance</Label>
                            <Input
                              type="date"
                              value={indivisionData.assurance.dateEcheance}
                              onChange={(e) => setIndivisionData({
                                ...indivisionData,
                                assurance: {...indivisionData.assurance, dateEcheance: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Attestation d'assurance</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="indivision_assurance_upload"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setIndivisionAssuranceFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="indivision_assurance_upload" className="cursor-pointer">
                                <div className="flex items-center gap-2 text-sm text-muted-foreground">
                                  <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                  </svg>
                                  <div>
                                    <div className="font-medium text-foreground">Cliquez pour joindre l'attestation d'assurance</div>
                                    <div className="text-xs">PDF uniquement</div>
                                  </div>
                                </div>
                              </label>
                              {indivisionAssuranceFiles.length > 0 && (
                                <div className="mt-3 space-y-2">
                                  {indivisionAssuranceFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between p-2 bg-muted rounded">
                                      <span className="text-sm">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setIndivisionAssuranceFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 hover:text-red-800 text-sm"
                                      >
                                        Supprimer
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 13. Procurations et documents complémentaires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📎 Procurations et documents complémentaires</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Procurations (si applicable)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-4 hover:border-muted-foreground/50 transition-colors">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="procurations_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              if (files.length > 0) {
                                setIndivisionProcurationFiles(files);
                                toast.success(`${files.length} fichier(s) ajouté(s)`);
                              }
                              e.target.value = '';
                            }}
                          />
                          <label htmlFor="procurations_upload" className="cursor-pointer flex items-center gap-3">
                            <div className="w-10 h-10 rounded bg-primary/10 flex items-center justify-center flex-shrink-0">
                              <svg className="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                              </svg>
                            </div>
                            <div className="flex-1">
                              <p className="text-sm font-medium">Joindre les procurations</p>
                              <p className="text-xs text-muted-foreground">Si un indivisaire est représenté</p>
                            </div>
                          </label>
                        </div>
                        {indivisionProcurationFiles.length > 0 && (
                          <div className="space-y-2 mt-2">
                            {indivisionProcurationFiles.map((file, idx) => (
                              <div key={idx} className="flex items-center gap-2 p-2 bg-muted/50 rounded-lg">
                                <svg className="w-4 h-4 text-muted-foreground flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <span className="text-sm flex-1 truncate">{file.name}</span>
                                <Button
                                  type="button"
                                  variant="ghost"
                                  size="sm"
                                  className="text-red-600 hover:text-red-700 hover:bg-red-50"
                                  onClick={() => {
                                    setIndivisionProcurationFiles(indivisionProcurationFiles.filter((_, i) => i !== idx));
                                    toast.success('Fichier supprimé');
                                  }}
                                >
                                  <Trash2 className="w-4 h-4" />
                                </Button>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Mainlevée d'hypothèque */}
            {pendingContractType === "Mainlevée d'hypothèque" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1. Informations générales sur l'hypothèque */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 Informations générales sur l'hypothèque</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Type de mainlevée *</Label>
                        <Select 
                          value={mainleveeData.typeMainlevee} 
                          onValueChange={(value) => setMainleveeData({...mainleveeData, typeMainlevee: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="totale">Mainlevée totale</SelectItem>
                            <SelectItem value="partielle">Mainlevée partielle</SelectItem>
                            <SelectItem value="renonciation">Renonciation à l'inscription</SelectItem>
                            <SelectItem value="substitution">Substitution</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {mainleveeData.typeMainlevee === "partielle" && (
                        <div className="space-y-2">
                          <Label>Précision sur la mainlevée partielle</Label>
                          <Input
                            value={mainleveeData.precisionPartielle}
                            onChange={(e) => setMainleveeData({...mainleveeData, precisionPartielle: e.target.value})}
                            placeholder="Ex: Sur le lot n°2 uniquement..."
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Nature de l'inscription à radier *</Label>
                        <Select 
                          value={mainleveeData.natureInscription} 
                          onValueChange={(value) => setMainleveeData({...mainleveeData, natureInscription: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="hypotheque_conventionnelle">Hypothèque conventionnelle</SelectItem>
                            <SelectItem value="hypotheque_legale">Hypothèque légale</SelectItem>
                            <SelectItem value="hypotheque_judiciaire">Hypothèque judiciaire</SelectItem>
                            <SelectItem value="privilege_ppd">Privilège de prêteur de deniers (PPD)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro d'inscription hypothécaire *</Label>
                        <Input
                          value={mainleveeData.numeroInscription}
                          onChange={(e) => setMainleveeData({...mainleveeData, numeroInscription: e.target.value})}
                          placeholder="Numéro exact au SPF"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de l'inscription</Label>
                        <Input
                          type="date"
                          value={mainleveeData.dateInscription}
                          onChange={(e) => setMainleveeData({...mainleveeData, dateInscription: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Volume / Numéro d'ordre (ancien format)</Label>
                        <Input
                          value={mainleveeData.volumeNumero}
                          onChange={(e) => setMainleveeData({...mainleveeData, volumeNumero: e.target.value})}
                          placeholder="Volume X, n° Y"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Référence partenaire bancaire</Label>
                        <Input
                          value={mainleveeData.referencePartenaire}
                          onChange={(e) => setMainleveeData({...mainleveeData, referencePartenaire: e.target.value})}
                          placeholder="Facultatif"
                        />
                      </div>
                    </div>
                  </div>

                  {/* 2. Identité du créancier */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏦 Identité du créancier (donneur de mainlevée)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de créancier *</Label>
                        <RadioGroup
                          value={mainleveeData.creancierType}
                          onValueChange={(value) => setMainleveeData({...mainleveeData, creancierType: value})}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="banque" id="creancier_banque" />
                              <Label htmlFor="creancier_banque" className="cursor-pointer">Banque / Établissement financier</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="personne_physique" id="creancier_personne" />
                              <Label htmlFor="creancier_personne" className="cursor-pointer">Personne physique</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {mainleveeData.creancierType === "banque" ? (
                        <>
                          <div className="space-y-2">
                            <Label>Dénomination sociale *</Label>
                            <Input
                              value={mainleveeData.creancierBanque.denominationSociale}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, denominationSociale: e.target.value}
                              })}
                              placeholder="Ex: Société Générale"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Forme juridique</Label>
                            <Input
                              value={mainleveeData.creancierBanque.formeJuridique}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, formeJuridique: e.target.value}
                              })}
                              placeholder="Ex: SA, SAS..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Capital social</Label>
                            <Input
                              value={mainleveeData.creancierBanque.capitalSocial}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, capitalSocial: e.target.value}
                              })}
                              placeholder="Ex: 1 000 000 €"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse du siège *</Label>
                            <Input
                              value={mainleveeData.creancierBanque.adresseSiege}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, adresseSiege: e.target.value}
                              })}
                              placeholder="Adresse complète"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>RCS</Label>
                            <Input
                              value={mainleveeData.creancierBanque.rcs}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, rcs: e.target.value}
                              })}
                              placeholder="Ex: RCS Paris B 123 456 789"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>SIREN</Label>
                            <Input
                              value={mainleveeData.creancierBanque.siren}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierBanque: {...mainleveeData.creancierBanque, siren: e.target.value}
                              })}
                              placeholder="9 chiffres"
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2 bg-muted/30 p-3 rounded-lg">
                            <h4 className="font-medium text-sm">Représentant habilité</h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Nom du représentant</Label>
                                <Input
                                  value={mainleveeData.creancierBanque.representantNom}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, representantNom: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Prénom du représentant</Label>
                                <Input
                                  value={mainleveeData.creancierBanque.representantPrenom}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, representantPrenom: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Fonction</Label>
                                <Input
                                  value={mainleveeData.creancierBanque.representantFonction}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, representantFonction: e.target.value}
                                  })}
                                  placeholder="Ex: Directeur d'agence"
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Type de pouvoirs</Label>
                                <Select 
                                  value={mainleveeData.creancierBanque.pouvoirsType} 
                                  onValueChange={(value) => setMainleveeData({
                                    ...mainleveeData,
                                    creancierBanque: {...mainleveeData.creancierBanque, pouvoirsType: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="mandat">Mandat</SelectItem>
                                    <SelectItem value="delegation">Délégation interne</SelectItem>
                                    <SelectItem value="pv">PV désignant les pouvoirs</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>
                          </div>

                          {/* Upload pièces créancier banque */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>📎 Pièces justificatives du créancier</Label>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              {/* KBIS */}
                              <div className="space-y-2">
                                <Label className="text-sm">KBIS</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="mainlevee_kbis_upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      setMainleveeCreancierKbisFiles(prev => [...prev, ...files]);
                                    }}
                                  />
                                  <label htmlFor="mainlevee_kbis_upload" className="cursor-pointer text-sm text-muted-foreground">
                                    Cliquez pour joindre le KBIS
                                  </label>
                                  {mainleveeCreancierKbisFiles.length > 0 && (
                                    <div className="mt-2 space-y-1">
                                      {mainleveeCreancierKbisFiles.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                          <span className="truncate">{file.name}</span>
                                          <button
                                            type="button"
                                            onClick={() => setMainleveeCreancierKbisFiles(prev => prev.filter((_, i) => i !== idx))}
                                            className="text-red-600 ml-2"
                                          >
                                            ✕
                                          </button>
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>

                              {/* Mandat du représentant */}
                              <div className="space-y-2">
                                <Label className="text-sm">Mandat / Délégation de pouvoir</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="mainlevee_mandat_upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      setMainleveeCreancierMandatFiles(prev => [...prev, ...files]);
                                    }}
                                  />
                                  <label htmlFor="mainlevee_mandat_upload" className="cursor-pointer text-sm text-muted-foreground">
                                    Cliquez pour joindre le mandat
                                  </label>
                                  {mainleveeCreancierMandatFiles.length > 0 && (
                                    <div className="mt-2 space-y-1">
                                      {mainleveeCreancierMandatFiles.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                          <span className="truncate">{file.name}</span>
                                          <button
                                            type="button"
                                            onClick={() => setMainleveeCreancierMandatFiles(prev => prev.filter((_, i) => i !== idx))}
                                            className="text-red-600 ml-2"
                                          >
                                            ✕
                                          </button>
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>

                              {/* Pièce d'identité représentant */}
                              <div className="space-y-2">
                                <Label className="text-sm">Pièce d'identité du représentant</Label>
                                <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                  <input
                                    type="file"
                                    accept="application/pdf"
                                    multiple
                                    className="hidden"
                                    id="mainlevee_identite_rep_upload"
                                    onChange={(e) => {
                                      const files = Array.from(e.target.files || []);
                                      setMainleveeCreancierIdentiteFiles(prev => [...prev, ...files]);
                                    }}
                                  />
                                  <label htmlFor="mainlevee_identite_rep_upload" className="cursor-pointer text-sm text-muted-foreground">
                                    Cliquez pour joindre la pièce d'identité
                                  </label>
                                  {mainleveeCreancierIdentiteFiles.length > 0 && (
                                    <div className="mt-2 space-y-1">
                                      {mainleveeCreancierIdentiteFiles.map((file, idx) => (
                                        <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                          <span className="truncate">{file.name}</span>
                                          <button
                                            type="button"
                                            onClick={() => setMainleveeCreancierIdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                            className="text-red-600 ml-2"
                                          >
                                            ✕
                                          </button>
                                        </div>
                                      ))}
                                    </div>
                                  )}
                                </div>
                              </div>
                            </div>
                          </div>
                        </>
                      ) : (
                        <>
                          {/* Créancier personne physique */}
                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.nom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, nom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.prenom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, prenom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.adresse}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, adresse: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input
                              type="date"
                              value={mainleveeData.creancierPersonne.dateNaissance}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, dateNaissance: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.lieuNaissance}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, lieuNaissance: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.nationalite}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, nationalite: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.profession}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, profession: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Situation familiale</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.statutMatrimonial}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, statutMatrimonial: e.target.value}
                              })}
                              placeholder="Ex: Célibataire, Marié..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.typeIdentite}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, typeIdentite: e.target.value}
                              })}
                              placeholder="Ex: CNI, Passeport..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de pièce d'identité</Label>
                            <Input
                              value={mainleveeData.creancierPersonne.numeroIdentite}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                creancierPersonne: {...mainleveeData.creancierPersonne, numeroIdentite: e.target.value}
                              })}
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 3. Débiteurs hypothécaires - À CONTINUER */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👥 Débiteurs hypothécaires (emprunteurs)</h3>
                    <p className="text-sm text-muted-foreground">Les personnes qui avaient contracté le prêt</p>
                    
                    {mainleveeData.debiteurs.map((debiteur, index) => (
                      <div key={debiteur.id} className="p-4 border rounded-lg space-y-4">
                        <div className="flex justify-between items-center">
                          <h4 className="font-medium">Débiteur #{index + 1}</h4>
                          {mainleveeData.debiteurs.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="text-red-600 hover:text-red-700 hover:bg-red-50"
                              onClick={() => {
                                setMainleveeData({
                                  ...mainleveeData,
                                  debiteurs: mainleveeData.debiteurs.filter(d => d.id !== debiteur.id)
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>

                        {/* Sélection client pour ce débiteur - même logique que Convention d'indivision */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Ce débiteur est-il votre client ?</Label>
                            <RadioGroup
                              value={debiteur.isClient ? "client" : "autre"}
                              onValueChange={(value) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], isClient: value === "client"};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="client" id={`deb_client_${debiteur.id}`} />
                                  <Label htmlFor={`deb_client_${debiteur.id}`} className="cursor-pointer">Oui (client)</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="autre" id={`deb_autre_${debiteur.id}`} />
                                  <Label htmlFor={`deb_autre_${debiteur.id}`} className="cursor-pointer">Non (autre partie)</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {debiteur.isClient && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Sélectionner le client *</Label>
                              <Select
                                value={debiteur.clientId}
                                onValueChange={async (value) => {
                                  const selectedClient = clients.find(c => c.id === value);
                                  const newDebiteurs = [...mainleveeData.debiteurs];
                                  const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                  
                                  if (selectedClient) {
                                    let situationFamiliale = selectedClient.situation_matrimoniale || "";
                                    let regimeMatrimonial = "";
                                    
                                    if (selectedClient.situation_familiale) {
                                      if (typeof selectedClient.situation_familiale === 'object') {
                                        const sitFam = selectedClient.situation_familiale as any;
                                        situationFamiliale = selectedClient.situation_matrimoniale || sitFam.situation_familiale || "";
                                        regimeMatrimonial = sitFam.regime_matrimonial || "";
                                      }
                                    }

                                    newDebiteurs[idx] = {
                                      ...newDebiteurs[idx],
                                      clientId: value,
                                      nom: selectedClient.nom || "",
                                      prenom: selectedClient.prenom || "",
                                      adresse: selectedClient.adresse || "",
                                      dateNaissance: selectedClient.date_naissance || "",
                                      lieuNaissance: selectedClient.lieu_naissance || "",
                                      nationalite: selectedClient.nationalite || "",
                                      profession: selectedClient.profession || "",
                                      situationFamiliale: situationFamiliale,
                                      regimeMatrimonial: regimeMatrimonial,
                                      typeIdentite: selectedClient.type_identite || "",
                                      numeroIdentite: selectedClient.numero_identite || "",
                                    };

                                    // Auto-load identité
                                    if (selectedClient.id_doc_path) {
                                      try {
                                        const { data, error } = await supabase.storage
                                          .from('documents')
                                          .download(selectedClient.id_doc_path);
                                        
                                        if (data && !error) {
                                          const fileName = selectedClient.id_doc_path.split('/').pop() || 'identite.pdf';
                                          const file = new File([data], fileName, { type: data.type });
                                          setMainleveeDebiteursIdentiteFiles(prev => ({
                                            ...prev,
                                            [debiteur.id]: [file]
                                          }));
                                        }
                                      } catch (error) {
                                        console.error('Erreur chargement identité:', error);
                                      }
                                    } else {
                                      // Chercher dans client_documents
                                      try {
                                        const { data: docs, error: docsError } = await supabase
                                          .from('client_documents')
                                          .select('file_path, file_name')
                                          .eq('client_id', selectedClient.id)
                                          .eq('document_type', 'piece_identite')
                                          .order('uploaded_at', { ascending: false })
                                          .limit(1);
                                        
                                        if (docs && docs.length > 0) {
                                          const { data, error } = await supabase.storage
                                            .from('documents')
                                            .download(docs[0].file_path);
                                          
                                          if (data && !error) {
                                            const file = new File([data], docs[0].file_name, { type: data.type });
                                            setMainleveeDebiteursIdentiteFiles(prev => ({
                                              ...prev,
                                              [debiteur.id]: [file]
                                            }));
                                          }
                                        }
                                      } catch (error) {
                                        console.error('Erreur recherche client_documents:', error);
                                      }
                                    }
                                  }
                                  setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                                <SelectContent>
                                  {clients.map((client) => (
                                    <SelectItem key={client.id} value={client.id}>
                                      {client.nom} {client.prenom}
                                    </SelectItem>
                                  ))}
                                </SelectContent>
                              </Select>

                              {debiteur.clientId && (
                                <div className="mt-2 p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-800">
                                  ✓ Informations chargées depuis la fiche client
                                </div>
                              )}
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Nom</Label>
                            <Input
                              value={debiteur.nom}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], nom: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom</Label>
                            <Input
                              value={debiteur.prenom}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], prenom: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse personnelle</Label>
                            <Input
                              value={debiteur.adresse}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], adresse: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input
                              type="date"
                              value={debiteur.dateNaissance}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], dateNaissance: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={debiteur.lieuNaissance}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], lieuNaissance: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={debiteur.nationalite}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], nationalite: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={debiteur.profession}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], profession: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Situation familiale</Label>
                            <Input
                              value={debiteur.situationFamiliale}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], situationFamiliale: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                              placeholder="Ex: Célibataire, Marié..."
                            />
                          </div>

                          {debiteur.situationFamiliale && ['marié', 'marie', 'mariée', 'pacsé', 'pacse', 'pacs'].some(term => debiteur.situationFamiliale.toLowerCase().includes(term)) && (
                            <div className="space-y-2">
                              <Label>Régime matrimonial</Label>
                              <Input
                                value={debiteur.regimeMatrimonial}
                                onChange={(e) => {
                                  const newDebiteurs = [...mainleveeData.debiteurs];
                                  const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                  newDebiteurs[idx] = {...newDebiteurs[idx], regimeMatrimonial: e.target.value};
                                  setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                                }}
                                placeholder="Ex: Communauté légale..."
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Input
                              value={debiteur.typeIdentite}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], typeIdentite: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                              placeholder="CNI, Passeport..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de pièce d'identité</Label>
                            <Input
                              value={debiteur.numeroIdentite}
                              onChange={(e) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], numeroIdentite: e.target.value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Qualité dans l'acte</Label>
                            <Select 
                              value={debiteur.qualite} 
                              onValueChange={(value) => {
                                const newDebiteurs = [...mainleveeData.debiteurs];
                                const idx = newDebiteurs.findIndex(d => d.id === debiteur.id);
                                newDebiteurs[idx] = {...newDebiteurs[idx], qualite: value};
                                setMainleveeData({...mainleveeData, debiteurs: newDebiteurs});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="emprunteur">Emprunteur</SelectItem>
                                <SelectItem value="cofinanceur">Cofinanceur</SelectItem>
                                <SelectItem value="caution_hypothecaire">Caution hypothécaire</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Upload pièces débiteur */}
                          {!debiteur.isClient && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>📎 Pièce d'identité du débiteur</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id={`mainlevee_deb_identite_${debiteur.id}`}
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setMainleveeDebiteursIdentiteFiles(prev => ({
                                      ...prev,
                                      [debiteur.id]: [...(prev[debiteur.id] || []), ...files]
                                    }));
                                  }}
                                />
                                <label htmlFor={`mainlevee_deb_identite_${debiteur.id}`} className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre la pièce d'identité
                                </label>
                              </div>
                            </div>
                          )}

                          {debiteur.isClient && mainleveeDebiteursIdentiteFiles[debiteur.id]?.length > 0 && (
                            <div className="md:col-span-2 p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-800">
                              ✓ Pièce d'identité chargée depuis la fiche client
                            </div>
                          )}

                          {mainleveeDebiteursIdentiteFiles[debiteur.id]?.length > 0 && (
                            <div className="md:col-span-2 space-y-1">
                              {mainleveeDebiteursIdentiteFiles[debiteur.id].map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-2 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => {
                                      setMainleveeDebiteursIdentiteFiles(prev => ({
                                        ...prev,
                                        [debiteur.id]: prev[debiteur.id].filter((_, i) => i !== idx)
                                      }));
                                    }}
                                    className="text-red-600 ml-2"
                                  >
                                    Supprimer
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    ))}

                    <Button
                      type="button"
                      variant="outline"
                      className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                      onClick={() => {
                        const newId = Math.max(...mainleveeData.debiteurs.map(d => d.id), 0) + 1;
                        setMainleveeData({
                          ...mainleveeData,
                          debiteurs: [...mainleveeData.debiteurs, {
                            id: newId,
                            isClient: false,
                            clientId: "",
                            nom: "",
                            prenom: "",
                            adresse: "",
                            dateNaissance: "",
                            lieuNaissance: "",
                            nationalite: "",
                            profession: "",
                            situationFamiliale: "",
                            regimeMatrimonial: "",
                            typeIdentite: "",
                            numeroIdentite: "",
                            qualite: "emprunteur",
                          }]
                        });
                      }}
                    >
                      + Ajouter un débiteur
                    </Button>
                  </div>

                  {/* 4. Acte constitutif de l'hypothèque */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📄 Informations sur l'acte constitutif</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <h4 className="font-medium md:col-span-2">A. Acte d'origine</h4>
                      
                      <div className="space-y-2">
                        <Label>Date de signature de l'acte</Label>
                        <Input
                          type="date"
                          value={mainleveeData.acteOrigine.dateSignature}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, dateSignature: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nature de l'acte</Label>
                        <Select 
                          value={mainleveeData.acteOrigine.natureActe} 
                          onValueChange={(value) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, natureActe: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="acte_notarie">Acte notarié</SelectItem>
                            <SelectItem value="acte_sous_seing_prive">Acte sous seing privé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="space-y-2">
                        <Label>Notaire ou auteur de l'acte</Label>
                        <Input
                          value={mainleveeData.acteOrigine.notaireAuteur}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, notaireAuteur: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de publication au SPF</Label>
                        <Input
                          type="date"
                          value={mainleveeData.acteOrigine.datePublication}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, datePublication: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro de publication</Label>
                        <Input
                          value={mainleveeData.acteOrigine.numeroPublication}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            acteOrigine: {...mainleveeData.acteOrigine, numeroPublication: e.target.value}
                          })}
                        />
                      </div>

                      <h4 className="font-medium md:col-span-2 mt-4">B. Conditions du prêt</h4>

                      <div className="space-y-2">
                        <Label>Montant initial du prêt (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.conditionsPret.montantInitial}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, montantInitial: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Taux d'intérêt</Label>
                        <Input
                          value={mainleveeData.conditionsPret.tauxInteret}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, tauxInteret: e.target.value}
                          })}
                          placeholder="Ex: 1,5%"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Durée du prêt</Label>
                        <Input
                          value={mainleveeData.conditionsPret.dureePret}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, dureePret: e.target.value}
                          })}
                          placeholder="Ex: 20 ans"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro de contrat de prêt</Label>
                        <Input
                          value={mainleveeData.conditionsPret.numeroContrat}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, numeroContrat: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Établissement prêteur</Label>
                        <Input
                          value={mainleveeData.conditionsPret.etablissementPreteur}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, etablissementPreteur: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Numéro de dossier</Label>
                        <Input
                          value={mainleveeData.conditionsPret.numeroDossier}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            conditionsPret: {...mainleveeData.conditionsPret, numeroDossier: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 5. Bien(s) hypothéqué(s) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🏠 Description du/des bien(s) hypothéqué(s)</h3>
                    
                    {mainleveeData.biens.map((bien, index) => (
                      <div key={bien.id} className="p-4 border rounded-lg space-y-4">
                        <div className="flex justify-between items-center">
                          <h4 className="font-medium">Bien #{index + 1}</h4>
                          {mainleveeData.biens.length > 1 && (
                            <Button
                              type="button"
                              variant="ghost"
                              size="sm"
                              className="text-red-600 hover:text-red-700 hover:bg-red-50"
                              onClick={() => {
                                setMainleveeData({
                                  ...mainleveeData,
                                  biens: mainleveeData.biens.filter(b => b.id !== bien.id)
                                });
                              }}
                            >
                              Supprimer
                            </Button>
                          )}
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète du bien</Label>
                            <Input
                              value={bien.adresse}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], adresse: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Type de bien</Label>
                            <Select 
                              value={bien.typeBien} 
                              onValueChange={(value) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], typeBien: value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="maison">Maison</SelectItem>
                                <SelectItem value="appartement">Appartement</SelectItem>
                                <SelectItem value="terrain">Terrain</SelectItem>
                                <SelectItem value="locaux">Locaux commerciaux</SelectItem>
                                <SelectItem value="dependances">Dépendances</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Description du bien</Label>
                            <Input
                              value={bien.descriptionBien}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], descriptionBien: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                              placeholder="Ex: Villa 5 pièces..."
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Mode de détention du bien *</Label>
                            <Select 
                              value={bien.modeDetention} 
                              onValueChange={(value) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], modeDetention: value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="propriete_exclusive">Propriété exclusive</SelectItem>
                                <SelectItem value="indivision">Indivision</SelectItem>
                                <SelectItem value="communaute_acquets">Communauté réduite aux acquêts</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="autre">Autre régime (préciser)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {bien.modeDetention === "indivision" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Quote-parts en indivision</Label>
                              <Input
                                value={bien.quotepartsIndivision}
                                onChange={(e) => {
                                  const newBiens = [...mainleveeData.biens];
                                  const idx = newBiens.findIndex(b => b.id === bien.id);
                                  newBiens[idx] = {...newBiens[idx], quotepartsIndivision: e.target.value};
                                  setMainleveeData({...mainleveeData, biens: newBiens});
                                }}
                                placeholder="Ex: 1/2, 1/3-2/3, etc."
                              />
                            </div>
                          )}

                          {bien.modeDetention === "autre" && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Préciser le régime</Label>
                              <Input
                                value={bien.autreRegime}
                                onChange={(e) => {
                                  const newBiens = [...mainleveeData.biens];
                                  const idx = newBiens.findIndex(b => b.id === bien.id);
                                  newBiens[idx] = {...newBiens[idx], autreRegime: e.target.value};
                                  setMainleveeData({...mainleveeData, biens: newBiens});
                                }}
                                placeholder="Ex: Communauté universelle, participation aux acquêts..."
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Section cadastrale</Label>
                            <Input
                              value={bien.cadastreSection}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], cadastreSection: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de parcelle</Label>
                            <Input
                              value={bien.cadastreParcelle}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], cadastreParcelle: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Contenance (surface)</Label>
                            <Input
                              value={bien.cadastreContenance}
                              onChange={(e) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], cadastreContenance: e.target.value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                              placeholder="Ex: 500 m²"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Est-ce en copropriété ?</Label>
                            <RadioGroup
                              value={bien.estCopropriete}
                              onValueChange={(value) => {
                                const newBiens = [...mainleveeData.biens];
                                const idx = newBiens.findIndex(b => b.id === bien.id);
                                newBiens[idx] = {...newBiens[idx], estCopropriete: value};
                                setMainleveeData({...mainleveeData, biens: newBiens});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id={`copro_oui_${bien.id}`} />
                                  <Label htmlFor={`copro_oui_${bien.id}`} className="cursor-pointer">Oui</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id={`copro_non_${bien.id}`} />
                                  <Label htmlFor={`copro_non_${bien.id}`} className="cursor-pointer">Non</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {bien.estCopropriete === "oui" && (
                            <>
                              <div className="space-y-2">
                                <Label>Numéro de lot</Label>
                                <Input
                                  value={bien.numeroLot}
                                  onChange={(e) => {
                                    const newBiens = [...mainleveeData.biens];
                                    const idx = newBiens.findIndex(b => b.id === bien.id);
                                    newBiens[idx] = {...newBiens[idx], numeroLot: e.target.value};
                                    setMainleveeData({...mainleveeData, biens: newBiens});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Quote-part dans les parties communes</Label>
                                <Input
                                  value={bien.quotePart}
                                  onChange={(e) => {
                                    const newBiens = [...mainleveeData.biens];
                                    const idx = newBiens.findIndex(b => b.id === bien.id);
                                    newBiens[idx] = {...newBiens[idx], quotePart: e.target.value};
                                    setMainleveeData({...mainleveeData, biens: newBiens});
                                  }}
                                  placeholder="Ex: 50/1000"
                                />
                              </div>
                            </>
                          )}
                        </div>
                      </div>
                    ))}

                    <Button
                      type="button"
                      variant="outline"
                      className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                      onClick={() => {
                        const newId = Math.max(...mainleveeData.biens.map(b => b.id), 0) + 1;
                        setMainleveeData({
                          ...mainleveeData,
                          biens: [...mainleveeData.biens, {
                            id: newId,
                            adresse: "",
                            descriptionBien: "",
                            typeBien: "",
                            modeDetention: "",
                            quotepartsIndivision: "",
                            autreRegime: "",
                            cadastreSection: "",
                            cadastreParcelle: "",
                            cadastreContenance: "",
                            estCopropriete: "non",
                            numeroLot: "",
                            quotePart: "",
                          }]
                        });
                      }}
                    >
                      + Ajouter un bien
                    </Button>
                  </div>

                  {/* 6. Déclaration du créancier */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">✅ Déclaration du créancier</h3>
                    <div className="p-4 bg-muted/30 rounded-lg space-y-3">
                      <p className="text-sm text-muted-foreground">Le créancier déclare :</p>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_payee"
                            checked={mainleveeData.declaration.creancePayee}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, creancePayee: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_payee" className="cursor-pointer">Que la créance est intégralement payée</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_aucune_dette"
                            checked={mainleveeData.declaration.aucuneDette}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, aucuneDette: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_aucune_dette" className="cursor-pointer">Qu'il n'existe plus de dette en principal, intérêts, pénalités</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_consent"
                            checked={mainleveeData.declaration.consentMainlevee}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, consentMainlevee: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_consent" className="cursor-pointer">Qu'il consent à la mainlevée totale/partielle</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_renonce"
                            checked={mainleveeData.declaration.renonciation}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, renonciation: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_renonce" className="cursor-pointer">Qu'il renonce à l'inscription hypothécaire</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_radiation"
                            checked={mainleveeData.declaration.demandeRadiation}
                            onChange={(e) => setMainleveeData({
                              ...mainleveeData,
                              declaration: {...mainleveeData.declaration, demandeRadiation: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_radiation" className="cursor-pointer">Qu'il demande la radiation au SPF</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 7. Mandat/Procuration */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📝 Mandat ou procuration</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Y a-t-il un mandataire ?</Label>
                        <RadioGroup
                          value={mainleveeData.mandataire.existe}
                          onValueChange={(value) => setMainleveeData({
                            ...mainleveeData,
                            mandataire: {...mainleveeData.mandataire, existe: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="mand_oui" />
                              <Label htmlFor="mand_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="mand_non" />
                              <Label htmlFor="mand_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {mainleveeData.mandataire.existe === "oui" && (
                        <>
                          <div className="space-y-2">
                            <Label>Nom du mandataire</Label>
                            <Input
                              value={mainleveeData.mandataire.nom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                mandataire: {...mainleveeData.mandataire, nom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom du mandataire</Label>
                            <Input
                              value={mainleveeData.mandataire.prenom}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                mandataire: {...mainleveeData.mandataire, prenom: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Fonction</Label>
                            <Input
                              value={mainleveeData.mandataire.fonction}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                mandataire: {...mainleveeData.mandataire, fonction: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Pouvoirs du mandataire</Label>
                            <div className="space-y-2">
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="pouvoir_signer"
                                  checked={mainleveeData.mandataire.pouvoirSigner}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    mandataire: {...mainleveeData.mandataire, pouvoirSigner: e.target.checked}
                                  })}
                                  className="rounded"
                                />
                                <Label htmlFor="pouvoir_signer" className="cursor-pointer">Signer la mainlevée</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="pouvoir_deposer"
                                  checked={mainleveeData.mandataire.pouvoirDeposer}
                                  onChange={(e) => setMainleveeData({
                                    ...mainleveeData,
                                    mandataire: {...mainleveeData.mandataire, pouvoirDeposer: e.target.checked}
                                  })}
                                  className="rounded"
                                />
                                <Label htmlFor="pouvoir_deposer" className="cursor-pointer">Déposer au SPF</Label>
                              </div>
                            </div>
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 8. Consentement débiteur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👤 Consentement du débiteur</h3>
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Consentement du débiteur requis ?</Label>
                        <RadioGroup
                          value={mainleveeData.consentementDebiteur.requis}
                          onValueChange={(value) => setMainleveeData({
                            ...mainleveeData,
                            consentementDebiteur: {...mainleveeData.consentementDebiteur, requis: value}
                          })}
                        >
                          <div className="flex gap-4">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="oui" id="consent_oui" />
                              <Label htmlFor="consent_oui" className="cursor-pointer">Oui</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="non" id="consent_non" />
                              <Label htmlFor="consent_non" className="cursor-pointer">Non</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {mainleveeData.consentementDebiteur.requis === "oui" && (
                        <>
                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="accord_rad"
                                checked={mainleveeData.consentementDebiteur.accordRadiation}
                                onChange={(e) => setMainleveeData({
                                  ...mainleveeData,
                                  consentementDebiteur: {...mainleveeData.consentementDebiteur, accordRadiation: e.target.checked}
                                })}
                                className="rounded"
                              />
                              <Label htmlFor="accord_rad" className="cursor-pointer">Accord pour la radiation</Label>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Déclarations complémentaires</Label>
                            <Textarea
                              rows={3}
                              value={mainleveeData.consentementDebiteur.declarationsComplementaires}
                              onChange={(e) => setMainleveeData({
                                ...mainleveeData,
                                consentementDebiteur: {...mainleveeData.consentementDebiteur, declarationsComplementaires: e.target.value}
                              })}
                              placeholder="Ex: Aucune autre inscription liée..."
                            />
                          </div>
                        </>
                      )}
                    </div>
                  </div>

                  {/* 10. Frais et débours */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💰 Frais et débours</h3>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      <div className="space-y-2">
                        <Label>Frais de radiation (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.frais.fraisRadiation}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            frais: {...mainleveeData.frais, fraisRadiation: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Honoraires (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.frais.honoraires}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            frais: {...mainleveeData.frais, honoraires: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Timbres fiscaux (€)</Label>
                        <Input
                          type="number"
                          value={mainleveeData.frais.timbresFiscaux}
                          onChange={(e) => setMainleveeData({
                            ...mainleveeData,
                            frais: {...mainleveeData.frais, timbresFiscaux: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 11. Pièces justificatives obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📎 Pièces justificatives obligatoires</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Copie acte constitutif */}
                      <div className="space-y-2">
                        <Label>Copie de l'acte constitutif</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="mainlevee_acte_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setMainleveeActeConstitutifFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="mainlevee_acte_upload" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre l'acte constitutif
                          </label>
                          {mainleveeActeConstitutifFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {mainleveeActeConstitutifFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setMainleveeActeConstitutifFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Copie inscription hypothécaire */}
                      <div className="space-y-2">
                        <Label>Copie de l'inscription hypothécaire (SPF)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="mainlevee_inscription_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setMainleveeInscriptionHypothequeFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="mainlevee_inscription_upload" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre l'inscription
                          </label>
                          {mainleveeInscriptionHypothequeFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {mainleveeInscriptionHypothequeFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setMainleveeInscriptionHypothequeFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Attestation remboursement */}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Attestation de remboursement total du prêt</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="mainlevee_attestation_upload"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setMainleveeAttestationRemboursementFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="mainlevee_attestation_upload" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre l'attestation de remboursement
                          </label>
                          {mainleveeAttestationRemboursementFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {mainleveeAttestationRemboursementFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setMainleveeAttestationRemboursementFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Contrat de mariage (régimes matrimoniaux) */}
            {pendingContractType === "Contrat de mariage (régimes matrimoniaux)" && (
              <>
                <div className="space-y-6 max-h-[60vh] overflow-y-auto px-1">
                  {/* 1. Informations générales sur le contrat */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📋 Informations générales</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label>Type de régime matrimonial *</Label>
                        <Select 
                          value={contratMariageData.typeRegime} 
                          onValueChange={(value) => setContratMariageData({...contratMariageData, typeRegime: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                            <SelectItem value="communaute_acquets">Communauté réduite aux acquêts</SelectItem>
                            <SelectItem value="communaute_acquets_amenagee">Communauté réduite aux acquêts aménagée</SelectItem>
                            <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                            <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                            <SelectItem value="autre">Autre aménagement</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {contratMariageData.typeRegime === "autre" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Préciser le régime</Label>
                          <Input
                            value={contratMariageData.autreRegimePrecision}
                            onChange={(e) => setContratMariageData({...contratMariageData, autreRegimePrecision: e.target.value})}
                            placeholder="Ex: Communauté de meubles et acquêts..."
                          />
                        </div>
                      )}

                      {/* Date prévue du mariage */}
                      <div className="space-y-2 md:col-span-2">
                        <Label className="flex items-center gap-2">
                          📅 Date prévue du mariage
                          <span className="text-red-500">*</span>
                        </Label>
                        <Input
                          type="date"
                          value={contratMariageData.dateMariagePrevue}
                          onChange={(e) => setContratMariageData({...contratMariageData, dateMariagePrevue: e.target.value})}
                        />
                        <p className="text-xs text-muted-foreground">Le mariage sera célébré le...</p>
                      </div>

                      {/* Lieu prévu du mariage */}
                      <div className="space-y-4 md:col-span-2 p-4 border rounded-lg bg-muted/30">
                        <h4 className="font-medium flex items-center gap-2">
                          📍 Lieu prévu du mariage
                          <span className="text-red-500">*</span>
                        </h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Mairie</Label>
                            <Input
                              value={contratMariageData.lieuMariage.mairie}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, mairie: e.target.value}
                              })}
                              placeholder="Ex: Mairie du 8ème arrondissement"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Commune</Label>
                            <Input
                              value={contratMariageData.lieuMariage.commune}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, commune: e.target.value}
                              })}
                              placeholder="Ex: Paris"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Département</Label>
                            <Input
                              value={contratMariageData.lieuMariage.departement}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, departement: e.target.value}
                              })}
                              placeholder="Ex: Paris (75)"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Pays</Label>
                            <Input
                              value={contratMariageData.lieuMariage.pays}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                lieuMariage: {...contratMariageData.lieuMariage, pays: e.target.value}
                              })}
                              placeholder="France"
                            />
                          </div>
                        </div>
                        <p className="text-xs text-muted-foreground">Les futurs époux déclarent vouloir contracter mariage à la mairie de...</p>
                      </div>
                    </div>
                  </div>

                  {/* 2. Choix de la loi applicable (cas internationaux) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🌍 Choix de la loi applicable au régime matrimonial</h3>
                    
                    {contratMariageData.epoux.map((epoux, index) => (
                      <div key={epoux.id} className="p-4 border rounded-lg space-y-4">
                        <h4 className="font-medium">Époux #{index + 1}</h4>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Sélection client */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>Sélectionner un client (optionnel)</Label>
                            <Select 
                              value={epoux.clientId} 
                              onValueChange={async (value) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], clientId: value, isClient: !!value};
                                
                                if (value) {
                                  const client = clients.find(c => c.id === value);
                                  if (client) {
                                    newEpoux[index].nom = client.nom || "";
                                    newEpoux[index].prenom = client.prenom || "";
                                    newEpoux[index].adresse = client.adresse || "";
                                    newEpoux[index].dateNaissance = client.date_naissance || "";
                                    newEpoux[index].lieuNaissance = client.lieu_naissance || "";
                                    newEpoux[index].nationalite = client.nationalite || "";
                                    newEpoux[index].profession = client.profession || "";
                                    newEpoux[index].typeIdentite = client.type_identite || "";
                                    newEpoux[index].numeroIdentite = client.numero_identite || "";
                                    
                                    // Auto-remplir la situation familiale
                                    let situationFamiliale = client.situation_matrimoniale || "";
                                    if (!situationFamiliale && client.situation_familiale) {
                                      if (typeof client.situation_familiale === 'string') {
                                        situationFamiliale = client.situation_familiale;
                                      } else if (typeof client.situation_familiale === 'object') {
                                        const sitFam = client.situation_familiale as any;
                                        situationFamiliale = sitFam.situation_familiale || "";
                                      }
                                    }
                                    newEpoux[index].situationFamiliale = situationFamiliale;

                                    // Auto-charger le document d'identité
                                    if (client.id_doc_path) {
                                      try {
                                        const { data: fileData } = await supabase.storage
                                          .from('client_documents')
                                          .download(client.id_doc_path);
                                        if (fileData) {
                                          const file = new File([fileData], `identite_epoux_${index + 1}.pdf`, { type: 'application/pdf' });
                                          if (index === 0) {
                                            setContratMariageEpoux1IdentiteFiles([file]);
                                          } else {
                                            setContratMariageEpoux2IdentiteFiles([file]);
                                          }
                                        }
                                      } catch (err) {
                                        console.error('Erreur chargement document:', err);
                                      }
                                    }
                                  }
                                }
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner un client..." /></SelectTrigger>
                              <SelectContent>
                                {clients.map(client => (
                                  <SelectItem key={client.id} value={client.id}>
                                    {client.nom} {client.prenom}
                                  </SelectItem>
                                ))}
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Nom *</Label>
                            <Input
                              value={epoux.nom}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], nom: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom *</Label>
                            <Input
                              value={epoux.prenom}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], prenom: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse</Label>
                            <Input
                              value={epoux.adresse}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], adresse: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance</Label>
                            <Input
                              type="date"
                              value={epoux.dateNaissance}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], dateNaissance: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={epoux.lieuNaissance}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], lieuNaissance: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={epoux.nationalite}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], nationalite: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={epoux.profession}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], profession: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Situation familiale</Label>
                            <Select 
                              value={epoux.situationFamiliale} 
                              onValueChange={(value) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], situationFamiliale: value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="celibataire">Célibataire</SelectItem>
                                <SelectItem value="divorce">Divorcé(e)</SelectItem>
                                <SelectItem value="veuf">Veuf/Veuve</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Domicile après mariage (si différent de l'adresse)</Label>
                            <Input
                              value={epoux.domicileApresMariage}
                              onChange={(e) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], domicileApresMariage: e.target.value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Mariage antérieur hors de France ?</Label>
                            <RadioGroup
                              value={epoux.mariageAnterieurtHorsFrance}
                              onValueChange={(value) => {
                                const newEpoux = [...contratMariageData.epoux];
                                newEpoux[index] = {...newEpoux[index], mariageAnterieurtHorsFrance: value};
                                setContratMariageData({...contratMariageData, epoux: newEpoux});
                              }}
                            >
                              <div className="flex gap-4">
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="oui" id={`mariage_etr_oui_${index}`} />
                                  <Label htmlFor={`mariage_etr_oui_${index}`} className="cursor-pointer">Oui</Label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <RadioGroupItem value="non" id={`mariage_etr_non_${index}`} />
                                  <Label htmlFor={`mariage_etr_non_${index}`} className="cursor-pointer">Non</Label>
                                </div>
                              </div>
                            </RadioGroup>
                          </div>

                          {epoux.mariageAnterieurtHorsFrance === "oui" && (
                            <>
                              <div className="space-y-2">
                                <Label>Date du premier mariage</Label>
                                <Input
                                  type="date"
                                  value={epoux.datePremierMariage}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], datePremierMariage: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Lieu du premier mariage</Label>
                                <Input
                                  value={epoux.lieuPremierMariage}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], lieuPremierMariage: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Régime matrimonial initial</Label>
                                <Input
                                  value={epoux.regimeMatrimonialInitial}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], regimeMatrimonialInitial: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Acte d'état civil étranger</Label>
                                <Input
                                  value={epoux.acteEtatCivilEtranger}
                                  onChange={(e) => {
                                    const newEpoux = [...contratMariageData.epoux];
                                    newEpoux[index] = {...newEpoux[index], acteEtatCivilEtranger: e.target.value};
                                    setContratMariageData({...contratMariageData, epoux: newEpoux});
                                  }}
                                  placeholder="Nom du fichier ou référence"
                                />
                              </div>
                            </>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 2bis. Choix de la loi applicable (cas internationaux) */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">🌍 Choix de la loi applicable au régime matrimonial</h3>
                    <p className="text-sm text-muted-foreground">Pour les couples de nationalités différentes ou résidant à l'étranger</p>
                    
                    <div className="grid grid-cols-1 gap-4">
                      <div className="space-y-2">
                        <Label>Loi applicable *</Label>
                        <RadioGroup
                          value={contratMariageData.choixLoiApplicable}
                          onValueChange={(value) => setContratMariageData({...contratMariageData, choixLoiApplicable: value})}
                        >
                          <div className="flex flex-col gap-2">
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="loi_francaise" id="loi_fr" />
                              <Label htmlFor="loi_fr" className="cursor-pointer">Loi française</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="loi_residence" id="loi_res" />
                              <Label htmlFor="loi_res" className="cursor-pointer">Loi de la résidence habituelle</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="loi_nationalite" id="loi_nat" />
                              <Label htmlFor="loi_nat" className="cursor-pointer">Loi de la nationalité</Label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <RadioGroupItem value="autre" id="loi_autre" />
                              <Label htmlFor="loi_autre" className="cursor-pointer">Autre (préciser)</Label>
                            </div>
                          </div>
                        </RadioGroup>
                      </div>

                      {contratMariageData.choixLoiApplicable === "autre" && (
                        <div className="space-y-2">
                          <Label>Préciser la loi applicable</Label>
                          <Input
                            value={contratMariageData.choixLoiApplicableAutre}
                            onChange={(e) => setContratMariageData({...contratMariageData, choixLoiApplicableAutre: e.target.value})}
                            placeholder="Ex: Loi suisse, loi belge..."
                          />
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 2ter. Consentement des enfants majeurs - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">✍️ Consentement des enfants majeurs</h3>
                      <p className="text-sm text-muted-foreground">Obligatoire en cas de changement de régime matrimonial</p>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Consentement des enfants majeurs requis ? *</Label>
                          <RadioGroup
                            value={contratMariageData.consentementEnfantsMajeursRequis}
                            onValueChange={(value) => setContratMariageData({...contratMariageData, consentementEnfantsMajeursRequis: value})}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="consent_oui" />
                                <Label htmlFor="consent_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="consent_non" />
                                <Label htmlFor="consent_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.consentementEnfantsMajeursRequis === "oui" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>Joindre le consentement des enfants majeurs (PDF)</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_consent_enfants"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageConsentementEnfantsFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_consent_enfants" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageConsentementEnfantsFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageConsentementEnfantsFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageConsentementEnfantsFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 2quater. Biens communs actuels - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">🏠 Biens communs actuels</h3>
                      <p className="text-sm text-muted-foreground">Nécessaire si vous changez depuis un régime de communauté</p>
                      
                      <div className="space-y-4">
                        {contratMariageData.biensCommuns.map((bien, idx) => (
                          <div key={bien.id} className="grid grid-cols-1 md:grid-cols-3 gap-2 p-3 border rounded">
                            <div className="space-y-2">
                              <Label>Description du bien</Label>
                              <Input
                                placeholder="Ex: Appartement Paris 15e"
                                value={bien.description}
                                onChange={(e) => {
                                  const newBiens = [...contratMariageData.biensCommuns];
                                  newBiens[idx] = {...newBiens[idx], description: e.target.value};
                                  setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                }}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Valeur estimée (€)</Label>
                              <Input
                                type="number"
                                placeholder="250000"
                                value={bien.valeurEstimee}
                                onChange={(e) => {
                                  const newBiens = [...contratMariageData.biensCommuns];
                                  newBiens[idx] = {...newBiens[idx], valeurEstimee: e.target.value};
                                  setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                }}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Répartition envisagée</Label>
                              <Input
                                placeholder="50/50 ou liquidation"
                                value={bien.repartitionEnvisagee}
                                onChange={(e) => {
                                  const newBiens = [...contratMariageData.biensCommuns];
                                  newBiens[idx] = {...newBiens[idx], repartitionEnvisagee: e.target.value};
                                  setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                }}
                              />
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                          onClick={() => {
                            const newId = Math.max(...contratMariageData.biensCommuns.map(b => b.id), 0) + 1;
                            setContratMariageData({
                              ...contratMariageData,
                              biensCommuns: [...contratMariageData.biensCommuns, {
                                id: newId,
                                description: "",
                                valeurEstimee: "",
                                repartitionEnvisagee: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un bien commun
                        </Button>
                      </div>
                    </div>
                  )}

                  {/* 2quinquies. Consentement du juge - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">⚖️ Consentement du juge</h3>
                      <p className="text-sm text-muted-foreground">Requis si vous avez des enfants mineurs et changez de régime</p>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2 md:col-span-2">
                          <Label>Accord du juge requis ? *</Label>
                          <RadioGroup
                            value={contratMariageData.accordJugeRequis}
                            onValueChange={(value) => setContratMariageData({...contratMariageData, accordJugeRequis: value})}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="juge_oui" />
                                <Label htmlFor="juge_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="juge_non" />
                                <Label htmlFor="juge_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.accordJugeRequis === "oui" && (
                          <div className="space-y-2 md:col-span-2">
                            <Label>Joindre la décision / autorisation judiciaire (PDF)</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_decision_juge"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageDecisionJugeFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_decision_juge" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageDecisionJugeFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageDecisionJugeFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageDecisionJugeFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 3. Informations sur les enfants */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">👶 Informations sur les enfants</h3>
                    <p className="text-sm text-muted-foreground">Obligatoire pour les changements de régime matrimonial</p>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nombre d'enfants</Label>
                        <Input
                          type="number"
                          value={contratMariageData.nombreEnfants}
                          onChange={(e) => setContratMariageData({...contratMariageData, nombreEnfants: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Enfants mineurs (mention)</Label>
                        <Input
                          value={contratMariageData.enfantsMineurs}
                          onChange={(e) => setContratMariageData({...contratMariageData, enfantsMineurs: e.target.value})}
                          placeholder="Ex: 2 enfants mineurs"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Information au juge nécessaire ?</Label>
                        <Input
                          value={contratMariageData.informationJugeNecessaire}
                          onChange={(e) => setContratMariageData({...contratMariageData, informationJugeNecessaire: e.target.value})}
                          placeholder="Oui / Non"
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Enfants majeurs (si applicable)</Label>
                        {contratMariageData.enfantsMajeurs.map((enfant, idx) => (
                          <div key={enfant.id} className="grid grid-cols-1 md:grid-cols-3 gap-2 p-2 border rounded">
                            <Input
                              placeholder="Nom"
                              value={enfant.nom}
                              onChange={(e) => {
                                const newEnfants = [...contratMariageData.enfantsMajeurs];
                                newEnfants[idx] = {...newEnfants[idx], nom: e.target.value};
                                setContratMariageData({...contratMariageData, enfantsMajeurs: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Prénom"
                              value={enfant.prenom}
                              onChange={(e) => {
                                const newEnfants = [...contratMariageData.enfantsMajeurs];
                                newEnfants[idx] = {...newEnfants[idx], prenom: e.target.value};
                                setContratMariageData({...contratMariageData, enfantsMajeurs: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Accord/Information reçue"
                              value={enfant.accordInformation}
                              onChange={(e) => {
                                const newEnfants = [...contratMariageData.enfantsMajeurs];
                                newEnfants[idx] = {...newEnfants[idx], accordInformation: e.target.value};
                                setContratMariageData({...contratMariageData, enfantsMajeurs: newEnfants});
                              }}
                            />
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          size="sm"
                          className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                          onClick={() => {
                            const newId = Math.max(...contratMariageData.enfantsMajeurs.map(e => e.id), 0) + 1;
                            setContratMariageData({
                              ...contratMariageData,
                              enfantsMajeurs: [...contratMariageData.enfantsMajeurs, {
                                id: newId,
                                nom: "",
                                prenom: "",
                                adresse: "",
                                accordInformation: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un enfant majeur
                        </Button>
                      </div>
                    </div>
                  </div>

                  {/* 4. Patrimoine des époux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">💰 Patrimoine actuel des époux</h3>
                    <p className="text-sm text-muted-foreground">Nécessaire pour participation aux acquêts ou communauté aménagée</p>
                    
                    {/* Époux 1 */}
                    <div className="p-4 border rounded-lg space-y-4">
                      <h4 className="font-medium">Patrimoine Époux 1</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Biens propres (avant mariage)</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux1.biensPropres}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, biensPropres: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Biens acquis pendant mariage</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux1.biensAcquisPendantMariage}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, biensAcquisPendantMariage: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Valeur estimée totale (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux1.valeurEstimee}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, valeurEstimee: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Dettes personnelles (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux1.dettesPersonnelles}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, dettesPersonnelles: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de départ (patrimoine initial)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux1.masseDepart}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, masseDepart: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de fin (patrimoine final)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux1.masseFin}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux1: {...contratMariageData.patrimoineEpoux1, masseFin: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>

                    {/* Époux 2 */}
                    <div className="p-4 border rounded-lg space-y-4">
                      <h4 className="font-medium">Patrimoine Époux 2</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Biens propres (avant mariage)</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux2.biensPropres}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, biensPropres: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Biens acquis pendant mariage</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.patrimoineEpoux2.biensAcquisPendantMariage}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, biensAcquisPendantMariage: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Valeur estimée totale (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux2.valeurEstimee}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, valeurEstimee: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Dettes personnelles (€)</Label>
                          <Input
                            type="number"
                            value={contratMariageData.patrimoineEpoux2.dettesPersonnelles}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, dettesPersonnelles: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de départ (patrimoine initial)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux2.masseDepart}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, masseDepart: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Masse de fin (patrimoine final)</Label>
                          <Input
                            value={contratMariageData.patrimoineEpoux2.masseFin}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              patrimoineEpoux2: {...contratMariageData.patrimoineEpoux2, masseFin: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 4bis. Liquidation du régime matrimonial actuel - SUPPRIMÉ (changement régime uniquement) */}
                  {false && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📦 Liquidation du régime matrimonial actuel</h3>
                      <p className="text-sm text-muted-foreground">Obligatoire si vous quittez un régime communautaire</p>
                      
                      <div className="space-y-4">
                        {/* Question principale */}
                        <div className="space-y-2">
                          <Label>Liquidation du régime actuel prévue dans l'acte ? *</Label>
                          <RadioGroup
                            value={contratMariageData.liquidationRegimeActuel}
                            onValueChange={(value) => setContratMariageData({...contratMariageData, liquidationRegimeActuel: value})}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="liquid_oui" />
                                <Label htmlFor="liquid_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="liquid_non" />
                                <Label htmlFor="liquid_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.liquidationRegimeActuel === "oui" && (
                          <>
                            {/* Biens communs existants */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">🏠 Biens communs existants (avant le changement)</h4>
                              <p className="text-xs text-muted-foreground">Lister les biens appartenant aux deux époux en communauté</p>
                              
                              {contratMariageData.biensCommuns.map((bien, idx) => (
                                <div key={bien.id} className="grid grid-cols-1 md:grid-cols-2 gap-3 p-3 border rounded bg-background">
                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Bien #{idx + 1} - Description</Label>
                                    <Input
                                      placeholder="Ex: Appartement 3 pièces Paris 15e"
                                      value={bien.description}
                                      onChange={(e) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], description: e.target.value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Valeur estimée (€)</Label>
                                    <Input
                                      type="number"
                                      placeholder="250000"
                                      value={bien.valeurEstimee}
                                      onChange={(e) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], valeurEstimee: e.target.value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Dettes attachées au bien</Label>
                                    <Input
                                      type="number"
                                      placeholder="150000"
                                      value={bien.dettesAttachees}
                                      onChange={(e) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], dettesAttachees: e.target.value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Affectation prévue</Label>
                                    <Select 
                                      value={bien.affectationPrevue} 
                                      onValueChange={(value) => {
                                        const newBiens = [...contratMariageData.biensCommuns];
                                        newBiens[idx] = {...newBiens[idx], affectationPrevue: value};
                                        setContratMariageData({...contratMariageData, biensCommuns: newBiens});
                                      }}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="epoux1">Attribué à Époux 1</SelectItem>
                                        <SelectItem value="epoux2">Attribué à Époux 2</SelectItem>
                                        <SelectItem value="vente">Vente du bien</SelectItem>
                                        <SelectItem value="indivision">Maintien en indivision</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                </div>
                              ))}
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                                onClick={() => {
                                  const newId = Math.max(...contratMariageData.biensCommuns.map(b => b.id), 0) + 1;
                                  setContratMariageData({
                                    ...contratMariageData,
                                    biensCommuns: [...contratMariageData.biensCommuns, {
                                      id: newId,
                                      description: "",
                                      valeurEstimee: "",
                                      dettesAttachees: "",
                                      affectationPrevue: "",
                                      repartitionEnvisagee: "",
                                    }]
                                  });
                                }}
                              >
                                + Ajouter un bien commun
                              </Button>
                            </div>

                            {/* Passif commun */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">💳 Passif commun à répartir</h4>
                              <p className="text-xs text-muted-foreground">Crédits, dettes ménagères, prêts en cours, comptes courants</p>
                              
                              {contratMariageData.passifCommun.map((dette, idx) => (
                                <div key={dette.id} className="grid grid-cols-1 md:grid-cols-3 gap-3 p-3 border rounded bg-background">
                                  <div className="space-y-2">
                                    <Label>Dette #{idx + 1} - Description</Label>
                                    <Input
                                      placeholder="Ex: Crédit auto"
                                      value={dette.description}
                                      onChange={(e) => {
                                        const newDettes = [...contratMariageData.passifCommun];
                                        newDettes[idx] = {...newDettes[idx], description: e.target.value};
                                        setContratMariageData({...contratMariageData, passifCommun: newDettes});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Montant (€)</Label>
                                    <Input
                                      type="number"
                                      placeholder="15000"
                                      value={dette.montant}
                                      onChange={(e) => {
                                        const newDettes = [...contratMariageData.passifCommun];
                                        newDettes[idx] = {...newDettes[idx], montant: e.target.value};
                                        setContratMariageData({...contratMariageData, passifCommun: newDettes});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Mode de répartition</Label>
                                    <Select 
                                      value={dette.modeRepartition} 
                                      onValueChange={(value) => {
                                        const newDettes = [...contratMariageData.passifCommun];
                                        newDettes[idx] = {...newDettes[idx], modeRepartition: value};
                                        setContratMariageData({...contratMariageData, passifCommun: newDettes});
                                      }}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="epoux1">Pris en charge par Époux 1</SelectItem>
                                        <SelectItem value="epoux2">Pris en charge par Époux 2</SelectItem>
                                        <SelectItem value="50_50">Répartition 50/50</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                </div>
                              ))}
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                                onClick={() => {
                                  const newId = Math.max(...contratMariageData.passifCommun.map(d => d.id), 0) + 1;
                                  setContratMariageData({
                                    ...contratMariageData,
                                    passifCommun: [...contratMariageData.passifCommun, {
                                      id: newId,
                                      description: "",
                                      montant: "",
                                      modeRepartition: "",
                                    }]
                                  });
                                }}
                              >
                                + Ajouter une dette
                              </Button>
                            </div>

                            {/* Soulte */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">💰 Soulte éventuelle</h4>
                              <p className="text-xs text-muted-foreground">Si l'un reçoit plus de biens que l'autre</p>
                              
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div className="space-y-2 md:col-span-2">
                                  <Label>Soulte due ?</Label>
                                  <RadioGroup
                                    value={contratMariageData.soulte.soulteDue}
                                    onValueChange={(value) => setContratMariageData({
                                      ...contratMariageData,
                                      soulte: {...contratMariageData.soulte, soulteDue: value}
                                    })}
                                  >
                                    <div className="flex gap-4">
                                      <div className="flex items-center space-x-2">
                                        <RadioGroupItem value="oui" id="soulte_oui" />
                                        <Label htmlFor="soulte_oui" className="cursor-pointer">Oui</Label>
                                      </div>
                                      <div className="flex items-center space-x-2">
                                        <RadioGroupItem value="non" id="soulte_non" />
                                        <Label htmlFor="soulte_non" className="cursor-pointer">Non</Label>
                                      </div>
                                    </div>
                                  </RadioGroup>
                                </div>

                                {contratMariageData.soulte.soulteDue === "oui" && (
                                  <>
                                    <div className="space-y-2">
                                      <Label>Montant de la soulte (€)</Label>
                                      <Input
                                        type="number"
                                        value={contratMariageData.soulte.montantSoulte}
                                        onChange={(e) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, montantSoulte: e.target.value}
                                        })}
                                      />
                                    </div>
                                    <div className="space-y-2">
                                      <Label>Époux débiteur</Label>
                                      <Select 
                                        value={contratMariageData.soulte.epouxDebiteur} 
                                        onValueChange={(value) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, epouxDebiteur: value}
                                        })}
                                      >
                                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                        <SelectContent>
                                          <SelectItem value="epoux1">Époux 1</SelectItem>
                                          <SelectItem value="epoux2">Époux 2</SelectItem>
                                        </SelectContent>
                                      </Select>
                                    </div>
                                    <div className="space-y-2">
                                      <Label>Modalités de paiement</Label>
                                      <RadioGroup
                                        value={contratMariageData.soulte.modalitesPaiement}
                                        onValueChange={(value) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, modalitesPaiement: value}
                                        })}
                                      >
                                        <div className="flex gap-4">
                                          <div className="flex items-center space-x-2">
                                            <RadioGroupItem value="comptant" id="paiement_comptant" />
                                            <Label htmlFor="paiement_comptant" className="cursor-pointer">Comptant</Label>
                                          </div>
                                          <div className="flex items-center space-x-2">
                                            <RadioGroupItem value="echelonne" id="paiement_echelonne" />
                                            <Label htmlFor="paiement_echelonne" className="cursor-pointer">Paiement échelonné</Label>
                                          </div>
                                        </div>
                                      </RadioGroup>
                                    </div>
                                    <div className="space-y-2">
                                      <Label>Date limite de paiement</Label>
                                      <Input
                                        type="date"
                                        value={contratMariageData.soulte.dateLimitePaiement}
                                        onChange={(e) => setContratMariageData({
                                          ...contratMariageData,
                                          soulte: {...contratMariageData.soulte, dateLimitePaiement: e.target.value}
                                        })}
                                      />
                                    </div>
                                  </>
                                )}
                              </div>
                            </div>

                            {/* Actifs financiers */}
                            <div className="space-y-3 p-4 border rounded-lg bg-muted/30">
                              <h4 className="font-medium">🏦 Actifs financiers communs</h4>
                              <p className="text-xs text-muted-foreground">Comptes bancaires, placements, livrets, assurances-vie si communs</p>
                              
                              {contratMariageData.actifsFinanciers.map((actif, idx) => (
                                <div key={actif.id} className="grid grid-cols-1 md:grid-cols-2 gap-3 p-3 border rounded bg-background">
                                  <div className="space-y-2">
                                    <Label>Nature du compte</Label>
                                    <Input
                                      placeholder="Ex: Compte joint, Livret A"
                                      value={actif.natureCompte}
                                      onChange={(e) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], natureCompte: e.target.value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Établissement bancaire</Label>
                                    <Input
                                      placeholder="Ex: Crédit Agricole"
                                      value={actif.etablissement}
                                      onChange={(e) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], etablissement: e.target.value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Solde (€)</Label>
                                    <Input
                                      type="number"
                                      placeholder="25000"
                                      value={actif.solde}
                                      onChange={(e) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], solde: e.target.value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Mode de partage</Label>
                                    <Select 
                                      value={actif.modePartage} 
                                      onValueChange={(value) => {
                                        const newActifs = [...contratMariageData.actifsFinanciers];
                                        newActifs[idx] = {...newActifs[idx], modePartage: value};
                                        setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                      }}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="epoux1">Attribué à Époux 1</SelectItem>
                                        <SelectItem value="epoux2">Attribué à Époux 2</SelectItem>
                                        <SelectItem value="personnalise">Répartition personnalisée</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                  {actif.modePartage === "personnalise" && (
                                    <div className="space-y-2 md:col-span-2">
                                      <Label>Préciser la répartition</Label>
                                      <Input
                                        placeholder="Ex: 60% Époux 1, 40% Époux 2"
                                        value={actif.partagePersonnalise}
                                        onChange={(e) => {
                                          const newActifs = [...contratMariageData.actifsFinanciers];
                                          newActifs[idx] = {...newActifs[idx], partagePersonnalise: e.target.value};
                                          setContratMariageData({...contratMariageData, actifsFinanciers: newActifs});
                                        }}
                                      />
                                    </div>
                                  )}
                                </div>
                              ))}
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                className="w-full text-orange-600 hover:text-orange-700 hover:bg-orange-50 border-orange-300"
                                onClick={() => {
                                  const newId = Math.max(...contratMariageData.actifsFinanciers.map(a => a.id), 0) + 1;
                                  setContratMariageData({
                                    ...contratMariageData,
                                    actifsFinanciers: [...contratMariageData.actifsFinanciers, {
                                      id: newId,
                                      natureCompte: "",
                                      etablissement: "",
                                      solde: "",
                                      modePartage: "",
                                      partagePersonnalise: "",
                                    }]
                                  });
                                }}
                              >
                                + Ajouter un actif financier
                              </Button>
                            </div>

                            {/* Observations */}
                            <div className="space-y-2">
                              <Label>📝 Observations complémentaires</Label>
                              <Textarea
                                rows={4}
                                value={contratMariageData.observationsLiquidation}
                                onChange={(e) => setContratMariageData({...contratMariageData, observationsLiquidation: e.target.value})}
                                placeholder="Avantage matrimonial antérieur, biens indivis post-liquidation, modalités particulières..."
                              />
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 5. Clauses selon le régime choisi */}
                  {contratMariageData.typeRegime === "separation_biens" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Séparation de biens</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="admin_exclusive"
                            checked={contratMariageData.clausesSeparation.administrationExclusive}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, administrationExclusive: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="admin_exclusive" className="cursor-pointer">Administration et jouissance exclusives par chaque époux</Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="comptes_sep"
                            checked={contratMariageData.clausesSeparation.comptesSepares}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, comptesSepares: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="comptes_sep" className="cursor-pointer">Comptes bancaires séparés</Label>
                        </div>

                        <div className="space-y-2">
                          <Label>Contribution aux charges du mariage</Label>
                          <Select 
                            value={contratMariageData.clausesSeparation.contributionCharges} 
                            onValueChange={(value) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, contributionCharges: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="proportionnelle">Proportionnelle aux revenus</SelectItem>
                              <SelectItem value="50_50">50/50</SelectItem>
                              <SelectItem value="autre">Autre</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {contratMariageData.clausesSeparation.contributionCharges === "autre" && (
                          <div className="space-y-2">
                            <Label>Préciser</Label>
                            <Input
                              value={contratMariageData.clausesSeparation.contributionChargesAutre}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                clausesSeparation: {...contratMariageData.clausesSeparation, contributionChargesAutre: e.target.value}
                              })}
                            />
                          </div>
                        )}

                        <div className="space-y-2">
                          <Label>Mise en commun éventuelle d'un bien</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesSeparation.miseEnCommunBien}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesSeparation: {...contratMariageData.clausesSeparation, miseEnCommunBien: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {contratMariageData.typeRegime === "communaute_acquets_amenagee" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Communauté aménagée</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Définition des biens communs et propres</Label>
                          <Textarea
                            rows={3}
                            value={contratMariageData.clausesCommunauteAmenagee.definitionBiensCommunsPropres}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, definitionBiensCommunsPropres: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Aménagement des biens professionnels</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesCommunauteAmenagee.amenagementBiensProfessionnels}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, amenagementBiensProfessionnels: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Type d'administration</Label>
                          <RadioGroup
                            value={contratMariageData.clausesCommunauteAmenagee.typeAdministration}
                            onValueChange={(value) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, typeAdministration: value}
                            })}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="symetriques" id="admin_sym" />
                                <Label htmlFor="admin_sym" className="cursor-pointer">Pouvoirs symétriques</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="unique" id="admin_uniq" />
                                <Label htmlFor="admin_uniq" className="cursor-pointer">Pouvoir unique pour certains biens</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        {contratMariageData.clausesCommunauteAmenagee.typeAdministration === "unique" && (
                          <div className="space-y-2">
                            <Label>Détails du pouvoir unique</Label>
                            <Textarea
                              rows={2}
                              value={contratMariageData.clausesCommunauteAmenagee.pouvoirUniqueDetails}
                              onChange={(e) => setContratMariageData({
                                ...contratMariageData,
                                clausesCommunauteAmenagee: {...contratMariageData.clausesCommunauteAmenagee, pouvoirUniqueDetails: e.target.value}
                              })}
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {contratMariageData.typeRegime === "communaute_universelle" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Communauté universelle</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Clause d'attribution intégrale au survivant</Label>
                          <RadioGroup
                            value={contratMariageData.clausesCommunauteUniverselle.attributionIntegraleSurvivant}
                            onValueChange={(value) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteUniverselle: {...contratMariageData.clausesCommunauteUniverselle, attributionIntegraleSurvivant: value}
                            })}
                          >
                            <div className="flex gap-4">
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="oui" id="attrib_oui" />
                                <Label htmlFor="attrib_oui" className="cursor-pointer">Oui</Label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <RadioGroupItem value="non" id="attrib_non" />
                                <Label htmlFor="attrib_non" className="cursor-pointer">Non</Label>
                              </div>
                            </div>
                          </RadioGroup>
                        </div>

                        <div className="space-y-2">
                          <Label>Clause de préciput (le survivant prend un bien avant partage)</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesCommunauteUniverselle.clausesPreciput}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteUniverselle: {...contratMariageData.clausesCommunauteUniverselle, clausesPreciput: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Exclusion de certains biens</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesCommunauteUniverselle.exclusionCertainsBiens}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesCommunauteUniverselle: {...contratMariageData.clausesCommunauteUniverselle, exclusionCertainsBiens: e.target.value}
                            })}
                            placeholder="Ex: héritages, biens professionnels..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {contratMariageData.typeRegime === "participation_acquets" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">📝 Clauses - Participation aux acquêts</h3>
                      <div className="grid grid-cols-1 gap-4">
                        <div className="space-y-2">
                          <Label>Définition des patrimoines originels</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.definitionPatrimoinesOriginels}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, definitionPatrimoinesOriginels: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Définition du patrimoine final</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.definitionPatrimoineFinal}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, definitionPatrimoineFinal: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Calcul de la créance de participation</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.calculCreanceParticipation}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, calculCreanceParticipation: e.target.value}
                            })}
                          />
                        </div>

                        <div className="space-y-2">
                          <Label>Détermination des biens propres par nature</Label>
                          <Textarea
                            rows={2}
                            value={contratMariageData.clausesParticipation.biensPropresParNature}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              clausesParticipation: {...contratMariageData.clausesParticipation, biensPropresParNature: e.target.value}
                            })}
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 6. Clauses optionnelles avancées */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">⚙️ Clauses optionnelles avancées</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Clause de remploi</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.clauseRemploi}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, clauseRemploi: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause de préciput</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.clausePreciput}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, clausePreciput: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Attribution préférentielle de biens</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.attributionPreferentielle}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, attributionPreferentielle: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Gestion séparée des biens professionnels</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.gestionSepareeBiensProfessionnels}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, gestionSepareeBiensProfessionnels: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Protection du conjoint survivant</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.protectionConjointSurvivant}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, protectionConjointSurvivant: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Donation entre époux (si intégrée)</Label>
                        <Textarea
                          rows={2}
                          value={contratMariageData.clausesAvancees.donationEntreEpoux}
                          onChange={(e) => setContratMariageData({
                            ...contratMariageData,
                            clausesAvancees: {...contratMariageData.clausesAvancees, donationEntreEpoux: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 7. Déclarations obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">✅ Déclarations obligatoires des époux</h3>
                    <div className="p-4 bg-muted/30 rounded-lg space-y-3">
                      <p className="text-sm text-muted-foreground">Les époux déclarent :</p>
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_identite"
                            checked={contratMariageData.declarations.identite}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, identite: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_identite" className="cursor-pointer">Leur identité</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_capacite"
                            checked={contratMariageData.declarations.capaciteJuridique}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, capaciteJuridique: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_capacite" className="cursor-pointer">Leur capacité juridique</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_situation"
                            checked={contratMariageData.declarations.situationMatrimoniale}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, situationMatrimoniale: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_situation" className="cursor-pointer">Leur situation matrimoniale</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_opposition"
                            checked={contratMariageData.declarations.absenceOpposition}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, absenceOpposition: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_opposition" className="cursor-pointer">L'absence d'opposition au mariage</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_choix"
                            checked={contratMariageData.declarations.choixLibreEclaire}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, choixLibreEclaire: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_choix" className="cursor-pointer">Leur choix libre et éclairé du régime</Label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="decl_connaissance"
                            checked={contratMariageData.declarations.connaissanceEffetsJuridiques}
                            onChange={(e) => setContratMariageData({
                              ...contratMariageData,
                              declarations: {...contratMariageData.declarations, connaissanceEffetsJuridiques: e.target.checked}
                            })}
                            className="rounded"
                          />
                          <Label htmlFor="decl_connaissance" className="cursor-pointer">Leur connaissance des effets juridiques du régime</Label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 8. Documents à fournir */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">📎 Documents à fournir</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Époux 1 - Identité */}
                      <div className="space-y-2">
                        <Label>Époux 1 - Pièce d'identité</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf,image/*"
                            multiple
                            className="hidden"
                            id="cm_epoux1_identite"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux1IdentiteFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux1_identite" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux1IdentiteFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux1IdentiteFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux1IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Époux 2 - Identité */}
                      <div className="space-y-2">
                        <Label>Époux 2 - Pièce d'identité</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf,image/*"
                            multiple
                            className="hidden"
                            id="cm_epoux2_identite"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux2IdentiteFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux2_identite" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux2IdentiteFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux2IdentiteFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux2IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Actes de naissance */}
                      <div className="space-y-2">
                        <Label>Époux 1 - Acte de naissance (&lt; 3 mois)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="cm_epoux1_naissance"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux1ActeNaissanceFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux1_naissance" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux1ActeNaissanceFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux1ActeNaissanceFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux1ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Époux 2 - Acte de naissance (&lt; 3 mois)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="cm_epoux2_naissance"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageEpoux2ActeNaissanceFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_epoux2_naissance" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageEpoux2ActeNaissanceFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageEpoux2ActeNaissanceFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageEpoux2ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Si changement de régime - SUPPRIMÉ */}
                      {false && (
                        <>
                          <div className="space-y-2">
                            <Label>Contrat de mariage initial</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_contrat_initial"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageContratInitialFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_contrat_initial" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageContratInitialFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageContratInitialFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageContratInitialFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Accord enfants majeurs</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="cm_accord_enfants"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setContratMariageAccordEnfantsFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="cm_accord_enfants" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {contratMariageAccordEnfantsFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {contratMariageAccordEnfantsFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setContratMariageAccordEnfantsFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        </>
                      )}

                      {/* Certificat de publication des bans */}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Certificat de publication des bans</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="cm_certificat_bans"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setContratMariageCertificatBansFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="cm_certificat_bans" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {contratMariageCertificatBansFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {contratMariageCertificatBansFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setContratMariageCertificatBansFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                      {/* Documents optionnels */}
                      <div className="space-y-2 md:col-span-2">
                        <Label>Titres de propriété (si clause sur bien immobilier)</Label>
                        <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                          <input
                            type="file"
                            accept="application/pdf"
                            multiple
                            className="hidden"
                            id="cm_titres"
                            onChange={(e) => {
                              const files = Array.from(e.target.files || []);
                              setContratMariageTitresProprieteFiles(prev => [...prev, ...files]);
                            }}
                          />
                          <label htmlFor="cm_titres" className="cursor-pointer text-sm text-muted-foreground">
                            Cliquez pour joindre
                          </label>
                          {contratMariageTitresProprieteFiles.length > 0 && (
                            <div className="mt-2 space-y-1">
                              {contratMariageTitresProprieteFiles.map((file, idx) => (
                                <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                  <span className="truncate">{file.name}</span>
                                  <button
                                    type="button"
                                    onClick={() => setContratMariageTitresProprieteFiles(prev => prev.filter((_, i) => i !== idx))}
                                    className="text-red-600 ml-2"
                                  >
                                    ✕
                                  </button>
                                </div>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour PACS */}
            {pendingContractType === "PACS (convention + enregistrement)" && (
              <>
                <div className="space-y-6">
                  <div className="bg-muted/30 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg mb-4">📋 Convention de PACS</h3>
                    <p className="text-sm text-muted-foreground">
                      Complétez les informations nécessaires pour la rédaction de la convention de PACS.
                    </p>
                  </div>

                  {/* 1. Informations générales */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur le PACS</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Objet du PACS */}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          Objet du PACS
                          <span className="text-red-500">*</span>
                        </Label>
                        <Select value={pacsData.objetPacs} onValueChange={(value) => setPacsData({...pacsData, objetPacs: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="initial">PACS initial</SelectItem>
                            <SelectItem value="modification">Modification de PACS existant</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Régime choisi */}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          Régime choisi
                          <span className="text-red-500">*</span>
                        </Label>
                        <Select value={pacsData.regimePacs} onValueChange={(value) => setPacsData({...pacsData, regimePacs: value})}>
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="separation">Séparation de biens (régime légal par défaut)</SelectItem>
                            <SelectItem value="indivision">Indivision</SelectItem>
                            <SelectItem value="personnalise">Régime personnalisé</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Date prise d'effet */}
                      <div className="space-y-2">
                        <Label>Date de prise d'effet souhaitée</Label>
                        <Input
                          type="date"
                          value={pacsData.datePriseEffetSouhaitee}
                          onChange={(e) => setPacsData({...pacsData, datePriseEffetSouhaitee: e.target.value})}
                        />
                        <p className="text-xs text-muted-foreground">Par défaut : à l'enregistrement</p>
                      </div>
                    </div>

                    {/* Régime personnalisé */}
                    {pacsData.regimePacs === "personnalise" && (
                      <div className="space-y-4 p-4 border rounded-lg bg-muted/30">
                        <h4 className="font-medium">Régime personnalisé</h4>
                        <div className="space-y-2">
                          <Label>Définition des biens communs</Label>
                          <Textarea
                            value={pacsData.regimePersonnalise.definitionBiensCommuns}
                            onChange={(e) => setPacsData({
                              ...pacsData,
                              regimePersonnalise: {...pacsData.regimePersonnalise, definitionBiensCommuns: e.target.value}
                            })}
                            rows={3}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Biens propres</Label>
                          <Textarea
                            value={pacsData.regimePersonnalise.biensPropres}
                            onChange={(e) => setPacsData({
                              ...pacsData,
                              regimePersonnalise: {...pacsData.regimePersonnalise, biensPropres: e.target.value}
                            })}
                            rows={3}
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 2. Adresse commune */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Adresse commune (obligatoire)</h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2 md:col-span-2">
                        <Label className="flex items-center gap-2">
                          Adresse commune déclarée
                          <span className="text-red-500">*</span>
                        </Label>
                        <Input
                          value={pacsData.adresseCommune}
                          onChange={(e) => setPacsData({...pacsData, adresseCommune: e.target.value})}
                          placeholder="Adresse complète de résidence commune"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label>Date de début de résidence commune</Label>
                        <Input
                          type="date"
                          value={pacsData.dateDebutResidenceCommune}
                          onChange={(e) => setPacsData({...pacsData, dateDebutResidenceCommune: e.target.value})}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 3. Déclarations obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Déclarations sur l'honneur (obligatoires)</h3>
                    <div className="space-y-3 p-4 border rounded-lg">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl1"
                          checked={pacsData.declarations.residenceCommune}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            declarations: {...pacsData.declarations, residenceCommune: e.target.checked}
                          })}
                        />
                        <label htmlFor="decl1" className="text-sm">
                          Déclaration de résidence commune <span className="text-red-500">*</span>
                        </label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl2"
                          checked={pacsData.declarations.absenceLienParente}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            declarations: {...pacsData.declarations, absenceLienParente: e.target.checked}
                          })}
                        />
                        <label htmlFor="decl2" className="text-sm">
                          Déclaration d'absence de lien de parenté <span className="text-red-500">*</span>
                        </label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="decl3"
                          checked={pacsData.declarations.absenceMariageEtPacs}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            declarations: {...pacsData.declarations, absenceMariageEtPacs: e.target.checked}
                          })}
                        />
                        <label htmlFor="decl3" className="text-sm">
                          Déclaration d'absence de mariage et PACS en cours <span className="text-red-500">*</span>
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* 4. Identité des partenaires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète des partenaires</h3>
                    
                    {pacsData.partenaires.map((partenaire, index) => (
                      <div key={partenaire.id} className="p-4 border rounded-lg space-y-4 bg-muted/20">
                        <h4 className="font-medium text-base">Partenaire #{index + 1}</h4>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Sélection client */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>Sélectionner un client (optionnel)</Label>
                            <Select 
                              value={partenaire.clientId} 
                              onValueChange={async (value) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index] = {...newPartenaires[index], clientId: value, isClient: !!value};
                                
                                if (value) {
                                  const client = clients.find(c => c.id === value);
                                  if (client) {
                                    newPartenaires[index].nom = client.nom || "";
                                    newPartenaires[index].prenom = client.prenom || "";
                                    newPartenaires[index].nomNaissance = client.nom || "";
                                    newPartenaires[index].adresseActuelle = client.adresse || "";
                                    newPartenaires[index].dateNaissance = client.date_naissance || "";
                                    newPartenaires[index].lieuNaissance = client.lieu_naissance || "";
                                    newPartenaires[index].nationalite = client.nationalite || "";
                                    newPartenaires[index].profession = client.profession || "";
                                    newPartenaires[index].telephone = client.telephone || "";
                                    newPartenaires[index].email = client.email || "";
                                    newPartenaires[index].typeIdentite = client.type_identite || "";
                                    newPartenaires[index].numeroIdentite = client.numero_identite || "";
                                    
                                    // Extraire la situation familiale de l'objet JSON
                                    let situationFamiliale = "";
                                    if (typeof client.situation_familiale === 'object' && client.situation_familiale !== null) {
                                      situationFamiliale = client.situation_familiale.situation_familiale || "";
                                    } else if (typeof client.situation_familiale === 'string') {
                                      situationFamiliale = client.situation_familiale;
                                    }
                                    newPartenaires[index].situationFamiliale = situationFamiliale || client.situation_matrimoniale || "";
                                  }
                                }
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                              <SelectContent>
                                {clients.map((c) => (
                                  <SelectItem key={c.id} value={c.id}>
                                    {c.nom} {c.prenom}
                                  </SelectItem>
                                ))}
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Informations civiles */}
                          <div className="space-y-2">
                            <Label>Nom <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.nom}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].nom = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.prenom}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].prenom = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nom de naissance</Label>
                            <Input
                              value={partenaire.nomNaissance}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].nomNaissance = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance <span className="text-red-500">*</span></Label>
                            <Input
                              type="date"
                              value={partenaire.dateNaissance}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].dateNaissance = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu de naissance <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.lieuNaissance}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].lieuNaissance = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.nationalite}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].nationalite = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={partenaire.profession}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].profession = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input
                              value={partenaire.telephone}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].telephone = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input
                              type="email"
                              value={partenaire.email}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].email = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse actuelle <span className="text-red-500">*</span></Label>
                            <Input
                              value={partenaire.adresseActuelle}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].adresseActuelle = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          {/* Situation familiale */}
                          <div className="space-y-2">
                            <Label>Situation familiale actuelle <span className="text-red-500">*</span></Label>
                            <Select 
                              value={partenaire.situationFamiliale}
                              onValueChange={(value) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].situationFamiliale = value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="celibataire">Célibataire</SelectItem>
                                <SelectItem value="divorce">Divorcé(e)</SelectItem>
                                <SelectItem value="veuf">Veuf/Veuve</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Pièce d'identité */}
                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Select 
                              value={partenaire.typeIdentite}
                              onValueChange={(value) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].typeIdentite = value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="CNI">Carte Nationale d'Identité</SelectItem>
                                <SelectItem value="Passeport">Passeport</SelectItem>
                                <SelectItem value="Titre de séjour">Titre de séjour</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de pièce d'identité</Label>
                            <Input
                              value={partenaire.numeroIdentite}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].numeroIdentite = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'émission</Label>
                            <Input
                              type="date"
                              value={partenaire.dateEmissionIdentite}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].dateEmissionIdentite = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Autorité délivrante</Label>
                            <Input
                              value={partenaire.autoriteDelivrante}
                              onChange={(e) => {
                                const newPartenaires = [...pacsData.partenaires];
                                newPartenaires[index].autoriteDelivrante = e.target.value;
                                setPacsData({...pacsData, partenaires: newPartenaires});
                              }}
                              placeholder="Ex: Préfecture de Paris"
                            />
                          </div>

                          {/* Partenaire étranger */}
                          <div className="space-y-2 md:col-span-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`etranger-${index}`}
                                checked={partenaire.estEtranger}
                                onChange={(e) => {
                                  const newPartenaires = [...pacsData.partenaires];
                                  newPartenaires[index].estEtranger = e.target.checked;
                                  setPacsData({...pacsData, partenaires: newPartenaires});
                                }}
                              />
                              <label htmlFor={`etranger-${index}`} className="text-sm font-medium">
                                Partenaire étranger (nécessite documents supplémentaires)
                              </label>
                            </div>
                          </div>

                          {partenaire.estEtranger && (
                            <div className="md:col-span-2 p-3 bg-yellow-50 border border-yellow-200 rounded space-y-2">
                              <p className="text-sm font-medium text-yellow-800">Documents supplémentaires requis :</p>
                              <div className="space-y-2">
                                <div className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    id={`attestation-${index}`}
                                    checked={partenaire.attestationNonPacsPaysOrigine}
                                    onChange={(e) => {
                                      const newPartenaires = [...pacsData.partenaires];
                                      newPartenaires[index].attestationNonPacsPaysOrigine = e.target.checked;
                                      setPacsData({...pacsData, partenaires: newPartenaires});
                                    }}
                                  />
                                  <label htmlFor={`attestation-${index}`} className="text-sm">Attestation de non-PACS du pays d'origine</label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    id={`coutume-${index}`}
                                    checked={partenaire.certificatCoutumeRequis}
                                    onChange={(e) => {
                                      const newPartenaires = [...pacsData.partenaires];
                                      newPartenaires[index].certificatCoutumeRequis = e.target.checked;
                                      setPacsData({...pacsData, partenaires: newPartenaires});
                                    }}
                                  />
                                  <label htmlFor={`coutume-${index}`} className="text-sm">Certificat de coutume</label>
                                </div>
                                <div className="flex items-center space-x-2">
                                  <input
                                    type="checkbox"
                                    id={`traduction-${index}`}
                                    checked={partenaire.traductionRequise}
                                    onChange={(e) => {
                                      const newPartenaires = [...pacsData.partenaires];
                                      newPartenaires[index].traductionRequise = e.target.checked;
                                      setPacsData({...pacsData, partenaires: newPartenaires});
                                    }}
                                  />
                                  <label htmlFor={`traduction-${index}`} className="text-sm">Traductions certifiées nécessaires</label>
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 5. Modification de PACS (si applicable) */}
                  {pacsData.objetPacs === "modification" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Référence du PACS initial</h3>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Date du PACS initial</Label>
                          <Input
                            type="date"
                            value={pacsData.pacsInitialDate}
                            onChange={(e) => setPacsData({...pacsData, pacsInitialDate: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Mairie ou notaire d'enregistrement</Label>
                          <Input
                            value={pacsData.pacsInitialMairie}
                            onChange={(e) => setPacsData({...pacsData, pacsInitialMairie: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Numéro d'enregistrement (si connu)</Label>
                          <Input
                            value={pacsData.pacsInitialNumero}
                            onChange={(e) => setPacsData({...pacsData, pacsInitialNumero: e.target.value})}
                          />
                        </div>
                        <div className="space-y-2 md:col-span-2">
                          <Label>Clauses modifiées</Label>
                          <Textarea
                            value={pacsData.clausesModifiees}
                            onChange={(e) => setPacsData({...pacsData, clausesModifiees: e.target.value})}
                            rows={4}
                            placeholder="Décrivez les modifications apportées..."
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 6. Clauses du PACS */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses du PACS</h3>
                    
                    {/* A. Contribution aux charges */}
                    <div className="space-y-3 p-4 border rounded-lg">
                      <h4 className="font-medium">A. Contribution aux charges du ménage (obligatoire)</h4>
                      <div className="space-y-2">
                        <Select 
                          value={pacsData.contributionCharges}
                          onValueChange={(value) => setPacsData({...pacsData, contributionCharges: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="proportionnelle">Proportionnelle aux revenus</SelectItem>
                            <SelectItem value="50_50">50/50</SelectItem>
                            <SelectItem value="autre">Autre (préciser)</SelectItem>
                          </SelectContent>
                        </Select>
                        {pacsData.contributionCharges === "autre" && (
                          <Input
                            value={pacsData.contributionChargesAutre}
                            onChange={(e) => setPacsData({...pacsData, contributionChargesAutre: e.target.value})}
                            placeholder="Précisez la répartition..."
                          />
                        )}
                      </div>
                    </div>

                    {/* B. Clauses facultatives */}
                    <div className="space-y-3 p-4 border rounded-lg bg-muted/20">
                      <h4 className="font-medium">B. Clauses facultatives</h4>
                      
                      <div className="space-y-2">
                        <Label>Gestion des biens personnels</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.gestionBiensPersonnels}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, gestionBiensPersonnels: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Gestion d'un bien commun</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.gestionBienCommun}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, gestionBienCommun: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Usage d'un bien indivis</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.usageBienIndivis}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, usageBienIndivis: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Répartition de dépenses spécifiques</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.repartitionDepensesSpecifiques}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, repartitionDepensesSpecifiques: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause d'occupation du logement en cas de séparation</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clauseOccupationLogementSeparation}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clauseOccupationLogementSeparation: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause de reprise de bien en cas de décès</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clauseRepriseBienDeces}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clauseRepriseBienDeces: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clause d'abandon de créance entre partenaires</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clauseAbandonCreance}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clauseAbandonCreance: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Modalités d'utilisation d'un compte bancaire commun</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.modalitesCompteBancaireCommun}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, modalitesCompteBancaireCommun: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clauses financières personnalisées</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clausesFinancieresPersonnalisees}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clausesFinancieresPersonnalisees: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Clauses de solidarité sur certaines dettes</Label>
                        <Textarea
                          value={pacsData.clausesFacultatives.clausesSolidariteDettes}
                          onChange={(e) => setPacsData({
                            ...pacsData,
                            clausesFacultatives: {...pacsData.clausesFacultatives, clausesSolidariteDettes: e.target.value}
                          })}
                          rows={2}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 7. Enfants en commun */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Enfant(s) en commun (optionnel)</h3>
                    <div className="space-y-2">
                      <Label>Avez-vous un ou plusieurs enfants en commun ?</Label>
                      <Select 
                        value={pacsData.enfantEnCommun}
                        onValueChange={(value) => setPacsData({...pacsData, enfantEnCommun: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {pacsData.enfantEnCommun === "oui" && (
                      <div className="space-y-4">
                        {pacsData.enfants.map((enfant, idx) => (
                          <div key={enfant.id} className="p-4 border rounded-lg space-y-3 bg-muted/10">
                            <div className="flex justify-between items-center">
                              <h5 className="font-medium">Enfant #{idx + 1}</h5>
                              {idx > 0 && (
                                <button
                                  type="button"
                                  onClick={() => {
                                    const newEnfants = pacsData.enfants.filter((_, i) => i !== idx);
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                  className="text-red-600 text-sm"
                                >
                                  Supprimer
                                </button>
                              )}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2">
                                <Label>Nom</Label>
                                <Input
                                  value={enfant.nom}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].nom = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Prénom</Label>
                                <Input
                                  value={enfant.prenom}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].prenom = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Date de naissance</Label>
                                <Input
                                  type="date"
                                  value={enfant.dateNaissance}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].dateNaissance = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Autorité parentale</Label>
                                <Input
                                  value={enfant.autoriteParentale}
                                  onChange={(e) => {
                                    const newEnfants = [...pacsData.enfants];
                                    newEnfants[idx].autoriteParentale = e.target.value;
                                    setPacsData({...pacsData, enfants: newEnfants});
                                  }}
                                  placeholder="Conjointe / Exclusive / Autre"
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          onClick={() => {
                            setPacsData({
                              ...pacsData,
                              enfants: [...pacsData.enfants, {
                                id: pacsData.enfants.length + 1,
                                nom: "",
                                prenom: "",
                                dateNaissance: "",
                                autoriteParentale: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un enfant
                        </Button>
                      </div>
                    )}
                  </div>

                  {/* 8. Biens préexistants */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Biens déjà acquis ensemble</h3>
                    <div className="space-y-2">
                      <Label>Avez-vous déjà des biens acquis ensemble ?</Label>
                      <Select 
                        value={pacsData.biensPreexistants}
                        onValueChange={(value) => setPacsData({...pacsData, biensPreexistants: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="non">Non</SelectItem>
                          <SelectItem value="oui">Oui</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {pacsData.biensPreexistants === "oui" && (
                      <div className="space-y-4">
                        {pacsData.biensListe.map((bien, idx) => (
                          <div key={bien.id} className="p-4 border rounded-lg space-y-3 bg-muted/10">
                            <div className="flex justify-between items-center">
                              <h5 className="font-medium">Bien #{idx + 1}</h5>
                              {idx > 0 && (
                                <button
                                  type="button"
                                  onClick={() => {
                                    const newBiens = pacsData.biensListe.filter((_, i) => i !== idx);
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  className="text-red-600 text-sm"
                                >
                                  Supprimer
                                </button>
                              )}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                              <div className="space-y-2 md:col-span-2">
                                <Label>Description du bien</Label>
                                <Textarea
                                  value={bien.description}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].description = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  rows={2}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Quote-part partenaire 1</Label>
                                <Input
                                  value={bien.quotePart1}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].quotePart1 = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  placeholder="Ex: 50%"
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Quote-part partenaire 2</Label>
                                <Input
                                  value={bien.quotePart2}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].quotePart2 = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  placeholder="Ex: 50%"
                                />
                              </div>
                              <div className="space-y-2 md:col-span-2">
                                <Label>Indivision</Label>
                                <Input
                                  value={bien.indivision}
                                  onChange={(e) => {
                                    const newBiens = [...pacsData.biensListe];
                                    newBiens[idx].indivision = e.target.value;
                                    setPacsData({...pacsData, biensListe: newBiens});
                                  }}
                                  placeholder="Modalités d'indivision..."
                                />
                              </div>
                            </div>
                          </div>
                        ))}
                        <Button
                          type="button"
                          variant="outline"
                          onClick={() => {
                            setPacsData({
                              ...pacsData,
                              biensListe: [...pacsData.biensListe, {
                                id: pacsData.biensListe.length + 1,
                                description: "",
                                quotePart1: "",
                                quotePart2: "",
                                indivision: "",
                              }]
                            });
                          }}
                        >
                          + Ajouter un bien
                        </Button>
                      </div>
                    )}
                  </div>

                  {/* 9. Droit applicable */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Droit applicable</h3>
                    <div className="space-y-2">
                      <Label>Droit applicable au PACS</Label>
                      <Select 
                        value={pacsData.droitApplicable}
                        onValueChange={(value) => setPacsData({...pacsData, droitApplicable: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="francais">Droit français</SelectItem>
                          <SelectItem value="autre">Autre droit (préciser)</SelectItem>
                        </SelectContent>
                      </Select>
                      {pacsData.droitApplicable === "autre" && (
                        <Input
                          value={pacsData.droitApplicableAutre}
                          onChange={(e) => setPacsData({...pacsData, droitApplicableAutre: e.target.value})}
                          placeholder="Précisez le droit applicable..."
                        />
                      )}
                    </div>
                  </div>

                  {/* 10. Pièces justificatives */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Pièces justificatives (obligatoires pour l'enregistrement)</h3>
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        📌 <strong>Documents obligatoires pour chaque partenaire :</strong> pièce d'identité, justificatif de domicile, acte de naissance intégral, 
                        + jugement de divorce (si divorcé) ou acte de décès (si veuf)
                      </p>
                    </div>

                    {/* Documents Partenaire 1 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Partenaire 1</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité P1 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p1_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile P1 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p1_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte naissance P1 */}
                        <div className="space-y-2">
                          <Label>Acte de naissance intégral <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p1_naissance"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1ActeNaissanceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_naissance" className="cursor-pointer text-sm text-muted-foreground">
                              &lt; 3 mois (France) ou &lt; 6 mois (étranger)
                            </label>
                            {pacsPartenaire1ActeNaissanceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1ActeNaissanceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Jugement divorce P1 */}
                        <div className="space-y-2">
                          <Label>Jugement de divorce (si applicable)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p1_divorce"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1DivorceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_divorce" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1DivorceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1DivorceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1DivorceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte décès P1 */}
                        <div className="space-y-2">
                          <Label>Acte de décès conjoint précédent (si veuf/ve)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p1_deces"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire1DecesFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p1_deces" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire1DecesFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire1DecesFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire1DecesFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Documents étranger P1 */}
                        {pacsData.partenaires[0]?.estEtranger && (
                          <>
                            <div className="space-y-2">
                              <Label>Certificat de coutume</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p1_coutume"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire1CertificatCoutumeFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p1_coutume" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire1CertificatCoutumeFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire1CertificatCoutumeFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire1CertificatCoutumeFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2">
                              <Label>Certificat de non-PACS du pays d'origine</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p1_nonpacs"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire1CertificatNonPacsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p1_nonpacs" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire1CertificatNonPacsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire1CertificatNonPacsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire1CertificatNonPacsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Traductions certifiées</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p1_traductions"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire1TraductionsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p1_traductions" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire1TraductionsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire1TraductionsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire1TraductionsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>
                          </>
                        )}
                      </div>
                    </div>

                    {/* Documents Partenaire 2 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Partenaire 2</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité P2 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p2_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile P2 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="pacs_p2_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte naissance P2 */}
                        <div className="space-y-2">
                          <Label>Acte de naissance intégral <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p2_naissance"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2ActeNaissanceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_naissance" className="cursor-pointer text-sm text-muted-foreground">
                              &lt; 3 mois (France) ou &lt; 6 mois (étranger)
                            </label>
                            {pacsPartenaire2ActeNaissanceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2ActeNaissanceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2ActeNaissanceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Jugement divorce P2 */}
                        <div className="space-y-2">
                          <Label>Jugement de divorce (si applicable)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p2_divorce"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2DivorceFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_divorce" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2DivorceFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2DivorceFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2DivorceFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte décès P2 */}
                        <div className="space-y-2">
                          <Label>Acte de décès conjoint précédent (si veuf/ve)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="pacs_p2_deces"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setPacsPartenaire2DecesFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="pacs_p2_deces" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {pacsPartenaire2DecesFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {pacsPartenaire2DecesFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setPacsPartenaire2DecesFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Documents étranger P2 */}
                        {pacsData.partenaires[1]?.estEtranger && (
                          <>
                            <div className="space-y-2">
                              <Label>Certificat de coutume</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p2_coutume"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire2CertificatCoutumeFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p2_coutume" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire2CertificatCoutumeFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire2CertificatCoutumeFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire2CertificatCoutumeFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2">
                              <Label>Certificat de non-PACS du pays d'origine</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p2_nonpacs"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire2CertificatNonPacsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p2_nonpacs" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire2CertificatNonPacsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire2CertificatNonPacsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire2CertificatNonPacsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Traductions certifiées</Label>
                              <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="pacs_p2_traductions"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setPacsPartenaire2TraductionsFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="pacs_p2_traductions" className="cursor-pointer text-sm text-muted-foreground">
                                  Cliquez pour joindre
                                </label>
                                {pacsPartenaire2TraductionsFiles.length > 0 && (
                                  <div className="mt-2 space-y-1">
                                    {pacsPartenaire2TraductionsFiles.map((file, idx) => (
                                      <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                        <span className="truncate">{file.name}</span>
                                        <button
                                          type="button"
                                          onClick={() => setPacsPartenaire2TraductionsFiles(prev => prev.filter((_, i) => i !== idx))}
                                          className="text-red-600 ml-2"
                                        >
                                          ✕
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                )}
                              </div>
                            </div>
                          </>
                        )}
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire spécifique pour Donation entre époux */}
            {pendingContractType === "Donation entre époux" && (
              <>
                <div className="space-y-6">
                  <div className="bg-muted/30 p-4 rounded-lg">
                    <h3 className="font-semibold text-lg mb-4">📜 Donation entre époux</h3>
                    <p className="text-sm text-muted-foreground">
                      Complétez les informations nécessaires pour la rédaction de la donation entre époux.
                    </p>
                  </div>

                  {/* 1. Informations générales sur la donation */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur la donation</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {/* Type de donation */}
                      <div className="space-y-2">
                        <Label className="flex items-center gap-2">
                          Type de donation choisie <span className="text-red-500">*</span>
                        </Label>
                        <Select 
                          value={donationEntreEpouxData.typeDonation}
                          onValueChange={(value) => setDonationEntreEpouxData({...donationEntreEpouxData, typeDonation: value})}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="au_dernier_vivant">Donation entre époux au dernier vivant (effets au décès)</SelectItem>
                            <SelectItem value="biens_presents">Donation de biens présents (effets immédiats – très réglementée)</SelectItem>
                            <SelectItem value="mixte">Donation mixte (rare)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Date prévue de signature */}
                      <div className="space-y-2">
                        <Label>Date prévue de signature de l'acte</Label>
                        <Input
                          type="date"
                          value={donationEntreEpouxData.datePrevueSignature}
                          onChange={(e) => setDonationEntreEpouxData({...donationEntreEpouxData, datePrevueSignature: e.target.value})}
                        />
                      </div>

                      {/* Objet de la donation */}
                      <div className="space-y-2 md:col-span-2">
                        <Label className="flex items-center gap-2">
                          Objet de la donation <span className="text-red-500">*</span>
                        </Label>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                          {[
                            { value: "protection_conjoint", label: "Protection du conjoint survivant" },
                            { value: "transmission_bien", label: "Transmission d'un bien particulier" },
                            { value: "partage_inegal", label: "Partage inégal" },
                            { value: "renforcement_droits", label: "Renforcement des droits successoraux" }
                          ].map(obj => (
                            <div key={obj.value} className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`objet_${obj.value}`}
                                checked={donationEntreEpouxData.objetDonation.includes(obj.value)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      objetDonation: [...donationEntreEpouxData.objetDonation, obj.value]
                                    });
                                  } else {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      objetDonation: donationEntreEpouxData.objetDonation.filter(o => o !== obj.value)
                                    });
                                  }
                                }}
                              />
                              <label htmlFor={`objet_${obj.value}`} className="text-sm cursor-pointer">
                                {obj.label}
                              </label>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 2. Identité complète des époux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète des époux</h3>
                    
                    {donationEntreEpouxData.epoux.map((epoux, index) => (
                      <div key={epoux.id} className="p-4 border rounded-lg space-y-4 bg-muted/20">
                        <h4 className="font-medium text-base">Époux #{index + 1}</h4>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Sélection client */}
                          <div className="space-y-2 md:col-span-2">
                            <Label>Sélectionner un client (optionnel)</Label>
                            <Select 
                              value={epoux.clientId} 
                              onValueChange={async (value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index] = {...newEpoux[index], clientId: value, isClient: !!value};
                                
                                if (value) {
                                  const client = clients.find(c => c.id === value);
                                  if (client) {
                                    newEpoux[index].nom = client.nom || "";
                                    newEpoux[index].prenom = client.prenom || "";
                                    newEpoux[index].nomNaissance = client.nom || "";
                                    newEpoux[index].adresseComplete = client.adresse || "";
                                    newEpoux[index].dateNaissance = client.date_naissance || "";
                                    newEpoux[index].lieuNaissance = client.lieu_naissance || "";
                                    newEpoux[index].nationalite = client.nationalite || "";
                                    newEpoux[index].profession = client.profession || "";
                                    newEpoux[index].telephone = client.telephone || "";
                                    newEpoux[index].email = client.email || "";
                                    newEpoux[index].typeIdentite = client.type_identite || "";
                                    newEpoux[index].numeroIdentite = client.numero_identite || "";
                                    
                                    // Extraire la situation familiale et régime matrimonial
                                    let situationFamiliale = "";
                                    let regimeMatrimonial = "";
                                    
                                    // Essayer d'abord situation_matrimoniale
                                    if (client.situation_matrimoniale) {
                                      if (typeof client.situation_matrimoniale === 'object' && client.situation_matrimoniale !== null) {
                                        situationFamiliale = client.situation_matrimoniale.situation_familiale || "";
                                        regimeMatrimonial = client.situation_matrimoniale.regime_matrimonial || "";
                                      } else if (typeof client.situation_matrimoniale === 'string') {
                                        situationFamiliale = client.situation_matrimoniale;
                                      }
                                    }
                                    
                                    // Si pas trouvé, essayer situation_familiale
                                    if (!situationFamiliale && client.situation_familiale) {
                                      if (typeof client.situation_familiale === 'object' && client.situation_familiale !== null) {
                                        situationFamiliale = client.situation_familiale.situation_familiale || "";
                                        regimeMatrimonial = client.situation_familiale.regime_matrimonial || "";
                                      } else if (typeof client.situation_familiale === 'string') {
                                        situationFamiliale = client.situation_familiale;
                                      }
                                    }
                                    
                                    // Si pas trouvé dans les objets, essayer le champ direct
                                    if (!regimeMatrimonial && client.regime_matrimonial) {
                                      regimeMatrimonial = client.regime_matrimonial;
                                    }
                                    
                                    newEpoux[index].situationMatrimoniale = situationFamiliale || "marie";
                                    newEpoux[index].regimeMatrimonial = regimeMatrimonial || "";
                                    newEpoux[index].dateMariage = client.date_mariage || "";
                                  }
                                }
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                              <SelectContent>
                                {clients.map((c) => (
                                  <SelectItem key={c.id} value={c.id}>
                                    {c.nom} {c.prenom}
                                  </SelectItem>
                                ))}
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Informations civiles */}
                          <div className="space-y-2">
                            <Label>Nom <span className="text-red-500">*</span></Label>
                            <Input
                              value={epoux.nom}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].nom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Prénom <span className="text-red-500">*</span></Label>
                            <Input
                              value={epoux.prenom}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].prenom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nom de naissance</Label>
                            <Input
                              value={epoux.nomNaissance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].nomNaissance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date de naissance <span className="text-red-500">*</span></Label>
                            <Input
                              type="date"
                              value={epoux.dateNaissance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].dateNaissance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Lieu de naissance</Label>
                            <Input
                              value={epoux.lieuNaissance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].lieuNaissance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nationalité</Label>
                            <Input
                              value={epoux.nationalite}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].nationalite = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Profession</Label>
                            <Input
                              value={epoux.profession}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].profession = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète <span className="text-red-500">*</span></Label>
                            <Input
                              value={epoux.adresseComplete}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].adresseComplete = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Téléphone</Label>
                            <Input
                              value={epoux.telephone}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].telephone = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Email</Label>
                            <Input
                              type="email"
                              value={epoux.email}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].email = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          {/* Régime matrimonial */}
                          <div className="space-y-2">
                            <Label>Régime matrimonial <span className="text-red-500">*</span></Label>
                            <Select 
                              value={epoux.regimeMatrimonial}
                              onValueChange={(value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].regimeMatrimonial = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                                <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                                <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                                <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                                <SelectItem value="autre">Autre (préciser)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {epoux.regimeMatrimonial === "autre" && (
                            <div className="space-y-2">
                              <Label>Préciser le régime</Label>
                              <Input
                                value={epoux.regimeMatrimonialAutre}
                                onChange={(e) => {
                                  const newEpoux = [...donationEntreEpouxData.epoux];
                                  newEpoux[index].regimeMatrimonialAutre = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                                }}
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Date du mariage <span className="text-red-500">*</span></Label>
                            <Input
                              type="date"
                              value={epoux.dateMariage}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].dateMariage = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Lieu du mariage</Label>
                            <Input
                              value={epoux.lieuMariage}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].lieuMariage = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Existence d'un contrat de mariage</Label>
                            <Select 
                              value={epoux.existenceContratMariage}
                              onValueChange={(value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].existenceContratMariage = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="oui">Oui (joindre copie)</SelectItem>
                                <SelectItem value="non">Non</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          {/* Pièce d'identité */}
                          <div className="space-y-2">
                            <Label>Type de pièce d'identité</Label>
                            <Select 
                              value={epoux.typeIdentite}
                              onValueChange={(value) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].typeIdentite = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="CNI">Carte Nationale d'Identité</SelectItem>
                                <SelectItem value="Passeport">Passeport</SelectItem>
                                <SelectItem value="Titre de séjour">Titre de séjour</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro d'identité</Label>
                            <Input
                              value={epoux.numeroIdentite}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].numeroIdentite = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Autorité de délivrance</Label>
                            <Input
                              value={epoux.autoriteDelivrance}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].autoriteDelivrance = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Date d'expiration</Label>
                            <Input
                              type="date"
                              value={epoux.dateExpiration}
                              onChange={(e) => {
                                const newEpoux = [...donationEntreEpouxData.epoux];
                                newEpoux[index].dateExpiration = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, epoux: newEpoux});
                              }}
                            />
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {/* 3. Enfants et héritiers potentiels */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Enfants et héritiers potentiels</h3>
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        ℹ️ Ces informations sont obligatoires pour déterminer les limites juridiques de la donation (réserve héréditaire)
                      </p>
                    </div>

                    {/* A. Enfants communs */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">A. Enfants communs</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.enfantsCommuns.map(e => e.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              enfantsCommuns: [...donationEntreEpouxData.enfantsCommuns, { id: newId, nom: "", prenom: "", dateNaissance: "" }]
                            });
                          }}
                        >
                          + Ajouter enfant commun
                        </Button>
                      </div>

                      {donationEntreEpouxData.enfantsCommuns.map((enfant, index) => (
                        <div key={enfant.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <Input
                              placeholder="Nom"
                              value={enfant.nom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsCommuns];
                                newEnfants[index].nom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsCommuns: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Prénom"
                              value={enfant.prenom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsCommuns];
                                newEnfants[index].prenom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsCommuns: newEnfants});
                              }}
                            />
                            <div className="flex gap-2">
                              <Input
                                type="date"
                                placeholder="Date de naissance"
                                value={enfant.dateNaissance}
                                onChange={(e) => {
                                  const newEnfants = [...donationEntreEpouxData.enfantsCommuns];
                                  newEnfants[index].dateNaissance = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, enfantsCommuns: newEnfants});
                                }}
                              />
                              {donationEntreEpouxData.enfantsCommuns.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      enfantsCommuns: donationEntreEpouxData.enfantsCommuns.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* B. Enfants non communs */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">B. Enfants non communs (importante limitation de quotité disponible)</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.enfantsNonCommuns.map(e => e.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              enfantsNonCommuns: [...donationEntreEpouxData.enfantsNonCommuns, { id: newId, epoux: "1", nom: "", prenom: "", dateNaissance: "" }]
                            });
                          }}
                        >
                          + Ajouter enfant non commun
                        </Button>
                      </div>

                      {donationEntreEpouxData.enfantsNonCommuns.map((enfant, index) => (
                        <div key={enfant.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Select
                              value={enfant.epoux}
                              onValueChange={(value) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                newEnfants[index].epoux = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Époux..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="1">Époux 1</SelectItem>
                                <SelectItem value="2">Époux 2</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Nom"
                              value={enfant.nom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                newEnfants[index].nom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                              }}
                            />
                            <Input
                              placeholder="Prénom"
                              value={enfant.prenom}
                              onChange={(e) => {
                                const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                newEnfants[index].prenom = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                              }}
                            />
                            <div className="flex gap-2">
                              <Input
                                type="date"
                                placeholder="Date de naissance"
                                value={enfant.dateNaissance}
                                onChange={(e) => {
                                  const newEnfants = [...donationEntreEpouxData.enfantsNonCommuns];
                                  newEnfants[index].dateNaissance = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, enfantsNonCommuns: newEnfants});
                                }}
                              />
                              {donationEntreEpouxData.enfantsNonCommuns.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      enfantsNonCommuns: donationEntreEpouxData.enfantsNonCommuns.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* C. Parents vivants */}
                    <div className="space-y-3">
                      <Label className="font-medium">C. Présence d'autres héritiers réservataires</Label>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Parents du défunt (époux 1) vivants ?</Label>
                          <Select 
                            value={donationEntreEpouxData.parentsVivants.epoux1}
                            onValueChange={(value) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              parentsVivants: {...donationEntreEpouxData.parentsVivants, epoux1: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                        <div className="space-y-2">
                          <Label>Parents du défunt (époux 2) vivants ?</Label>
                          <Select 
                            value={donationEntreEpouxData.parentsVivants.epoux2}
                            onValueChange={(value) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              parentsVivants: {...donationEntreEpouxData.parentsVivants, epoux2: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="oui">Oui</SelectItem>
                              <SelectItem value="non">Non</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      </div>
                    </div>

                    {/* D. Autres héritiers */}
                    <div className="space-y-2">
                      <Label>D. Autres héritiers (frères/sœurs, etc.)</Label>
                      <textarea
                        className="w-full min-h-[80px] p-2 border rounded-md"
                        value={donationEntreEpouxData.autresHeritiers}
                        onChange={(e) => setDonationEntreEpouxData({...donationEntreEpouxData, autresHeritiers: e.target.value})}
                        placeholder="Préciser les autres héritiers potentiels..."
                      />
                    </div>
                  </div>

                  {/* 4. Patrimoine des époux */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Patrimoine des époux</h3>
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        ℹ️ Indispensable pour savoir ce qui peut être donné selon le régime matrimonial
                      </p>
                    </div>

                    {/* A. Biens propres époux 1 */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">A. Biens propres Époux 1</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.biensPropresEpoux1.map(b => b.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              biensPropresEpoux1: [...donationEntreEpouxData.biensPropresEpoux1, { id: newId, type: "", description: "", valeur: "", origine: "" }]
                            });
                          }}
                        >
                          + Ajouter bien
                        </Button>
                      </div>

                      {donationEntreEpouxData.biensPropresEpoux1.map((bien, index) => (
                        <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Select
                              value={bien.type}
                              onValueChange={(value) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                newBiens[index].type = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Type..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="immobilier">Immobilier</SelectItem>
                                <SelectItem value="meuble">Meuble</SelectItem>
                                <SelectItem value="financier">Financier</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Description"
                              value={bien.description}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                newBiens[index].description = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                              }}
                            />
                            <Input
                              placeholder="Valeur (€)"
                              value={bien.valeur}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                newBiens[index].valeur = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                              }}
                            />
                            <div className="flex gap-2">
                              <Select
                                value={bien.origine}
                                onValueChange={(value) => {
                                  const newBiens = [...donationEntreEpouxData.biensPropresEpoux1];
                                  newBiens[index].origine = value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux1: newBiens});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Origine..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="heritage">Héritage</SelectItem>
                                  <SelectItem value="donation">Donation</SelectItem>
                                  <SelectItem value="achat">Achat</SelectItem>
                                </SelectContent>
                              </Select>
                              {donationEntreEpouxData.biensPropresEpoux1.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      biensPropresEpoux1: donationEntreEpouxData.biensPropresEpoux1.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* B. Biens propres époux 2 */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">B. Biens propres Époux 2</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.biensPropresEpoux2.map(b => b.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              biensPropresEpoux2: [...donationEntreEpouxData.biensPropresEpoux2, { id: newId, type: "", description: "", valeur: "", origine: "" }]
                            });
                          }}
                        >
                          + Ajouter bien
                        </Button>
                      </div>

                      {donationEntreEpouxData.biensPropresEpoux2.map((bien, index) => (
                        <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Select
                              value={bien.type}
                              onValueChange={(value) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                newBiens[index].type = value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                              }}
                            >
                              <SelectTrigger><SelectValue placeholder="Type..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="immobilier">Immobilier</SelectItem>
                                <SelectItem value="meuble">Meuble</SelectItem>
                                <SelectItem value="financier">Financier</SelectItem>
                                <SelectItem value="autre">Autre</SelectItem>
                              </SelectContent>
                            </Select>
                            <Input
                              placeholder="Description"
                              value={bien.description}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                newBiens[index].description = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                              }}
                            />
                            <Input
                              placeholder="Valeur (€)"
                              value={bien.valeur}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                newBiens[index].valeur = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                              }}
                            />
                            <div className="flex gap-2">
                              <Select
                                value={bien.origine}
                                onValueChange={(value) => {
                                  const newBiens = [...donationEntreEpouxData.biensPropresEpoux2];
                                  newBiens[index].origine = value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensPropresEpoux2: newBiens});
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Origine..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="heritage">Héritage</SelectItem>
                                  <SelectItem value="donation">Donation</SelectItem>
                                  <SelectItem value="achat">Achat</SelectItem>
                                </SelectContent>
                              </Select>
                              {donationEntreEpouxData.biensPropresEpoux2.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      biensPropresEpoux2: donationEntreEpouxData.biensPropresEpoux2.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* C. Biens communs */}
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <Label className="font-medium">C. Biens communs (si régime communautaire)</Label>
                        <Button
                          type="button"
                          size="sm"
                          variant="outline"
                          onClick={() => {
                            const newId = Math.max(...donationEntreEpouxData.biensCommuns.map(b => b.id), 0) + 1;
                            setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              biensCommuns: [...donationEntreEpouxData.biensCommuns, { id: newId, description: "", valeur: "", partEpoux1: "50", partEpoux2: "50" }]
                            });
                          }}
                        >
                          + Ajouter bien commun
                        </Button>
                      </div>

                      {donationEntreEpouxData.biensCommuns.map((bien, index) => (
                        <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                          <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <Input
                              placeholder="Description"
                              className="md:col-span-2"
                              value={bien.description}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensCommuns];
                                newBiens[index].description = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                              }}
                            />
                            <Input
                              placeholder="Valeur (€)"
                              value={bien.valeur}
                              onChange={(e) => {
                                const newBiens = [...donationEntreEpouxData.biensCommuns];
                                newBiens[index].valeur = e.target.value;
                                setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                              }}
                            />
                            <div className="flex gap-2 items-center">
                              <Input
                                placeholder="Part E1 %"
                                value={bien.partEpoux1}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.biensCommuns];
                                  newBiens[index].partEpoux1 = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                                }}
                              />
                              <span className="text-sm">/</span>
                              <Input
                                placeholder="Part E2 %"
                                value={bien.partEpoux2}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.biensCommuns];
                                  newBiens[index].partEpoux2 = e.target.value;
                                  setDonationEntreEpouxData({...donationEntreEpouxData, biensCommuns: newBiens});
                                }}
                              />
                              {donationEntreEpouxData.biensCommuns.length > 1 && (
                                <Button
                                  type="button"
                                  size="sm"
                                  variant="destructive"
                                  onClick={() => {
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      biensCommuns: donationEntreEpouxData.biensCommuns.filter((_, i) => i !== index)
                                    });
                                  }}
                                >
                                  ✕
                                </Button>
                              )}
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>

                    {/* D. Droits particuliers */}
                    <div className="space-y-3">
                      <Label className="font-medium">D. Droits éventuels sur des biens</Label>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Nue-propriété / usufruit</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.nueProprieteBiens}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, nueProprieteBiens: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Usufruit sur biens</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.usufruitBiens}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, usufruitBiens: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Biens indivis</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.biensIndivis}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, biensIndivis: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Biens grevés d'hypothèques</Label>
                          <textarea
                            className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                            value={donationEntreEpouxData.droitsParticuliers.biensHypotheques}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              droitsParticuliers: {...donationEntreEpouxData.droitsParticuliers, biensHypotheques: e.target.value}
                            })}
                            placeholder="Détails..."
                          />
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 5. Clauses de donation - Donation au dernier vivant */}
                  {(donationEntreEpouxData.typeDonation === "au_dernier_vivant" || donationEntreEpouxData.typeDonation === "mixte") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Clauses de donation au dernier vivant</h3>
                      
                      {/* Options successorales */}
                      <div className="space-y-3">
                        <Label className="font-medium">Options successorales offertes au conjoint survivant</Label>
                        <div className="grid grid-cols-1 gap-2">
                          {[
                            { value: "pleine_propriete_quotite", label: "Pleine propriété de la quotité disponible" },
                            { value: "usufruit_universel", label: "Usufruit universel de la succession" },
                            { value: "quart_pleine_3quarts_usufruit", label: "1/4 en pleine propriété + 3/4 en usufruit" },
                            { value: "choix_multiple", label: "Choix entre plusieurs options au décès" },
                            { value: "attribution_biens_specifiques", label: "Attribution de biens spécifiques" }
                          ].map(opt => (
                            <div key={opt.value} className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id={`opt_${opt.value}`}
                                checked={donationEntreEpouxData.donationDernierVivant.optionsSuccessorales.includes(opt.value)}
                                onChange={(e) => {
                                  const current = donationEntreEpouxData.donationDernierVivant.optionsSuccessorales;
                                  const newOpts = e.target.checked 
                                    ? [...current, opt.value]
                                    : current.filter(o => o !== opt.value);
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationDernierVivant: {...donationEntreEpouxData.donationDernierVivant, optionsSuccessorales: newOpts}
                                  });
                                }}
                              />
                              <label htmlFor={`opt_${opt.value}`} className="text-sm cursor-pointer">{opt.label}</label>
                            </div>
                          ))}
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.optionsSuccessorales.includes("attribution_biens_specifiques") && (
                          <div className="space-y-2 mt-3">
                            <Label>Préciser les biens spécifiques</Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={donationEntreEpouxData.donationDernierVivant.biensSpecifiques}
                              onChange={(e) => setDonationEntreEpouxData({
                                ...donationEntreEpouxData,
                                donationDernierVivant: {...donationEntreEpouxData.donationDernierVivant, biensSpecifiques: e.target.value}
                              })}
                              placeholder="Ex: logement familial situé à..."
                            />
                          </div>
                        )}
                      </div>

                      {/* Clause d'attribution préférentielle */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="attr_pref_active"
                            checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationDernierVivant: {
                                ...donationEntreEpouxData.donationDernierVivant,
                                attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="attr_pref_active" className="font-medium cursor-pointer">Clause d'attribution préférentielle</Label>
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.active && (
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3 ml-6">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_logement"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.logementFamilial}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, logementFamilial: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_logement" className="text-sm cursor-pointer">Logement familial</label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_mobilier"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.mobilier}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, mobilier: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_mobilier" className="text-sm cursor-pointer">Mobilier</label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_professionnel"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.bienProfessionnel}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, bienProfessionnel: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_professionnel" className="text-sm cursor-pointer">Bien professionnel</label>
                            </div>
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="attr_vehicule"
                                checked={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.vehicule}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, vehicule: e.target.checked}
                                  }
                                })}
                              />
                              <label htmlFor="attr_vehicule" className="text-sm cursor-pointer">Véhicule</label>
                            </div>
                            <div className="space-y-2 md:col-span-2">
                              <Label>Autres biens</Label>
                              <Input
                                placeholder="Préciser..."
                                value={donationEntreEpouxData.donationDernierVivant.attributionPreferentielle.autresBiens}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    attributionPreferentielle: {...donationEntreEpouxData.donationDernierVivant.attributionPreferentielle, autresBiens: e.target.value}
                                  }
                                })}
                              />
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Clause de préciput */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="preciput_active"
                            checked={donationEntreEpouxData.donationDernierVivant.clausePreciput.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationDernierVivant: {
                                ...donationEntreEpouxData.donationDernierVivant,
                                clausePreciput: {...donationEntreEpouxData.donationDernierVivant.clausePreciput, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="preciput_active" className="font-medium cursor-pointer">Clause de préciput (prendre un bien avant tout partage)</Label>
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.clausePreciput.active && (
                          <div className="space-y-3 ml-6">
                            <div className="space-y-2">
                              <Label>Description du bien</Label>
                              <textarea
                                className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                                value={donationEntreEpouxData.donationDernierVivant.clausePreciput.descriptionBien}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clausePreciput: {...donationEntreEpouxData.donationDernierVivant.clausePreciput, descriptionBien: e.target.value}
                                  }
                                })}
                                placeholder="Décrire le bien concerné..."
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Effet</Label>
                              <Select
                                value={donationEntreEpouxData.donationDernierVivant.clausePreciput.effet}
                                onValueChange={(value) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clausePreciput: {...donationEntreEpouxData.donationDernierVivant.clausePreciput, effet: value}
                                  }
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="hors_part">Hors part successorale</SelectItem>
                                  <SelectItem value="valorise_part">Valorisé dans la part</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Clause de cantonnement */}
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="cantonnement"
                          checked={donationEntreEpouxData.donationDernierVivant.clauseCantonnement}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            donationDernierVivant: {...donationEntreEpouxData.donationDernierVivant, clauseCantonnement: e.target.checked}
                          })}
                        />
                        <label htmlFor="cantonnement" className="text-sm cursor-pointer">
                          Clause de cantonnement (permet au survivant de renoncer à une partie pour optimiser la fiscalité)
                        </label>
                      </div>

                      {/* Clause d'exclusion */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="exclusion_active"
                            checked={donationEntreEpouxData.donationDernierVivant.clauseExclusion.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationDernierVivant: {
                                ...donationEntreEpouxData.donationDernierVivant,
                                clauseExclusion: {...donationEntreEpouxData.donationDernierVivant.clauseExclusion, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="exclusion_active" className="font-medium cursor-pointer">Clause d'exclusion / exception</Label>
                        </div>
                        {donationEntreEpouxData.donationDernierVivant.clauseExclusion.active && (
                          <div className="space-y-3 ml-6">
                            <div className="space-y-2">
                              <Label>Biens exclus du champ de la donation</Label>
                              <textarea
                                className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                                value={donationEntreEpouxData.donationDernierVivant.clauseExclusion.biensExclus}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clauseExclusion: {...donationEntreEpouxData.donationDernierVivant.clauseExclusion, biensExclus: e.target.value}
                                  }
                                })}
                                placeholder="Liste des biens exclus..."
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Cas particuliers (biens professionnels, héritages...)</Label>
                              <textarea
                                className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                                value={donationEntreEpouxData.donationDernierVivant.clauseExclusion.casParticuliers}
                                onChange={(e) => setDonationEntreEpouxData({
                                  ...donationEntreEpouxData,
                                  donationDernierVivant: {
                                    ...donationEntreEpouxData.donationDernierVivant,
                                    clauseExclusion: {...donationEntreEpouxData.donationDernierVivant.clauseExclusion, casParticuliers: e.target.value}
                                  }
                                })}
                                placeholder="Précisions..."
                              />
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 6. Clauses de donation - Donation de biens présents */}
                  {(donationEntreEpouxData.typeDonation === "biens_presents" || donationEntreEpouxData.typeDonation === "mixte") && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Clauses de donation de biens présents</h3>
                      
                      <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                        <p className="text-sm text-orange-800">
                          ⚠️ Prend effet immédiatement - Plus rare et très encadrée juridiquement
                        </p>
                      </div>

                      {/* Biens donnés */}
                      <div className="space-y-3">
                        <div className="flex items-center justify-between">
                          <Label className="font-medium">Biens donnés immédiatement</Label>
                          <Button
                            type="button"
                            size="sm"
                            variant="outline"
                            onClick={() => {
                              const newId = Math.max(...donationEntreEpouxData.donationBiensPresents.biensDonnes.map(b => b.id), 0) + 1;
                              setDonationEntreEpouxData({
                                ...donationEntreEpouxData,
                                donationBiensPresents: {
                                  ...donationEntreEpouxData.donationBiensPresents,
                                  biensDonnes: [...donationEntreEpouxData.donationBiensPresents.biensDonnes, { id: newId, nature: "", description: "", valeur: "", regimePropriete: "" }]
                                }
                              });
                            }}
                          >
                            + Ajouter bien
                          </Button>
                        </div>

                        {donationEntreEpouxData.donationBiensPresents.biensDonnes.map((bien, index) => (
                          <div key={bien.id} className="p-3 border rounded-lg bg-muted/10">
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                              <Select
                                value={bien.nature}
                                onValueChange={(value) => {
                                  const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                  newBiens[index].nature = value;
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                  });
                                }}
                              >
                                <SelectTrigger><SelectValue placeholder="Nature..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="immobilier">Immobilier</SelectItem>
                                  <SelectItem value="financier">Financier</SelectItem>
                                  <SelectItem value="meuble">Meuble</SelectItem>
                                  <SelectItem value="entreprise">Entreprise</SelectItem>
                                  <SelectItem value="autre">Autre</SelectItem>
                                </SelectContent>
                              </Select>
                              <Input
                                placeholder="Description complète"
                                value={bien.description}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                  newBiens[index].description = e.target.value;
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                  });
                                }}
                              />
                              <Input
                                placeholder="Valeur (€)"
                                value={bien.valeur}
                                onChange={(e) => {
                                  const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                  newBiens[index].valeur = e.target.value;
                                  setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                  });
                                }}
                              />
                              <div className="flex gap-2">
                                <Select
                                  value={bien.regimePropriete}
                                  onValueChange={(value) => {
                                    const newBiens = [...donationEntreEpouxData.donationBiensPresents.biensDonnes];
                                    newBiens[index].regimePropriete = value;
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, biensDonnes: newBiens}
                                    });
                                  }}
                                >
                                  <SelectTrigger><SelectValue placeholder="Régime..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="propre">Propre</SelectItem>
                                    <SelectItem value="commun">Commun</SelectItem>
                                    <SelectItem value="indivis">Indivis</SelectItem>
                                  </SelectContent>
                                </Select>
                                {donationEntreEpouxData.donationBiensPresents.biensDonnes.length > 1 && (
                                  <Button
                                    type="button"
                                    size="sm"
                                    variant="destructive"
                                    onClick={() => {
                                      setDonationEntreEpouxData({
                                        ...donationEntreEpouxData,
                                        donationBiensPresents: {
                                          ...donationEntreEpouxData.donationBiensPresents,
                                          biensDonnes: donationEntreEpouxData.donationBiensPresents.biensDonnes.filter((_, i) => i !== index)
                                        }
                                      });
                                    }}
                                  >
                                    ✕
                                  </Button>
                                )}
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>

                      {/* Irrévocabilité */}
                      <div className="space-y-2">
                        <Label>Déclaration d'irrévocabilité</Label>
                        <Select
                          value={donationEntreEpouxData.donationBiensPresents.irrevocabilite}
                          onValueChange={(value) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, irrevocabilite: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (donation irrévocable)</SelectItem>
                            <SelectItem value="non">Non (sauf clauses spécifiques)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Clause de retour */}
                      <div className="space-y-2">
                        <Label>Clause de retour en cas de prédécès</Label>
                        <Select
                          value={donationEntreEpouxData.donationBiensPresents.clauseRetourPredeces}
                          onValueChange={(value) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            donationBiensPresents: {...donationEntreEpouxData.donationBiensPresents, clauseRetourPredeces: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="oui">Oui (retour automatique)</SelectItem>
                            <SelectItem value="non">Non (pas de retour)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Réserve d'usufruit */}
                      <div className="space-y-3 p-4 border rounded-lg bg-muted/10">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="usufruit_active"
                            checked={donationEntreEpouxData.donationBiensPresents.reserveUsufruit.active}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              donationBiensPresents: {
                                ...donationEntreEpouxData.donationBiensPresents,
                                reserveUsufruit: {...donationEntreEpouxData.donationBiensPresents.reserveUsufruit, active: e.target.checked}
                              }
                            })}
                          />
                          <Label htmlFor="usufruit_active" className="font-medium cursor-pointer">Réserve d'usufruit</Label>
                        </div>
                        {donationEntreEpouxData.donationBiensPresents.reserveUsufruit.active && (
                          <div className="space-y-2 ml-6">
                            <Label>Conditions</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationEntreEpouxData.donationBiensPresents.reserveUsufruit.conditions}
                              onChange={(e) => setDonationEntreEpouxData({
                                ...donationEntreEpouxData,
                                donationBiensPresents: {
                                  ...donationEntreEpouxData.donationBiensPresents,
                                  reserveUsufruit: {...donationEntreEpouxData.donationBiensPresents.reserveUsufruit, conditions: e.target.value}
                                }
                              })}
                              placeholder="Préciser les conditions de l'usufruit réservé..."
                            />
                          </div>
                        )}
                      </div>
                    </div>
                  )}

                  {/* 7. Clauses communes aux deux types de donation */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses communes</h3>
                    
                    <div className="space-y-3">
                      <div className="space-y-2">
                        <Label>Administration et gestion</Label>
                        <textarea
                          className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                          value={donationEntreEpouxData.clausesCommunes.administrationGestion}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, administrationGestion: e.target.value}
                          })}
                          placeholder="Qui gère les biens ? Usufruit, nue-propriété, pleine propriété..."
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Condition suspensive ou résolutoire (très rare mais nécessaire dans certains cas)</Label>
                        <textarea
                          className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                          value={donationEntreEpouxData.clausesCommunes.conditionSuspensiveResolutoire}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, conditionSuspensiveResolutoire: e.target.value}
                          })}
                          placeholder="Préciser la condition..."
                        />
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptation_beneficiaire"
                          checked={donationEntreEpouxData.clausesCommunes.acceptationBeneficiaire}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, acceptationBeneficiaire: e.target.checked}
                          })}
                        />
                        <label htmlFor="acceptation_beneficiaire" className="text-sm cursor-pointer">
                          Acceptation claire et non équivoque de l'époux bénéficiaire <span className="text-red-500">*</span> (obligatoire pour la validité)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="renonciation_droits"
                          checked={donationEntreEpouxData.clausesCommunes.renonciationDroitsSuccessorauxStandards}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, renonciationDroitsSuccessorauxStandards: e.target.checked}
                          })}
                        />
                        <label htmlFor="renonciation_droits" className="text-sm cursor-pointer">
                          Renonciation aux droits successoraux standards
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="non_revocation"
                          checked={donationEntreEpouxData.clausesCommunes.clauseNonRevocation}
                          onChange={(e) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, clauseNonRevocation: e.target.checked}
                          })}
                        />
                        <label htmlFor="non_revocation" className="text-sm cursor-pointer">
                          Clause de non-révocation (selon type de donation)
                        </label>
                      </div>

                      {/* Révocabilité - Section complète obligatoire */}
                      <div className="space-y-3 pt-3 mt-3 border-t-2 border-blue-200 bg-blue-50/30 p-4 rounded-lg">
                        <h4 className="font-medium text-base text-blue-900">🔄 Régime de révocabilité de la donation</h4>
                        <p className="text-xs text-blue-700">
                          La donation entre époux est toujours révocable par défaut, sauf clause contraire explicite.
                        </p>
                        
                        <div className="space-y-2">
                          <Label>Révocabilité <span className="text-red-500">*</span></Label>
                          <Select
                            value={donationEntreEpouxData.clausesCommunes.revocabilite}
                            onValueChange={(value) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              clausesCommunes: {...donationEntreEpouxData.clausesCommunes, revocabilite: value}
                            })}
                          >
                            <SelectTrigger className="w-full">
                              <SelectValue placeholder="Sélectionner" />
                            </SelectTrigger>
                            <SelectContent>
                              <SelectItem value="revocable">Donation révocable (règle légale par défaut)</SelectItem>
                              <SelectItem value="irrevocable">Donation irrévocable (exceptionnelle – nécessite accord explicite)</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {donationEntreEpouxData.clausesCommunes.revocabilite === "revocable" && (
                          <div className="space-y-2 bg-white p-3 rounded border">
                            <Label className="text-sm font-medium">Motifs de révocation possibles</Label>
                            <div className="space-y-2">
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_survenance"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("survenance_enfants")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "survenance_enfants"]
                                      : current.filter(m => m !== "survenance_enfants");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_survenance" className="text-sm cursor-pointer">
                                  Survenance d'enfants
                                </label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_ingratitude"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("ingratitude")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "ingratitude"]
                                      : current.filter(m => m !== "ingratitude");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_ingratitude" className="text-sm cursor-pointer">
                                  Ingratitude
                                </label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_non_execution"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("non_execution")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "non_execution"]
                                      : current.filter(m => m !== "non_execution");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_non_execution" className="text-sm cursor-pointer">
                                  Non-exécution des obligations
                                </label>
                              </div>
                              <div className="flex items-center space-x-2">
                                <input
                                  type="checkbox"
                                  id="motif_revocation_libre"
                                  checked={donationEntreEpouxData.clausesCommunes.motifsRevocation?.includes("revocation_libre")}
                                  onChange={(e) => {
                                    const current = donationEntreEpouxData.clausesCommunes.motifsRevocation || [];
                                    const updated = e.target.checked 
                                      ? [...current, "revocation_libre"]
                                      : current.filter(m => m !== "revocation_libre");
                                    setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {...donationEntreEpouxData.clausesCommunes, motifsRevocation: updated}
                                    });
                                  }}
                                />
                                <label htmlFor="motif_revocation_libre" className="text-sm cursor-pointer">
                                  Révocation libre (selon option)
                                </label>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Signature par mandataire */}
                      <div className="space-y-3 pt-3 mt-3 border-t-2 border-purple-200 bg-purple-50/30 p-4 rounded-lg">
                        <h4 className="font-medium text-base text-purple-900">👤 Signature par mandataire</h4>
                        <p className="text-xs text-purple-700">
                          Si l'un des époux ne peut pas signer physiquement (hospitalisation, impossibilité de déplacement).
                        </p>
                        
                        <Label>Signature par mandataire ?</Label>
                        <Select
                          value={donationEntreEpouxData.clausesCommunes.signatureMandataire}
                          onValueChange={(value) => setDonationEntreEpouxData({
                            ...donationEntreEpouxData,
                            clausesCommunes: {...donationEntreEpouxData.clausesCommunes, signatureMandataire: value}
                          })}
                        >
                          <SelectTrigger className="w-full">
                            <SelectValue placeholder="Sélectionner" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="non">Non</SelectItem>
                            <SelectItem value="oui">Oui (hospitalisation, impossibilité)</SelectItem>
                          </SelectContent>
                        </Select>

                        {donationEntreEpouxData.clausesCommunes.signatureMandataire === "oui" && (
                          <div className="space-y-4 bg-muted/30 p-4 rounded-lg">
                            <div className="space-y-3">
                              <h4 className="font-medium text-sm">Mandataire pour Époux 1</h4>
                              <div className="grid grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label className="text-xs">Nom du mandataire</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux1.nom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux1: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux1, nom: e.target.value}
                                      }
                                    })}
                                    placeholder="Nom"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label className="text-xs">Prénom</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux1.prenom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux1: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux1, prenom: e.target.value}
                                      }
                                    })}
                                    placeholder="Prénom"
                                  />
                                </div>
                              </div>
                              <div className="space-y-2">
                                <Label className="text-xs">Type de procuration <span className="text-red-500">*</span></Label>
                                <Select
                                  value={donationEntreEpouxData.clausesCommunes.mandataireEpoux1.typeProcuration}
                                  onValueChange={(value) => setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    clausesCommunes: {
                                      ...donationEntreEpouxData.clausesCommunes,
                                      mandataireEpoux1: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux1, typeProcuration: value}
                                    }
                                  })}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="sous_seing_prive">Procuration sous seing privé</SelectItem>
                                    <SelectItem value="acte_notarie">Acte notarié</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>

                            <div className="space-y-3">
                              <h4 className="font-medium text-sm">Mandataire pour Époux 2</h4>
                              <div className="grid grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label className="text-xs">Nom du mandataire</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux2.nom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux2: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux2, nom: e.target.value}
                                      }
                                    })}
                                    placeholder="Nom"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label className="text-xs">Prénom</Label>
                                  <Input
                                    value={donationEntreEpouxData.clausesCommunes.mandataireEpoux2.prenom}
                                    onChange={(e) => setDonationEntreEpouxData({
                                      ...donationEntreEpouxData,
                                      clausesCommunes: {
                                        ...donationEntreEpouxData.clausesCommunes,
                                        mandataireEpoux2: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux2, prenom: e.target.value}
                                      }
                                    })}
                                    placeholder="Prénom"
                                  />
                                </div>
                              </div>
                              <div className="space-y-2">
                                <Label className="text-xs">Type de procuration <span className="text-red-500">*</span></Label>
                                <Select
                                  value={donationEntreEpouxData.clausesCommunes.mandataireEpoux2.typeProcuration}
                                  onValueChange={(value) => setDonationEntreEpouxData({
                                    ...donationEntreEpouxData,
                                    clausesCommunes: {
                                      ...donationEntreEpouxData.clausesCommunes,
                                      mandataireEpoux2: {...donationEntreEpouxData.clausesCommunes.mandataireEpoux2, typeProcuration: value}
                                    }
                                  })}
                                >
                                  <SelectTrigger>
                                    <SelectValue placeholder="Sélectionner" />
                                  </SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="sous_seing_prive">Procuration sous seing privé</SelectItem>
                                    <SelectItem value="acte_notarie">Acte notarié</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>
                          </div>
                        )}
                      </div>

                      {/* Information sur les effets successoraux (OBLIGATOIRE) */}
                      <div className="p-4 bg-amber-50 border-2 border-amber-300 rounded-lg space-y-3 mt-4">
                        <h4 className="font-medium text-sm text-amber-900">⚖️ Information sur les effets successoraux</h4>
                        <p className="text-xs text-amber-800">
                          Les époux doivent être informés des limites légales de la donation, notamment en présence d'enfants non communs, 
                          de la réserve héréditaire, et des cas de réduction possibles.
                        </p>
                        <div className="flex items-start space-x-2">
                          <input
                            type="checkbox"
                            id="information_effets"
                            checked={donationEntreEpouxData.clausesCommunes.informationEffetsSuccessoraux}
                            onChange={(e) => setDonationEntreEpouxData({
                              ...donationEntreEpouxData,
                              clausesCommunes: {...donationEntreEpouxData.clausesCommunes, informationEffetsSuccessoraux: e.target.checked}
                            })}
                            className="mt-1"
                          />
                          <label htmlFor="information_effets" className="text-sm cursor-pointer">
                            <span className="text-red-500 font-bold">*</span> Les époux reconnaissent avoir été pleinement informés des effets successoraux 
                            de cette donation, des limites légales, de la réserve des enfants non communs, et de l'impact sur la succession 
                            <span className="block mt-1 text-xs text-amber-700 font-medium">(Déclaration obligatoire)</span>
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 8. Documents à joindre / à collecter */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Documents à joindre / à collecter</h3>
                    
                    <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                      <p className="text-sm text-blue-800">
                        📌 <strong>Documents obligatoires :</strong> pièces d'identité, livret de famille, acte de mariage, contrat de mariage (si existant), justificatifs de domicile
                      </p>
                    </div>

                    {/* Documents Époux 1 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Époux 1</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité E1 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e1_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Livret famille E1 */}
                        <div className="space-y-2">
                          <Label>Livret de famille <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e1_livret"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1LivretFamilleFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_livret" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1LivretFamilleFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1LivretFamilleFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1LivretFamilleFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte mariage E1 */}
                        <div className="space-y-2">
                          <Label>Acte de mariage <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_e1_mariage"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1ActeMariageFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_mariage" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1ActeMariageFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1ActeMariageFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1ActeMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Contrat mariage E1 */}
                        {donationEntreEpouxData.epoux[0].existenceContratMariage === "oui" && (
                          <div className="space-y-2">
                            <Label>Contrat de mariage</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="donation_e1_contrat"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setDonationEpoux1ContratMariageFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="donation_e1_contrat" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {donationEpoux1ContratMariageFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {donationEpoux1ContratMariageFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setDonationEpoux1ContratMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* Justificatif domicile E1 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e1_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux1DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e1_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux1DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux1DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux1DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents Époux 2 */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents Époux 2</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce d'identité E2 */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité (recto-verso) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e2_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2IdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2IdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2IdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2IdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Livret famille E2 */}
                        <div className="space-y-2">
                          <Label>Livret de famille <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e2_livret"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2LivretFamilleFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_livret" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2LivretFamilleFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2LivretFamilleFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2LivretFamilleFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Acte mariage E2 */}
                        <div className="space-y-2">
                          <Label>Acte de mariage <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_e2_mariage"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2ActeMariageFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_mariage" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2ActeMariageFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2ActeMariageFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2ActeMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Contrat mariage E2 */}
                        {donationEntreEpouxData.epoux[1].existenceContratMariage === "oui" && (
                          <div className="space-y-2">
                            <Label>Contrat de mariage</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="donation_e2_contrat"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setDonationEpoux2ContratMariageFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="donation_e2_contrat" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {donationEpoux2ContratMariageFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {donationEpoux2ContratMariageFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setDonationEpoux2ContratMariageFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* Justificatif domicile E2 */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile (&lt; 3 mois) <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_e2_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEpoux2DomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_e2_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEpoux2DomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEpoux2DomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEpoux2DomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents pour biens immobiliers / financiers */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents pour les biens</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Titres propriété */}
                        <div className="space-y-2">
                          <Label>Titres de propriété (biens immobiliers)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_titres"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationTitresProprieteBiensFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_titres" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationTitresProprieteBiensFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationTitresProprieteBiensFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationTitresProprieteBiensFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Estimations */}
                        <div className="space-y-2">
                          <Label>Estimations / évaluations</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_estimation"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationEstimationBiensFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_estimation" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationEstimationBiensFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationEstimationBiensFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationEstimationBiensFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Hypothèques */}
                        <div className="space-y-2">
                          <Label>Hypothèques</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_hypotheques"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationHypothequesFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_hypotheques" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationHypothequesFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationHypothequesFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationHypothequesFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Situation locative */}
                        <div className="space-y-2">
                          <Label>Situation locative</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_locative"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSituationLocativeFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_locative" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSituationLocativeFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSituationLocativeFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSituationLocativeFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* RIB */}
                        <div className="space-y-2">
                          <Label>RIB (si donation financière)</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_rib"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationRIBFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_rib" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationRIBFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationRIBFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationRIBFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Carte grise */}
                        <div className="space-y-2">
                          <Label>Carte grise véhicule</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_carte_grise"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationCarteGriseFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_carte_grise" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationCarteGriseFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationCarteGriseFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationCarteGriseFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Autres documents */}
                        <div className="space-y-2">
                          <Label>Autres documents</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_autres"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationAutresDocumentsFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_autres" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationAutresDocumentsFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationAutresDocumentsFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationAutresDocumentsFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents procuration (si mandataire) */}
                    {donationEntreEpouxData.clausesCommunes.signatureMandataire === "oui" && (
                      <div className="p-4 border-2 border-amber-300 bg-amber-50 rounded-lg space-y-4">
                        <h4 className="font-medium text-base text-amber-900">📄 Procurations</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          {/* Procuration Époux 1 */}
                          {donationEntreEpouxData.clausesCommunes.mandataireEpoux1.nom && (
                            <div className="space-y-2">
                              <Label>Procuration Époux 1 <span className="text-red-500">*</span></Label>
                              <div className="border-2 border-dashed border-amber-400 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="donation_procuration_e1"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setDonationEpoux1IdentiteFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="donation_procuration_e1" className="cursor-pointer text-sm text-amber-800">
                                  Cliquez pour joindre la procuration
                                </label>
                              </div>
                            </div>
                          )}
                          {/* Procuration Époux 2 */}
                          {donationEntreEpouxData.clausesCommunes.mandataireEpoux2.nom && (
                            <div className="space-y-2">
                              <Label>Procuration Époux 2 <span className="text-red-500">*</span></Label>
                              <div className="border-2 border-dashed border-amber-400 rounded-lg p-3">
                                <input
                                  type="file"
                                  accept="application/pdf"
                                  multiple
                                  className="hidden"
                                  id="donation_procuration_e2"
                                  onChange={(e) => {
                                    const files = Array.from(e.target.files || []);
                                    setDonationEpoux2IdentiteFiles(prev => [...prev, ...files]);
                                  }}
                                />
                                <label htmlFor="donation_procuration_e2" className="cursor-pointer text-sm text-amber-800">
                                  Cliquez pour joindre la procuration
                                </label>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    )}
                  </div>

                </div>
              </>
            )}

            {/* Formulaire Donation Simple */}
            {pendingContractType === "Donation simple (parent → enfant, etc.)" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* 1. Type de donation */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Type de donation</h3>
                    
                    <div className="space-y-3">
                      <Label>Type de donation <span className="text-red-500">*</span></Label>
                      <Select
                        value={donationSimpleData.typeDonation}
                        onValueChange={(value) => setDonationSimpleData({...donationSimpleData, typeDonation: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="biens_meubles">Donation simple de biens meubles</SelectItem>
                          <SelectItem value="biens_immobiliers">Donation simple de biens immobiliers</SelectItem>
                          <SelectItem value="sommes_argent">Donation de sommes d'argent</SelectItem>
                          <SelectItem value="nue_propriete">Donation de nue-propriété</SelectItem>
                          <SelectItem value="usufruit">Donation d'usufruit temporaire / viager</SelectItem>
                          <SelectItem value="parts_sociales">Donation de parts sociales / actions</SelectItem>
                          <SelectItem value="manuelle">Donation manuelle (argent, bijoux, voiture, mobilier…)</SelectItem>
                          <SelectItem value="mixte">Donation mixte (plusieurs biens)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-2 gap-4">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_avec_charges"
                          checked={donationSimpleData.donationAvecCharges}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationAvecCharges: e.target.checked})}
                        />
                        <label htmlFor="donation_avec_charges" className="text-sm cursor-pointer">
                          Donation avec charges
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_reserve_usufruit"
                          checked={donationSimpleData.donationAvecReserveUsufruit}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationAvecReserveUsufruit: e.target.checked})}
                        />
                        <label htmlFor="donation_reserve_usufruit" className="text-sm cursor-pointer">
                          Donation avec réserve d'usufruit
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_droit_retour"
                          checked={donationSimpleData.donationAvecDroitRetour}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationAvecDroitRetour: e.target.checked})}
                        />
                        <label htmlFor="donation_droit_retour" className="text-sm cursor-pointer">
                          Donation avec droit de retour conventionnel
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_effet_immediat"
                          checked={donationSimpleData.donationEffetImmediat}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationEffetImmediat: e.target.checked})}
                          disabled
                        />
                        <label htmlFor="donation_effet_immediat" className="text-sm cursor-pointer text-muted-foreground">
                          Donation à effet immédiat (toujours le cas)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="donation_presente_irrevocable"
                          checked={donationSimpleData.donationPresenteIrrevocable}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, donationPresenteIrrevocable: e.target.checked})}
                          disabled
                        />
                        <label htmlFor="donation_presente_irrevocable" className="text-sm cursor-pointer text-muted-foreground">
                          Donation présente et irrévocable (principe légal)
                        </label>
                      </div>
                    </div>

                    {donationSimpleData.donationAvecCharges && (
                      <div className="space-y-2">
                        <Label>Description des charges</Label>
                        <textarea
                          className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                          value={donationSimpleData.descriptionCharges}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, descriptionCharges: e.target.value})}
                          placeholder="Somme à payer, obligation, entretien..."
                        />
                      </div>
                    )}
                  </div>

                  {/* 2. Identité du donateur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du donateur</h3>
                    
                    <div className="space-y-2">
                      <Label>Sélectionner un client (optionnel)</Label>
                      <Select
                        value={donationSimpleData.donateur.clientId}
                        onValueChange={(value) => {
                          const client = clients.find(c => c.id === value);
                          if (client) {
                            // Extraire situation familiale
                            let situationFam = "";
                            // D'abord vérifier si c'est directement une string dans situation_familiale
                            if (typeof client.situation_familiale === "string") {
                              situationFam = client.situation_familiale;
                            }
                            // Sinon vérifier situation_matrimoniale
                            else if (typeof client.situation_matrimoniale === "string") {
                              situationFam = client.situation_matrimoniale;
                            }
                            // Sinon si c'est un objet, extraire les données
                            else if (client.situation_familiale && typeof client.situation_familiale === "object") {
                              const sitFam = client.situation_familiale;
                              situationFam = sitFam.situation_matrimoniale || sitFam.situation_familiale || sitFam.etat_civil || "";
                            }
                            
                            // Extraire régime matrimonial si marié
                            let regimeMat = "";
                            if (client.situation_familiale && typeof client.situation_familiale === "object") {
                              regimeMat = client.situation_familiale.regime_matrimonial || "";
                            }
                            
                            console.log('Client sélectionné:', client);
                            console.log('Situation familiale extraite:', situationFam);
                            console.log('Régime matrimonial extrait:', regimeMat);
                            
                            setDonationSimpleData({
                              ...donationSimpleData,
                              donateur: {
                                ...donationSimpleData.donateur,
                                isClient: true,
                                clientId: value,
                                nom: client.nom || "",
                                prenom: client.prenom || "",
                                nomNaissance: client.nom || "",
                                adresseComplete: client.adresse || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                profession: client.profession || "",
                                situationFamiliale: situationFam,
                                regimeMatrimonial: regimeMat,
                              }
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                        <SelectContent>
                          {clients.map((c) => (
                            <SelectItem key={c.id} value={c.id}>{c.nom} {c.prenom}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.nom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.prenom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={donationSimpleData.donateur.nomNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={donationSimpleData.donateur.dateNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={donationSimpleData.donateur.lieuNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={donationSimpleData.donateur.nationalite}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={donationSimpleData.donateur.profession}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Situation familiale <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.situationFamiliale}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, situationFamiliale: e.target.value}
                          })}
                          className="bg-muted/30"
                        />
                      </div>

                      {(donationSimpleData.donateur.situationFamiliale === "marie" || donationSimpleData.donateur.situationFamiliale === "Marié" || donationSimpleData.donateur.situationFamiliale === "marié" || donationSimpleData.donateur.situationFamiliale === "mariée" || donationSimpleData.donateur.situationFamiliale === "Mariée") && (
                        <div className="space-y-2">
                          <Label>Régime matrimonial</Label>
                          <Input
                            value={donationSimpleData.donateur.regimeMatrimonial}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donateur: {...donationSimpleData.donateur, regimeMatrimonial: e.target.value}
                            })}
                            className="bg-muted/30"
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donateur.adresseComplete}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, adresseComplete: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={donationSimpleData.donateur.telephone}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={donationSimpleData.donateur.email}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, email: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Situation fiscale (utile pour seuils d'abattement)</Label>
                        <Input
                          value={donationSimpleData.donateur.situationFiscale}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donateur: {...donationSimpleData.donateur, situationFiscale: e.target.value}
                          })}
                          placeholder="Ex: Imposable / Non imposable / Montant revenus..."
                        />
                      </div>
                    </div>
                  </div>

                  {/* 3. Identité du donataire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète du donataire</h3>
                    <p className="text-sm text-muted-foreground">Personne qui reçoit la donation</p>
                    
                    <div className="space-y-2">
                      <Label>Sélectionner un client (optionnel)</Label>
                      <Select
                        value={donationSimpleData.donataire.clientId}
                        onValueChange={(value) => {
                          const client = clients.find(c => c.id === value);
                          if (client) {
                            setDonationSimpleData({
                              ...donationSimpleData,
                              donataire: {
                                ...donationSimpleData.donataire,
                                isClient: true,
                                clientId: value,
                                nom: client.nom || "",
                                prenom: client.prenom || "",
                                nomNaissance: client.nom || "",
                                adresseComplete: client.adresse || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                profession: client.profession || "",
                              }
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                        <SelectContent>
                          {clients.map((c) => (
                            <SelectItem key={c.id} value={c.id}>{c.nom} {c.prenom}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donataire.nom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donataire.prenom}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={donationSimpleData.donataire.nomNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={donationSimpleData.donataire.dateNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={donationSimpleData.donataire.lieuNaissance}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={donationSimpleData.donataire.nationalite}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={donationSimpleData.donataire.profession}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lien avec le donateur <span className="text-red-500">*</span> (important fiscalement)</Label>
                        <Select
                          value={donationSimpleData.donataire.lienDonateur}
                          onValueChange={(value) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, lienDonateur: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="enfant">Enfant</SelectItem>
                            <SelectItem value="parent">Parent</SelectItem>
                            <SelectItem value="frere_soeur">Frère / Sœur</SelectItem>
                            <SelectItem value="neveu_niece">Neveu / Nièce</SelectItem>
                            <SelectItem value="cousin">Cousin</SelectItem>
                            <SelectItem value="ami">Ami</SelectItem>
                            <SelectItem value="conjoint_pacse">Conjoint pacsé</SelectItem>
                            <SelectItem value="autre">Autre</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {donationSimpleData.donataire.lienDonateur === "autre" && (
                        <div className="space-y-2 md:col-span-2">
                          <Label>Précisez le lien <span className="text-red-500">*</span></Label>
                          <Input
                            value={donationSimpleData.donataire.lienDonateurAutrePrecision}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donataire: {...donationSimpleData.donataire, lienDonateurAutrePrecision: e.target.value}
                            })}
                            placeholder="Ex: beau-fils, concubin, petit-neveu, etc."
                          />
                        </div>
                      )}

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse complète <span className="text-red-500">*</span></Label>
                        <Input
                          value={donationSimpleData.donataire.adresseComplete}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, adresseComplete: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={donationSimpleData.donataire.telephone}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={donationSimpleData.donataire.email}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            donataire: {...donationSimpleData.donataire, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>
                  </div>

                  {/* 4. Enfants / héritiers du donateur */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Enfants / héritiers du donateur</h3>
                    <p className="text-sm text-muted-foreground">Obligatoire pour vérifier qu'on n'empiète pas sur la réserve héréditaire</p>
                    
                    <div className="space-y-3">
                      <div className="space-y-2">
                        <Label>Nombre d'enfants</Label>
                        <Input
                          type="number"
                          value={donationSimpleData.nombreEnfants}
                          onChange={(e) => setDonationSimpleData({...donationSimpleData, nombreEnfants: e.target.value})}
                          placeholder="0"
                        />
                      </div>

                      {donationSimpleData.nombreEnfants && parseInt(donationSimpleData.nombreEnfants) > 0 && (
                        <div className="space-y-3">
                          <Label>Identité des enfants</Label>
                          {donationSimpleData.enfants.map((enfant, idx) => (
                            <div key={enfant.id} className="p-3 border rounded-lg space-y-2 bg-muted/10">
                              <div className="flex justify-between items-center">
                                <span className="text-sm font-medium">Enfant #{idx + 1}</span>
                                {donationSimpleData.enfants.length > 1 && (
                                  <button
                                    type="button"
                                    onClick={() => {
                                      const newEnfants = donationSimpleData.enfants.filter((_, i) => i !== idx);
                                      setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                    }}
                                    className="text-red-600 text-xs"
                                  >
                                    Supprimer
                                  </button>
                                )}
                              </div>
                              <div className="grid grid-cols-3 gap-2">
                                <Input
                                  placeholder="Nom"
                                  value={enfant.nom}
                                  onChange={(e) => {
                                    const newEnfants = [...donationSimpleData.enfants];
                                    newEnfants[idx].nom = e.target.value;
                                    setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                  }}
                                />
                                <Input
                                  placeholder="Prénom"
                                  value={enfant.prenom}
                                  onChange={(e) => {
                                    const newEnfants = [...donationSimpleData.enfants];
                                    newEnfants[idx].prenom = e.target.value;
                                    setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                  }}
                                />
                                <Input
                                  type="date"
                                  placeholder="Date naissance"
                                  value={enfant.dateNaissance}
                                  onChange={(e) => {
                                    const newEnfants = [...donationSimpleData.enfants];
                                    newEnfants[idx].dateNaissance = e.target.value;
                                    setDonationSimpleData({...donationSimpleData, enfants: newEnfants});
                                  }}
                                />
                              </div>
                            </div>
                          ))}
                          <button
                            type="button"
                            onClick={() => {
                              setDonationSimpleData({
                                ...donationSimpleData,
                                enfants: [...donationSimpleData.enfants, {
                                  id: Date.now(),
                                  nom: "",
                                  prenom: "",
                                  dateNaissance: "",
                                }]
                              });
                            }}
                            className="text-sm text-blue-600 hover:underline"
                          >
                            + Ajouter un enfant
                          </button>
                        </div>
                      )}

                      <div className="space-y-2 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <Label className="text-sm font-medium">Type de donation (impact sur succession)</Label>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="hors_part"
                            checked={donationSimpleData.donationHorsPartSuccessorale}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donationHorsPartSuccessorale: e.target.checked,
                              donationAvancementPart: e.target.checked ? false : donationSimpleData.donationAvancementPart
                            })}
                          />
                          <label htmlFor="hors_part" className="text-sm cursor-pointer">
                            Donation hors part successorale (non rapportable)
                          </label>
                        </div>
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="avancement_part"
                            checked={donationSimpleData.donationAvancementPart}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              donationAvancementPart: e.target.checked,
                              donationHorsPartSuccessorale: e.target.checked ? false : donationSimpleData.donationHorsPartSuccessorale
                            })}
                          />
                          <label htmlFor="avancement_part" className="text-sm cursor-pointer">
                            Donation en avancement de part successorale (rapportable)
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* 5. Description complète du ou des biens donnés */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Description complète du ou des biens donnés</h3>
                    
                    {/* A. Bien immobilier */}
                    {donationSimpleData.typeDonation === "biens_immobiliers" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">🏠 Bien immobilier</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Adresse complète <span className="text-red-500">*</span></Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.adresseComplete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, adresseComplete: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nature du bien</Label>
                            <Select
                              value={donationSimpleData.bienImmobilier.natureBien}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, natureBien: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="maison">Maison</SelectItem>
                                <SelectItem value="appartement">Appartement</SelectItem>
                                <SelectItem value="terrain">Terrain</SelectItem>
                                <SelectItem value="dependances">Dépendances</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Situation locative</Label>
                            <Select
                              value={donationSimpleData.bienImmobilier.situationLocative}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, situationLocative: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="libre">Libre</SelectItem>
                                <SelectItem value="loue">Loué</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Section cadastrale</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.sectionCadastrale}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, sectionCadastrale: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro cadastral</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.numeroCadastral}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, numeroCadastral: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Contenance</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.contenance}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, contenance: e.target.value}
                              })}
                              placeholder="Ex: 500m²"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur vénale <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.bienImmobilier.valeurVenale}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, valeurVenale: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Description détaillée</Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.bienImmobilier.descriptionDetaille}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, descriptionDetaille: e.target.value}
                              })}
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="existence_hypotheques"
                              checked={donationSimpleData.bienImmobilier.existenceHypotheques}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, existenceHypotheques: e.target.checked}
                              })}
                            />
                            <label htmlFor="existence_hypotheques" className="text-sm cursor-pointer">
                              Existence d'hypothèques
                            </label>
                          </div>

                          {donationSimpleData.bienImmobilier.existenceHypotheques && (
                            <div className="space-y-2 md:col-span-2">
                              <Label>Montant des hypothèques</Label>
                              <Input
                                type="number"
                                value={donationSimpleData.bienImmobilier.montantHypotheques}
                                onChange={(e) => setDonationSimpleData({
                                  ...donationSimpleData,
                                  bienImmobilier: {...donationSimpleData.bienImmobilier, montantHypotheques: e.target.value}
                                })}
                                placeholder="€"
                              />
                            </div>
                          )}

                          <div className="space-y-2">
                            <Label>Répartition usufruit</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.repartitionUsufruit}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, repartitionUsufruit: e.target.value}
                              })}
                              placeholder="Ex: 40%"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Répartition nue-propriété</Label>
                            <Input
                              value={donationSimpleData.bienImmobilier.repartitionNuePropriete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienImmobilier: {...donationSimpleData.bienImmobilier, repartitionNuePropriete: e.target.value}
                              })}
                              placeholder="Ex: 60%"
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* B. Bien mobilier corporel */}
                    {donationSimpleData.typeDonation === "biens_meubles" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">🚗 Bien mobilier corporel</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2 md:col-span-2">
                            <Label>Description précise du bien <span className="text-red-500">*</span></Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.bienMobilier.descriptionPrecise}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, descriptionPrecise: e.target.value}
                              })}
                              placeholder="Voiture, bijoux, œuvre d'art, mobilier, matériel..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Numéro de série (si véhicule ou matériel)</Label>
                            <Input
                              value={donationSimpleData.bienMobilier.numeroSerie}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, numeroSerie: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur estimée <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.bienMobilier.valeurEstimee}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, valeurEstimee: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="facture_existante"
                              checked={donationSimpleData.bienMobilier.factureExistante}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                bienMobilier: {...donationSimpleData.bienMobilier, factureExistante: e.target.checked}
                              })}
                            />
                            <label htmlFor="facture_existante" className="text-sm cursor-pointer">
                              Facture existante
                            </label>
                          </div>
                        </div>
                      </div>
                    )}

                    {/* C. Somme d'argent */}
                    {donationSimpleData.typeDonation === "sommes_argent" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">💰 Somme d'argent</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Montant exact <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.sommesArgent.montantExact}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, montantExact: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Provenance du fonds</Label>
                            <Input
                              value={donationSimpleData.sommesArgent.provenanceFonds}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, provenanceFonds: e.target.value}
                              })}
                              placeholder="Ex: Épargne, vente bien, héritage..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Modalité <span className="text-red-500">*</span></Label>
                            <Select
                              value={donationSimpleData.sommesArgent.modalite}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, modalite: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="virement">Virement</SelectItem>
                                <SelectItem value="cheque">Chèque</SelectItem>
                                <SelectItem value="especes">Espèces</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Date du transfert</Label>
                            <Input
                              type="date"
                              value={donationSimpleData.sommesArgent.dateTransfert}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                sommesArgent: {...donationSimpleData.sommesArgent, dateTransfert: e.target.value}
                              })}
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* D. Parts sociales / actions */}
                    {donationSimpleData.typeDonation === "parts_sociales" && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">📈 Parts sociales / Actions</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Type de société <span className="text-red-500">*</span></Label>
                            <Input
                              value={donationSimpleData.partsSociales.typeSociete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, typeSociete: e.target.value}
                              })}
                              placeholder="Ex: SARL, SAS, SA..."
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Nombre de parts/actions <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.partsSociales.nombreParts}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, nombreParts: e.target.value}
                              })}
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur unitaire <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.partsSociales.valeurUnitaire}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, valeurUnitaire: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Pourcentage du capital</Label>
                            <Input
                              type="number"
                              value={donationSimpleData.partsSociales.pourcentageCapital}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, pourcentageCapital: e.target.value}
                              })}
                              placeholder="%"
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="agrement_obligatoire"
                              checked={donationSimpleData.partsSociales.agrementObligatoire}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, agrementObligatoire: e.target.checked}
                              })}
                            />
                            <label htmlFor="agrement_obligatoire" className="text-sm cursor-pointer">
                              Agrément obligatoire
                            </label>
                          </div>

                          <div className="space-y-2 md:col-span-2">
                            <Label>Clauses spécifiques (inaliénabilité...)</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.partsSociales.clausesSpecifiques}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                partsSociales: {...donationSimpleData.partsSociales, clausesSpecifiques: e.target.value}
                              })}
                            />
                          </div>
                        </div>
                      </div>
                    )}

                    {/* E. Nue-propriété / Usufruit */}
                    {(donationSimpleData.typeDonation === "nue_propriete" || donationSimpleData.typeDonation === "usufruit") && (
                      <div className="p-4 border rounded-lg space-y-3 bg-muted/10">
                        <h4 className="font-medium">🔓 Nue-propriété / Usufruit</h4>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                          <div className="space-y-2">
                            <Label>Valeur de la nue-propriété <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.nueProprieteUsufruit.valeurNuePropriete}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, valeurNuePropriete: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Valeur de l'usufruit <span className="text-red-500">*</span></Label>
                            <Input
                              type="number"
                              value={donationSimpleData.nueProprieteUsufruit.valeurUsufruit}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, valeurUsufruit: e.target.value}
                              })}
                              placeholder="€"
                            />
                          </div>

                          <div className="space-y-2">
                            <Label>Durée</Label>
                            <Select
                              value={donationSimpleData.nueProprieteUsufruit.duree}
                              onValueChange={(value) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, duree: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="temporaire">Temporaire</SelectItem>
                                <SelectItem value="viager">Viager</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="space-y-2">
                            <Label>Répartition des charges</Label>
                            <Input
                              value={donationSimpleData.nueProprieteUsufruit.repartitionCharges}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, repartitionCharges: e.target.value}
                              })}
                              placeholder="Ex: Charges courantes / grosses réparations..."
                            />
                          </div>

                          <div className="flex items-center space-x-2 md:col-span-2">
                            <input
                              type="checkbox"
                              id="usufruit_simultane"
                              checked={donationSimpleData.nueProprieteUsufruit.usufruitSimultaneConjoint}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                nueProprieteUsufruit: {...donationSimpleData.nueProprieteUsufruit, usufruitSimultaneConjoint: e.target.checked}
                              })}
                            />
                            <label htmlFor="usufruit_simultane" className="text-sm cursor-pointer">
                              Usufruit simultané du conjoint (rare)
                            </label>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>

                  {/* 6. Clauses optionnelles */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses optionnelles de donation</h3>
                    
                    {/* A. Réserve d'usufruit */}
                    <div className="p-3 border rounded-lg space-y-3 bg-blue-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="reserve_usufruit"
                          checked={donationSimpleData.clausesOptionnelles.reserveUsufruit}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, reserveUsufruit: e.target.checked}
                          })}
                        />
                        <label htmlFor="reserve_usufruit" className="font-medium cursor-pointer">
                          A. Réserve d'usufruit
                        </label>
                      </div>
                      {donationSimpleData.clausesOptionnelles.reserveUsufruit && (
                        <div className="space-y-2 ml-6">
                          <div className="space-y-2">
                            <Label>Étendue de l'usufruit</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.etendueUsufruit}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, etendueUsufruit: e.target.value}
                              })}
                            />
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="droit_usage_habitation"
                              checked={donationSimpleData.clausesOptionnelles.droitUsageHabitation}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, droitUsageHabitation: e.target.checked}
                              })}
                            />
                            <label htmlFor="droit_usage_habitation" className="text-sm cursor-pointer">
                              Droit d'usage / habitation
                            </label>
                          </div>
                        </div>
                      )}
                    </div>

                    {/* B. Droit de retour conventionnel */}
                    <div className="p-3 border rounded-lg space-y-3 bg-green-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="droit_retour_clause"
                          checked={donationSimpleData.clausesOptionnelles.droitRetour}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, droitRetour: e.target.checked}
                          })}
                        />
                        <label htmlFor="droit_retour_clause" className="font-medium cursor-pointer">
                          B. Droit de retour conventionnel
                        </label>
                      </div>
                      <p className="text-xs text-muted-foreground ml-6">
                        Permet au donateur de récupérer le bien si le donataire décède avant lui
                      </p>
                      {donationSimpleData.clausesOptionnelles.droitRetour && (
                        <div className="space-y-2 ml-6">
                          <Label>Étendue du droit de retour</Label>
                          <Select
                            value={donationSimpleData.clausesOptionnelles.etendueRetour}
                            onValueChange={(value) => setDonationSimpleData({
                              ...donationSimpleData,
                              clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, etendueRetour: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="totalite">Sur totalité du bien</SelectItem>
                              <SelectItem value="part_recue">Sur part reçue seulement</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>
                      )}
                    </div>

                    {/* C. Charge imposée */}
                    <div className="p-3 border rounded-lg space-y-3 bg-orange-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="charge_imposee"
                          checked={donationSimpleData.clausesOptionnelles.chargeImposee}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, chargeImposee: e.target.checked}
                          })}
                        />
                        <label htmlFor="charge_imposee" className="font-medium cursor-pointer">
                          C. Charge imposée au donataire
                        </label>
                      </div>
                      {donationSimpleData.clausesOptionnelles.chargeImposee && (
                        <div className="space-y-2 ml-6">
                          <div className="space-y-2">
                            <Label>Description complète de la charge</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.descriptionCharge}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, descriptionCharge: e.target.value}
                              })}
                              placeholder="Ex: Payer des frais, entretenir un bien, laisser l'usage au donateur..."
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Montant ou nature</Label>
                            <Input
                              value={donationSimpleData.clausesOptionnelles.montantNatureCharge}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, montantNatureCharge: e.target.value}
                              })}
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Conditions d'exécution</Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.conditionsExecution}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, conditionsExecution: e.target.value}
                              })}
                            />
                          </div>
                        </div>
                      )}
                    </div>

                    {/* D. Affectation particulière */}
                    <div className="p-3 border rounded-lg space-y-2 bg-purple-50/30">
                      <label className="font-medium">D. Affectation particulière</label>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="usage_professionnel"
                          checked={donationSimpleData.clausesOptionnelles.usageProfessionnel}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, usageProfessionnel: e.target.checked}
                          })}
                        />
                        <label htmlFor="usage_professionnel" className="text-sm cursor-pointer">
                          Bien donné pour usage professionnel
                        </label>
                      </div>
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="exclusion_communaute"
                          checked={donationSimpleData.clausesOptionnelles.exclusionCommunaute}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, exclusionCommunaute: e.target.checked}
                          })}
                        />
                        <label htmlFor="exclusion_communaute" className="text-sm cursor-pointer">
                          Exclusion de la communauté en cas de mariage du donataire
                        </label>
                      </div>
                    </div>

                    {/* E. Donation rapportable */}
                    <div className="p-3 border rounded-lg space-y-2 bg-teal-50/30">
                      <label className="font-medium">E. Donation rapportable ou non</label>
                      <Select
                        value={donationSimpleData.clausesOptionnelles.donationRapportable}
                        onValueChange={(value) => setDonationSimpleData({
                          ...donationSimpleData,
                          clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, donationRapportable: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="avancement_hoirie">Donation en avancement d'hoirie (rapportable)</SelectItem>
                          <SelectItem value="hors_part">Donation hors part successorale (non rapportable)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {/* F. Clause d'inaliénabilité */}
                    <div className="p-3 border rounded-lg space-y-3 bg-red-50/30">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="clause_inalienabilite"
                          checked={donationSimpleData.clausesOptionnelles.clauseInalienabilite}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, clauseInalienabilite: e.target.checked}
                          })}
                        />
                        <label htmlFor="clause_inalienabilite" className="font-medium cursor-pointer">
                          F. Clause d'inaliénabilité (rare et encadrée)
                        </label>
                      </div>
                      {donationSimpleData.clausesOptionnelles.clauseInalienabilite && (
                        <div className="space-y-2 ml-6">
                          <div className="space-y-2">
                            <Label>Durée</Label>
                            <Input
                              value={donationSimpleData.clausesOptionnelles.dureeInalienabilite}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, dureeInalienabilite: e.target.value}
                              })}
                              placeholder="Ex: 10 ans"
                            />
                          </div>
                          <div className="space-y-2">
                            <Label>Motif légitime <span className="text-red-500">*</span></Label>
                            <textarea
                              className="w-full min-h-[60px] p-2 border rounded-md text-sm"
                              value={donationSimpleData.clausesOptionnelles.motifLegitime}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, motifLegitime: e.target.value}
                              })}
                              placeholder="Requis par la loi"
                            />
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="autorisation_requise"
                              checked={donationSimpleData.clausesOptionnelles.autorisationRequise}
                              onChange={(e) => setDonationSimpleData({
                                ...donationSimpleData,
                                clausesOptionnelles: {...donationSimpleData.clausesOptionnelles, autorisationRequise: e.target.checked}
                              })}
                            />
                            <label htmlFor="autorisation_requise" className="text-sm cursor-pointer">
                              Autorisation du donateur requise pour vendre
                            </label>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 7. Acceptation du donataire */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Acceptation du donataire</h3>
                    <p className="text-sm text-muted-foreground">La donation n'existe légalement que si l'acceptation est expresse</p>
                    
                    <div className="p-4 border rounded-lg space-y-4 bg-blue-50/30">
                      <div className="space-y-3">
                        <Label className="font-medium">Le donataire accepte-t-il la donation dans cet acte ?</Label>
                        <div className="flex items-center space-x-4">
                          <div className="flex items-center space-x-2">
                            <input
                              type="radio"
                              id="acceptation_dans_acte"
                              checked={donationSimpleData.acceptationDonataire.dansActe === true}
                              onChange={() => setDonationSimpleData({
                                ...donationSimpleData,
                                acceptationDonataire: {...donationSimpleData.acceptationDonataire, dansActe: true}
                              })}
                            />
                            <label htmlFor="acceptation_dans_acte" className="text-sm cursor-pointer">Oui, dans cet acte</label>
                          </div>
                          <div className="flex items-center space-x-2">
                            <input
                              type="radio"
                              id="acceptation_acte_separe"
                              checked={donationSimpleData.acceptationDonataire.dansActe === false}
                              onChange={() => setDonationSimpleData({
                                ...donationSimpleData,
                                acceptationDonataire: {...donationSimpleData.acceptationDonataire, dansActe: false}
                              })}
                            />
                            <label htmlFor="acceptation_acte_separe" className="text-sm cursor-pointer">Non, acceptation dans un acte séparé</label>
                          </div>
                        </div>
                      </div>

                      {!donationSimpleData.acceptationDonataire.dansActe && (
                        <div className="space-y-3 p-3 bg-amber-50 border border-amber-200 rounded-lg">
                          <p className="text-sm font-medium text-amber-800">⚠️ Informations sur l'acte d'acceptation séparé</p>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Date de l'acte d'acceptation <span className="text-red-500">*</span></Label>
                              <Input
                                type="date"
                                value={donationSimpleData.acceptationDonataire.dateAcceptation}
                                onChange={(e) => setDonationSimpleData({
                                  ...donationSimpleData,
                                  acceptationDonataire: {...donationSimpleData.acceptationDonataire, dateAcceptation: e.target.value}
                                })}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Lieu de signature <span className="text-red-500">*</span></Label>
                              <Input
                                value={donationSimpleData.acceptationDonataire.lieuAcceptation}
                                onChange={(e) => setDonationSimpleData({
                                  ...donationSimpleData,
                                  acceptationDonataire: {...donationSimpleData.acceptationDonataire, lieuAcceptation: e.target.value}
                                })}
                                placeholder="Ville"
                              />
                            </div>
                          </div>
                          <p className="text-xs text-amber-700">📎 N'oubliez pas de joindre l'acte d'acceptation dans la section Documents</p>
                        </div>
                      )}

                      {donationSimpleData.acceptationDonataire.dansActe && (
                        <div className="p-3 bg-green-50 border border-green-200 rounded-lg">
                          <p className="text-sm text-green-800">✓ L'acceptation sera formalisée dans l'acte de donation lui-même</p>
                        </div>
                      )}
                    </div>
                  </div>

                  {/* 8. Modalités de remise du bien */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Modalités de remise / transfert du bien</h3>
                    <p className="text-sm text-muted-foreground">Le Code civil exige de préciser quand et comment le donataire reçoit réellement la chose</p>
                    
                    <div className="p-4 border rounded-lg space-y-4 bg-purple-50/30">
                      <div className="space-y-2">
                        <Label>Mode de remise <span className="text-red-500">*</span></Label>
                        <Select
                          value={donationSimpleData.modalitesRemise.modeRemise}
                          onValueChange={(value) => setDonationSimpleData({
                            ...donationSimpleData,
                            modalitesRemise: {...donationSimpleData.modalitesRemise, modeRemise: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="immediate">Remise matérielle immédiate</SelectItem>
                            <SelectItem value="differee">Remise différée</SelectItem>
                            <SelectItem value="don_manuel_deja_realise">Don manuel déjà réalisé (donation postérieure)</SelectItem>
                            <SelectItem value="symbolique">Remise symbolique (clé, document, certificat...)</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="space-y-2">
                          <Label>Lieu de remise</Label>
                          <Input
                            value={donationSimpleData.modalitesRemise.lieuRemise}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              modalitesRemise: {...donationSimpleData.modalitesRemise, lieuRemise: e.target.value}
                            })}
                            placeholder="Adresse ou lieu"
                          />
                        </div>
                        <div className="space-y-2">
                          <Label>Date prévue de remise</Label>
                          <Input
                            type="date"
                            value={donationSimpleData.modalitesRemise.dateRemise}
                            onChange={(e) => setDonationSimpleData({
                              ...donationSimpleData,
                              modalitesRemise: {...donationSimpleData.modalitesRemise, dateRemise: e.target.value}
                            })}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <Label>Personne responsable de la remise</Label>
                        <Input
                          value={donationSimpleData.modalitesRemise.personneResponsable}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            modalitesRemise: {...donationSimpleData.modalitesRemise, personneResponsable: e.target.value}
                          })}
                          placeholder="Nom de la personne"
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Document remis avec le bien</Label>
                        <Select
                          value={donationSimpleData.modalitesRemise.documentRemis}
                          onValueChange={(value) => setDonationSimpleData({
                            ...donationSimpleData,
                            modalitesRemise: {...donationSimpleData.modalitesRemise, documentRemis: value}
                          })}
                        >
                          <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                          <SelectContent>
                            <SelectItem value="carte_grise">Carte grise</SelectItem>
                            <SelectItem value="certificat">Certificat</SelectItem>
                            <SelectItem value="facture">Facture</SelectItem>
                            <SelectItem value="cle">Clé</SelectItem>
                            <SelectItem value="titre_propriete">Titre de propriété</SelectItem>
                            <SelectItem value="autre">Autre document</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      <div className="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                        <p className="text-xs text-blue-800">
                          💡 <strong>Exemple de clause générée :</strong><br/>
                          "La propriété est transférée immédiatement, et la remise matérielle du bien interviendra le [date] à [lieu], avec remise de [document]."
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* 9. Mentions légales obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Mentions légales obligatoires</h3>
                    <p className="text-sm text-muted-foreground">L'acte doit impérativement contenir :</p>
                    
                    <div className="space-y-2 p-4 bg-amber-50 border border-amber-200 rounded-lg">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="acceptation_expresse"
                          checked={donationSimpleData.mentionsLegales.acceptationExpresse}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, acceptationExpresse: e.target.checked}
                          })}
                        />
                        <label htmlFor="acceptation_expresse" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Acceptation expresse du donataire (obligatoire)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="consentement_eclaire"
                          checked={donationSimpleData.mentionsLegales.consentementEclaire}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, consentementEclaire: e.target.checked}
                          })}
                        />
                        <label htmlFor="consentement_eclaire" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Consentement éclairé du donateur (obligatoire)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="caractere_present"
                          checked={donationSimpleData.mentionsLegales.caracterePresentIrrevocable}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, caracterePresentIrrevocable: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="caractere_present" className="text-sm cursor-pointer text-muted-foreground">
                          Caractère présent et irrévocable de la donation
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_reserve"
                          checked={donationSimpleData.mentionsLegales.mentionReserveHereditaire}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, mentionReserveHereditaire: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="mention_reserve" className="text-sm cursor-pointer text-muted-foreground">
                          Mention du non-respect possible de la réserve héréditaire
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="modalites_transfert"
                          checked={donationSimpleData.mentionsLegales.modalitesTransfertPropriete}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, modalitesTransfertPropriete: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="modalites_transfert" className="text-sm cursor-pointer text-muted-foreground">
                          Modalités de transfert de propriété
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="rappel_articles"
                          checked={donationSimpleData.mentionsLegales.rappelArticlesCodeCivil}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, rappelArticlesCodeCivil: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="rappel_articles" className="text-sm cursor-pointer text-muted-foreground">
                          Rappel des articles du Code civil
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="obligations_fiscales"
                          checked={donationSimpleData.mentionsLegales.obligationsFiscales}
                          onChange={(e) => setDonationSimpleData({
                            ...donationSimpleData,
                            mentionsLegales: {...donationSimpleData.mentionsLegales, obligationsFiscales: e.target.checked}
                          })}
                          disabled
                        />
                        <label htmlFor="obligations_fiscales" className="text-sm cursor-pointer text-muted-foreground">
                          Obligations fiscales (déclaration de don manuel ou IFI)
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* 10. Documents obligatoires à collecter */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Documents obligatoires à collecter</h3>
                    
                    {/* Documents donateur */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Pour le donateur</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Carte identité donateur */}
                        <div className="space-y-2">
                          <Label>Carte d'identité <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donateur_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonateurIdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donateur_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonateurIdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonateurIdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonateurIdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Livret famille */}
                        <div className="space-y-2">
                          <Label>Livret de famille</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donateur_livret"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonateurLivretFamilleFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donateur_livret" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonateurLivretFamilleFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonateurLivretFamilleFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonateurLivretFamilleFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile donateur */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donateur_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonateurDomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donateur_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonateurDomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonateurDomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonateurDomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents donataire */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Pour le donataire</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Pièce identité donataire */}
                        <div className="space-y-2">
                          <Label>Pièce d'identité <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donataire_identite"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonatairePieceIdentiteFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donataire_identite" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonatairePieceIdentiteFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonatairePieceIdentiteFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonatairePieceIdentiteFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Justificatif domicile donataire */}
                        <div className="space-y-2">
                          <Label>Justificatif de domicile <span className="text-red-500">*</span></Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_donataire_domicile"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleDonataireDomicileFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_donataire_domicile" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleDonataireDomicileFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleDonataireDomicileFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleDonataireDomicileFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Documents selon type de bien */}
                    <div className="p-4 border rounded-lg space-y-4 bg-muted/10">
                      <h4 className="font-medium text-base">📄 Documents selon le type de bien</h4>
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        {/* Titre propriété */}
                        {donationSimpleData.typeDonation === "biens_immobiliers" && (
                          <div className="space-y-2">
                            <Label>Titre de propriété</Label>
                            <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                              <input
                                type="file"
                                accept="application/pdf"
                                multiple
                                className="hidden"
                                id="donation_simple_titre_propriete"
                                onChange={(e) => {
                                  const files = Array.from(e.target.files || []);
                                  setDonationSimpleTitreProprieteFiles(prev => [...prev, ...files]);
                                }}
                              />
                              <label htmlFor="donation_simple_titre_propriete" className="cursor-pointer text-sm text-muted-foreground">
                                Cliquez pour joindre
                              </label>
                              {donationSimpleTitreProprieteFiles.length > 0 && (
                                <div className="mt-2 space-y-1">
                                  {donationSimpleTitreProprieteFiles.map((file, idx) => (
                                    <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                      <span className="truncate">{file.name}</span>
                                      <button
                                        type="button"
                                        onClick={() => setDonationSimpleTitreProprieteFiles(prev => prev.filter((_, i) => i !== idx))}
                                        className="text-red-600 ml-2"
                                      >
                                        ✕
                                      </button>
                                    </div>
                                  ))}
                                </div>
                              )}
                            </div>
                          </div>
                        )}

                        {/* Évaluation bien */}
                        <div className="space-y-2">
                          <Label>Évaluation du bien</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf"
                              multiple
                              className="hidden"
                              id="donation_simple_evaluation"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleEvaluationBienFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_evaluation" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre
                            </label>
                            {donationSimpleEvaluationBienFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleEvaluationBienFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleEvaluationBienFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Autres documents */}
                        <div className="space-y-2 md:col-span-2">
                          <Label>Autres documents</Label>
                          <div className="border-2 border-dashed border-muted-foreground/25 rounded-lg p-3">
                            <input
                              type="file"
                              accept="application/pdf,image/*"
                              multiple
                              className="hidden"
                              id="donation_simple_autres"
                              onChange={(e) => {
                                const files = Array.from(e.target.files || []);
                                setDonationSimpleAutresDocumentsFiles(prev => [...prev, ...files]);
                              }}
                            />
                            <label htmlFor="donation_simple_autres" className="cursor-pointer text-sm text-muted-foreground">
                              Cliquez pour joindre (statuts société, RIB, diagnostics, etc.)
                            </label>
                            {donationSimpleAutresDocumentsFiles.length > 0 && (
                              <div className="mt-2 space-y-1">
                                {donationSimpleAutresDocumentsFiles.map((file, idx) => (
                                  <div key={idx} className="flex items-center justify-between text-xs bg-muted p-1 rounded">
                                    <span className="truncate">{file.name}</span>
                                    <button
                                      type="button"
                                      onClick={() => setDonationSimpleAutresDocumentsFiles(prev => prev.filter((_, i) => i !== idx))}
                                      className="text-red-600 ml-2"
                                    >
                                      ✕
                                    </button>
                                  </div>
                                ))}
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire Testament */}
            {pendingContractType === "Testament authentique ou mystique" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Sélecteur de type de testament */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Quel type de testament souhaitez-vous rédiger ?</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de testament <span className="text-red-500">*</span></Label>
                      <Select
                        value={testamentData.typeTestament || undefined}
                        onValueChange={(value) => setTestamentData({...testamentData, typeTestament: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le type de testament..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="authentique">Testament authentique (dicté au notaire)</SelectItem>
                          <SelectItem value="mystique">Testament mystique (cacheté et remis au notaire)</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>
                  </div>

                  {/* Testament authentique - STRUCTURE COMPLÈTE */}
                  {testamentData.typeTestament === "authentique" && (
                    <div className="space-y-6">
                      
                      {/* Informations générales */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur le testament</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-gray-50/50 border-gray-300">
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Type de testament <span className="text-red-500">*</span></Label>
                              <Input value="Testament authentique (dicté au notaire)" disabled className="bg-gray-100" />
                            </div>

                            <div className="space-y-2">
                              <Label>Caractère du testament <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentAuthentique.caractere || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, caractere: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="initial">Testament initial</SelectItem>
                                  <SelectItem value="modificatif">Testament modificatif</SelectItem>
                                  <SelectItem value="revocatoire">Testament révocatoire</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Date souhaitée de rédaction</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentAuthentique.dateSouhaitee}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, dateSouhaitee: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Langue comprise par le testateur <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.langueTestateur || undefined}
                                onValueChange={(value) => setTestamentData({...testamentData, langueTestateur: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="francais">Français</SelectItem>
                                  <SelectItem value="anglais">Anglais</SelectItem>
                                  <SelectItem value="espagnol">Espagnol</SelectItem>
                                  <SelectItem value="italien">Italien</SelectItem>
                                  <SelectItem value="allemand">Allemand</SelectItem>
                                  <SelectItem value="portugais">Portugais</SelectItem>
                                  <SelectItem value="arabe">Arabe</SelectItem>
                                  <SelectItem value="autre">Autre langue</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            {testamentData.langueTestateur === "autre" && (
                              <div className="space-y-2 md:col-span-2">
                                <Label>Préciser la langue <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.autreLangue}
                                  onChange={(e) => setTestamentData({...testamentData, autreLangue: e.target.value})}
                                  placeholder="Ex: Mandarin, Russe, etc."
                                />
                              </div>
                            )}
                          </div>

                          {/* Testament antérieur */}
                          <div className="border-t pt-4 space-y-3">
                            <h4 className="font-medium">Testament antérieur existant ?</h4>
                            <div className="flex items-center space-x-4">
                              <label className="flex items-center space-x-2 cursor-pointer">
                                <input
                                  type="radio"
                                  name="testamentAnterieur"
                                  checked={testamentData.testamentAnterieur === true}
                                  onChange={() => setTestamentData({...testamentData, testamentAnterieur: true})}
                                  className="w-4 h-4"
                                />
                                <span>Oui</span>
                              </label>
                              <label className="flex items-center space-x-2 cursor-pointer">
                                <input
                                  type="radio"
                                  name="testamentAnterieur"
                                  checked={testamentData.testamentAnterieur === false}
                                  onChange={() => setTestamentData({...testamentData, testamentAnterieur: false})}
                                  className="w-4 h-4"
                                />
                                <span>Non</span>
                              </label>
                            </div>

                            {testamentData.testamentAnterieur && (
                              <div className="ml-6 p-3 bg-yellow-50 rounded-lg border border-yellow-300 space-y-3">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                  <div className="space-y-2">
                                    <Label>Date du précédent testament</Label>
                                    <Input
                                      type="date"
                                      value={testamentData.testamentAnterieurDate}
                                      onChange={(e) => setTestamentData({...testamentData, testamentAnterieurDate: e.target.value})}
                                    />
                                  </div>
                                  <div className="space-y-2">
                                    <Label>Type du précédent testament</Label>
                                    <Select
                                      value={testamentData.testamentAnterieurType || undefined}
                                      onValueChange={(value) => setTestamentData({...testamentData, testamentAnterieurType: value})}
                                    >
                                      <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                      <SelectContent>
                                        <SelectItem value="authentique">Testament authentique</SelectItem>
                                        <SelectItem value="mystique">Testament mystique</SelectItem>
                                        <SelectItem value="olographe">Testament olographe</SelectItem>
                                      </SelectContent>
                                    </Select>
                                  </div>
                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Notaire dépositaire (si connu)</Label>
                                    <Input
                                      value={testamentData.testamentAnterieurNotaire}
                                      onChange={(e) => setTestamentData({...testamentData, testamentAnterieurNotaire: e.target.value})}
                                      placeholder="Nom et adresse du notaire"
                                    />
                                  </div>
                                </div>
                              </div>
                            )}
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="interprete"
                              checked={testamentData.interpreteNecessaire}
                              onChange={(e) => setTestamentData({...testamentData, interpreteNecessaire: e.target.checked})}
                            />
                            <label htmlFor="interprete" className="text-sm cursor-pointer font-medium">
                              Recours à un interprète nécessaire
                            </label>
                          </div>

                          {testamentData.interpreteNecessaire && (
                            <div className="ml-6 p-3 bg-white rounded-lg space-y-3 border border-purple-300">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-2">
                                  <Label>Nom de l'interprète <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteNom}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteNom: e.target.value})}
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Langue traduite <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteLangueTraduite}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteLangueTraduite: e.target.value})}
                                    placeholder="Ex: Arabe vers Français"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Attestation de fidélité <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteAttestationFidelite}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteAttestationFidelite: e.target.value})}
                                    placeholder="Référence attestation assermentée"
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Signature de l'interprète <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={testamentData.interpreteSignature}
                                    onChange={(e) => setTestamentData({...testamentData, interpreteSignature: e.target.value})}
                                    placeholder="Mention de signature"
                                  />
                                </div>
                              </div>
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Identité testateur */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Identité complète du testateur</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-blue-50/50 border-blue-300">
                          <div className="space-y-2">
                            <Label>Sélectionner un client (optionnel)</Label>
                            <Select
                              value={testamentData.clientId || undefined}
                              onValueChange={(value) => setTestamentData({...testamentData, clientId: value})}
                            >
                              <SelectTrigger><SelectValue placeholder="Choisir un client..." /></SelectTrigger>
                              <SelectContent>
                                {/* Ici on mappera les clients réels */}
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testateurNom}
                                onChange={(e) => setTestamentData({...testamentData, testateurNom: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Prénom <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testateurPrenom}
                                onChange={(e) => setTestamentData({...testamentData, testateurPrenom: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Nom de naissance</Label>
                              <Input
                                value={testamentData.testateurNomNaissance}
                                onChange={(e) => setTestamentData({...testamentData, testateurNomNaissance: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Date de naissance <span className="text-red-500">*</span></Label>
                              <Input
                                type="date"
                                value={testamentData.testateurDateNaissance}
                                onChange={(e) => setTestamentData({...testamentData, testateurDateNaissance: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Lieu de naissance</Label>
                              <Input
                                value={testamentData.testateurLieuNaissance}
                                onChange={(e) => setTestamentData({...testamentData, testateurLieuNaissance: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Nationalité</Label>
                              <Input
                                value={testamentData.testateurNationalite}
                                onChange={(e) => setTestamentData({...testamentData, testateurNationalite: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Profession</Label>
                              <Input
                                value={testamentData.testateurProfession}
                                onChange={(e) => setTestamentData({...testamentData, testateurProfession: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Situation familiale <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testateurSituationFamiliale || undefined}
                                onValueChange={(value) => setTestamentData({...testamentData, testateurSituationFamiliale: value})}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="celibataire">Célibataire</SelectItem>
                                  <SelectItem value="marie">Marié(e)</SelectItem>
                                  <SelectItem value="pacse">Pacsé(e)</SelectItem>
                                  <SelectItem value="concubinage">Concubinage</SelectItem>
                                  <SelectItem value="divorce">Divorcé(e)</SelectItem>
                                  <SelectItem value="veuf">Veuf(ve)</SelectItem>
                                  <SelectItem value="separe">Séparé(e)</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <Label>Adresse complète <span className="text-red-500">*</span></Label>
                            <Input
                              value={testamentData.testateurAdresse}
                              onChange={(e) => setTestamentData({...testamentData, testateurAdresse: e.target.value})}
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Téléphone</Label>
                              <Input
                                value={testamentData.testateurTelephone}
                                onChange={(e) => setTestamentData({...testamentData, testateurTelephone: e.target.value})}
                              />
                            </div>
                            <div className="space-y-2">
                              <Label>Email</Label>
                              <Input
                                type="email"
                                value={testamentData.testateurEmail}
                                onChange={(e) => setTestamentData({...testamentData, testateurEmail: e.target.value})}
                              />
                            </div>
                          </div>

                          {/* Pièce d'identité */}
                          <div className="border-t pt-3 space-y-3">
                            <h4 className="font-medium">Pièce d'identité</h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Type</Label>
                                <Select
                                  value={testamentData.testateurPieceType || undefined}
                                  onValueChange={(value) => setTestamentData({...testamentData, testateurPieceType: value})}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="cni">Carte Nationale d'Identité</SelectItem>
                                    <SelectItem value="passeport">Passeport</SelectItem>
                                    <SelectItem value="titre_sejour">Titre de séjour</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                              <div className="space-y-2">
                                <Label>Numéro</Label>
                                <Input
                                  value={testamentData.testateurPieceNumero}
                                  onChange={(e) => setTestamentData({...testamentData, testateurPieceNumero: e.target.value})}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Autorité de délivrance</Label>
                                <Input
                                  value={testamentData.testateurPieceAutorite}
                                  onChange={(e) => setTestamentData({...testamentData, testateurPieceAutorite: e.target.value})}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Date d'expiration</Label>
                                <Input
                                  type="date"
                                  value={testamentData.testateurPieceExpiration}
                                  onChange={(e) => setTestamentData({...testamentData, testateurPieceExpiration: e.target.value})}
                                />
                              </div>
                            </div>
                          </div>

                          {/* Capacité juridique */}
                          <div className="border-t pt-3 space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="capacite_juridique"
                                checked={testamentData.capaciteJuridiqueConfirmee}
                                onChange={(e) => setTestamentData({...testamentData, capaciteJuridiqueConfirmee: e.target.checked})}
                              />
                              <label htmlFor="capacite_juridique" className="text-sm cursor-pointer font-medium">
                                <span className="text-red-500">*</span> Capacité juridique confirmée
                              </label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="sous_protection"
                                checked={testamentData.sousTutelleCuratelle}
                                onChange={(e) => setTestamentData({...testamentData, sousTutelleCuratelle: e.target.checked})}
                              />
                              <label htmlFor="sous_protection" className="text-sm cursor-pointer">
                                Sous tutelle / curatelle
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Héritiers réservataires */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Héritiers réservataires (personnes protégées par la loi)</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-green-50/50 border-green-300">
                          
                          {/* Enfants */}
                          <div className="space-y-3">
                            <h4 className="font-medium">Enfants du testateur</h4>
                            {testamentData.heritiersReservataires.enfants.map((enfant, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                  <Input
                                    placeholder="Nom"
                                    value={enfant.nom}
                                    onChange={(e) => {
                                      const newEnfants = [...testamentData.heritiersReservataires.enfants];
                                      newEnfants[index].nom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                      });
                                    }}
                                  />
                                  <Input
                                    placeholder="Prénom"
                                    value={enfant.prenom}
                                    onChange={(e) => {
                                      const newEnfants = [...testamentData.heritiersReservataires.enfants];
                                      newEnfants[index].prenom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                      });
                                    }}
                                  />
                                  <Input
                                    type="date"
                                    placeholder="Date de naissance"
                                    value={enfant.dateNaissance}
                                    onChange={(e) => {
                                      const newEnfants = [...testamentData.heritiersReservataires.enfants];
                                      newEnfants[index].dateNaissance = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                      });
                                    }}
                                  />
                                </div>
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newEnfants = testamentData.heritiersReservataires.enfants.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      heritiersReservataires: {...testamentData.heritiersReservataires, enfants: newEnfants}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  heritiersReservataires: {
                                    ...testamentData.heritiersReservataires,
                                    enfants: [...testamentData.heritiersReservataires.enfants, {nom: "", prenom: "", dateNaissance: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un enfant
                            </Button>
                          </div>

                          {/* Descendants */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Descendants (petits-enfants, arrière-petits-enfants...)</h4>
                            {testamentData.heritiersReservataires.descendants.map((desc, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                                  <Input
                                    placeholder="Nom"
                                    value={desc.nom}
                                    onChange={(e) => {
                                      const newDesc = [...testamentData.heritiersReservataires.descendants];
                                      newDesc[index].nom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                      });
                                    }}
                                  />
                                  <Input
                                    placeholder="Prénom"
                                    value={desc.prenom}
                                    onChange={(e) => {
                                      const newDesc = [...testamentData.heritiersReservataires.descendants];
                                      newDesc[index].prenom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                      });
                                    }}
                                  />
                                  <Input
                                    placeholder="Lien (ex: petit-fils de...)"
                                    value={desc.lien}
                                    onChange={(e) => {
                                      const newDesc = [...testamentData.heritiersReservataires.descendants];
                                      newDesc[index].lien = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                      });
                                    }}
                                  />
                                </div>
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newDesc = testamentData.heritiersReservataires.descendants.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      heritiersReservataires: {...testamentData.heritiersReservataires, descendants: newDesc}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  heritiersReservataires: {
                                    ...testamentData.heritiersReservataires,
                                    descendants: [...testamentData.heritiersReservataires.descendants, {nom: "", prenom: "", lien: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un descendant
                            </Button>
                          </div>

                          {/* Parents */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Parents du testateur (père et mère)</h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Nom et prénom du père</Label>
                                <Input
                                  value={testamentData.heritiersReservataires.nomPrenomPere}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, nomPrenomPere: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Nom et prénom de la mère</Label>
                                <Input
                                  value={testamentData.heritiersReservataires.nomPrenomMere}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, nomPrenomMere: e.target.value}
                                  })}
                                />
                              </div>
                              <div className="space-y-2">
                                <Label>Père vivant ?</Label>
                                <Select
                                  value={testamentData.heritiersReservataires.pereVivant}
                                  onValueChange={(value) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, pereVivant: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                    <SelectItem value="inconnu">Inconnu</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                              <div className="space-y-2">
                                <Label>Mère vivante ?</Label>
                                <Select
                                  value={testamentData.heritiersReservataires.mereVivante}
                                  onValueChange={(value) => setTestamentData({
                                    ...testamentData,
                                    heritiersReservataires: {...testamentData.heritiersReservataires, mereVivante: value}
                                  })}
                                >
                                  <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                  <SelectContent>
                                    <SelectItem value="oui">Oui</SelectItem>
                                    <SelectItem value="non">Non</SelectItem>
                                    <SelectItem value="inconnu">Inconnu</SelectItem>
                                  </SelectContent>
                                </Select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      {/* Légataires */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Légataires (bénéficiaires du testament)</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-purple-50/50 border-purple-300">
                          <p className="text-sm text-gray-600">Personnes ou entités désignées pour recevoir des biens</p>
                          
                          {testamentData.legataires.map((legataire, index) => (
                            <div key={index} className="p-3 bg-white rounded-lg border space-y-3">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <Input
                                  placeholder="Nom / Dénomination"
                                  value={legataire.nom}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].nom = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                                <Input
                                  placeholder="Prénom (si personne physique)"
                                  value={legataire.prenom}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].prenom = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                                <Input
                                  placeholder="Lien avec le testateur"
                                  value={legataire.lien}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].lien = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                                <Input
                                  placeholder="Adresse complète"
                                  value={legataire.adresse}
                                  onChange={(e) => {
                                    const newLegataires = [...testamentData.legataires];
                                    newLegataires[index].adresse = e.target.value;
                                    setTestamentData({...testamentData, legataires: newLegataires});
                                  }}
                                />
                              </div>
                              <Button
                                type="button"
                                variant="destructive"
                                size="sm"
                                onClick={() => {
                                  const newLegataires = testamentData.legataires.filter((_, i) => i !== index);
                                  setTestamentData({...testamentData, legataires: newLegataires});
                                }}
                              >
                                Supprimer
                              </Button>
                            </div>
                          ))}
                          
                          <Button
                            type="button"
                            onClick={() => {
                              setTestamentData({
                                ...testamentData,
                                legataires: [...testamentData.legataires, {nom: "", prenom: "", lien: "", adresse: ""}]
                              });
                            }}
                            className="bg-orange-500 hover:bg-orange-600"
                          >
                            + Ajouter un légataire
                          </Button>
                        </div>
                      </div>

                      {/* Dispositions testamentaires */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Dispositions testamentaires</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-yellow-50/50 border-yellow-300">
                          
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="legs_universel"
                              checked={testamentData.dispositions.legsUniversel}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, legsUniversel: e.target.checked}
                              })}
                            />
                            <label htmlFor="legs_universel" className="text-sm cursor-pointer font-medium">
                              Legs universel (totalité du patrimoine)
                            </label>
                          </div>

                          {testamentData.dispositions.legsUniversel && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du legs universel..."
                                value={testamentData.dispositions.detailsLegsUniversel}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsLegsUniversel: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="legs_titre_universel"
                              checked={testamentData.dispositions.legsTitreUniversel}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, legsTitreUniversel: e.target.checked}
                              })}
                            />
                            <label htmlFor="legs_titre_universel" className="text-sm cursor-pointer font-medium">
                              Legs à titre universel (quote-part ou catégorie de biens)
                            </label>
                          </div>

                          {testamentData.dispositions.legsTitreUniversel && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du legs à titre universel..."
                                value={testamentData.dispositions.detailsLegsTitreUniversel}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsLegsTitreUniversel: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="legs_particuliers"
                                checked={testamentData.dispositions.legsParticuliers}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, legsParticuliers: e.target.checked}
                                })}
                              />
                              <label htmlFor="legs_particuliers" className="text-sm cursor-pointer font-medium">
                                Legs particuliers (biens déterminés)
                              </label>
                            </div>

                            {testamentData.dispositions.legsParticuliers && (
                              <div className="ml-6 space-y-3">
                                {testamentData.dispositions.listeLegsParticuliers.map((legs, index) => (
                                  <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                    <Input
                                      placeholder="Description du bien"
                                      value={legs.description}
                                      onChange={(e) => {
                                        const newLegs = [...testamentData.dispositions.listeLegsParticuliers];
                                        newLegs[index].description = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          dispositions: {...testamentData.dispositions, listeLegsParticuliers: newLegs}
                                        });
                                      }}
                                    />
                                    <Input
                                      placeholder="Bénéficiaire"
                                      value={legs.beneficiaire}
                                      onChange={(e) => {
                                        const newLegs = [...testamentData.dispositions.listeLegsParticuliers];
                                        newLegs[index].beneficiaire = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          dispositions: {...testamentData.dispositions, listeLegsParticuliers: newLegs}
                                        });
                                      }}
                                    />
                                    <Button
                                      type="button"
                                      variant="destructive"
                                      size="sm"
                                      onClick={() => {
                                        const newLegs = testamentData.dispositions.listeLegsParticuliers.filter((_, i) => i !== index);
                                        setTestamentData({
                                          ...testamentData,
                                          dispositions: {...testamentData.dispositions, listeLegsParticuliers: newLegs}
                                        });
                                      }}
                                    >
                                      Supprimer
                                    </Button>
                                  </div>
                                ))}
                                <Button
                                  type="button"
                                  onClick={() => {
                                    setTestamentData({
                                      ...testamentData,
                                      dispositions: {
                                        ...testamentData.dispositions,
                                        listeLegsParticuliers: [...testamentData.dispositions.listeLegsParticuliers, {description: "", beneficiaire: ""}]
                                      }
                                    });
                                  }}
                                  className="bg-orange-500 hover:bg-orange-600"
                                >
                                  + Ajouter un legs particulier
                                </Button>
                              </div>
                            )}
                          </div>

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="charges_conditions"
                              checked={testamentData.dispositions.chargesConditions}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, chargesConditions: e.target.checked}
                              })}
                            />
                            <label htmlFor="charges_conditions" className="text-sm cursor-pointer font-medium">
                              Charges et conditions
                            </label>
                          </div>

                          {testamentData.dispositions.chargesConditions && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails des charges et conditions..."
                                value={testamentData.dispositions.detailsChargesConditions}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsChargesConditions: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="demembrement"
                              checked={testamentData.dispositions.demembrement}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, demembrement: e.target.checked}
                              })}
                            />
                            <label htmlFor="demembrement" className="text-sm cursor-pointer font-medium">
                              Démembrement de propriété (usufruit / nue-propriété)
                            </label>
                          </div>

                          {testamentData.dispositions.demembrement && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du démembrement..."
                                value={testamentData.dispositions.detailsDemembrement}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsDemembrement: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="droit_retour"
                              checked={testamentData.dispositions.droitRetour}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, droitRetour: e.target.checked}
                              })}
                            />
                            <label htmlFor="droit_retour" className="text-sm cursor-pointer font-medium">
                              Clause de droit de retour
                            </label>
                          </div>

                          {testamentData.dispositions.droitRetour && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails du droit de retour..."
                                value={testamentData.dispositions.detailsDroitRetour}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsDroitRetour: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="exheredation"
                              checked={testamentData.dispositions.exheredation}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, exheredation: e.target.checked}
                              })}
                            />
                            <label htmlFor="exheredation" className="text-sm cursor-pointer font-medium">
                              Exhérédation (dans la limite de la quotité disponible)
                            </label>
                          </div>

                          {testamentData.dispositions.exheredation && (
                            <div className="ml-6 p-3 bg-white rounded-lg">
                              <textarea
                                className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                                placeholder="Détails de l'exhérédation..."
                                value={testamentData.dispositions.detailsExheredation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, detailsExheredation: e.target.value}
                                })}
                              />
                            </div>
                          )}

                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="executeur_testamentaire"
                              checked={testamentData.dispositions.executeurTestamentaire}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                dispositions: {...testamentData.dispositions, executeurTestamentaire: e.target.checked}
                              })}
                            />
                            <label htmlFor="executeur_testamentaire" className="text-sm cursor-pointer font-medium">
                              Désignation d'un exécuteur testamentaire
                            </label>
                          </div>

                          {testamentData.dispositions.executeurTestamentaire && (
                            <div className="ml-6 p-3 bg-white rounded-lg space-y-2">
                              <Input
                                placeholder="Nom et prénom de l'exécuteur"
                                value={testamentData.dispositions.nomExecuteur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, nomExecuteur: e.target.value}
                                })}
                              />
                              <Input
                                placeholder="Adresse de l'exécuteur"
                                value={testamentData.dispositions.adresseExecuteur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  dispositions: {...testamentData.dispositions, adresseExecuteur: e.target.value}
                                })}
                              />
                            </div>
                          )}
                        </div>
                      </div>

                      {/* Patrimoine */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Description du patrimoine du testateur</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-orange-50/50 border-orange-300">
                          
                          {/* Biens immobiliers */}
                          <div className="space-y-3">
                            <h4 className="font-medium">Biens immobiliers</h4>
                            {testamentData.patrimoine.immobiliers.map((bien, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Adresse du bien"
                                  value={bien.adresse}
                                  onChange={(e) => {
                                    const newBiens = [...testamentData.patrimoine.immobiliers];
                                    newBiens[index].adresse = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Type (maison, appartement, terrain...)"
                                  value={bien.type}
                                  onChange={(e) => {
                                    const newBiens = [...testamentData.patrimoine.immobiliers];
                                    newBiens[index].type = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Valeur estimée (€)"
                                  value={bien.valeur}
                                  onChange={(e) => {
                                    const newBiens = [...testamentData.patrimoine.immobiliers];
                                    newBiens[index].valeur = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newBiens = testamentData.patrimoine.immobiliers.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, immobiliers: newBiens}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    immobiliers: [...testamentData.patrimoine.immobiliers, {adresse: "", type: "", valeur: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un bien immobilier
                            </Button>
                          </div>

                          {/* Avoirs financiers */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Avoirs financiers (comptes, placements)</h4>
                            {testamentData.patrimoine.avoirsFinanciers.map((avoir, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Type (compte courant, livret, assurance-vie...)"
                                  value={avoir.type}
                                  onChange={(e) => {
                                    const newAvoirs = [...testamentData.patrimoine.avoirsFinanciers];
                                    newAvoirs[index].type = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Établissement"
                                  value={avoir.etablissement}
                                  onChange={(e) => {
                                    const newAvoirs = [...testamentData.patrimoine.avoirsFinanciers];
                                    newAvoirs[index].etablissement = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Montant estimé (€)"
                                  value={avoir.montant}
                                  onChange={(e) => {
                                    const newAvoirs = [...testamentData.patrimoine.avoirsFinanciers];
                                    newAvoirs[index].montant = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newAvoirs = testamentData.patrimoine.avoirsFinanciers.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, avoirsFinanciers: newAvoirs}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    avoirsFinanciers: [...testamentData.patrimoine.avoirsFinanciers, {type: "", etablissement: "", montant: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un avoir financier
                            </Button>
                          </div>

                          {/* Biens meubles */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Biens meubles (véhicules, œuvres d'art, bijoux...)</h4>
                            {testamentData.patrimoine.biensMeubles.map((meuble, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Description"
                                  value={meuble.description}
                                  onChange={(e) => {
                                    const newMeubles = [...testamentData.patrimoine.biensMeubles];
                                    newMeubles[index].description = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, biensMeubles: newMeubles}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Valeur estimée (€)"
                                  value={meuble.valeur}
                                  onChange={(e) => {
                                    const newMeubles = [...testamentData.patrimoine.biensMeubles];
                                    newMeubles[index].valeur = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, biensMeubles: newMeubles}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newMeubles = testamentData.patrimoine.biensMeubles.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, biensMeubles: newMeubles}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    biensMeubles: [...testamentData.patrimoine.biensMeubles, {description: "", valeur: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter un bien meuble
                            </Button>
                          </div>

                          {/* Parts sociales */}
                          <div className="space-y-3 border-t pt-3">
                            <h4 className="font-medium">Parts sociales / actions</h4>
                            {testamentData.patrimoine.partsSociales.map((parts, index) => (
                              <div key={index} className="p-3 bg-white rounded-lg border space-y-2">
                                <Input
                                  placeholder="Société"
                                  value={parts.societe}
                                  onChange={(e) => {
                                    const newParts = [...testamentData.patrimoine.partsSociales];
                                    newParts[index].societe = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Nombre de parts/actions"
                                  value={parts.nombre}
                                  onChange={(e) => {
                                    const newParts = [...testamentData.patrimoine.partsSociales];
                                    newParts[index].nombre = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                />
                                <Input
                                  placeholder="Valeur estimée (€)"
                                  value={parts.valeur}
                                  onChange={(e) => {
                                    const newParts = [...testamentData.patrimoine.partsSociales];
                                    newParts[index].valeur = e.target.value;
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                />
                                <Button
                                  type="button"
                                  variant="destructive"
                                  size="sm"
                                  onClick={() => {
                                    const newParts = testamentData.patrimoine.partsSociales.filter((_, i) => i !== index);
                                    setTestamentData({
                                      ...testamentData,
                                      patrimoine: {...testamentData.patrimoine, partsSociales: newParts}
                                    });
                                  }}
                                >
                                  Supprimer
                                </Button>
                              </div>
                            ))}
                            <Button
                              type="button"
                              onClick={() => {
                                setTestamentData({
                                  ...testamentData,
                                  patrimoine: {
                                    ...testamentData.patrimoine,
                                    partsSociales: [...testamentData.patrimoine.partsSociales, {societe: "", nombre: "", valeur: ""}]
                                  }
                                });
                              }}
                              className="bg-orange-500 hover:bg-orange-600"
                            >
                              + Ajouter des parts sociales
                            </Button>
                          </div>
                        </div>
                      </div>

                      {/* Régime matrimonial détaillé */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Régime matrimonial du testateur</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-purple-50/50 border-purple-300">
                          <p className="text-sm text-gray-600">Informations sur le régime matrimonial (utile pour l'automatisation et le contrôle notarial)</p>
                          
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nature du régime matrimonial</Label>
                              <Select
                                value={testamentData.regimeMatrimonial.nature || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, nature: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="legal">Régime légal (communauté réduite aux acquêts)</SelectItem>
                                  <SelectItem value="separation">Séparation de biens</SelectItem>
                                  <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                                  <SelectItem value="participation">Participation aux acquêts</SelectItem>
                                  <SelectItem value="autre">Autre régime</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Date du contrat de mariage</Label>
                              <Input
                                type="date"
                                value={testamentData.regimeMatrimonial.contratMariage}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, contratMariage: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Notaire ayant reçu le contrat</Label>
                              <Input
                                value={testamentData.regimeMatrimonial.notaireContrat}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, notaireContrat: e.target.value}
                                })}
                                placeholder="Nom et office du notaire"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Biens propres (description sommaire)</Label>
                              <textarea
                                className="w-full p-2 border rounded-md"
                                rows={2}
                                value={testamentData.regimeMatrimonial.biensPropres}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, biensPropres: e.target.value}
                                })}
                                placeholder="Ex: Biens acquis avant mariage, donations, successions..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Biens communs (description sommaire)</Label>
                              <textarea
                                className="w-full p-2 border rounded-md"
                                rows={2}
                                value={testamentData.regimeMatrimonial.biensCommuns}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, biensCommuns: e.target.value}
                                })}
                                placeholder="Ex: Résidence principale, comptes joints..."
                              />
                            </div>
                          </div>

                          <div className="border-t pt-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="preciput"
                                checked={testamentData.regimeMatrimonial.preciput}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  regimeMatrimonial: {...testamentData.regimeMatrimonial, preciput: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="preciput" className="cursor-pointer">Clause de préciput présente dans le contrat</Label>
                            </div>

                            {testamentData.regimeMatrimonial.preciput && (
                              <div className="ml-6 mt-3">
                                <Label>Détails du préciput</Label>
                                <textarea
                                  className="w-full p-2 border rounded-md mt-2"
                                  rows={2}
                                  value={testamentData.regimeMatrimonial.detailsPreciput}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    regimeMatrimonial: {...testamentData.regimeMatrimonial, detailsPreciput: e.target.value}
                                  })}
                                  placeholder="Préciser les biens concernés par le préciput..."
                                />
                              </div>
                            )}
                          </div>
                        </div>
                      </div>

                      {/* Formalités spécifiques */}
                      <div className="space-y-4">
                        <h3 className="font-semibold text-lg border-b pb-2">Formalités spécifiques - Testament authentique</h3>
                        <div className="p-4 border-2 rounded-lg space-y-4 bg-blue-50/50 border-blue-300">
                        {/* Notaire */}
                        <div className="space-y-3">
                          <h4 className="font-medium">Notaire instrumentaire</h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom du notaire <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentAuthentique.notaireNom}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, notaireNom: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Office notarial <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentAuthentique.notaireOffice}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, notaireOffice: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Adresse complète de l'office</Label>
                              <Input
                                value={testamentData.testamentAuthentique.notaireAdresse}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, notaireAdresse: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Modalités réception - DOIT ÊTRE EN PREMIER */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                          <h4 className="font-medium">Mode de réception du testament <span className="text-red-500">*</span></h4>
                          <p className="text-sm text-gray-600 mb-2">Choisissez la modalité de réception (ce choix conditionne le reste du formulaire)</p>
                          <div className="space-y-2">
                            <Label>Testament reçu par <span className="text-red-500">*</span></Label>
                            <Select
                              value={testamentData.testamentAuthentique.modaliteReception || undefined}
                              onValueChange={(value) => setTestamentData({
                                ...testamentData,
                                testamentAuthentique: {...testamentData.testamentAuthentique, modaliteReception: value}
                              })}
                            >
                              <SelectTrigger><SelectValue placeholder="Sélectionner le mode de réception..." /></SelectTrigger>
                              <SelectContent>
                                <SelectItem value="1notaire_2temoins">1 notaire + 2 témoins</SelectItem>
                                <SelectItem value="2notaires">2 notaires (sans témoins)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                            <div className="space-y-2">
                              <Label>Lieu de réception <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentAuthentique.lieuReception}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, lieuReception: e.target.value}
                                })}
                                placeholder="Ex: Office notarial, domicile du testateur..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de réception</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentAuthentique.dateReception}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, dateReception: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Témoins (conditionnels selon modalité) */}
                        {testamentData.testamentAuthentique.modaliteReception === "1notaire_2temoins" && (
                          <div className="space-y-3">
                            <div className="flex justify-between items-center">
                              <h4 className="font-medium">Témoins (2 témoins obligatoires) <span className="text-red-500">*</span></h4>
                              <Button
                                type="button"
                                variant="outline"
                                size="sm"
                                onClick={() => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {
                                    ...testamentData.testamentAuthentique,
                                    temoins: [...testamentData.testamentAuthentique.temoins, {
                                      nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", nationalite: "", 
                                      profession: "", adresse: "", lienAvecTestateur: "",
                                      nonHeritier: false, nonLegataire: false, nonConjoint: false, 
                                      nonParentJusque4eDegre: false, capaciteJuridique: false, 
                                      comprendLangue: false, agitLibrement: false, signature: false
                                    }]
                                  }
                                })}
                              >
                                + Ajouter un témoin
                              </Button>
                            </div>

                            {testamentData.testamentAuthentique.temoins.map((temoin, idx) => (
                              <div key={idx} className="p-4 bg-white rounded-lg space-y-3 border-2 border-blue-200">
                                <div className="flex justify-between">
                                  <h5 className="text-sm font-medium">Témoin {idx + 1}</h5>
                                  <Button
                                    type="button"
                                    variant="ghost"
                                    size="sm"
                                    onClick={() => {
                                      const newTemoins = testamentData.testamentAuthentique.temoins.filter((_, i) => i !== idx);
                                      setTestamentData({
                                        ...testamentData,
                                        testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                      });
                                    }}
                                  >
                                    🗑️
                                  </Button>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                  <div className="space-y-2">
                                    <Label>Nom <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.nom}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].nom = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Prénom <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.prenom}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].prenom = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Date de naissance <span className="text-red-500">*</span></Label>
                                    <Input
                                      type="date"
                                      value={temoin.dateNaissance}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].dateNaissance = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Lieu de naissance</Label>
                                    <Input
                                      value={temoin.lieuNaissance}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].lieuNaissance = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Nationalité <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.nationalite}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].nationalite = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                      placeholder="Ex: Française"
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Profession</Label>
                                    <Input
                                      value={temoin.profession}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].profession = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>

                                  <div className="space-y-2">
                                    <Label>Lien avec le testateur <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.lienAvecTestateur}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].lienAvecTestateur = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                      placeholder="Ex: Aucun lien"
                                    />
                                  </div>

                                  <div className="space-y-2 md:col-span-2">
                                    <Label>Adresse complète <span className="text-red-500">*</span></Label>
                                    <Input
                                      value={temoin.adresse}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                        newTemoins[idx].adresse = e.target.value;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                        });
                                      }}
                                    />
                                  </div>
                                </div>

                                {/* Déclarations légales (CONDITIONS DE VALIDITÉ) */}
                                <div className="mt-3 p-3 bg-red-50 rounded-lg border border-red-200">
                                  <p className="text-sm font-medium mb-2 text-red-700">Déclarations légales - CONDITIONS DE VALIDITÉ <span className="text-red-500">*</span></p>
                                  <div className="space-y-2">
                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_nonHeritier`}
                                        checked={temoin.nonHeritier}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].nonHeritier = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_nonHeritier`} className="cursor-pointer text-sm">Le témoin n'est ni héritier ni légataire</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_nonConjoint`}
                                        checked={temoin.nonConjoint}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].nonConjoint = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_nonConjoint`} className="cursor-pointer text-sm">Le témoin n'est ni conjoint, ni parent jusqu'au 4ᵉ degré</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_capacite`}
                                        checked={temoin.capaciteJuridique}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].capaciteJuridique = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_capacite`} className="cursor-pointer text-sm">Le témoin a la capacité juridique</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_langue`}
                                        checked={temoin.comprendLangue}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].comprendLangue = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_langue`} className="cursor-pointer text-sm">Le témoin comprend la langue utilisée</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_libre`}
                                        checked={temoin.agitLibrement}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].agitLibrement = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_libre`} className="cursor-pointer text-sm">Le témoin agit librement et sans contrainte</Label>
                                    </div>

                                    <div className="flex items-center space-x-2">
                                      <input
                                        type="checkbox"
                                        id={`t${idx}_signature`}
                                        checked={temoin.signature}
                                        onChange={(e) => {
                                          const newTemoins = [...testamentData.testamentAuthentique.temoins];
                                          newTemoins[idx].signature = e.target.checked;
                                          setTestamentData({
                                            ...testamentData,
                                            testamentAuthentique: {...testamentData.testamentAuthentique, temoins: newTemoins}
                                          });
                                        }}
                                        className="w-4 h-4"
                                      />
                                      <Label htmlFor={`t${idx}_signature`} className="cursor-pointer text-sm">Signature du témoin</Label>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}

                        {/* Second notaire (conditionnel si modalité = 2 notaires) */}
                        {testamentData.testamentAuthentique.modaliteReception === "2notaires" && (
                          <div className="space-y-3 p-3 bg-blue-100 rounded-lg border border-blue-300">
                            <h4 className="font-medium">Second notaire <span className="text-red-500">*</span></h4>
                            <p className="text-sm text-gray-600">Obligatoire pour la modalité "2 notaires"</p>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Nom du 2ᵉ notaire <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentAuthentique.secondNotaireNom}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, secondNotaireNom: e.target.value}
                                  })}
                                  placeholder="M./Mme Nom Prénom"
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Office notarial <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentAuthentique.secondNotaireOffice}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, secondNotaireOffice: e.target.value}
                                  })}
                                  placeholder="Nom de l'office"
                                />
                              </div>

                              <div className="space-y-2 md:col-span-2">
                                <Label>Adresse de l'office</Label>
                                <Input
                                  value={testamentData.testamentAuthentique.secondNotaireAdresse}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, secondNotaireAdresse: e.target.value}
                                  })}
                                  placeholder="Adresse complète"
                                />
                              </div>
                            </div>
                          </div>
                        )}

                        {/* Formalités légales */}
                        <div className="space-y-3 p-3 bg-red-50 rounded-lg border border-red-300">
                          <h4 className="font-medium">Formalités légales <span className="text-red-500">*</span></h4>
                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="dicte"
                                checked={testamentData.testamentAuthentique.formaliteDicte}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, formaliteDicte: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="dicte" className="cursor-pointer">Testament dicté par le testateur au notaire</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="relu"
                                checked={testamentData.testamentAuthentique.formaliteRelu}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, formaliteRelu: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="relu" className="cursor-pointer">Lecture intégrale par le notaire au testateur</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="approbation"
                                checked={testamentData.testamentAuthentique.declarationApprobation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, declarationApprobation: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="approbation" className="cursor-pointer">Déclaration d'approbation expresse du testateur</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="signe"
                                checked={testamentData.testamentAuthentique.formaliteSigne}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, formaliteSigne: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="signe" className="cursor-pointer">Signatures : testateur + notaire(s) + témoins (le cas échéant)</Label>
                            </div>

                            <div className="flex items-center space-x-2 ml-6">
                              <input
                                type="checkbox"
                                id="impossibilite"
                                checked={testamentData.testamentAuthentique.impossibiliteSigner}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentAuthentique: {...testamentData.testamentAuthentique, impossibiliteSigner: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="impossibilite" className="cursor-pointer text-sm">Impossibilité de signer (mention requise)</Label>
                            </div>

                            {testamentData.testamentAuthentique.impossibiliteSigner && (
                              <div className="ml-6 space-y-2">
                                <Label>Motif de l'impossibilité <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentAuthentique.motifImpossibilite}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, motifImpossibilite: e.target.value}
                                  })}
                                  placeholder="Ex: Impossibilité physique, handicap..."
                                />
                              </div>
                            )}
                          </div>
                        </div>

                        {/* Inscription FCDDV */}
                        <div className="space-y-3 p-3 bg-green-50 rounded-lg border border-green-300">
                          <h4 className="font-medium">Inscription au FCDDV</h4>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="fcddv"
                              checked={testamentData.testamentAuthentique.inscriptionFCDDV}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentAuthentique: {...testamentData.testamentAuthentique, inscriptionFCDDV: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="fcddv" className="cursor-pointer">Procéder à l'inscription au FCDDV</Label>
                          </div>

                          {testamentData.testamentAuthentique.inscriptionFCDDV && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Date d'inscription</Label>
                                <Input
                                  type="date"
                                  value={testamentData.testamentAuthentique.dateInscriptionFCDDV}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, dateInscriptionFCDDV: e.target.value}
                                  })}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Notaire dépositaire</Label>
                                <Input
                                  value={testamentData.testamentAuthentique.notaireDepositaire}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentAuthentique: {...testamentData.testamentAuthentique, notaireDepositaire: e.target.value}
                                  })}
                                  placeholder="Nom du notaire dépositaire"
                                />
                              </div>
                            </div>
                          )}
                        </div>
                      </div>
                    </div>

                    {/* Mentions légales */}
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Mentions légales et rappels</h3>
                      <div className="p-4 border-2 rounded-lg space-y-3 bg-red-50/50 border-red-300">
                        
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="rappel_reserve"
                            checked={testamentData.mentionsLegales.rappelReserveHereditaire}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, rappelReserveHereditaire: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="rappel_reserve" className="cursor-pointer font-medium">
                            <span className="text-red-500">*</span> Rappel de la réserve héréditaire (art. 912-916 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="rappel_quotite"
                            checked={testamentData.mentionsLegales.rappelQuotiteDisponible}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, rappelQuotiteDisponible: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="rappel_quotite" className="cursor-pointer font-medium">
                            <span className="text-red-500">*</span> Rappel de la quotité disponible
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="testament_revocable"
                            checked={testamentData.mentionsLegales.testamentRevocable}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, testamentRevocable: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="testament_revocable" className="cursor-pointer font-medium">
                            <span className="text-red-500">*</span> Testament révocable à tout moment (art. 895 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="indignite"
                            checked={testamentData.mentionsLegales.casIndignite}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, casIndignite: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="indignite" className="cursor-pointer">
                            Mention des cas d'indignité successorale (art. 726-728 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="capacite_legataires"
                            checked={testamentData.mentionsLegales.verificationCapaciteLegataires}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, verificationCapaciteLegataires: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="capacite_legataires" className="cursor-pointer">
                            Vérification capacité des légataires à recevoir
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="droits_reduction"
                            checked={testamentData.mentionsLegales.droitsReduction}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, droitsReduction: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="droits_reduction" className="cursor-pointer">
                            Mention des droits de réduction (art. 920-930 Code civil)
                          </Label>
                        </div>

                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="regime_fiscal"
                            checked={testamentData.mentionsLegales.regimeFiscalSuccessions}
                            onChange={(e) => setTestamentData({
                              ...testamentData,
                              mentionsLegales: {...testamentData.mentionsLegales, regimeFiscalSuccessions: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="regime_fiscal" className="cursor-pointer">
                            Information sur le régime fiscal des successions
                          </Label>
                        </div>
                      </div>
                    </div>

                    {/* Documents obligatoires */}
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Documents obligatoires à collecter</h3>
                      <div className="p-4 border-2 rounded-lg space-y-5 bg-indigo-50/50 border-indigo-300">
                        
                        {/* Documents du testateur */}
                        <div className="space-y-3">
                          <h4 className="font-medium text-indigo-900">Documents du testateur</h4>
                          <div className="space-y-2">
                            <Label>Pièce d'identité du testateur (CNI, passeport)</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("pieceIdentiteTestateur")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.pieceIdentiteTestateur ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.pieceIdentiteTestateur ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.pieceIdentiteTestateur ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.pieceIdentiteTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.pieceIdentiteTestateur || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Livret de famille</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("livretFamilleTestateur")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.livretFamilleTestateur ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.livretFamilleTestateur ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.livretFamilleTestateur ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.livretFamilleTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.livretFamilleTestateur || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Certificat de capacité juridique / jugement tutelle-curatelle (si applicable)</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("certificatCapaciteTestateur")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.certificatCapaciteTestateur ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.certificatCapaciteTestateur ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.certificatCapaciteTestateur ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.certificatCapaciteTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.certificatCapaciteTestateur || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>
                        </div>

                        {/* Documents des témoins */}
                        <div className="space-y-3 border-t pt-4">
                          <h4 className="font-medium text-indigo-900">Documents des témoins</h4>
                          <div className="space-y-2">
                            <Label>Pièces d'identité des témoins</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("piecesIdentiteTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.piecesIdentiteTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.piecesIdentiteTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.piecesIdentiteTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.piecesIdentiteTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.piecesIdentiteTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Justificatifs de domicile des témoins</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("justificatifsDomicileTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.justificatifsDomicileTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.justificatifsDomicileTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.justificatifsDomicileTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.justificatifsDomicileTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.justificatifsDomicileTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Attestations sur l'honneur capacité témoins</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("attestationsCapaciteTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.attestationsCapaciteTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.attestationsCapaciteTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.attestationsCapaciteTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.attestationsCapaciteTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.attestationsCapaciteTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Casiers judiciaires des témoins (extrait n°3)</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("casiersJudiciairesTemoins")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.casiersJudiciairesTemoins ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.casiersJudiciairesTemoins ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.casiersJudiciairesTemoins ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.casiersJudiciairesTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.casiersJudiciairesTemoins || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>
                        </div>

                        {/* Documents patrimoniaux */}
                        <div className="space-y-3 border-t pt-4">
                          <h4 className="font-medium text-indigo-900">Documents patrimoniaux</h4>
                          <div className="space-y-2">
                            <Label>Titres de propriété immobiliers</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("titresPropriete")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.titresPropriete ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.titresPropriete ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.titresPropriete ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.titresPropriete ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.titresPropriete || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Relevés bancaires et comptes</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("relevesBancaires")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.relevesBancaires ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.relevesBancaires ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.relevesBancaires ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.relevesBancaires ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.relevesBancaires || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Contrat de mariage / régime matrimonial</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("contratMariage")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.contratMariage ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.contratMariage ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.contratMariage ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.contratMariage ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.contratMariage || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>

                          <div className="space-y-2">
                            <Label>Autres justificatifs patrimoniaux</Label>
                            <button
                              type="button"
                              onClick={() => handleFileClick("autresJustificatifs")}
                              className="w-full p-3 border-2 border-dashed border-orange-300 rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 hover:border-orange-400 transition-colors"
                              style={{
                                borderColor: testamentData.documentsAuthentique.autresJustificatifs ? "#22c55e" : "#fb923c",
                                backgroundColor: testamentData.documentsAuthentique.autresJustificatifs ? "#f0fdf4" : "white"
                              }}
                            >
                              {testamentData.documentsAuthentique.autresJustificatifs ? (
                                <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                </svg>
                              ) : (
                                <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                                </svg>
                              )}
                              <span className={testamentData.documentsAuthentique.autresJustificatifs ? "text-green-700 font-medium" : "text-orange-700"}>
                                {testamentData.documentsAuthentique.autresJustificatifs || "Aucune pièce chargée - Cliquer pour ajouter"}
                              </span>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  )}

                  {/* 9. Testament mystique spécifique */}
                  {testamentData.typeTestament === "mystique" && (
                    <div className="space-y-4">
                      <h3 className="font-semibold text-lg border-b pb-2">Formalités spécifiques - Testament mystique</h3>
                      
                      <div className="p-4 border-2 rounded-lg space-y-4 bg-purple-50/50 border-purple-300">
                        
                        {/* Testament antérieur (même section que pour authentique) */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                          <h4 className="font-medium">Testament antérieur existant ?</h4>
                          <p className="text-sm text-gray-600">Bonne pratique notariale (non obligatoire)</p>
                          <div className="flex items-center space-x-4">
                            <label className="flex items-center space-x-2 cursor-pointer">
                              <input
                                type="radio"
                                name="testamentAnterieurMystique"
                                checked={testamentData.testamentAnterieur === true}
                                onChange={() => setTestamentData({...testamentData, testamentAnterieur: true})}
                                className="w-4 h-4"
                              />
                              <span>Oui</span>
                            </label>
                            <label className="flex items-center space-x-2 cursor-pointer">
                              <input
                                type="radio"
                                name="testamentAnterieurMystique"
                                checked={testamentData.testamentAnterieur === false}
                                onChange={() => setTestamentData({...testamentData, testamentAnterieur: false})}
                                className="w-4 h-4"
                              />
                              <span>Non</span>
                            </label>
                          </div>

                          {testamentData.testamentAnterieur && (
                            <div className="ml-6 p-3 bg-white rounded-lg border border-yellow-300 space-y-3">
                              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div className="space-y-2">
                                  <Label>Date du précédent testament</Label>
                                  <Input
                                    type="date"
                                    value={testamentData.testamentAnterieurDate}
                                    onChange={(e) => setTestamentData({...testamentData, testamentAnterieurDate: e.target.value})}
                                  />
                                </div>
                                <div className="space-y-2">
                                  <Label>Type du précédent testament</Label>
                                  <Select
                                    value={testamentData.testamentAnterieurType || undefined}
                                    onValueChange={(value) => setTestamentData({...testamentData, testamentAnterieurType: value})}
                                  >
                                    <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                    <SelectContent>
                                      <SelectItem value="authentique">Testament authentique</SelectItem>
                                      <SelectItem value="mystique">Testament mystique</SelectItem>
                                      <SelectItem value="olographe">Testament olographe</SelectItem>
                                    </SelectContent>
                                  </Select>
                                </div>
                                <div className="space-y-2 md:col-span-2">
                                  <Label>Notaire dépositaire (si connu)</Label>
                                  <Input
                                    value={testamentData.testamentAnterieurNotaire}
                                    onChange={(e) => setTestamentData({...testamentData, testamentAnterieurNotaire: e.target.value})}
                                    placeholder="Nom et adresse du notaire"
                                  />
                                </div>
                              </div>
                            </div>
                          )}
                        </div>

                        {/* Rédaction */}
                        <div className="space-y-3 p-3 bg-white rounded-lg border border-purple-200">
                          <h4 className="font-medium">Mode de rédaction du testament <span className="text-red-500">*</span></h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Rédigé par <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentMystique.redactionPar || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, redactionPar: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="testateur">Le testateur lui-même</SelectItem>
                                  <SelectItem value="tiers">Un tiers</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            {testamentData.testamentMystique.redactionPar === "tiers" && (
                              <div className="space-y-2">
                                <Label>Nom du rédacteur <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentMystique.nomRedacteur}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, nomRedacteur: e.target.value}
                                  })}
                                  placeholder="Nom et prénom du rédacteur"
                                />
                              </div>
                            )}

                            <div className="space-y-2">
                              <Label>Type d'écriture <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentMystique.typeEcriture || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, typeEcriture: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="manuscrit">Manuscrit (à la main)</SelectItem>
                                  <SelectItem value="dactylographie">Dactylographié</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Langue du testament <span className="text-red-500">*</span></Label>
                              <Select
                                value={testamentData.testamentMystique.langueTestament || undefined}
                                onValueChange={(value) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, langueTestament: value}
                                })}
                              >
                                <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                                <SelectContent>
                                  <SelectItem value="francais">Français</SelectItem>
                                  <SelectItem value="autre">Autre langue</SelectItem>
                                </SelectContent>
                              </Select>
                            </div>

                            <div className="space-y-2">
                              <Label>Nombre de pages</Label>
                              <Input
                                type="number"
                                value={testamentData.testamentMystique.nombrePages}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, nombrePages: e.target.value}
                                })}
                                placeholder="Nombre de pages"
                              />
                            </div>
                          </div>
                        </div>

                        {/* Présentation sous pli fermé */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                          <h4 className="font-medium">Présentation sous pli fermé et scellé <span className="text-red-500">*</span></h4>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="cachete"
                              checked={testamentData.testamentMystique.cachete}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, cachete: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="cachete" className="cursor-pointer">Pli fermé, cacheté et scellé</Label>
                          </div>

                          <div className="space-y-2">
                            <Label>Description du scellé <span className="text-red-500">*</span></Label>
                            <Input
                              value={testamentData.testamentMystique.descriptionScelle}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, descriptionScelle: e.target.value}
                              })}
                              placeholder="Ex: Enveloppe cachetée avec cire rouge..."
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Lieu de présentation <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentMystique.lieuPresentation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, lieuPresentation: e.target.value}
                                })}
                                placeholder="Ex: Office notarial..."
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de présentation</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentMystique.datePresentation}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, datePresentation: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Notaire */}
                        <div className="space-y-3 p-3 bg-white rounded-lg border border-purple-200">
                          <h4 className="font-medium">Notaire récepteur <span className="text-red-500">*</span></h4>
                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Nom du notaire <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentMystique.notaireNom}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, notaireNom: e.target.value}
                                })}
                                placeholder="M./Mme Nom Prénom"
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Office notarial <span className="text-red-500">*</span></Label>
                              <Input
                                value={testamentData.testamentMystique.notaireOffice}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, notaireOffice: e.target.value}
                                })}
                                placeholder="Nom de l'office"
                              />
                            </div>

                            <div className="space-y-2 md:col-span-2">
                              <Label>Adresse de l'office</Label>
                              <Input
                                value={testamentData.testamentMystique.notaireAdresse}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, notaireAdresse: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Témoins (2 obligatoires) */}
                        <div className="space-y-3 p-3 bg-white rounded-lg border border-purple-200">
                          <div className="flex justify-between items-center">
                            <h4 className="font-medium">Témoins (2 témoins obligatoires) <span className="text-red-500">*</span></h4>
                            <Button
                              type="button"
                              size="sm"
                              className="bg-orange-600 hover:bg-orange-700 text-white"
                              onClick={() => setTestamentData({
                                ...testamentData,
                                testamentMystique: {
                                  ...testamentData.testamentMystique,
                                  temoins: [...testamentData.testamentMystique.temoins, {
                                    nom: "", prenom: "", dateNaissance: "", lieuNaissance: "", nationalite: "",
                                    profession: "", adresse: "", lienAvecTestateur: "",
                                    nonHeritier: false, nonLegataire: false, nonConjoint: false,
                                    nonParentJusque4eDegre: false, capaciteJuridique: false,
                                    comprendLangue: false, agitLibrement: false, signature: false
                                  }]
                                }
                              })}
                            >
                              + Ajouter un témoin
                            </Button>
                          </div>

                          {testamentData.testamentMystique.temoins.map((temoin, idx) => (
                            <div key={idx} className="p-4 bg-purple-50 rounded-lg space-y-3 border-2 border-purple-300">
                              <div className="flex justify-between">
                                <h5 className="text-sm font-medium">Témoin {idx + 1}</h5>
                                <Button
                                  type="button"
                                  variant="ghost"
                                  size="sm"
                                  onClick={() => {
                                    const newTemoins = testamentData.testamentMystique.temoins.filter((_, i) => i !== idx);
                                    setTestamentData({
                                      ...testamentData,
                                      testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                    });
                                  }}
                                >
                                  🗑️
                                </Button>
                              </div>

                              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <div className="space-y-2">
                                  <Label>Nom <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.nom}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].nom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Prénom <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.prenom}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].prenom = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Date de naissance <span className="text-red-500">*</span></Label>
                                  <Input
                                    type="date"
                                    value={temoin.dateNaissance}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].dateNaissance = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Lieu de naissance</Label>
                                  <Input
                                    value={temoin.lieuNaissance}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].lieuNaissance = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Nationalité <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.nationalite}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].nationalite = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                    placeholder="Ex: Française"
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Profession</Label>
                                  <Input
                                    value={temoin.profession}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].profession = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>

                                <div className="space-y-2">
                                  <Label>Lien avec le testateur <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.lienAvecTestateur}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].lienAvecTestateur = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                    placeholder="Ex: Aucun lien"
                                  />
                                </div>

                                <div className="space-y-2 md:col-span-2">
                                  <Label>Adresse complète <span className="text-red-500">*</span></Label>
                                  <Input
                                    value={temoin.adresse}
                                    onChange={(e) => {
                                      const newTemoins = [...testamentData.testamentMystique.temoins];
                                      newTemoins[idx].adresse = e.target.value;
                                      setTestamentData({
                                        ...testamentData,
                                        testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                      });
                                    }}
                                  />
                                </div>
                              </div>

                              {/* Déclarations légales */}
                              <div className="mt-3 p-3 bg-red-50 rounded-lg border border-red-200">
                                <p className="text-sm font-medium mb-2 text-red-700">Déclarations légales - CONDITIONS DE VALIDITÉ <span className="text-red-500">*</span></p>
                                <div className="space-y-2">
                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_nonHeritier`}
                                      checked={temoin.nonHeritier}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].nonHeritier = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_nonHeritier`} className="cursor-pointer text-sm">Le témoin n'est ni héritier ni légataire</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_nonConjoint`}
                                      checked={temoin.nonConjoint}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].nonConjoint = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_nonConjoint`} className="cursor-pointer text-sm">Le témoin n'est ni conjoint, ni parent jusqu'au 4ᵉ degré</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_capacite`}
                                      checked={temoin.capaciteJuridique}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].capaciteJuridique = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_capacite`} className="cursor-pointer text-sm">Le témoin a la capacité juridique</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_langue`}
                                      checked={temoin.comprendLangue}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].comprendLangue = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_langue`} className="cursor-pointer text-sm">Le témoin comprend la langue utilisée</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_libre`}
                                      checked={temoin.agitLibrement}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].agitLibrement = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_libre`} className="cursor-pointer text-sm">Le témoin agit librement et sans contrainte</Label>
                                  </div>

                                  <div className="flex items-center space-x-2">
                                    <input
                                      type="checkbox"
                                      id={`tm${idx}_signature`}
                                      checked={temoin.signature}
                                      onChange={(e) => {
                                        const newTemoins = [...testamentData.testamentMystique.temoins];
                                        newTemoins[idx].signature = e.target.checked;
                                        setTestamentData({
                                          ...testamentData,
                                          testamentMystique: {...testamentData.testamentMystique, temoins: newTemoins}
                                        });
                                      }}
                                      className="w-4 h-4"
                                    />
                                    <Label htmlFor={`tm${idx}_signature`} className="cursor-pointer text-sm">Signature du témoin</Label>
                                  </div>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>

                        {/* Déclarations obligatoires art. 976 C. civ. */}
                        <div className="space-y-3 p-3 bg-red-50 rounded-lg border-2 border-red-400">
                          <h4 className="font-medium text-red-700">🔴 Déclarations obligatoires (art. 976 C. civ.) <span className="text-red-500">*</span></h4>
                          <p className="text-sm text-red-600 mb-3">Sans ces déclarations → Risque de nullité du testament</p>
                          
                          <div className="space-y-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="testateurSaitLireEcrire"
                                checked={testamentData.testamentMystique.testateurSaitLireEcrire}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, testateurSaitLireEcrire: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="testateurSaitLireEcrire" className="cursor-pointer font-medium text-red-700">
                                <span className="text-red-500">*</span> Le testateur déclare savoir lire et écrire (OBLIGATOIRE)
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="testateurReconnaitTestament"
                                checked={testamentData.testamentMystique.testateurReconnaitTestament}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, testateurReconnaitTestament: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="testateurReconnaitTestament" className="cursor-pointer font-medium text-red-700">
                                <span className="text-red-500">*</span> Le testateur reconnaît que le testament contenu dans le pli est bien le sien
                              </Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="pliNonOuvert"
                                checked={testamentData.testamentMystique.pliNonOuvert}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, pliNonOuvert: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="pliNonOuvert" className="cursor-pointer font-medium text-red-700">
                                <span className="text-red-500">*</span> Le pli n'a pas été ouvert par le notaire (le notaire ne connaît pas le contenu)
                              </Label>
                            </div>
                          </div>
                        </div>

                        {/* Conditions légales témoins (sécurisation) */}
                        <div className="space-y-3 p-3 bg-yellow-50 rounded-lg border border-yellow-400">
                          <h4 className="font-medium text-yellow-800">🟡 Conditions légales des témoins (ultra-sécurisant)</h4>
                          <p className="text-sm text-yellow-700 mb-3">Recommandé pour sécurisation maximale</p>
                          
                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="temoinsMajeurs"
                                checked={testamentData.testamentMystique.temoinsMajeurs}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, temoinsMajeurs: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="temoinsMajeurs" className="cursor-pointer">☐ Témoins majeurs</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="temoinsNonHeritiersLegataires"
                                checked={testamentData.testamentMystique.temoinsNonHeritiersLegataires}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, temoinsNonHeritiersLegataires: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="temoinsNonHeritiersLegataires" className="cursor-pointer">☐ Témoins non héritiers, non légataires</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="temoinsSaventLireEcrire"
                                checked={testamentData.testamentMystique.temoinsSaventLireEcrire}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, temoinsSaventLireEcrire: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="temoinsSaventLireEcrire" className="cursor-pointer">☐ Témoins sachant lire et écrire</Label>
                            </div>
                          </div>
                        </div>

                        {/* Acte de suscription */}
                        <div className="space-y-3 p-3 bg-blue-50 rounded-lg border border-blue-300">
                          <h4 className="font-medium">Acte de suscription <span className="text-red-500">*</span></h4>
                          <div className="flex items-center space-x-2 mb-3">
                            <input
                              type="checkbox"
                              id="declarationContenu"
                              checked={testamentData.testamentMystique.declarationContenuTestament}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, declarationContenuTestament: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="declarationContenu" className="cursor-pointer">Déclaration que le pli contient le testament</Label>
                          </div>

                          <div className="space-y-2">
                            <Label>Texte de la suscription</Label>
                            <textarea
                              className="w-full min-h-[80px] p-2 border rounded-md text-sm"
                              value={testamentData.testamentMystique.suscription}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, suscription: e.target.value}
                              })}
                              placeholder="Texte de l'acte de suscription..."
                            />
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="space-y-2">
                              <Label>Lieu de suscription</Label>
                              <Input
                                value={testamentData.testamentMystique.lieuSuscription}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, lieuSuscription: e.target.value}
                                })}
                              />
                            </div>

                            <div className="space-y-2">
                              <Label>Date de suscription</Label>
                              <Input
                                type="date"
                                value={testamentData.testamentMystique.dateSuscription}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, dateSuscription: e.target.value}
                                })}
                              />
                            </div>
                          </div>
                        </div>

                        {/* Inscription FCDDV */}
                        <div className="space-y-3 p-3 bg-green-50 rounded-lg border border-green-300">
                          <h4 className="font-medium">Inscription au FCDDV</h4>
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="fcddv_mystique"
                              checked={testamentData.testamentMystique.inscriptionFCDDV}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, inscriptionFCDDV: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="fcddv_mystique" className="cursor-pointer">Procéder à l'inscription au FCDDV</Label>
                          </div>

                          {testamentData.testamentMystique.inscriptionFCDDV && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                              <div className="space-y-2">
                                <Label>Date d'inscription</Label>
                                <Input
                                  type="date"
                                  value={testamentData.testamentMystique.dateInscriptionFCDDV}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, dateInscriptionFCDDV: e.target.value}
                                  })}
                                />
                              </div>

                              <div className="space-y-2">
                                <Label>Notaire dépositaire</Label>
                                <Input
                                  value={testamentData.testamentMystique.notaireDepositaire}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, notaireDepositaire: e.target.value}
                                  })}
                                  placeholder="Nom du notaire dépositaire"
                                />
                              </div>
                            </div>
                          )}
                        </div>

                        {/* Présence simultanée et Signatures */}
                        <div className="space-y-3 p-3 bg-orange-50 rounded-lg border border-orange-300">
                          <h4 className="font-medium">Présence simultanée et Signatures <span className="text-red-500">*</span></h4>
                          
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="presenceSimultanee"
                              checked={testamentData.testamentMystique.presenceSimultanee}
                              onChange={(e) => setTestamentData({
                                ...testamentData,
                                testamentMystique: {...testamentData.testamentMystique, presenceSimultanee: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="presenceSimultanee" className="cursor-pointer text-red-700 font-medium">Présence simultanée du testateur, du notaire et des témoins lors de la suscription</Label>
                          </div>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mt-3">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="signatureTestateur"
                                checked={testamentData.testamentMystique.signatureTestateur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, signatureTestateur: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="signatureTestateur" className="cursor-pointer">Signature du testateur</Label>
                            </div>

                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="signatureNotaire"
                                checked={testamentData.testamentMystique.signatureNotaire}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, signatureNotaire: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="signatureNotaire" className="cursor-pointer">Signature du notaire</Label>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <div className="flex items-center space-x-2">
                              <input
                                type="checkbox"
                                id="impossibiliteSignerTestateur"
                                checked={testamentData.testamentMystique.impossibiliteSignerTestateur}
                                onChange={(e) => setTestamentData({
                                  ...testamentData,
                                  testamentMystique: {...testamentData.testamentMystique, impossibiliteSignerTestateur: e.target.checked}
                                })}
                                className="w-4 h-4"
                              />
                              <Label htmlFor="impossibiliteSignerTestateur" className="cursor-pointer">Impossibilité de signer pour le testateur</Label>
                            </div>

                            {testamentData.testamentMystique.impossibiliteSignerTestateur && (
                              <div className="ml-6">
                                <Label>Motif de l'impossibilité <span className="text-red-500">*</span></Label>
                                <Input
                                  value={testamentData.testamentMystique.motifImpossibiliteSignature}
                                  onChange={(e) => setTestamentData({
                                    ...testamentData,
                                    testamentMystique: {...testamentData.testamentMystique, motifImpossibiliteSignature: e.target.value}
                                  })}
                                  placeholder="Ex: Handicap physique, maladie..."
                                />
                              </div>
                            )}
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  {/* 10. Mentions légales obligatoires */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Mentions légales et rappels</h3>
                    
                    <div className="p-4 border rounded-lg space-y-3 bg-gray-50/50">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_reserve"
                          checked={testamentData.mentionsLegales.rappelReserveHereditaire}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, rappelReserveHereditaire: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_reserve" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Rappel de la réserve héréditaire (art. 912-916 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_quotite"
                          checked={testamentData.mentionsLegales.rappelQuotiteDisponible}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, rappelQuotiteDisponible: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_quotite" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Rappel de la quotité disponible
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_revocabilite"
                          checked={testamentData.mentionsLegales.revocabilite}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, revocabilite: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_revocabilite" className="text-sm cursor-pointer">
                          <span className="text-red-500 font-bold">*</span> Testament révocable à tout moment (art. 895 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_indignite"
                          checked={testamentData.mentionsLegales.indigniteSuccessorale}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, indigniteSuccessorale: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_indignite" className="text-sm cursor-pointer">
                          Mention des cas d'indignité successorale (art. 726-728 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_capacite"
                          checked={testamentData.mentionsLegales.capaciteLegataires}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, capaciteLegataires: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_capacite" className="text-sm cursor-pointer">
                          Vérification capacité des légataires à recevoir
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_reduction"
                          checked={testamentData.mentionsLegales.droitsReduction}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, droitsReduction: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_reduction" className="text-sm cursor-pointer">
                          Mention des droits de réduction (art. 920-930 Code civil)
                        </label>
                      </div>

                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="mention_fiscal"
                          checked={testamentData.mentionsLegales.regimeFiscal}
                          onChange={(e) => setTestamentData({
                            ...testamentData,
                            mentionsLegales: {...testamentData.mentionsLegales, regimeFiscal: e.target.checked}
                          })}
                        />
                        <label htmlFor="mention_fiscal" className="text-sm cursor-pointer">
                          Information sur le régime fiscal des successions
                        </label>
                      </div>
                    </div>
                  </div>

                  {/* 11. Documents à collecter */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Documents obligatoires à collecter</h3>
                    
                    {/* Testateur */}
                    <div className="space-y-3 p-4 border rounded-lg bg-blue-50/30">
                      <h4 className="font-medium">Documents du testateur</h4>
                      
                      <div className="space-y-2">
                        <Label>Pièce d'identité du testateur (CNI, passeport)</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentIdentiteTestateur')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentIdentiteTestateur ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentIdentiteTestateur ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentIdentiteTestateur ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentIdentiteTestateur ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentIdentiteTestateur?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentIdentiteTestateur"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentIdentiteTestateur(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Livret de famille</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentLivretFamille')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentLivretFamille ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentLivretFamille ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentLivretFamille ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentLivretFamille ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentLivretFamille?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentLivretFamille"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentLivretFamille(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Certificat de capacité juridique / jugement tutelle-curatelle (si applicable)</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentCapaciteJuridique')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentCapaciteJuridique ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentCapaciteJuridique ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentCapaciteJuridique ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentCapaciteJuridique ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentCapaciteJuridique?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentCapaciteJuridique"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentCapaciteJuridique(e.target.files[0]);
                            }
                          }}
                        />
                      </div>
                    </div>

                    {/* Témoins */}
                    <div className="space-y-3 p-4 border rounded-lg bg-purple-50/30">
                      <h4 className="font-medium">Documents des témoins</h4>
                      
                      <div className="space-y-2">
                        <Label>Pièces d'identité des témoins</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentIdentiteTemoins')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentIdentiteTemoins ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentIdentiteTemoins ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentIdentiteTemoins ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentIdentiteTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentIdentiteTemoins?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentIdentiteTemoins"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentIdentiteTemoins(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Justificatifs de domicile des témoins</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentDomicileTemoins')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentDomicileTemoins ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentDomicileTemoins ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentDomicileTemoins ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentDomicileTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentDomicileTemoins?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentDomicileTemoins"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentDomicileTemoins(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Attestations sur l'honneur capacité témoins</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentAttestationsTemoins')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentAttestationsTemoins ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentAttestationsTemoins ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentAttestationsTemoins ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentAttestationsTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentAttestationsTemoins?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentAttestationsTemoins"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentAttestationsTemoins(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Casiers judiciaires des témoins (extrait n°3)</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentCasiersTemoins')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentCasiersTemoins ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentCasiersTemoins ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentCasiersTemoins ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentCasiersTemoins ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentCasiersTemoins?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentCasiersTemoins"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentCasiersTemoins(e.target.files[0]);
                            }
                          }}
                        />
                      </div>
                    </div>

                    {/* Patrimoine */}
                    <div className="space-y-3 p-4 border rounded-lg bg-orange-50/30">
                      <h4 className="font-medium">Documents patrimoniaux</h4>
                      
                      <div className="space-y-2">
                        <Label>Titres de propriété immobiliers</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentTitresPropriete')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentTitresPropriete ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentTitresPropriete ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentTitresPropriete ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentTitresPropriete ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentTitresPropriete?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentTitresPropriete"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentTitresPropriete(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Relevés bancaires et comptes</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentRelevesBancaires')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentRelevesBancaires ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentRelevesBancaires ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentRelevesBancaires ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentRelevesBancaires ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentRelevesBancaires?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentRelevesBancaires"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentRelevesBancaires(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Contrat de mariage / régime matrimonial</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentContratMariage')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentContratMariage ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentContratMariage ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentContratMariage ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentContratMariage ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentContratMariage?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentContratMariage"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentContratMariage(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Autres justificatifs patrimoniaux</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('testamentAutresJustificatifs')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: testamentAutresJustificatifs ? "#22c55e" : "#fb923c",
                            backgroundColor: testamentAutresJustificatifs ? "#f0fdf4" : "white"
                          }}
                        >
                          {testamentAutresJustificatifs ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={testamentAutresJustificatifs ? "text-green-700 font-medium" : "text-orange-700"}>
                            {testamentAutresJustificatifs?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="testamentAutresJustificatifs"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setTestamentAutresJustificatifs(e.target.files[0]);
                            }
                          }}
                        />
                      </div>
                    </div>
                  </div>

                </div>
              </>
            )}

            {/* Formulaire Changement de Régime Matrimonial */}
            {pendingContractType === "Changement de régime matrimonial" && (
              <>
                <div className="space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto pr-2">
                  
                  {/* Section 1: Informations générales */}
                  <div className="space-y-4">
                    <h3 className="font-semibold text-lg border-b pb-2">Informations générales sur l'opération</h3>
                    
                    <div className="space-y-2">
                      <Label>Type de modification souhaitée <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.typeModification || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, typeModification: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le type..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="separation_biens">Passage à la séparation de biens</SelectItem>
                          <SelectItem value="communaute_reduite">Passage à la communauté réduite aux acquêts</SelectItem>
                          <SelectItem value="communaute_universelle">Passage à la communauté universelle</SelectItem>
                          <SelectItem value="participation_acquets">Passage à la participation aux acquêts</SelectItem>
                          <SelectItem value="modification_actuel">Modification / aménagement du régime actuel</SelectItem>
                          <SelectItem value="ajout_clauses">Clauses ajoutées au régime actuel</SelectItem>
                          <SelectItem value="adoption_contrat">Adoption d'un contrat de mariage pour la première fois</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Régime matrimonial actuel <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.regimeActuel || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, regimeActuel: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le régime actuel..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="communaute_legale">Communauté légale</SelectItem>
                          <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                          <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                          <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                          <SelectItem value="autre">Autre</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {changementRegimeData.regimeActuel === "autre" && (
                      <div className="space-y-2">
                        <Label>Préciser le régime actuel</Label>
                        <Input
                          value={changementRegimeData.regimeActuelAutre}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, regimeActuelAutre: e.target.value})}
                          placeholder="Précisez..."
                        />
                      </div>
                    )}

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Date du mariage <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={changementRegimeData.dateMariage}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, dateMariage: e.target.value})}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu du mariage <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.lieuMariage}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, lieuMariage: e.target.value})}
                          placeholder="Ville, pays..."
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="contratMariageInitial"
                          checked={changementRegimeData.contratMariageInitial}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, contratMariageInitial: e.target.checked})}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="contratMariageInitial">Existence d'un contrat de mariage initial (joindre copie si oui)</Label>
                      </div>
                    </div>

                    <div className="space-y-2">
                      <Label>Nouveau régime matrimonial souhaité <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.nouveauRegimeSouhaite || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, nouveauRegimeSouhaite: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le nouveau régime..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="communaute_reduite">Communauté réduite aux acquêts</SelectItem>
                          <SelectItem value="separation_biens">Séparation de biens</SelectItem>
                          <SelectItem value="communaute_universelle">Communauté universelle</SelectItem>
                          <SelectItem value="participation_acquets">Participation aux acquêts</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Date d'effet souhaitée</Label>
                      <Input
                        type="date"
                        value={changementRegimeData.dateEffetSouhaitee}
                        onChange={(e) => setChangementRegimeData({...changementRegimeData, dateEffetSouhaitee: e.target.value})}
                      />
                    </div>

                    <div className="space-y-2">
                      <Label>Motif principal du changement <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.motifChangement || undefined}
                        onValueChange={(value) => setChangementRegimeData({...changementRegimeData, motifChangement: value})}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner le motif..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="protection_conjoint">Protection du conjoint</SelectItem>
                          <SelectItem value="activite_professionnelle">Activité professionnelle</SelectItem>
                          <SelectItem value="anticipation_successorale">Anticipation successorale</SelectItem>
                          <SelectItem value="simplification_patrimoniale">Simplification patrimoniale</SelectItem>
                          <SelectItem value="autre">Autre</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {changementRegimeData.motifChangement === "autre" && (
                      <div className="space-y-2">
                        <Label>Préciser le motif</Label>
                        <Input
                          value={changementRegimeData.motifChangementAutre}
                          onChange={(e) => setChangementRegimeData({...changementRegimeData, motifChangementAutre: e.target.value})}
                          placeholder="Précisez le motif du changement..."
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 1bis: Présence d'enfants */}
                  <div className="space-y-4 p-4 border rounded-lg bg-yellow-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Présence d'enfants</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsCommuns"
                            checked={changementRegimeData.presenceEnfants.enfantsCommuns}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsCommuns: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsCommuns">Enfants communs</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsAutreUnion"
                            checked={changementRegimeData.presenceEnfants.enfantsAutreUnion}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsAutreUnion: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsAutreUnion">Enfants d'une autre union</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsMineurs"
                            checked={changementRegimeData.presenceEnfants.enfantsMineurs}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsMineurs: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsMineurs">Présence d'enfants mineurs</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="enfantsMajeursInformes"
                            checked={changementRegimeData.presenceEnfants.enfantsMajeursInformes}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              presenceEnfants: {...changementRegimeData.presenceEnfants, enfantsMajeursInformes: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="enfantsMajeursInformes">Enfants majeurs informés</Label>
                        </div>
                      </div>
                    </div>

                    {changementRegimeData.presenceEnfants.enfantsCommuns && (
                      <div className="space-y-2">
                        <Label>Nombre d'enfants communs</Label>
                        <Input
                          type="number"
                          min="0"
                          value={changementRegimeData.presenceEnfants.nombreEnfantsCommuns}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            presenceEnfants: {...changementRegimeData.presenceEnfants, nombreEnfantsCommuns: e.target.value}
                          })}
                        />
                      </div>
                    )}

                    {changementRegimeData.presenceEnfants.enfantsAutreUnion && (
                      <div className="space-y-2">
                        <Label>Nombre d'enfants d'une autre union</Label>
                        <Input
                          type="number"
                          min="0"
                          value={changementRegimeData.presenceEnfants.nombreEnfantsAutreUnion}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            presenceEnfants: {...changementRegimeData.presenceEnfants, nombreEnfantsAutreUnion: e.target.value}
                          })}
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 1ter: Opposition possible des tiers */}
                  <div className="space-y-4 p-4 border rounded-lg bg-red-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Opposition possible des tiers</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="creanciersConnus"
                            checked={changementRegimeData.oppositionTiers.creanciersConnus}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              oppositionTiers: {...changementRegimeData.oppositionTiers, creanciersConnus: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="creanciersConnus">Créanciers connus</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="risqueOpposition"
                            checked={changementRegimeData.oppositionTiers.risqueOpposition}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              oppositionTiers: {...changementRegimeData.oppositionTiers, risqueOpposition: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="risqueOpposition">Risque d'opposition identifié</Label>
                        </div>
                      </div>
                    </div>

                    {changementRegimeData.oppositionTiers.creanciersConnus && (
                      <div className="space-y-2">
                        <Label>Détails des créanciers connus</Label>
                        <textarea
                          value={changementRegimeData.oppositionTiers.detailsCreanciers}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            oppositionTiers: {...changementRegimeData.oppositionTiers, detailsCreanciers: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Liste des créanciers et montants dus..."
                        />
                      </div>
                    )}

                    {changementRegimeData.oppositionTiers.risqueOpposition && (
                      <div className="space-y-2">
                        <Label>Nature du risque d'opposition</Label>
                        <textarea
                          value={changementRegimeData.oppositionTiers.natureRisque}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            oppositionTiers: {...changementRegimeData.oppositionTiers, natureRisque: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Précisez la nature et les raisons du risque..."
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 1quater: Liquidation du régime matrimonial */}
                  <div className="space-y-4 p-4 border rounded-lg bg-orange-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Liquidation du régime matrimonial précédent</h3>
                    
                    <div className="space-y-2">
                      <Label>Liquidation nécessaire ? <span className="text-red-500">*</span></Label>
                      <Select
                        value={changementRegimeData.liquidationRegime.necessaire || undefined}
                        onValueChange={(value) => setChangementRegimeData({
                          ...changementRegimeData,
                          liquidationRegime: {...changementRegimeData.liquidationRegime, necessaire: value}
                        })}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                        <SelectContent>
                          <SelectItem value="oui">Oui - Liquidation nécessaire</SelectItem>
                          <SelectItem value="non">Non - Pas de liquidation</SelectItem>
                        </SelectContent>
                      </Select>
                    </div>

                    {changementRegimeData.liquidationRegime.necessaire === "non" && (
                      <div className="space-y-2">
                        <Label>Justification de l'absence de liquidation</Label>
                        <textarea
                          value={changementRegimeData.liquidationRegime.justificationAbsence}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            liquidationRegime: {...changementRegimeData.liquidationRegime, justificationAbsence: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Expliquez pourquoi aucune liquidation n'est nécessaire..."
                        />
                      </div>
                    )}

                    {changementRegimeData.liquidationRegime.necessaire === "oui" && (
                      <>
                        <div className="space-y-2">
                          <Label>Répartition des biens communs</Label>
                          <Select
                            value={changementRegimeData.liquidationRegime.repartitionBiens || undefined}
                            onValueChange={(value) => setChangementRegimeData({
                              ...changementRegimeData,
                              liquidationRegime: {...changementRegimeData.liquidationRegime, repartitionBiens: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="50-50">50/50 (par moitié)</SelectItem>
                              <SelectItem value="autre">Autre répartition</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {changementRegimeData.liquidationRegime.repartitionBiens === "autre" && (
                          <div className="space-y-2">
                            <Label>Préciser la répartition</Label>
                            <Input
                              value={changementRegimeData.liquidationRegime.autreRepartition}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                liquidationRegime: {...changementRegimeData.liquidationRegime, autreRepartition: e.target.value}
                              })}
                              placeholder="Ex: 60/40, ou selon accord..."
                            />
                          </div>
                        )}

                        <div className="space-y-2">
                          <div className="flex items-center space-x-2">
                            <input
                              type="checkbox"
                              id="recompensesCreances"
                              checked={changementRegimeData.liquidationRegime.recompensesCreances}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                liquidationRegime: {...changementRegimeData.liquidationRegime, recompensesCreances: e.target.checked}
                              })}
                              className="w-4 h-4"
                            />
                            <Label htmlFor="recompensesCreances">Existence de récompenses ou créances entre époux</Label>
                          </div>
                        </div>

                        {changementRegimeData.liquidationRegime.recompensesCreances && (
                          <div className="space-y-2">
                            <Label>Détails des récompenses / créances</Label>
                            <textarea
                              value={changementRegimeData.liquidationRegime.detailsRecompenses}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                liquidationRegime: {...changementRegimeData.liquidationRegime, detailsRecompenses: e.target.value}
                              })}
                              className="w-full min-h-[100px] p-2 border rounded-md"
                              placeholder="Liste des récompenses dues par chaque époux, créances, montants..."
                            />
                          </div>
                        )}
                      </>
                    )}
                  </div>

                  {/* Section 1quinquies: Homologation judiciaire */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Homologation judiciaire</h3>
                    
                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="homologationRequise"
                          checked={changementRegimeData.homologation.requise}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            homologation: {...changementRegimeData.homologation, requise: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="homologationRequise">Homologation judiciaire requise</Label>
                      </div>
                    </div>

                    {changementRegimeData.homologation.requise && (
                      <>
                        <div className="space-y-2">
                          <Label>Motif de l'homologation <span className="text-red-500">*</span></Label>
                          <Select
                            value={changementRegimeData.homologation.motif || undefined}
                            onValueChange={(value) => setChangementRegimeData({
                              ...changementRegimeData,
                              homologation: {...changementRegimeData.homologation, motif: value}
                            })}
                          >
                            <SelectTrigger><SelectValue placeholder="Sélectionner le motif..." /></SelectTrigger>
                            <SelectContent>
                              <SelectItem value="enfants_mineurs">Présence d'enfants mineurs</SelectItem>
                              <SelectItem value="opposition_tiers">Opposition d'un tiers</SelectItem>
                              <SelectItem value="protection_epoux">Protection d'un époux</SelectItem>
                              <SelectItem value="autre">Autre motif</SelectItem>
                            </SelectContent>
                          </Select>
                        </div>

                        {changementRegimeData.homologation.motif === "autre" && (
                          <div className="space-y-2">
                            <Label>Préciser le motif</Label>
                            <textarea
                              value={changementRegimeData.homologation.autreMotif}
                              onChange={(e) => setChangementRegimeData({
                                ...changementRegimeData,
                                homologation: {...changementRegimeData.homologation, autreMotif: e.target.value}
                              })}
                              className="w-full min-h-[80px] p-2 border rounded-md"
                              placeholder="Précisez le motif de l'homologation judiciaire..."
                            />
                          </div>
                        )}

                        <div className="space-y-2">
                          <Label>Tribunal compétent</Label>
                          <Input
                            value={changementRegimeData.homologation.tribunalCompetent}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              homologation: {...changementRegimeData.homologation, tribunalCompetent: e.target.value}
                            })}
                            placeholder="Ex: TJ de Paris..."
                          />
                        </div>
                      </>
                    )}
                  </div>

                  {/* Section 1sexies: Clauses spécifiques */}
                  <div className="space-y-4 p-4 border rounded-lg bg-indigo-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Clauses spécifiques à prévoir</h3>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="clauseAttributionIntegrale"
                            checked={changementRegimeData.clausesSpecifiques.attributionIntegrale}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, attributionIntegrale: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="clauseAttributionIntegrale">Clause d'attribution intégrale</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="clausePreciput"
                            checked={changementRegimeData.clausesSpecifiques.preciput}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, preciput: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="clausePreciput">Clause de préciput</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="exclusionBiens"
                            checked={changementRegimeData.clausesSpecifiques.exclusionBiens}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, exclusionBiens: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="exclusionBiens">Exclusion de certains biens</Label>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <div className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            id="amenagements"
                            checked={changementRegimeData.clausesSpecifiques.amenagements}
                            onChange={(e) => setChangementRegimeData({
                              ...changementRegimeData,
                              clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, amenagements: e.target.checked}
                            })}
                            className="w-4 h-4"
                          />
                          <Label htmlFor="amenagements">Aménagements particuliers</Label>
                        </div>
                      </div>
                    </div>

                    {changementRegimeData.clausesSpecifiques.attributionIntegrale && (
                      <div className="space-y-2">
                        <Label>Détails de la clause d'attribution intégrale</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.detailsAttribution}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, detailsAttribution: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Précisez les modalités de l'attribution intégrale..."
                        />
                      </div>
                    )}

                    {changementRegimeData.clausesSpecifiques.preciput && (
                      <div className="space-y-2">
                        <Label>Détails de la clause de préciput</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.detailsPreciput}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, detailsPreciput: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Biens concernés par le préciput..."
                        />
                      </div>
                    )}

                    {changementRegimeData.clausesSpecifiques.exclusionBiens && (
                      <div className="space-y-2">
                        <Label>Biens exclus du nouveau régime</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.biensExclus}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, biensExclus: e.target.value}
                          })}
                          className="w-full min-h-[80px] p-2 border rounded-md"
                          placeholder="Liste des biens à exclure et raisons..."
                        />
                      </div>
                    )}

                    {changementRegimeData.clausesSpecifiques.amenagements && (
                      <div className="space-y-2">
                        <Label>Description des aménagements particuliers</Label>
                        <textarea
                          value={changementRegimeData.clausesSpecifiques.detailsAmenagements}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            clausesSpecifiques: {...changementRegimeData.clausesSpecifiques, detailsAmenagements: e.target.value}
                          })}
                          className="w-full min-h-[100px] p-2 border rounded-md"
                          placeholder="Décrivez les aménagements particuliers souhaités..."
                        />
                      </div>
                    )}
                  </div>

                  {/* Section 2: Époux 1 */}
                  <div className="space-y-4 p-4 border rounded-lg bg-blue-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète de l'époux 1</h3>
                    
                    <div className="space-y-2">
                      <Label>Sélectionner le client (Époux 1)</Label>
                      <Select
                        value={changementRegimeData.epoux1.clientId || undefined}
                        onValueChange={(value) => {
                          const client = clients.find(c => c.id === value);
                          if (client) {
                            setChangementRegimeData({
                              ...changementRegimeData,
                              epoux1: {
                                ...changementRegimeData.epoux1,
                                clientId: value,
                                nom: client.nom,
                                prenom: client.prenom,
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                adresse: client.adresse || "",
                                profession: client.profession || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                typeIdentite: client.type_identite || "",
                                numeroIdentite: client.numero_identite || "",
                              }
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner un client..." /></SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.prenom} {client.nom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux1.nom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux1.prenom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux1.nomNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={changementRegimeData.epoux1.dateNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux1.lieuNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={changementRegimeData.epoux1.nationalite}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse actuelle</Label>
                        <Input
                          value={changementRegimeData.epoux1.adresse}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, adresse: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={changementRegimeData.epoux1.profession}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={changementRegimeData.epoux1.telephone}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={changementRegimeData.epoux1.email}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="epoux1Tutelle"
                          checked={changementRegimeData.epoux1.sousTutelleCuratelle}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux1: {...changementRegimeData.epoux1, sousTutelleCuratelle: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="epoux1Tutelle">Sous tutelle ou curatelle (joindre jugement si oui)</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 3: Époux 2 */}
                  <div className="space-y-4 p-4 border rounded-lg bg-purple-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Identité complète de l'époux 2</h3>
                    
                    <div className="space-y-2">
                      <Label>Sélectionner le client (Époux 2)</Label>
                      <Select
                        value={changementRegimeData.epoux2.clientId || undefined}
                        onValueChange={(value) => {
                          const client = clients.find(c => c.id === value);
                          if (client) {
                            setChangementRegimeData({
                              ...changementRegimeData,
                              epoux2: {
                                ...changementRegimeData.epoux2,
                                clientId: value,
                                nom: client.nom,
                                prenom: client.prenom,
                                dateNaissance: client.date_naissance || "",
                                lieuNaissance: client.lieu_naissance || "",
                                nationalite: client.nationalite || "",
                                adresse: client.adresse || "",
                                profession: client.profession || "",
                                telephone: client.telephone || "",
                                email: client.email || "",
                                typeIdentite: client.type_identite || "",
                                numeroIdentite: client.numero_identite || "",
                              }
                            });
                          }
                        }}
                      >
                        <SelectTrigger><SelectValue placeholder="Sélectionner un client..." /></SelectTrigger>
                        <SelectContent>
                          {clients.map((client) => (
                            <SelectItem key={client.id} value={client.id}>
                              {client.prenom} {client.nom}
                            </SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div className="space-y-2">
                        <Label>Nom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux2.nom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, nom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Prénom <span className="text-red-500">*</span></Label>
                        <Input
                          value={changementRegimeData.epoux2.prenom}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, prenom: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nom de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux2.nomNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, nomNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Date de naissance <span className="text-red-500">*</span></Label>
                        <Input
                          type="date"
                          value={changementRegimeData.epoux2.dateNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, dateNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Lieu de naissance</Label>
                        <Input
                          value={changementRegimeData.epoux2.lieuNaissance}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, lieuNaissance: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Nationalité</Label>
                        <Input
                          value={changementRegimeData.epoux2.nationalite}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, nationalite: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2 md:col-span-2">
                        <Label>Adresse actuelle</Label>
                        <Input
                          value={changementRegimeData.epoux2.adresse}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, adresse: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Profession</Label>
                        <Input
                          value={changementRegimeData.epoux2.profession}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, profession: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Téléphone</Label>
                        <Input
                          value={changementRegimeData.epoux2.telephone}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, telephone: e.target.value}
                          })}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Email</Label>
                        <Input
                          type="email"
                          value={changementRegimeData.epoux2.email}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, email: e.target.value}
                          })}
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <div className="flex items-center space-x-2">
                        <input
                          type="checkbox"
                          id="epoux2Tutelle"
                          checked={changementRegimeData.epoux2.sousTutelleCuratelle}
                          onChange={(e) => setChangementRegimeData({
                            ...changementRegimeData,
                            epoux2: {...changementRegimeData.epoux2, sousTutelleCuratelle: e.target.checked}
                          })}
                          className="w-4 h-4"
                        />
                        <Label htmlFor="epoux2Tutelle">Sous tutelle ou curatelle (joindre jugement si oui)</Label>
                      </div>
                    </div>
                  </div>

                  {/* Section 4: Documents à collecter */}
                  <div className="space-y-4 p-4 border rounded-lg bg-green-50/30">
                    <h3 className="font-semibold text-lg border-b pb-2">Pièces justificatives à collecter</h3>
                    
                    <div className="space-y-4">
                      <div className="space-y-2">
                        <Label>Pièce d'identité époux 1 (CNI, passeport)</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeEpouxIdentite1')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeEpouxIdentite1 ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeEpouxIdentite1 ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeEpouxIdentite1 ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeEpouxIdentite1 ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeEpouxIdentite1?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeEpouxIdentite1"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeEpouxIdentite1(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Pièce d'identité époux 2 (CNI, passeport)</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeEpouxIdentite2')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeEpouxIdentite2 ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeEpouxIdentite2 ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeEpouxIdentite2 ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeEpouxIdentite2 ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeEpouxIdentite2?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeEpouxIdentite2"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeEpouxIdentite2(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Livret de famille</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeLivretFamille')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeLivretFamille ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeLivretFamille ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeLivretFamille ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeLivretFamille ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeLivretFamille?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeLivretFamille"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeLivretFamille(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Acte de mariage</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeActeMariage')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeActeMariage ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeActeMariage ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeActeMariage ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeActeMariage ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeActeMariage?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeActeMariage"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeActeMariage(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      {changementRegimeData.contratMariageInitial && (
                        <div className="space-y-2">
                          <Label>Contrat de mariage initial</Label>
                          <button
                            type="button"
                            onClick={() => document.getElementById('changementRegimeContratMariageInitial')?.click()}
                            className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                            style={{
                              borderColor: changementRegimeContratMariageInitial ? "#22c55e" : "#fb923c",
                              backgroundColor: changementRegimeContratMariageInitial ? "#f0fdf4" : "white"
                            }}
                          >
                            {changementRegimeContratMariageInitial ? (
                              <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                              </svg>
                            ) : (
                              <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                              </svg>
                            )}
                            <span className={changementRegimeContratMariageInitial ? "text-green-700 font-medium" : "text-orange-700"}>
                              {changementRegimeContratMariageInitial?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                            </span>
                          </button>
                          <Input
                            id="changementRegimeContratMariageInitial"
                            type="file"
                            className="hidden"
                            onChange={(e) => {
                              if (e.target.files?.[0]) {
                                setChangementRegimeContratMariageInitial(e.target.files[0]);
                              }
                            }}
                          />
                        </div>
                      )}

                      <div className="space-y-2">
                        <Label>Titres de propriété (biens immobiliers)</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeTitresPropriete')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeTitresPropriete ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeTitresPropriete ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeTitresPropriete ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeTitresPropriete ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeTitresPropriete?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeTitresPropriete"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeTitresPropriete(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Relevés de comptes bancaires</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeRelevesComptes')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeRelevesComptes ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeRelevesComptes ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeRelevesComptes ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeRelevesComptes ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeRelevesComptes?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeRelevesComptes"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeRelevesComptes(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Statuts de sociétés / Pactes d'associés</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeStatutsSocietes')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeStatutsSocietes ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeStatutsSocietes ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeStatutsSocietes ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeStatutsSocietes ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeStatutsSocietes?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeStatutsSocietes"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeStatutsSocietes(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Actes de prêts en cours</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeActesPrets')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeActesPrets ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeActesPrets ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeActesPrets ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeActesPrets ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeActesPrets?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeActesPrets"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeActesPrets(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      <div className="space-y-2">
                        <Label>Valeurs estimées des biens</Label>
                        <button
                          type="button"
                          onClick={() => document.getElementById('changementRegimeEstimationsBiens')?.click()}
                          className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                          style={{
                            borderColor: changementRegimeEstimationsBiens ? "#22c55e" : "#fb923c",
                            backgroundColor: changementRegimeEstimationsBiens ? "#f0fdf4" : "white"
                          }}
                        >
                          {changementRegimeEstimationsBiens ? (
                            <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                            </svg>
                          ) : (
                            <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                              <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                          )}
                          <span className={changementRegimeEstimationsBiens ? "text-green-700 font-medium" : "text-orange-700"}>
                            {changementRegimeEstimationsBiens?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                          </span>
                        </button>
                        <Input
                          id="changementRegimeEstimationsBiens"
                          type="file"
                          className="hidden"
                          onChange={(e) => {
                            if (e.target.files?.[0]) {
                              setChangementRegimeEstimationsBiens(e.target.files[0]);
                            }
                          }}
                        />
                      </div>

                      {(changementRegimeData.epoux1.sousTutelleCuratelle || changementRegimeData.epoux2.sousTutelleCuratelle) && (
                        <div className="space-y-2">
                          <Label>Jugement de tutelle/curatelle</Label>
                          <button
                            type="button"
                            onClick={() => document.getElementById('changementRegimeJugementTutelle')?.click()}
                            className="w-full p-3 border-2 border-dashed rounded-lg text-sm flex items-center justify-center gap-2 hover:bg-orange-50 transition-colors"
                            style={{
                              borderColor: changementRegimeJugementTutelle ? "#22c55e" : "#fb923c",
                              backgroundColor: changementRegimeJugementTutelle ? "#f0fdf4" : "white"
                            }}
                          >
                            {changementRegimeJugementTutelle ? (
                              <svg className="w-5 h-5 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                              </svg>
                            ) : (
                              <svg className="w-5 h-5 text-orange-500" fill="currentColor" viewBox="0 0 20 20">
                                <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
                              </svg>
                            )}
                            <span className={changementRegimeJugementTutelle ? "text-green-700 font-medium" : "text-orange-700"}>
                              {changementRegimeJugementTutelle?.name || "Aucune pièce chargée - Cliquer pour ajouter"}
                            </span>
                          </button>
                          <Input
                            id="changementRegimeJugementTutelle"
                            type="file"
                            className="hidden"
                            onChange={(e) => {
                              if (e.target.files?.[0]) {
                                setChangementRegimeJugementTutelle(e.target.files[0]);
                              }
                            }}
                          />
                        </div>
                      )}
                    </div>
                  </div>

                </div>
              </>
            )}

          </div>

          <div className="flex justify-end gap-3 mt-6 pt-4 border-t">
            <Button 
              variant="outline"
              className={role === 'notaire' ? 'border-orange-600 text-orange-600 hover:text-orange-600 hover:bg-orange-50' : 'border-blue-600 text-blue-600 hover:text-blue-600 hover:bg-blue-50'}
              onClick={() => setShowQuestionDialog(false)}
            >
              Annuler
            </Button>
            <Button 
              className={role === 'notaire' ? 'bg-orange-600 hover:bg-orange-700' : 'bg-blue-600 hover:bg-blue-700'}
              onClick={() => {
                if (pendingContractType === "Acte de vente immobilière") {
                  handleActeVenteSubmit();
                } else if (pendingContractType === "Bail d'habitation vide" || pendingContractType === "Bail d'habitation meublé") {
                  handleBailHabitationSubmit();
                } else if (pendingContractType === "Bail commercial / professionnel") {
                  handleBailCommercialSubmit();
                } else if (pendingContractType === "Convention d'indivision") {
                  handleIndivisionSubmit();
                } else if (pendingContractType === "Mainlevée d'hypothèque") {
                  handleMainleveeSubmit();
                } else if (pendingContractType === "Contrat de mariage (régimes matrimoniaux)") {
                  handleContratMariageSubmit();
                } else if (pendingContractType === "PACS (convention + enregistrement)") {
                  handlePacsSubmit();
                } else if (pendingContractType === "Donation entre époux") {
                  handleDonationEntreEpouxSubmit();
                } else if (pendingContractType === "Donation simple (parent → enfant, etc.)") {
                  handleDonationSimpleSubmit();
                } else if (pendingContractType === "Testament authentique ou mystique") {
                  handleTestamentSubmit();
                } else {
                  handleQuestionnaireSubmit();
                }
              }}
            >
              Créer le contrat
            </Button>
          </div>
        </DialogContent>
      </Dialog>
    </AppLayout>
  );
}
